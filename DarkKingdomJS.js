/**
 * @version 1.0.0.0
 * @copyright Copyright Â©  2019
 * @compiler Bridge.NET 17.10.1
 */
Bridge.assembly("DarkKingdomJS", function ($asm, globals) {
    "use strict";

    Bridge.define("DarkKingdomCore.Ability", {
        fields: {
            name: null,
            value: 0,
            condition: null,
            condnum: 0,
            condCompleted: false,
            typ: 0,
            hidden: false,
            used: false,
            longTime: false
        },
        ctors: {
            ctor: function (nme, nm, con, cn, t, h) {
                this.$initialize();
                this.name = nme;
                this.value = nm;
                this.typ = t;
                this.condition = con;
                this.condnum = cn;
                this.hidden = h;
                if (!Bridge.referenceEquals(this.condition, "")) {
                    this.condCompleted = false;
                } else {
                    this.condCompleted = true;
                }
                this.used = false;
                this.longTime = System.Array.indexOfT(DarkKingdomCore.MyGame.longTimeConds, this.condition) > -1;
            }
        }
    });

    Bridge.define("DarkKingdomCore.Achievement", {
        fields: {
            name: null,
            uIcon: null,
            booty: null
        },
        ctors: {
            init: function () {
                this.uIcon = new MonoInterface.Appearance();
            },
            ctor: function (nam, ui, boty) {
                this.$initialize();
                this.name = nam;
                this.uIcon = ui.$clone();
                this.booty = boty;
            }
        }
    });

    Bridge.define("DarkKingdomCore.Ammo", {
        fields: {
            x: 0,
            y: 0,
            vx: 0,
            vy: 0,
            ay: 0,
            type: 0,
            target: null,
            dmg: 0,
            ignoreArmor: false,
            agil: false,
            lifetime: 0,
            stock: false,
            plr: 0,
            owner: null,
            img: 0,
            explosive: false
        },
        ctors: {
            init: function () {
                this.stock = false;
            },
            $ctor1: function (pl, t, xx, yy, vxx, vyy, ayy, ownabils, trg, d, ia, ag, ltime, exp) {
                if (exp === void 0) { exp = false; }

                this.$initialize();
                this.x = xx;
                this.y = yy;
                this.vx = vxx;
                this.vy = vyy;
                this.ay = ayy;
                this.target = trg;
                this.type = t;
                this.dmg = d;
                this.ignoreArmor = ia;
                this.agil = ag;
                this.lifetime = ltime;
                this.plr = pl;
                this.explosive = exp;
            },
            ctor: function (pl, t, xx, yy, own, trg, d, ia, ag, ltime, exp) {
                if (exp === void 0) { exp = false; }

                this.$initialize();
                var tt;
                var a = 0.1;
                this.plr = pl;
                switch (t) {
                    case DarkKingdomCore.Ammo.AmmoType.Arrow: 
                        {
                            this.vx = 4;
                            break;
                        }
                    case DarkKingdomCore.Ammo.AmmoType.BigArrow: 
                        {
                            this.vx = 2;
                            break;
                        }
                    case DarkKingdomCore.Ammo.AmmoType.Bomb: 
                        {
                            this.vx = 1.5;
                            this.img = 1;
                            break;
                        }
                    case DarkKingdomCore.Ammo.AmmoType.BlueBall: 
                        {
                            this.vx = 3;
                            a = 0.03;
                            this.img = 2;
                            break;
                        }
                    case DarkKingdomCore.Ammo.AmmoType.RedBall: 
                        {
                            this.vx = 3;
                            a = 0.03;
                            this.img = 0;
                            break;
                        }
                    case DarkKingdomCore.Ammo.AmmoType.VioletBall: 
                        {
                            this.vx = 3;
                            a = 0.03;
                            this.img = 3;
                            break;
                        }
                    case DarkKingdomCore.Ammo.AmmoType.GreenBall: 
                        {
                            this.vx = 3;
                            a = 0.03;
                            this.img = 5;
                            break;
                        }
                    case DarkKingdomCore.Ammo.AmmoType.FastArrow: 
                        {
                            this.vx = 4;
                            break;
                        }
                    case DarkKingdomCore.Ammo.AmmoType.Bullet: 
                        {
                            a = 0;
                            this.vx = 6;
                            this.img = 6;
                            break;
                        }
                    case DarkKingdomCore.Ammo.AmmoType.Hammer: 
                        {
                            this.vx = 1.5;
                            this.img = 4;
                            break;
                        }
                }
                this.explosive = exp;
                this.x = xx;
                this.y = yy;
                this.vx *= Bridge.Int.sign(trg.x - xx);
                this.owner = own;
                this.target = trg;
                this.type = t;
                this.dmg = d;
                this.ignoreArmor = ia;
                this.agil = ag;
                this.lifetime = ltime;
                if (trg.x !== xx) {
                    tt = (trg.x - xx) / this.vx;
                    this.vy = (((((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0) + 15) | 0) - yy) / tt - a * tt / 2;
                } else {
                    this.vy = -1;
                }
                this.ay = a;
            }
        }
    });

    Bridge.define("DarkKingdomCore.Ammo.AmmoType", {
        $kind: "nested enum",
        statics: {
            fields: {
                None: 0,
                Arrow: 1,
                BigArrow: 2,
                Bomb: 3,
                BlueBall: 4,
                RedBall: 5,
                VioletBall: 6,
                GreenBall: 7,
                Bullet: 8,
                FastArrow: 9,
                Hammer: 10
            }
        }
    });

    Bridge.define("DarkKingdomCore.Attack", {
        $kind: "struct",
        statics: {
            methods: {
                op_Addition$1: function (atk, val) {
                    return new DarkKingdomCore.Attack.$ctor1(((atk.MinDamage + val) | 0), ((atk.MaxDamage + val) | 0), atk.Range, atk.Speed);
                },
                op_Addition: function (atk1, atk2) {
                    return new DarkKingdomCore.Attack.$ctor1(((atk1.MinDamage + atk2.MinDamage) | 0), ((atk1.MaxDamage + atk2.MaxDamage) | 0), ((atk1.Range + atk2.Range) | 0), atk1.Speed);
                },
                op_Subtraction$1: function (atk, val) {
                    return new DarkKingdomCore.Attack.$ctor1(((atk.MinDamage - val) | 0), ((atk.MaxDamage - val) | 0), atk.Range, atk.Speed);
                },
                op_Subtraction: function (atk1, atk2) {
                    return new DarkKingdomCore.Attack.$ctor1(((atk1.MinDamage - atk2.MinDamage) | 0), ((atk1.MaxDamage - atk2.MaxDamage) | 0), ((atk1.Range - atk2.Range) | 0), atk1.Speed);
                },
                op_Multiply: function (atk, val) {
                    return new DarkKingdomCore.Attack.$ctor1(Bridge.Int.mul(atk.MinDamage, val), Bridge.Int.mul(atk.MaxDamage, val), atk.Range, atk.Speed);
                },
                getDefaultValue: function () { return new DarkKingdomCore.Attack(); }
            }
        },
        fields: {
            MinDamage: 0,
            MaxDamage: 0,
            Range: 0,
            Speed: 0
        },
        ctors: {
            $ctor1: function (mnd, mxd, range, speed) {
                this.$initialize();
                this.MinDamage = mnd;
                this.MaxDamage = mxd;
                this.Range = range;
                this.Speed = speed;
            },
            ctor: function () {
                this.$initialize();
            }
        },
        methods: {
            getHashCode: function () {
                var h = Bridge.addHash([1635049380, this.MinDamage, this.MaxDamage, this.Range, this.Speed]);
                return h;
            },
            equals: function (o) {
                if (!Bridge.is(o, DarkKingdomCore.Attack)) {
                    return false;
                }
                return Bridge.equals(this.MinDamage, o.MinDamage) && Bridge.equals(this.MaxDamage, o.MaxDamage) && Bridge.equals(this.Range, o.Range) && Bridge.equals(this.Speed, o.Speed);
            },
            $clone: function (to) {
                var s = to || new DarkKingdomCore.Attack();
                s.MinDamage = this.MinDamage;
                s.MaxDamage = this.MaxDamage;
                s.Range = this.Range;
                s.Speed = this.Speed;
                return s;
            }
        }
    });

    Bridge.define("DarkKingdomCore.EffectType", {
        $kind: "enum",
        statics: {
            fields: {
                Normal: 0,
                Bad: 1,
                Poison: 2,
                Good: 3
            }
        }
    });

    Bridge.define("DarkKingdomCore.GameState", {
        $kind: "enum",
        statics: {
            fields: {
                MainMenu: 0,
                PrePlay: 1,
                InGame: 2,
                Win: 3,
                Lose: 4
            }
        }
    });

    Bridge.define("DarkKingdomCore.GameType", {
        $kind: "enum",
        statics: {
            fields: {
                RandomGT: 0,
                StandartGT: 1,
                OffenceGT: 2,
                DefenceGT: 3,
                FirstHeroGT: 4
            }
        }
    });

    Bridge.define("DarkKingdomCore.Particle", {
        fields: {
            x: 0,
            y: 0,
            dx: 0,
            dy: 0,
            ltime: 0,
            pType: 0,
            a: 0,
            ast: 0,
            ay: 0
        }
    });

    Bridge.define("DarkKingdomCore.LandscapeType", {
        $kind: "enum",
        statics: {
            fields: {
                PlainLS: 0,
                DesertLS: 1,
                SwampLS: 2,
                DeathlandLS: 3,
                MechanicsLS: 4,
                ForestLS: 5,
                InfernoLS: 6
            }
        }
    });

    Bridge.define("DarkKingdomCore.MatchCondition", {
        $kind: "struct",
        statics: {
            methods: {
                getDefaultValue: function () { return new DarkKingdomCore.MatchCondition(); }
            }
        },
        fields: {
            name: null,
            res1: null,
            res2: null,
            income: 0,
            ipt: 0
        },
        ctors: {
            init: function () {
                this.res1 = new DarkKingdomCore.TimeCost();
                this.res2 = new DarkKingdomCore.TimeCost();
            },
            $ctor1: function (nme, r1, r2, inc, ip) {
                this.$initialize();
                this.name = nme;
                this.res1 = r1.$clone();
                this.res2 = r2.$clone();
                this.income = inc;
                this.ipt = ip;
            },
            ctor: function () {
                this.$initialize();
            }
        },
        methods: {
            getHashCode: function () {
                var h = Bridge.addHash([5290622088, this.name, this.res1, this.res2, this.income, this.ipt]);
                return h;
            },
            equals: function (o) {
                if (!Bridge.is(o, DarkKingdomCore.MatchCondition)) {
                    return false;
                }
                return Bridge.equals(this.name, o.name) && Bridge.equals(this.res1, o.res1) && Bridge.equals(this.res2, o.res2) && Bridge.equals(this.income, o.income) && Bridge.equals(this.ipt, o.ipt);
            },
            $clone: function (to) {
                var s = to || new DarkKingdomCore.MatchCondition();
                s.name = this.name;
                s.res1 = this.res1.$clone();
                s.res2 = this.res2.$clone();
                s.income = this.income;
                s.ipt = this.ipt;
                return s;
            }
        }
    });

    Bridge.define("DarkKingdomCore.MyGame", {
        statics: {
            fields: {
                elapse_Periodically: 0,
                goodAbilClr: null,
                badAbilClr: null,
                poiAbilClr: null,
                loc: null,
                rnd: null,
                gameWidth: 0,
                gameHeight: 0,
                hor: 0,
                unitPrms: null,
                sprites: null,
                allAbils: null,
                allConds: null,
                plrs: null,
                units: null,
                gState: 0,
                pars: null,
                uipars: null,
                cloudpars: null,
                backpars: null,
                bushpars: null,
                longTimeConds: null,
                frmFillTex: null,
                btnFillTex: null,
                btnSelectTex: null,
                btnHlTex: null,
                btnPressedTex: null,
                btnDisabledTex: null,
                prgFillTex: null,
                prgBarTex: null,
                hlbtncolor: null,
                disbtnbrush: null
            },
            ctors: {
                init: function () {
                    this.goodAbilClr = new Microsoft.Xna.Framework.Color();
                    this.badAbilClr = new Microsoft.Xna.Framework.Color();
                    this.poiAbilClr = new Microsoft.Xna.Framework.Color();
                    this.hlbtncolor = new Microsoft.Xna.Framework.Color();
                    this.disbtnbrush = new Microsoft.Xna.Framework.Color();
                    this.elapse_Periodically = 1;
                    this.badAbilClr = Microsoft.Xna.Framework.Color.DarkViolet.$clone();
                    this.poiAbilClr = Microsoft.Xna.Framework.Color.DarkViolet.$clone();
                    this.loc = new (System.Collections.Generic.Dictionary$2(System.String,System.String)).ctor();
                    this.rnd = new System.Random.ctor();
                    this.gameWidth = 800;
                    this.gameHeight = 480;
                    this.unitPrms = new (System.Collections.Generic.Dictionary$2(System.String,DarkKingdomCore.UnitParameters)).ctor();
                    this.sprites = new (System.Collections.Generic.Dictionary$2(System.String,MonoInterface.Sprite)).ctor();
                    this.allAbils = new (System.Collections.Generic.List$1(System.String)).ctor();
                    this.allConds = new (System.Collections.Generic.List$1(System.String)).ctor();
                    this.plrs = System.Array.init(2, null, DarkKingdomCore.Player);
                    this.units = new (System.Collections.Generic.List$1(DarkKingdomCore.Unit)).ctor();
                    this.pars = new (System.Collections.Generic.List$1(DarkKingdomCore.Particle)).ctor();
                    this.uipars = new (System.Collections.Generic.List$1(DarkKingdomCore.Particle)).ctor();
                    this.cloudpars = new (System.Collections.Generic.List$1(DarkKingdomCore.ImageParticle)).ctor();
                    this.backpars = new (System.Collections.Generic.List$1(DarkKingdomCore.ImageParticle)).ctor();
                    this.bushpars = new (System.Collections.Generic.List$1(DarkKingdomCore.ImageParticle)).ctor();
                    this.longTimeConds = System.Array.init(["Tier", "Machine army"], System.String);
                    this.hlbtncolor = Microsoft.Xna.Framework.Color.WhiteSmoke.$clone();
                    this.disbtnbrush = new Microsoft.Xna.Framework.Color.$ctor7(120, 75, 75, 75);
                }
            },
            methods: {
                SelectPlayingRace: function (uList) {
                    var $t;
                    var tmpdic = new (System.Collections.Generic.Dictionary$2(System.String,System.Int32)).ctor();
                    var maxrace = "";
                    var maxcnt = 0;
                    $t = Bridge.getEnumerator(uList);
                    try {
                        while ($t.moveNext()) {
                            var u = $t.Current;
                            if (tmpdic.containsKey(DarkKingdomCore.MyGame.unitPrms.getItem(u).$clone().Race)) {
                                tmpdic.setItem(DarkKingdomCore.MyGame.unitPrms.getItem(u).$clone().Race, (tmpdic.getItem(DarkKingdomCore.MyGame.unitPrms.getItem(u).$clone().Race) + 1) | 0);
                            } else {
                                tmpdic.add(DarkKingdomCore.MyGame.unitPrms.getItem(u).$clone().Race, 1);
                            }
                            if (tmpdic.getItem(DarkKingdomCore.MyGame.unitPrms.getItem(u).$clone().Race) > maxcnt) {
                                maxcnt = tmpdic.getItem(DarkKingdomCore.MyGame.unitPrms.getItem(u).$clone().Race);
                                maxrace = DarkKingdomCore.MyGame.unitPrms.getItem(u).$clone().Race;
                            }
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                    return maxrace;
                },
                FillRectangle$1: function (sb, tex, x, y, w, h) {
                    sb.Draw(tex, new Microsoft.Xna.Framework.Rectangle.$ctor2(x, y, w, h), Microsoft.Xna.Framework.Color.White.$clone());
                },
                FillRectangle: function (sb, tex, rect) {
                    sb.Draw(tex, new Microsoft.Xna.Framework.Rectangle.$ctor2(rect.X, rect.Y, rect.Width, rect.Height), Microsoft.Xna.Framework.Color.White.$clone());
                }
            }
        },
        fields: {
            AppFolder: null,
            DataFolder: null,
            graphics: null,
            spriteBatch: null,
            Fonts: null,
            localize: null,
            oldMouseState: null,
            Platform: null,
            isLoaded: false,
            landBmp: null,
            curProfile: 0,
            sunAng: 0,
            dAng: 0,
            gType: 0,
            gamelandscape: 0,
            landsTypesCount: 0,
            ammos: null,
            spells: null,
            pdeathlist: null,
            lifeClr: null,
            abilClr: null,
            backClr: null,
            condClr: null,
            unitSize: 0,
            us2: 0,
            csS: 0,
            snS: 0,
            csD: 0,
            snD: 0,
            skyR: 0,
            skyB: 0,
            skyG: 0,
            skyR2: 0,
            skyB2: 0,
            skyG2: 0,
            cnstR: 0,
            cnstG: 0,
            cnstB: 0,
            cnstR2: 0,
            cnstG2: 0,
            cnstB2: 0,
            stars: null,
            skyrect: null,
            starsCnt: 0,
            _pause: false,
            startBuildingsList: null,
            curM: 0,
            curD: 0,
            selU: null,
            deltax: 0,
            deltay: 0,
            deathlist: null,
            flyHeight: 0,
            piece: 0,
            conds: null,
            races1: null,
            races2: null,
            edunits: null,
            symbols: null,
            ispllmod: false,
            spellName: null,
            starTex: null,
            sunsetclr: null,
            machinenum: 0,
            bornList: null,
            oldsnS: 0,
            globalExplode: 0,
            unlockedUnits: null,
            unlockedAchivs: null,
            updateSpells: false,
            moneyClr: null,
            deathClr: null,
            AllUntsList: null,
            startAutofight: false,
            achivs: null,
            purchases: null,
            standartRaces: null,
            preGameUnits: null,
            preGameSpells: null,
            preGameBonus: null,
            preGameSlotCnt: 0,
            menuCarousel: null,
            curCarouselPos: 0,
            numKeys: null,
            unitsPreGame: null,
            spellsPreGame: null,
            taskConfirm: null,
            backFillTex: null,
            healthBarBackTex: null,
            healthBarLifeTex: null,
            healthBarPoisonTex: null,
            healthBarAbilTex: null,
            skytexture: null,
            sunsettexture: null,
            _screenWidth: 0,
            _screenHeight: 0,
            scaleX: 0,
            scaleY: 0,
            listeningKeys: null,
            oldKeyboardState: null,
            MainContainer: null,
            mainAnimator: null,
            defaultTheme: null,
            backTheme: null,
            frmConfirm: null,
            lblTextFrmConfirm: null,
            btnOkayFrmDialogConfirm: null,
            btnNopeFrmDialogConfirm: null,
            frmSettings: null,
            resSwitcherFrmSettings: null,
            frmMainMenu: null,
            frmBattleMenu: null,
            lblAIFrmBattleMenu: null,
            frmRightMenu: null,
            frmDialog: null,
            lblTitlefrmDialog: null,
            lblLine1FrmDialog: null,
            lblLine2FrmDialog: null,
            frmResources: null,
            pctTierFrmResources: null,
            pctPauseFrmResources: null,
            lblGoldFrmResources: null,
            lblDeathFrmResources: null,
            btnTierUpFrmResources: null,
            lblsFrmCustomRacesList: null,
            btnsFrmCustomRacesList: null,
            frmProfile: null,
            lblsfrmProfile: null,
            frmBack: null,
            frmBattle: null,
            races1SwitcherFrmBattle: null,
            races2SwitcherFrmBattle: null,
            modeSwitcherFrmBattle: null,
            frmUnits: null,
            frmProduction: null,
            prgsProduction: null,
            frmPreGame: null,
            btnsProduction: null,
            cUnits: null,
            cSpells: null,
            cBuildings: null,
            btnSelectUnits: null,
            btnSelectSpells: null,
            btnSelectBuildings: null,
            cBattleParameters: null,
            lblUnitNameHelpUnit: null,
            lblRaceHelpUnit: null,
            lblCostMoneyHelpUnit: null,
            lblCostDeathHelpUnit: null,
            lblAttackBasicParams: null,
            pctAttackBasicParams: null,
            lblsBasicParams: null,
            lblsAbils: null,
            frmHelp: null,
            lblVsPreGame: null,
            cUnitsPreGame: null,
            cSpellsPreGame: null,
            cBuildingsPreGame: null,
            cSelectedPreGame: null,
            btnFightPreGame: null,
            btnUnitsPreGame: null,
            btnSpellsPreGame: null,
            btnBuildingsPreGame: null,
            screenFormats: null
        },
        events: {
            OnExit: null
        },
        props: {
            inSpellMode: {
                get: function () {
                    return this.ispllmod;
                },
                set: function (value) {
                    this.ispllmod = value;
                    if (value) {
                    } else {
                    }
                }
            },
            Pause: {
                get: function () {
                    return this._pause;
                },
                set: function (value) {
                    this._pause = value;
                    if (DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.InGame) {
                        if (this._pause) {
                            this.pctPauseFrmResources.spriteRef = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("medium_icons"), 8);
                            this.frmBattleMenu.Show(this.mainAnimator);
                        } else {
                            this.pctPauseFrmResources.spriteRef = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("medium_icons"), 1);
                            this.frmBattleMenu.Hide(this.mainAnimator);
                        }
                    }
                }
            }
        },
        ctors: {
            init: function () {
                this.oldMouseState = new Microsoft.Xna.Framework.Input.MouseState();
                this.lifeClr = new Microsoft.Xna.Framework.Color();
                this.abilClr = new Microsoft.Xna.Framework.Color();
                this.backClr = new Microsoft.Xna.Framework.Color();
                this.condClr = new Microsoft.Xna.Framework.Color();
                this.skyrect = new Microsoft.Xna.Framework.Rectangle();
                this.sunsetclr = new Microsoft.Xna.Framework.Color();
                this.moneyClr = new Microsoft.Xna.Framework.Color();
                this.deathClr = new Microsoft.Xna.Framework.Color();
                this.oldKeyboardState = new Microsoft.Xna.Framework.Input.KeyboardState();
                this.isLoaded = false;
                this.landsTypesCount = 7;
                this.ammos = new (System.Collections.Generic.List$1(DarkKingdomCore.Ammo)).ctor();
                this.spells = new (System.Collections.Generic.Dictionary$2(System.String,DarkKingdomCore.Spell)).ctor();
                this.pdeathlist = new (System.Collections.Generic.List$1(DarkKingdomCore.Particle)).ctor();
                this.lifeClr = new Microsoft.Xna.Framework.Color.$ctor7(255, 0, 0, 200);
                this.abilClr = new Microsoft.Xna.Framework.Color.$ctor7(0, 0, 255, 200);
                this.backClr = new Microsoft.Xna.Framework.Color.$ctor7(255, 255, 255, 150);
                this.condClr = new Microsoft.Xna.Framework.Color.$ctor6(100, 100, 100);
                this.unitSize = 30;
                this.us2 = 15;
                this.cnstR = 50;
                this.cnstG = 130;
                this.cnstB = 200;
                this.cnstR2 = 120;
                this.cnstG2 = 190;
                this.cnstB2 = 230;
                this.startBuildingsList = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.deathlist = new (System.Collections.Generic.List$1(DarkKingdomCore.Unit)).ctor();
                this.flyHeight = 48;
                this.piece = 0.03926991;
                this.conds = new (System.Collections.Generic.List$1(DarkKingdomCore.MatchCondition)).ctor();
                this.edunits = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.symbols = System.Array.init(4, function (){
                    return new Microsoft.Xna.Framework.Rectangle();
                }, Microsoft.Xna.Framework.Rectangle);
                this.ispllmod = false;
                this.spellName = "";
                this.sunsetclr = Microsoft.Xna.Framework.Color.OrangeRed.$clone();
                this.bornList = new (System.Collections.Generic.List$1(DarkKingdomCore.Unit)).ctor();
                this.globalExplode = 0;
                this.unlockedUnits = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.unlockedAchivs = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.updateSpells = false;
                this.moneyClr = Microsoft.Xna.Framework.Color.Chocolate.$clone();
                this.deathClr = Microsoft.Xna.Framework.Color.RoyalBlue.$clone();
                this.AllUntsList = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.startAutofight = false;
                this.achivs = new (System.Collections.Generic.Dictionary$2(System.String,DarkKingdomCore.Achievement)).ctor();
                this.purchases = new (System.Collections.Generic.Dictionary$2(System.String,DarkKingdomCore.Purchase)).ctor();
                this.standartRaces = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.preGameUnits = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.preGameSpells = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.preGameBonus = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.preGameSlotCnt = 10;
                this.curCarouselPos = 0;
                this.numKeys = System.Array.init([Microsoft.Xna.Framework.Input.Keys.D1, Microsoft.Xna.Framework.Input.Keys.D2, Microsoft.Xna.Framework.Input.Keys.D3, Microsoft.Xna.Framework.Input.Keys.D4, Microsoft.Xna.Framework.Input.Keys.D5, Microsoft.Xna.Framework.Input.Keys.D6, Microsoft.Xna.Framework.Input.Keys.D7], Microsoft.Xna.Framework.Input.Keys);
                this.unitsPreGame = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.spellsPreGame = new (System.Collections.Generic.List$1(System.String)).ctor();
                this._screenWidth = 800;
                this._screenHeight = 480;
                this.scaleX = 1.0;
                this.scaleY = 1.0;
                this.listeningKeys = System.Array.init([Microsoft.Xna.Framework.Input.Keys.Enter, Microsoft.Xna.Framework.Input.Keys.Escape, Microsoft.Xna.Framework.Input.Keys.Left, Microsoft.Xna.Framework.Input.Keys.Right, Microsoft.Xna.Framework.Input.Keys.D1, Microsoft.Xna.Framework.Input.Keys.D2, Microsoft.Xna.Framework.Input.Keys.D3, Microsoft.Xna.Framework.Input.Keys.D4, Microsoft.Xna.Framework.Input.Keys.D5, Microsoft.Xna.Framework.Input.Keys.D6, Microsoft.Xna.Framework.Input.Keys.D7], Microsoft.Xna.Framework.Input.Keys);
                this.prgsProduction = System.Array.init(7, null, MonoInterface.Progress);
                this.btnsProduction = System.Array.init(7, null, MonoInterface.Button);
                this.lblsBasicParams = System.Array.init(3, null, MonoInterface.Label);
                this.lblsAbils = System.Array.init(6, null, MonoInterface.LongLabel);
            },
            ctor: function (platform) {
                this.$initialize();
                System.Object.call(this);
                this.Platform = platform;
                this.Fonts = new (System.Collections.Generic.List$1(System.ValueTuple$2(System.Int32,Microsoft.Xna.Framework.Graphics.SpriteFont))).ctor();
            }
        },
        methods: {
            LoadData: function (content) {
                System.Console.WriteLine("Start Localize");
                this.ReadLocalize();
                System.Console.WriteLine("Start Loading");

                this.ReadFonts(content);
                this.ReadSprites(content);
                this.ReadUnitsParams();
                this.ReadSpells();
                this.ReadRaces();

                System.Console.WriteLine("Start Initializing");

                this.Initialize();
            },
            LoadJSON: function (T, fname) {
                var file_reader = new System.IO.StreamReader.$ctor9(System.String.format("{0}/{1}", this.DataFolder, fname), System.Text.Encoding.UTF8);
                try {
                    var json = file_reader.ReadToEnd();
                    return Newtonsoft.Json.JsonConvert.DeserializeObject(json, T);
                }
                finally {
                    if (Bridge.hasValue(file_reader)) {
                        file_reader.System$IDisposable$Dispose();
                    }
                }
            },
            ReadFonts: function (content) {
                var $t;
                var fonts = this.LoadJSON(System.Array.type(System.String), "fonts.json");
                $t = Bridge.getEnumerator(fonts);
                try {
                    while ($t.moveNext()) {
                        var filename = $t.Current;
                        this.Fonts.add(new (System.ValueTuple$2(System.Int32,Microsoft.Xna.Framework.Graphics.SpriteFont)).$ctor1(System.Int32.parse(filename.substr(3)), content.Load(Microsoft.Xna.Framework.Graphics.SpriteFont, System.String.format("Fonts/{0}", [filename]))));
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                //#endif
            },
            ReadRaces: function () {
                var $t;
                var races_def = this.LoadJSON(System.Array.type(DarkKingdomCore.Race), "races.json");
                $t = Bridge.getEnumerator(races_def);
                try {
                    while ($t.moveNext()) {
                        var race = $t.Current;
                        DarkKingdomCore.RaceManager.Instance.All.add(race.name, race);
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            },
            ReadSpells: function () {
                var $t;
                var spells_def = this.LoadJSON(System.Array.type(DarkKingdomCore.Spell), "spells.json");
                $t = Bridge.getEnumerator(spells_def);
                try {
                    while ($t.moveNext()) {
                        var spell = $t.Current;
                        this.spells.add(spell.Name, spell);
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            },
            ReadUnitsParams: function () {
                var $t, $t1, $t2;
                var units_def = this.LoadJSON(System.Array.type(DarkKingdomCore.UnitParameters), "units.json");
                $t = Bridge.getEnumerator(units_def);
                try {
                    while ($t.moveNext()) {
                        var unit = $t.Current.$clone();
                        var new_unit = unit.$clone();
                        new_unit.spriteName = unit.Name.toLowerCase();
                        new_unit.animated = DarkKingdomCore.MyGame.sprites.getItem(unit.Name.toLowerCase()).Ranges.containsKey("Attack");
                        new_unit.iconApp = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("unit_icons"), new_unit.iconInd);
                        new_unit.abils = new (System.Collections.Generic.Dictionary$2(System.String,DarkKingdomCore.Ability)).ctor();
                        if (new_unit.rawAbils != null) {
                            $t1 = Bridge.getEnumerator(new_unit.rawAbils);
                            try {
                                while ($t1.moveNext()) {
                                    var abil = $t1.Current;
                                    new_unit.abils.add(abil.name, abil);
                                }
                            } finally {
                                if (Bridge.is($t1, System.IDisposable)) {
                                    $t1.System$IDisposable$Dispose();
                                }
                            }
                        }
                        if (unit.size.w > 0) {
                            new_unit.rect = new Microsoft.Xna.Framework.Rectangle.$ctor2(((Bridge.Int.div(((-unit.size.w) | 0), 2)) | 0), ((-unit.size.h) | 0), unit.size.w, unit.size.h);
                        } else {
                            new_unit.rect = new Microsoft.Xna.Framework.Rectangle.$ctor2(((-this.us2) | 0), ((-this.unitSize) | 0), this.unitSize, this.unitSize);
                        }
                        new_unit.isBuilding = new_unit.abils.containsKey("Building");
                        if (new_unit.abils.containsKey("Unique") || new_unit.abils.containsKey("Heroic")) {
                            new_unit.maxLimit = 1;
                        } else if (new_unit.abils.containsKey("Elite")) {
                            new_unit.maxLimit = 3;
                        }
                        new_unit.isHeroic = new_unit.abils.containsKey("Heroic");
                        if (new_unit.abils.containsKey("Huge")) {
                            new_unit.moveType = DarkKingdomCore.UnitMoveType.HugeMT;
                        } else if (new_unit.abils.containsKey("Flying")) {
                            new_unit.moveType = DarkKingdomCore.UnitMoveType.FlyingMT;
                        } else {
                            new_unit.moveType = DarkKingdomCore.UnitMoveType.GroundMT;
                        }
                        var remAbils = System.Array.init(["Heroic", "Unique", "Elite", "Flying", "Huge", ""], System.String);
                        $t2 = Bridge.getEnumerator(remAbils);
                        try {
                            while ($t2.moveNext()) {
                                var ab = $t2.Current;
                                if (new_unit.abils.containsKey(ab)) {
                                    new_unit.abils.remove(ab);
                                }
                            }
                        } finally {
                            if (Bridge.is($t2, System.IDisposable)) {
                                $t2.System$IDisposable$Dispose();
                            }
                        }
                        if (unit.isStartBuilding) {
                            this.startBuildingsList.add(unit.Name);
                        }
                        DarkKingdomCore.MyGame.unitPrms.add(unit.Name, new_unit.$clone());
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            },
            ReadSprites: function (content) {
                var $t;
                var sprites_def = this.LoadJSON(System.Array.type(MonoInterface.Sprite), "sprites.json");
                $t = Bridge.getEnumerator(sprites_def);
                try {
                    while ($t.moveNext()) {
                        var sprite = $t.Current;
                        sprite.Texture = content.Load(Microsoft.Xna.Framework.Graphics.Texture2D, System.String.format("Sprites/{0}", [sprite.Name]));
                        System.Console.WriteLine(System.String.format("Sprite '{0}' loaded", [sprite.Name]));
                        DarkKingdomCore.MyGame.sprites.add(sprite.Name, sprite);
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            },
            ReadLocalize: function () {
                var $t;
                var loaded = this.LoadJSON(System.Collections.Generic.Dictionary$2(System.String,System.String), "localize-ru.json");
                var result = new (System.Collections.Generic.Dictionary$2(System.String,System.String)).ctor();
                $t = Bridge.getEnumerator(loaded);
                try {
                    while ($t.moveNext()) {
                        var kvp = $t.Current;
                        var is_fallback = System.String.contains(kvp.value,"\ufffd");
                        result.add(kvp.key, System.String.replaceAll(kvp.value, String.fromCharCode(65533), String.fromCharCode(63)));
                        if (is_fallback) {
                            System.Console.WriteLine(kvp.value);
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                this.localize = new MonoInterface.Localization("\u0420\u0443\u0441\u0441\u043a\u0438\u0439", result);
            },
            Explode: function (u, ignoreArmor) {
                var $t, $t1;
                var bonus = 1;
                $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                try {
                    while ($t.moveNext()) {
                        var uu = $t.Current;
                        if (uu.AbsContains("Explode_bonus")) {
                            bonus = Bridge.Int.mul(bonus, 3);
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                $t1 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                try {
                    while ($t1.moveNext()) {
                        var uu1 = $t1.Current;
                        if (u.Near(uu1)) {
                            if (!uu1.AbsContains("Explode_protect")) {
                                this.Harm(uu1, Bridge.Int.mul(DarkKingdomCore.MyGame.rnd.Next$2(70, 101), bonus), ignoreArmor, DarkKingdomCore.EffectType.Normal);
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t1, System.IDisposable)) {
                        $t1.System$IDisposable$Dispose();
                    }
                }
                if (ignoreArmor) {
                    DarkKingdomCore.MyGame.pars.add(new DarkKingdomCore.ImageParticle(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("explode"), 3), u.x - 25, ((((((DarkKingdomCore.MyGame.hor + u.parameters.rect.Bottom) | 0) - this.us2) | 0) - 25) | 0), 0, 0, 20));
                } else {
                    DarkKingdomCore.MyGame.pars.add(new DarkKingdomCore.ImageParticle(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("explode"), 0), u.x - 25, ((((((DarkKingdomCore.MyGame.hor + u.parameters.rect.Bottom) | 0) - this.us2) | 0) - 25) | 0), 0, 0, 20));
                }
            },
            Heal: function (u, val, repair) {
                if (repair === void 0) { repair = false; }
                if (u.hp < u.parameters.maxhp && !u.AbsContains$1(["Bodyless", "Nonhealing_wounds", "Building"]) && (!u.AbsContains("Machinery") || repair)) {
                    var realval = Math.min(val, u.parameters.maxhp - u.hp);
                    u.hp += realval;
                    this.ShowInfoPar(System.String.format("+{0}", [realval]), DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), false);
                    if (!repair && u.AbsContains("Life_rollback")) {
                        u.Attack = DarkKingdomCore.Attack.op_Addition$1(u.Attack.$clone(), (u.abils.getItem("Life_rollback").value) | 0);
                    }
                }
            },
            Harm: function (u, val, ignorearmor, dt) {
                var $t;
                if (!u.AbsContains("Invulnerable")) {
                    if (!ignorearmor) {
                        val *= u.parameters._armor;
                    }
                    if (val < 1) {
                        val = 1;
                    }
                    u.hp -= val;
                    switch (dt) {
                        case DarkKingdomCore.EffectType.Normal: 
                            {
                                this.ShowInfoPar("-" + (System.Single.format(val) || ""), Microsoft.Xna.Framework.Color.Red.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), false);
                                break;
                            }
                        case DarkKingdomCore.EffectType.Bad: 
                            {
                                this.ShowInfoPar("-" + (System.Single.format(val) || ""), DarkKingdomCore.MyGame.badAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), false);
                                break;
                            }
                        case DarkKingdomCore.EffectType.Poison: 
                            {
                                this.ShowInfoPar("-" + (System.Single.format(val) || ""), DarkKingdomCore.MyGame.poiAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), false);
                                break;
                            }
                    }
                    if (u.AbsContains("Invisible")) {
                        this.Deinvisible(u);
                    }
                    $t = Bridge.getEnumerator(u.abils.Values);
                    try {
                        while ($t.moveNext()) {
                            var a = $t.Current;
                            if (Bridge.referenceEquals(a.condition, "On_harm") && !a.used) {
                                a.condCompleted = true;
                            }
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                    if (u.AbsContains("Damage_mirror") && DarkKingdomCore.MyGame.plrs[((1 - u.owner) | 0)].heroUnit != null) {
                        this.Harm(DarkKingdomCore.MyGame.plrs[((1 - u.owner) | 0)].heroUnit, val, true, DarkKingdomCore.EffectType.Bad);
                    }
                } else {
                    this.ShowInfoPar("0", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), false);
                }
            },
            Deinvisible: function (u) {
                u.abils.getItem("Invisible").used = true;
                DarkKingdomCore.MyGame.pars.add(new DarkKingdomCore.ImageParticle(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("explode"), 2), u.x - 25, ((((((DarkKingdomCore.MyGame.hor + u.parameters.rect.Bottom) | 0) - this.us2) | 0) - 25) | 0), 0, 0, 20));
            },
            SetPlayers: function () {
                DarkKingdomCore.MyGame.plrs[0] = new DarkKingdomCore.Player(this, 0, false, 30);
                DarkKingdomCore.MyGame.plrs[1] = new DarkKingdomCore.Player(this, 1, true, 30);

                DarkKingdomCore.MyGame.plrs[0].moveside = 1;
                DarkKingdomCore.MyGame.plrs[1].moveside = -1;
            },
            UpdateQueue: function () {
                for (var i = 0; i <= 6; i = (i + 1) | 0) {
                    var btn = this.btnsProduction[i];
                    if (i < DarkKingdomCore.MyGame.plrs[0].readyUnits.Count) {
                        btn.Visible = true;
                        (Bridge.as(btn.Children.getItem(0), MonoInterface.Picture)).spriteRef = DarkKingdomCore.MyGame.unitPrms.getItem(DarkKingdomCore.MyGame.plrs[0].readyUnits.getItem(i)).$clone().iconApp.$clone();
                        btn.Children.getItem(1).Visible = true;
                        this.prgsProduction[i].CurrentValue = 0;
                    } else if (((i - DarkKingdomCore.MyGame.plrs[0].readyUnits.Count) | 0) < DarkKingdomCore.MyGame.plrs[0].prdQ.Count) {
                        btn.Visible = true;
                        btn.Children.getItem(1).Visible = false;
                        (Bridge.as(btn.Children.getItem(0), MonoInterface.Picture)).spriteRef = DarkKingdomCore.MyGame.unitPrms.getItem(DarkKingdomCore.MyGame.plrs[0].prdQ.getItem(((i - DarkKingdomCore.MyGame.plrs[0].readyUnits.Count) | 0))).$clone().iconApp.$clone();
                        if (i === DarkKingdomCore.MyGame.plrs[0].readyUnits.Count) {
                            this.prgsProduction[i].CurrentValue = DarkKingdomCore.MyGame.plrs[0].prdPrg;
                            this.prgsProduction[i].MaxValue = DarkKingdomCore.MyGame.unitPrms.getItem(DarkKingdomCore.MyGame.plrs[0].prdQ.getItem(0)).$clone().Cost.Time;
                        } else {
                            this.prgsProduction[i].CurrentValue = 0;
                        }
                    } else {
                        btn.Visible = false;
                    }
                }
                if (DarkKingdomCore.MyGame.plrs[0].prdQ.Count === 0 && DarkKingdomCore.MyGame.plrs[0].readyUnits.Count === 0) {
                    this.frmProduction.Hide(this.mainAnimator);
                } else {
                    this.frmProduction.Show(this.mainAnimator);
                }
            },
            UpdateResources: function () {
                this.lblGoldFrmResources.Text = Bridge.toString(this.curM);
                this.lblDeathFrmResources.Text = Bridge.toString(this.curD);

                for (var i = 0; i < DarkKingdomCore.MyGame.plrs[0].unitsList.Count; i = (i + 1) | 0) {
                    (Bridge.as(this.cUnits.Children.getItem(i), MonoInterface.Button)).IsDisabled = !DarkKingdomCore.MyGame.plrs[0].CheckForProduce(DarkKingdomCore.MyGame.plrs[0].unitsList.getItem(i));
                }

                var tier = DarkKingdomCore.MyGame.plrs[0].res.Tier === 1 ? "Tier_2" : "Tier_3";
                this.btnTierUpFrmResources.IsDisabled = !DarkKingdomCore.MyGame.plrs[0].res.EnoughFor(DarkKingdomCore.MyGame.unitPrms.getItem(tier).$clone().Cost.$clone()) || DarkKingdomCore.MyGame.plrs[0].prdQ.contains(tier) || DarkKingdomCore.MyGame.plrs[0].res.Tier === 3;

                for (var i1 = 0; i1 < DarkKingdomCore.MyGame.plrs[0].spllsList.Count; i1 = (i1 + 1) | 0) {
                    (Bridge.as(this.cSpells.Children.getItem(i1), MonoInterface.Button)).IsDisabled = !DarkKingdomCore.MyGame.plrs[0].res.EnoughFor(this.spells.getItem(DarkKingdomCore.MyGame.plrs[0].spllsList.getItem(i1)).Cost.$clone());
                }
            },
            OnDead: function (u) {
                var $t, $t1, $t2, $t3, $t4, $t5, $t6, $t7, $t8, $t9, $t10, $t11, $t12;
                $t = Bridge.getEnumerator(u.abils.Values);
                try {
                    while ($t.moveNext()) {
                        var a = $t.Current;
                        if (Bridge.referenceEquals(a.condition, "On_death")) {
                            a.condCompleted = true;
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                this.OnUnitsAbils(u);
                if (!u.parameters.isBuilding) {
                    var needInfo;
                    $t1 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                    try {
                        while ($t1.moveNext()) {
                            var uu = $t1.Current;
                            needInfo = false;
                            if (!Bridge.referenceEquals(uu, u)) {
                                if (uu.AbsContains("Death_reaper")) {
                                    uu.Attack = DarkKingdomCore.Attack.op_Addition$1(uu.Attack.$clone(), (uu.abils.getItem("Death_reaper").value) | 0);
                                    needInfo = true;
                                }
                                $t2 = Bridge.getEnumerator(uu.abils.Values);
                                try {
                                    while ($t2.moveNext()) {
                                        var a1 = $t2.Current;
                                        if (Bridge.referenceEquals(a1.condition, "Death")) {
                                            a1.condnum = (a1.condnum - 1) | 0;
                                            if (a1.condnum === 0) {
                                                a1.condition = "";
                                                a1.condCompleted = true;
                                            }
                                            needInfo = true;
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t2, System.IDisposable)) {
                                        $t2.System$IDisposable$Dispose();
                                    }
                                }
                                if (uu.AbsContains("Spawn_ghosts") && !u.AbsContains("Bodyless")) {
                                    var allunitst = new (System.Collections.Generic.List$1(System.String)).ctor();
                                    var nu;
                                    $t3 = Bridge.getEnumerator(DarkKingdomCore.MyGame.unitPrms.Values);
                                    try {
                                        while ($t3.moveNext()) {
                                            var up = $t3.Current.$clone();
                                            if (!up.special) {
                                                if (up.AbsContains("Bodyless") && up.Cost.Tier === u.parameters.Cost.Tier && DarkKingdomCore.MyGame.plrs[uu.owner].CheckForLimit(up.Name)) {
                                                    allunitst.add(up.Name);
                                                }
                                            }
                                        }
                                    } finally {
                                        if (Bridge.is($t3, System.IDisposable)) {
                                            $t3.System$IDisposable$Dispose();
                                        }
                                    }
                                    if (allunitst.Count > 0) {
                                        nu = ($t4 = new DarkKingdomCore.Unit(this, uu.x + uu.moveside, uu.moveside, uu.owner, DarkKingdomCore.MyGame.unitPrms.getItem(allunitst.getItem(DarkKingdomCore.MyGame.rnd.Next$2(0, allunitst.Count))).$clone()), $t4.hp = DarkKingdomCore.MyGame.rnd.Next$2(70, 101), $t4);
                                        this.Harm(uu, nu.hp, true, DarkKingdomCore.EffectType.Bad);
                                        this.bornList.add(nu);
                                        needInfo = true;
                                    }
                                }
                                if (needInfo) {
                                    this.ShowInfoPar("\u0421\u043c\u0435\u0440\u0442\u044c!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), uu.x, ((DarkKingdomCore.MyGame.hor + uu.parameters.rect.Top) | 0), true);
                                }
                            }
                            if (uu.owner !== u.owner && uu.AbsContains("Looter") && u.Near(uu)) {
                                DarkKingdomCore.MyGame.plrs[uu.owner].Resources = DarkKingdomCore.TimeCost.op_Addition(DarkKingdomCore.MyGame.plrs[uu.owner].Resources.$clone(), new DarkKingdomCore.TimeCost.$ctor1(uu.abils.getItem("Looter").value, 0, 0, 0));
                                this.ShowInfoPar(System.String.format("+{0}", [uu.abils.getItem("Looter").value]), this.moneyClr.$clone(), uu.x, ((DarkKingdomCore.MyGame.hor + uu.parameters.rect.Top) | 0), true);
                            }
                            if (uu.owner !== u.owner && uu.AbsContains("Invisible_on_kill") && u.Near(uu)) {
                                uu.AddAbility$1("Invisible", DarkKingdomCore.EffectType.Normal);
                                this.ShowInfoPar("\u0418\u0441\u0447\u0435\u0437!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), uu.x, ((DarkKingdomCore.MyGame.hor + uu.parameters.rect.Top) | 0), true);
                            }
                            if (u.owner !== uu.owner && uu.AbsContains("Necromancy") && !u.AbsContains$1(["Undead", "Machinery"])) {
                                this.bornList.add(new DarkKingdomCore.Unit(this, u.x, uu.moveside, uu.owner, DarkKingdomCore.MyGame.unitPrms.getItem("Skeleton_squad").$clone()));
                                this.ShowInfoPar("\u041e\u0436\u0438\u0432\u043b\u0435\u043d!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                            }
                            if (u.deathFromPoison && uu.AbsContains("Flizard spawner")) {
                                this.bornList.add(new DarkKingdomCore.Unit(this, uu.x, uu.moveside, uu.owner, DarkKingdomCore.MyGame.unitPrms.getItem("Flizard").$clone()));
                                this.ShowInfoPar("\u041f\u043e\u0440\u043e\u0436\u0434\u0435\u043d!", DarkKingdomCore.MyGame.poiAbilClr.$clone(), uu.x, ((DarkKingdomCore.MyGame.hor + uu.parameters.rect.Top) | 0), true);
                            }
                            if (uu.owner !== u.owner && uu.AbsContains("Corpseeating") && u.Near(uu)) {
                                if (uu.hp < uu.parameters.maxhp) {
                                    this.Heal(uu, uu.parameters.maxhp - uu.hp);
                                }
                                if (uu.AbsContains("Devour")) {
                                    if (uu.abils.containsKey("Denying")) {
                                        uu.abils.getItem("Denying").value = (uu.abils.getItem("Denying").value + 50) | 0;
                                    }
                                }
                                this.ShowInfoPar("\u041e\u0431\u0435\u0434!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), uu.x, ((DarkKingdomCore.MyGame.hor + uu.parameters.rect.Top) | 0), true);
                            }
                            if (uu.AbsContains("Execution") && u.Near(uu)) {
                                ($t4 = DarkKingdomCore.MyGame.plrs[uu.owner]).victimcount = ($t4.victimcount + 1) | 0;
                                if (DarkKingdomCore.MyGame.plrs[uu.owner].victimcount >= 13) {
                                    var avunits = new (System.Collections.Generic.List$1(System.String)).ctor();
                                    $t5 = Bridge.getEnumerator(DarkKingdomCore.MyGame.unitPrms.Values);
                                    try {
                                        while ($t5.moveNext()) {
                                            var upstr = $t5.Current.$clone();
                                            if (Bridge.referenceEquals(upstr.Subrace, "Monster")) {
                                                avunits.add(upstr.Name);
                                            }
                                        }
                                    } finally {
                                        if (Bridge.is($t5, System.IDisposable)) {
                                            $t5.System$IDisposable$Dispose();
                                        }
                                    }
                                    this.bornList.add(new DarkKingdomCore.Unit(this, u.x, uu.moveside, uu.owner, DarkKingdomCore.MyGame.unitPrms.getItem(avunits.getItem(DarkKingdomCore.MyGame.rnd.Next$1(avunits.Count))).$clone()));
                                    ($t6 = DarkKingdomCore.MyGame.plrs[uu.owner]).victimcount = ($t6.victimcount - 13) | 0;
                                    this.ShowInfoPar("\u0412\u044b\u0437\u0432\u0430\u043d!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                                } else {
                                    this.ShowInfoPar(System.String.format("\u0415\u0449\u0435 {0}", [((13 - DarkKingdomCore.MyGame.plrs[uu.owner].victimcount) | 0)]), DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                                }
                            }
                        }
                    } finally {
                        if (Bridge.is($t1, System.IDisposable)) {
                            $t1.System$IDisposable$Dispose();
                        }
                    }
                }
                if (u.AbsContains("Victim")) {
                    ($t7 = DarkKingdomCore.MyGame.plrs[u.owner]).victimcount = ($t7.victimcount + 1) | 0;
                    if (DarkKingdomCore.MyGame.plrs[u.owner].victimcount >= 13) {
                        var avunits1 = new (System.Collections.Generic.List$1(System.String)).ctor();
                        $t8 = Bridge.getEnumerator(DarkKingdomCore.MyGame.unitPrms.Values);
                        try {
                            while ($t8.moveNext()) {
                                var upstr1 = $t8.Current.$clone();
                                if (Bridge.referenceEquals(upstr1.Subrace, "Monster")) {
                                    avunits1.add(upstr1.Name);
                                }
                            }
                        } finally {
                            if (Bridge.is($t8, System.IDisposable)) {
                                $t8.System$IDisposable$Dispose();
                            }
                        }
                        this.bornList.add(new DarkKingdomCore.Unit(this, u.x, u.moveside, u.owner, DarkKingdomCore.MyGame.unitPrms.getItem(avunits1.getItem(DarkKingdomCore.MyGame.rnd.Next$1(avunits1.Count))).$clone()));
                        ($t9 = DarkKingdomCore.MyGame.plrs[u.owner]).victimcount = ($t9.victimcount - 13) | 0;
                        this.ShowInfoPar("\u0412\u044b\u0437\u0432\u0430\u043d!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                    } else {
                        this.ShowInfoPar(System.String.format("\u0415\u0449\u0435 {0}", [((13 - DarkKingdomCore.MyGame.plrs[u.owner].victimcount) | 0)]), DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                    }
                }
                if (u.AbsContains("Immortal") && DarkKingdomCore.MyGame.plrs[u.owner].res.Death >= 5) {
                    ($t10 = DarkKingdomCore.MyGame.plrs[u.owner].res.$clone()).Death = ($t10.Death - 5) | 0;
                    u.hp = u.parameters.maxhp;
                    this.ShowInfoPar("\u0418\u043d\u043a\u0430\u0440\u043d\u0430\u0446\u0438\u044f", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                    return false;
                }
                if (u.AbsContains("Incarnation") && DarkKingdomCore.MyGame.rnd.Next$1(100) < 25) {
                    u.hp = u.parameters.maxhp;
                    this.ShowInfoPar("\u0418\u043d\u043a\u0430\u0440\u043d\u0430\u0446\u0438\u044f", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                    return false;
                }
                if (u.AbsContains("Unterminate")) {
                    u.abils.getItem("Unterminate").used = true;
                    u.hp = 1;
                    u.AddAbility$2("Invulnerable", 400, DarkKingdomCore.EffectType.Good);
                    return false;
                }
                if (!u.AbsContains("Bodyless")) {
                    var ltime = 7200;
                    if (u.parameters.isBuilding) {
                        ltime = -1;
                    }
                    DarkKingdomCore.MyGame.pars.add(new DarkKingdomCore.ImageParticle(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem(u.parameters.spriteName), DarkKingdomCore.MyGame.sprites.getItem(u.parameters.spriteName).Ranges.getItem("Corpse").$clone().Item2), u.x + u.parameters.imgx - this.us2, ((((((DarkKingdomCore.MyGame.hor + u.parameters.rect.Bottom) | 0) - 30) | 0) + 2) | 0), 0, 5, ltime, u.moveside === -1));
                }
                var val;
                if (u.parameters.Cost.Money < 50) {
                    val = 1;
                } else if (u.parameters.Cost.Money < 150) {
                    val = 2;
                } else if (u.parameters.Cost.Money < 250) {
                    val = 5;
                } else {
                    val = 10;
                }
                if (u.owner === 1) {
                    ($t11 = DarkKingdomCore.MyGame.plrs[0].res.$clone()).Death = ($t11.Death + val) | 0;
                    this.ShowInfoPar("+" + val, this.deathClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                } else if (u.owner === 0) {
                    ($t12 = DarkKingdomCore.MyGame.plrs[1].res.$clone()).Death = ($t12.Death + val) | 0;
                }
                if (Bridge.referenceEquals(u, this.selU)) {
                    this.selU = null;
                }
                return true;
            },
            RandomizeUnits: function (ucnt, uList, specialhero) {
                var $t, $t1;
                var unts = new (System.Collections.Generic.List$1(System.String)).ctor();
                if (ucnt > 0) {
                    var allunitst1 = new (System.Collections.Generic.List$1(System.String)).ctor();
                    var allunitst2 = new (System.Collections.Generic.List$1(System.String)).ctor();
                    var allunitst3 = new (System.Collections.Generic.List$1(System.String)).ctor();
                    var allunitscount = 0;

                    var allunits = new (System.Collections.Generic.List$1(System.String)).ctor();
                    var herounits = new (System.Collections.Generic.List$1(System.String)).ctor();

                    var t1cnt, t2cnt, t3cnt;
                    var u;


                    $t = Bridge.getEnumerator(uList);
                    try {
                        while ($t.moveNext()) {
                            var up = $t.Current;
                            if (specialhero) {
                                if (DarkKingdomCore.MyGame.unitPrms.getItem(up).$clone().isHeroic) {
                                    herounits.add(up);
                                } else {
                                    allunits.add(up);
                                }
                            } else {
                                allunits.add(up);
                            }
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }

                    if (specialhero && herounits.Count > 0) {
                        unts.add(herounits.getItem(DarkKingdomCore.MyGame.rnd.Next$1(herounits.Count)));
                        ucnt = (ucnt - 1) | 0;
                    }

                    $t1 = Bridge.getEnumerator(allunits);
                    try {
                        while ($t1.moveNext()) {
                            var up1 = $t1.Current;
                            switch (DarkKingdomCore.MyGame.unitPrms.getItem(up1).$clone().Cost.Tier) {
                                case 1: 
                                    {
                                        allunitst1.add(up1);
                                        break;
                                    }
                                case 2: 
                                    {
                                        allunitst2.add(up1);
                                        break;
                                    }
                                case 3: 
                                    {
                                        allunitst3.add(up1);
                                        break;
                                    }
                            }
                            allunitscount = (allunitscount + 1) | 0;
                        }
                    } finally {
                        if (Bridge.is($t1, System.IDisposable)) {
                            $t1.System$IDisposable$Dispose();
                        }
                    }

                    if (allunitscount < ucnt) {
                        ucnt = allunitscount;
                    }

                    t3cnt = 1;
                    t2cnt = (Bridge.Int.div((((ucnt - t3cnt) | 0)), 2)) | 0;
                    t1cnt = (((ucnt - t2cnt) | 0) - t3cnt) | 0;

                    if (t1cnt === 0 && t2cnt === 0 && allunitst2.Count > 0) {
                        t2cnt = 1;
                    }


                    while (t3cnt > 0 && allunitst3.Count > 0) {
                        u = DarkKingdomCore.MyGame.rnd.Next$1(allunitst3.Count);
                        unts.add(allunitst3.getItem(u));
                        allunitst3.removeAt(u);
                        t3cnt = (t3cnt - 1) | 0;
                    }

                    t1cnt = (t1cnt + t3cnt) | 0;

                    while (t1cnt > 0 && allunitst1.Count > 0) {
                        u = DarkKingdomCore.MyGame.rnd.Next$1(allunitst1.Count);
                        unts.add(allunitst1.getItem(u));
                        allunitst1.removeAt(u);
                        t1cnt = (t1cnt - 1) | 0;
                    }

                    t2cnt = (t2cnt + t1cnt) | 0;

                    while (t2cnt > 0 && allunitst2.Count > 0) {
                        u = DarkKingdomCore.MyGame.rnd.Next$1(allunitst2.Count);
                        unts.add(allunitst2.getItem(u));
                        allunitst2.removeAt(u);
                        t2cnt = (t2cnt - 1) | 0;
                    }
                    unts = this.SortUnitsLists(unts);
                }

                return unts;
            },
            RandomizeSpells: function (sCnt, sList) {
                var $t;
                var splls = new (System.Collections.Generic.List$1(System.String)).ctor();
                if (sCnt > 0) {
                    var spellst1 = new (System.Collections.Generic.List$1(System.String)).ctor();
                    var spellst2 = new (System.Collections.Generic.List$1(System.String)).ctor();
                    var spellst3 = new (System.Collections.Generic.List$1(System.String)).ctor();


                    var t1cnt, t2cnt, t3cnt;
                    var u;

                    $t = Bridge.getEnumerator(sList);
                    try {
                        while ($t.moveNext()) {
                            var sp = $t.Current;
                            switch (this.spells.getItem(sp).Cost.Tier) {
                                case 1: 
                                    {
                                        spellst1.add(sp);
                                        break;
                                    }
                                case 2: 
                                    {
                                        spellst2.add(sp);
                                        break;
                                    }
                                case 3: 
                                    {
                                        spellst3.add(sp);
                                        break;
                                    }
                            }
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }

                    t3cnt = (Bridge.Int.div(sCnt, 3)) | 0;
                    t2cnt = (Bridge.Int.div(sCnt, 3)) | 0;
                    t1cnt = (((sCnt - t2cnt) | 0) - t3cnt) | 0;


                    while (t1cnt > 0 && spellst1.Count > 0) {
                        u = DarkKingdomCore.MyGame.rnd.Next$1(spellst1.Count);
                        splls.add(spellst1.getItem(u));
                        spellst1.removeAt(u);
                        t1cnt = (t1cnt - 1) | 0;
                    }

                    t2cnt = (t2cnt + t1cnt) | 0;

                    while (t2cnt > 0 && spellst2.Count > 0) {
                        u = DarkKingdomCore.MyGame.rnd.Next$1(spellst2.Count);
                        splls.add(spellst2.getItem(u));
                        spellst2.removeAt(u);
                        t2cnt = (t2cnt - 1) | 0;
                    }

                    t3cnt = (t3cnt + t2cnt) | 0;

                    while (t3cnt > 0 && spellst3.Count > 0) {
                        u = DarkKingdomCore.MyGame.rnd.Next$1(spellst3.Count);
                        splls.add(spellst3.getItem(u));
                        spellst3.removeAt(u);
                        t3cnt = (t3cnt - 1) | 0;
                    }

                    splls = this.SortSpellsLists(splls);
                }

                return splls;
            },
            RandomizeBuildings: function (bCnt, bList) {
                var buildings = new (System.Collections.Generic.List$1(System.String)).ctor();

                if (bCnt > 0) {
                    var tmpBldList = new (System.Collections.Generic.List$1(System.String)).ctor();
                    tmpBldList.AddRange(bList);
                    var r;
                    while (bCnt > 0 && tmpBldList.Count > 0) {
                        r = DarkKingdomCore.MyGame.rnd.Next$1(tmpBldList.Count);
                        buildings.add(tmpBldList.getItem(r));
                        tmpBldList.removeAt(r);
                        bCnt = (bCnt - 1) | 0;
                    }
                }

                return buildings;
            },
            btnSpell_Clicked: function (btn, isTouch) {
                var ind = this.cSpells.Children.indexOf(btn);
                if ((DarkKingdomCore.MyGame.plrs[0].spellsRchrg.getItem(ind) === 0)) {
                    if (this.spells.getItem(DarkKingdomCore.MyGame.plrs[0].spllsList.getItem(ind)).Target === DarkKingdomCore.Spell.TargetType.Unit) {
                        this.inSpellMode = true;
                        this.spellName = DarkKingdomCore.MyGame.plrs[0].spllsList.getItem(ind);
                    } else {
                        this.DoGlobalSpells(DarkKingdomCore.MyGame.plrs[0].spllsList.getItem(ind));
                    }
                }
            },
            btnSpell_Focused: function (btn, isTouch) {
                var ind = this.cSpells.Children.indexOf(btn);
                var spl = this.spells.getItem(DarkKingdomCore.MyGame.plrs[0].spllsList.getItem(ind));
                this.ShowMoreInfo(spl.Cost.$clone(), true, Bridge.getDefaultValue(Microsoft.Xna.Framework.Point), [this.localize.GetString(spl.Name), this.localize.GetString$1(spl.School, [spl.Cost.Tier]), spl.Description]);
            },
            SetSpells: function () {
                if (DarkKingdomCore.MyGame.plrs[0].spllsList.Count > 0) {
                    this.cSpells.Children.clear();
                    var d = 0;
                    var oldt = this.spells.getItem(DarkKingdomCore.MyGame.plrs[0].spllsList.getItem(0)).Cost.Tier;
                    for (var i = 0; i < DarkKingdomCore.MyGame.plrs[0].spllsList.Count; i = (i + 1) | 0) {
                        if (this.spells.getItem(DarkKingdomCore.MyGame.plrs[0].spllsList.getItem(i)).Cost.Tier !== oldt) {
                            d = (d + 7) | 0;
                            oldt = this.spells.getItem(DarkKingdomCore.MyGame.plrs[0].spllsList.getItem(i)).Cost.Tier;
                        }

                        var btn = this.cSpells.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor1(Bridge.fn.cacheBind(this, this.btnSpell_Clicked), Bridge.fn.cacheBind(this, this.btnSpell_Focused), this.numKeys[i], ((Bridge.Int.mul(i, 70) + d) | 0), 0, 60, 60, 0.0, 0.5, true));
                        btn.AddChild(MonoInterface.Picture, new MonoInterface.Picture(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("spells_icons"), this.spells.getItem(DarkKingdomCore.MyGame.plrs[0].spllsList.getItem(i)).Img), 0, 0, 60, 60, 0.5, 0.5, true));
                        btn.AddChild(MonoInterface.Progress, new MonoInterface.Progress(0, 0, 0, 0, 60, 60, 0));
                        DarkKingdomCore.MyGame.plrs[0].spellsRchrg.add(0);
                    }
                    this.cSpells.ApplyTheme(this.defaultTheme);
                    this.cSpells.W = System.Linq.Enumerable.from(this.cSpells.Children, MonoInterface.Block).last().FinalRight;
                    this.btnSelectSpells.IsDisabled = false;
                } else {
                    this.btnSelectSpells.IsDisabled = true;
                }
            },
            CreateAchievements: function () {
                this.achivs.add("Startpath", new DarkKingdomCore.Achievement("Startpath", new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("bonus_icons"), 3), "5crystals"));
                this.achivs.add("Alittleharder", new DarkKingdomCore.Achievement("Alittleharder", new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("medium_icons"), 11), "10crystals"));

                this.achivs.add("Gentleleader", new DarkKingdomCore.Achievement("Gentleleader", new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("bonus_icons"), 8), "25crystals"));


                // achivs.Add("Sacrifaceinbattle", New Achievement("Sacrifaceinbattle", New MonoInterface.Appearance(sprites["units_icons"], 113)))
                this.achivs.add("Truemage", new DarkKingdomCore.Achievement("Truemage", new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("bonus_icons"), 1), "25crystals"));

                this.achivs.add("Openeditor", new DarkKingdomCore.Achievement("Openeditor", new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("big_icons"), 2), "1unit"));
                this.achivs.add("Shamecheaters", new DarkKingdomCore.Achievement("Shamecheaters", new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("bonus_icons"), 7), "1unit"));

                this.achivs.add("Firstpurchase", new DarkKingdomCore.Achievement("Firstpurchase", new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("bonus_icons"), 0), "1unit"));
            },
            CreatePurchases: function () {
                this.purchases.add("Buster1T", new DarkKingdomCore.Purchase("Buster1T", new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("purchase_icons"), 2), 5));


                this.purchases.add("Buster2T", new DarkKingdomCore.Purchase("Buster2T", new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("purchase_icons"), 3), 10));


                this.purchases.add("Buster3T", new DarkKingdomCore.Purchase("Buster3T", new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("purchase_icons"), 1), 25));


                this.purchases.add("Herobuster", new DarkKingdomCore.Purchase("Herobuster", new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("purchase_icons"), 0), 25));
            },
            RotateCarousel: function (frm) {
                var trgPos = this.menuCarousel.indexOf(frm);
                if (trgPos > -1) {
                    if (trgPos > this.curCarouselPos) {
                        var frm2 = this.menuCarousel.getItem(this.curCarouselPos);
                        this.mainAnimator.AddChild(MonoInterface.NumberAnimation, new MonoInterface.NumberAnimation("X", 0, -400, -50, void 0, function () {
                            frm2.Visible = false;
                        }, frm2)).Begin();
                        frm.Y = 0;
                        frm.Visible = true;
                        this.mainAnimator.AddChild(MonoInterface.NumberAnimation, new MonoInterface.NumberAnimation("X", 400, 0, -50, void 0, void 0, frm)).Begin();
                    } else if (trgPos < this.curCarouselPos) {
                        var frm21 = this.menuCarousel.getItem(this.curCarouselPos);
                        this.mainAnimator.AddChild(MonoInterface.NumberAnimation, new MonoInterface.NumberAnimation("X", 0, 400, 50, void 0, function () {
                            frm21.Visible = false;
                        }, frm21)).Begin();
                        frm.Y = 0;
                        frm.Visible = true;
                        this.mainAnimator.AddChild(MonoInterface.NumberAnimation, new MonoInterface.NumberAnimation("X", -400, 0, 50, void 0, void 0, frm)).Begin();
                    } else {
                        frm.Visible = true;
                        if (frm.Y < 0) {
                            this.mainAnimator.AddChild(MonoInterface.NumberAnimation, new MonoInterface.NumberAnimation("Y", frm.Y, 0, 50, void 0, void 0, frm)).Begin();
                        } else {
                            if (frm.Y > 0) {
                                this.mainAnimator.AddChild(MonoInterface.NumberAnimation, new MonoInterface.NumberAnimation("Y", frm.Y, 0, -50, void 0, void 0, frm)).Begin();
                            }
                        }
                    }
                    this.curCarouselPos = trgPos;
                }
            },
            Initialize: function () {
                var $t, $t1;

                this.backFillTex = MonoInterface.Theme.SolidColorTexture(this.graphics.GraphicsDevice, 0, 0, 0, 150);

                DarkKingdomCore.MyGame.frmFillTex = MonoInterface.Theme.SolidColorTexture(this.graphics.GraphicsDevice, 190, 190, 190, 220);

                DarkKingdomCore.MyGame.btnFillTex = MonoInterface.Theme.SolidColorTexture(this.graphics.GraphicsDevice, 150, 150, 150);
                DarkKingdomCore.MyGame.btnSelectTex = MonoInterface.Theme.SolidColorTexture(this.graphics.GraphicsDevice, 200, 200, 200);
                DarkKingdomCore.MyGame.btnHlTex = MonoInterface.Theme.SolidColorTexture(this.graphics.GraphicsDevice, 220, 220, 220, 120);
                DarkKingdomCore.MyGame.btnPressedTex = MonoInterface.Theme.SolidColorTexture(this.graphics.GraphicsDevice, 220, 220, 220, 180);
                DarkKingdomCore.MyGame.btnDisabledTex = MonoInterface.Theme.SolidColorTexture(this.graphics.GraphicsDevice, 100, 100, 100, 200);

                DarkKingdomCore.MyGame.prgFillTex = MonoInterface.Theme.SolidColorTexture(this.graphics.GraphicsDevice, 220, 220, 220);
                DarkKingdomCore.MyGame.prgBarTex = MonoInterface.Theme.SolidColorTexture(this.graphics.GraphicsDevice, 140, 140, 140);



                this.starTex = MonoInterface.Theme.SolidColorTexture(this.graphics.GraphicsDevice, 255, 255, 255);


                this.healthBarBackTex = MonoInterface.Theme.SolidColorTexture(this.graphics.GraphicsDevice, 255, 255, 255, 180);
                this.healthBarLifeTex = MonoInterface.Theme.SolidColorTexture(this.graphics.GraphicsDevice, 255, 0, 0, 180);
                this.healthBarPoisonTex = MonoInterface.Theme.SolidColorTexture(this.graphics.GraphicsDevice, 0, 120, 0, 180);
                this.healthBarAbilTex = MonoInterface.Theme.SolidColorTexture(this.graphics.GraphicsDevice, 0, 0, 255, 180);


                DarkKingdomCore.MyGame.hor = (DarkKingdomCore.MyGame.gameHeight - 30) | 0;

                this.skyrect = new Microsoft.Xna.Framework.Rectangle.$ctor2(0, 0, DarkKingdomCore.MyGame.gameWidth, DarkKingdomCore.MyGame.hor);
                this.skytexture = new Microsoft.Xna.Framework.Graphics.Texture2D.ctor(this.graphics.GraphicsDevice, 1, DarkKingdomCore.MyGame.hor);
                this.sunsettexture = new Microsoft.Xna.Framework.Graphics.Texture2D.ctor(this.graphics.GraphicsDevice, 1, DarkKingdomCore.MyGame.hor);

                this.CreateAchievements();

                this.CreatePurchases();





                this.OrderRaces();

                this.CreateRaceList();

                this.conds.add(new DarkKingdomCore.MatchCondition.$ctor1("Easy", new DarkKingdomCore.TimeCost.$ctor1(1000, 20, 1, 0), new DarkKingdomCore.TimeCost.$ctor1(500, 10, 1, 0), 50, 25));
                this.conds.add(new DarkKingdomCore.MatchCondition.$ctor1("Medium", new DarkKingdomCore.TimeCost.$ctor1(500, 10, 1, 0), new DarkKingdomCore.TimeCost.$ctor1(500, 10, 1, 0), 50, 25));
                this.conds.add(new DarkKingdomCore.MatchCondition.$ctor1("Hard", new DarkKingdomCore.TimeCost.$ctor1(250, 0, 1, 0), new DarkKingdomCore.TimeCost.$ctor1(500, 10, 1, 0), 50, 25));

                $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.unitPrms.Values);
                try {
                    while ($t.moveNext()) {
                        var up = $t.Current.$clone();
                        if (!up.special) {
                            this.AllUntsList.add(up.Name);
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }

                var racescost = new (System.Collections.Generic.Dictionary$2(System.String,System.Int32)).ctor();
                var racei = 0;
                $t1 = Bridge.getEnumerator(DarkKingdomCore.RaceManager.Instance.All);
                try {
                    while ($t1.moveNext()) {
                        var rce = $t1.Current;
                        racescost.add(rce.key, Bridge.Int.mul(racei, 4000));
                        racei = (racei + 1) | 0;
                    }
                } finally {
                    if (Bridge.is($t1, System.IDisposable)) {
                        $t1.System$IDisposable$Dispose();
                    }
                }

                this.AllUntsList = System.Linq.Enumerable.from(this.AllUntsList, System.String).orderBy(function (unit) {
                        return ((((((DarkKingdomCore.MyGame.unitPrms.getItem(unit).$clone().Cost.Money + (DarkKingdomCore.MyGame.unitPrms.getItem(unit).$clone().support ? -500 : 0)) | 0) + Bridge.Int.mul(DarkKingdomCore.MyGame.unitPrms.getItem(unit).$clone().Cost.Tier, 1000)) | 0) + racescost.getItem(DarkKingdomCore.MyGame.unitPrms.getItem(unit).$clone().Race)) | 0);
                    }).toList(System.String);

                this.CreateInterface();

                this.menuCarousel = Bridge.fn.bind(this, function (_o1) {
                        _o1.add(this.frmBattle);
                        _o1.add(this.frmProfile);
                        return _o1;
                    })(new (System.Collections.Generic.List$1(MonoInterface.Frame)).ctor());

                this.starsCnt = 88;
                this.stars = System.Array.init(this.starsCnt, function (){
                    return new Microsoft.Xna.Framework.Vector2();
                }, Microsoft.Xna.Framework.Vector2);
                for (var i = 0; i < this.starsCnt; i = (i + 1) | 0) {
                    this.stars[i] = new Microsoft.Xna.Framework.Vector2.$ctor2(DarkKingdomCore.MyGame.rnd.Next$2(0, DarkKingdomCore.MyGame.gameWidth), 20 + DarkKingdomCore.MyGame.rnd.NextDouble() * (((DarkKingdomCore.MyGame.hor - 60) | 0)));
                }

                this.symbols[0] = new Microsoft.Xna.Framework.Rectangle.$ctor2(((DarkKingdomCore.MyGame.gameWidth - 9) | 0), ((DarkKingdomCore.MyGame.hor - 75) | 0), 15, 25);
                this.symbols[1] = new Microsoft.Xna.Framework.Rectangle.$ctor2(((DarkKingdomCore.MyGame.gameWidth - 34) | 0), ((DarkKingdomCore.MyGame.hor - 54) | 0), 15, 25);
                this.symbols[2] = new Microsoft.Xna.Framework.Rectangle.$ctor2(-7, ((DarkKingdomCore.MyGame.hor - 75) | 0), 15, 25);
                this.symbols[3] = new Microsoft.Xna.Framework.Rectangle.$ctor2(21, ((DarkKingdomCore.MyGame.hor - 54) | 0), 15, 25);



                // frmBattle.SetPosition(frmMainMenu.rect.Right / 2 + (frmMenuExit.rect.Left - frmBattle.rect.Width) / 2, (h - frmBattle.rect.Height) / 2)








                this.sunAng = 0.0;
                this.dAng = 0.000698131742;

                this.gamelandscape = DarkKingdomCore.MyGame.rnd.Next$1(this.landsTypesCount);

                DarkKingdomCore.MyGame.gState = DarkKingdomCore.GameState.MainMenu;
                this.Pause = false;


                this.ChangeLandscape(this.gamelandscape);

                this.SetPlayers();

                this.ResetWorld(this.sunAng, this.dAng);


                this.frmMainMenu.Show();
                this.frmRightMenu.Show();

                if (DarkKingdomCore.ProfileManager.Instance.All.Count > 0) {
                    this.StartBattle();
                } else {
                    this.StartNewProfile();
                }

                this.isLoaded = true;
            },
            StartNewProfile: function () {
                DarkKingdomCore.ProfileManager.Instance.All.add(new DarkKingdomCore.Profile(("\u041d\u043e\u0432\u0438\u0447\u0435\u043a").trim(), 0, 1, new (System.Collections.Generic.List$1(System.String)).ctor(), new (System.Collections.Generic.Dictionary$2(System.String,System.Int32)).ctor(), new (System.Collections.Generic.Dictionary$2(System.String,System.Int32)).ctor(), -1, -1, new (System.Collections.Generic.Dictionary$2(System.String,System.String)).ctor(), 0, 3));
                // RaceManager.Instance.All.Add("Custom0", New Race("Custom0", "Ð¡Ð´ÐµÐ»Ð°Ð½Ð¾ ÑÐ²Ð¾Ð¸Ð¼Ð¸ ÑÑÐºÐ°Ð¼Ð¸", "Ð¡ÑÐ°ÑÑÐ¾Ð²ÑÐ¹ Ð½Ð°Ð±Ð¾Ñ", RaceManager.Instance.All(standartRaces(raceSwitcherNewProfile.Current)).units, 10, False, True, False, False))
                this.OrderRaces();
                this.CreateRaceList();
                this.StartBattle();
                this.frmBattle.Show(this.mainAnimator);

                this.ShowSomeChildren([this.frmMainMenu, this.frmRightMenu]);


                this.StartBattle();
            },
            ShowSomeChildren: function (frms) {
                var $t;
                if (frms === void 0) { frms = []; }
                $t = Bridge.getEnumerator(frms);
                try {
                    while ($t.moveNext()) {
                        var frm = $t.Current;
                        frm.Show(this.mainAnimator);
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            },
            HideSomeChildren: function (frms) {
                var $t;
                if (frms === void 0) { frms = []; }
                $t = Bridge.getEnumerator(frms);
                try {
                    while ($t.moveNext()) {
                        var frm = $t.Current;
                        frm.Hide(this.mainAnimator);
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            },
            StartProfile: function () {
                this.RotateCarousel(this.frmProfile);
                this.UpdateProfileInfoLabels();
            },
            UpdateProfileInfoLabels: function () {
                var $t, $t1;
                this.lblsfrmProfile.getItem(0).Text = "\u041d\u0438\u043a: " + (DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).name || "");
                this.lblsfrmProfile.getItem(1).Text = "\u0421\u043b\u043e\u0436\u043d\u043e\u0441\u0442\u044c: " + (this.localize.GetString(this.conds.getItem(DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).difficult).$clone().name) || "");


                var allwins = 0;
                var maxrace = "";
                var maxracepls = 0;

                $t = Bridge.getEnumerator(DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).racesPlays.Keys);
                try {
                    while ($t.moveNext()) {
                        var r = $t.Current;
                        allwins = (allwins + DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).racesWins.getItem(r)) | 0;
                        if (maxracepls < DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).racesPlays.getItem(r)) {
                            maxracepls = DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).racesPlays.getItem(r);
                            maxrace = r;
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }

                this.lblsfrmProfile.getItem(2).Text = System.String.format("\u041f\u043e\u0431\u0435\u0434: {0}", [allwins]);
                this.lblsfrmProfile.getItem(3).Text = System.String.format("\u041e\u0442\u043a\u0440\u044b\u0442\u043e {0}% \u0441\u0443\u0449\u0435\u0441\u0442\u0432", [Bridge.Int.mul(100, DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).units.Count) / this.AllUntsList.Count]);

                var acNum = 0;

                $t1 = Bridge.getEnumerator(DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).achivs);
                try {
                    while ($t1.moveNext()) {
                        var a = $t1.Current;
                        if (Bridge.referenceEquals(a.value, "")) {
                            acNum = (acNum + 1) | 0;
                        }
                    }
                } finally {
                    if (Bridge.is($t1, System.IDisposable)) {
                        $t1.System$IDisposable$Dispose();
                    }
                }

                this.lblsfrmProfile.getItem(4).Text = System.String.format("\u041e\u0442\u043a\u0440\u044b\u0442\u043e {0}% \u0434\u043e\u0441\u0442\u0438\u0436\u0435\u043d\u0438\u0439", [Bridge.Int.mul(100, acNum) / this.achivs.Count]);


                this.lblsfrmProfile.getItem(6).Text = "\u041d\u0438\u043a: " + (DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).name || "");
                this.lblsfrmProfile.getItem(7).Text = "\u041d\u0438\u043a: " + (DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).name || "");

                if (!System.String.isNullOrEmpty(maxrace)) {
                    this.lblsfrmProfile.getItem(5).Text = System.String.format("\u041b\u044e\u0431\u0438\u043c\u0430\u044f \u0444\u0440\u0430\u043a\u0446\u0438\u044f: {0}", [this.localize.GetString(maxrace)]);
                } else {
                    this.lblsfrmProfile.getItem(5).Text = "\u041b\u044e\u0431\u0438\u043c\u0430\u044f \u0444\u0440\u0430\u043a\u0446\u0438\u044f: -";
                }

                if (DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).minvictims === -1) {
                    this.lblsfrmProfile.getItem(6).Text = "\u041c\u0438\u043d\u0438\u043c\u0443\u043c \u043f\u043e\u0442\u0435\u0440\u044c: -";
                } else {
                    this.lblsfrmProfile.getItem(6).Text = System.String.format("\u041c\u0438\u043d\u0438\u043c\u0443\u043c \u043f\u043e\u0442\u0435\u0440\u044c: {0}", [DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).minvictims]);
                }

                if (DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).maxkills === -1) {
                    this.lblsfrmProfile.getItem(7).Text = "\u041c\u0430\u043a\u0441\u0438\u043c\u0443\u043c \u0443\u0431\u0438\u0439\u0441\u0442\u0432: -";
                } else {
                    this.lblsfrmProfile.getItem(7).Text = System.String.format("\u041c\u0430\u043a\u0441\u0438\u043c\u0443\u043c \u0443\u0431\u0438\u0439\u0441\u0442\u0432: {0}", [DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).maxkills]);
                }
            },
            ResetWorld: function (sunPos, sunV) {
                DarkKingdomCore.MyGame.cloudpars.clear();
                this.snD = Math.sin(sunV);
                this.csD = Math.cos(sunV);
                this.snS = Math.sin(sunPos);
                this.csS = Math.cos(sunPos);
                for (var i = 0; i <= 3; i = (i + 1) | 0) {
                    DarkKingdomCore.MyGame.cloudpars.add(new DarkKingdomCore.ImageParticle(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("world"), DarkKingdomCore.MyGame.rnd.Next$2(2, 6)), ((-100 - DarkKingdomCore.MyGame.rnd.Next$1(100)) | 0), ((((DarkKingdomCore.MyGame.hor - 200) | 0) - Bridge.Int.mul(i, 40)) | 0), 0.2 + 0.4 * DarkKingdomCore.MyGame.rnd.NextDouble(), 0, -1));
                }
            },
            btnUnit_Clicked: function (btn, isTouch) {
                for (var i = 0; i < this.cUnits.Children.Count; i = (i + 1) | 0) {
                    if (Bridge.referenceEquals(this.cUnits.Children.getItem(i), btn)) {
                        this.TryAddToQueueUnit(DarkKingdomCore.MyGame.plrs[0], DarkKingdomCore.MyGame.plrs[0].unitsList.getItem(i));
                    }
                }
            },
            btnUnit_Focused: function (btn, isTouch) {
                for (var i = 0; i < this.cUnits.Children.Count; i = (i + 1) | 0) {
                    if (Bridge.referenceEquals(this.cUnits.Children.getItem(i), btn)) {
                        this.ShowUnitInfo(DarkKingdomCore.MyGame.unitPrms.getItem(DarkKingdomCore.MyGame.plrs[0].unitsList.getItem(i)).$clone(), 0, true, new Microsoft.Xna.Framework.Point.$ctor2(Bridge.Int.clip32(btn.FinalRight / this.MainContainer.FinalChildrenScaleX), Bridge.Int.clip32(btn.FinalBottom / this.MainContainer.FinalChildrenScaleY)));
                    }
                }
            },
            SetUnits: function () {
                if (DarkKingdomCore.MyGame.plrs[0].unitsList.Count > 0) {
                    this.cUnits.Children.clear();

                    var d = 0;
                    var oldt = DarkKingdomCore.MyGame.unitPrms.getItem(DarkKingdomCore.MyGame.plrs[0].unitsList.getItem(0)).$clone().Cost.Tier;
                    for (var i = 0; i < DarkKingdomCore.MyGame.plrs[0].unitsList.Count; i = (i + 1) | 0) {
                        if (DarkKingdomCore.MyGame.unitPrms.getItem(DarkKingdomCore.MyGame.plrs[0].unitsList.getItem(i)).$clone().Cost.Tier !== oldt || DarkKingdomCore.MyGame.unitPrms.getItem(DarkKingdomCore.MyGame.plrs[0].unitsList.getItem(i)).$clone().AbsContains("Target")) {
                            d = (d + 7) | 0;
                            oldt = DarkKingdomCore.MyGame.unitPrms.getItem(DarkKingdomCore.MyGame.plrs[0].unitsList.getItem(i)).$clone().Cost.Tier;
                        }
                        this.cUnits.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor1(Bridge.fn.cacheBind(this, this.btnUnit_Clicked), Bridge.fn.cacheBind(this, this.btnUnit_Focused), this.numKeys[i], ((Bridge.Int.mul(i, 65) + d) | 0), 0, 60, 60, 0.0, 0.5, true)).AddChild(MonoInterface.Picture, new MonoInterface.Picture(DarkKingdomCore.MyGame.unitPrms.getItem(DarkKingdomCore.MyGame.plrs[0].unitsList.getItem(i)).$clone().iconApp.$clone(), 0, 0, 60, 60, 0.5, 0.5, true));
                        this.cUnits.W = System.Linq.Enumerable.from(this.cUnits.Children, MonoInterface.Block).last().Right;
                    }
                    this.cUnits.ApplyTheme(this.defaultTheme);
                } else {
                }
            },
            StartAgain: function () {
                var $t, $t1, $t2, $t3, $t4, $t5;
                DarkKingdomCore.MyGame.plrs[0].Reset(this.conds.getItem(DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).difficult).$clone());
                DarkKingdomCore.MyGame.plrs[1].Reset(this.conds.getItem(DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).difficult).$clone());
                this.pctTierFrmResources.spriteRef = DarkKingdomCore.MyGame.unitPrms.getItem("Tier_2").$clone().iconApp.$clone();
                this.ammos.clear();
                DarkKingdomCore.MyGame.units.clear();
                DarkKingdomCore.MyGame.pars.clear();
                this.deathlist.clear();
                this.bornList.clear();
                this.frmProduction.Hide(this.mainAnimator);

                this.UpdateQueue();


                var baseCnt = 0;

                if (this.gType === DarkKingdomCore.GameType.StandartGT || this.gType === DarkKingdomCore.GameType.DefenceGT) {
                    if (Bridge.referenceEquals(DarkKingdomCore.MyGame.plrs[0].hero, "Castle")) {
                        DarkKingdomCore.MyGame.units.add(new DarkKingdomCore.Unit(this, ((this.us2 - 1) | 0), 1, 0, DarkKingdomCore.MyGame.unitPrms.getItem("Castle").$clone()));
                        DarkKingdomCore.MyGame.units.getItem(baseCnt).parameters.spriteName = (DarkKingdomCore.MyGame.plrs[0].castleFileName || "") + "2";
                        DarkKingdomCore.MyGame.units.getItem(baseCnt).parameters.rect = new Microsoft.Xna.Framework.Rectangle.$ctor2(-15, -60, 50, 63);
                        DarkKingdomCore.MyGame.plrs[baseCnt].baseX = this.us2;
                    } else {
                        DarkKingdomCore.MyGame.units.add(new DarkKingdomCore.Unit(this, ((this.unitSize - 1) | 0), 1, 0, DarkKingdomCore.MyGame.unitPrms.getItem(DarkKingdomCore.MyGame.plrs[0].hero).$clone()));
                        DarkKingdomCore.MyGame.plrs[0].baseX = (-this.us2) | 0;
                    }
                    DarkKingdomCore.MyGame.plrs[0].heroUnit = DarkKingdomCore.MyGame.units.getItem(baseCnt);
                    baseCnt = (baseCnt + 1) | 0;
                } else {
                    DarkKingdomCore.MyGame.plrs[0].hero = "";
                    DarkKingdomCore.MyGame.plrs[0].baseX = (-this.unitSize) | 0;
                    DarkKingdomCore.MyGame.plrs[0].heroUnit = null;
                }


                if (this.gType === DarkKingdomCore.GameType.StandartGT || this.gType === DarkKingdomCore.GameType.OffenceGT) {
                    if (Bridge.referenceEquals(DarkKingdomCore.MyGame.plrs[1].hero, "Castle")) {
                        DarkKingdomCore.MyGame.units.add(new DarkKingdomCore.Unit(this, ((((DarkKingdomCore.MyGame.gameWidth - this.us2) | 0) + 1) | 0), -1, 1, DarkKingdomCore.MyGame.unitPrms.getItem("Castle").$clone()));
                        DarkKingdomCore.MyGame.units.getItem(baseCnt).parameters.spriteName = (DarkKingdomCore.MyGame.plrs[1].castleFileName || "") + 2;
                        DarkKingdomCore.MyGame.units.getItem(baseCnt).parameters.imgx = -20;
                        DarkKingdomCore.MyGame.units.getItem(baseCnt).parameters.rect = new Microsoft.Xna.Framework.Rectangle.$ctor2(-35, -59, 50, 63);
                        DarkKingdomCore.MyGame.plrs[1].baseX = (DarkKingdomCore.MyGame.gameWidth - this.us2) | 0;
                    } else {
                        DarkKingdomCore.MyGame.units.add(new DarkKingdomCore.Unit(this, ((((DarkKingdomCore.MyGame.gameWidth - this.unitSize) | 0) + 1) | 0), -1, 1, DarkKingdomCore.MyGame.unitPrms.getItem(DarkKingdomCore.MyGame.plrs[1].hero).$clone()));
                        DarkKingdomCore.MyGame.plrs[1].baseX = (DarkKingdomCore.MyGame.gameWidth + this.us2) | 0;
                    }
                    DarkKingdomCore.MyGame.plrs[1].heroUnit = DarkKingdomCore.MyGame.units.getItem(baseCnt);
                    baseCnt = (baseCnt + 1) | 0;
                } else {
                    DarkKingdomCore.MyGame.plrs[1].hero = "";
                    DarkKingdomCore.MyGame.plrs[1].baseX = (DarkKingdomCore.MyGame.gameWidth + this.unitSize) | 0;
                    DarkKingdomCore.MyGame.plrs[1].heroUnit = null;
                }

                this.curM = DarkKingdomCore.MyGame.plrs[0].res.Money;
                this.curD = DarkKingdomCore.MyGame.plrs[0].res.Death;

                this.selU = null;
                this.SetUnits();
                this.SetSpells();


                if (this.gType === DarkKingdomCore.GameType.DefenceGT) {
                    this.ResetWorld(3.14159274, this.dAng / 3);
                } else {
                    if (this.gType === DarkKingdomCore.GameType.OffenceGT) {
                        this.ResetWorld(0, this.dAng / 3);
                    } else {
                        this.ResetWorld(this.sunAng, this.dAng);
                    }
                }
                if (this.gType === DarkKingdomCore.GameType.DefenceGT) {
                    ($t = DarkKingdomCore.MyGame.plrs[1].res.$clone()).Money = Bridge.Int.mul($t.Money, 2);
                    ($t1 = DarkKingdomCore.MyGame.plrs[1].res.$clone()).Death = Bridge.Int.mul($t1.Death, 2);
                }
                if (this.gType === DarkKingdomCore.GameType.OffenceGT) {
                    ($t2 = DarkKingdomCore.MyGame.plrs[0].res.$clone()).Money = Bridge.Int.mul($t2.Money, 2);
                    ($t3 = DarkKingdomCore.MyGame.plrs[0].res.$clone()).Death = Bridge.Int.mul($t3.Death, 2);
                }

                $t4 = Bridge.getEnumerator(DarkKingdomCore.MyGame.plrs);
                try {
                    while ($t4.moveNext()) {
                        var p = $t4.Current;
                        var otherBuildings = new (System.Collections.Generic.List$1(System.String)).ctor();
                        $t5 = Bridge.getEnumerator(p.bonusList);
                        try {
                            while ($t5.moveNext()) {
                                var b = $t5.Current;
                                if (Bridge.referenceEquals(b, "Tower")) {
                                    var tower = new DarkKingdomCore.Unit(this, ((((Bridge.Int.div(DarkKingdomCore.MyGame.gameWidth, 2)) | 0) - ((Bridge.Int.div(Bridge.Int.mul(p.moveside, DarkKingdomCore.MyGame.gameWidth), 6)) | 0)) | 0), p.moveside, p.id, DarkKingdomCore.MyGame.unitPrms.getItem("Tower").$clone());
                                    DarkKingdomCore.MyGame.units.add(tower);
                                } else {
                                    otherBuildings.add(b);
                                }
                            }
                        } finally {
                            if (Bridge.is($t5, System.IDisposable)) {
                                $t5.System$IDisposable$Dispose();
                            }
                        }

                        for (var i = 0; i < otherBuildings.Count; i = (i + 1) | 0) {
                            var building = new DarkKingdomCore.Unit(this, ((((((Bridge.Int.div(DarkKingdomCore.MyGame.gameWidth, 2)) | 0) - ((Bridge.Int.div(Bridge.Int.mul(p.moveside, DarkKingdomCore.MyGame.gameWidth), 6)) | 0)) | 0) - Bridge.Int.mul(Bridge.Int.mul(p.moveside, (((Bridge.Int.div((((((Bridge.Int.div(DarkKingdomCore.MyGame.gameWidth, 3)) | 0) - this.us2) | 0)), (((otherBuildings.Count + 1) | 0)))) | 0))), (((i + 1) | 0)))) | 0), p.moveside, p.id, DarkKingdomCore.MyGame.unitPrms.getItem(otherBuildings.getItem(i)).$clone());
                            DarkKingdomCore.MyGame.units.add(building);
                        }
                    }
                } finally {
                    if (Bridge.is($t4, System.IDisposable)) {
                        $t4.System$IDisposable$Dispose();
                    }
                }
                DarkKingdomCore.MyGame.gState = DarkKingdomCore.GameState.InGame;
                this.Pause = false;
            },
            StartPreGame: function () {
                var $t, $t1, $t2, $t3, $t4, $t5;
                this.unitsPreGame.clear();
                this.spellsPreGame.clear();

                if (this.modeSwitcherFrmBattle.Current === DarkKingdomCore.GameType.RandomGT) {
                    this.gType = DarkKingdomCore.MyGame.rnd.Next$2(1, 6);
                } else {
                    this.gType = this.modeSwitcherFrmBattle.Current;
                }

                if (Bridge.referenceEquals(this.races1.getItem(this.races1SwitcherFrmBattle.Current), "Random")) {
                    DarkKingdomCore.MyGame.plrs[0].race = DarkKingdomCore.RaceManager.Instance.All.getItem(this.races1.getItem(DarkKingdomCore.MyGame.rnd.Next$2(1, this.races1.Count))).name;
                } else {
                    DarkKingdomCore.MyGame.plrs[0].race = this.races1.getItem(this.races1SwitcherFrmBattle.Current);
                }
                if (Bridge.referenceEquals(this.races2.getItem(this.races2SwitcherFrmBattle.Current), "Random")) {
                    DarkKingdomCore.MyGame.plrs[1].race = DarkKingdomCore.RaceManager.Instance.All.getItem(this.races2.getItem(DarkKingdomCore.MyGame.rnd.Next$2(1, this.races2.Count))).name;
                } else {
                    DarkKingdomCore.MyGame.plrs[1].race = this.races2.getItem(this.races2SwitcherFrmBattle.Current);
                }


                DarkKingdomCore.MyGame.plrs[0].symb = DarkKingdomCore.RaceManager.Instance.All.getItem(DarkKingdomCore.MyGame.plrs[0].race).symb;
                DarkKingdomCore.MyGame.plrs[1].symb = DarkKingdomCore.RaceManager.Instance.All.getItem(DarkKingdomCore.MyGame.plrs[1].race).symb;


                // ÐÑÐ±Ð¸ÑÐ°ÐµÐ¼ ÑÑÑÐµÑÑÐ² Ð¿ÐµÑÐ²Ð¾Ð¼Ñ Ð¸Ð³ÑÐ¾ÐºÑ
                if (DarkKingdomCore.RaceManager.Instance.All.getItem(DarkKingdomCore.MyGame.plrs[0].race).custom) {
                    $t = Bridge.getEnumerator(new (System.Collections.Generic.List$1(System.String)).ctor());
                    try {
                        while ($t.moveNext()) {
                            var unam = $t.Current;
                            this.unitsPreGame.add(unam);
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                } else {
                    $t1 = Bridge.getEnumerator(DarkKingdomCore.MyGame.unitPrms.Values);
                    try {
                        while ($t1.moveNext()) {
                            var u = $t1.Current.$clone();
                            if (Bridge.referenceEquals(u.Race, DarkKingdomCore.MyGame.plrs[0].race) && !u.special) {
                                this.unitsPreGame.add(u.Name);
                            }
                        }
                    } finally {
                        if (Bridge.is($t1, System.IDisposable)) {
                            $t1.System$IDisposable$Dispose();
                        }
                    }

                    this.unitsPreGame = this.SortUnitsLists(this.unitsPreGame);
                }
                DarkKingdomCore.MyGame.plrs[0].unitsList = this.unitsPreGame;

                this.lblVsPreGame.Text = System.String.format("{0} VS {1}", this.localize.GetString(DarkKingdomCore.MyGame.plrs[0].race), this.localize.GetString(DarkKingdomCore.MyGame.plrs[1].race));

                $t2 = Bridge.getEnumerator(this.spells.Values);
                try {
                    while ($t2.moveNext()) {
                        var spl = $t2.Current;
                        this.spellsPreGame.add(spl.Name);
                    }
                } finally {
                    if (Bridge.is($t2, System.IDisposable)) {
                        $t2.System$IDisposable$Dispose();
                    }
                }
                this.spellsPreGame = this.SortSpellsLists(this.spellsPreGame);
                DarkKingdomCore.MyGame.plrs[0].spllsList = this.spellsPreGame;


                DarkKingdomCore.MyGame.plrs[0].bonusList.clear();
                DarkKingdomCore.MyGame.plrs[1].bonusList.clear();

                var allbonuses = new (System.Collections.Generic.List$1(System.String)).ctor();
                allbonuses.AddRange(this.startBuildingsList);
                DarkKingdomCore.MyGame.plrs[0].bonusList.AddRange(allbonuses);
                DarkKingdomCore.MyGame.plrs[1].bonusList.AddRange(allbonuses);



                // frmPreGame.AddButton(5, delta, 16, 16, , "RandomUnits", Keys.D1)
                // frmPreGame.AddImage(5, delta, 19, 15, "small_icons", 16)
                this.cUnitsPreGame.Children.clear();
                $t3 = Bridge.getEnumerator(this.unitsPreGame);
                try {
                    while ($t3.moveNext()) {
                        var u1 = $t3.Current;
                        this.cUnitsPreGame.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor2(Bridge.fn.cacheBind(this, this.btnUnitPreGame_Clicked), Bridge.fn.cacheBind(this, this.btnUnitPreGame_Focused), 5, 5, 45, 45, 0.0, 0.0, true)).AddChild(MonoInterface.Picture, new MonoInterface.Picture(DarkKingdomCore.MyGame.unitPrms.getItem(u1).$clone().iconApp.$clone(), 0, 0, 45, 45, 0.5, 0.5, true));
                    }
                } finally {
                    if (Bridge.is($t3, System.IDisposable)) {
                        $t3.System$IDisposable$Dispose();
                    }
                }
                this.cUnitsPreGame.ApplyTheme(this.defaultTheme);
                // frmPreGame.AddButton(5, delta, 16, 16, , "RandomSpells", Keys.D2)
                // frmPreGame.AddImage(5, delta, 19, 15, "small_icons", 16)

                this.cSpellsPreGame.Children.clear();
                $t4 = Bridge.getEnumerator(this.spellsPreGame);
                try {
                    while ($t4.moveNext()) {
                        var s = $t4.Current;
                        this.cSpellsPreGame.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor2(Bridge.fn.cacheBind(this, this.btnSpellsPreGame_Clicked), Bridge.fn.cacheBind(this, this.btnSpellsPreGame_Focused), 5, 5, 45, 45, 0.0, 0.0, true)).AddChild(MonoInterface.Picture, new MonoInterface.Picture(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("spells_icons"), this.spells.getItem(s).Img), 0, 0, 45, 45, 0.5, 0.5, true));
                    }
                } finally {
                    if (Bridge.is($t4, System.IDisposable)) {
                        $t4.System$IDisposable$Dispose();
                    }
                }
                this.cSpellsPreGame.ApplyTheme(this.defaultTheme);
                // frmPreGame.AddButton(5, delta, 16, 16, , "RandomBuildings", Keys.D3)
                // frmPreGame.AddImage(5, delta, 19, 15, "small_icons", 16)


                this.cBuildingsPreGame.Children.clear();
                $t5 = Bridge.getEnumerator(this.startBuildingsList);
                try {
                    while ($t5.moveNext()) {
                        var b = $t5.Current;
                        this.cBuildingsPreGame.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor2(Bridge.fn.cacheBind(this, this.btnBuildingPreGame_Clicked), Bridge.fn.cacheBind(this, this.btnBuildingPreGame_Focused), 5, 5, 45, 45, 0.0, 0.0, true)).AddChild(MonoInterface.Picture, new MonoInterface.Picture(DarkKingdomCore.MyGame.unitPrms.getItem(b).$clone().iconApp.$clone(), 0, 0, 45, 45, 0.5, 0.5, true));
                    }
                } finally {
                    if (Bridge.is($t5, System.IDisposable)) {
                        $t5.System$IDisposable$Dispose();
                    }
                }
                this.cBuildingsPreGame.ApplyTheme(this.defaultTheme);

                this.cSelectedPreGame.Children.clear();
                for (var i = 0; i < this.preGameSlotCnt; i = (i + 1) | 0) {
                    this.cSelectedPreGame.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor2(Bridge.fn.cacheBind(this, this.btnSelectedPreGame_Clicked), Bridge.fn.cacheBind(this, this.btnSelectedPreGame_Focused), 5, 5, 45, 45, 0.0, 0.5, true)).AddChild(MonoInterface.Picture, new MonoInterface.Picture(this.defaultTheme.EmptyTexture.$clone(), 0, 0, 45, 45, 0.5, 0.5, true));
                }
                this.cSelectedPreGame.ApplyTheme(this.defaultTheme);

                this.preGameUnits.clear();
                this.preGameSpells.clear();
                this.preGameBonus.clear();

                this.cUnitsPreGame.Visible = true;


                this.frmPreGame.Show(this.mainAnimator);

                this.btnUnitsPreGame.Click(0, 0, false);
                this.SetPreGameLists();
            },
            ShowDialogConfirmation: function (str) {
                this.lblTextFrmConfirm.Text = str;
                this.frmConfirm.Show(this.mainAnimator);

                this.taskConfirm = new System.Threading.Tasks.TaskCompletionSource();
                return this.taskConfirm.task;
            },
            SetPlayerAI: function (val) {
                DarkKingdomCore.MyGame.plrs[0].AI = val;
                this.lblAIFrmBattleMenu.Text = val ? "\u041f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043d\u0430 \u0438\u0433\u0440\u043e\u043a\u0430" : "\u041f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043d\u0430 \u0418\u0418";
            },
            StartPlaying: function () {
                var $t;
                this.ShowSomeChildren([this.frmUnits, this.frmResources]);
                this.HideSomeChildren([this.frmMainMenu, this.frmRightMenu]);


                this.SetPlayerAI(this.startAutofight);

                DarkKingdomCore.MyGame.plrs[0].unitsList.clear();
                DarkKingdomCore.MyGame.plrs[0].spllsList.clear();
                DarkKingdomCore.MyGame.plrs[0].bonusList.clear();

                DarkKingdomCore.MyGame.plrs[0].unitsList.AddRange(this.preGameUnits);
                DarkKingdomCore.MyGame.plrs[0].spllsList.AddRange(this.preGameSpells);
                DarkKingdomCore.MyGame.plrs[0].bonusList.AddRange(this.preGameBonus);


                // ÐÑÐ±Ð¸ÑÐ°ÐµÐ¼ ÑÑÑÐµÑÑÐ² Ð²ÑÐ¾ÑÐ¾Ð¼Ñ Ð¸Ð³ÑÐ¾ÐºÑ
                if (DarkKingdomCore.RaceManager.Instance.All.getItem(DarkKingdomCore.MyGame.plrs[1].race).custom) {
                    DarkKingdomCore.MyGame.plrs[1].unitsList = this.RandomizeUnits(7, new (System.Collections.Generic.List$1(System.String)).ctor(), false);
                } else {
                    var allunts = new (System.Collections.Generic.List$1(System.String)).ctor();
                    $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.unitPrms.Values);
                    try {
                        while ($t.moveNext()) {
                            var u = $t.Current.$clone();
                            if (Bridge.referenceEquals(u.Race, DarkKingdomCore.MyGame.plrs[1].race) && !u.special) {
                                allunts.add(u.Name);
                            }
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }

                    DarkKingdomCore.MyGame.plrs[1].unitsList = this.RandomizeUnits(7, allunts, true);
                }

                DarkKingdomCore.MyGame.plrs[1].bonusList = this.RandomizeBuildings(((10 - DarkKingdomCore.MyGame.plrs[1].unitsList.Count) | 0), DarkKingdomCore.MyGame.plrs[1].bonusList);



                DarkKingdomCore.MyGame.plrs[0].hero = "Castle";
                DarkKingdomCore.MyGame.plrs[1].hero = "Castle";

                DarkKingdomCore.MyGame.plrs[0].castleFileName = this.GetCatleFileName(DarkKingdomCore.MyGame.plrs[0].race);
                DarkKingdomCore.MyGame.plrs[1].castleFileName = this.GetCatleFileName(DarkKingdomCore.MyGame.plrs[1].race);

                this.StartAgain();

                if (!Bridge.referenceEquals(DarkKingdomCore.MyGame.plrs[0].hero, "")) {
                    DarkKingdomCore.MyGame.units.getItem(0).parameters.Race = DarkKingdomCore.MyGame.plrs[0].race;
                }

                if (!Bridge.referenceEquals(DarkKingdomCore.MyGame.plrs[1].hero, "")) {
                    if (Bridge.referenceEquals(DarkKingdomCore.MyGame.plrs[0].hero, "")) {
                        DarkKingdomCore.MyGame.units.getItem(0).parameters.Race = DarkKingdomCore.MyGame.plrs[1].race;
                    } else {
                        DarkKingdomCore.MyGame.units.getItem(1).parameters.Race = DarkKingdomCore.MyGame.plrs[1].race;
                    }
                }

                this.btnSelectUnits.Click(0, 0, true);

                this.ShowInfoPar(this.localize.GetString((System.Enum.toString(DarkKingdomCore.GameType, this.gType) || "") + "Desc"), DarkKingdomCore.MyGame.goodAbilClr.$clone(), ((Bridge.Int.div(DarkKingdomCore.MyGame.gameWidth, 2)) | 0), ((Bridge.Int.div(DarkKingdomCore.MyGame.gameHeight, 2)) | 0), true, true);
            },
            GetCatleFileName: function (race) {
                switch (race) {
                    case "Humans": 
                        return "hqs_daemonic";
                    case "Demons": 
                        return "hqs_human";
                    case "Dwarfs": 
                        return "hqs_dvarven";
                    case "Elves": 
                        return "hqs_elvish";
                    case "Horde": 
                        return "hqs_orcish";
                    case "Steampunk": 
                        return "hqs_steampunk";
                    case "Swampers": 
                        return "hqs_swampclan";
                    case "Undeads": 
                        return "hqs_undead";
                }
                ;
                return "hqs";
            },
            StartBattle: function () {
                this.frmBattle.Show(this.mainAnimator);
                this.frmPreGame.Hide(this.mainAnimator);

                this.races1SwitcherFrmBattle.Current = 0;
                this.races2SwitcherFrmBattle.Current = 0;
                this.modeSwitcherFrmBattle.Current = 1;
            },
            SetPreGameLists: function () {
                for (var i = 0; i < this.preGameSlotCnt; i = (i + 1) | 0) {
                    var btn = Bridge.as(this.cSelectedPreGame.Children.getItem(i), MonoInterface.Button);
                    var pct = Bridge.as(btn.Children.getItem(0), MonoInterface.Picture);
                    if (this.preGameUnits.Count > i) {
                        pct.spriteRef = DarkKingdomCore.MyGame.unitPrms.getItem(this.preGameUnits.getItem(i)).$clone().iconApp.$clone();
                    } else {
                        if (this.preGameSpells.Count > ((i - this.preGameUnits.Count) | 0)) {
                            pct.spriteRef = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("spells_icons"), this.spells.getItem(this.preGameSpells.getItem(((i - this.preGameUnits.Count) | 0))).Img);
                        } else {
                            if (this.preGameBonus.Count > ((((i - this.preGameUnits.Count) | 0) - this.preGameSpells.Count) | 0)) {
                                pct.spriteRef = DarkKingdomCore.MyGame.unitPrms.getItem(this.preGameBonus.getItem(((((i - this.preGameUnits.Count) | 0) - this.preGameSpells.Count) | 0))).$clone().iconApp.$clone();
                            } else {
                                pct.spriteRef = this.defaultTheme.EmptyTexture.$clone();
                            }
                        }
                    }
                }
                var completedAll = ((((this.preGameUnits.Count + this.preGameSpells.Count) | 0) + this.preGameBonus.Count) | 0) === 10;

                for (var i1 = 0; i1 < this.unitsPreGame.Count; i1 = (i1 + 1) | 0) {
                    (Bridge.as(this.cUnitsPreGame.Children.getItem(i1), MonoInterface.Button)).IsDisabled = this.preGameUnits.contains(this.unitsPreGame.getItem(i1)) || completedAll || this.preGameUnits.Count === 7;
                }

                for (var i2 = 0; i2 < this.spellsPreGame.Count; i2 = (i2 + 1) | 0) {
                    (Bridge.as(this.cSpellsPreGame.Children.getItem(i2), MonoInterface.Button)).IsDisabled = this.preGameSpells.contains(this.spellsPreGame.getItem(i2)) || completedAll || this.preGameSpells.Count === 7;
                }

                for (var i3 = 0; i3 < this.startBuildingsList.Count; i3 = (i3 + 1) | 0) {
                    (Bridge.as(this.cBuildingsPreGame.Children.getItem(i3), MonoInterface.Button)).IsDisabled = this.preGameBonus.contains(this.startBuildingsList.getItem(i3)) || completedAll || this.preGameBonus.Count === 7;
                }

                this.btnFightPreGame.IsDisabled = ((((this.preGameUnits.Count + this.preGameSpells.Count) | 0) + this.preGameBonus.Count) | 0) === 0;
            },
            SetEditorUnits: function () { },
            SortUnitsLists: function (units) {
                return System.Linq.Enumerable.from(units, System.String).orderBy(function (unit) {
                        return DarkKingdomCore.MyGame.unitPrms.getItem(unit).$clone().Cost.Tier;
                    }).thenBy(function (unit) {
                    return DarkKingdomCore.MyGame.unitPrms.getItem(unit).$clone().Cost.Money;
                }).toList(System.String);
            },
            SortSpellsLists: function (spells) {
                return System.Linq.Enumerable.from(spells, System.String).orderBy(Bridge.fn.bind(this, function (spell) {
                        return this.spells.getItem(spell).Cost.Tier;
                    })).thenBy(Bridge.fn.bind(this, function (spell) {
                    return this.spells.getItem(spell).Cost.Death;
                })).toList(System.String);
            },
            Newborn: function (plr, u, inStack) {
                var $t, $t1, $t2;
                $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                try {
                    while ($t.moveNext()) {
                        var uu = $t.Current;
                        if (uu.owner === DarkKingdomCore.MyGame.plrs[plr].id && uu.AbsContains("WombAbil")) {
                            u.x = uu.x + Bridge.Int.mul(5, DarkKingdomCore.MyGame.plrs[plr].moveside);
                        }
                        if (uu.owner === DarkKingdomCore.MyGame.plrs[plr].id && uu.AbsContains("Stack_helper") && inStack) {
                            u.x = uu.x + Bridge.Int.mul(10, DarkKingdomCore.MyGame.plrs[plr].moveside);
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                if (u.AbsContains("Random_position")) {
                    u.x = DarkKingdomCore.MyGame.rnd.Next$2(50, ((DarkKingdomCore.MyGame.gameWidth - 49) | 0));
                    DarkKingdomCore.MyGame.pars.add(new DarkKingdomCore.ImageParticle(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("explode"), 2), u.x - 25, ((((((DarkKingdomCore.MyGame.hor + u.parameters.rect.Bottom) | 0) - this.us2) | 0) - 25) | 0), 0, 0, 20));
                }
                if (u.AbsContains("Free")) {
                    u.parameters.Cost.Money = 80;
                    if (u.x <= DarkKingdomCore.MyGame.gameWidth / 2.0) {
                        u.owner = 0;
                        u.moveside = DarkKingdomCore.MyGame.plrs[0].moveside;
                    } else {
                        u.owner = 1;
                        u.moveside = DarkKingdomCore.MyGame.plrs[1].moveside;
                    }
                }
                if (u.abils.containsKey("Sacrifice")) {
                    var uu1 = this.FindRandomUnflyUnit(((1 - plr) | 0));
                    if (uu1 != null) {
                        u.x = uu1.x;
                        this.Kill(uu1);
                        this.ShowInfoPar("\u041f\u0440\u0438\u0437\u0432\u0430\u043d", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                    }
                }
                if (u.abils.containsKey("Assault")) {
                    var uu2 = this.FindFirstUnflyUnit(plr);
                    if (uu2 != null) {
                        u.x = uu2.x - Bridge.Int.mul(this.us2, DarkKingdomCore.MyGame.plrs[plr].moveside);
                        DarkKingdomCore.MyGame.pars.add(new DarkKingdomCore.ImageParticle(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("explode"), 2), u.x - 25, ((((((DarkKingdomCore.MyGame.hor + u.parameters.rect.Bottom) | 0) - this.us2) | 0) - 25) | 0), 0, 0, 20));
                    }
                }
                if (u.abils.containsKey("Encourage_first")) {
                    var uu3 = this.FindFirstUnflyUnit(u.owner);
                    if (uu3 != null) {
                        u.abils.getItem("Encourage_first").used = true;
                        uu3.parameters.Armor = "Heavy";
                        uu3.Attack = DarkKingdomCore.Attack.op_Addition$1(uu3.Attack.$clone(), (u.abils.getItem("Encourage_first").value) | 0);
                        this.ShowInfoPar("\u0423\u0441\u0438\u043b\u0435\u043d", DarkKingdomCore.MyGame.goodAbilClr.$clone(), uu3.x, ((DarkKingdomCore.MyGame.hor + uu3.parameters.rect.Top) | 0), true);
                    }
                }
                if (u.abils.containsKey("Swarm")) {
                    $t1 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                    try {
                        while ($t1.moveNext()) {
                            var uu4 = $t1.Current;
                            if (!Bridge.referenceEquals(uu4, u) && uu4.owner === u.owner && uu4.AbsContains("Swarm")) {
                                uu4.Attack = DarkKingdomCore.Attack.op_Addition$1(uu4.Attack.$clone(), (u.abils.getItem("Swarm").value) | 0);
                            }
                        }
                    } finally {
                        if (Bridge.is($t1, System.IDisposable)) {
                            $t1.System$IDisposable$Dispose();
                        }
                    }
                }
                $t2 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                try {
                    while ($t2.moveNext()) {
                        var uu5 = $t2.Current;
                        if (uu5.owner !== u.owner && uu5.AbsContains("Poison_on_prod") && DarkKingdomCore.MyGame.rnd.Next$1(100) < uu5.abils.getItem("Poison_on_prod").value) {
                            u.AddAbility$1("Poison", DarkKingdomCore.EffectType.Poison);
                            this.ShowInfoPar("\u0412\u0440\u0430\u0433 \u043e\u0442\u0440\u0430\u0432\u043b\u0435\u043d", DarkKingdomCore.MyGame.goodAbilClr.$clone(), uu5.x, ((DarkKingdomCore.MyGame.hor + uu5.parameters.rect.Top) | 0), true);
                        }
                    }
                } finally {
                    if (Bridge.is($t2, System.IDisposable)) {
                        $t2.System$IDisposable$Dispose();
                    }
                }
            },
            ProduceUnit: function (plr, name, atkbonus, hpbonus, armorChange, addabils, inStack) {
                var $t, $t1, $t2, $t3, $t4;
                if (atkbonus === void 0) { atkbonus = 0; }
                if (hpbonus === void 0) { hpbonus = 0; }
                if (armorChange === void 0) { armorChange = ""; }
                if (addabils === void 0) { addabils = null; }
                if (inStack === void 0) { inStack = false; }
                if (!DarkKingdomCore.MyGame.unitPrms.getItem(name).$clone().upgrade) {
                    var u = new DarkKingdomCore.Unit(this, ((DarkKingdomCore.MyGame.plrs[plr].baseX + DarkKingdomCore.MyGame.plrs[plr].moveside) | 0), DarkKingdomCore.MyGame.plrs[plr].moveside, DarkKingdomCore.MyGame.plrs[plr].id, DarkKingdomCore.MyGame.unitPrms.getItem(name).$clone());
                    if (addabils != null) {
                        $t = Bridge.getEnumerator(addabils);
                        try {
                            while ($t.moveNext()) {
                                var a = $t.Current;
                                u.AddAbility(a);
                            }
                        } finally {
                            if (Bridge.is($t, System.IDisposable)) {
                                $t.System$IDisposable$Dispose();
                            }
                        }
                    }
                    u.Attack = DarkKingdomCore.Attack.op_Addition$1(u.Attack.$clone(), atkbonus | 0);
                    ($t1 = u.parameters.$clone()).maxhp = ($t1.maxhp + hpbonus) | 0;
                    u.hp += hpbonus;
                    if (!Bridge.referenceEquals(armorChange, "")) {
                        u.parameters.Armor = armorChange;
                    }


                    this.Newborn(plr, u, inStack);
                    this.bornList.add(u);
                } else {
                    switch (name) {
                        case "Tier_2": 
                            {
                                ($t2 = DarkKingdomCore.MyGame.plrs[plr].res.$clone()).Tier = ($t2.Tier + 1) | 0;
                                if (plr === 0) {
                                    this.pctTierFrmResources.spriteRef = DarkKingdomCore.MyGame.unitPrms.getItem("Tier_3").$clone().iconApp.$clone();
                                }
                                break;
                            }
                        case "Tier_3": 
                            {
                                ($t3 = DarkKingdomCore.MyGame.plrs[plr].res.$clone()).Tier = ($t3.Tier + 1) | 0;
                                break;
                            }
                    }
                    $t4 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                    try {
                        while ($t4.moveNext()) {
                            var u1 = $t4.Current;
                            if (u1.owner === plr && u1.AbsContains("Refresh") && u1.hp < u1.parameters.maxhp) {
                                u1.hp = u1.parameters.maxhp;
                                this.ShowInfoPar("\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u1.x, ((DarkKingdomCore.MyGame.hor + u1.parameters.rect.Top) | 0), true);
                            }
                        }
                    } finally {
                        if (Bridge.is($t4, System.IDisposable)) {
                            $t4.System$IDisposable$Dispose();
                        }
                    }
                }
            },
            Kill: function (u) {
                if (!this.deathlist.contains(u)) {
                    this.deathlist.add(u);
                }
            },
            ChangeLandscape: function (newl) {
                DarkKingdomCore.MyGame.backpars.clear();
                DarkKingdomCore.MyGame.bushpars.clear();
                switch (newl) {
                    case DarkKingdomCore.LandscapeType.PlainLS: 
                        {
                            this.landBmp = "ground";
                            var num = DarkKingdomCore.MyGame.rnd.Next$2(5, 11);
                            for (var i = 0; i < num; i = (i + 1) | 0) {
                                DarkKingdomCore.MyGame.backpars.add(new DarkKingdomCore.ImageParticle(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("back0"), DarkKingdomCore.MyGame.rnd.Next$1(4)), ((((125 + Bridge.Int.mul(((Bridge.Int.div((((DarkKingdomCore.MyGame.gameWidth - 250) | 0)), (((num - 1) | 0)))) | 0), i)) | 0) - 42) | 0) + 40 * DarkKingdomCore.MyGame.rnd.NextDouble(), ((DarkKingdomCore.MyGame.hor - 70) | 0), 0, 0, -1, DarkKingdomCore.MyGame.rnd.NextDouble() > 0.5));
                            }
                            num = DarkKingdomCore.MyGame.rnd.Next$2(40, 51);
                            for (var i1 = 0; i1 < num; i1 = (i1 + 1) | 0) {
                                DarkKingdomCore.MyGame.bushpars.add(new DarkKingdomCore.ImageParticle(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("bush0"), DarkKingdomCore.MyGame.rnd.Next$1(5)), ((Bridge.Int.mul(((Bridge.Int.div(DarkKingdomCore.MyGame.gameWidth, (((num - 1) | 0)))) | 0), i1) - 42) | 0) + 40 * DarkKingdomCore.MyGame.rnd.NextDouble(), ((DarkKingdomCore.MyGame.hor - 15) | 0), 0, 0, -1));
                            }
                            break;
                        }
                    case DarkKingdomCore.LandscapeType.DesertLS: 
                        {
                            this.landBmp = "desert";
                            break;
                        }
                    case DarkKingdomCore.LandscapeType.SwampLS: 
                        {
                            this.landBmp = "swamp";
                            var num1 = DarkKingdomCore.MyGame.rnd.Next$2(10, 11);
                            for (var i2 = 0; i2 < num1; i2 = (i2 + 1) | 0) {
                                DarkKingdomCore.MyGame.backpars.add(new DarkKingdomCore.ImageParticle(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("back1"), DarkKingdomCore.MyGame.rnd.Next$1(3)), ((((125 + Bridge.Int.mul(((Bridge.Int.div((((DarkKingdomCore.MyGame.gameWidth - 250) | 0)), (((num1 - 1) | 0)))) | 0), i2)) | 0) - 42) | 0) + 40 * DarkKingdomCore.MyGame.rnd.NextDouble(), ((DarkKingdomCore.MyGame.hor - 70) | 0), 0, 0, -1, DarkKingdomCore.MyGame.rnd.NextDouble() > 0.5));
                            }
                            break;
                        }
                    case DarkKingdomCore.LandscapeType.DeathlandLS: 
                        {
                            this.landBmp = "deathland";
                            var num2 = DarkKingdomCore.MyGame.rnd.Next$2(5, 11);
                            for (var i3 = 0; i3 < num2; i3 = (i3 + 1) | 0) {
                                DarkKingdomCore.MyGame.backpars.add(new DarkKingdomCore.ImageParticle(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("back2"), DarkKingdomCore.MyGame.rnd.Next$1(4)), ((((125 + Bridge.Int.mul(((Bridge.Int.div((((DarkKingdomCore.MyGame.gameWidth - 250) | 0)), (((num2 - 1) | 0)))) | 0), i3)) | 0) - 50) | 0) + 40 * DarkKingdomCore.MyGame.rnd.NextDouble(), ((DarkKingdomCore.MyGame.hor - 70) | 0), 0, 0, -1, DarkKingdomCore.MyGame.rnd.NextDouble() > 0.5));
                            }
                            break;
                        }
                    case DarkKingdomCore.LandscapeType.MechanicsLS: 
                        {
                            this.landBmp = "mechanics";
                            break;
                        }
                    case DarkKingdomCore.LandscapeType.ForestLS: 
                        {
                            this.landBmp = "forest";
                            var num3 = DarkKingdomCore.MyGame.rnd.Next$2(10, 16);
                            for (var i4 = 0; i4 < num3; i4 = (i4 + 1) | 0) {
                                DarkKingdomCore.MyGame.backpars.add(new DarkKingdomCore.ImageParticle(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("back0"), DarkKingdomCore.MyGame.rnd.Next$1(4)), ((((125 + Bridge.Int.mul(((Bridge.Int.div((((DarkKingdomCore.MyGame.gameWidth - 250) | 0)), (((num3 - 1) | 0)))) | 0), i4)) | 0) - 32) | 0) + 20 * DarkKingdomCore.MyGame.rnd.NextDouble(), ((DarkKingdomCore.MyGame.hor - 70) | 0), 0, 0, -1, DarkKingdomCore.MyGame.rnd.NextDouble() > 0.5));
                            }
                            break;
                        }
                    case DarkKingdomCore.LandscapeType.InfernoLS: 
                        {
                            this.landBmp = "infernoland";
                            break;
                        }
                }
            },
            UpdateSkyTexture: function (tex, h, clr1R, clr1G, clr1B, clr1A, clr2R, clr2G, clr2B, clr2A) {
                var dR = (clr2R - clr1R) / h;
                var dG = (clr2G - clr1G) / h;
                var dB = (clr2B - clr1B) / h;
                var dA = (clr2A - clr1A) / h;
                var data = System.Array.init(h, function (){
                    return new Microsoft.Xna.Framework.Color();
                }, Microsoft.Xna.Framework.Color);
                for (var i = 0; i < h; i = (i + 1) | 0) {
                    data[i] = new Microsoft.Xna.Framework.Color.$ctor7(Bridge.Int.clip32(clr1R), Bridge.Int.clip32(clr1G), Bridge.Int.clip32(clr1B), Bridge.Int.clip32(clr1A));
                    clr1R += dR;
                    clr1G += dG;
                    clr1B += dB;
                    clr1A += dA;
                }
                tex.SetData$1(Microsoft.Xna.Framework.Color, data, 0, h);
            },
            Draw: function () {
                var $t, $t1, $t2, $t3, $t4, $t5, $t6, $t7;
                this.skyR = this.cnstR * (0.5 + this.snS / 2);
                this.skyG = this.cnstG * (0.5 + this.snS / 2);
                this.skyB = this.cnstB * (0.5 + this.snS / 2);
                this.skyR2 = this.cnstR2 * (0.66 + this.snS / 3);
                this.skyG2 = this.cnstG2 * (0.66 + this.snS / 3);
                this.skyB2 = this.cnstB2 * (0.66 + this.snS / 3);
                // lgb = New Drawing2D.LinearGradientBrush(skyrect, New Color(skyR, skyG, skyB), New Color(skyR2, skyG2, skyB2), 90)
                // g.FillRectangle(lgb, skyrect)

                this.UpdateSkyTexture(this.skytexture, this.skyrect.Height, this.skyR, this.skyG, this.skyB, 255, this.skyR2, this.skyG2, this.skyB2, 255);
                DarkKingdomCore.MyGame.FillRectangle(this.spriteBatch, this.skytexture, this.skyrect.$clone());

                if (this.snS > -0.5 && this.snS < 0.5) {
                    // sunsetlgb = New Drawing2D.LinearGradientBrush(skyrect, Color.Empty, Color.FromArgb((1 - Math.Abs(snS) * 2) * 100, sunsetclr), 90)
                    this.UpdateSkyTexture(this.sunsettexture, this.skyrect.Height, 0, 0, 0, 0, this.sunsetclr.R, this.sunsetclr.G, this.sunsetclr.B, (1 - Math.abs(this.snS) * 2) * 100);
                    DarkKingdomCore.MyGame.FillRectangle(this.spriteBatch, this.sunsettexture, this.skyrect.$clone());
                }
                // sunsetlgb = New Drawing2D.LinearGradientBrush(skyrect, Color.Empty, New Color((1 - Math.Abs(snS) * 2) * 100, sunsetclr), 90)
                // g.FillRectangle(sunsetlgb, skyrect)

                if (this.snS < 0) {
                    for (var i = 0; i < this.starsCnt; i = (i + 1) | 0) {
                        DarkKingdomCore.MyGame.FillRectangle$1(this.spriteBatch, this.starTex, Bridge.Int.clip32(this.stars[i].X), Bridge.Int.clip32(this.stars[i].Y), 1, 1);
                    }
                }



                $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.backpars);
                try {
                    while ($t.moveNext()) {
                        var p = Bridge.cast($t.Current, DarkKingdomCore.Particle);
                        p.XNADraw(this.spriteBatch);
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                for (var i1 = 0; i1 < DarkKingdomCore.MyGame.gameWidth; i1 = (i1 + 100) | 0) {
                    DarkKingdomCore.MyGame.sprites.getItem(this.landBmp).Draw$1(0, i1, ((DarkKingdomCore.MyGame.hor - 20) | 0), this.spriteBatch);
                }

                $t1 = Bridge.getEnumerator(DarkKingdomCore.MyGame.bushpars);
                try {
                    while ($t1.moveNext()) {
                        var p1 = Bridge.cast($t1.Current, DarkKingdomCore.Particle);
                        p1.XNADraw(this.spriteBatch);
                    }
                } finally {
                    if (Bridge.is($t1, System.IDisposable)) {
                        $t1.System$IDisposable$Dispose();
                    }
                }

                if (this.selU != null) {
                    DarkKingdomCore.MyGame.sprites.getItem("effects").Draw$1(0, this.selU.x + this.deltax - 14, ((DarkKingdomCore.MyGame.hor - 22) | 0), this.spriteBatch);
                    if (this.selU.Attack.Range > 1) {
                    }
                }

                $t2 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                try {
                    while ($t2.moveNext()) {
                        var u = $t2.Current;
                        if (u.owner === 0 || !u.AbsContains("Invisible")) {

                            // If u IsNot selU And u.x + u.params.rect.Right > m.X And m.X > u.x + u.params.rect.Left And hor + u.params.rect.Bottom > m.Y And m.Y > hor + u.params.rect.Top Then
                            // DrawSprite(spriteBatch, "effects", 0, u.x + deltax - 14, hor - 22)
                            // End If

                            this.deltay = 0;
                            this.deltax = 0;

                            if (!u.parameters.isBuilding && u.atkRecharge > ((u.parameters.Attack.Speed - 30) | 0) && u.atkRecharge < u.parameters.Attack.Speed) {
                                this.deltax = (Bridge.Int.div(Bridge.Int.mul(u.moveside, (((((u.atkRecharge - u.parameters.Attack.Speed) | 0) + 30) | 0))), 10)) | 0;
                            }

                            if (!u.isInCombat && u.parameters.moveType === DarkKingdomCore.UnitMoveType.FlyingMT) {
                                if (u.AbsContains("Bodyless")) {
                                    this.deltay = 3.0 * Math.sin(u.wingsWave);
                                } else {
                                    this.deltay = 2.0 * Math.sin(u.wingsWave);
                                }
                            }
                            DarkKingdomCore.MyGame.sprites.getItem("effects").Draw$1(1, u.x + this.deltax - 15, ((DarkKingdomCore.MyGame.hor - 22) | 0), this.spriteBatch);

                            if (u.moveside === 1) {
                                u.DrawCurrent(Bridge.Int.clip32(u.x + u.parameters.rect.Left + this.deltax + u.parameters.imgx), Bridge.Int.clip32(((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0) + this.deltay + u.parameters.imgy + 1), this.spriteBatch);
                            } else {
                                u.DrawCurrent(Bridge.Int.clip32(u.x + u.parameters.rect.Right + this.deltax - DarkKingdomCore.MyGame.sprites.getItem(u.parameters.spriteName).W - u.parameters.imgx), Bridge.Int.clip32(((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0) + this.deltay + u.parameters.imgy + 1), this.spriteBatch, Microsoft.Xna.Framework.Graphics.SpriteEffects.FlipHorizontally);
                            }

                            if (u.AbsContains("Invisible")) {
                                DarkKingdomCore.MyGame.sprites.getItem("effects").Draw$1(2, u.x - 16, ((((DarkKingdomCore.MyGame.hor + u.parameters.rect.Y) | 0) - 32) | 0), this.spriteBatch);
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t2, System.IDisposable)) {
                        $t2.System$IDisposable$Dispose();
                    }
                }


                $t3 = Bridge.getEnumerator(this.ammos);
                try {
                    while ($t3.moveNext()) {
                        var a = $t3.Current;
                        switch (a.type) {
                            case DarkKingdomCore.Ammo.AmmoType.Arrow: 
                            case DarkKingdomCore.Ammo.AmmoType.FastArrow: 
                                {
                                    var dx, dy;
                                    var n = Math.sqrt(a.vx * a.vx + a.vy * a.vy);
                                    dx = a.vx / n * 6;
                                    dy = a.vy / n * 6;
                                    break;
                                }
                            case DarkKingdomCore.Ammo.AmmoType.BigArrow: 
                                {
                                    var dx1, dy1;
                                    var n1 = Math.sqrt(a.vx * a.vx + a.vy * a.vy);
                                    dx1 = a.vx / n1 * 12;
                                    dy1 = a.vy / n1 * 12;
                                    break;
                                }
                            default: 
                                {
                                    if (a.vx >= 0) {
                                        DarkKingdomCore.MyGame.sprites.getItem("ammos").Draw$1(a.img, a.x - 5, a.y - 5, this.spriteBatch);
                                    } else {
                                        DarkKingdomCore.MyGame.sprites.getItem("ammos").Draw$1(a.img, a.x - 5, a.y - 5, this.spriteBatch, Microsoft.Xna.Framework.Graphics.SpriteEffects.FlipHorizontally);
                                    }
                                    break;
                                }
                        }
                    }
                } finally {
                    if (Bridge.is($t3, System.IDisposable)) {
                        $t3.System$IDisposable$Dispose();
                    }
                }


                $t4 = Bridge.getEnumerator(DarkKingdomCore.MyGame.pars);
                try {
                    while ($t4.moveNext()) {
                        var p2 = $t4.Current;
                        p2.XNADraw(this.spriteBatch);
                    }
                } finally {
                    if (Bridge.is($t4, System.IDisposable)) {
                        $t4.System$IDisposable$Dispose();
                    }
                }

                if (DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.InGame || DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.Win || DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.Lose) {
                    if (Bridge.referenceEquals(DarkKingdomCore.MyGame.plrs[0].hero, "Castle")) {
                        var castlebmp = (DarkKingdomCore.MyGame.plrs[0].castleFileName || "") + "1";
                        DarkKingdomCore.MyGame.sprites.getItem(castlebmp).Draw$1(0, 0, ((((DarkKingdomCore.MyGame.hor - Bridge.Int.mul(2, this.unitSize)) | 0) + 1) | 0), this.spriteBatch);
                    }
                    if (Bridge.referenceEquals(DarkKingdomCore.MyGame.plrs[1].hero, "Castle")) {
                        var castlebmp1 = (DarkKingdomCore.MyGame.plrs[1].castleFileName || "") + "1";
                        DarkKingdomCore.MyGame.sprites.getItem(castlebmp1).Draw$1(1, ((((DarkKingdomCore.MyGame.gameWidth - this.unitSize) | 0) + 1) | 0), ((((DarkKingdomCore.MyGame.hor - Bridge.Int.mul(2, this.unitSize)) | 0) + 2) | 0), this.spriteBatch);
                    }
                }

                if (this.snS < 0.2) {
                }

                if (this.snS > 0) {
                    DarkKingdomCore.MyGame.sprites.getItem("world").Draw$1(0, ((Bridge.Int.div(DarkKingdomCore.MyGame.gameWidth, 2)) | 0) - (((((Bridge.Int.div(DarkKingdomCore.MyGame.gameWidth, 2)) | 0) + 80) | 0)) * this.csS - 60, DarkKingdomCore.MyGame.gameHeight - (((DarkKingdomCore.MyGame.gameHeight - 140) | 0)) * this.snS - 60, this.spriteBatch);
                } else {
                    DarkKingdomCore.MyGame.sprites.getItem("world").Draw$1(1, ((Bridge.Int.div(DarkKingdomCore.MyGame.gameWidth, 2)) | 0) + (((((Bridge.Int.div(DarkKingdomCore.MyGame.gameWidth, 2)) | 0) + 80) | 0)) * this.csS - 60, DarkKingdomCore.MyGame.gameHeight + (((DarkKingdomCore.MyGame.gameHeight - 140) | 0)) * this.snS - 60, this.spriteBatch);
                }


                $t5 = Bridge.getEnumerator(DarkKingdomCore.MyGame.cloudpars);
                try {
                    while ($t5.moveNext()) {
                        var p3 = Bridge.cast($t5.Current, DarkKingdomCore.Particle);
                        p3.XNADraw(this.spriteBatch);
                    }
                } finally {
                    if (Bridge.is($t5, System.IDisposable)) {
                        $t5.System$IDisposable$Dispose();
                    }
                }


                $t6 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                try {
                    while ($t6.moveNext()) {
                        var u1 = $t6.Current;
                        if ((!u1.AbsContains("Invisible") || u1.owner === 0) && (u1.hp < u1.parameters.maxhp || Bridge.referenceEquals(u1, this.selU) || !Bridge.referenceEquals(u1.shownAbil, ""))) {
                            if (!u1.parameters.hpBotom) {
                                if (Bridge.referenceEquals(u1.shownAbil, "")) {
                                    DarkKingdomCore.MyGame.FillRectangle$1(this.spriteBatch, this.healthBarBackTex, ((((2 + Bridge.Int.clip32(u1.x)) | 0) + u1.parameters.rect.X) | 0), ((((DarkKingdomCore.MyGame.hor + u1.parameters.rect.Y) | 0) - 6) | 0), ((u1.parameters.rect.Width - 4) | 0), 4);
                                    if (u1.AbsContains("Poison")) {
                                        DarkKingdomCore.MyGame.FillRectangle$1(this.spriteBatch, this.healthBarPoisonTex, ((((3 + Bridge.Int.clip32(u1.x)) | 0) + u1.parameters.rect.X) | 0), ((((DarkKingdomCore.MyGame.hor + u1.parameters.rect.Y) | 0) - 5) | 0), Bridge.Int.clip32(u1.hp * (((u1.parameters.rect.Width - 6) | 0)) / u1.parameters.maxhp), 2);
                                    } else {
                                        DarkKingdomCore.MyGame.FillRectangle$1(this.spriteBatch, this.healthBarLifeTex, ((((3 + Bridge.Int.clip32(u1.x)) | 0) + u1.parameters.rect.X) | 0), ((((DarkKingdomCore.MyGame.hor + u1.parameters.rect.Y) | 0) - 5) | 0), Bridge.Int.clip32(u1.hp * (((u1.parameters.rect.Width - 6) | 0)) / u1.parameters.maxhp), 2);
                                    }
                                } else if (u1.abils.containsKey(u1.shownAbil)) {
                                    DarkKingdomCore.MyGame.FillRectangle$1(this.spriteBatch, this.healthBarBackTex, ((((2 + Bridge.Int.clip32(u1.x)) | 0) + u1.parameters.rect.X) | 0), ((((DarkKingdomCore.MyGame.hor + u1.parameters.rect.Y) | 0) - 9) | 0), ((u1.parameters.rect.Width - 4) | 0), 7);
                                    if (u1.AbsContains("Poison")) {
                                        DarkKingdomCore.MyGame.FillRectangle$1(this.spriteBatch, this.healthBarPoisonTex, ((((3 + Bridge.Int.clip32(u1.x)) | 0) + u1.parameters.rect.X) | 0), ((((DarkKingdomCore.MyGame.hor + u1.parameters.rect.Y) | 0) - 5) | 0), Bridge.Int.clip32(u1.hp * (((u1.parameters.rect.Width - 6) | 0)) / u1.parameters.maxhp), 2);
                                    } else {
                                        DarkKingdomCore.MyGame.FillRectangle$1(this.spriteBatch, this.healthBarLifeTex, ((((3 + Bridge.Int.clip32(u1.x)) | 0) + u1.parameters.rect.X) | 0), ((((DarkKingdomCore.MyGame.hor + u1.parameters.rect.Y) | 0) - 5) | 0), ((Bridge.Int.div(Bridge.Int.mul(Bridge.Int.clip32(u1.hp), (((u1.parameters.rect.Width - 6) | 0))), u1.parameters.maxhp)) | 0), 2);
                                    }
                                    DarkKingdomCore.MyGame.FillRectangle$1(this.spriteBatch, this.healthBarAbilTex, ((((3 + Bridge.Int.clip32(u1.x)) | 0) + u1.parameters.rect.X) | 0), ((((DarkKingdomCore.MyGame.hor + u1.parameters.rect.Y) | 0) - 8) | 0), ((Bridge.Int.div(Bridge.Int.mul(u1.abils.getItem(u1.shownAbil).value, (((u1.parameters.rect.Width - 6) | 0))), u1.shownAbilMaxVal)) | 0), 2);
                                } else {
                                    u1.shownAbil = "";
                                }
                            } else {
                                DarkKingdomCore.MyGame.FillRectangle$1(this.spriteBatch, this.healthBarBackTex, ((((2 + Bridge.Int.clip32(u1.x)) | 0) + u1.parameters.rect.X) | 0), ((DarkKingdomCore.MyGame.hor + 6) | 0), ((u1.parameters.rect.Width - 4) | 0), 5);
                                DarkKingdomCore.MyGame.FillRectangle$1(this.spriteBatch, this.healthBarLifeTex, ((((3 + Bridge.Int.clip32(u1.x)) | 0) + u1.parameters.rect.X) | 0), ((DarkKingdomCore.MyGame.hor + 7) | 0), Bridge.Int.clip32(u1.hp * (((u1.parameters.rect.Width - 6) | 0)) / u1.parameters.maxhp), 3);
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t6, System.IDisposable)) {
                        $t6.System$IDisposable$Dispose();
                    }
                }



                $t7 = Bridge.getEnumerator(DarkKingdomCore.MyGame.uipars);
                try {
                    while ($t7.moveNext()) {
                        var p4 = $t7.Current;
                        p4.XNADraw(this.spriteBatch);
                    }
                } finally {
                    if (Bridge.is($t7, System.IDisposable)) {
                        $t7.System$IDisposable$Dispose();
                    }
                }

                if (this.globalExplode > 0) {
                    this.globalExplode -= 2;
                }
            },
            Resize: function (ww, hh, fullscreen, uiScale) {
                if (uiScale === void 0) { uiScale = 1.0; }
                this._screenWidth = ww;
                this.scaleX = DarkKingdomCore.MyGame.gameWidth / this._screenWidth;
                this._screenHeight = hh;
                this.scaleY = DarkKingdomCore.MyGame.gameHeight / this._screenHeight;
                if ((this.MainContainer != null)) {
                    this.MainContainer.W = this._screenWidth;
                    this.MainContainer.H = this._screenHeight;
                    this.MainContainer.ChildrenScaleX = uiScale;
                    this.MainContainer.ChildrenScaleY = uiScale;
                    this.MainContainer.IsNeedRecalc = true;
                }

                this.graphics.PreferredBackBufferWidth = this._screenWidth;
                this.graphics.PreferredBackBufferHeight = this._screenHeight;
                this.graphics.IsFullScreen = fullscreen;
                this.graphics.ApplyChanges();
            },
            ShowInfoPar: function (txt, clr, x, y, harm, big) {
                if (big === void 0) { big = false; }
                if (!harm) {
                    DarkKingdomCore.MyGame.pars.add(new DarkKingdomCore.TextParticle(this.defaultTheme.GetFont(12), clr.$clone(), x, y, ((Bridge.Int.div(DarkKingdomCore.MyGame.rnd.Next$2(-10, 11), 10)) | 0), -2, 0.1, 50, txt));
                } else {
                    if (big) {
                        DarkKingdomCore.MyGame.pars.add(new DarkKingdomCore.TextParticle(this.defaultTheme.GetFont(12), clr.$clone(), x, y, 0, -0.35, -0.05, 75, txt));
                    } else {
                        DarkKingdomCore.MyGame.pars.add(new DarkKingdomCore.TextParticle(this.defaultTheme.GetFont(12), clr.$clone(), x, y, 0, -0.35, -0.05, 75, txt));
                    }
                }
            },
            OnSuccessfulAttack: function (dmg, u, trg, ignoreArmor) {
                var $t, $t1, $t2, $t3, $t4;
                this.Harm(trg, dmg, ignoreArmor, DarkKingdomCore.EffectType.Normal);
                if (!ignoreArmor) {
                    dmg *= trg.parameters._armor;
                }
                $t = Bridge.getEnumerator(u.abils.Values);
                try {
                    while ($t.moveNext()) {
                        var a = $t.Current;
                        if (a.condCompleted) {
                            switch (a.name) {
                                case "Selfdamage": 
                                    {
                                        this.Harm(u, dmg, true, DarkKingdomCore.EffectType.Bad);
                                        break;
                                    }
                                case "Denying": 
                                    {
                                        if (!trg.AbsContains$1(["Bodyless", "Machinery"]) && !trg.parameters.isBuilding && trg.hp <= a.value) {
                                            this.Kill(trg);
                                            this.ShowInfoPar("\u0414\u043e\u0431\u0438\u0432\u0430\u043d\u0438\u0435", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                                        }

                                        break;
                                    }
                                case "Vampirism": 
                                    {
                                        if (!trg.AbsContains$1(["Building", "Undead", "Machinery"])) {
                                            this.Heal(u, dmg / 2);
                                        }
                                        break;
                                    }
                                case "Crasher": 
                                    {
                                        if (!trg.parameters.isBuilding && dmg >= a.value && !Bridge.referenceEquals(trg.parameters.Armor, "None")) {
                                            trg.parameters.Armor = "None";
                                            this.ShowInfoPar("\u0411\u0440\u043e\u043d\u044f \u0440\u0430\u0437\u0440\u0443\u0448\u0435\u043d\u0430", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                        }

                                        break;
                                    }
                                case "Enjoy pain": 
                                    {
                                        if (!trg.parameters.isBuilding && trg.AbsContains("Poison")) {
                                            this.Heal(u, dmg);
                                        }
                                        break;
                                    }
                                case "Evil_eye": 
                                    {
                                        if (!trg.parameters.isBuilding && Bridge.referenceEquals(trg.parameters.Armor, "None") && !trg.AbsContains("Clumsiness")) {
                                            trg.AddAbility$1("Clumsiness", DarkKingdomCore.EffectType.Bad);
                                            this.ShowInfoPar("\u041e\u0441\u043b\u0430\u0431\u043b\u0435\u043d", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                        }

                                        break;
                                    }
                                case "Curser": 
                                    {
                                        if (!trg.parameters.isBuilding && !trg.AbsContains("Clumsiness")) {
                                            trg.AddAbility$1("Clumsiness", DarkKingdomCore.EffectType.Bad);
                                            this.ShowInfoPar("\u041e\u0441\u043b\u0430\u0431\u043b\u0435\u043d", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                        }

                                        break;
                                    }
                                case "Spikes_bomb": 
                                    {
                                        if (Bridge.referenceEquals(trg.parameters.Armor, "None") && !trg.AbsContains$1(["Building", "Undead", "Bodyless", "Machinery"])) {
                                            ($t1 = trg.parameters.$clone()).maxhp = ($t1.maxhp - Bridge.Int.clip32(dmg)) | 0;
                                        }
                                        break;
                                    }
                                case "Destroy_light_armor": 
                                    {
                                        if (!trg.parameters.isBuilding && Bridge.referenceEquals(trg.parameters.Armor, "Light")) {
                                            trg.parameters.Armor = "None";
                                            this.ShowInfoPar("\u0411\u0440\u043e\u043d\u044f \u0440\u0430\u0437\u0440\u0443\u0448\u0435\u043d\u0430", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                        }

                                        break;
                                    }
                                case "Destroy_heavy_armor": 
                                    {
                                        if (!trg.parameters.isBuilding && Bridge.referenceEquals(trg.parameters.Armor, "Heavy")) {
                                            trg.parameters.Armor = "None";
                                            this.ShowInfoPar("\u0411\u0440\u043e\u043d\u044f \u0440\u0430\u0437\u0440\u0443\u0448\u0435\u043d\u0430", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                        }

                                        break;
                                    }
                                case "Destroy_ethereal_armor": 
                                    {
                                        if (!trg.parameters.isBuilding && Bridge.referenceEquals(trg.parameters.Armor, "Ethereal")) {
                                            trg.parameters.Armor = "None";
                                            this.ShowInfoPar("\u0411\u0440\u043e\u043d\u044f \u0440\u0430\u0437\u0440\u0443\u0448\u0435\u043d\u0430", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                        }

                                        break;
                                    }
                                case "Levitation": 
                                    {
                                        if (trg.parameters.moveType === DarkKingdomCore.UnitMoveType.GroundMT && !trg.parameters.isBuilding && !u.isInRangeCombat) {
                                            trg.takedOff = true;
                                        }
                                        break;
                                    }
                                case "Purification": 
                                    {
                                        trg.purified = true;
                                        break;
                                    }
                                case "Purification_on_first_attack": 
                                    {
                                        if (!trg.parameters.isBuilding) {
                                            trg.purified = true;
                                            u.abils.getItem("Purification_on_first_attack").used = true;
                                        }

                                        break;
                                    }
                                case "CatchAbil": 
                                    {
                                        if (!trg.parameters.isBuilding && !u.isInRangeCombat && trg.parameters.moveType === DarkKingdomCore.UnitMoveType.FlyingMT) {
                                            u.landing = true;
                                            trg.landing = true;
                                            a.used = true;
                                        }

                                        break;
                                    }
                                case "Instant_kill": 
                                    {
                                        if (!trg.parameters.isBuilding && DarkKingdomCore.MyGame.rnd.Next$1(100) < a.value) {
                                            this.Kill(trg);
                                            u.hp -= trg.hp;
                                            this.ShowInfoPar("\u0423\u0431\u0438\u0442!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                                        }

                                        break;
                                    }
                                case "Crippling_injury": 
                                    {
                                        if (!trg.AbsContains$1(["Building", "Undead", "Bodyless", "Machinery"])) {
                                            ($t2 = trg.parameters.$clone()).maxhp = ($t2.maxhp - Bridge.Int.clip32(dmg)) | 0;
                                        }
                                        break;
                                    }
                                case "Plaguer": 
                                    {
                                        if (!trg.parameters.isBuilding && !trg.AbsContains("Plague")) {
                                            trg.AddAbility$1("Plague", DarkKingdomCore.EffectType.Bad);
                                            this.ShowInfoPar("\u0417\u0430\u0447\u0443\u043c\u043b\u0435\u043d!", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                        }

                                        break;
                                    }
                                case "Activate plague": 
                                    {
                                        if (trg.AbsContains("Plague")) {
                                            $t3 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                                            try {
                                                while ($t3.moveNext()) {
                                                    var uu = $t3.Current;
                                                    if (!uu.AbsContains$1(["Undead", "Machinery"]) && !uu.parameters.isBuilding && Math.abs(u.x - uu.x) <= Bridge.Int.mul(2, this.unitSize)) {
                                                        this.Harm(uu, DarkKingdomCore.MyGame.rnd.Next$2(10, 21), true, DarkKingdomCore.EffectType.Bad);
                                                    }
                                                }
                                            } finally {
                                                if (Bridge.is($t3, System.IDisposable)) {
                                                    $t3.System$IDisposable$Dispose();
                                                }
                                            }
                                        }

                                        break;
                                    }
                                case "Heavy_arrows": 
                                    {
                                        if (!trg.parameters.isBuilding && trg.parameters.moveType === DarkKingdomCore.UnitMoveType.FlyingMT && DarkKingdomCore.MyGame.rnd.Next$1(100) < a.value) {
                                            trg.landing = true;
                                        }
                                        break;
                                    }
                                case "Slower": 
                                    {
                                        if (!trg.parameters.isBuilding && !Bridge.referenceEquals(trg.parameters.Speed, "Slow")) {
                                            trg.parameters.Speed = "Slow";
                                            this.ShowInfoPar("\u0417\u0430\u043c\u0435\u0434\u043b\u0435\u043d!", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                        }

                                        break;
                                    }
                                case "Poisoner": 
                                    {
                                        if (DarkKingdomCore.MyGame.rnd.Next$1(100) < a.value) {
                                            this.Poison(trg);
                                        }
                                        break;
                                    }
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                if (u.isInRangeCombat) {
                    $t4 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                    try {
                        while ($t4.moveNext()) {
                            var uu1 = $t4.Current;
                            if (uu1.owner === u.owner && trg.Near(uu1) && uu1.AbsContains("Support_archers")) {
                                this.Harm(trg, DarkKingdomCore.MyGame.rnd.Next$2(10, 15), true, DarkKingdomCore.EffectType.Bad);
                            }
                        }
                    } finally {
                        if (Bridge.is($t4, System.IDisposable)) {
                            $t4.System$IDisposable$Dispose();
                        }
                    }
                }
            },
            Poison: function (trg) {
                if (!trg.AbsContains("Poison") && !trg.parameters.isBuilding) {
                    if (!trg.AbsContains$1(["Poisonproof", "Bodyless", "Machinery"])) {
                        trg.AddAbility$1("Poison", DarkKingdomCore.EffectType.Poison);
                        this.ShowInfoPar("\u041e\u0442\u0440\u0430\u0432\u043b\u0435\u043d!", DarkKingdomCore.MyGame.poiAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                    }
                }
            },
            OnPreAttack: function (u, trg, dmg) {
                var $t, $t1, $t2;
                var agil = false;
                $t = Bridge.getEnumerator(u.abils.Values);
                try {
                    while ($t.moveNext()) {
                        var a = $t.Current;
                        if (a.condCompleted) {
                            switch (a.name) {
                                case "We are pirates": 
                                    {
                                        do {
                                            ($t1 = DarkKingdomCore.MyGame.rnd.NextDouble());
                                            if (Bridge.is($t1, System.Object)) {
                                                var _discard1 = $t1;
                                                if (DarkKingdomCore.MyGame.rnd.NextDouble() < 0.33) {
                                                    {
                                                        this.ShowInfoPar("\u0419\u0430\u0440\u0440\u0440!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                                                        break;
                                                    }
                                                }
                                            }

                                            if (Bridge.is($t1, System.Object)) {
                                                var _discard2 = $t1;
                                                if (DarkKingdomCore.MyGame.rnd.NextDouble() < 0.66) {
                                                    {
                                                        this.ShowInfoPar("\u0421\u0443\u0445\u043e\u043f\u0443\u0442\u043d\u0430\u044f \u043a\u0440\u0440\u0440\u044b\u0441\u0430!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                                                        break;
                                                    }
                                                }
                                            }

                                            {
                                                {
                                                    this.ShowInfoPar("\u0422\u044b\u0441\u044f\u0447\u0430 \u0447\u0435\u0440\u0442\u0435\u0439!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                                                    break;
                                                }
                                            }
                                        } while (false);
                                        break;
                                    }
                                case "Attack_bonus": 
                                    {
                                        dmg.v += a.value;
                                        break;
                                    }
                                case "Shrapnel": 
                                    {
                                        if (u.isInRangeCombat) {
                                            dmg.v -= 20 * Math.abs(u.x - trg.x) / this.unitSize;
                                        }
                                        break;
                                    }
                                case "Snipering": 
                                    {
                                        if (u.isInRangeCombat && Math.abs(u.x - trg.x) >= ((Bridge.Int.mul(u.Attack.Range, this.unitSize) - this.us2) | 0)) {
                                            dmg.v += a.value;
                                        }
                                        break;
                                    }
                                case "Landshooter": 
                                    {
                                        if (trg.parameters.moveType === DarkKingdomCore.UnitMoveType.FlyingMT) {
                                            dmg.v /= 2;
                                        }
                                        break;
                                    }
                                case "Hate_flyers": 
                                    {
                                        if (trg.parameters.moveType === DarkKingdomCore.UnitMoveType.FlyingMT) {
                                            dmg.v *= 2;
                                        }
                                        break;
                                    }
                                case "Hate_giants": 
                                    {
                                        if (trg.parameters.moveType === DarkKingdomCore.UnitMoveType.HugeMT) {
                                            dmg.v *= 2;
                                        }
                                        break;
                                    }
                                case "Hate_poisoned": 
                                    {
                                        if (trg.AbsContains("Poison")) {
                                            dmg.v *= 2;
                                        }
                                        break;
                                    }
                                case "Hate mages": 
                                    {
                                        if (trg.AbsContains("Mage")) {
                                            dmg.v *= 2;
                                        }
                                        break;
                                    }
                                case "Spikes_bomb": 
                                    {
                                        if (Bridge.referenceEquals(trg.parameters.Armor, "None")) {
                                            dmg.v *= 2;
                                        }
                                        break;
                                    }
                                case "Brave": 
                                    {
                                        if (DarkKingdomCore.MyGame.rnd.Next$1(100) <= a.value) {
                                            dmg.v = 3 * dmg.v;
                                            this.ShowInfoPar("\u041a\u0440\u0438\u0442!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                                        }
                                        break;
                                    }
                                case "Kamikaze": 
                                    {
                                        if (!u.AbsContains("Explosive")) {
                                            this.Explode(u, u.AbsContains("Mage"));
                                        }
                                        this.Kill(u);
                                        break;
                                    }
                                case "Burst": 
                                    {
                                        if (!u.isInRangeCombat) {
                                            u.parameters.Speed = "Normal";
                                            u.abils.getItem("Burst").used = true;
                                            this.ShowInfoPar("\u0411\u0438\u0442\u0432\u0430!", DarkKingdomCore.MyGame.badAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                                        }

                                        break;
                                    }
                                case "Instability": 
                                    {
                                        if (trg.parameters.moveType === DarkKingdomCore.UnitMoveType.HugeMT || trg.AbsContains("Durability") && !u.isInRangeCombat) {
                                            this.Explode(u, u.AbsContains("Mage"));
                                            this.Kill(u);
                                        }

                                        break;
                                    }
                                case "Spawn_demons": 
                                    {
                                        if (u.isInRangeCombat && DarkKingdomCore.MyGame.plrs[u.owner].prdQ.Count > 0) {
                                            var u2 = new DarkKingdomCore.Unit(this, trg.x - Bridge.Int.mul(this.us2, u.moveside), u.moveside, u.owner, DarkKingdomCore.MyGame.unitPrms.getItem(DarkKingdomCore.MyGame.plrs[u.owner].prdQ.getItem(0)).$clone());
                                            this.bornList.add(u2);
                                            this.ShowInfoPar("\u041f\u0440\u0438\u0437\u0432\u0430\u043d!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u2.x, ((DarkKingdomCore.MyGame.hor + u2.parameters.rect.Top) | 0), true);
                                            DarkKingdomCore.MyGame.pars.add(new DarkKingdomCore.ImageParticle(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("explode"), 2), u2.x - 25, ((((((DarkKingdomCore.MyGame.hor + u2.parameters.rect.Bottom) | 0) - this.us2) | 0) - 25) | 0), 0, 0, 20));
                                            this.RemoveFromQueue(u.owner, 0);
                                        }

                                        break;
                                    }
                                case "Melee_penalty": 
                                    {
                                        if (!u.isInRangeCombat) {
                                            dmg.v /= 2;
                                        }
                                        break;
                                    }
                                case "Range_penalty": 
                                    {
                                        if (u.isInRangeCombat) {
                                            dmg.v /= 2;
                                        }
                                        break;
                                    }
                                case "First_shoot": 
                                    {
                                        if (u.isInRangeCombat) {
                                            dmg.v += a.value;
                                            u.abils.getItem("First_shoot").used = true;
                                            this.ShowInfoPar("\u0423\u0441\u0438\u043b\u0435\u043d\u043d\u044b\u0439 \u0432\u044b\u0441\u0442\u0440\u0435\u043b!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                                        }

                                        break;
                                    }
                                case "Soullink": 
                                    {
                                        dmg.v += DarkKingdomCore.MyGame.rnd.Next$2(10, 21);
                                        this.Harm(u, DarkKingdomCore.MyGame.rnd.Next$2(5, 11), true, DarkKingdomCore.EffectType.Bad);
                                        break;
                                    }
                                case "Invisible": 
                                    {
                                        this.Deinvisible(u);
                                        break;
                                    }
                                case "Clumsiness": 
                                    {
                                        if (DarkKingdomCore.MyGame.rnd.Next$1(100) < 20) {
                                            agil = true;
                                        }
                                        break;
                                    }
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                $t2 = Bridge.getEnumerator(trg.abils.Values);
                try {
                    while ($t2.moveNext()) {
                        var ta = $t2.Current;
                        if (ta.condCompleted) {
                            switch (ta.name) {
                                case "Agility": 
                                    {
                                        if (DarkKingdomCore.MyGame.rnd.Next$1(100) < ta.value) {
                                            agil = true;
                                        }
                                        break;
                                    }
                                case "Evasion": 
                                    {
                                        if (u.isInRangeCombat) {
                                            agil = true;
                                        }
                                        break;
                                    }
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t2, System.IDisposable)) {
                        $t2.System$IDisposable$Dispose();
                    }
                }
                if (u.AbsContains("Accuracy")) {
                    agil = false;
                }
                return agil;
            },
            OnAgil: function (u, trg) {
                var $t;
                $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                try {
                    while ($t.moveNext()) {
                        var uu = $t.Current;
                        if (!(uu.owner === u.owner) && uu.AbsContains("Punishment_on_miss")) {
                            this.Harm(u, DarkKingdomCore.MyGame.rnd.Next$2(20, 40), true, DarkKingdomCore.EffectType.Bad);
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                if (trg.AbsContains("Agility_rollback")) {
                    trg.Attack = DarkKingdomCore.Attack.op_Addition$1(trg.Attack.$clone(), (trg.abils.getItem("Agility_rollback").value) | 0);
                }
                if (trg.AbsContains("Kill_on_agil")) {
                    this.Kill(u);
                    this.ShowInfoPar("\u0410\u0430\u0430\u0430\u0430\u0430", DarkKingdomCore.MyGame.badAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), false);
                }
                if (trg.AbsContains("Harm_on_agil")) {
                    this.Harm(u, DarkKingdomCore.MyGame.rnd.Next$2(20, 41), true, DarkKingdomCore.EffectType.Bad);
                }
                if (trg.AbsContains("Trick")) {
                    this.Heal(trg, trg.parameters.maxhp);
                } else {
                    this.ShowInfoPar("0", DarkKingdomCore.MyGame.goodAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), false);
                }
            },
            CheckBasicConditions: function (u) {
                var $t;
                $t = Bridge.getEnumerator(u.abils.Values);
                try {
                    while ($t.moveNext()) {
                        var a = $t.Current;
                        if (a.used) {
                            a.condCompleted = false;
                        } else {
                            if (!Bridge.referenceEquals(a.condition, "")) {
                                switch (a.condition) {
                                    case "Tier": 
                                        {
                                            if (DarkKingdomCore.MyGame.plrs[u.owner].res.Tier >= a.condnum) {
                                                a.condCompleted = true;
                                            } else {
                                                a.condCompleted = false;
                                            }
                                            break;
                                        }
                                    case "Poisoned": 
                                        {
                                            if (u.AbsContains("Poison")) {
                                                a.condCompleted = true;
                                            } else {
                                                a.condCompleted = false;
                                            }
                                            break;
                                        }
                                    case "Low_health": 
                                        {
                                            if (u.hp <= 0.5 * u.parameters.maxhp) {
                                                a.condCompleted = true;
                                            } else {
                                                a.condCompleted = false;
                                            }
                                            break;
                                        }
                                    case "On_enemy_side": 
                                        {
                                            if ((u.moveside === 1 && u.x >= DarkKingdomCore.MyGame.gameWidth / 2.0) || (u.moveside === -1 && u.x <= DarkKingdomCore.MyGame.gameWidth / 2.0)) {
                                                a.condCompleted = true;
                                            } else {
                                                a.condCompleted = false;
                                            }
                                            break;
                                        }
                                    case "At_night": 
                                        {
                                            if (this.snS < 0) {
                                                a.condCompleted = true;
                                            } else {
                                                a.condCompleted = false;
                                            }
                                            break;
                                        }
                                    case "By_day": 
                                        {
                                            if (this.snS >= 0) {
                                                a.condCompleted = true;
                                            } else {
                                                a.condCompleted = false;
                                            }
                                            break;
                                        }
                                    case "Machine_army": 
                                        {
                                            if (this.machinenum >= a.condnum) {
                                                a.condCompleted = true;
                                            } else {
                                                a.condCompleted = false;
                                            }
                                            break;
                                        }
                                    case "On_enter": 
                                        {
                                            a.condCompleted = true;
                                            break;
                                        }
                                }
                            } else {
                                a.condCompleted = true;
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            },
            FindFirstUnflyUnit: function (plr) {
                var $t;
                var xres = 0;
                var ures = null;
                $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                try {
                    while ($t.moveNext()) {
                        var u = $t.Current;
                        if (u.owner === plr && !(u.parameters.moveType === DarkKingdomCore.UnitMoveType.FlyingMT) && !u.parameters.isBuilding) {
                            if (ures == null || (u.x - xres) * u.moveside > 0) {
                                xres = u.x;
                                ures = u;
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                return ures;
            },
            FindRandomUnflyUnit: function (plr) {
                var $t;
                var avunits = new (System.Collections.Generic.List$1(DarkKingdomCore.Unit)).ctor();
                $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                try {
                    while ($t.moveNext()) {
                        var u = $t.Current;
                        if (u.owner === plr && !(u.parameters.moveType === DarkKingdomCore.UnitMoveType.FlyingMT) && !u.parameters.isBuilding) {
                            avunits.add(u);
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                if (avunits.Count > 0) {
                    return avunits.getItem(DarkKingdomCore.MyGame.rnd.Next$1(avunits.Count));
                }
                return null;
            },
            FindRandomFlyUnit: function (plr, hpLim) {
                var $t;
                var avunits = new (System.Collections.Generic.List$1(DarkKingdomCore.Unit)).ctor();
                $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                try {
                    while ($t.moveNext()) {
                        var u = $t.Current;
                        if (u.owner === plr && u.parameters.moveType === DarkKingdomCore.UnitMoveType.FlyingMT && u.hp <= hpLim && !u.parameters.isBuilding) {
                            avunits.add(u);
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                if (avunits.Count > 0) {
                    return avunits.getItem(DarkKingdomCore.MyGame.rnd.Next$1(avunits.Count));
                }
                return null;
            },
            DoUnits: function () {
                var $t, $t1, $t2, $t3, $t4, $t5, $t6, $t7, $t8, $t9, $t10, $t11, $t12, $t13, $t14, $t15, $t16, $t17, $t18, $t19, $t20, $t21, $t22, $t23, $t24, $t25;
                var targets = new (System.Collections.Generic.List$1(DarkKingdomCore.Unit)).ctor();
                var newtargets = new (System.Collections.Generic.List$1(DarkKingdomCore.Unit)).ctor();
                var dmg = { };
                var stp;
                var nearestOne;
                $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                try {
                    while ($t.moveNext()) {
                        var u = $t.Current;
                        if (u.AbsContains("Power_of_unity")) {
                            u.parameters.Attack.MinDamage = Bridge.Int.mul(10, DarkKingdomCore.MyGame.plrs[u.owner].unitCount);
                            u.parameters.Attack.MaxDamage = Bridge.Int.mul(20, DarkKingdomCore.MyGame.plrs[u.owner].unitCount);
                        }

                        stp = false;
                        targets.clear();
                        nearestOne = -1;
                        u.atkMod.Range = 0;
                        u.parameters.isIgnoreUnits = false;
                        this.CheckBasicConditions(u);
                        this.OnUnitsAbils(u);
                        u.isInCombat = false;

                        $t1 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                        try {
                            while ($t1.moveNext()) {
                                var u2 = $t1.Current;
                                if (!Bridge.referenceEquals(u, u2)) {
                                    if (u.parameters._speed > 0) {
                                        if (!u.parameters.isIgnoreUnits) {
                                            if (u.parameters.Near(u2.parameters.$clone()) && u.moveside * (u2.x - u.x) > 0 && (u.moveside * (u2.x - u.x) < this.unitSize)) {
                                                if (!u2.parameters.isIgnoreUnits && (u.owner !== u2.owner || (u.AbsContains("Bodyless") === u2.AbsContains("Bodyless") && !u.AbsContains("Ignore_friends") && !u.AbsContains("Burst") && !u2.AbsContains("Weaponry") && !u2.parameters.isBuilding))) {
                                                    stp = true;
                                                }
                                                if (u.owner === u2.owner && !u.AbsContains("Mage") && u2.AbsContains("Weaponry")) {
                                                    this.Kill(u);
                                                    u2.hp += u.hp;
                                                    ($t2 = u2.parameters.$clone()).maxhp = ($t2.maxhp + Bridge.Int.clip32(u.hp)) | 0;
                                                    ($t3 = u2.parameters.Attack.$clone()).MinDamage = ($t3.MinDamage + u.parameters.Attack.MinDamage) | 0;
                                                    ($t4 = u2.parameters.Attack.$clone()).MaxDamage = ($t4.MaxDamage + u.parameters.Attack.MaxDamage) | 0;
                                                    ($t5 = DarkKingdomCore.MyGame.plrs[u.owner]).unitCount = ($t5.unitCount - 1) | 0;
                                                }
                                            }
                                        }
                                        if (u.moveside * (u2.x - u.x) >= 0 && u.moveside * (u2.x - u.x) < u.parameters._speed + u2.parameters._speed && u.parameters.Near(u2.parameters.$clone())) {
                                            if (u.owner !== u2.owner && u.AbsContains("Damage_on_move")) {
                                                if (u.AbsContains("Mage")) {
                                                    this.Harm(u2, DarkKingdomCore.MyGame.rnd.Next$2(50, 71), true, DarkKingdomCore.EffectType.Bad);
                                                } else {
                                                    this.Harm(u2, DarkKingdomCore.MyGame.rnd.Next$2(50, 71), false, DarkKingdomCore.EffectType.Normal);
                                                }
                                            }
                                            if (u.owner === u2.owner && u2.AbsContains("Money_treasure")) {
                                                u2.abils.getItem("Money_treasure").used = true;
                                                this.deathlist.add(u2);
                                                ($t6 = DarkKingdomCore.MyGame.plrs[u.owner].res.$clone()).Money = ($t6.Money + u2.abils.getItem("Money_treasure").value) | 0;
                                                this.ShowInfoPar(System.String.format("+{0}", [u2.abils.getItem("Money_treasure").value]), this.moneyClr.$clone(), u2.x, ((DarkKingdomCore.MyGame.hor + u2.parameters.rect.Top) | 0), true);
                                            }
                                        }
                                    } else {
                                        stp = true;
                                    }

                                    if (u.parameters.Attack.MaxDamage > 0) {
                                        if (u.owner !== u2.owner && (u.parameters.Near(u2.parameters.$clone()) || u.Attack.Range > 1)) {
                                            if ((u.moveside * (u2.x - u.x) > 0 && u.moveside * (u2.x - u.x) < Bridge.Int.mul(u.Attack.Range, this.unitSize)) && !u2.AbsContains("Invisible")) {
                                                if (nearestOne === -1) {
                                                    nearestOne = targets.Count;
                                                } else {
                                                    if (u.moveside * (targets.getItem(nearestOne).x - u2.x) > 0) {
                                                        nearestOne = targets.Count;
                                                    }
                                                }
                                                targets.add(u2);
                                                u.isInCombat = true;
                                            }
                                        }
                                    }
                                }
                            }
                        } finally {
                            if (Bridge.is($t1, System.IDisposable)) {
                                $t1.System$IDisposable$Dispose();
                            }
                        }
                        u.isInRangeCombat = false;
                        newtargets.clear();
                        if (targets.Count > 0) {
                            if (!u.AbsContains("Dragon_breath")) {
                                $t7 = Bridge.getEnumerator(targets);
                                try {
                                    while ($t7.moveNext()) {
                                        var trg = $t7.Current;
                                        if (u.Near(trg)) {
                                            newtargets.add(trg);
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t7, System.IDisposable)) {
                                        $t7.System$IDisposable$Dispose();
                                    }
                                }
                                if (newtargets.Count === 0) {
                                    if (u.AbsContains("Attack selected") && !DarkKingdomCore.MyGame.plrs[u.owner].AI) {
                                        if (targets.contains(this.selU)) {
                                            newtargets.add(this.selU);
                                            u.isInRangeCombat = true;
                                        }
                                    } else {
                                        newtargets.add(targets.getItem(nearestOne));
                                        u.isInRangeCombat = true;
                                    }
                                }
                            } else {
                                $t8 = Bridge.getEnumerator(targets);
                                try {
                                    while ($t8.moveNext()) {
                                        var trg1 = $t8.Current;
                                        newtargets.add(trg1);
                                    }
                                } finally {
                                    if (Bridge.is($t8, System.IDisposable)) {
                                        $t8.System$IDisposable$Dispose();
                                    }
                                }
                                u.isInRangeCombat = true;
                            }
                        }
                        if (newtargets.Count > 0) {
                            if (u.AbsContains("Hover")) {
                                stp = true;
                            }
                            if (u.atkRecharge === 0) {
                                if (u.parameters.animated) {
                                    u.StartAnimation("Attack", this.mainAnimator);
                                }
                                $t9 = Bridge.getEnumerator(newtargets);
                                try {
                                    while ($t9.moveNext()) {
                                        var trg2 = $t9.Current;
                                        $t10 = Bridge.getEnumerator(u.abils.Values);
                                        try {
                                            while ($t10.moveNext()) {
                                                var aa = $t10.Current;
                                                if (Bridge.referenceEquals(aa.condition, "On_attack")) {
                                                    aa.condCompleted = true;
                                                }
                                            }
                                        } finally {
                                            if (Bridge.is($t10, System.IDisposable)) {
                                                $t10.System$IDisposable$Dispose();
                                            }
                                        }
                                        dmg.v = DarkKingdomCore.MyGame.rnd.Next$2(u.Attack.MinDamage, ((u.Attack.MaxDamage + 1) | 0));

                                        if (this.OnPreAttack(u, trg2, dmg)) {
                                            if (u.isInRangeCombat && !(u.parameters.ammoType === DarkKingdomCore.Ammo.AmmoType.None)) {
                                                if (u.AbsContains("Rocket_shoot") && DarkKingdomCore.MyGame.rnd.Next$1(100) < u.abils.getItem("Rocket_shoot").value) {
                                                    this.ammos.add(new DarkKingdomCore.Ammo.ctor(u.owner, DarkKingdomCore.Ammo.AmmoType.RedBall, u.x, ((((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0) + this.us2) | 0), u, trg2, 0, false, true, 7200, true));
                                                } else {
                                                    this.ammos.add(new DarkKingdomCore.Ammo.ctor(u.owner, u.parameters.ammoType, u.x, ((((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0) + this.us2) | 0), u, trg2, 0, false, true, 7200));
                                                }
                                            } else {
                                                this.OnAgil(u, trg2);
                                            }
                                        } else {
                                            $t11 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                                            try {
                                                while ($t11.moveNext()) {
                                                    var uu = $t11.Current;
                                                    if (uu.owner === u.owner && uu.AbsContains("Ragequit") && DarkKingdomCore.MyGame.rnd.Next$1(5) === 0) {
                                                        this.Harm(uu, dmg.v, true, DarkKingdomCore.EffectType.Bad);
                                                        dmg.v = 3 * dmg.v;
                                                        this.ShowInfoPar("\u041a\u0440\u0438\u0442!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                                                    }
                                                }
                                            } finally {
                                                if (Bridge.is($t11, System.IDisposable)) {
                                                    $t11.System$IDisposable$Dispose();
                                                }
                                            }

                                            var ia = (u.AbsContains("Arbalester") && Bridge.referenceEquals(trg2.parameters.Armor, "Light")) || (u.AbsContains("Shooter") && (Bridge.referenceEquals(trg2.parameters.Armor, "Light") || Bridge.referenceEquals(trg2.parameters.Armor, "Heavy"))) || u.AbsContains("Mage");


                                            if (u.isInRangeCombat && !(u.parameters.ammoType === DarkKingdomCore.Ammo.AmmoType.None)) {
                                                if (u.AbsContains("Rocket_shoot") && DarkKingdomCore.MyGame.rnd.Next$1(100) < u.abils.getItem("Rocket_shoot").value) {
                                                    this.ammos.add(new DarkKingdomCore.Ammo.ctor(u.owner, DarkKingdomCore.Ammo.AmmoType.RedBall, u.x, ((((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0) + this.us2) | 0), u, trg2, dmg.v, ia, false, 7200, true));
                                                } else {
                                                    this.ammos.add(new DarkKingdomCore.Ammo.ctor(u.owner, u.parameters.ammoType, u.x, ((((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0) + this.us2) | 0), u, trg2, dmg.v, ia, false, 7200));
                                                }
                                            } else {
                                                this.OnSuccessfulAttack(dmg.v, u, trg2, ia);
                                            }
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t9, System.IDisposable)) {
                                        $t9.System$IDisposable$Dispose();
                                    }
                                }
                                u.atkRecharge = u.parameters.Attack.Speed;
                            }
                        }
                        if (u.poiRecharge > 0) {
                            u.poiRecharge = (u.poiRecharge - 1) | 0;
                        } else {
                            if (u.AbsContains("Regeneration")) {
                                this.Heal(u, DarkKingdomCore.MyGame.rnd.Next$2(20, 41));
                            }
                            if (u.AbsContains("Healing_aura")) {
                                $t12 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                                try {
                                    while ($t12.moveNext()) {
                                        var uu1 = $t12.Current;
                                        if (!Bridge.referenceEquals(u, uu1) && uu1.owner === u.owner && Math.abs(u.x - uu1.x) <= Bridge.Int.mul(2, this.unitSize) && !uu1.AbsContains("Undead")) {
                                            this.Heal(uu1, DarkKingdomCore.MyGame.rnd.Next$2(10, 21));
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t12, System.IDisposable)) {
                                        $t12.System$IDisposable$Dispose();
                                    }
                                }
                            }
                            if (u.AbsContains("Heal_first")) {
                                var tmpu = this.FindFirstUnflyUnit(u.owner);
                                if (tmpu != null) {
                                    this.Heal(tmpu, DarkKingdomCore.MyGame.rnd.Next$2(5, 11));
                                }
                            }
                            if (u.AbsContains("Mass_healing")) {
                                $t13 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                                try {
                                    while ($t13.moveNext()) {
                                        var uu2 = $t13.Current;
                                        if (!Bridge.referenceEquals(u, uu2) && uu2.owner === u.owner && !uu2.AbsContains("Undead")) {
                                            this.Heal(uu2, DarkKingdomCore.MyGame.rnd.Next$2(10, 21));
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t13, System.IDisposable)) {
                                        $t13.System$IDisposable$Dispose();
                                    }
                                }
                            }
                            if (u.AbsContains("Mass_repair")) {
                                $t14 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                                try {
                                    while ($t14.moveNext()) {
                                        var uu3 = $t14.Current;
                                        if (!Bridge.referenceEquals(u, uu3) && uu3.owner === u.owner && uu3.AbsContains("Machinery")) {
                                            this.Heal(uu3, DarkKingdomCore.MyGame.rnd.Next$2(20, 41), true);
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t14, System.IDisposable)) {
                                        $t14.System$IDisposable$Dispose();
                                    }
                                }
                            }
                            if (u.AbsContains("Plague")) {
                                $t15 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                                try {
                                    while ($t15.moveNext()) {
                                        var uu4 = $t15.Current;
                                        if (!uu4.parameters.isBuilding && Math.abs(u.x - uu4.x) <= Bridge.Int.mul(2, this.unitSize)) {
                                            if (uu4.AbsContains("Undead")) {
                                                this.Heal(uu4, DarkKingdomCore.MyGame.rnd.Next$2(10, 21));
                                            } else {
                                                if (!uu4.AbsContains("Machinery")) {
                                                    this.Harm(uu4, DarkKingdomCore.MyGame.rnd.Next$2(10, 21), true, DarkKingdomCore.EffectType.Bad);
                                                }
                                            }
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t15, System.IDisposable)) {
                                        $t15.System$IDisposable$Dispose();
                                    }
                                }
                            }
                            if (u.AbsContains("Extinction")) {
                                this.Harm(u, DarkKingdomCore.MyGame.rnd.Next$2(20, 41), true, DarkKingdomCore.EffectType.Normal);
                            }
                            if (u.AbsContains("Poison")) {
                                if (u.AbsContains("Poison resistance")) {
                                    this.Harm(u, ((DarkKingdomCore.MyGame.rnd.Next$2(20, 41) + DarkKingdomCore.MyGame.plrs[((1 - u.owner) | 0)].poisonBonus) | 0), true, DarkKingdomCore.EffectType.Poison);
                                } else {
                                    this.Harm(u, ((DarkKingdomCore.MyGame.rnd.Next$2(40, 81) + DarkKingdomCore.MyGame.plrs[((1 - u.owner) | 0)].poisonBonus) | 0), true, DarkKingdomCore.EffectType.Poison);
                                }
                                if (u.hp <= 0) {
                                    u.deathFromPoison = true;
                                }
                                $t16 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                                try {
                                    while ($t16.moveNext()) {
                                        var u21 = $t16.Current;
                                        if (!Bridge.referenceEquals(u21, u) && Math.abs(u21.x - u.x) <= Bridge.Int.mul(2, this.unitSize) && u21.AbsContains("Pain_absorber")) {
                                            this.Heal(u21, DarkKingdomCore.MyGame.rnd.Next$2(20, 41));
                                        }
                                        if (u21.AbsContains("Epidemy")) {
                                            if (DarkKingdomCore.MyGame.rnd.Next$1(100) < u21.abils.getItem("Epidemy").value) {
                                                $t17 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                                                try {
                                                    while ($t17.moveNext()) {
                                                        var u3 = $t17.Current;
                                                        if (Math.abs(u.x - u3.x) <= Bridge.Int.mul(2, this.unitSize)) {
                                                            this.Poison(u3);
                                                        }
                                                    }
                                                } finally {
                                                    if (Bridge.is($t17, System.IDisposable)) {
                                                        $t17.System$IDisposable$Dispose();
                                                    }
                                                }
                                            }
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t16, System.IDisposable)) {
                                        $t16.System$IDisposable$Dispose();
                                    }
                                }
                            }
                            u.poiRecharge = 120;
                        }

                        if (u.hp > 0) {
                            if (u.purified) {
                                if (!u.AbsContains$1(["Building", "Bodyless", "Eternal"])) {
                                    var showinfo = false;
                                    $t18 = Bridge.getEnumerator(u.abils.Values);
                                    try {
                                        while ($t18.moveNext()) {
                                            var aa1 = $t18.Current;
                                            if (!aa1.used) {
                                                aa1.used = true;
                                                showinfo = true;
                                            }
                                        }
                                    } finally {
                                        if (Bridge.is($t18, System.IDisposable)) {
                                            $t18.System$IDisposable$Dispose();
                                        }
                                    }
                                    if (showinfo) {
                                        this.ShowInfoPar("\u0417\u0430\u0431\u0432\u0435\u043d\u0438\u0435", DarkKingdomCore.MyGame.badAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                                    }
                                }
                                u.purified = false;
                            }
                            if (u.landing) {
                                if (!u.AbsContains("Durability")) {
                                    u.parameters.moveType = DarkKingdomCore.UnitMoveType.GroundMT;
                                }
                                u.landing = false;
                            }
                            if (u.takedOff) {
                                if (!u.AbsContains("Durability")) {
                                    u.parameters.moveType = DarkKingdomCore.UnitMoveType.FlyingMT;
                                }
                                u.takedOff = false;
                            }
                        } else {
                            this.Kill(u);
                        }

                        if (u.owner === 0 && u.x > ((DarkKingdomCore.MyGame.gameWidth + this.us2) | 0)) {
                            this.Kill(u);
                            if (this.gType === DarkKingdomCore.GameType.FirstHeroGT) {
                                DarkKingdomCore.MyGame.gState = DarkKingdomCore.GameState.Win;
                            }
                        }

                        if (u.owner === 1 && u.x < ((-this.us2) | 0)) {
                            this.Kill(u);
                            if (this.gType === DarkKingdomCore.GameType.FirstHeroGT) {
                                DarkKingdomCore.MyGame.gState = DarkKingdomCore.GameState.Lose;
                            }
                        }

                        if (!stp) {
                            if (u.AbsContains("Speed_bonus")) {
                                u.x += u.parameters._speed * u.moveside * 2;
                            } else {
                                u.x += u.parameters._speed * u.moveside;
                            }
                        }

                        if ((((-u.parameters.rect.Top) | 0) > u.parameters.rect.Height && !(u.parameters.moveType === DarkKingdomCore.UnitMoveType.FlyingMT)) || (((-u.parameters.rect.Top) | 0) > ((this.flyHeight + u.parameters.rect.Height) | 0) && u.parameters.moveType === DarkKingdomCore.UnitMoveType.FlyingMT)) {
                            ($t19 = u.parameters.rect.$clone()).Y = ($t19.Y + 3) | 0;
                        }
                        if (((-u.parameters.rect.Top) | 0) < ((this.flyHeight + u.parameters.rect.Height) | 0) && u.parameters.moveType === DarkKingdomCore.UnitMoveType.FlyingMT) {
                            ($t20 = u.parameters.rect.$clone()).Y = ($t20.Y - 3) | 0;
                        }

                        if (u.wingsWave < 6.2831853071795862) {
                            u.wingsWave += this.piece;
                        } else {
                            u.wingsWave = 0;
                        }

                        if (u.atkRecharge > 0) {
                            u.atkRecharge = (u.atkRecharge - 1) | 0;
                        }

                        if (!(DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.InGame)) {
                            break;
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                if (DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.InGame) {
                    if (this.bornList.Count > 0) {
                        $t21 = Bridge.getEnumerator(this.bornList);
                        try {
                            while ($t21.moveNext()) {
                                var u1 = $t21.Current;
                                ($t22 = DarkKingdomCore.MyGame.plrs[u1.owner]).uCount = ($t22.uCount + 1) | 0;
                                DarkKingdomCore.MyGame.units.add(u1);
                            }
                        } finally {
                            if (Bridge.is($t21, System.IDisposable)) {
                                $t21.System$IDisposable$Dispose();
                            }
                        }
                        this.bornList.clear();
                    }
                    if (this.deathlist.Count > 0) {
                        var u_int = 0;
                        while (u_int < this.deathlist.Count) {
                            {
                                var abil = this.deathlist.getItem(u_int);
                                if (Bridge.referenceEquals(abil.parameters.Name, DarkKingdomCore.MyGame.plrs[0].hero) || Bridge.referenceEquals(abil.parameters.Name, DarkKingdomCore.MyGame.plrs[1].hero)) {
                                    abil.hp = 0;
                                    if (Bridge.referenceEquals(this.deathlist.getItem(u_int), this.selU)) {
                                        this.selU = null;
                                    }
                                    if (abil.owner === 0) {
                                        DarkKingdomCore.MyGame.gState = DarkKingdomCore.GameState.Lose;
                                    }
                                    if (abil.owner === 1) {
                                        DarkKingdomCore.MyGame.gState = DarkKingdomCore.GameState.Win;
                                    }
                                } else if (this.OnDead(this.deathlist.getItem(u_int))) {
                                    ($t23 = DarkKingdomCore.MyGame.plrs[abil.owner]).uCount = ($t23.uCount - 1) | 0;
                                    ($t24 = DarkKingdomCore.MyGame.plrs[abil.owner]).statDeaths = ($t24.statDeaths + 1) | 0;
                                    DarkKingdomCore.MyGame.units.remove(this.deathlist.getItem(u_int));
                                    $t25 = Bridge.getEnumerator(this.ammos);
                                    try {
                                        while ($t25.moveNext()) {
                                            var a = $t25.Current;
                                            if (Bridge.referenceEquals(a.target, this.deathlist.getItem(u_int))) {
                                                a.target = null;
                                            }
                                        }
                                    } finally {
                                        if (Bridge.is($t25, System.IDisposable)) {
                                            $t25.System$IDisposable$Dispose();
                                        }
                                    }
                                }
                            }
                            u_int = (u_int + 1) | 0;
                        }
                        this.deathlist.clear();
                    }
                }
            },
            TryAddToQueueUnit: function (plr, name) {
                if (plr.CheckForProduce(name)) {
                    plr.res = DarkKingdomCore.TimeCost.op_Subtraction(plr.res.$clone(), DarkKingdomCore.MyGame.unitPrms.getItem(name).$clone().Cost.$clone());
                    plr.prdQ.add(name);
                    if (DarkKingdomCore.MyGame.unitPrms.getItem(name).$clone().support) {
                        plr.aisupportstreak = (plr.aisupportstreak + 1) | 0;
                        plr.aidefencestreak = 0;
                    } else {
                        plr.aidefencestreak = (plr.aidefencestreak + 1) | 0;
                        plr.aisupportstreak = 0;
                    }
                    if (plr.id === 0) {
                        this.UpdateQueue();
                    }
                    return true;
                }
                return false;
            },
            RemoveFromQueue: function (plr, pos) {
                DarkKingdomCore.MyGame.plrs[plr].prdQ.removeAt(pos);
                if (pos === 0) {
                    DarkKingdomCore.MyGame.plrs[plr].prdPrg = 0;
                }
                if (plr === 0) {
                    this.UpdateQueue();
                }
            },
            CheckStack: function (uname, plr) {
                var $t;
                var addition = false;
                if (DarkKingdomCore.MyGame.unitPrms.getItem(uname).$clone().moveType === DarkKingdomCore.UnitMoveType.FlyingMT) {
                    $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                    try {
                        while ($t.moveNext()) {
                            var u = $t.Current;
                            if (u.owner === plr && u.AbsContains("Dragon_boss")) {
                                addition = true;
                                break;
                            }
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                }
                return DarkKingdomCore.MyGame.unitPrms.getItem(uname).$clone().AbsContains("Stack") || addition;
            },
            CheckKeys: function () {
                var $t;
                $t = Bridge.getEnumerator(this.listeningKeys);
                try {
                    while ($t.moveNext()) {
                        var key = $t.Current;
                        if (Microsoft.Xna.Framework.Input.Keyboard.GetState().IsKeyUp(key) && this.oldKeyboardState.IsKeyDown(key)) {
                            return key;
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                if (Microsoft.Xna.Framework.Input.GamePad.GetState(Microsoft.Xna.Framework.PlayerIndex.One).Buttons.Back === Microsoft.Xna.Framework.Input.ButtonState.Pressed) {
                    return Microsoft.Xna.Framework.Input.Keys.Escape;
                }
                return Microsoft.Xna.Framework.Input.Keys.None;
            },
            Update: function () {
                var $t, $t1, $t2, $t3, $t4, $t5, $t6, $t7, $t8, $t9;
                this.mainAnimator.Do();
                this.frmHelp.Visible = false;
                if (this.frmProduction.Visible) {
                    $t = Bridge.getEnumerator(this.btnsProduction);
                    try {
                        while ($t.moveNext()) {
                            var btn = $t.Current;
                            btn.Children.getItem(2).Visible = false;
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                }

                var m = Microsoft.Xna.Framework.Input.Mouse.GetState();
                if (m.LeftButton === Microsoft.Xna.Framework.Input.ButtonState.Released && this.oldMouseState.LeftButton === Microsoft.Xna.Framework.Input.ButtonState.Pressed) {
                    this.MouseClicked(new Microsoft.Xna.Framework.Vector2.$ctor2(m.Position.X, m.Position.Y));
                }
                this.oldMouseState = m.$clone();

                if (Microsoft.Xna.Framework.Input.Touch.TouchPanel.IsGestureAvailable) {
                    var gs = Microsoft.Xna.Framework.Input.Touch.TouchPanel.ReadGesture();
                    if (gs.GestureType === Microsoft.Xna.Framework.Input.Touch.GestureType.Tap) {
                        this.MouseClicked(new Microsoft.Xna.Framework.Vector2.$ctor2(gs.Position.X, gs.Position.Y), true);
                    }
                }


                this.MainContainer.HighlightButton(m.X, m.Y, m.LeftButton === Microsoft.Xna.Framework.Input.ButtonState.Pressed);

                var touches = new (System.Collections.Generic.List$1(Microsoft.Xna.Framework.Input.Touch.TouchLocation)).$ctor1(Microsoft.Xna.Framework.Input.Touch.TouchPanel.GetState());

                // If touches IsNot Nothing Then
                if (touches.Count > 0) {
                    $t1 = Bridge.getEnumerator(touches);
                    try {
                        while ($t1.moveNext()) {
                            var tt = $t1.Current.$clone();
                            if ((tt.State === Microsoft.Xna.Framework.Input.Touch.TouchLocationState.Pressed || tt.State === Microsoft.Xna.Framework.Input.Touch.TouchLocationState.Moved)) {
                                this.MainContainer.TapAndHoldButton(Bridge.Int.clip32(tt.Position.X), Bridge.Int.clip32(tt.Position.Y));
                                break;
                            }
                        }
                    } finally {
                        if (Bridge.is($t1, System.IDisposable)) {
                            $t1.System$IDisposable$Dispose();
                        }
                    }
                }
                // End If

                if (DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.InGame) {
                    $t2 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                    try {
                        while ($t2.moveNext()) {
                            var u = $t2.Current;
                            if (u.x + u.parameters.rect.Right > m.X && m.X > u.x + u.parameters.rect.Left && ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Bottom) | 0) > m.Y && m.Y > ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0)) {
                                if (u.owner === 0 || !u.AbsContains("Invisible")) {
                                    this.ShowUnitInfo(u.parameters.$clone(), u.owner, false, null, u);
                                    break;
                                }
                            }
                        }
                    } finally {
                        if (Bridge.is($t2, System.IDisposable)) {
                            $t2.System$IDisposable$Dispose();
                        }
                    }
                    if (this.selU != null) {
                        this.ShowUnitInfo(this.selU.parameters.$clone(), this.selU.owner, false, null, this.selU);
                    }
                }


                var key = this.CheckKeys();
                if (key !== Microsoft.Xna.Framework.Input.Keys.None) {
                    this.MainContainer.ClickButton(key);
                }

                this.oldKeyboardState = Microsoft.Xna.Framework.Input.Keyboard.GetState();

                if (DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.InGame) {
                    if (this.curM < DarkKingdomCore.MyGame.plrs[0].res.Money) {
                        if (((DarkKingdomCore.MyGame.plrs[0].res.Money - this.curM) | 0) <= 50) {
                            this.curM = (this.curM + 5) | 0;
                        } else {
                            this.curM = (this.curM + 20) | 0;
                        }
                    } else if (this.curM > DarkKingdomCore.MyGame.plrs[0].res.Money) {
                        if (((this.curM - DarkKingdomCore.MyGame.plrs[0].res.Money) | 0) <= 50) {
                            this.curM = (this.curM - 5) | 0;
                        } else {
                            this.curM = (this.curM - 20) | 0;
                        }
                    }
                    if (this.curD < DarkKingdomCore.MyGame.plrs[0].res.Death) {
                        this.curD = (this.curD + 1) | 0;
                    } else {
                        if (this.curD > DarkKingdomCore.MyGame.plrs[0].res.Death) {
                            this.curD = (this.curD - 1) | 0;
                        }
                    }

                    this.UpdateResources();
                }

                this.MainContainer.Recalc();

                if (this.Pause) {
                    return;
                }

                var i;
                var t;

                if (this.snS > 0) {
                    DarkKingdomCore.MyGame.goodAbilClr = Microsoft.Xna.Framework.Color.DarkBlue.$clone();
                    DarkKingdomCore.MyGame.poiAbilClr = Microsoft.Xna.Framework.Color.DarkGreen.$clone();
                } else {
                    DarkKingdomCore.MyGame.goodAbilClr = Microsoft.Xna.Framework.Color.LightBlue.$clone();
                    DarkKingdomCore.MyGame.poiAbilClr = Microsoft.Xna.Framework.Color.LightGreen.$clone();
                }
                if (DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.InGame) {
                    $t3 = Bridge.getEnumerator(DarkKingdomCore.MyGame.plrs);
                    try {
                        while ($t3.moveNext()) {
                            var p = $t3.Current;
                            p.prdSpd = 1;
                            p.magicIncBonus = 0;
                            p.moneyIncBonus = 0;
                            p.poisonBonus = 0;
                            p.banned.clear();
                        }
                    } finally {
                        if (Bridge.is($t3, System.IDisposable)) {
                            $t3.System$IDisposable$Dispose();
                        }
                    }
                    $t4 = Bridge.getEnumerator(DarkKingdomCore.MyGame.plrs);
                    try {
                        while ($t4.moveNext()) {
                            var p1 = $t4.Current;
                            if (p1.rushBonus > 0) {
                                p1.prdSpd *= 2;
                            }
                        }
                    } finally {
                        if (Bridge.is($t4, System.IDisposable)) {
                            $t4.System$IDisposable$Dispose();
                        }
                    }
                    this.machinenum = 0;
                    $t5 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                    try {
                        while ($t5.moveNext()) {
                            var u1 = $t5.Current;
                            if (u1.AbsContains("Machinery")) {
                                this.machinenum = (this.machinenum + 1) | 0;
                            }
                        }
                    } finally {
                        if (Bridge.is($t5, System.IDisposable)) {
                            $t5.System$IDisposable$Dispose();
                        }
                    }
                    this.DoUnits();
                    for (i = 0; i < DarkKingdomCore.MyGame.plrs[0].spllsList.Count; i = (i + 1) | 0) {
                        if (DarkKingdomCore.MyGame.plrs[0].spellsRchrg.getItem(i) > 0) {
                            DarkKingdomCore.MyGame.plrs[0].spellsRchrg.setItem(i, DarkKingdomCore.MyGame.plrs[0].spellsRchrg.getItem(i) -1);
                            if (DarkKingdomCore.MyGame.plrs[0].spellsRchrg.getItem(i) > 0) {
                                Bridge.cast(Bridge.cast(this.cSpells.Children.getItem(i), MonoInterface.Button).Children.getItem(1), MonoInterface.Progress).MaxValue = this.spells.getItem(DarkKingdomCore.MyGame.plrs[0].spllsList.getItem(i)).Cost.Time;
                                Bridge.cast(Bridge.cast(this.cSpells.Children.getItem(i), MonoInterface.Button).Children.getItem(1), MonoInterface.Progress).CurrentValue = DarkKingdomCore.MyGame.plrs[0].spellsRchrg.getItem(i);
                            }
                        }
                    }
                    $t6 = Bridge.getEnumerator(DarkKingdomCore.MyGame.plrs);
                    try {
                        while ($t6.moveNext()) {
                            var plr = $t6.Current;
                            {
                                var abil = plr;
                                if (abil.resDelay > 0) {
                                    abil.resDelay = (abil.resDelay - 1) | 0;
                                } else {
                                    var val = (((abil.startInco + Bridge.Int.mul(abil.ipt, (((abil.res.Tier - 1) | 0)))) | 0) + abil.moneyIncBonus) | 0;
                                    abil.Resources = DarkKingdomCore.TimeCost.op_Addition(abil.Resources.$clone(), new DarkKingdomCore.TimeCost.$ctor1(val, abil.magicIncBonus, 0, 0));
                                    if (abil.id === 0) {
                                        this.ShowInfoPar("+" + val, this.moneyClr.$clone(), this.unitSize, ((DarkKingdomCore.MyGame.hor - 60) | 0), true);
                                    }
                                    abil.resDelay = 450;
                                }
                                if (abil.prdQ.Count > 0) {
                                    abil.prdPrg += abil.prdSpd;
                                    if (plr.id === 0) {
                                        this.UpdateQueue();
                                    }

                                    if (abil.prdPrg >= DarkKingdomCore.MyGame.unitPrms.getItem(abil.prdQ.getItem(0)).$clone().Cost.Time) {
                                        if (abil.rushBonus > 0) {
                                            abil.rushBonus = (abil.rushBonus - 1) | 0;
                                        }
                                        this.AddToReadyUnits(plr, abil.prdQ.getItem(0));
                                        this.RemoveFromQueue(abil.id, 0);
                                        if (abil.AI && abil.readyUnits.Count >= 3) {
                                            $t7 = Bridge.getEnumerator(abil.readyUnits);
                                            try {
                                                while ($t7.moveNext()) {
                                                    var u2 = $t7.Current;
                                                    this.ProduceUnit(abil.id, u2);
                                                }
                                            } finally {
                                                if (Bridge.is($t7, System.IDisposable)) {
                                                    $t7.System$IDisposable$Dispose();
                                                }
                                            }
                                            abil.readyUnits.clear();
                                        }
                                    }
                                }
                                if (abil.AI) {
                                    if (abil.curAIVal > 0) {
                                        abil.curAIVal = (abil.curAIVal - 1) | 0;
                                    } else {
                                        abil.AITick(this);
                                        abil.curAIVal = abil.maxAIVal;
                                    }
                                }
                            }
                        }
                    } finally {
                        if (Bridge.is($t6, System.IDisposable)) {
                            $t6.System$IDisposable$Dispose();
                        }
                    }
                    i = 0;
                    while (i < this.ammos.Count) {
                        {
                            var abil1 = this.ammos.getItem(i);
                            abil1.x += abil1.vx;
                            abil1.y += abil1.vy;
                            abil1.lifetime -= 1;
                            if (abil1.target != null) {
                                t = (abil1.target.x - abil1.x) / abil1.vx;
                                if (t !== 0) {
                                    abil1.vy = (((((DarkKingdomCore.MyGame.hor + abil1.target.parameters.rect.Top) | 0) + 15) | 0) - abil1.y) / t - abil1.ay * t / 2;
                                } else {
                                    abil1.vy = -1;
                                }
                            } else {
                                abil1.vy += abil1.ay;
                            }
                            $t8 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                            try {
                                while ($t8.moveNext()) {
                                    var u3 = $t8.Current;
                                    if (abil1.plr !== u3.owner) {
                                        if ((u3.x + u3.parameters.rect.Right >= abil1.x && abil1.x >= u3.x + u3.parameters.rect.Left && ((DarkKingdomCore.MyGame.hor + u3.parameters.rect.Bottom) | 0) >= abil1.y && abil1.y >= ((DarkKingdomCore.MyGame.hor + u3.parameters.rect.Top) | 0))) {
                                            if (abil1.agil) {
                                                this.OnAgil(abil1.owner, u3);
                                                if (abil1.explosive) {
                                                    this.Explode(u3, abil1.owner.AbsContains("Mage"));
                                                }
                                            } else if (abil1.owner != null) {
                                                this.OnSuccessfulAttack(abil1.dmg, abil1.owner, u3, abil1.ignoreArmor);
                                                if (abil1.explosive) {
                                                    this.Explode(u3, abil1.owner.AbsContains("Mage"));
                                                }
                                            } else {
                                                if (abil1.explosive) {
                                                    this.Explode(u3, false);
                                                }
                                                this.Harm(u3, abil1.dmg, abil1.ignoreArmor, DarkKingdomCore.EffectType.Normal);
                                            }
                                            if (abil1.type === DarkKingdomCore.Ammo.AmmoType.Bomb) {
                                                DarkKingdomCore.MyGame.pars.add(new DarkKingdomCore.ImageParticle(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("explode"), 1), abil1.x - 12, abil1.y - 12, 0, 0, 20));
                                            }
                                            this.ammos.removeAt(i);
                                            i = (i - 1) | 0;
                                            break;
                                        }
                                    }
                                }
                            } finally {
                                if (Bridge.is($t8, System.IDisposable)) {
                                    $t8.System$IDisposable$Dispose();
                                }
                            }
                            if (abil1.y >= DarkKingdomCore.MyGame.hor) {
                                if (abil1.type === DarkKingdomCore.Ammo.AmmoType.Bomb) {
                                    DarkKingdomCore.MyGame.pars.add(new DarkKingdomCore.ImageParticle(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("explode"), 1), abil1.x - 12, abil1.y - 12, 0, 0, 20));
                                }
                                this.ammos.removeAt(i);
                                i = (i - 1) | 0;
                            }
                            if (abil1.lifetime <= 0) {
                                this.ammos.removeAt(i);
                                i = (i - 1) | 0;
                            }
                            i = (i + 1) | 0;
                        }
                    }
                }
                i = 0;
                while (i < DarkKingdomCore.MyGame.pars.Count) {
                    {
                        var abil2 = DarkKingdomCore.MyGame.pars.getItem(i);
                        abil2.ltime = (abil2.ltime - 1) | 0;
                        abil2.x += abil2.dx;
                        abil2.y += abil2.dy;
                        abil2.dy += abil2.ay;
                        abil2.a -= abil2.ast;
                        if (abil2.dy > 0 && abil2.y >= ((((DarkKingdomCore.MyGame.hor - this.unitSize) | 0) + 2) | 0)) {
                            abil2.y = (((DarkKingdomCore.MyGame.hor - this.unitSize) | 0) + 3) | 0;
                            abil2.dy = 0;
                        }
                        if (abil2.ltime === 0) {
                            DarkKingdomCore.MyGame.pars.removeAt(i);
                        } else {
                            i = (i + 1) | 0;
                        }
                    }
                }

                $t9 = Bridge.getEnumerator(DarkKingdomCore.MyGame.cloudpars);
                try {
                    while ($t9.moveNext()) {
                        var p2 = Bridge.cast($t9.Current, DarkKingdomCore.Particle);
                        p2.x += p2.dx;
                        if (p2.x >= ((DarkKingdomCore.MyGame.gameWidth + 75) | 0)) {
                            p2.x = -100;
                        }
                    }
                } finally {
                    if (Bridge.is($t9, System.IDisposable)) {
                        $t9.System$IDisposable$Dispose();
                    }
                }


                if (this.updateSpells) {
                    this.SetSpells();
                }
                if (DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.InGame && this.snS > 0 && this.gType === DarkKingdomCore.GameType.DefenceGT) {
                    DarkKingdomCore.MyGame.gState = DarkKingdomCore.GameState.Win;
                }
                if (DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.InGame && this.snS < 0 && this.gType === DarkKingdomCore.GameType.OffenceGT) {
                    DarkKingdomCore.MyGame.gState = DarkKingdomCore.GameState.Lose;
                }
                this.oldsnS = this.snS;
                this.snS = this.snS * this.csD + this.csS * this.snD;
                this.csS = this.csS * this.csD - this.oldsnS * this.snD;
                if (DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.Lose || DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.Win) {
                    this.EndOfBattle();
                }
            },
            EndOfBattle: function () {
                this._pause = true;
                this.frmDialog.Show(this.mainAnimator);
                if (DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).racesPlays.containsKey(DarkKingdomCore.MyGame.plrs[0].race)) {
                    DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).racesPlays.setItem(DarkKingdomCore.MyGame.plrs[0].race, (DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).racesPlays.getItem(DarkKingdomCore.MyGame.plrs[0].race) + 1) | 0);
                    if (DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.Win) {
                        DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).racesWins.setItem(DarkKingdomCore.MyGame.plrs[0].race, (DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).racesWins.getItem(DarkKingdomCore.MyGame.plrs[0].race) + 1) | 0);
                    }
                } else {
                    DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).racesPlays.add(DarkKingdomCore.MyGame.plrs[0].race, 1);
                    if (DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.Win) {
                        DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).racesWins.add(DarkKingdomCore.MyGame.plrs[0].race, 1);
                    } else {
                        if (DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.Lose) {
                            DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).racesWins.add(DarkKingdomCore.MyGame.plrs[0].race, 0);
                        }
                    }
                }
                switch (DarkKingdomCore.MyGame.gState) {
                    case DarkKingdomCore.GameState.Win: 
                        {
                            this.lblTitlefrmDialog.Text = "\u0412\u044b \u043f\u043e\u0431\u0435\u0434\u0438\u043b\u0438!";
                            break;
                        }
                    case DarkKingdomCore.GameState.Lose: 
                        {
                            this.lblTitlefrmDialog.Text = "\u0412\u044b \u043f\u0440\u043e\u0438\u0433\u0440\u0430\u043b\u0438!";
                            break;
                        }
                }
                this.lblLine1FrmDialog.Text = System.String.format("\u0412\u0430\u0448\u0438 \u043f\u043e\u0442\u0435\u0440\u0438: {0}", [DarkKingdomCore.MyGame.plrs[0].statDeaths]);
                this.lblLine2FrmDialog.Text = System.String.format("\u041f\u043e\u0442\u0435\u0440\u0438 \u043f\u0440\u043e\u0442\u0438\u0432\u043d\u0438\u043a\u0430: {0}", [DarkKingdomCore.MyGame.plrs[1].statDeaths]);
            },
            ShowUnitInfo: function (up, own, cstHighlight, pnt, unt) {
                var $t;
                if (pnt === void 0) { pnt = null; }
                if (unt === void 0) { unt = null; }
                this.lblUnitNameHelpUnit.Text = this.localize.GetString(up.Name);
                if (Bridge.referenceEquals(up.Subrace, "")) {
                    this.lblRaceHelpUnit.Text = this.localize.GetString(up.Race);
                } else {
                    this.lblRaceHelpUnit.Text = System.String.format("{0} - {1}", this.localize.GetString(up.Race), this.localize.GetString(up.Subrace));
                }

                this.lblCostMoneyHelpUnit.Text = Bridge.toString(up.Cost.Money);
                if (DarkKingdomCore.MyGame.plrs[0].res.Money < up.Cost.Money && cstHighlight) {
                    this.lblCostMoneyHelpUnit.TextColor = Microsoft.Xna.Framework.Color.Red.$clone();
                } else {
                    this.lblCostMoneyHelpUnit.TextColor = this.moneyClr.$clone();
                }


                if (up.Cost.Death > 0) {
                    this.lblCostDeathHelpUnit.Text = Bridge.toString(up.Cost.Death);
                    if (DarkKingdomCore.MyGame.plrs[0].res.Death < up.Cost.Death && cstHighlight) {
                        this.lblCostDeathHelpUnit.TextColor = Microsoft.Xna.Framework.Color.Red.$clone();
                    } else {
                        this.lblCostDeathHelpUnit.TextColor = this.deathClr.$clone();
                    }
                } else {
                    this.lblCostDeathHelpUnit.Text = "-";
                }

                this.cBattleParameters.Visible = true;
                var atkclr = Microsoft.Xna.Framework.Color.Black.$clone();
                var finalAtk = up.Attack.$clone();
                var finalRng = System.Int64(up.Attack.Range);
                var atkSpd = this.localize.GetString(System.String.format("AttackSpeed{0}", [up.Attack.Speed]));
                if (unt != null) {
                    finalAtk = DarkKingdomCore.Attack.op_Addition(finalAtk.$clone(), unt.atkMod.$clone());
                    finalRng = finalRng.add(System.Int64(unt.atkMod.Range));
                    if (up.Attack.MaxDamage > 0) {
                        if (finalAtk.MinDamage > DarkKingdomCore.MyGame.unitPrms.getItem(up.Name).$clone().Attack.MinDamage || finalAtk.MaxDamage > DarkKingdomCore.MyGame.unitPrms.getItem(up.Name).$clone().Attack.MaxDamage || finalRng.gt(System.Int64(DarkKingdomCore.MyGame.unitPrms.getItem(up.Name).$clone().Attack.Range))) {
                            atkclr = Microsoft.Xna.Framework.Color.DarkBlue.$clone();
                        } else {
                            if (finalAtk.MinDamage < DarkKingdomCore.MyGame.unitPrms.getItem(up.Name).$clone().Attack.MinDamage || finalAtk.MaxDamage < DarkKingdomCore.MyGame.unitPrms.getItem(up.Name).$clone().Attack.MaxDamage || finalRng.lt(System.Int64(DarkKingdomCore.MyGame.unitPrms.getItem(up.Name).$clone().Attack.Range))) {
                                atkclr = Microsoft.Xna.Framework.Color.DarkViolet.$clone();
                            }
                        }
                    }
                }
                this.lblAttackBasicParams.TextColor = atkclr.$clone();
                if (up.Attack.Range > 1) {
                    this.pctAttackBasicParams.spriteRef = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("small_icons"), 0);
                    if (up.Attack.MaxDamage > 0) {
                        if (up.Attack.Range > 100) {
                            this.lblAttackBasicParams.Text = System.String.format("{0}-{1}, \u0434\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u221e, {2}", finalAtk.MinDamage, finalAtk.MaxDamage, atkSpd);
                        } else {
                            this.lblAttackBasicParams.Text = System.String.format("{0}-{1}, \u0434\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u044c {2}, {3}", finalAtk.MinDamage, finalAtk.MaxDamage, finalRng, atkSpd);
                        }
                    } else {
                        this.lblAttackBasicParams.Text = "\u041d\u0435\u0442";
                    }
                } else {
                    this.pctAttackBasicParams.spriteRef = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("small_icons"), 1);
                    if (up.Attack.MaxDamage > 0) {
                        this.lblAttackBasicParams.Text = System.String.format("{0}-{1}, {2}", finalAtk.MinDamage, finalAtk.MaxDamage, atkSpd);
                    } else {
                        if (up.Attack.MaxDamage === 0) {
                            this.lblAttackBasicParams.Text = "\u041d\u0435\u0442";
                        } else {
                            this.lblAttackBasicParams.Text = "\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u0430";
                        }
                    }
                }


                if (unt != null) {
                    this.lblsBasicParams[0].Text = System.String.format("{0}/{1}", unt.hp, up.maxhp);
                    if (up.maxhp > DarkKingdomCore.MyGame.unitPrms.getItem(up.Name).$clone().maxhp) {
                        this.lblsBasicParams[0].TextColor = Microsoft.Xna.Framework.Color.DarkBlue.$clone();
                    } else {
                        if (up.maxhp < DarkKingdomCore.MyGame.unitPrms.getItem(up.Name).$clone().maxhp) {
                            this.lblsBasicParams[0].TextColor = Microsoft.Xna.Framework.Color.DarkViolet.$clone();
                        } else {
                            this.lblsBasicParams[0].TextColor = Microsoft.Xna.Framework.Color.Black.$clone();
                        }
                    }
                } else if (up.maxhp > 0) {
                    this.lblsBasicParams[0].Text = Bridge.toString(up.maxhp);
                    this.lblsBasicParams[0].TextColor = Microsoft.Xna.Framework.Color.Black.$clone();
                } else {
                    this.lblsBasicParams[0].Text = "\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e";
                    this.lblsBasicParams[0].TextColor = Microsoft.Xna.Framework.Color.Black.$clone();
                }


                this.lblsBasicParams[1].Text = this.localize.GetString(up.armNick);
                if (up._armor < DarkKingdomCore.MyGame.unitPrms.getItem(up.Name).$clone()._armor) {
                    this.lblsBasicParams[1].TextColor = Microsoft.Xna.Framework.Color.DarkBlue.$clone();
                } else {
                    if (up._armor > DarkKingdomCore.MyGame.unitPrms.getItem(up.Name).$clone()._armor) {
                        this.lblsBasicParams[1].TextColor = Microsoft.Xna.Framework.Color.DarkBlue.$clone();
                    } else {
                        this.lblsBasicParams[1].TextColor = Microsoft.Xna.Framework.Color.Black.$clone();
                    }
                }

                this.lblsBasicParams[2].Text = System.String.format("{0}, {1}", this.localize.GetString(System.String.format("{0}S", [up.spdNick])), this.localize.GetString(System.Enum.toString(DarkKingdomCore.UnitMoveType, up.moveType)));

                if (up._speed > DarkKingdomCore.MyGame.unitPrms.getItem(up.Name).$clone()._speed) {
                    this.lblsBasicParams[2].TextColor = Microsoft.Xna.Framework.Color.DarkBlue.$clone();
                } else {
                    if (up._speed < DarkKingdomCore.MyGame.unitPrms.getItem(up.Name).$clone()._speed) {
                        this.lblsBasicParams[2].TextColor = Microsoft.Xna.Framework.Color.DarkViolet.$clone();
                    } else {
                        this.lblsBasicParams[2].TextColor = Microsoft.Xna.Framework.Color.Black.$clone();
                    }
                }

                var i = 0;
                var lastH = this.cBattleParameters.Bottom;
                var abils = unt != null ? unt.abils.Values : up.abils.Values;

                $t = Bridge.getEnumerator(abils);
                try {
                    while ($t.moveNext()) {
                        var a = $t.Current;
                        if (!a.hidden) {
                            var clr = new Microsoft.Xna.Framework.Color();
                            switch (a.typ) {
                                case DarkKingdomCore.EffectType.Normal: 
                                    clr = Microsoft.Xna.Framework.Color.Black.$clone();
                                    break;
                                case DarkKingdomCore.EffectType.Good: 
                                    clr = Microsoft.Xna.Framework.Color.DarkBlue.$clone();
                                    break;
                                case DarkKingdomCore.EffectType.Bad: 
                                    clr = Microsoft.Xna.Framework.Color.DarkViolet.$clone();
                                    break;
                                case DarkKingdomCore.EffectType.Poison: 
                                    clr = Microsoft.Xna.Framework.Color.DarkGreen.$clone();
                                    break;
                                default: 
                                    clr = Microsoft.Xna.Framework.Color.Black.$clone();
                                    break;
                            }
                            if (Bridge.referenceEquals(a.condition, "")) {
                                this.lblsAbils[i].Text = System.String.format("\u2022 {0}", [System.String.format(this.localize.GetString(a.name), a.value, a.value)]);
                                this.lblsAbils[i].TextColor = clr.$clone();
                                this.lblsAbils[i].Visible = true;
                            } else {
                                if (a.longTime) {
                                    if (!a.used && !a.condCompleted) {
                                        if (unt != null || !(Bridge.referenceEquals(a.condition, "Tier") && DarkKingdomCore.MyGame.plrs[own].res.Tier >= a.condnum) && !(Bridge.referenceEquals(a.condition, "Machine_army") && this.machinenum >= a.condnum)) {
                                            clr = this.condClr.$clone();
                                        }
                                    }
                                }
                                var unit_parameters = this.GetUnitParametersFromID(a.value);
                                var unit_name = System.Nullable.hasValue(unit_parameters) ? this.localize.GetString(System.Nullable.getValue(unit_parameters).Name) : "";
                                this.lblsAbils[i].Text = System.String.format("\u2022 {0} {1}", System.String.format(this.localize.GetString(a.condition), a.condnum, this.GetEnding(a.condnum)), System.String.format(this.localize.GetString(a.name), a.value, unit_name));
                                this.lblsAbils[i].TextColor = clr.$clone();
                                this.lblsAbils[i].Visible = true;
                            }
                            this.lblsAbils[i].Y = (lastH + 5) | 0;
                            lastH = this.lblsAbils[i].Bottom;
                            if (a.condCompleted) {
                                if (Bridge.referenceEquals(a.name, "Mage")) {
                                    this.pctAttackBasicParams.spriteRef = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("small_icons"), 2);
                                } else {
                                    if (Bridge.referenceEquals(a.name, "Shooter")) {
                                        this.pctAttackBasicParams.spriteRef = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("small_icons"), 17);
                                    } else {
                                        if (Bridge.referenceEquals(a.name, "Arbalester")) {
                                            this.pctAttackBasicParams.spriteRef = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("small_icons"), 18);
                                        }
                                    }
                                }
                            }
                            i = (i + 1) | 0;
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }

                for (var j = i; j <= 5; j = (j + 1) | 0) {
                    this.lblsAbils[j].Visible = false;
                }

                this.frmHelp.H = (lastH + 5) | 0;

                if (!System.Nullable.hasValue(pnt)) {
                    pnt = new Microsoft.Xna.Framework.Point.$ctor2(((((DarkKingdomCore.MyGame.gameWidth - this.frmHelp.W) | 0) - 30) | 0), 90);
                }

                this.frmHelp.X = (System.Nullable.getValue(pnt).X + 10) | 0;
                this.frmHelp.Y = (System.Nullable.getValue(pnt).Y + 10) | 0;
                if (this.frmHelp.Right > ((DarkKingdomCore.MyGame.gameWidth - 20) | 0)) {
                    this.frmHelp.Right = (DarkKingdomCore.MyGame.gameWidth - 20) | 0;
                }
                if (this.frmHelp.Bottom > ((DarkKingdomCore.MyGame.gameHeight - 20) | 0)) {
                    this.frmHelp.Bottom = (DarkKingdomCore.MyGame.gameHeight - 20) | 0;
                }

                this.frmHelp.Visible = true;
            },
            GetEnding: function (n) {
                if (n > 4) {
                    return "";
                } else {
                    if (n === 1) {
                        return "\u043e";
                    } else {
                        return "\u0430";
                    }
                }
            },
            ShowInfo: function (pnt, lines) {
                if (lines === void 0) { lines = []; }
                this.ShowMoreInfo(new DarkKingdomCore.TimeCost.$ctor1(0, 0, 0, 0), false, pnt.$clone(), lines);
            },
            ShowMoreInfo: function (cost, cstHighlight, pnt, lines) {
                if (lines === void 0) { lines = []; }
                this.lblUnitNameHelpUnit.Text = lines[0];
                this.lblRaceHelpUnit.Text = lines[1];

                this.lblCostMoneyHelpUnit.Text = Bridge.toString(cost.Money);
                if (DarkKingdomCore.MyGame.plrs[0].res.Money < cost.Money && cstHighlight) {
                    this.lblCostMoneyHelpUnit.TextColor = Microsoft.Xna.Framework.Color.Red.$clone();
                } else {
                    this.lblCostMoneyHelpUnit.TextColor = this.moneyClr.$clone();
                }


                if (cost.Death > 0) {
                    this.lblCostDeathHelpUnit.Text = Bridge.toString(cost.Death);
                    if (DarkKingdomCore.MyGame.plrs[0].res.Death < cost.Death && cstHighlight) {
                        this.lblCostDeathHelpUnit.TextColor = Microsoft.Xna.Framework.Color.Red.$clone();
                    } else {
                        this.lblCostDeathHelpUnit.TextColor = this.deathClr.$clone();
                    }
                } else {
                    this.lblCostDeathHelpUnit.Text = "-";
                }

                this.cBattleParameters.Visible = false;

                var i = 0;
                var lastH = this.lblCostMoneyHelpUnit.Bottom;
                for (i = 2; i < lines.length; i = (i + 1) | 0) {
                    this.lblsAbils[((i - 2) | 0)].Text = lines[i];
                    this.lblsAbils[((i - 2) | 0)].TextColor = Microsoft.Xna.Framework.Color.Black.$clone();
                    this.lblsAbils[((i - 2) | 0)].Visible = true;
                    this.lblsAbils[((i - 2) | 0)].Y = (lastH + 5) | 0;
                    lastH = this.lblsAbils[((i - 2) | 0)].Bottom;
                }

                for (var j = (i - 2) | 0; j <= 5; j = (j + 1) | 0) {
                    this.lblsAbils[j].Visible = false;
                }

                this.frmHelp.H = (lastH + 5) | 0;
                if (!System.Nullable.hasValue(pnt)) {
                    pnt = new Microsoft.Xna.Framework.Point.$ctor2(((((DarkKingdomCore.MyGame.gameWidth - this.frmHelp.W) | 0) - 40) | 0), 80);
                }

                this.frmHelp.X = (System.Nullable.getValue(pnt).X + 20) | 0;
                this.frmHelp.Y = (System.Nullable.getValue(pnt).Y + 20) | 0;
                if (this.frmHelp.Right > ((DarkKingdomCore.MyGame.gameWidth - 20) | 0)) {
                    this.frmHelp.Right = (DarkKingdomCore.MyGame.gameWidth - 20) | 0;
                }
                if (this.frmHelp.Bottom > ((DarkKingdomCore.MyGame.gameHeight - 20) | 0)) {
                    this.frmHelp.Bottom = (DarkKingdomCore.MyGame.gameHeight - 20) | 0;
                }

                this.frmHelp.Visible = true;
            },
            CreateRaceList: function () {
                var $t;
                this.races1 = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.races2 = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.standartRaces = new (System.Collections.Generic.List$1(System.String)).ctor();
                $t = Bridge.getEnumerator(DarkKingdomCore.RaceManager.Instance.All.Values);
                try {
                    while ($t.moveNext()) {
                        var r = $t.Current;
                        if (!r.special) {
                            this.races1.add(r.name);
                            if (!r.noAI) {
                                this.races2.add(r.name);
                            }
                            if (!r.custom && !(Bridge.referenceEquals(r.name, "Random"))) {
                                this.standartRaces.add(r.name);
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            },
            AddCustomRace: function (name) {
                var nick, desc;
                var symb;
                var noAI;
                nick = this.localize.GetString(name);
                symb = (10 + System.Int32.parse(String.fromCharCode(name.charCodeAt(((name.length - 1) | 0))))) | 0;
                desc = "\u0421\u0434\u0435\u043b\u0430\u043d\u043e \u0441\u0432\u043e\u0438\u043c\u0438 \u0440\u0443\u043a\u0430\u043c\u0438";
                noAI = false;
                DarkKingdomCore.RaceManager.Instance.All.add(name, new DarkKingdomCore.Race(name, desc, nick, symb, noAI, true, false, false));
                this.OrderRaces();
            },
            OrderRaces: function () {
                var $t;
                var newraces = Bridge.fn.bind(this, function (_o1) {
                        _o1.add("Random", new DarkKingdomCore.Race("Random", "\u0421\u043b\u0443\u0447\u0430\u0439\u043d\u044b\u0439 \u0432\u044b\u0431\u043e\u0440 \u0444\u0440\u0430\u043a\u0446\u0438\u0438", this.localize.GetString("Random"), 4, false, false, false, false));
                        return _o1;
                    })(new (System.Collections.Generic.Dictionary$2(System.String,DarkKingdomCore.Race)).ctor());

                if (DarkKingdomCore.ProfileManager.Instance.All.Count > 0) {
                    for (var i = 0; i < DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).maxCustomRaces; i = (i + 1) | 0) {
                        if (DarkKingdomCore.RaceManager.Instance.All.containsKey(System.String.format("Custom{0}", [i]))) {
                            newraces.add(System.String.format("Custom{0}", [i]), DarkKingdomCore.RaceManager.Instance.All.getItem(System.String.format("Custom{0}", [i])));
                        }
                    }
                }


                $t = Bridge.getEnumerator(DarkKingdomCore.RaceManager.Instance.All.Values);
                try {
                    while ($t.moveNext()) {
                        var r = $t.Current;
                        if (!r.custom && !(Bridge.referenceEquals(r.name, "Random"))) {
                            newraces.add(r.name, r);
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }

                DarkKingdomCore.RaceManager.Instance.All = newraces;
            },
            SaveCurrentEdRace: function () {
                //if (!RaceManager.Instance.All.ContainsKey(currentEdRace))
                //    AddCustomRace(currentEdRace);
                //{
                //var abil = RaceManager.Instance.All[currentEdRace];
                //if (!string.IsNullOrEmpty(currentEdRaceNick))
                //    abil.nick = currentEdRaceNick;
                //abil.units.Clear();
                //foreach (string u in edunits)
                //    abil.units.Add(u);
                //UnlockAchiviement("Openeditor");
                //}
            },
            ClearVarsAndCalcEarned: function () {
                this.selU = null;
                DarkKingdomCore.MyGame.pars.clear();
                this.ammos.clear();
                DarkKingdomCore.MyGame.units.clear();
                this.deathlist.clear();
                this.bornList.clear();

                if (DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.InGame || DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.Win || DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.Lose) {
                    this.ResetWorld(this.sunAng, this.dAng);
                }
                if (DarkKingdomCore.RaceManager.Instance.All.getItem(DarkKingdomCore.MyGame.plrs[0].race).disableRewards) {
                    this.unlockedAchivs.clear();
                    this.unlockedUnits.clear();
                } else {
                    if (DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.Win) {
                        this.UnlockAchiviement("Startpath");
                        if (DarkKingdomCore.MyGame.plrs[0].statDeaths === 0) {
                            this.UnlockAchiviement("Gentleleader");
                        }
                        if (Bridge.referenceEquals(this.conds.getItem(DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).difficult).$clone().name, "Hard")) {
                            if (!DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).achivs.containsKey("Alittleharder")) {
                                DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).achivs.add("Alittleharder", "2");
                            } else {
                                if (!System.String.isNullOrEmpty(DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).achivs.getItem("Alittleharder"))) {
                                    DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).achivs.setItem("Alittleharder", Bridge.toString((((System.Int32.parse(DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).achivs.getItem("Alittleharder")) - 1) | 0))));
                                    if (Bridge.referenceEquals(DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).achivs.getItem("Alittleharder"), "0")) {
                                        this.unlockedAchivs.add("Alittleharder");
                                    }
                                }
                            }
                        }
                        if (DarkKingdomCore.MyGame.plrs[0].unitsList.Count === 0) {
                            this.UnlockAchiviement("Truemage");
                        }
                    }
                    if (DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).minvictims === -1 || DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).minvictims > DarkKingdomCore.MyGame.plrs[0].statDeaths) {
                        DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).minvictims = DarkKingdomCore.MyGame.plrs[0].statDeaths;
                    }

                    if (DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).maxkills === -1 || DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).maxkills < DarkKingdomCore.MyGame.plrs[1].statDeaths) {
                        DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).maxkills = DarkKingdomCore.MyGame.plrs[1].statDeaths;
                    }
                }


                // End If
                DarkKingdomCore.MyGame.gState = DarkKingdomCore.GameState.MainMenu;
                this.Pause = false;
            },
            UnlockAchiviement: function (achiv) {
                if (!DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).achivs.containsKey(achiv) && !this.unlockedAchivs.contains(achiv)) {
                    this.unlockedAchivs.add(achiv);
                }
            },
            CheckPurchaseCost: function (prch) {
                var $t, $t1, $t2, $t3;
                if (DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).crystals >= this.purchases.getItem(prch).crystals) {
                    switch (this.purchases.getItem(prch).name) {
                        case "Buster1T": 
                            {
                                var avunits = new (System.Collections.Generic.List$1(System.String)).ctor();
                                var tier = 1;
                                $t = Bridge.getEnumerator(this.AllUntsList);
                                try {
                                    while ($t.moveNext()) {
                                        var u = $t.Current;
                                        if (DarkKingdomCore.MyGame.unitPrms.getItem(u).$clone().Cost.Tier === tier && !DarkKingdomCore.MyGame.unitPrms.getItem(u).$clone().isHeroic && !DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).units.contains(u)) {
                                            avunits.add(u);
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t, System.IDisposable)) {
                                        $t.System$IDisposable$Dispose();
                                    }
                                }
                                if (avunits.Count > 0) {
                                    return true;
                                }
                                break;
                            }
                        case "Buster2T": 
                            {
                                var avunits1 = new (System.Collections.Generic.List$1(System.String)).ctor();
                                var tier1 = 2;
                                $t1 = Bridge.getEnumerator(this.AllUntsList);
                                try {
                                    while ($t1.moveNext()) {
                                        var u1 = $t1.Current;
                                        if (DarkKingdomCore.MyGame.unitPrms.getItem(u1).$clone().Cost.Tier === tier1 && !DarkKingdomCore.MyGame.unitPrms.getItem(u1).$clone().isHeroic && !DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).units.contains(u1)) {
                                            avunits1.add(u1);
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t1, System.IDisposable)) {
                                        $t1.System$IDisposable$Dispose();
                                    }
                                }
                                if (avunits1.Count > 0) {
                                    return true;
                                }
                                break;
                            }
                        case "Buster3T": 
                            {
                                var avunits2 = new (System.Collections.Generic.List$1(System.String)).ctor();
                                var tier2 = 3;
                                $t2 = Bridge.getEnumerator(this.AllUntsList);
                                try {
                                    while ($t2.moveNext()) {
                                        var u2 = $t2.Current;
                                        if (DarkKingdomCore.MyGame.unitPrms.getItem(u2).$clone().Cost.Tier === tier2 && !DarkKingdomCore.MyGame.unitPrms.getItem(u2).$clone().isHeroic && !DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).units.contains(u2)) {
                                            avunits2.add(u2);
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t2, System.IDisposable)) {
                                        $t2.System$IDisposable$Dispose();
                                    }
                                }
                                if (avunits2.Count > 0) {
                                    return true;
                                }
                                break;
                            }
                        case "Herobuster": 
                            {
                                var avunits3 = new (System.Collections.Generic.List$1(System.String)).ctor();
                                $t3 = Bridge.getEnumerator(this.AllUntsList);
                                try {
                                    while ($t3.moveNext()) {
                                        var u3 = $t3.Current;
                                        if (DarkKingdomCore.MyGame.unitPrms.getItem(u3).$clone().isHeroic && !DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).units.contains(u3)) {
                                            avunits3.add(u3);
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t3, System.IDisposable)) {
                                        $t3.System$IDisposable$Dispose();
                                    }
                                }
                                if (avunits3.Count > 0) {
                                    return true;
                                }
                                break;
                            }
                        case "AdditionSlot": 
                            {
                                if (DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).maxCustomRaces < 3) {
                                    return true;
                                }
                                break;
                            }
                    }
                }
                return false;
            },
            Buy: function (prch) {
                var $t, $t1, $t2, $t3, $t4, $t5;
                if (DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).crystals >= this.purchases.getItem(prch).crystals) {
                    var cancel = false;
                    switch (this.purchases.getItem(prch).name) {
                        case "Buster1T": 
                            {
                                var avunits = new (System.Collections.Generic.List$1(System.String)).ctor();
                                var bustsize = 4;
                                var tier = 1;
                                $t = Bridge.getEnumerator(this.AllUntsList);
                                try {
                                    while ($t.moveNext()) {
                                        var u = $t.Current;
                                        if (DarkKingdomCore.MyGame.unitPrms.getItem(u).$clone().Cost.Tier === tier && !DarkKingdomCore.MyGame.unitPrms.getItem(u).$clone().isHeroic && !DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).units.contains(u) && !this.unlockedUnits.contains(u)) {
                                            avunits.add(u);
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t, System.IDisposable)) {
                                        $t.System$IDisposable$Dispose();
                                    }
                                }
                                if (avunits.Count > 0) {
                                    while (avunits.Count > 0 && bustsize > 0) {
                                        var u1 = avunits.getItem(DarkKingdomCore.MyGame.rnd.Next$1(avunits.Count));
                                        this.unlockedUnits.add(u1);
                                        avunits.remove(u1);
                                        bustsize = (bustsize - 1) | 0;
                                    }
                                } else {
                                    cancel = true;
                                }
                                break;
                            }
                        case "Buster2T": 
                            {
                                var avunits1 = new (System.Collections.Generic.List$1(System.String)).ctor();
                                var bustsize1 = 2;
                                var tier1 = 2;
                                $t1 = Bridge.getEnumerator(this.AllUntsList);
                                try {
                                    while ($t1.moveNext()) {
                                        var u2 = $t1.Current;
                                        if (DarkKingdomCore.MyGame.unitPrms.getItem(u2).$clone().Cost.Tier === tier1 && !DarkKingdomCore.MyGame.unitPrms.getItem(u2).$clone().isHeroic && !DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).units.contains(u2) && !this.unlockedUnits.contains(u2)) {
                                            avunits1.add(u2);
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t1, System.IDisposable)) {
                                        $t1.System$IDisposable$Dispose();
                                    }
                                }
                                if (avunits1.Count > 0) {
                                    while (avunits1.Count > 0 && bustsize1 > 0) {
                                        var u3 = avunits1.getItem(DarkKingdomCore.MyGame.rnd.Next$1(avunits1.Count));
                                        this.unlockedUnits.add(u3);
                                        avunits1.remove(u3);
                                        bustsize1 = (bustsize1 - 1) | 0;
                                    }
                                } else {
                                    cancel = true;
                                }
                                break;
                            }
                        case "Buster3T": 
                            {
                                var avunits2 = new (System.Collections.Generic.List$1(System.String)).ctor();
                                var tier2 = 3;
                                $t2 = Bridge.getEnumerator(this.AllUntsList);
                                try {
                                    while ($t2.moveNext()) {
                                        var u4 = $t2.Current;
                                        if (DarkKingdomCore.MyGame.unitPrms.getItem(u4).$clone().Cost.Tier === tier2 && !DarkKingdomCore.MyGame.unitPrms.getItem(u4).$clone().isHeroic && !DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).units.contains(u4) && !this.unlockedUnits.contains(u4)) {
                                            avunits2.add(u4);
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t2, System.IDisposable)) {
                                        $t2.System$IDisposable$Dispose();
                                    }
                                }
                                if (avunits2.Count > 0) {
                                    this.unlockedUnits.add(avunits2.getItem(DarkKingdomCore.MyGame.rnd.Next$1(avunits2.Count)));
                                } else {
                                    cancel = true;
                                }
                                break;
                            }
                        case "Herobuster": 
                            {
                                var avunits3 = new (System.Collections.Generic.List$1(System.String)).ctor();
                                $t3 = Bridge.getEnumerator(this.AllUntsList);
                                try {
                                    while ($t3.moveNext()) {
                                        var u5 = $t3.Current;
                                        if (DarkKingdomCore.MyGame.unitPrms.getItem(u5).$clone().isHeroic && !DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).units.contains(u5) && !this.unlockedUnits.contains(u5)) {
                                            avunits3.add(u5);
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t3, System.IDisposable)) {
                                        $t3.System$IDisposable$Dispose();
                                    }
                                }
                                if (avunits3.Count > 0) {
                                    this.unlockedUnits.add(avunits3.getItem(DarkKingdomCore.MyGame.rnd.Next$1(avunits3.Count)));
                                } else {
                                    cancel = true;
                                }
                                break;
                            }
                        case "AdditionSlot": 
                            {
                                if (DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).maxCustomRaces < 3) {
                                    ($t4 = DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile)).maxCustomRaces = ($t4.maxCustomRaces + 1) | 0;
                                } else {
                                    cancel = true;
                                }
                                break;
                            }
                    }
                    if (!cancel) {
                        ($t5 = DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile)).crystals = ($t5.crystals - this.purchases.getItem(prch).crystals) | 0;
                        this.UnlockAchiviement("Firstpurchase");
                    }
                }
            },
            btnUnitPreGame_Clicked: function (btn, isTouch) {
                var uname = this.unitsPreGame.getItem(this.cUnitsPreGame.Children.indexOf(btn));
                if (!this.preGameUnits.contains(uname) && ((((this.preGameUnits.Count + this.preGameSpells.Count) | 0) + this.preGameBonus.Count) | 0) < this.preGameSlotCnt) {
                    this.preGameUnits.add(uname);
                    this.preGameUnits = this.SortUnitsLists(this.preGameUnits);
                    this.SetPreGameLists();
                }
            },
            btnSpellsPreGame_Clicked: function (btn, isTouch) {
                var sname = this.spellsPreGame.getItem(this.cSpellsPreGame.Children.indexOf(btn));
                if (!this.preGameSpells.contains(sname) && ((((this.preGameUnits.Count + this.preGameSpells.Count) | 0) + this.preGameBonus.Count) | 0) < this.preGameSlotCnt) {
                    this.preGameSpells.add(sname);
                    this.preGameSpells = this.SortSpellsLists(this.preGameSpells);
                    this.SetPreGameLists();
                }
            },
            btnBuildingPreGame_Clicked: function (btn, isTouch) {
                var bname = this.startBuildingsList.getItem(this.cBuildingsPreGame.Children.indexOf(btn));
                if (!this.preGameBonus.contains(bname) && ((((this.preGameUnits.Count + this.preGameSpells.Count) | 0) + this.preGameBonus.Count) | 0) < this.preGameSlotCnt) {
                    this.preGameBonus.add(bname);
                    this.SetPreGameLists();
                }
            },
            btnSelectedPreGame_Clicked: function (btn, isTouch) {
                var ind = this.cSelectedPreGame.Children.indexOf(btn);
                if ((ind < this.preGameUnits.Count)) {
                    var uname = this.preGameUnits.getItem(ind);
                    this.preGameUnits.remove(uname);
                    this.SetPreGameLists();
                } else if ((((ind - this.preGameUnits.Count) | 0) < this.preGameSpells.Count)) {
                    var sname = this.preGameSpells.getItem(((ind - this.preGameUnits.Count) | 0));
                    this.preGameSpells.remove(sname);
                    this.SetPreGameLists();
                } else if ((((((ind - this.preGameUnits.Count) | 0) - this.preGameSpells.Count) | 0) < this.preGameBonus.Count)) {
                    var bname = this.preGameBonus.getItem(((((ind - this.preGameUnits.Count) | 0) - this.preGameSpells.Count) | 0));
                    this.preGameBonus.remove(bname);
                    this.SetPreGameLists();
                }
            },
            btnUnitPreGame_Focused: function (btn, isTouch) {
                if ((this.cUnitsPreGame.Children.Count === this.unitsPreGame.Count)) {
                    var uname = this.unitsPreGame.getItem(this.cUnitsPreGame.Children.indexOf(btn));
                    this.ShowUnitInfo(DarkKingdomCore.MyGame.unitPrms.getItem(uname).$clone(), 0, false, new Microsoft.Xna.Framework.Point.$ctor2(Bridge.Int.clip32(btn.FinalRight / this.MainContainer.FinalChildrenScaleX), Bridge.Int.clip32(btn.FinalBottom / this.MainContainer.FinalChildrenScaleY)));
                }
            },
            btnSpellsPreGame_Focused: function (btn, isTouch) {
                if ((this.cSpellsPreGame.Children.Count === this.spellsPreGame.Count)) {
                    var sname = this.spellsPreGame.getItem(this.cSpellsPreGame.Children.indexOf(btn));
                    this.ShowMoreInfo(this.spells.getItem(sname).Cost.$clone(), false, new Microsoft.Xna.Framework.Point.$ctor2(Bridge.Int.clip32(btn.FinalRight / this.MainContainer.FinalChildrenScaleX), Bridge.Int.clip32(btn.FinalBottom / this.MainContainer.FinalChildrenScaleY)), [this.localize.GetString(this.spells.getItem(sname).Name), this.localize.GetString$1(this.spells.getItem(sname).School, [this.spells.getItem(sname).Cost.Tier]), this.spells.getItem(sname).Description]);
                }
            },
            btnBuildingPreGame_Focused: function (btn, isTouch) {
                var bname = this.startBuildingsList.getItem(this.cBuildingsPreGame.Children.indexOf(btn));
                this.ShowUnitInfo(DarkKingdomCore.MyGame.unitPrms.getItem(bname).$clone(), 0, false, new Microsoft.Xna.Framework.Point.$ctor2(Bridge.Int.clip32(btn.FinalRight / this.MainContainer.FinalChildrenScaleX), Bridge.Int.clip32(btn.FinalBottom / this.MainContainer.FinalChildrenScaleY)));
            },
            btnSelectedPreGame_Focused: function (btn, isTouch) {
                var ind = this.cSelectedPreGame.Children.indexOf(btn);
                if ((ind < this.preGameUnits.Count)) {
                    var uname = this.preGameUnits.getItem(ind);
                    this.ShowUnitInfo(DarkKingdomCore.MyGame.unitPrms.getItem(uname).$clone(), 0, false, new Microsoft.Xna.Framework.Point.$ctor2(Bridge.Int.clip32(btn.FinalRight / this.MainContainer.FinalChildrenScaleX), Bridge.Int.clip32(btn.FinalBottom / this.MainContainer.FinalChildrenScaleY)));
                } else if ((((ind - this.preGameUnits.Count) | 0) < this.preGameSpells.Count)) {
                    var sname = this.preGameSpells.getItem(((ind - this.preGameUnits.Count) | 0));
                    this.ShowMoreInfo(this.spells.getItem(sname).Cost.$clone(), true, new Microsoft.Xna.Framework.Point.$ctor2(Bridge.Int.clip32(btn.FinalRight / this.MainContainer.FinalChildrenScaleX), Bridge.Int.clip32(btn.FinalBottom / this.MainContainer.FinalChildrenScaleY)), [this.localize.GetString(this.spells.getItem(sname).Name), this.localize.GetString$1(this.spells.getItem(sname).School, [Bridge.toString(this.spells.getItem(sname).Cost.Tier)]), this.spells.getItem(sname).Description]);
                } else if ((((((ind - this.preGameUnits.Count) | 0) - this.preGameSpells.Count) | 0) < this.preGameBonus.Count)) {
                    var bname = this.preGameBonus.getItem(((((ind - this.preGameUnits.Count) | 0) - this.preGameSpells.Count) | 0));
                    this.ShowUnitInfo(DarkKingdomCore.MyGame.unitPrms.getItem(bname).$clone(), 0, false, new Microsoft.Xna.Framework.Point.$ctor2(Bridge.Int.clip32(btn.FinalRight / this.MainContainer.FinalChildrenScaleX), Bridge.Int.clip32(btn.FinalBottom / this.MainContainer.FinalChildrenScaleY)));
                }
            },
            DoUnitsSpells: function (name, trgs) {
                var $t, $t1, $t2, $t3;
                var cancel = true;
                $t = Bridge.getEnumerator(trgs);
                try {
                    while ($t.moveNext()) {
                        var trg = $t.Current;
                        if (trg.parameters.isBuilding) {
                            this.ShowInfoPar("\u041d\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u043e", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                            continue;
                        }
                        if (trg.AbsContains("Spellproof")) {
                            this.ShowInfoPar("\u0417\u0430\u0449\u0438\u0442\u0430 \u043e\u0442 \u043c\u0430\u0433\u0438\u0438", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                            continue;
                        }
                        if (Bridge.referenceEquals(name, "Magic_armor")) {
                            if (trg.AbsContains("Invulnerable")) {
                                this.ShowInfoPar("\u0423\u0436\u0435 \u0437\u0430\u0449\u0438\u0449\u0435\u043d", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                continue;
                            }
                        }
                        if (Bridge.referenceEquals(name, "Dark_arrow")) {
                            if (trg.AbsContains("Machinery")) {
                                this.ShowInfoPar("\u041d\u0435\u043b\u044c\u0437\u044f \u0434\u043e\u0431\u0438\u0442\u044c \u043c\u0435\u0445\u0430\u043d\u0438\u0437\u043c", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                continue;
                            }
                            if (trg.AbsContains("Bodyless")) {
                                this.ShowInfoPar("\u041d\u0435\u043b\u044c\u0437\u044f \u0434\u043e\u0431\u0438\u0442\u044c \u0431\u0435\u0441\u0442\u0435\u043b\u0435\u0441\u043d\u043e\u0433\u043e", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                continue;
                            }
                            if (trg.hp > 200) {
                                this.ShowInfoPar("\u0421\u043b\u0438\u0448\u043a\u043e\u043c \u043c\u043d\u043e\u0433\u043e \u0437\u0434\u043e\u0440\u043e\u0432\u044c\u044f", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                continue;
                            }
                        }
                        if (Bridge.referenceEquals(name, "Oblivion")) {
                            if (trg.AbsContains("Purified")) {
                                this.ShowInfoPar("\u0423\u0436\u0435 \u043b\u0438\u0448\u0435\u043d", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                continue;
                            }
                            if (trg.AbsContains("Eternal")) {
                                this.ShowInfoPar("\u0417\u0430\u0449\u0438\u0449\u0435\u043d \u043e\u0442 \u043b\u0438\u0448\u0435\u043d\u0438\u044f \u0441\u043f\u043e\u0441\u043e\u0431\u043d\u043e\u0441\u0442\u0435\u0439", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                continue;
                            }
                        }

                        cancel = false;

                        switch (name) {
                            case "Heal": 
                                {
                                    this.Heal(trg, trg.parameters.maxhp);
                                    break;
                                }
                            case "Haste": 
                                {
                                    trg.parameters.Speed = "Very_fast";
                                    trg.AddAbility$2("Agility", 20, DarkKingdomCore.EffectType.Good);
                                    break;
                                }
                            case "Weakness": 
                                {
                                    trg.parameters.Speed = "Slow";
                                    trg.AddAbility$1("Clumsiness", DarkKingdomCore.EffectType.Bad);
                                    break;
                                }
                            case "Rescue": 
                                {
                                    trg.x = (DarkKingdomCore.MyGame.plrs[trg.owner].baseX + trg.moveside) | 0;
                                    break;
                                }
                            case "Ghost_mode": 
                                {
                                    trg.AddAbility$1("Undead", DarkKingdomCore.EffectType.Good);
                                    trg.AddAbility$1("Bodyless", DarkKingdomCore.EffectType.Good);
                                    trg.RemoveAbil("Poison");
                                    break;
                                }
                            case "The_Covenant": 
                                {
                                    DarkKingdomCore.MyGame.units.getItem(((1 - trg.owner) | 0)).hp -= trg.hp;
                                    this.ShowInfoPar("-" + (System.Single.format(trg.hp) || ""), DarkKingdomCore.MyGame.badAbilClr.$clone(), DarkKingdomCore.MyGame.units.getItem(((1 - trg.owner) | 0)).x, ((DarkKingdomCore.MyGame.hor + DarkKingdomCore.MyGame.units.getItem(((1 - trg.owner) | 0)).parameters.rect.Top) | 0), false);
                                    this.Kill(trg);
                                    break;
                                }
                            case "Magic_arrow": 
                                {
                                    this.Harm(trg, DarkKingdomCore.MyGame.rnd.Next$2(100, 151), true, DarkKingdomCore.EffectType.Bad);
                                    break;
                                }
                            case "Polymorph": 
                                {
                                    var allunitst = new (System.Collections.Generic.List$1(System.String)).ctor();
                                    var u;
                                    $t1 = Bridge.getEnumerator(DarkKingdomCore.MyGame.unitPrms.Values);
                                    try {
                                        while ($t1.moveNext()) {
                                            var up = $t1.Current.$clone();
                                            if (!up.special) {
                                                if (up.Cost.Tier === trg.parameters.Cost.Tier && DarkKingdomCore.MyGame.plrs[trg.owner].CheckForLimit(up.Name)) {
                                                    allunitst.add(up.Name);
                                                }
                                            }
                                        }
                                    } finally {
                                        if (Bridge.is($t1, System.IDisposable)) {
                                            $t1.System$IDisposable$Dispose();
                                        }
                                    }
                                    if (allunitst.Count > 0) {
                                        u = DarkKingdomCore.MyGame.rnd.Next$2(0, allunitst.Count);
                                        trg.SetParams(DarkKingdomCore.MyGame.unitPrms.getItem(allunitst.getItem(u)).$clone(), true);
                                        trg.purified = false;
                                        trg.takedOff = false;
                                        trg.landing = false;
                                    } else {
                                        cancel = true;
                                        this.ShowInfoPar("\u041d\u0435\u0442 \u043f\u043e\u0434\u0445\u043e\u0434\u044f\u0449\u0438\u0445 \u0441\u0443\u0449\u0435\u0441\u0442\u0432", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                    }

                                    break;
                                }
                            case "Dark_arrow": 
                                {
                                    this.Kill(trg);
                                    var allunitst1 = new (System.Collections.Generic.List$1(System.String)).ctor();
                                    var u1;
                                    $t2 = Bridge.getEnumerator(DarkKingdomCore.MyGame.unitPrms.Values);
                                    try {
                                        while ($t2.moveNext()) {
                                            var up1 = $t2.Current.$clone();
                                            if (!up1.special) {
                                                if (up1.Cost.Tier === trg.parameters.Cost.Tier && up1.AbsContains("Undead") && DarkKingdomCore.MyGame.plrs[0].CheckForLimit(up1.Name)) {
                                                    allunitst1.add(up1.Name);
                                                }
                                            }
                                        }
                                    } finally {
                                        if (Bridge.is($t2, System.IDisposable)) {
                                            $t2.System$IDisposable$Dispose();
                                        }
                                    }
                                    if (allunitst1.Count > 0) {
                                        u1 = DarkKingdomCore.MyGame.rnd.Next$2(0, allunitst1.Count);
                                        this.bornList.add(new DarkKingdomCore.Unit(this, trg.x, 1, 0, DarkKingdomCore.MyGame.unitPrms.getItem(allunitst1.getItem(u1)).$clone()));
                                    } else {
                                        this.ShowInfoPar("\u041d\u0435\u0442 \u043f\u043e\u0434\u0445\u043e\u0434\u044f\u0449\u0438\u0445 \u0441\u0443\u0449\u0435\u0441\u0442\u0432", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                    }
                                    break;
                                }
                            case "Transmutation": 
                                {
                                    var allunitst2 = new (System.Collections.Generic.List$1(System.String)).ctor();
                                    var u2;
                                    $t3 = Bridge.getEnumerator(DarkKingdomCore.MyGame.unitPrms.Values);
                                    try {
                                        while ($t3.moveNext()) {
                                            var up2 = $t3.Current.$clone();
                                            if (!up2.special) {
                                                if (up2.Cost.Tier === ((trg.parameters.Cost.Tier + 1) | 0) && Bridge.referenceEquals(up2.Race, trg.parameters.Race) && DarkKingdomCore.MyGame.plrs[0].CheckForLimit(up2.Name)) {
                                                    allunitst2.add(up2.Name);
                                                }
                                            }
                                        }
                                    } finally {
                                        if (Bridge.is($t3, System.IDisposable)) {
                                            $t3.System$IDisposable$Dispose();
                                        }
                                    }
                                    if (allunitst2.Count > 0) {
                                        u2 = DarkKingdomCore.MyGame.rnd.Next$2(0, allunitst2.Count);
                                        trg.SetParams(DarkKingdomCore.MyGame.unitPrms.getItem(allunitst2.getItem(u2)).$clone(), false);
                                        if (trg.hp > trg.parameters.maxhp) {
                                            trg.hp = trg.parameters.maxhp;
                                        }
                                        trg.purified = false;
                                        trg.takedOff = false;
                                        trg.landing = false;
                                    } else {
                                        cancel = true;
                                        this.ShowInfoPar("\u041d\u0435\u0442 \u043f\u043e\u0434\u0445\u043e\u0434\u044f\u0449\u0438\u0445 \u0441\u0443\u0449\u0435\u0441\u0442\u0432", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                    }

                                    break;
                                }
                            case "Googlehammer": 
                                {
                                    trg.AddAbility$1("Mage", DarkKingdomCore.EffectType.Good);
                                    if (trg.parameters.Attack.Range === 1) {
                                        trg.parameters.Attack.Range = 3;
                                        trg.parameters.ammoType = DarkKingdomCore.Ammo.AmmoType.Hammer;
                                        if (trg.parameters.Attack.Speed < 60) {
                                            trg.parameters.Attack.Speed = 60;
                                        }
                                    }

                                    break;
                                }
                            case "Magic_armor": 
                                {
                                    trg.AddAbility$2("Invulnerable", 400, DarkKingdomCore.EffectType.Good);
                                    break;
                                }
                            case "Oblivion": 
                                {
                                    trg.purified = true;
                                    break;
                                }
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }

                if (!cancel) {
                    this.SpellComplete(name);
                    return true;
                }
                return false;
            },
            DoGlobalSpells: function (name) {
                var $t, $t1, $t2, $t3, $t4, $t5, $t6, $t7;
                switch (name) {
                    case "Earthquake": 
                        {
                            $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                            try {
                                while ($t.moveNext()) {
                                    var u = $t.Current;
                                    if (u.parameters.isBuilding && !u.AbsContains("Spellproof")) {
                                        this.Harm(u, DarkKingdomCore.MyGame.rnd.Next$2(250, 501), true, DarkKingdomCore.EffectType.Bad);
                                    }
                                }
                            } finally {
                                if (Bridge.is($t, System.IDisposable)) {
                                    $t.System$IDisposable$Dispose();
                                }
                            }

                            break;
                        }
                    case "Mana_blast": 
                        {
                            $t1 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                            try {
                                while ($t1.moveNext()) {
                                    var u1 = $t1.Current;
                                    if (u1.AbsContains("Mage") && !u1.AbsContains("Spellproof")) {
                                        this.Explode(u1, true);
                                        if (!Bridge.referenceEquals(u1.parameters.Armor, "None")) {
                                            u1.parameters.Armor = "None";
                                        }
                                    }
                                }
                            } finally {
                                if (Bridge.is($t1, System.IDisposable)) {
                                    $t1.System$IDisposable$Dispose();
                                }
                            }

                            break;
                        }
                    case "Storm": 
                        {
                            $t2 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                            try {
                                while ($t2.moveNext()) {
                                    var u2 = $t2.Current;
                                    if (u2.owner !== 0 && !u2.parameters.isBuilding && u2.parameters.moveType === DarkKingdomCore.UnitMoveType.FlyingMT && !u2.AbsContains("Spellproof")) {
                                        this.Harm(u2, DarkKingdomCore.MyGame.rnd.Next$2(70, 101), false, DarkKingdomCore.EffectType.Bad);
                                        u2.landing = true;
                                    }
                                }
                            } finally {
                                if (Bridge.is($t2, System.IDisposable)) {
                                    $t2.System$IDisposable$Dispose();
                                }
                            }

                            break;
                        }
                    case "Mass_polymorph": 
                        {
                            var allunitst = new (System.Collections.Generic.List$1(System.String)).ctor();
                            var u3;
                            $t3 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                            try {
                                while ($t3.moveNext()) {
                                    var uu = $t3.Current;
                                    if (!uu.parameters.isBuilding && !uu.AbsContains("Spellproof")) {
                                        allunitst.clear();
                                        $t4 = Bridge.getEnumerator(DarkKingdomCore.MyGame.unitPrms.Values);
                                        try {
                                            while ($t4.moveNext()) {
                                                var up = $t4.Current.$clone();
                                                if (!up.special) {
                                                    if (up.Cost.Tier === uu.parameters.Cost.Tier && DarkKingdomCore.MyGame.plrs[uu.owner].CheckForLimit(up.Name)) {
                                                        allunitst.add(up.Name);
                                                    }
                                                }
                                            }
                                        } finally {
                                            if (Bridge.is($t4, System.IDisposable)) {
                                                $t4.System$IDisposable$Dispose();
                                            }
                                        }
                                        if (allunitst.Count > 0) {
                                            u3 = DarkKingdomCore.MyGame.rnd.Next$2(0, allunitst.Count);
                                            uu.SetParams(DarkKingdomCore.MyGame.unitPrms.getItem(allunitst.getItem(u3)).$clone(), true);
                                            uu.purified = false;
                                            uu.takedOff = false;
                                            uu.landing = false;
                                        }
                                    }
                                }
                            } finally {
                                if (Bridge.is($t3, System.IDisposable)) {
                                    $t3.System$IDisposable$Dispose();
                                }
                            }

                            break;
                        }
                    case "Jackpot": 
                        {
                            var allspells = new (System.Collections.Generic.List$1(System.String)).ctor();
                            $t5 = Bridge.getEnumerator(this.spells.Keys);
                            try {
                                while ($t5.moveNext()) {
                                    var spl = $t5.Current;
                                    allspells.add(spl);
                                }
                            } finally {
                                if (Bridge.is($t5, System.IDisposable)) {
                                    $t5.System$IDisposable$Dispose();
                                }
                            }
                            DarkKingdomCore.MyGame.plrs[0].spllsList = this.RandomizeSpells(DarkKingdomCore.MyGame.plrs[0].spllsList.Count, allspells);
                            this.updateSpells = true;
                            break;
                        }
                    case "Arrowrain": 
                        {
                            $t6 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                            try {
                                while ($t6.moveNext()) {
                                    var uu1 = $t6.Current;
                                    if (uu1.owner === 1 && !(Bridge.referenceEquals(uu1.parameters.Name, DarkKingdomCore.MyGame.plrs[1].hero))) {
                                        this.ammos.add(new DarkKingdomCore.Ammo.ctor(0, DarkKingdomCore.Ammo.AmmoType.Arrow, ((-this.us2) | 0), DarkKingdomCore.MyGame.hor, null, uu1, Bridge.Int.mul(DarkKingdomCore.MyGame.plrs[0].uCount, DarkKingdomCore.MyGame.rnd.Next$2(5, 11)), false, false, 7200));
                                    }
                                }
                            } finally {
                                if (Bridge.is($t6, System.IDisposable)) {
                                    $t6.System$IDisposable$Dispose();
                                }
                            }

                            break;
                        }
                    case "Poison_wave": 
                        {
                            $t7 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                            try {
                                while ($t7.moveNext()) {
                                    var uu2 = $t7.Current;
                                    if (!uu2.AbsContains("Spellproof")) {
                                        if (uu2.AbsContains("Poison")) {
                                            uu2.RemoveAbil("Poison");
                                            if (uu2.owner === 0) {
                                                this.Heal(uu2, DarkKingdomCore.MyGame.rnd.Next$2(70, 101));
                                            } else {
                                                if (uu2.owner === 1) {
                                                    this.Harm(uu2, DarkKingdomCore.MyGame.rnd.Next$2(70, 101), true, DarkKingdomCore.EffectType.Poison);
                                                }
                                            }
                                        }
                                    }
                                }
                            } finally {
                                if (Bridge.is($t7, System.IDisposable)) {
                                    $t7.System$IDisposable$Dispose();
                                }
                            }

                            break;
                        }
                }
                this.SpellComplete(name);
                return true;
            },
            SpellComplete: function (name) {
                var $t, $t1;
                DarkKingdomCore.MyGame.plrs[0].Resources = DarkKingdomCore.TimeCost.op_Subtraction(DarkKingdomCore.MyGame.plrs[0].Resources.$clone(), this.spells.getItem(name).Cost.$clone());
                DarkKingdomCore.MyGame.plrs[0].spellsRchrg.setItem(DarkKingdomCore.MyGame.plrs[0].spllsList.indexOf(name), this.spells.getItem(name).Cost.Time);
                this.ShowInfoPar(this.localize.GetString(name), DarkKingdomCore.MyGame.goodAbilClr.$clone(), ((Bridge.Int.div(DarkKingdomCore.MyGame.gameWidth, 2)) | 0), ((Bridge.Int.div(DarkKingdomCore.MyGame.gameHeight, 2)) | 0), true, true);
                $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                try {
                    while ($t.moveNext()) {
                        var uu = $t.Current;
                        if (uu.AbsContains("Antimage")) {
                            uu.Attack = DarkKingdomCore.Attack.op_Addition$1(uu.Attack.$clone(), (uu.abils.getItem("Antimage").value) | 0);
                            this.ShowInfoPar("\u041c\u0430\u0433\u0438\u044f!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), uu.x, ((DarkKingdomCore.MyGame.hor + uu.parameters.rect.Top) | 0), true);
                        }
                        if (uu.AbsContains("Magic_power")) {
                            ($t1 = uu.parameters.Attack.$clone()).Range = ($t1.Range + 1) | 0;
                            this.ShowInfoPar("\u041c\u0430\u0433\u0438\u044f!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), uu.x, ((DarkKingdomCore.MyGame.hor + uu.parameters.rect.Top) | 0), true);
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            },
            MouseClicked: function (pos, isTouch) {
                var $t;
                if (isTouch === void 0) { isTouch = false; }
                if (this.selU != null) {
                    this.selU = null;
                }
                this.MainContainer.ClickButton$1(Bridge.Int.clip32(pos.X), Bridge.Int.clip32(pos.Y), isTouch);
                if (DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.InGame) {
                    var respos = new Microsoft.Xna.Framework.Vector2.$ctor2(pos.X * this.scaleX, pos.Y * this.scaleY);

                    var trgs = new (System.Collections.Generic.List$1(DarkKingdomCore.Unit)).ctor();
                    $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                    try {
                        while ($t.moveNext()) {
                            var u = $t.Current;
                            if (u.x + u.parameters.rect.Right > respos.X && respos.X > u.x + u.parameters.rect.Left && ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Bottom) | 0) > respos.Y && respos.Y > ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0)) {
                                if (u.owner === 1 || !u.AbsContains("Invisible")) {
                                    this.selU = u;
                                    trgs.add(u);
                                }
                            }
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                    if (this.inSpellMode) {
                        if (this.DoUnitsSpells(this.spellName, trgs)) {
                            this.inSpellMode = false;
                        }
                    }
                }
            },
            AddToReadyUnits: function (plr, unitName) {
                var unitRes = unitName;
                if (DarkKingdomCore.MyGame.unitPrms.getItem(unitName).$clone().AbsContains("Crowd")) {
                    if (DarkKingdomCore.MyGame.unitPrms.getItem(unitName).$clone().AbsContains("Crowd2") && plr.res.Tier === 2) {
                        if (DarkKingdomCore.MyGame.rnd.NextDouble() < 0.5) {
                            unitRes = "Skeleton_archer";
                        } else {
                            if (DarkKingdomCore.MyGame.rnd.NextDouble() < 0.8) {
                                unitRes = "Skeleton_warrior";
                            } else {
                                unitRes = "Skeleton_knight";
                            }
                        }
                    } else if (DarkKingdomCore.MyGame.rnd.NextDouble() < 0.5) {
                        unitRes = "Skeleton_archer";
                    } else {
                        unitRes = "Skeleton_warrior";
                    }
                }
                plr.readyUnits.add(unitRes);
            },
            DrawInterface: function (sb) {
                this.MainContainer.Draw(sb, 1.0);
            },
            battleFrmMainMenu: function (btn, isTouch) {
                this.StartBattle();
            },
            profileFrmMainMenu: function (btn, isTouch) {
                this.StartProfile();
            },
            surrenderFrmBattleMenu_Clicked: function (btn, isTouch) {
                var $step = 0,
                    $task1, 
                    $taskResult1, 
                    $jumpFromFinally, 
                    $asyncBody = Bridge.fn.bind(this, function () {
                        for (;;) {
                            $step = System.Array.min([0,1,2,3,4], $step);
                            switch ($step) {
                                case 0: {
                                    this.frmBattleMenu.Hide(this.mainAnimator);

                                    $task1 = this.ShowDialogConfirmation("\u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0441\u0434\u0430\u0442\u044c\u0441\u044f?");
                                    $step = 1;
                                    if ($task1.isCompleted()) {
                                        continue;
                                    }
                                    $task1.continue($asyncBody);
                                    return;
                                }
                                case 1: {
                                    $taskResult1 = $task1.getAwaitedResult();
                                    if ($taskResult1) {
                                        $step = 2;
                                        continue;
                                    } else  {
                                        $step = 3;
                                        continue;
                                    }
                                }
                                case 2: {
                                    DarkKingdomCore.MyGame.gState = DarkKingdomCore.GameState.Lose;
                                    this.EndOfBattle();
                                    $step = 4;
                                    continue;
                                }
                                case 3: {
                                    this.frmBattleMenu.Show(this.mainAnimator);
                                    $step = 4;
                                    continue;
                                }
                                case 4: {
                                    return;
                                }
                                default: {
                                    return;
                                }
                            }
                        }
                    }, arguments);

                $asyncBody();
            },
            restartFrmBattleMenu_Clicked: function (btn, isTouch) {
                var $step = 0,
                    $task1, 
                    $taskResult1, 
                    $jumpFromFinally, 
                    $asyncBody = Bridge.fn.bind(this, function () {
                        for (;;) {
                            $step = System.Array.min([0,1,2,3,4], $step);
                            switch ($step) {
                                case 0: {
                                    this.frmBattleMenu.Hide(this.mainAnimator);

                                    $task1 = this.ShowDialogConfirmation("\u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u043d\u0430\u0447\u0430\u0442\u044c \u0437\u0430\u043d\u043e\u0432\u043e?");
                                    $step = 1;
                                    if ($task1.isCompleted()) {
                                        continue;
                                    }
                                    $task1.continue($asyncBody);
                                    return;
                                }
                                case 1: {
                                    $taskResult1 = $task1.getAwaitedResult();
                                    if ($taskResult1) {
                                        $step = 2;
                                        continue;
                                    } else  {
                                        $step = 3;
                                        continue;
                                    }
                                }
                                case 2: {
                                    this.StartAgain();
                                    $step = 4;
                                    continue;
                                }
                                case 3: {
                                    this.frmBattleMenu.Show(this.mainAnimator);
                                    $step = 4;
                                    continue;
                                }
                                case 4: {
                                    return;
                                }
                                default: {
                                    return;
                                }
                            }
                        }
                    }, arguments);

                $asyncBody();
            },
            AIFrmBattleMenu_Clicked: function (btn, is_touch) {
                this.SetPlayerAI(!DarkKingdomCore.MyGame.plrs[0].AI);
            },
            backFrmBattleMenu_Clicked: function (btn, isTouch) {
                this.Pause = false;
            },
            exitFrmMenuExit_Clicked: function (btn, isTouch) {
                var $step = 0,
                    $task1, 
                    $taskResult1, 
                    $jumpFromFinally, 
                    $asyncBody = Bridge.fn.bind(this, function () {
                        for (;;) {
                            $step = System.Array.min([0,1,2,3], $step);
                            switch ($step) {
                                case 0: {
                                    $task1 = this.ShowDialogConfirmation("\u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0432\u044b\u0439\u0442\u0438 \u0438\u0437 \u0438\u0433\u0440\u044b?");
                                    $step = 1;
                                    if ($task1.isCompleted()) {
                                        continue;
                                    }
                                    $task1.continue($asyncBody);
                                    return;
                                }
                                case 1: {
                                    $taskResult1 = $task1.getAwaitedResult();
                                    if ($taskResult1) {
                                        $step = 2;
                                        continue;
                                    } 
                                    $step = 3;
                                    continue;
                                }
                                case 2: {
                                    !Bridge.staticEquals(this.OnExit, null) ? this.OnExit() : null;
                                    $step = 3;
                                    continue;
                                }
                                case 3: {
                                    return;
                                }
                                default: {
                                    return;
                                }
                            }
                        }
                    }, arguments);

                $asyncBody();
            },
            settingsFrmMenuExit_Clicked: function (btn, isTouch) {
                this.frmSettings.Show(this.mainAnimator);
            },
            okayFrmDialog_Clicked: function (btn, isTouch) {
                this.ClearVarsAndCalcEarned();
                this.HideSomeChildren([this.frmResources, this.frmUnits, this.frmProduction]);
                this.ShowSomeChildren([this.frmMainMenu, this.frmRightMenu]);
                this.frmDialog.Hide(this.mainAnimator);
                this.StartBattle();
            },
            pauseFrmResources_Clicked: function (btn, isTouch) {
                if (DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.InGame) {
                    this.Pause = !this.Pause;
                }
            },
            tierUpFrmResources_Clicked: function (btn, isTouch) {
                var tier;
                if ((DarkKingdomCore.MyGame.plrs[0].res.Tier === 1)) {
                    tier = "Tier_2";
                } else {
                    tier = "Tier_3";
                }
                this.TryAddToQueueUnit(DarkKingdomCore.MyGame.plrs[0], tier);
            },
            tierUpFrmResources_Focused: function (btn, isTouch) {
                var tier;
                if ((DarkKingdomCore.MyGame.plrs[0].res.Tier === 1)) {
                    tier = "Tier_2";
                } else {
                    tier = "Tier_3";
                }
                this.ShowMoreInfo(DarkKingdomCore.MyGame.unitPrms.getItem(tier).$clone().Cost.$clone(), true, Bridge.getDefaultValue(Microsoft.Xna.Framework.Point), [this.localize.GetString(DarkKingdomCore.MyGame.unitPrms.getItem(tier).$clone().Name), "", DarkKingdomCore.MyGame.unitPrms.getItem(tier).$clone().Description]);
            },
            btnStartBattle: function (btn, isTouch) {
                this.StartPreGame();
                this.frmBattle.Hide(this.mainAnimator);
            },
            btnProduction_Clicked: function (btn, isTouch) {
                for (var i = 0; i < this.btnsProduction.length; i = (i + 1) | 0) {
                    if (Bridge.referenceEquals(btn, this.btnsProduction[i])) {
                        if (i < DarkKingdomCore.MyGame.plrs[0].readyUnits.Count) {
                            this.ProduceUnit(0, DarkKingdomCore.MyGame.plrs[0].readyUnits.getItem(i));
                            DarkKingdomCore.MyGame.plrs[0].readyUnits.removeAt(i);
                            this.UpdateQueue();
                            break;
                        } else if (((i - DarkKingdomCore.MyGame.plrs[0].readyUnits.Count) | 0) < DarkKingdomCore.MyGame.plrs[0].prdQ.Count && isTouch) {
                            DarkKingdomCore.MyGame.plrs[0].Resources = DarkKingdomCore.TimeCost.op_Addition(DarkKingdomCore.MyGame.plrs[0].Resources.$clone(), DarkKingdomCore.MyGame.unitPrms.getItem(DarkKingdomCore.MyGame.plrs[0].prdQ.getItem(((i - DarkKingdomCore.MyGame.plrs[0].readyUnits.Count) | 0))).$clone().Cost.$clone());
                            this.RemoveFromQueue(0, ((i - DarkKingdomCore.MyGame.plrs[0].readyUnits.Count) | 0));
                            break;
                        }
                    }
                }
            },
            btnProductionRemove_Clicked: function (btn, isTouch) {
                for (var i = 0; i < this.btnsProduction.length; i = (i + 1) | 0) {
                    if (Bridge.referenceEquals(btn.Parent, this.btnsProduction[i])) {
                        if (((i - DarkKingdomCore.MyGame.plrs[0].readyUnits.Count) | 0) < DarkKingdomCore.MyGame.plrs[0].prdQ.Count && !isTouch) {
                            DarkKingdomCore.MyGame.plrs[0].Resources = DarkKingdomCore.TimeCost.op_Addition(DarkKingdomCore.MyGame.plrs[0].Resources.$clone(), DarkKingdomCore.MyGame.unitPrms.getItem(DarkKingdomCore.MyGame.plrs[0].prdQ.getItem(((i - DarkKingdomCore.MyGame.plrs[0].readyUnits.Count) | 0))).$clone().Cost.$clone());
                            this.RemoveFromQueue(0, ((i - DarkKingdomCore.MyGame.plrs[0].readyUnits.Count) | 0));
                            break;
                        }
                    }
                }
            },
            btnProduction_Focused: function (btn, isTouch) {
                for (var i = 0; i < this.btnsProduction.length; i = (i + 1) | 0) {

                    if (Bridge.referenceEquals(btn, this.btnsProduction[i])) {
                        if (i < DarkKingdomCore.MyGame.plrs[0].readyUnits.Count) {
                            this.ShowUnitInfo(DarkKingdomCore.MyGame.unitPrms.getItem(DarkKingdomCore.MyGame.plrs[0].readyUnits.getItem(i)).$clone(), 0, false, new Microsoft.Xna.Framework.Point.$ctor2(btn.FinalRight, btn.FinalBottom));
                        } else {
                            if (((i - DarkKingdomCore.MyGame.plrs[0].readyUnits.Count) | 0) < DarkKingdomCore.MyGame.plrs[0].prdQ.Count) {
                                btn.Children.getItem(2).Visible = !isTouch;
                                this.ShowUnitInfo(DarkKingdomCore.MyGame.unitPrms.getItem(DarkKingdomCore.MyGame.plrs[0].prdQ.getItem(((i - DarkKingdomCore.MyGame.plrs[0].readyUnits.Count) | 0))).$clone(), 0, false, new Microsoft.Xna.Framework.Point.$ctor2(btn.FinalRight, btn.FinalBottom));
                            }
                        }
                    }
                }
            },
            TextureToApp: function (tex) {
                var $t;
                var colors = System.Array.init(1, function (){
                    return new Microsoft.Xna.Framework.Color();
                }, Microsoft.Xna.Framework.Color);
                tex.GetData(Microsoft.Xna.Framework.Color, colors);
                System.Console.WriteLine(colors[0].$clone());
                return new MonoInterface.Appearance.$ctor1(($t = new MonoInterface.Sprite(), $t.Texture = tex, $t.W = 1, $t.H = 1, $t), 0);
            },
            CreateInterfaceTexures: function () {
                this.defaultTheme.EmptyTexture = MonoInterface.Theme.GetEmptyApp(this.graphics.GraphicsDevice);

                //defaultTheme.FrameBackTexture = TextureToApp(MonoInterface.Theme.SolidColorTexture(graphics.GraphicsDevice, 173, 122, 71, 220));
                this.defaultTheme.FrameBackTexture = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("empty"), 0);

                //defaultTheme.ButtonBackTexture = TextureToApp(MonoInterface.Theme.SolidColorTexture(graphics.GraphicsDevice, 123, 72, 21));
                this.defaultTheme.ButtonBackTexture = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("empty"), 1);
                //defaultTheme.ButtonSelectedTexture = TextureToApp(MonoInterface.Theme.SolidColorTexture(graphics.GraphicsDevice, 200, 200, 200));
                this.defaultTheme.ButtonSelectedTexture = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("empty"), 2);
                //defaultTheme.ButtonFrontTexture = TextureToApp(MonoInterface.Theme.SolidColorTexture(graphics.GraphicsDevice, 255, 255, 51, 120));
                this.defaultTheme.ButtonFrontTexture = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("empty"), 3);
                //defaultTheme.ButtonPressedTexture = TextureToApp(MonoInterface.Theme.SolidColorTexture(graphics.GraphicsDevice, 220, 220, 220, 180));
                this.defaultTheme.ButtonPressedTexture = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("empty"), 4);
                //defaultTheme.ButtonDisabledTexture = TextureToApp(MonoInterface.Theme.SolidColorTexture(graphics.GraphicsDevice, 100, 100, 100, 200));
                this.defaultTheme.ButtonDisabledTexture = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("empty"), 5);

                this.defaultTheme.ProgressBackTexture = this.defaultTheme.EmptyTexture.$clone();
                //defaultTheme.ProgressFrontTexture = TextureToApp(MonoInterface.Theme.SolidColorTexture(graphics.GraphicsDevice, 140, 140, 140, 200));
                this.defaultTheme.ProgressFrontTexture = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("empty"), 6);

                this.defaultTheme.SwitcherButtonLeftTexture = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("medium_icons"), 2);
                this.defaultTheme.SwitcherButtonRightTexture = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("medium_icons"), 3);
                this.defaultTheme.SwitcherDescriptionFontSize = 14;
                this.defaultTheme.SwitcherDescriptionColor = Microsoft.Xna.Framework.Color.Black.$clone();
                this.defaultTheme.SwitcherMainFontSize = 20;
                this.defaultTheme.SwitcherMainColor = Microsoft.Xna.Framework.Color.Black.$clone();

                var nfts = System.Array.init(10, function (){
                    return new MonoInterface.Appearance();
                }, MonoInterface.Appearance);
                for (var i = 0; i <= 8; i = (i + 1) | 0) {
                    nfts[i] = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("nineframe"), i);
                }

                this.defaultTheme.NineFrameBoderTexture = nfts;

                this.defaultTheme.Fonts = this.Fonts;

                //backTheme.FrameBackTexture = TextureToApp(MonoInterface.Theme.SolidColorTexture(graphics.GraphicsDevice, 0, 0, 0, 150));
                this.backTheme.FrameBackTexture = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("empty"), 7);
            },
            CreateInterface: function () {
                var $t;
                this.defaultTheme = new MonoInterface.Theme();
                this.backTheme = new MonoInterface.Theme();

                this.CreateInterfaceTexures();

                this.MainContainer = ($t = new MonoInterface.Window(0, 0, DarkKingdomCore.MyGame.gameWidth, DarkKingdomCore.MyGame.gameHeight), $t.CurrentTheme = this.defaultTheme, $t);


                this.mainAnimator = new MonoInterface.Animator();

                this.frmUnits = this.MainContainer.AddChild(MonoInterface.Frame, ($t = new MonoInterface.Frame(0, 0, 300, 110, 0.0, 0.0, false), $t.LeftBorder = false, $t.TopBorder = false, $t.ShowAnimation = new MonoInterface.NumberAnimation("Y", -82, 0, 20), $t));

                this.cUnits = this.frmUnits.AddChild(MonoInterface.Container, new MonoInterface.Container(5, 5, 290, 60, 0.0, 0.0, true));
                this.cSpells = this.frmUnits.AddChild(MonoInterface.Container, new MonoInterface.Container(5, 5, 290, 60, 0.0, 0.0, true));
                this.cBuildings = this.frmUnits.AddChild(MonoInterface.Container, new MonoInterface.Container(5, 5, 290, 60, 0.0, 0.0, true));


                this.btnSelectUnits = this.frmUnits.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor3(Bridge.fn.bind(this, function (btn, is_touch) {
                    this.cUnits.Visible = true;
                    this.cSpells.Visible = false;
                    this.cBuildings.Visible = false;
                    this.btnSelectUnits.IsSelected = true;
                    this.btnSelectSpells.IsSelected = false;
                    this.btnSelectBuildings.IsSelected = false;

                    this.frmUnits.W = (Math.max(System.Linq.Enumerable.from(this.cUnits.Children, MonoInterface.Block).last().Right, this.btnSelectBuildings.Right) + 5) | 0;
                }), 5, -5, 100, 30, 0.0, 1.0, true));
                this.btnSelectUnits.AddChild(MonoInterface.Label, new MonoInterface.Label("\u0421\u0443\u0449\u0435\u0441\u0442\u0432\u0430", 16, Microsoft.Xna.Framework.Color.Black.$clone()));

                this.btnSelectSpells = this.frmUnits.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor3(Bridge.fn.bind(this, function (btn, is_touch) {
                    this.cUnits.Visible = false;
                    this.cSpells.Visible = true;
                    this.cBuildings.Visible = false;
                    this.btnSelectUnits.IsSelected = false;
                    this.btnSelectSpells.IsSelected = true;
                    this.btnSelectBuildings.IsSelected = false;

                    this.frmUnits.W = (Math.max(System.Linq.Enumerable.from(this.cSpells.Children, MonoInterface.Block).last().Right, this.btnSelectBuildings.Right) + 5) | 0;
                }), 110, -5, 100, 30, 0.0, 1.0, true));

                this.btnSelectSpells.AddChild(MonoInterface.Label, new MonoInterface.Label("\u0417\u0430\u043a\u043b\u0438\u043d\u0430\u043d\u0438\u044f", 16, Microsoft.Xna.Framework.Color.Black.$clone()));

                this.btnSelectBuildings = this.frmUnits.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor3(Bridge.fn.bind(this, function (btn, is_touch) {
                    this.cUnits.Visible = false;
                    this.cSpells.Visible = false;
                    this.cBuildings.Visible = true;
                    this.btnSelectUnits.IsSelected = false;
                    this.btnSelectSpells.IsSelected = false;
                    this.btnSelectBuildings.IsSelected = true;

                    this.frmUnits.W = (Math.max(System.Linq.Enumerable.from(this.cBuildings.Children, MonoInterface.Block).last().Right, this.btnSelectBuildings.Right) + 5) | 0;
                }), 215, -5, 100, 30, 0.0, 1.0, true));
                this.btnSelectBuildings.IsDisabled = true;
                this.btnSelectBuildings.AddChild(MonoInterface.Label, new MonoInterface.Label("\u041f\u043e\u0441\u0442\u0440\u043e\u0439\u043a\u0438", 16, Microsoft.Xna.Framework.Color.Black.$clone()));

                // frmUnits.HideAnimation = New MonoInterface.NumberAnimation(frmUnits, "Y", 0, -82, 50, Nothing, Nothing)


                this.frmProduction = this.MainContainer.AddChild(MonoInterface.Frame, ($t = new MonoInterface.Frame(0, 130, 355, 55, 0.0, 0.0, false), $t.LeftBorder = false, $t.ShowAnimation = new MonoInterface.NumberAnimation("X", -355, 0, 50), $t.HideAnimation = new MonoInterface.NumberAnimation("X", 0, -355, -50), $t));

                for (var i = 0; i <= 6; i = (i + 1) | 0) {
                    this.btnsProduction[i] = this.frmProduction.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor2(Bridge.fn.cacheBind(this, this.btnProduction_Clicked), Bridge.fn.cacheBind(this, this.btnProduction_Focused), ((5 + Bridge.Int.mul(i, 50)) | 0), 5, 45, 45, 0.0, 0.0, true));
                    this.btnsProduction[i].AddChild(MonoInterface.Picture, new MonoInterface.Picture(this.defaultTheme.EmptyTexture.$clone(), 0, 0, 45, 45, 0.5, 0.5, true));
                    this.btnsProduction[i].AddChild(MonoInterface.Picture, new MonoInterface.Picture(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("small_icons"), 19), 0, 0, 20, 16, 1.0, 1.0, true));

                    this.btnsProduction[i].AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor3(Bridge.fn.cacheBind(this, this.btnProductionRemove_Clicked), 0, 0, 16, 16, 1.0, 0.0, true)).AddChild(MonoInterface.Picture, new MonoInterface.Picture(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("small_icons"), 20), 0, 0, 20, 16, 1.0, 0.0, true));

                    this.prgsProduction[i] = this.btnsProduction[i].AddChild(MonoInterface.Progress, new MonoInterface.Progress(0, 0, 0, 0, 45, 45, 0));
                }
                // ' Ð¤ÑÐµÐ¹Ð¼ Ð³Ð»Ð°Ð²Ð½Ð¾Ð³Ð¾ Ð¼ÐµÐ½Ñ

                this.frmMainMenu = this.MainContainer.AddChild(MonoInterface.Frame, ($t = new MonoInterface.Frame(0, 0, 74, 74, 0.0, 0.0, false), $t.LeftBorder = false, $t.TopBorder = false, $t));
                this.frmMainMenu.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor3(Bridge.fn.cacheBind(this, this.battleFrmMainMenu), 5, 0, 64, 64, 0.0, 0.5, true)).AddChild(MonoInterface.Picture, new MonoInterface.Picture(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("big_icons"), 1)));

                // ' Ð¤ÑÐµÐ¹Ð¼ ÑÐµÑÑÑÑÐ¾Ð² 
                this.frmResources = this.MainContainer.AddChild(MonoInterface.Frame, ($t = new MonoInterface.Frame(0, 0, 250, 70, 1.0, 0.0, false), $t.RightBorder = false, $t.TopBorder = false, $t.ShowAnimation = new MonoInterface.NumberAnimation("Y", -82, 0, 20), $t));
                this.btnTierUpFrmResources = this.frmResources.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor1(Bridge.fn.cacheBind(this, this.tierUpFrmResources_Clicked), Bridge.fn.cacheBind(this, this.tierUpFrmResources_Focused), Microsoft.Xna.Framework.Input.Keys.Enter, 5, 0, 60, 60, 0.0, 0.5, true));
                this.pctTierFrmResources = this.btnTierUpFrmResources.AddChild(MonoInterface.Picture, new MonoInterface.Picture(DarkKingdomCore.MyGame.unitPrms.getItem("Tier_2").$clone().iconApp.$clone(), 0, 0, 60, 60, 0.5, 0.5, true));

                this.frmResources.AddChild(MonoInterface.Picture, new MonoInterface.Picture(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("small_icons"), 12), -72, -17, 40, 32, 1.0, 0.5, true));
                this.frmResources.AddChild(MonoInterface.Picture, new MonoInterface.Picture(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("small_icons"), 13), -72, 15, 40, 32, 1.0, 0.5, true));

                this.lblGoldFrmResources = this.frmResources.AddChild(MonoInterface.Label, new MonoInterface.Label("", 20, this.moneyClr.$clone(), -115, -10, 1.0, 0.5, true));
                this.lblDeathFrmResources = this.frmResources.AddChild(MonoInterface.Label, new MonoInterface.Label("", 20, this.deathClr.$clone(), -115, 20, 1.0, 0.5, true));


                this.pctPauseFrmResources = this.frmResources.AddChild(MonoInterface.Button, new MonoInterface.Button.ctor(Bridge.fn.cacheBind(this, this.pauseFrmResources_Clicked), Microsoft.Xna.Framework.Input.Keys.Escape, -5, 0, 60, 60, 1.0, 0.5, true)).AddChild(MonoInterface.Picture, new MonoInterface.Picture(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("medium_icons"), 1), 0, 0, 60, 60, 0.5, 0.5, true));


                this.frmRightMenu = this.MainContainer.AddChild(MonoInterface.Frame, ($t = new MonoInterface.Frame(0, 0, 74, 74, 1.0, 0.0, false), $t.RightBorder = false, $t.TopBorder = false, $t));
                this.frmRightMenu.AddChild(MonoInterface.Button, new MonoInterface.Button.ctor(Bridge.fn.cacheBind(this, this.exitFrmMenuExit_Clicked), Microsoft.Xna.Framework.Input.Keys.Escape, 5, 0, 64, 64, 0.0, 0.5, true)).AddChild(MonoInterface.Picture, new MonoInterface.Picture(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("medium_icons"), 0), 0, 0, 64, 64, 0.5, 0.5, true));

                // ' Ð¤ÑÐµÐ¹Ð¼ ÑÑÐ°ÑÑÐ° Ð±Ð¸ÑÐ²Ñ
                this.frmBattle = this.MainContainer.AddChild(MonoInterface.Frame, ($t = new MonoInterface.Frame(0, 0, 450, 330, 0.5, 0.5, false), $t.ShowAnimation = new MonoInterface.NumberAnimation("Y", -300, 0, 50), $t.HideAnimation = new MonoInterface.NumberAnimation("Y", 0, 300, 50), $t));
                this.frmBattle.AddChild(MonoInterface.Label, new MonoInterface.Label("\u0411\u0438\u0442\u0432\u0430", 30, Microsoft.Xna.Framework.Color.Black.$clone(), 0, 7, 0.5, 0.0, true));
                this.frmBattle.AddChild(MonoInterface.Label, new MonoInterface.Label("VS", 20, Microsoft.Xna.Framework.Color.Black.$clone(), 0, 55, 0.5, 0.0, true));


                var ps1 = System.Array.init(((((this.races1.Count - 1) | 0) + 1) | 0), function (){
                    return new MonoInterface.Appearance();
                }, MonoInterface.Appearance);
                var ts1 = System.Array.init(((((this.races1.Count - 1) | 0) + 1) | 0), null, System.String);
                var ds1 = System.Array.init(((((this.races1.Count - 1) | 0) + 1) | 0), null, System.String);
                for (var i1 = 0; i1 < this.races1.Count; i1 = (i1 + 1) | 0) {
                    ps1[i1] = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("race_icons"), DarkKingdomCore.RaceManager.Instance.All.getItem(this.races1.getItem(i1)).symb);
                    ts1[i1] = DarkKingdomCore.RaceManager.Instance.All.getItem(this.races1.getItem(i1)).name;
                    ds1[i1] = DarkKingdomCore.RaceManager.Instance.All.getItem(this.races1.getItem(i1)).desc;
                }

                var ps2 = System.Array.init(((((this.races2.Count - 1) | 0) + 1) | 0), function (){
                    return new MonoInterface.Appearance();
                }, MonoInterface.Appearance);
                var ts2 = System.Array.init(((((this.races2.Count - 1) | 0) + 1) | 0), null, System.String);
                var ds2 = System.Array.init(((((this.races2.Count - 1) | 0) + 1) | 0), null, System.String);

                for (var i2 = 0; i2 < this.races2.Count; i2 = (i2 + 1) | 0) {
                    ps2[i2] = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("race_icons"), DarkKingdomCore.RaceManager.Instance.All.getItem(this.races2.getItem(i2)).symb);
                    ts2[i2] = DarkKingdomCore.RaceManager.Instance.All.getItem(this.races2.getItem(i2)).name;
                    ds2[i2] = DarkKingdomCore.RaceManager.Instance.All.getItem(this.races2.getItem(i2)).desc;
                }

                this.races1SwitcherFrmBattle = this.frmBattle.AddChild(MonoInterface.Switcher, new MonoInterface.Switcher(ps1, ts1, ds1, 0, this.mainAnimator, -100, 60, 150, 100, 0.5, 0.0, true));
                this.races2SwitcherFrmBattle = this.frmBattle.AddChild(MonoInterface.Switcher, new MonoInterface.Switcher(ps2, ts2, ds2, 0, this.mainAnimator, 100, 60, 150, 100, 0.5, 0.0, true));

                var gameTypes = System.Array.init(["RandomGT", "StandartGT", "OffenceGT", "DefenceGT", "FirstHeroGT"], System.String);
                var gts = System.Array.init(gameTypes.length, null, System.String);
                var gdts = System.Array.init(gameTypes.length, null, System.String);
                for (var i3 = 0; i3 < gameTypes.length; i3 = (i3 + 1) | 0) {
                    gts[i3] = gameTypes[i3];
                    gdts[i3] = (gameTypes[i3] || "") + "Desc";
                }

                this.modeSwitcherFrmBattle = this.frmBattle.AddChild(MonoInterface.Switcher, new MonoInterface.Switcher(null, gts, gdts, 0, this.mainAnimator, 0, 170, 350, 100, 0.5, 0.0, true));
                this.frmBattle.AddChild(MonoInterface.Button, new MonoInterface.Button.ctor(Bridge.fn.cacheBind(this, this.btnStartBattle), Microsoft.Xna.Framework.Input.Keys.Enter, 0, -10, 150, 45, 0.5, 1.0, true)).AddChild(MonoInterface.Label, new MonoInterface.Label("\u0412\u043f\u0435\u0440\u0435\u0434", 20, Microsoft.Xna.Framework.Color.Black.$clone()));


                // 'Ð¤ÑÐµÐ¹Ð¼ Ð·Ð°ÑÐµÐ¼Ð½ÐµÐ½Ð¸Ñ 
                this.frmBack = this.MainContainer.AddChild(MonoInterface.Frame, ($t = new MonoInterface.Frame(0, 0, -1, -1, 0.5, 0.5, false), $t.ShowAnimation = new MonoInterface.NumberAnimation("Alpha", 0, 1, 0.05), $t.HideAnimation = new MonoInterface.NumberAnimation("Alpha", 1, 0, -0.05), $t));


                // ' Ð¤ÑÐµÐ¹Ð¼ Ð½Ð°ÑÑÑÐ¾ÐµÐº
                this.frmSettings = this.MainContainer.AddChild(MonoInterface.Frame, ($t = new MonoInterface.Frame(0, 0, 350, 200, 0.5, 0.5, false), $t.ShowAnimation = new MonoInterface.NumberAnimation("Y", -300, 0, 50, Bridge.fn.bind(this, function () {
                    this.frmBack.Show(this.mainAnimator);
                })), $t.HideAnimation = new MonoInterface.NumberAnimation("Y", 0, 300, 50, Bridge.fn.bind(this, function () {
                    this.frmBack.Hide(this.mainAnimator);
                })), $t));
                this.frmSettings.AddChild(MonoInterface.Label, new MonoInterface.Label("\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438", 30, Microsoft.Xna.Framework.Color.Black.$clone(), 0, 7, 0.5, 0.0, true));


                this.CreateScreenFormats();

                var sModes = System.Array.init(this.screenFormats.Count, null, System.String);
                for (var i4 = 0; i4 < this.screenFormats.Count; i4 = (i4 + 1) | 0) {
                    sModes[i4] = System.String.format("{0} x {1} : {2}", this.screenFormats.getItem(i4).$clone().X, this.screenFormats.getItem(i4).$clone().Y, this.screenFormats.getItem(i4).$clone().Z);
                }

                this.resSwitcherFrmSettings = this.frmSettings.AddChild(MonoInterface.Switcher, new MonoInterface.Switcher(null, sModes, null, 0, this.mainAnimator, 0, 40, 300, 100, 0.5, 0.0, true));

                this.frmSettings.AddChild(MonoInterface.Button, new MonoInterface.Button.ctor(Bridge.fn.cacheBind(this, this.backFrmSettings), Microsoft.Xna.Framework.Input.Keys.Escape, 10, -10, 150, 45, 0.0, 1.0, true)).AddChild(MonoInterface.Label, new MonoInterface.Label("\u041d\u0430\u0437\u0430\u0434", 20, Microsoft.Xna.Framework.Color.Black.$clone()));
                this.frmSettings.AddChild(MonoInterface.Button, new MonoInterface.Button.ctor(Bridge.fn.cacheBind(this, this.applyFrmSettings), Microsoft.Xna.Framework.Input.Keys.Enter, -10, -10, 150, 45, 1.0, 1.0, true)).AddChild(MonoInterface.Label, new MonoInterface.Label("\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c", 20, Microsoft.Xna.Framework.Color.Black.$clone()));

                // ' Ð¤ÑÐµÐ¹Ð¼ Ð¿Ð¾Ð³Ð¾ÑÐ¾Ð²ÐºÐ¸ Ðº Ð±Ð¾Ñ
                this.frmPreGame = this.MainContainer.AddChild(MonoInterface.Frame, ($t = new MonoInterface.Frame(0, 0, 500, 400, 0.5, 0.5, false), $t.ShowAnimation = new MonoInterface.NumberAnimation("Y", -300, 0, 50, Bridge.fn.bind(this, function () {
                    this.frmBack.Show(this.mainAnimator);
                })), $t.HideAnimation = new MonoInterface.NumberAnimation("Y", 0, 300, 50, Bridge.fn.bind(this, function () {
                    this.frmBack.Hide(this.mainAnimator);
                })), $t));

                this.lblVsPreGame = this.frmPreGame.AddChild(MonoInterface.Label, new MonoInterface.Label("", 20, Microsoft.Xna.Framework.Color.Black.$clone(), 0, 7, 0.5, 0.0, true));

                this.btnUnitsPreGame = this.frmPreGame.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor3(Bridge.fn.bind(this, function (btn, isTouch) {
                    this.cUnitsPreGame.Visible = true;
                    this.cSpellsPreGame.Visible = false;
                    this.cBuildingsPreGame.Visible = false;
                    this.btnUnitsPreGame.IsSelected = true;
                    this.btnSpellsPreGame.IsSelected = false;
                    this.btnBuildingsPreGame.IsSelected = false;
                }), -160, 60, 150, 45, 0.5, 0.0, true));
                this.btnUnitsPreGame.AddChild(MonoInterface.Label, new MonoInterface.Label("\u0421\u0443\u0449\u0435\u0441\u0442\u0432\u0430", 20, Microsoft.Xna.Framework.Color.Black.$clone()));

                this.btnSpellsPreGame = this.frmPreGame.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor3(Bridge.fn.bind(this, function (btn, isTouch) {
                    this.cUnitsPreGame.Visible = false;


                    this.cSpellsPreGame.Visible = true;

                    this.cBuildingsPreGame.Visible = false;
                    this.btnUnitsPreGame.IsSelected = false;
                    this.btnSpellsPreGame.IsSelected = true;
                    this.btnBuildingsPreGame.IsSelected = false;
                }), 0, 60, 150, 45, 0.5, 0.0, true));
                this.btnSpellsPreGame.AddChild(MonoInterface.Label, new MonoInterface.Label("\u0417\u0430\u043a\u043b\u0438\u043d\u0430\u043d\u0438\u044f", 20, Microsoft.Xna.Framework.Color.Black.$clone()));

                this.btnBuildingsPreGame = this.frmPreGame.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor3(Bridge.fn.bind(this, function (btn, isTouch) {
                    this.cUnitsPreGame.Visible = false;
                    this.cSpellsPreGame.Visible = false;
                    this.cBuildingsPreGame.Visible = true;
                    this.btnUnitsPreGame.IsSelected = false;
                    this.btnSpellsPreGame.IsSelected = false;
                    this.btnBuildingsPreGame.IsSelected = true;
                }), 160, 60, 150, 45, 0.5, 0.0, true));
                this.btnBuildingsPreGame.AddChild(MonoInterface.Label, new MonoInterface.Label("\u041f\u043e\u0441\u0442\u0440\u043e\u0439\u043a\u0438", 20, Microsoft.Xna.Framework.Color.Black.$clone()));


                this.cUnitsPreGame = this.frmPreGame.AddChild(MonoInterface.Grid, new MonoInterface.Grid(MonoInterface.Grid.Orientations.LeftToRight, -2, 120, 500, 100, 0.5, 0.0, false));
                this.cSpellsPreGame = this.frmPreGame.AddChild(MonoInterface.Grid, new MonoInterface.Grid(MonoInterface.Grid.Orientations.LeftToRight, -2, 120, 500, 100, 0.5, 0.0, false));
                this.cBuildingsPreGame = this.frmPreGame.AddChild(MonoInterface.Grid, new MonoInterface.Grid(MonoInterface.Grid.Orientations.LeftToRight, -2, 120, 500, 100, 0.5, 0.0, false));

                this.cSelectedPreGame = this.frmPreGame.AddChild(MonoInterface.Grid, new MonoInterface.Grid(MonoInterface.Grid.Orientations.LeftToRight, -2, -50, 500, 100, 0.5, 1.0, true));

                this.frmPreGame.AddChild(MonoInterface.Button, new MonoInterface.Button.ctor(Bridge.fn.cacheBind(this, this.backPreGame_Clicked), Microsoft.Xna.Framework.Input.Keys.Escape, 15, -10, 150, 45, 0.0, 1.0)).AddChild(MonoInterface.Label, new MonoInterface.Label("\u041d\u0430\u0437\u0430\u0434", 20, Microsoft.Xna.Framework.Color.Black.$clone()));
                this.frmPreGame.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor3(Bridge.fn.cacheBind(this, this.clearPreGame_Clicked), 0, -10, 150, 45, 0.5, 1.0, true)).AddChild(MonoInterface.Label, new MonoInterface.Label("\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c", 20, Microsoft.Xna.Framework.Color.Black.$clone()));
                this.btnFightPreGame = this.frmPreGame.AddChild(MonoInterface.Button, new MonoInterface.Button.ctor(Bridge.fn.cacheBind(this, this.fightPreGame_Clicked), Microsoft.Xna.Framework.Input.Keys.Enter, -15, -10, 150, 45, 1.0, 1.0));
                this.btnFightPreGame.AddChild(MonoInterface.Label, new MonoInterface.Label("\u0412 \u0431\u043e\u0439!", 20, Microsoft.Xna.Framework.Color.Black.$clone()));


                // Ð¤ÑÐµÐ¹Ð¼ Ð¿Ð¾Ð´ÑÐºÐ°Ð·ÐºÐ¸
                this.frmHelp = this.MainContainer.AddChild(MonoInterface.Frame, new MonoInterface.Frame(0, 0, 250, 0, 0.0, 0.0));

                // ÐÐ°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº, Ð·Ð½Ð°ÑÐ¾Ðº Ð¸ Ð¿Ð¾Ð´Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº
                this.lblUnitNameHelpUnit = this.frmHelp.AddChild(MonoInterface.Label, new MonoInterface.Label("\u0422\u0438\u0433\u0440", 14, Microsoft.Xna.Framework.Color.Black.$clone(), 0, 0, 0.0, 0.0, true));
                this.lblRaceHelpUnit = this.frmHelp.AddChild(MonoInterface.Label, new MonoInterface.Label("\u0422\u0438\u0433\u0440", 12, Microsoft.Xna.Framework.Color.Black.$clone(), 0, 23, 0.0, 0.0, true));

                // Ð¡ÑÐ¾Ð¸Ð¼Ð¾ÑÑÑ
                this.lblCostMoneyHelpUnit = this.frmHelp.AddChild(MonoInterface.Label, new MonoInterface.Label("\u0422\u0438\u0433\u0440", 12, Microsoft.Xna.Framework.Color.Black.$clone(), 20, 43, 0.0, 0.0, true));
                this.lblCostDeathHelpUnit = this.frmHelp.AddChild(MonoInterface.Label, new MonoInterface.Label("\u0422\u0438\u0433\u0440", 12, Microsoft.Xna.Framework.Color.Black.$clone(), 70, 43, 0.0, 0.0, true));
                this.frmHelp.AddChild(MonoInterface.Picture, new MonoInterface.Picture(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("small_icons"), 12), 0, 42, 0, 0, 0.0, 0.0, true));
                this.frmHelp.AddChild(MonoInterface.Picture, new MonoInterface.Picture(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("small_icons"), 13), 50, 42, 0, 0, 0.0, 0.0, true));

                this.cBattleParameters = this.frmHelp.AddChild(MonoInterface.Container, new MonoInterface.Container(0, 65, 250, 60, 0.0, 0.0, true));
                this.lblAttackBasicParams = this.cBattleParameters.AddChild(MonoInterface.Label, new MonoInterface.Label("\u0422\u0438\u0433\u0440", 12, Microsoft.Xna.Framework.Color.Black.$clone(), 20, 0, 0.0, 0.0, true));
                this.pctAttackBasicParams = this.cBattleParameters.AddChild(MonoInterface.Picture, new MonoInterface.Picture(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("small_icons"), 1), 0, 0, 0, 0, 0.0, 0.0, true));
                for (var i5 = 0; i5 <= 2; i5 = (i5 + 1) | 0) {
                    this.lblsBasicParams[i5] = this.cBattleParameters.AddChild(MonoInterface.Label, new MonoInterface.Label("\u0422\u0438\u0433\u0440", 12, Microsoft.Xna.Framework.Color.Black.$clone(), ((20 + Bridge.Int.mul(100, (i5 % 2))) | 0), ((22 + Bridge.Int.mul((((Bridge.Int.div(i5, 2)) | 0)), 22)) | 0), 0.0, 0.0, true));
                    this.cBattleParameters.AddChild(MonoInterface.Picture, new MonoInterface.Picture(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("small_icons"), ((i5 + 3) | 0)), Bridge.Int.mul(100, (i5 % 2)), ((22 + Bridge.Int.mul((((Bridge.Int.div(i5, 2)) | 0)), 22)) | 0), 0, 0, 0.0, 0.0, true));
                }

                for (var i6 = 0; i6 <= 5; i6 = (i6 + 1) | 0) {
                    this.lblsAbils[i6] = this.frmHelp.AddChild(MonoInterface.LongLabel, new MonoInterface.LongLabel("\u0422\u0438\u0433\u0440", 10, Microsoft.Xna.Framework.Color.Black.$clone(), 0, 140, 250, 0.0, 0.0, true));
                }


                // ' Ð¤ÑÐµÐ¹Ð¼ Ð±Ð¾ÐµÐ²Ð¾Ð³Ð¾ Ð¼ÐµÐ½Ñ
                this.frmBattleMenu = this.MainContainer.AddChild(MonoInterface.Frame, ($t = new MonoInterface.Frame(0, 0, 270, 310, 0.5, 0.5, false), $t.ShowAnimation = new MonoInterface.NumberAnimation("Y", -300, 0, 50, Bridge.fn.bind(this, function () {
                    if (this.frmBack.Visible) {
                        this.mainAnimator.Animations.remove(this.frmBack.HideAnimation);
                    } else {
                        this.frmBack.Show(this.mainAnimator);
                    }
                })), $t.HideAnimation = new MonoInterface.NumberAnimation("Y", 0, 300, 50, Bridge.fn.bind(this, function () {
                    this.frmBack.Hide(this.mainAnimator);
                })), $t));
                this.frmBattleMenu.AddChild(MonoInterface.Label, new MonoInterface.Label("\u041f\u0430\u0443\u0437\u0430", 30, Microsoft.Xna.Framework.Color.Black.$clone(), 0, 7, 0.5, 0.0, true));

                this.frmBattleMenu.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor3(Bridge.fn.cacheBind(this, this.surrenderFrmBattleMenu_Clicked), 0, 60, 250, 45, 0.5, 0.0, true)).AddChild(MonoInterface.Label, new MonoInterface.Label("\u0421\u0434\u0430\u0442\u044c\u0441\u044f", 20, Microsoft.Xna.Framework.Color.Black.$clone()));
                this.frmBattleMenu.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor3(Bridge.fn.cacheBind(this, this.restartFrmBattleMenu_Clicked), 0, 120, 250, 45, 0.5, 0.0, true)).AddChild(MonoInterface.Label, new MonoInterface.Label("\u041f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c", 20, Microsoft.Xna.Framework.Color.Black.$clone()));
                this.lblAIFrmBattleMenu = this.frmBattleMenu.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor3(Bridge.fn.cacheBind(this, this.AIFrmBattleMenu_Clicked), 0, 180, 250, 45, 0.5, 0.0, true)).AddChild(MonoInterface.Label, new MonoInterface.Label("\u041f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043d\u0430 \u0418\u0418", 20, Microsoft.Xna.Framework.Color.Black.$clone()));
                this.frmBattleMenu.AddChild(MonoInterface.Button, new MonoInterface.Button.ctor(Bridge.fn.cacheBind(this, this.backFrmBattleMenu_Clicked), Microsoft.Xna.Framework.Input.Keys.Escape, 0, 250, 225, 45, 0.5, 0.0, true)).AddChild(MonoInterface.Label, new MonoInterface.Label("\u041d\u0430\u0437\u0430\u0434 \u0432 \u0438\u0433\u0440\u0443", 20, Microsoft.Xna.Framework.Color.Black.$clone()));

                // ' Ð¤ÑÐµÐ¹Ð¼ Ð´Ð¸Ð°Ð»Ð¾Ð³Ð° Ð·Ð°Ð²ÐµÑÑÐµÐ½Ð¸Ñ Ð±Ð¾Ñ
                this.frmDialog = this.MainContainer.AddChild(MonoInterface.Frame, ($t = new MonoInterface.Frame(0, 0, 375, 180, 0.5, 0.5, false), $t.ShowAnimation = new MonoInterface.NumberAnimation("Y", -300, 0, 50, Bridge.fn.bind(this, function () {
                    if (this.frmBack.Visible) {
                        this.mainAnimator.Animations.remove(this.frmBack.HideAnimation);
                    } else {
                        this.frmBack.Show(this.mainAnimator);
                    }
                })), $t.HideAnimation = new MonoInterface.NumberAnimation("Y", 0, 300, 50, Bridge.fn.bind(this, function () {
                    this.frmBack.Hide(this.mainAnimator);
                })), $t));
                this.lblTitlefrmDialog = this.frmDialog.AddChild(MonoInterface.Label, new MonoInterface.Label("", 30, Microsoft.Xna.Framework.Color.Black.$clone(), 0, 7, 0.5, 0.0, true));

                this.lblLine1FrmDialog = this.frmDialog.AddChild(MonoInterface.Label, new MonoInterface.Label("", 20, Microsoft.Xna.Framework.Color.Black.$clone(), 0, 50, 0.5, 0.0, true));
                this.lblLine2FrmDialog = this.frmDialog.AddChild(MonoInterface.Label, new MonoInterface.Label("", 20, Microsoft.Xna.Framework.Color.Black.$clone(), 0, 70, 0.5, 0.0, true));

                this.frmDialog.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor3(Bridge.fn.cacheBind(this, this.okayFrmDialog_Clicked), 0, -15, 150, 45, 0.5, 1.0, true)).AddChild(MonoInterface.Label, new MonoInterface.Label("\u0412 \u043c\u0435\u043d\u044e", 20, Microsoft.Xna.Framework.Color.Black.$clone()));

                // ' Ð¤ÑÐµÐ¹Ð¼ Ð¿Ð¾Ð´ÑÐ²ÐµÑÐ¶Ð´ÐµÐ½Ð¸Ñ
                this.frmConfirm = this.MainContainer.AddChild(MonoInterface.Frame, ($t = new MonoInterface.Frame(0, 0, 375, 150, 0.5, 0.5, false), $t.ShowAnimation = new MonoInterface.NumberAnimation("Y", -300, 0, 50, Bridge.fn.bind(this, function () {
                    if (this.frmBack.Visible) {
                        this.mainAnimator.Animations.remove(this.frmBack.HideAnimation);
                    } else {
                        this.frmBack.Show(this.mainAnimator);
                    }
                })), $t.HideAnimation = new MonoInterface.NumberAnimation("Y", 0, 300, 50, Bridge.fn.bind(this, function () {
                    this.frmBack.Hide(this.mainAnimator);
                })), $t));
                this.frmConfirm.AddChild(MonoInterface.Label, new MonoInterface.Label("\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b", 30, Microsoft.Xna.Framework.Color.Black.$clone(), 0, 7, 0.5, 0.0, true));


                this.lblTextFrmConfirm = this.frmConfirm.AddChild(MonoInterface.Label, new MonoInterface.Label("", 20, Microsoft.Xna.Framework.Color.Black.$clone(), 0, 50, 0.5, 0.0, true));

                this.frmConfirm.AddChild(MonoInterface.Button, new MonoInterface.Button.ctor(Bridge.fn.bind(this, function (btn, isTouch) {
                    this.frmConfirm.Hide(this.mainAnimator);
                    this.taskConfirm != null ? this.taskConfirm.setResult(true) : null;
                }), Microsoft.Xna.Framework.Input.Keys.Enter, 15, -10, 150, 45, 0.0, 1.0)).AddChild(MonoInterface.Label, new MonoInterface.Label("\u0414\u0430", 20, Microsoft.Xna.Framework.Color.Black.$clone()));

                this.frmConfirm.AddChild(MonoInterface.Button, new MonoInterface.Button.ctor(Bridge.fn.bind(this, function (btn, isTouch) {
                    this.frmConfirm.Hide(this.mainAnimator);
                    this.taskConfirm != null ? this.taskConfirm.setResult(false) : null;
                }), Microsoft.Xna.Framework.Input.Keys.Escape, -15, -10, 150, 45, 1.0, 1.0)).AddChild(MonoInterface.Label, new MonoInterface.Label("\u041d\u0435\u0442", 20, Microsoft.Xna.Framework.Color.Black.$clone()));

                this.MainContainer.ApplyTheme(this.defaultTheme);
                this.MainContainer.ApplyLocalization(this.localize);
                this.frmBack.ApplyTheme(this.backTheme);
            },
            backPreGame_Clicked: function (btn, isTouch) {
                DarkKingdomCore.MyGame.gState = DarkKingdomCore.GameState.MainMenu;
                this.StartBattle();
            },
            clearPreGame_Clicked: function (btn, isTouch) {
                this.preGameUnits.clear();
                this.preGameSpells.clear();
                this.preGameBonus.clear();
                this.SetPreGameLists();
            },
            fightPreGame_Clicked: function (btn, isTouch) {
                this.frmPreGame.Hide(this.mainAnimator);
                this.StartPlaying();
            },
            backFrmSettings: function (btn, isTouch) {
                this.frmSettings.Hide(this.mainAnimator);
            },
            applyFrmSettings: function (btn, isTouch) {
                this.frmSettings.Hide(this.mainAnimator);
                var uiScale = this.screenFormats.getItem(this.resSwitcherFrmSettings.Current).$clone().X / 800.0;
                if (uiScale <= 1.25) {
                    uiScale = 1.0;
                } else {
                    if (uiScale > 1.25 && uiScale <= 1.75) {
                        uiScale = 1.5;
                    } else {
                        uiScale = 2.0;
                    }
                }
                this.Resize(Bridge.Int.clip32(this.screenFormats.getItem(this.resSwitcherFrmSettings.Current).$clone().X), Bridge.Int.clip32(this.screenFormats.getItem(this.resSwitcherFrmSettings.Current).$clone().Y), this.resSwitcherFrmSettings.Current === 2, uiScale);
            },
            CreateScreenFormats: function () {
                // = {New Vector2(800, 480), New Vector2(1366, 768), New Vector2(1920, 1080)}
                this.screenFormats = new (System.Collections.Generic.List$1(Microsoft.Xna.Framework.Vector3)).ctor();
                // For Each format In GraphicsAdapter.DefaultAdapter.SupportedDisplayModes
                // screenFormats.Add(New Vector3(format.Width, format.Height, format.RefreshRate))
                // Next
                this.screenFormats.AddRange(System.Array.init([new Microsoft.Xna.Framework.Vector3.$ctor3(800, 480, 60), new Microsoft.Xna.Framework.Vector3.$ctor3(1366, 768, 60), new Microsoft.Xna.Framework.Vector3.$ctor3(1920, 1080, 60)], Microsoft.Xna.Framework.Vector3));
            },
            GetUnitParametersFromID: function (id) {
                var $t;
                $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.unitPrms.Values);
                try {
                    while ($t.moveNext()) {
                        var up = $t.Current.$clone();
                        if (up.id === id) {
                            return up.$clone();
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                return null;
            },
            OnUnitsAbils: function (u) {
                var $t, $t1, $t2, $t3, $t4, $t5, $t6, $t7, $t8, $t9, $t10, $t11, $t12, $t13, $t14, $t15, $t16, $t17, $t18, $t19, $t20, $t21;
                $t = Bridge.getEnumerator(u.abils.Values);
                try {
                    while ($t.moveNext()) {
                        var abil = $t.Current;
                        if (abil.condCompleted && !abil.used) {
                            if (Bridge.referenceEquals(abil.name, "Rush")) {
                                ($t1 = DarkKingdomCore.MyGame.plrs[u.owner]).rushBonus = ($t1.rushBonus + abil.value) | 0;
                                abil.used = true;
                            } else if (Bridge.referenceEquals(abil.name, "Kill_flyer")) {
                                var uu = this.FindRandomFlyUnit(((1 - u.owner) | 0), 500);
                                if (uu != null) {
                                    this.Kill(uu);
                                    this.ShowInfoPar("\u0423\u043d\u0438\u0447\u0442\u043e\u0436\u0435\u043d", DarkKingdomCore.MyGame.badAbilClr.$clone(), uu.x, ((DarkKingdomCore.MyGame.hor + uu.parameters.rect.Top) | 0), true);
                                }
                                abil.used = true;
                            } else if (Bridge.referenceEquals(abil.name, "Magic_bonus")) {
                                ($t2 = DarkKingdomCore.MyGame.plrs[u.owner]).magicIncBonus = ($t2.magicIncBonus + abil.value) | 0;
                            } else if (Bridge.referenceEquals(abil.name, "Poison_bonus")) {
                                ($t3 = DarkKingdomCore.MyGame.plrs[u.owner]).poisonBonus = ($t3.poisonBonus + abil.value) | 0;
                            } else if (Bridge.referenceEquals(abil.name, "Stealing")) {
                                ($t4 = DarkKingdomCore.MyGame.plrs[((1 - u.owner) | 0)]).moneyIncBonus = ($t4.moneyIncBonus - 10) | 0;
                                ($t5 = DarkKingdomCore.MyGame.plrs[u.owner]).moneyIncBonus = ($t5.moneyIncBonus + 10) | 0;
                            } else if (Bridge.referenceEquals(abil.name, "Chaos")) {
                                if (!u.AbsContains("Chaos helper")) {
                                    var avunits = new (System.Collections.Generic.List$1(System.String)).ctor();
                                    $t6 = Bridge.getEnumerator(DarkKingdomCore.MyGame.plrs[((1 - u.owner) | 0)].unitsList);
                                    try {
                                        while ($t6.moveNext()) {
                                            var uu1 = $t6.Current;
                                            if (!DarkKingdomCore.MyGame.plrs[((1 - u.owner) | 0)].banned.contains(uu1)) {
                                                avunits.add(uu1);
                                            }
                                        }
                                    } finally {
                                        if (Bridge.is($t6, System.IDisposable)) {
                                            $t6.System$IDisposable$Dispose();
                                        }
                                    }
                                    if (avunits.Count > 0) {
                                        u.AddAbility(new DarkKingdomCore.Ability("Chaos helper", DarkKingdomCore.MyGame.unitPrms.getItem(avunits.getItem(DarkKingdomCore.MyGame.rnd.Next$1(avunits.Count))).$clone().id, "", 0, DarkKingdomCore.EffectType.Normal, false));
                                    }
                                }
                            } else if (Bridge.referenceEquals(abil.name, "Chaos helper")) {
                                var unit_parameters = this.GetUnitParametersFromID(abil.value);
                                if (System.Nullable.hasValue(unit_parameters)) {
                                    DarkKingdomCore.MyGame.plrs[((1 - u.owner) | 0)].banned.add(System.Nullable.getValue(unit_parameters).Name);
                                }
                            } else if (Bridge.referenceEquals(abil.name, "Publican")) {
                                ($t7 = DarkKingdomCore.MyGame.plrs[u.owner]).moneyIncBonus = ($t7.moneyIncBonus + Bridge.Int.mul(5, DarkKingdomCore.MyGame.plrs[u.owner].unitCount)) | 0;
                            } else if (Bridge.referenceEquals(abil.name, "Block prod")) {
                                DarkKingdomCore.MyGame.plrs[0].prdSpd = 0;
                                DarkKingdomCore.MyGame.plrs[1].prdSpd = 0;
                            } else if (Bridge.referenceEquals(abil.name, "Ignore_units")) {
                                u.parameters.isIgnoreUnits = true;
                            } else if (Bridge.referenceEquals(abil.name, "Takeoff")) {
                                if (u.parameters.moveType === DarkKingdomCore.UnitMoveType.GroundMT) {
                                    u.takedOff = true;
                                }
                                u.abils.getItem("Takeoff").used = true;
                            } else if (Bridge.referenceEquals(abil.name, "Landing")) {
                                if (u.parameters.moveType === DarkKingdomCore.UnitMoveType.FlyingMT) {
                                    u.landing = true;
                                }
                                u.abils.getItem("Landing").used = true;
                            } else if (Bridge.referenceEquals(abil.name, "Elite_archer")) {
                                $t8 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                                try {
                                    while ($t8.moveNext()) {
                                        var uu2 = $t8.Current;
                                        if (!Bridge.referenceEquals(u, uu2)) {
                                            if (uu2.owner === u.owner) {
                                                if (uu2.parameters.Attack.Range > 1) {
                                                    ($t9 = uu2.atkMod.$clone()).Range = ($t9.Range + 1) | 0;
                                                }
                                            }
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t8, System.IDisposable)) {
                                        $t8.System$IDisposable$Dispose();
                                    }
                                }
                            } else if (Bridge.referenceEquals(abil.name, "Kill all")) {
                                $t10 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                                try {
                                    while ($t10.moveNext()) {
                                        var uu3 = $t10.Current;
                                        if (!uu3.parameters.isBuilding) {
                                            this.Kill(uu3);
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t10, System.IDisposable)) {
                                        $t10.System$IDisposable$Dispose();
                                    }
                                }
                                this.globalExplode = 255;
                            } else if (Bridge.referenceEquals(abil.name, "Big_boom")) {
                                $t11 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                                try {
                                    while ($t11.moveNext()) {
                                        var uu4 = $t11.Current;
                                        this.Harm(uu4, DarkKingdomCore.MyGame.rnd.Next$2(1000, 2000), false, DarkKingdomCore.EffectType.Normal);
                                        this.Poison(uu4);
                                    }
                                } finally {
                                    if (Bridge.is($t11, System.IDisposable)) {
                                        $t11.System$IDisposable$Dispose();
                                    }
                                }
                                this.globalExplode = 255;
                            } else if (Bridge.referenceEquals(abil.name, "Range_bonus")) {
                                ($t12 = u.atkMod.$clone()).Range = ($t12.Range + abil.value) | 0;
                            } else if (Bridge.referenceEquals(abil.name, "Prod_boost")) {
                                DarkKingdomCore.MyGame.plrs[u.owner].prdSpd *= (1 + abil.value / 100);
                            } else if (Bridge.referenceEquals(abil.name, "Time_control")) {
                                $t13 = Bridge.getEnumerator(DarkKingdomCore.MyGame.plrs);
                                try {
                                    while ($t13.moveNext()) {
                                        var p = $t13.Current;
                                        p.prdSpd /= 2;
                                    }
                                } finally {
                                    if (Bridge.is($t13, System.IDisposable)) {
                                        $t13.System$IDisposable$Dispose();
                                    }
                                }
                            } else if (Bridge.referenceEquals(abil.name, "Centaur_prod_boost")) {
                                $t14 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                                try {
                                    while ($t14.moveNext()) {
                                        var uu5 = $t14.Current;
                                        if (uu5.owner === u.owner && ((uu5.owner === 0 && uu5.x >= ((Bridge.Int.div(DarkKingdomCore.MyGame.gameWidth, 2)) | 0)) || (uu5.owner === 1 && uu5.x <= ((Bridge.Int.div(DarkKingdomCore.MyGame.gameWidth, 2)) | 0)))) {
                                            DarkKingdomCore.MyGame.plrs[u.owner].prdSpd *= (1 + abil.value / 100);
                                            break;
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t14, System.IDisposable)) {
                                        $t14.System$IDisposable$Dispose();
                                    }
                                }
                            } else if (Bridge.referenceEquals(abil.name, "Slow_production")) {
                                DarkKingdomCore.MyGame.plrs[((1 - u.owner) | 0)].prdSpd /= 1.5;
                            } else if (Bridge.referenceEquals(abil.name, "Recharge")) {
                                $t15 = Bridge.getEnumerator(u.abils.Values);
                                try {
                                    while ($t15.moveNext()) {
                                        var aa = $t15.Current;
                                        if (aa.used === true) {
                                            aa.used = false;
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t15, System.IDisposable)) {
                                        $t15.System$IDisposable$Dispose();
                                    }
                                }
                                this.ShowInfoPar("\u041f\u0435\u0440\u0435\u0437\u0430\u0440\u044f\u0434\u043a\u0430!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                                u.abils.getItem("Recharge").used = true;
                            } else if (Bridge.referenceEquals(abil.name, "Lycanthropy")) {
                                var new_unit_parameters = this.GetUnitParametersFromID(abil.value);
                                if (System.Nullable.hasValue(new_unit_parameters)) {
                                    var oldmaxhp = u.parameters.maxhp;
                                    var oldname = u.parameters.Name;
                                    u.SetParams(System.Nullable.getValue(new_unit_parameters).$clone(), false);
                                    u.hp *= (Bridge.Int.div(u.parameters.maxhp, oldmaxhp)) | 0;
                                    this.ShowInfoPar("\u041b\u0438\u043a\u0430\u043d\u0442\u0440\u043e\u043f\u0438\u044f", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                                } else {
                                    this.ShowInfoPar(System.String.format("Wrong unit id - {0}", [abil.value]), DarkKingdomCore.MyGame.badAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                                }
                            } else if (Bridge.referenceEquals(abil.name, "Invulnerable")) {
                                if (Bridge.referenceEquals(u.shownAbil, "")) {
                                    u.shownAbil = "Invulnerable";
                                    u.shownAbilMaxVal = abil.value;
                                }
                                abil.value = (abil.value - 1) | 0;
                                if (abil.value === 0) {
                                    u.abils.getItem("Invulnerable").used = true;
                                    u.shownAbil = "";
                                }
                            } else if (Bridge.referenceEquals(abil.name, "Poison_around")) {
                                $t16 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                                try {
                                    while ($t16.moveNext()) {
                                        var uu6 = $t16.Current;
                                        if (!Bridge.referenceEquals(uu6, u) && u.Near(uu6)) {
                                            this.Poison(uu6);
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t16, System.IDisposable)) {
                                        $t16.System$IDisposable$Dispose();
                                    }
                                }
                            } else if (Bridge.referenceEquals(abil.name, "Generate")) {
                                var new_unit_parameters1 = this.GetUnitParametersFromID(abil.value);
                                if (System.Nullable.hasValue(new_unit_parameters1)) {
                                    this.bornList.add(new DarkKingdomCore.Unit(this, u.x, u.moveside, u.owner, System.Nullable.getValue(new_unit_parameters1).$clone()));
                                }
                            } else if (Bridge.referenceEquals(abil.name, "Generate enemy")) {
                                var unit_parameters1 = this.GetUnitParametersFromID(abil.value);
                                if (System.Nullable.hasValue(unit_parameters1)) {
                                    this.bornList.add(new DarkKingdomCore.Unit(this, u.x, DarkKingdomCore.MyGame.plrs[((1 - u.owner) | 0)].moveside, ((1 - u.owner) | 0), System.Nullable.getValue(unit_parameters1).$clone()));
                                }
                            } else if (Bridge.referenceEquals(abil.name, "Summon_ihor")) {
                                this.bornList.add(new DarkKingdomCore.Unit(this, u.x, u.moveside, u.owner, DarkKingdomCore.MyGame.unitPrms.getItem("Ihor").$clone()));
                                this.bornList.add(new DarkKingdomCore.Unit(this, u.x - Bridge.Int.mul(u.moveside, this.us2), u.moveside, u.owner, DarkKingdomCore.MyGame.unitPrms.getItem("Ihor").$clone()));
                                this.ShowInfoPar("\u0420\u0430\u0441\u043f\u0430\u0434", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                            } else if (Bridge.referenceEquals(abil.name, "Summon_centaur")) {
                                var avunits1 = new (System.Collections.Generic.List$1(System.String)).ctor();
                                $t17 = Bridge.getEnumerator(DarkKingdomCore.MyGame.unitPrms.Values);
                                try {
                                    while ($t17.moveNext()) {
                                        var uu7 = $t17.Current.$clone();
                                        if (Bridge.referenceEquals(uu7.Subrace, "Centaur") && !(Bridge.referenceEquals(uu7.Name, u.parameters.Name))) {
                                            avunits1.add(uu7.Name);
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t17, System.IDisposable)) {
                                        $t17.System$IDisposable$Dispose();
                                    }
                                }
                                this.bornList.add(new DarkKingdomCore.Unit(this, u.x + Bridge.Int.mul(2, u.moveside), u.moveside, u.owner, DarkKingdomCore.MyGame.unitPrms.getItem(avunits1.getItem(DarkKingdomCore.MyGame.rnd.Next$1(avunits1.Count))).$clone()));
                                abil.used = true;
                            } else if (Bridge.referenceEquals(abil.name, "Economy")) {
                                ($t18 = DarkKingdomCore.MyGame.plrs[u.owner].res.$clone()).Money = ($t18.Money + ((Bridge.Int.div(u.parameters.Cost.Money, 2)) | 0)) | 0;
                                this.ShowInfoPar(System.String.format("+{0}", [((Bridge.Int.div(u.parameters.Cost.Money, 2)) | 0)]), this.moneyClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                            } else if (Bridge.referenceEquals(abil.name, "Levitation_around")) {
                                $t19 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                                try {
                                    while ($t19.moveNext()) {
                                        var uu8 = $t19.Current;
                                        if (uu8.owner !== u.owner && u.Near(uu8) && uu8.parameters.moveType === DarkKingdomCore.UnitMoveType.GroundMT && !uu8.parameters.isBuilding) {
                                            uu8.takedOff = true;
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t19, System.IDisposable)) {
                                        $t19.System$IDisposable$Dispose();
                                    }
                                }
                            } else if (Bridge.referenceEquals(abil.name, "Heal_demons")) {
                                $t20 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                                try {
                                    while ($t20.moveNext()) {
                                        var uu9 = $t20.Current;
                                        if (!Bridge.referenceEquals(u, uu9) && u.owner === uu9.owner && Bridge.referenceEquals(uu9.parameters.Race, "Demons") && !uu9.parameters.isBuilding) {
                                            this.Heal(uu9, DarkKingdomCore.MyGame.rnd.Next$2(40, 51));
                                            uu9.Attack = DarkKingdomCore.Attack.op_Addition$1(uu9.Attack.$clone(), 3);
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t20, System.IDisposable)) {
                                        $t20.System$IDisposable$Dispose();
                                    }
                                }
                            } else if (Bridge.referenceEquals(abil.name, "Explosive")) {
                                this.Explode(u, u.AbsContains("Mage"));
                            } else if (Bridge.referenceEquals(abil.name, "Invisible")) {
                                $t21 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                                try {
                                    while ($t21.moveNext()) {
                                        var uu10 = $t21.Current;
                                        if (uu10.owner !== u.owner && u.Near(uu10)) {
                                            this.Deinvisible(u);
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t21, System.IDisposable)) {
                                        $t21.System$IDisposable$Dispose();
                                    }
                                }
                            } else if (Bridge.referenceEquals(abil.name, "Clear_mind")) {
                                var uu11 = this.FindRandomUnflyUnit(((1 - u.owner) | 0));
                                if (uu11 != null) {
                                    uu11.purified = true;
                                    u.abils.getItem("Clear_mind").used = true;
                                }
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            }
        }
    });

    Bridge.define("DarkKingdomCore.ParType", {
        $kind: "enum",
        statics: {
            fields: {
                Point: 0,
                Text: 1,
                Image: 2
            }
        }
    });

    Bridge.define("DarkKingdomCore.Player", {
        fields: {
            id: 0,
            moveside: 0,
            baseX: 0,
            hero: null,
            heroUnit: null,
            res: null,
            race: null,
            AI: false,
            curAIVal: 0,
            maxAIVal: 0,
            uCount: 0,
            startInco: 0,
            magicIncBonus: 0,
            moneyIncBonus: 0,
            ipt: 0,
            resDelay: 0,
            symb: 0,
            unitsList: null,
            spllsList: null,
            bonusList: null,
            readyUnits: null,
            prdQ: null,
            prdPrg: 0,
            prdSpd: 0,
            statDeaths: 0,
            castleFileName: null,
            poisonBonus: 0,
            victimcount: 0,
            banned: null,
            spellsRchrg: null,
            rushBonus: 0,
            game: null,
            aidefencestreak: 0,
            aisupportstreak: 0,
            prodsupport: false
        },
        props: {
            unitCount: {
                get: function () {
                    return this.uCount;
                },
                set: function (value) {
                    this.uCount = value;
                }
            },
            Resources: {
                get: function () {
                    return this.res.$clone();
                },
                set: function (value) {
                    this.res = value.$clone();
                }
            }
        },
        ctors: {
            init: function () {
                this.res = new DarkKingdomCore.TimeCost();
                this.race = "";
                this.resDelay = 450;
                this.unitsList = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.spllsList = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.bonusList = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.readyUnits = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.prdQ = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.statDeaths = 0;
                this.castleFileName = "hqs";
                this.banned = new (System.Collections.Generic.List$1(System.String)).ctor();
            },
            ctor: function (game, i, a, aitick) {
                this.$initialize();
                this.game = game;
                this.id = i;
                this.AI = a;
                this.res.Tier = 1;
                this.curAIVal = aitick;
                this.maxAIVal = aitick;
            }
        },
        methods: {
            Reset: function (cond) {
                if (this.id === 0) {
                    this.Resources = cond.res1.$clone();
                } else {
                    this.Resources = cond.res2.$clone();
                }
                this.res.Tier = cond.res1.Tier;
                this.startInco = cond.income;
                this.ipt = cond.ipt;
                this.unitCount = 0;
                this.prdQ.clear();
                this.readyUnits.clear();
                this.prdPrg = 0;
                this.statDeaths = 0;
                this.resDelay = 450;
                this.victimcount = 0;
                this.banned.clear();
                this.spellsRchrg = new (System.Collections.Generic.List$1(System.Single)).ctor();
                this.rushBonus = 0;
            },
            hasUnit: function (name) {
                var $t;
                $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                try {
                    while ($t.moveNext()) {
                        var u = $t.Current;
                        if (u.owner === this.id && Bridge.referenceEquals(u.parameters.Name, name)) {
                            return true;
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                return false;
            },
            CheckForProduce: function (name) {
                return ((this.prdQ.Count + this.readyUnits.Count) | 0) < 7 && this.res.EnoughFor(DarkKingdomCore.MyGame.unitPrms.getItem(name).$clone().Cost.$clone()) && this.CheckForLimit(name) && !this.banned.contains(name);
            },
            CheckForLimit: function (name) {
                var $t, $t1, $t2, $t3, $t4, $t5;
                if (DarkKingdomCore.MyGame.unitPrms.getItem(name).$clone().isHeroic) {
                    var tmp = 0;
                    $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                    try {
                        while ($t.moveNext()) {
                            var u = $t.Current;
                            if (u.owner === this.id && u.parameters.isHeroic) {
                                tmp = (tmp + 1) | 0;
                            }
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                    $t1 = Bridge.getEnumerator(this.prdQ);
                    try {
                        while ($t1.moveNext()) {
                            var u1 = $t1.Current;
                            if (DarkKingdomCore.MyGame.unitPrms.getItem(u1).$clone().isHeroic) {
                                tmp = (tmp + 1) | 0;
                            }
                        }
                    } finally {
                        if (Bridge.is($t1, System.IDisposable)) {
                            $t1.System$IDisposable$Dispose();
                        }
                    }
                    $t2 = Bridge.getEnumerator(this.readyUnits);
                    try {
                        while ($t2.moveNext()) {
                            var u2 = $t2.Current;
                            if (Bridge.referenceEquals(u2, name)) {
                                tmp = (tmp + 1) | 0;
                            }
                        }
                    } finally {
                        if (Bridge.is($t2, System.IDisposable)) {
                            $t2.System$IDisposable$Dispose();
                        }
                    }
                    return tmp === 0;
                } else if (DarkKingdomCore.MyGame.unitPrms.getItem(name).$clone().maxLimit === 0) {
                    return true;
                } else {
                    var tmp1 = 0;
                    $t3 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                    try {
                        while ($t3.moveNext()) {
                            var u3 = $t3.Current;
                            if (u3.owner === this.id && Bridge.referenceEquals(u3.parameters.Name, name)) {
                                tmp1 = (tmp1 + 1) | 0;
                            }
                        }
                    } finally {
                        if (Bridge.is($t3, System.IDisposable)) {
                            $t3.System$IDisposable$Dispose();
                        }
                    }
                    $t4 = Bridge.getEnumerator(this.prdQ);
                    try {
                        while ($t4.moveNext()) {
                            var u4 = $t4.Current;
                            if (Bridge.referenceEquals(u4, name)) {
                                tmp1 = (tmp1 + 1) | 0;
                            }
                        }
                    } finally {
                        if (Bridge.is($t4, System.IDisposable)) {
                            $t4.System$IDisposable$Dispose();
                        }
                    }
                    $t5 = Bridge.getEnumerator(this.readyUnits);
                    try {
                        while ($t5.moveNext()) {
                            var u5 = $t5.Current;
                            if (Bridge.referenceEquals(u5, name)) {
                                tmp1 = (tmp1 + 1) | 0;
                            }
                        }
                    } finally {
                        if (Bridge.is($t5, System.IDisposable)) {
                            $t5.System$IDisposable$Dispose();
                        }
                    }
                    return tmp1 < DarkKingdomCore.MyGame.unitPrms.getItem(name).$clone().maxLimit;
                }
            },
            AITick: function (mc) {
                var $t;
                if (this.res.Death >= 15 && this.res.Tier === 1) {
                    if (this.res.Money >= 150) {
                        mc.TryAddToQueueUnit(this, "Tier_2");
                    } else {
                    }
                } else if (this.res.Death >= 15 && this.res.Tier === 2) {
                    if (this.res.Money >= 150) {
                        mc.TryAddToQueueUnit(this, "Tier_3");
                    } else {
                    }
                } else if (this.unitCount < 13) {
                    if (this.prdQ.Count < 2) {
                        var avunits = new (System.Collections.Generic.List$1(System.String)).ctor();
                        this.prodsupport = false;
                        if (this.unitCount > 0 || this.aidefencestreak > 0) {
                            if (this.aisupportstreak > 0 && this.aisupportstreak < 2 || this.aidefencestreak >= 1) {
                                this.prodsupport = true;
                            }
                        }
                        $t = Bridge.getEnumerator(this.unitsList);
                        try {
                            while ($t.moveNext()) {
                                var u = $t.Current;
                                if (DarkKingdomCore.MyGame.unitPrms.getItem(u).$clone().support === this.prodsupport && this.CheckForProduce(u)) {
                                    avunits.add(u);
                                }
                            }
                        } finally {
                            if (Bridge.is($t, System.IDisposable)) {
                                $t.System$IDisposable$Dispose();
                            }
                        }
                        if (avunits.Count > 0) {
                            mc.TryAddToQueueUnit(this, avunits.getItem(DarkKingdomCore.MyGame.rnd.Next$2(0, avunits.Count)));
                        } else {
                            if (this.unitsList.Count > 0) {
                                mc.TryAddToQueueUnit(this, this.unitsList.getItem(DarkKingdomCore.MyGame.rnd.Next$2(0, this.unitsList.Count)));
                            }
                        }
                    }
                }
            }
        }
    });

    Bridge.define("DarkKingdomCore.Profile", {
        fields: {
            name: null,
            avId: 0,
            units: null,
            difficult: 0,
            racesPlays: null,
            racesWins: null,
            minvictims: 0,
            maxkills: 0,
            achivs: null,
            crystals: 0,
            maxCustomRaces: 0
        },
        ctors: {
            init: function () {
                this.units = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.difficult = 1;
                this.racesPlays = new (System.Collections.Generic.Dictionary$2(System.String,System.Int32)).ctor();
                this.racesWins = new (System.Collections.Generic.Dictionary$2(System.String,System.Int32)).ctor();
                this.achivs = new (System.Collections.Generic.Dictionary$2(System.String,System.String)).ctor();
            },
            ctor: function (nam, av, d, unts, rPls, rWns, mv, mk, achvs, crst, maxCustomRacs) {
                this.$initialize();
                this.name = nam;
                this.avId = av;
                this.units = unts;
                this.difficult = d;
                this.racesPlays = rPls;
                this.racesWins = rWns;
                this.minvictims = mv;
                this.maxkills = mk;
                this.achivs = achvs;
                this.crystals = crst;
                this.maxCustomRaces = maxCustomRacs;
            }
        }
    });

    Bridge.define("DarkKingdomCore.ProfileManager", {
        statics: {
            fields: {
                _instance: null
            },
            props: {
                Instance: {
                    get: function () {
                        if (DarkKingdomCore.ProfileManager._instance == null) {
                            DarkKingdomCore.ProfileManager._instance = new DarkKingdomCore.ProfileManager();
                        }
                        return DarkKingdomCore.ProfileManager._instance;
                    }
                }
            }
        },
        fields: {
            All: null
        },
        ctors: {
            init: function () {
                this.All = new (System.Collections.Generic.List$1(DarkKingdomCore.Profile)).ctor();
            }
        }
    });

    Bridge.define("DarkKingdomCore.Purchase", {
        fields: {
            name: null,
            crystals: 0,
            uIcon: null
        },
        ctors: {
            init: function () {
                this.uIcon = new MonoInterface.Appearance();
            },
            ctor: function (nam, ui, crst) {
                this.$initialize();
                this.name = nam;
                this.uIcon = ui.$clone();
                this.crystals = crst;
            }
        }
    });

    Bridge.define("DarkKingdomCore.Race", {
        fields: {
            name: null,
            desc: null,
            symb: 0,
            noAI: false,
            special: false,
            disableRewards: false,
            nick: null,
            custom: false
        },
        ctors: {
            init: function () {
                this.nick = "";
            },
            ctor: function (nme, dsc, nic, sym, nai, cst, splc, dr) {
                this.$initialize();
                this.name = nme;
                this.desc = dsc;
                this.symb = sym;
                this.noAI = nai;
                this.custom = cst;
                this.special = splc;
                this.nick = nic;
                this.disableRewards = dr;
            }
        },
        methods: {
            Enable: function () {
                this.special = false;
            }
        }
    });

    Bridge.define("DarkKingdomCore.RaceManager", {
        statics: {
            fields: {
                _instance: null
            },
            props: {
                Instance: {
                    get: function () {
                        if (DarkKingdomCore.RaceManager._instance == null) {
                            DarkKingdomCore.RaceManager._instance = new DarkKingdomCore.RaceManager();
                        }
                        return DarkKingdomCore.RaceManager._instance;
                    }
                }
            }
        },
        fields: {
            All: null
        },
        ctors: {
            init: function () {
                this.All = new (System.Collections.Generic.Dictionary$2(System.String,DarkKingdomCore.Race)).ctor();
            }
        }
    });

    Bridge.define("DarkKingdomCore.Spell", {
        fields: {
            Name: null,
            School: null,
            Description: null,
            Cost: null,
            Target: 0,
            Img: 0
        },
        ctors: {
            init: function () {
                this.Cost = new DarkKingdomCore.TimeCost();
            }
        }
    });

    Bridge.define("DarkKingdomCore.Spell.TargetType", {
        $kind: "nested enum",
        statics: {
            fields: {
                Mass: 0,
                Unit: 1,
                Ground: 2
            }
        }
    });

    Bridge.define("DarkKingdomCore.TimeCost", {
        $kind: "struct",
        statics: {
            methods: {
                op_Addition: function (r1, r2) {
                    return new DarkKingdomCore.TimeCost.$ctor1(((r1.Money + r2.Money) | 0), ((r1.Death + r2.Death) | 0), r1.Tier, r1.Time);
                },
                op_Subtraction: function (r1, r2) {
                    return new DarkKingdomCore.TimeCost.$ctor1(((r1.Money - r2.Money) | 0), ((r1.Death - r2.Death) | 0), r1.Tier, r1.Time);
                },
                getDefaultValue: function () { return new DarkKingdomCore.TimeCost(); }
            }
        },
        fields: {
            Money: 0,
            Death: 0,
            Time: 0,
            Tier: 0
        },
        ctors: {
            $ctor1: function (money, death, tier, time) {
                this.$initialize();
                this.Money = money;
                this.Death = death;
                this.Tier = tier;
                this.Time = time;
            },
            ctor: function () {
                this.$initialize();
            }
        },
        methods: {
            EnoughFor: function (cst) {
                return this.Money >= cst.Money && this.Death >= cst.Death && this.Tier >= cst.Tier;
            },
            getHashCode: function () {
                var h = Bridge.addHash([3655391383, this.Money, this.Death, this.Time, this.Tier]);
                return h;
            },
            equals: function (o) {
                if (!Bridge.is(o, DarkKingdomCore.TimeCost)) {
                    return false;
                }
                return Bridge.equals(this.Money, o.Money) && Bridge.equals(this.Death, o.Death) && Bridge.equals(this.Time, o.Time) && Bridge.equals(this.Tier, o.Tier);
            },
            $clone: function (to) {
                var s = to || new DarkKingdomCore.TimeCost();
                s.Money = this.Money;
                s.Death = this.Death;
                s.Time = this.Time;
                s.Tier = this.Tier;
                return s;
            }
        }
    });

    Bridge.define("DarkKingdomCore.Unit", {
        fields: {
            x: 0,
            owner: 0,
            moveside: 0,
            hp: 0,
            parameters: null,
            atkRecharge: 0,
            poiRecharge: 0,
            wingsWave: 0,
            isInCombat: false,
            isInRangeCombat: false,
            purified: false,
            landing: false,
            takedOff: false,
            abils: null,
            deathFromPoison: false,
            shownAbil: null,
            shownAbilMaxVal: 0,
            atkMod: null,
            game: null,
            CurrentAnimation: null,
            CurrentFrame: 0
        },
        props: {
            Attack: {
                get: function () {
                    return DarkKingdomCore.Attack.op_Addition(this.parameters.Attack.$clone(), this.atkMod.$clone());
                },
                set: function (value) {
                    this.atkMod = DarkKingdomCore.Attack.op_Subtraction(value.$clone(), this.parameters.Attack.$clone());
                }
            },
            MinDamage: {
                get: function () {
                    return this.parameters.Attack.MinDamage;
                }
            },
            MaxDamage: {
                get: function () {
                    return this.parameters.Attack.MaxDamage;
                }
            }
        },
        ctors: {
            init: function () {
                this.parameters = new DarkKingdomCore.UnitParameters();
                this.atkMod = new DarkKingdomCore.Attack();
                this.atkRecharge = 0;
                this.poiRecharge = 60;
                this.wingsWave = 0;
                this.isInCombat = false;
                this.isInRangeCombat = false;
                this.shownAbil = "";
                this.shownAbilMaxVal = 0;
            },
            ctor: function (game, xx, msid, own, prms) {
                this.$initialize();
                this.game = game;
                this.x = xx;
                this.moveside = msid;
                this.owner = own;
                this.SetParams(prms.$clone(), true);
                this.CurrentAnimation = "Idle";
            }
        },
        methods: {
            Near: function (u2) {
                return Math.abs(this.x - u2.x) <= 30 && this.parameters.Near(u2.parameters.$clone());
            },
            DrawCurrent: function (x, y, sb, effect) {
                if (effect === void 0) { effect = 0; }
                if (DarkKingdomCore.MyGame.sprites.getItem(this.parameters.spriteName).Ranges.containsKey(this.CurrentAnimation)) {
                    var curInd;
                    curInd = (DarkKingdomCore.MyGame.sprites.getItem(this.parameters.spriteName).Ranges.getItem(this.CurrentAnimation).$clone().Item1 + Bridge.Int.clip32(Math.floor(this.CurrentFrame))) | 0;
                    DarkKingdomCore.MyGame.sprites.getItem(this.parameters.spriteName).Draw$1(curInd, x, y, sb, effect);
                } else {
                    DarkKingdomCore.MyGame.sprites.getItem(this.parameters.spriteName).Draw$1(0, x, y, sb, effect);
                }
            },
            StartAnimation: function (name, animator) {
                if (DarkKingdomCore.MyGame.sprites.getItem(this.parameters.spriteName).Ranges.containsKey(name)) {
                    this.CurrentAnimation = name;
                    animator.AddChild(MonoInterface.NumberAnimation, new MonoInterface.NumberAnimation("CurrentFrame", 0, 0.9, 0.1, void 0, Bridge.fn.bind(this, function () {
                        this.CurrentAnimation = "Idle";
                        this.CurrentFrame = 0;
                    }), this)).Begin();
                }
            },
            AddAbility$3: function (nme, num, cond, cdnum, t, hidden) {
                if (hidden === void 0) { hidden = false; }
                if (!this.abils.containsKey(nme)) {
                    this.abils.add(nme, new DarkKingdomCore.Ability(nme, num, cond, cdnum, t, hidden));
                } else {
                    if (this.abils.getItem(nme).used) {
                        this.abils.setItem(nme, new DarkKingdomCore.Ability(nme, num, cond, cdnum, t, hidden));
                    }
                }
            },
            AddAbility: function (a) {
                this.AddAbility$3(a.name, a.value, a.condition, a.condnum, a.typ, a.hidden);
            },
            AddAbility$1: function (nme, t, hidden) {
                if (hidden === void 0) { hidden = false; }
                this.AddAbility$3(nme, 0, "", 0, t, hidden);
            },
            AddAbility$2: function (nme, num, t, hidden) {
                if (hidden === void 0) { hidden = false; }
                this.AddAbility$3(nme, num, "", 0, t, hidden);
            },
            RemoveAbil: function (nme) {
                if (this.abils.containsKey(nme)) {
                    this.abils.remove(nme);
                }
            },
            AbsContains: function (abil_name) {
                if (this.abils.containsKey(abil_name)) {
                    return this.abils.getItem(abil_name).condCompleted && !this.abils.getItem(abil_name).used;
                }
                return false;
            },
            AbsContains$1: function (abs) {
                var $t;
                if (abs === void 0) { abs = []; }
                $t = Bridge.getEnumerator(abs);
                try {
                    while ($t.moveNext()) {
                        var ab = $t.Current;
                        if (this.abils.containsKey(ab)) {
                            if (this.abils.getItem(ab).condCompleted && !this.abils.getItem(ab).used) {
                                return true;
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                return false;
            },
            SetParams: function (newprm, setHp) {
                var $t, $t1, $t2;
                this.parameters = newprm.$clone();
                this.atkMod = new DarkKingdomCore.Attack.$ctor1(0, 0, 0, 0);
                this.abils = new (System.Collections.Generic.Dictionary$2(System.String,DarkKingdomCore.Ability)).ctor();
                $t = Bridge.getEnumerator(this.parameters.abils.Values);
                try {
                    while ($t.moveNext()) {
                        var a = $t.Current;
                        this.AddAbility(a);
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                if (this.AbsContains("Random model")) {
                    this.RemoveAbil("Random model");
                    do {
                        ($t1 = DarkKingdomCore.MyGame.rnd.NextDouble());
                        if (Bridge.is($t1, System.Object)) {
                            var _discard1 = $t1;
                            if (DarkKingdomCore.MyGame.rnd.NextDouble() < 0.33) {
                                {
                                    this.parameters.spriteName = "militia1";
                                    break;
                                }
                            }
                        }

                        if (Bridge.is($t1, System.Object)) {
                            var _discard2 = $t1;
                            if (DarkKingdomCore.MyGame.rnd.NextDouble() < 0.66) {
                                {
                                    this.parameters.spriteName = "militia2";
                                    break;
                                }
                            }
                        }
                    } while (false);
                }
                if (this.AbsContains("Universal")) {
                    this.RemoveAbil("Universal");
                    var maxrace = DarkKingdomCore.MyGame.SelectPlayingRace(DarkKingdomCore.MyGame.plrs[this.owner].unitsList);
                    switch (maxrace) {
                        case "Humans": 
                            {
                                this.AddAbility$2("Life_rollback", 2, DarkKingdomCore.EffectType.Good);
                                break;
                            }
                        case "Undeads": 
                            {
                                this.AddAbility$1("Undead", DarkKingdomCore.EffectType.Good);
                                this.AddAbility$1("Plague", DarkKingdomCore.EffectType.Good);
                                this.parameters.Speed = "Slow";
                                break;
                            }
                        case "Demons": 
                            {
                                this.AddAbility$1("Mage", DarkKingdomCore.EffectType.Good);
                                this.AddAbility$3("Explosive", 0, "On_death", 0, DarkKingdomCore.EffectType.Good);
                                this.parameters.Armor = "None";
                                this.parameters.Speed = "Fast";
                                break;
                            }
                        case "Horde": 
                            {
                                this.Attack = DarkKingdomCore.Attack.op_Addition$1(this.Attack.$clone(), 10);
                                this.AddAbility$2("Crasher", 24, DarkKingdomCore.EffectType.Good);
                                break;
                            }
                        case "Swampers": 
                            {
                                this.AddAbility$2("Poisoner", 20, DarkKingdomCore.EffectType.Good);
                                this.AddAbility$1("Poisonproof", DarkKingdomCore.EffectType.Good);
                                break;
                            }
                        case "Elves": 
                            {
                                this.AddAbility$2("Agility", 20, DarkKingdomCore.EffectType.Good);
                                this.AddAbility$3("Lycanthropy", 54, "At night", 0, DarkKingdomCore.EffectType.Good);
                                break;
                            }
                        case "Dwarfs": 
                            {
                                this.parameters.Armor = "Heavy";
                                this.AddAbility$1("Spellproof", DarkKingdomCore.EffectType.Good);
                                this.parameters.Speed = "Slow";
                                break;
                            }
                        case "Steampunk": 
                            {
                                this.Attack = DarkKingdomCore.Attack.op_Addition$1(this.Attack.$clone(), 10);
                                ($t2 = this.parameters.$clone()).maxhp = ($t2.maxhp + 100) | 0;
                                this.AddAbility$1("Machinery", DarkKingdomCore.EffectType.Good);
                                break;
                            }
                        case "Neutrals": 
                            {
                                this.Attack = DarkKingdomCore.Attack.op_Addition$1(this.Attack.$clone(), 10);
                                this.AddAbility$1("Invisible", DarkKingdomCore.EffectType.Good);
                                break;
                            }
                    }
                    if (Bridge.referenceEquals(this.parameters.Name, "Neutral_warrior") && !Bridge.referenceEquals(maxrace, "Neutrals")) {
                        this.parameters.rect.Height = 31;
                    }
                }
                if (this.AbsContains("Chance_to_fly") && DarkKingdomCore.MyGame.rnd.NextDouble() > 0.5) {
                    this.parameters.moveType = DarkKingdomCore.UnitMoveType.FlyingMT;
                }
                if (setHp) {
                    this.hp = this.parameters.maxhp;
                }
            }
        }
    });

    Bridge.define("DarkKingdomCore.UnitMoveType", {
        $kind: "enum",
        statics: {
            fields: {
                GroundMT: 0,
                FlyingMT: 1,
                HugeMT: 2
            }
        }
    });

    Bridge.define("DarkKingdomCore.UnitParameters", {
        $kind: "struct",
        statics: {
            methods: {
                getDefaultValue: function () { return new DarkKingdomCore.UnitParameters(); }
            }
        },
        fields: {
            id: 0,
            Name: null,
            Attack: null,
            maxhp: 0,
            Cost: null,
            _armor: 0,
            _speed: 0,
            armNick: null,
            spdNick: null,
            Race: null,
            Subrace: null,
            Description: null,
            animated: false,
            imgx: 0,
            imgy: 0,
            isBuilding: false,
            isIgnoreUnits: false,
            isHeroic: false,
            moveType: 0,
            maxLimit: 0,
            hpBotom: false,
            size: null,
            rect: null,
            abils: null,
            rawAbils: null,
            spriteName: null,
            iconApp: null,
            iconInd: 0,
            ammoType: 0,
            support: false,
            upgrade: false,
            special: false,
            isStartBuilding: false
        },
        props: {
            Speed: {
                get: function () {
                    return this.spdNick;
                },
                set: function (value) {
                    this.spdNick = value;
                    switch (value) {
                        case "None": 
                            this._speed = 0;
                            break;
                        case "Slow": 
                            this._speed = 0.15;
                            break;
                        case "Normal": 
                            this._speed = 0.2;
                            break;
                        case "Fast": 
                            this._speed = 0.3;
                            break;
                        case "Very_fast": 
                            this._speed = 0.6;
                            break;
                    }
                }
            },
            Armor: {
                get: function () {
                    return this.armNick;
                },
                set: function (value) {
                    this.armNick = value;
                    switch (value) {
                        case "None": 
                            this._armor = 1;
                            break;
                        case "Light": 
                            this._armor = 0.75;
                            break;
                        case "Heavy": 
                            this._armor = 0.5;
                            break;
                        case "Ethereal": 
                            this._armor = 0.25;
                            break;
                    }
                }
            }
        },
        ctors: {
            init: function () {
                this.Attack = new DarkKingdomCore.Attack();
                this.Cost = new DarkKingdomCore.TimeCost();
                this.size = new DarkKingdomCore.WidthHeight();
                this.rect = new Microsoft.Xna.Framework.Rectangle();
                this.iconApp = new MonoInterface.Appearance();
            },
            ctor: function () {
                this.$initialize();
            }
        },
        methods: {
            AbsContains: function (nme) {
                return this.abils.containsKey(nme);
            },
            Near: function (up2) {
                return this.moveType === up2.moveType || this.moveType === DarkKingdomCore.UnitMoveType.HugeMT || up2.moveType === DarkKingdomCore.UnitMoveType.HugeMT;
            },
            getHashCode: function () {
                var h = Bridge.addHash([5290109060, this.id, this.Name, this.Attack, this.maxhp, this.Cost, this._armor, this._speed, this.armNick, this.spdNick, this.Race, this.Subrace, this.Description, this.animated, this.imgx, this.imgy, this.isBuilding, this.isIgnoreUnits, this.isHeroic, this.moveType, this.maxLimit, this.hpBotom, this.size, this.rect, this.abils, this.rawAbils, this.spriteName, this.iconApp, this.iconInd, this.ammoType, this.support, this.upgrade, this.special, this.isStartBuilding]);
                return h;
            },
            equals: function (o) {
                if (!Bridge.is(o, DarkKingdomCore.UnitParameters)) {
                    return false;
                }
                return Bridge.equals(this.id, o.id) && Bridge.equals(this.Name, o.Name) && Bridge.equals(this.Attack, o.Attack) && Bridge.equals(this.maxhp, o.maxhp) && Bridge.equals(this.Cost, o.Cost) && Bridge.equals(this._armor, o._armor) && Bridge.equals(this._speed, o._speed) && Bridge.equals(this.armNick, o.armNick) && Bridge.equals(this.spdNick, o.spdNick) && Bridge.equals(this.Race, o.Race) && Bridge.equals(this.Subrace, o.Subrace) && Bridge.equals(this.Description, o.Description) && Bridge.equals(this.animated, o.animated) && Bridge.equals(this.imgx, o.imgx) && Bridge.equals(this.imgy, o.imgy) && Bridge.equals(this.isBuilding, o.isBuilding) && Bridge.equals(this.isIgnoreUnits, o.isIgnoreUnits) && Bridge.equals(this.isHeroic, o.isHeroic) && Bridge.equals(this.moveType, o.moveType) && Bridge.equals(this.maxLimit, o.maxLimit) && Bridge.equals(this.hpBotom, o.hpBotom) && Bridge.equals(this.size, o.size) && Bridge.equals(this.rect, o.rect) && Bridge.equals(this.abils, o.abils) && Bridge.equals(this.rawAbils, o.rawAbils) && Bridge.equals(this.spriteName, o.spriteName) && Bridge.equals(this.iconApp, o.iconApp) && Bridge.equals(this.iconInd, o.iconInd) && Bridge.equals(this.ammoType, o.ammoType) && Bridge.equals(this.support, o.support) && Bridge.equals(this.upgrade, o.upgrade) && Bridge.equals(this.special, o.special) && Bridge.equals(this.isStartBuilding, o.isStartBuilding);
            },
            $clone: function (to) {
                var s = to || new DarkKingdomCore.UnitParameters();
                s.id = this.id;
                s.Name = this.Name;
                s.Attack = this.Attack.$clone();
                s.maxhp = this.maxhp;
                s.Cost = this.Cost.$clone();
                s._armor = this._armor;
                s._speed = this._speed;
                s.armNick = this.armNick;
                s.spdNick = this.spdNick;
                s.Race = this.Race;
                s.Subrace = this.Subrace;
                s.Description = this.Description;
                s.animated = this.animated;
                s.imgx = this.imgx;
                s.imgy = this.imgy;
                s.isBuilding = this.isBuilding;
                s.isIgnoreUnits = this.isIgnoreUnits;
                s.isHeroic = this.isHeroic;
                s.moveType = this.moveType;
                s.maxLimit = this.maxLimit;
                s.hpBotom = this.hpBotom;
                s.size = this.size.$clone();
                s.rect = this.rect.$clone();
                s.abils = this.abils;
                s.rawAbils = this.rawAbils;
                s.spriteName = this.spriteName;
                s.iconApp = this.iconApp.$clone();
                s.iconInd = this.iconInd;
                s.ammoType = this.ammoType;
                s.support = this.support;
                s.upgrade = this.upgrade;
                s.special = this.special;
                s.isStartBuilding = this.isStartBuilding;
                return s;
            }
        }
    });

    Bridge.define("DarkKingdomCore.WidthHeight", {
        $kind: "struct",
        statics: {
            methods: {
                getDefaultValue: function () { return new DarkKingdomCore.WidthHeight(); }
            }
        },
        fields: {
            w: 0,
            h: 0
        },
        ctors: {
            ctor: function () {
                this.$initialize();
            }
        },
        methods: {
            getHashCode: function () {
                var h = Bridge.addHash([3728611878, this.w, this.h]);
                return h;
            },
            equals: function (o) {
                if (!Bridge.is(o, DarkKingdomCore.WidthHeight)) {
                    return false;
                }
                return Bridge.equals(this.w, o.w) && Bridge.equals(this.h, o.h);
            },
            $clone: function (to) {
                var s = to || new DarkKingdomCore.WidthHeight();
                s.w = this.w;
                s.h = this.h;
                return s;
            }
        }
    });

    Bridge.define("DarkKingdomDesktop.App", {
        main: function Main () {
            var $t;
            var canvas = ($t = document.createElement("canvas"), $t.width = 800, $t.height = 480, $t.id = "monogamecanvas", $t);
            document.body.appendChild(canvas);

            DarkKingdomDesktop.App.game = new DarkKingdomDesktop.MainClass();
            DarkKingdomDesktop.App.game.Run();
        },
        statics: {
            fields: {
                game: null
            }
        }
    });

    /** @namespace DarkKingdomDesktop */

    /**
     * This is the main type for your game
     *
     * @public
     * @class DarkKingdomDesktop.MainClass
     * @augments Microsoft.Xna.Framework.Game
     */
    Bridge.define("DarkKingdomDesktop.MainClass", {
        inherits: [Microsoft.Xna.Framework.Game],
        fields: {
            gameClass: null,
            graphics: null,
            spriteBatch: null,
            AppFolder: null,
            DataFolder: null
        },
        ctors: {
            ctor: function () {
                var $t;
                this.$initialize();
                Microsoft.Xna.Framework.Game.ctor.call(this);
                this.graphics = new Microsoft.Xna.Framework.GraphicsDeviceManager(this);
                var platform = "Windows";

                this.gameClass = ($t = new DarkKingdomCore.MyGame(platform), $t.graphics = this.graphics, $t.AppFolder = "", $t.DataFolder = "Content", $t);

                this.Content.RootDirectory = "Content";

                this.gameClass.addOnExit(Bridge.fn.cacheBind(this, this.OnExit));

            }
        },
        methods: {
            Resize: function (w, h) {

                //var scaleFactor = 1.0f;

                //int finalW = (int)(w * scaleFactor);
                //int finalH = (int)(h * scaleFactor);
                //var uiScale = 1.0f;
                //if (finalW > 1000)
                //    uiScale = 1.25f;
                //if (finalW > 1500)
                //    uiScale = 1.5f;
            },
            /**
             * Allows the game to perform any initialization it needs to before starting to run.
             This is where it can query for any required services and load any non-graphic
             related content.  Calling base.Initialize will enumerate through any components
             and initialize them as well.
             *
             * @instance
             * @protected
             * @override
             * @this DarkKingdomDesktop.MainClass
             * @memberof DarkKingdomDesktop.MainClass
             * @return  {void}
             */
            Initialize: function () {
                // TODO: Add your initialization logic here
                this.IsMouseVisible = true;
                Microsoft.Xna.Framework.Input.Touch.TouchPanel.EnabledGestures = 17;
                Microsoft.Xna.Framework.Game.prototype.Initialize.call(this);
            },
            /**
             * LoadContent will be called once per game and is the place to load
             all of your content.
             *
             * @instance
             * @protected
             * @override
             * @this DarkKingdomDesktop.MainClass
             * @memberof DarkKingdomDesktop.MainClass
             * @return  {void}
             */
            LoadContent: function () {
                // Create a new SpriteBatch, which can be used to draw textures.
                //backBuffer = new RenderTarget2D(graphics.GraphicsDevice, 800, 480);
                this.spriteBatch = new Microsoft.Xna.Framework.Graphics.SpriteBatch(this.GraphicsDevice);
                this.gameClass.spriteBatch = this.spriteBatch;

                //	ReadProfiles();
                //ReadSprites(Content);

                //int test_w = 50, test_h = 50;
                //test_text = new Texture2D(GraphicsDevice, test_w, test_h);
                //var fill_arr = new int[test_w * test_h * 4];
                //for (var i = 0; i < test_w * test_h * 4; i += 4)
                //{
                //    fill_arr[i] = 255;
                //    fill_arr[i + 1] = 0;
                //    fill_arr[i + 2] = 255;
                //    fill_arr[i + 3] = 128;
                //}
                //test_text.SetData(fill_arr);
                this.gameClass.LoadData(this.Content);
            },
            /**
             * UnloadContent will be called once per game and is the place to unload
             all content.
             *
             * @instance
             * @protected
             * @override
             * @this DarkKingdomDesktop.MainClass
             * @memberof DarkKingdomDesktop.MainClass
             * @return  {void}
             */
            UnloadContent: function () {
                // TODO: Unload any non ContentManager content here
            },
            /**
             * Allows the game to run logic such as updating the world,
             checking for collisions, gathering input, and playing audio.
             *
             * @instance
             * @protected
             * @override
             * @this DarkKingdomDesktop.MainClass
             * @memberof DarkKingdomDesktop.MainClass
             * @param   {Microsoft.Xna.Framework.GameTime}    gameTime    Provides a snapshot of timing values.
             * @return  {void}
             */
            Update: function (gameTime) {
                if (this.gameClass.isLoaded) {
                    this.gameClass.Update();
                }
                Microsoft.Xna.Framework.Game.prototype.Update.call(this, gameTime);
            },
            /**
             * This is called when the game should draw itself.
             *
             * @instance
             * @protected
             * @override
             * @this DarkKingdomDesktop.MainClass
             * @memberof DarkKingdomDesktop.MainClass
             * @param   {Microsoft.Xna.Framework.GameTime}    gameTime    Provides a snapshot of timing values.
             * @return  {void}
             */
            Draw: function (gameTime) {
                // TODO: Add your drawing code here
                if (this.gameClass.isLoaded) {
                    //graphics.GraphicsDevice.SetRenderTarget(backBuffer);
                    this.spriteBatch.Begin(Microsoft.Xna.Framework.Graphics.SpriteSortMode.Deferred, Microsoft.Xna.Framework.Graphics.BlendState.NonPremultiplied, Microsoft.Xna.Framework.Graphics.SamplerState.PointClamp, Microsoft.Xna.Framework.Graphics.DepthStencilState.Default, Microsoft.Xna.Framework.Graphics.RasterizerState.CullNone);

                    this.gameClass.Draw();
                    //spriteBatch.End();
                    //graphics.GraphicsDevice.SetRenderTarget(null);

                    //spriteBatch.Begin(SpriteSortMode.Deferred, BlendState.NonPremultiplied, SamplerState.PointClamp, DepthStencilState.Default, RasterizerState.CullNone);

                    //spriteBatch.Draw(backBuffer, new Rectangle(0, 0, gameClass._screenWidth, gameClass._screenHeight), Color.White);

                    this.gameClass.DrawInterface(this.spriteBatch);

                    //spriteBatch.Draw(test_text, new Vector2(100, 100), Color.White);

                    this.spriteBatch.End();
                }

                Microsoft.Xna.Framework.Game.prototype.Draw.call(this, gameTime);
            },
            OnExit: function () {
                this.Exit();
            }
        }
    });

    Bridge.define("MonoInterface.Animation", {
        fields: {
            IsRunning: false,
            IsCompleted: false,
            animationTask: null
        },
        events: {
            OnStart: null,
            OnEnd: null
        },
        ctors: {
            ctor: function (onStart, onEnd) {
                if (onStart === void 0) { onStart = null; }
                if (onEnd === void 0) { onEnd = null; }

                this.$initialize();
                this.OnStart = onStart;
                this.OnEnd = onEnd;
            }
        },
        methods: {
            Begin: function () {
                this.IsRunning = true;
                this.IsCompleted = false;
                !Bridge.staticEquals(this.OnStart, null) ? this.OnStart() : null;
                this.animationTask = new System.Threading.Tasks.TaskCompletionSource();
                return this.animationTask.task;
            },
            Complete: function () {
                this.IsRunning = false;
                this.IsCompleted = true;
            },
            End: function () {
                !Bridge.staticEquals(this.OnEnd, null) ? this.OnEnd() : null;
                this.animationTask.setResult(null);
            }
        }
    });

    Bridge.define("MonoInterface.Animator", {
        fields: {
            Animations: null,
            completed: null
        },
        ctors: {
            init: function () {
                this.completed = new (System.Collections.Generic.List$1(MonoInterface.Animation)).ctor();
            },
            ctor: function () {
                this.$initialize();
                this.Animations = new (System.Collections.Generic.List$1(MonoInterface.Animation)).ctor();
            }
        },
        methods: {
            AddChild: function (T, child) {
                this.Animations.add(child);
                return child;
            },
            Do: function () {
                var $t, $t1;
                $t = Bridge.getEnumerator(this.Animations);
                try {
                    while ($t.moveNext()) {
                        var anim = $t.Current;
                        anim.Do();
                        if (anim.IsCompleted) {
                            this.completed.add(anim);
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                if (this.completed.Count > 0) {
                    $t1 = Bridge.getEnumerator(this.completed);
                    try {
                        while ($t1.moveNext()) {
                            var anim1 = $t1.Current;
                            anim1.End();
                            this.Animations.remove(anim1);
                        }
                    } finally {
                        if (Bridge.is($t1, System.IDisposable)) {
                            $t1.System$IDisposable$Dispose();
                        }
                    }
                    this.completed.clear();
                }
            }
        }
    });

    Bridge.define("MonoInterface.Appearance", {
        $kind: "struct",
        statics: {
            methods: {
                getDefaultValue: function () { return new MonoInterface.Appearance(); }
            }
        },
        fields: {
            sprite: null,
            img: 0
        },
        ctors: {
            $ctor1: function (sprite, img) {
                this.$initialize();
                this.sprite = sprite;
                this.img = img;
            },
            ctor: function () {
                this.$initialize();
            }
        },
        methods: {
            Draw$1: function (sb, x, y, effect, alpha) {
                if (effect === void 0) { effect = 0; }
                if (alpha === void 0) { alpha = 1.0; }
                this.sprite.Draw$1(this.img, x, y, sb, effect, alpha);
            },
            Draw: function (sb, x, y, w, h, effect, alpha) {
                if (effect === void 0) { effect = 0; }
                if (alpha === void 0) { alpha = 1.0; }
                this.sprite.Draw(this.img, x, y, w, h, sb, effect, alpha);
            },
            getHashCode: function () {
                var h = Bridge.addHash([3553773573, this.sprite, this.img]);
                return h;
            },
            equals: function (o) {
                if (!Bridge.is(o, MonoInterface.Appearance)) {
                    return false;
                }
                return Bridge.equals(this.sprite, o.sprite) && Bridge.equals(this.img, o.img);
            },
            $clone: function (to) {
                var s = to || new MonoInterface.Appearance();
                s.sprite = this.sprite;
                s.img = this.img;
                return s;
            }
        }
    });

    Bridge.define("MonoInterface.Block", {
        fields: {
            Parent: null,
            X: 0,
            Y: 0,
            _w: 0,
            _h: 0,
            Alignment: null,
            Alpha: 0,
            Visible: false,
            CurrentTheme: null,
            CurrentLocalization: null,
            _finalX: 0,
            _finalY: 0,
            _finalW: 0,
            _finalH: 0,
            IsNeedRecalc: false,
            _showAnimation: null,
            _hideAnimation: null
        },
        props: {
            W: {
                get: function () {
                    return (this._w === -1 && this.Parent != null) ? this.Parent.W : this._w;
                },
                set: function (value) {
                    this._w = value;
                }
            },
            H: {
                get: function () {
                    return (this._h === -1 && this.Parent != null) ? this.Parent.H : this._h;
                },
                set: function (value) {
                    this._h = value;
                }
            },
            Right: {
                get: function () {
                    return ((this.X + this.W) | 0);
                },
                set: function (value) {
                    this.X = (value - this.W) | 0;
                }
            },
            Bottom: {
                get: function () {
                    return ((this.Y + this.H) | 0);
                },
                set: function (value) {
                    this.Y = (value - this.H) | 0;
                }
            },
            FinalX: {
                get: function () {
                    return this._finalX;
                }
            },
            FinalY: {
                get: function () {
                    return this._finalY;
                }
            },
            FinalW: {
                get: function () {
                    return this._finalW;
                }
            },
            FinalH: {
                get: function () {
                    return this._finalH;
                }
            },
            FinalRight: {
                get: function () {
                    return ((this._finalX + this._finalW) | 0);
                }
            },
            FinalBottom: {
                get: function () {
                    return ((this._finalY + this._finalH) | 0);
                }
            },
            ShowAnimation: {
                get: function () {
                    return this._showAnimation;
                },
                set: function (value) {
                    this._showAnimation = value;
                    var na;
                    if (((na = Bridge.as(this._showAnimation, MonoInterface.NumberAnimation))) != null && na.target == null) {
                        na.SetTarget(this);
                    }
                }
            },
            HideAnimation: {
                get: function () {
                    return this._hideAnimation;
                },
                set: function (value) {
                    this._hideAnimation = value;
                    var na;
                    if (((na = Bridge.as(this._hideAnimation, MonoInterface.NumberAnimation))) != null && na.target == null) {
                        na.SetTarget(this);
                    }
                    this.HideAnimation.addOnEnd(Bridge.fn.bind(this, function () {
                        this.Visible = false;
                    }));
                }
            }
        },
        ctors: {
            init: function () {
                this.Alignment = new Microsoft.Xna.Framework.Vector2();
            }
        },
        methods: {
            CheckForRecalc: function () {
                if (this.IsNeedRecalc) {
                    this.Recalc();
                }
            },
            Recalc: function () {

                this._finalW = this._w === -1 ? this.Parent.FinalW : Bridge.Int.clip32(this.W * this.Parent.FinalChildrenScaleX);
                this._finalH = this._h === -1 ? this.Parent.FinalH : Bridge.Int.clip32(this.H * this.Parent.FinalChildrenScaleY);
                this._finalX = (this.Parent.FinalX + Bridge.Int.clip32((this.Parent.FinalChildrenScaleX * this.X + (((this.Parent.FinalW - this._finalW) | 0)) * this.Alignment.X))) | 0;
                this._finalY = (this.Parent.FinalY + Bridge.Int.clip32((this.Parent.FinalChildrenScaleY * this.Y + (((this.Parent.FinalH - this._finalH) | 0)) * this.Alignment.Y))) | 0;
                this.IsNeedRecalc = false;
            },
            Show: function (animator) {
                if (animator === void 0) { animator = null; }
                if (this.Visible === false) {
                    this.Visible = true;
                    if (animator != null && this.ShowAnimation != null) {
                        animator.AddChild(MonoInterface.Animation, this.ShowAnimation).Begin();
                    }
                }
            },
            Hide: function (animator) {
                if (animator === void 0) { animator = null; }

                if (this.Visible === true) {
                    if (animator != null && this.HideAnimation != null) {
                        animator.AddChild(MonoInterface.Animation, this.HideAnimation).Begin();
                    } else {
                        this.Visible = false;
                    }
                }
            },
            ApplyTheme: function (currentTheme) {
                this.CurrentTheme = currentTheme;
                this.IsNeedRecalc = true;
            },
            ApplyLocalization: function (currentLocalization) {
                this.CurrentLocalization = currentLocalization;
            }
        }
    });

    Bridge.define("MonoInterface.BlockAnimation.properties", {
        $kind: "nested enum",
        statics: {
            fields: {
                X: 0,
                Y: 1,
                Alpha: 2
            }
        }
    });

    Bridge.define("MonoInterface.Grid.Orientations", {
        $kind: "nested enum",
        statics: {
            fields: {
                LeftToRight: 0,
                TopToBottom: 1
            }
        }
    });

    Bridge.define("MonoInterface.Localization", {
        fields: {
            Name: null,
            _strings: null
        },
        ctors: {
            init: function () {
                this._strings = new (System.Collections.Generic.Dictionary$2(System.String,System.String)).ctor();
            },
            ctor: function (name, strings) {
                this.$initialize();
                this.Name = name;
                this._strings = strings;
            }
        },
        methods: {
            AddString: function (key, text) {
                this._strings.add(key, text);
            },
            GetString: function (key) {
                if (this._strings.containsKey(key)) {
                    return this._strings.getItem(key);
                }
                return key;
            },
            GetString$1: function (key, args) {
                if (args === void 0) { args = []; }
                if (this._strings.containsKey(key)) {
                    return System.String.format.apply(System.String, [this._strings.getItem(key)].concat(args));
                }
                return key;
            }
        }
    });

    Bridge.define("MonoInterface.Sprite", {
        fields: {
            Texture: null,
            Name: null,
            W: 0,
            H: 0,
            Ranges: null
        },
        ctors: {
            init: function () {
                this.Ranges = new (System.Collections.Generic.Dictionary$2(System.String,System.ValueTuple$2(System.Int32,System.Int32))).ctor();
            }
        },
        methods: {
            Draw$1: function (ind, x, y, sb, effect, alpha) {
                if (effect === void 0) { effect = 0; }
                if (alpha === void 0) { alpha = 1.0; }
                if (alpha !== 1.0) {
                    sb.Draw$7(this.Texture, new Microsoft.Xna.Framework.Vector2.$ctor2(x, y), void 0, this.RectFromIndex(ind), void 0, 0.0, void 0, new Microsoft.Xna.Framework.Color.$ctor9(1.0, 1.0, 1.0, alpha), effect, 0.0);
                } else {
                    sb.Draw$7(this.Texture, new Microsoft.Xna.Framework.Vector2.$ctor2(x, y), void 0, this.RectFromIndex(ind), void 0, 0.0, void 0, Microsoft.Xna.Framework.Color.White, effect, 0.0);
                }
            },
            Draw: function (ind, x, y, w, h, sb, effect, alpha) {
                if (effect === void 0) { effect = 0; }
                if (alpha === void 0) { alpha = 1.0; }
                if (alpha !== 1.0) {
                    sb.Draw$7(this.Texture, void 0, new Microsoft.Xna.Framework.Rectangle.$ctor2(x, y, w, h), this.RectFromIndex(ind), void 0, 0.0, void 0, new Microsoft.Xna.Framework.Color.$ctor9(1.0, 1.0, 1.0, alpha), effect, 0.0);
                } else {
                    sb.Draw$7(this.Texture, void 0, new Microsoft.Xna.Framework.Rectangle.$ctor2(x, y, w, h), this.RectFromIndex(ind), void 0, 0.0, void 0, Microsoft.Xna.Framework.Color.White, effect, 0.0);
                }
            },
            RectFromIndex: function (ind) {
                var columns = (Bridge.Int.div(this.Texture.Width, this.W)) | 0;
                return new Microsoft.Xna.Framework.Rectangle.$ctor2(Bridge.Int.mul((ind % columns), this.W), Bridge.Int.mul((((Bridge.Int.div(ind, columns)) | 0)), this.H), this.W, this.H);
            }
        }
    });

    Bridge.define("MonoInterface.Theme", {
        statics: {
            methods: {
                SolidColorTexture: function (gd, r, g, b, a) {
                    if (a === void 0) { a = 255; }
                    var tex = new Microsoft.Xna.Framework.Graphics.Texture2D.ctor(gd, 1, 1);
                    var data = System.Array.init([
                        r, 
                        g, 
                        b, 
                        a
                    ], System.Int32);
                    tex.SetData$1(System.Int32, data, 0, 1);
                    return tex;
                },
                GetEmptyApp: function (gd) {
                    var $t;
                    return new MonoInterface.Appearance.$ctor1(($t = new MonoInterface.Sprite(), $t.Texture = new Microsoft.Xna.Framework.Graphics.Texture2D.ctor(gd, 1, 1), $t.W = 1, $t.H = 1, $t), 0);
                }
            }
        },
        fields: {
            FrameBackTexture: null,
            ButtonBackTexture: null,
            ButtonFrontTexture: null,
            ButtonPressedTexture: null,
            ButtonDisabledTexture: null,
            ButtonSelectedTexture: null,
            FontColor: null,
            ProgressBackTexture: null,
            ProgressFrontTexture: null,
            SwitcherButtonLeftTexture: null,
            SwitcherButtonRightTexture: null,
            SwitcherMainFontSize: 0,
            SwitcherMainColor: null,
            SwitcherDescriptionFontSize: 0,
            SwitcherDescriptionColor: null,
            NineFrameBoderTexture: null,
            NineSliceButtonBackTexture: null,
            Fonts: null,
            EmptyTexture: null
        },
        ctors: {
            init: function () {
                this.FrameBackTexture = new MonoInterface.Appearance();
                this.ButtonBackTexture = new MonoInterface.Appearance();
                this.ButtonFrontTexture = new MonoInterface.Appearance();
                this.ButtonPressedTexture = new MonoInterface.Appearance();
                this.ButtonDisabledTexture = new MonoInterface.Appearance();
                this.ButtonSelectedTexture = new MonoInterface.Appearance();
                this.FontColor = new Microsoft.Xna.Framework.Color();
                this.ProgressBackTexture = new MonoInterface.Appearance();
                this.ProgressFrontTexture = new MonoInterface.Appearance();
                this.SwitcherButtonLeftTexture = new MonoInterface.Appearance();
                this.SwitcherButtonRightTexture = new MonoInterface.Appearance();
                this.SwitcherMainColor = new Microsoft.Xna.Framework.Color();
                this.SwitcherDescriptionColor = new Microsoft.Xna.Framework.Color();
                this.EmptyTexture = new MonoInterface.Appearance();
            },
            ctor: function () {
                this.$initialize();
                this.Fonts = new (System.Collections.Generic.List$1(System.ValueTuple$2(System.Int32,Microsoft.Xna.Framework.Graphics.SpriteFont))).ctor();
            }
        },
        methods: {
            GetFont: function (size) {
                for (var i = 0; i < this.Fonts.Count; i = (i + 1) | 0) {
                    if (this.Fonts.getItem(i).$clone().Item1 >= size) {
                        return this.Fonts.getItem(i).$clone().Item2;
                    }
                }
                return this.Fonts.getItem(((this.Fonts.Count - 1) | 0)).$clone().Item2;
            }
        }
    });

    Bridge.define("DarkKingdomCore.ImageParticle", {
        inherits: [DarkKingdomCore.Particle],
        fields: {
            spriteRef: null,
            isMirrored: false
        },
        ctors: {
            init: function () {
                this.spriteRef = new MonoInterface.Appearance();
            },
            ctor: function (spriteRef, xx, yy, dxx, dyy, lt, isMir) {
                if (isMir === void 0) { isMir = false; }

                this.$initialize();
                DarkKingdomCore.Particle.ctor.call(this);
                this.x = xx;
                this.y = yy;
                this.dx = dxx;
                this.dy = dyy;
                this.ltime = lt;
                this.spriteRef = spriteRef.$clone();
                this.pType = DarkKingdomCore.ParType.Image;
                this.isMirrored = isMir;
            }
        },
        methods: {
            XNADraw: function (sb) {
                this.spriteRef.Draw$1(sb, this.x, this.y, this.isMirrored ? Microsoft.Xna.Framework.Graphics.SpriteEffects.FlipHorizontally : Microsoft.Xna.Framework.Graphics.SpriteEffects.None);
            }
        }
    });

    Bridge.define("DarkKingdomCore.TextParticle", {
        inherits: [DarkKingdomCore.Particle],
        fields: {
            str: null,
            clr: null,
            shiftX: 0,
            font: null
        },
        ctors: {
            init: function () {
                this.clr = new Microsoft.Xna.Framework.Color();
            },
            ctor: function (fnt, c, xx, yy, dxx, dyy, ayy, lt, s) {
                this.$initialize();
                DarkKingdomCore.Particle.ctor.call(this);
                this.clr = c.$clone();
                this.x = xx;
                this.y = yy;
                this.dx = dxx;
                this.dy = dyy;
                this.ltime = lt;
                this.ay = ayy;
                this.str = s;
                this.a = 768;
                this.font = fnt;
                this.ast = (Bridge.Int.div(768, this.ltime)) | 0;
                this.pType = DarkKingdomCore.ParType.Text;
                this.shiftX = -fnt.MeasureString(this.str).X / 2;
            }
        },
        methods: {
            XNADraw: function (sb) {
                sb.DrawString(this.font, this.str, new Microsoft.Xna.Framework.Vector2.$ctor2(this.x + this.shiftX, this.y), this.clr.$clone());
            }
        }
    });

    Bridge.define("MonoInterface.BlockAnimation", {
        inherits: [MonoInterface.Animation],
        fields: {
            current: 0,
            startValue: 0,
            endValue: 0,
            step: 0,
            target: null,
            property: 0
        },
        ctors: {
            ctor: function (property, start, end, step, onStart, onEnd, target) {
                if (onStart === void 0) { onStart = null; }
                if (onEnd === void 0) { onEnd = null; }
                if (target === void 0) { target = null; }

                this.$initialize();
                MonoInterface.Animation.ctor.call(this, onStart, onEnd);
                this.property = property;
                this.startValue = start;
                this.endValue = end;
                this.step = step;

                this.target = target;

                this.IsRunning = false;
                this.IsCompleted = false;
            }
        },
        methods: {
            Do: function () {
                if (this.IsRunning) {
                    this.current += this.step;
                    if ((this.step > 0 && this.current > this.endValue) || (this.step < 0 && this.current < this.endValue)) {
                        this.current = this.endValue;
                        this.Complete();
                    }
                    switch (this.property) {
                        case MonoInterface.BlockAnimation.properties.X: 
                            this.target.X = Bridge.Int.clip32(this.current);
                            break;
                        case MonoInterface.BlockAnimation.properties.Y: 
                            this.target.Y = Bridge.Int.clip32(this.current);
                            break;
                        case MonoInterface.BlockAnimation.properties.Alpha: 
                            this.target.Alpha = this.current;
                            break;
                    }
                }
            },
            SetTarget: function (target) {
                this.target = target;
            },
            Begin: function () {
                this.current = this.startValue;
                return MonoInterface.Animation.prototype.Begin.call(this);
            }
        }
    });

    Bridge.define("MonoInterface.Container", {
        inherits: [MonoInterface.Block],
        fields: {
            ChildrenScaleX: 0,
            ChildrenScaleY: 0,
            _finalChildrenScaleX: 0,
            _finalChildrenScaleY: 0,
            Children: null
        },
        props: {
            FinalChildrenScaleX: {
                get: function () {
                    return this._finalChildrenScaleX;
                }
            },
            FinalChildrenScaleY: {
                get: function () {
                    return this._finalChildrenScaleY;
                }
            }
        },
        ctors: {
            ctor: function (x, y, w, h, horAlign, verAlign, visible) {
                if (horAlign === void 0) { horAlign = 0.5; }
                if (verAlign === void 0) { verAlign = 0.5; }
                if (visible === void 0) { visible = true; }

                this.$initialize();
                MonoInterface.Block.ctor.call(this);
                this.X = x;
                this.Y = y;
                this.W = w;
                this.H = h;
                this.ChildrenScaleX = 1.0;
                this.ChildrenScaleY = 1.0;
                this.Alpha = 1.0;
                this.Alignment = new Microsoft.Xna.Framework.Vector2.$ctor2(horAlign, verAlign);
                this.Visible = visible;
                this.Children = new (System.Collections.Generic.List$1(MonoInterface.Block)).ctor();
            }
        },
        methods: {
            AddChild: function (T, child) {
                child.Parent = this;
                this.Children.add(child);
                return child;
            },
            Draw: function (sb, parentAlpha) {
                var $t;
                if (this.Visible) {
                    $t = Bridge.getEnumerator(this.Children);
                    try {
                        while ($t.moveNext()) {
                            var child = $t.Current;
                            child.Draw(sb, parentAlpha * this.Alpha);
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                }
            },
            Click: function (x, y, isTouch) { },
            Focus: function () { },
            TapAndHold: function () { },
            CheckForRecalc: function () {
                var $t;
                if (this.IsNeedRecalc) {
                    this.Recalc();
                } else {
                    $t = Bridge.getEnumerator(this.Children);
                    try {
                        while ($t.moveNext()) {
                            var child = $t.Current;
                            child.CheckForRecalc();
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                }
            },
            Recalc: function () {
                var $t;
                MonoInterface.Block.prototype.Recalc.call(this);
                this._finalChildrenScaleX = this.ChildrenScaleX * this.Parent.FinalChildrenScaleX;
                this._finalChildrenScaleY = this.ChildrenScaleY * this.Parent.FinalChildrenScaleY;
                $t = Bridge.getEnumerator(this.Children);
                try {
                    while ($t.moveNext()) {
                        var child = $t.Current;
                        child.Recalc();
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            },
            GetContainerByPoint: function (x, y, finalX, finalY) {
                var $t;
                if (this.Visible === true && this.FinalX <= x && x <= ((this.FinalX + this.FinalW) | 0) && this.FinalY <= y && y <= ((this.FinalY + this.FinalH) | 0)) {
                    finalX.v = (x - this.FinalX) | 0;
                    finalY.v = (y - this.FinalY) | 0;
                    var cont = null;
                    $t = Bridge.getEnumerator(this.Children);
                    try {
                        while ($t.moveNext()) {
                            var child = $t.Current;
                            if (Bridge.is(child, MonoInterface.Container)) {
                                var fX = { };
                                var fY = { };
                                var c = Bridge.cast(child, MonoInterface.Container).GetContainerByPoint(x, y, fX, fY);
                                if (c != null) {
                                    finalX.v = fX.v;
                                    finalY.v = fY.v;
                                    cont = c;
                                }
                            }
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                    return cont || this;
                }
                finalX.v = 0;
                finalY.v = 0;
                return null;
            },
            GetButtonByHotKey: function (key) {
                var $t;
                var result = null;
                $t = Bridge.getEnumerator(this.Children);
                try {
                    while ($t.moveNext()) {
                        var child = $t.Current;
                        if (child.Visible) {
                            if (Bridge.is(child, MonoInterface.Button) && Bridge.cast(child, MonoInterface.Button).HotKey === key) {
                                result = Bridge.cast(child, MonoInterface.Button);
                            }
                            if (Bridge.is(child, MonoInterface.Container)) {
                                result = Bridge.cast(child, MonoInterface.Container).GetButtonByHotKey(key) || result;
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                return result;
            },
            ApplyTheme: function (currentTheme) {
                var $t;
                MonoInterface.Block.prototype.ApplyTheme.call(this, currentTheme);
                $t = Bridge.getEnumerator(this.Children);
                try {
                    while ($t.moveNext()) {
                        var child = $t.Current;
                        child.ApplyTheme(currentTheme);
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }

            },
            ApplyLocalization: function (currentLocalization) {
                var $t;
                MonoInterface.Block.prototype.ApplyLocalization.call(this, currentLocalization);
                $t = Bridge.getEnumerator(this.Children);
                try {
                    while ($t.moveNext()) {
                        var child = $t.Current;
                        child.ApplyLocalization(currentLocalization);
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            }
        }
    });

    Bridge.define("MonoInterface.Label", {
        inherits: [MonoInterface.Block],
        fields: {
            _text: null,
            _size: 0,
            TextColor: null,
            FinalFont: null
        },
        props: {
            Text: {
                get: function () {
                    return this._text;
                },
                set: function (value) {
                    this._text = value;
                    this.IsNeedRecalc = true;
                }
            },
            Size: {
                get: function () {
                    return this._size;
                },
                set: function (value) {
                    this._size = value;
                    this.IsNeedRecalc = true;
                }
            }
        },
        ctors: {
            ctor: function (text, size, clr, x, y, horAlign, verAlign, visible) {
                if (clr === void 0) { clr = null; }
                if (x === void 0) { x = 0; }
                if (y === void 0) { y = 0; }
                if (horAlign === void 0) { horAlign = 0.5; }
                if (verAlign === void 0) { verAlign = 0.5; }
                if (visible === void 0) { visible = true; }

                this.$initialize();
                MonoInterface.Block.ctor.call(this);
                this.X = x;
                this.Y = y;
                this.W = 0;
                this.H = 0;
                this.Alpha = 1.0;
                this.Alignment = new Microsoft.Xna.Framework.Vector2.$ctor2(horAlign, verAlign);
                this.Size = size;
                this.Text = text;
                this.TextColor = System.Nullable.lift1("$clone", clr);
                this.Visible = visible;

            }
        },
        methods: {
            Recalc: function () {
                var $t, $t1;
                this.FinalFont = this.CurrentTheme.GetFont(Bridge.Int.clip32(this.Size * this.Parent.FinalChildrenScaleY));
                var wh = this.FinalFont.MeasureString(this.CurrentLocalization == null ? this.Text : this.CurrentLocalization.GetString(this.Text));
                this._finalW = ($t = Bridge.Int.clip32(wh.X), this.W = $t, $t);
                this._finalH = ($t1 = Bridge.Int.clip32(wh.Y), this.H = $t1, $t1);
                this._finalX = (this.Parent.FinalX + Bridge.Int.clip32((this.Parent.FinalChildrenScaleX * this.X + (((this.Parent.FinalW - this._finalW) | 0)) * this.Alignment.X))) | 0;
                this._finalY = (this.Parent.FinalY + Bridge.Int.clip32((this.Parent.FinalChildrenScaleY * this.Y + (((this.Parent.FinalH - this._finalH) | 0)) * this.Alignment.Y))) | 0;
                this.IsNeedRecalc = false;
            },
            Draw: function (sb, parentAlpha) {
                var $t, $t1, $t2, $t3;
                if (this.Visible && !this.IsNeedRecalc) {
                    var text = ($t = (($t1 = this.CurrentLocalization) != null ? $t1.GetString(this.Text) : null), $t != null ? $t : this.Text);
                    $t2 = Bridge.getEnumerator(text);
                    try {
                        while ($t2.moveNext()) {
                            var c = $t2.Current;
                            if (!this.FinalFont.Characters.contains(c)) {
                                System.Console.WriteLine(text);
                            }
                        }
                    } finally {
                        if (Bridge.is($t2, System.IDisposable)) {
                            $t2.System$IDisposable$Dispose();
                        }
                    }
                    sb.DrawString(this.FinalFont, text, new Microsoft.Xna.Framework.Vector2.$ctor2(this.FinalX, this.FinalY), new Microsoft.Xna.Framework.Color.$ctor2(($t3 = this.TextColor, $t3 != null ? $t3 : this.CurrentTheme.FontColor), parentAlpha * this.Alpha));
                }
            }
        }
    });

    Bridge.define("MonoInterface.ListAnimation", {
        inherits: [MonoInterface.Animation],
        fields: {
            Children: null,
            _current: 0
        },
        ctors: {
            ctor: function (onStart, onEnd) {
                this.$initialize();
                MonoInterface.Animation.ctor.call(this, onStart, onEnd);
                this.Children = new (System.Collections.Generic.List$1(MonoInterface.Animation)).ctor();
            }
        },
        methods: {
            Do: function () {
                if (this.IsRunning) {
                    this.Children.getItem(this._current).Do();
                    if (this.Children.getItem(this._current).IsCompleted) {
                        if (((this._current + 1) | 0) < this.Children.Count) {
                            this._current = (this._current + 1) | 0;
                            this.Children.getItem(this._current).Begin();
                        } else {
                            this.Complete();
                        }
                    }
                }
            },
            Begin: function () {
                this._current = 0;
                this.Children.getItem(this._current).Begin();
                return MonoInterface.Animation.prototype.Begin.call(this);
            },
            AddChild: function (T, child) {
                this.Children.add(child);
                return child;
            }
        }
    });

    Bridge.define("MonoInterface.MultiAnimation", {
        inherits: [MonoInterface.Animation],
        fields: {
            Children: null
        },
        ctors: {
            ctor: function (children) {
                if (children === void 0) { children = []; }

                this.$initialize();
                MonoInterface.Animation.ctor.call(this);
                this.Children = new (System.Collections.Generic.List$1(MonoInterface.Animation)).ctor();
                this.Children.AddRange(children);
            },
            $ctor1: function (onStart, onEnd, children) {
                if (onStart === void 0) { onStart = null; }
                if (onEnd === void 0) { onEnd = null; }
                if (children === void 0) { children = []; }

                this.$initialize();
                MonoInterface.Animation.ctor.call(this, onStart, onEnd);
                this.Children = new (System.Collections.Generic.List$1(MonoInterface.Animation)).ctor();
                this.Children.AddRange(children);
            }
        },
        methods: {
            Do: function () {
                var $t, $t1;
                if (this.IsRunning) {
                    $t = Bridge.getEnumerator(this.Children);
                    try {
                        while ($t.moveNext()) {
                            var child = $t.Current;
                            child.Do();
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                    var isEnd = true;
                    $t1 = Bridge.getEnumerator(this.Children);
                    try {
                        while ($t1.moveNext()) {
                            var child1 = $t1.Current;
                            if (!child1.IsCompleted) {
                                isEnd = false;
                            }
                        }
                    } finally {
                        if (Bridge.is($t1, System.IDisposable)) {
                            $t1.System$IDisposable$Dispose();
                        }
                    }
                    if (isEnd) {
                        this.Complete();
                    }
                }
            },
            Begin: function () {
                var $t;
                $t = Bridge.getEnumerator(this.Children);
                try {
                    while ($t.moveNext()) {
                        var child = $t.Current;
                        child.Begin();
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                return MonoInterface.Animation.prototype.Begin.call(this);
            },
            AddChild: function (T, child) {
                this.Children.add(child);
                return child;
            }
        }
    });

    Bridge.define("MonoInterface.NumberAnimation", {
        inherits: [MonoInterface.Animation],
        fields: {
            current: 0,
            startValue: 0,
            endValue: 0,
            step: 0,
            target: null,
            property: null,
            propertyInfo: null
        },
        ctors: {
            ctor: function (property, start, end, step, onStart, onEnd, target) {
                if (onStart === void 0) { onStart = null; }
                if (onEnd === void 0) { onEnd = null; }
                if (target === void 0) { target = null; }

                this.$initialize();
                MonoInterface.Animation.ctor.call(this, onStart, onEnd);
                this.property = property;
                this.startValue = start;
                this.endValue = end;
                this.step = step;

                this.target = target;
                this.propertyInfo = target != null ? Bridge.Reflection.getMembers(Bridge.getType(target), 16, 284, property) : null;

                this.IsRunning = false;
                this.IsCompleted = false;
            }
        },
        methods: {
            Do: function () {
                if (this.IsRunning) {
                    this.current += this.step;
                    if ((this.step > 0 && this.current > this.endValue) || (this.step < 0 && this.current < this.endValue)) {
                        this.current = this.endValue;
                        this.Complete();
                    }
                    Bridge.Reflection.midel(this.propertyInfo.s, this.target)(System.Convert.changeType(this.current, this.propertyInfo.rt));
                }
            },
            SetTarget: function (target) {
                this.target = target;
                this.propertyInfo = Bridge.Reflection.getMembers(Bridge.getType(target), 16, 284, this.property);
            },
            Begin: function () {
                this.current = this.startValue;
                return MonoInterface.Animation.prototype.Begin.call(this);
            }
        }
    });

    Bridge.define("MonoInterface.Picture", {
        inherits: [MonoInterface.Block],
        fields: {
            spriteRef: null
        },
        ctors: {
            init: function () {
                this.spriteRef = new MonoInterface.Appearance();
            },
            ctor: function (spriteRef, x, y, w, h, horAlign, verAlign, visible) {
                if (x === void 0) { x = 0; }
                if (y === void 0) { y = 0; }
                if (w === void 0) { w = 0; }
                if (h === void 0) { h = 0; }
                if (horAlign === void 0) { horAlign = 0.5; }
                if (verAlign === void 0) { verAlign = 0.5; }
                if (visible === void 0) { visible = true; }

                this.$initialize();
                MonoInterface.Block.ctor.call(this);
                this.spriteRef = spriteRef.$clone();
                this.X = x;
                this.Y = y;
                this.Alpha = 1.0;
                if (w === 0) {
                    this.W = spriteRef.sprite.W;
                } else {
                    this.W = w;
                }
                if (h === 0) {
                    this.H = spriteRef.sprite.H;
                } else {
                    this.H = h;
                }
                this.Alignment = new Microsoft.Xna.Framework.Vector2.$ctor2(horAlign, verAlign);

                this.Visible = visible;
            }
        },
        methods: {
            Draw: function (sb, parentAlpha) {
                if (this.Visible) {
                    this.spriteRef.Draw(sb, this.FinalX, this.FinalY, this.FinalW, this.FinalH, 0, parentAlpha * this.Alpha);
                }
            },
            ApplyTheme: function (currentTheme) {
                this.CurrentTheme = currentTheme;
            }
        }
    });

    Bridge.define("MonoInterface.Progress", {
        inherits: [MonoInterface.Block],
        fields: {
            CurrentValue: 0,
            MaxValue: 0,
            Step: 0
        },
        ctors: {
            ctor: function (curValue, maxValue, x, y, w, h, step, visible) {
                if (visible === void 0) { visible = true; }

                this.$initialize();
                MonoInterface.Block.ctor.call(this);
                this.X = x;
                this.Y = y;
                this.W = w;
                this.H = h;
                this.MaxValue = maxValue;
                this.CurrentValue = curValue;
                this.Step = step;
                this.Visible = visible;
            }
        },
        methods: {
            Draw: function (sb, parentAlpha) {
                if (this.Visible) {
                    this.CurrentTheme.ProgressBackTexture.Draw(sb, this.FinalX, this.FinalY, this.FinalW, this.FinalH);
                    if (this.MaxValue > 0) {
                        this.CurrentTheme.ProgressFrontTexture.Draw(sb, this.FinalX, this.FinalY, Bridge.Int.clip32(this.FinalW * (this.CurrentValue / this.MaxValue)), this.FinalH);
                    }
                }
            },
            ApplyTheme: function (currentTheme) {
                this.CurrentTheme = currentTheme;
            }
        }
    });

    Bridge.define("MonoInterface.Button", {
        inherits: [MonoInterface.Container],
        fields: {
            IsHighlighted: false,
            IsPressed: false,
            IsDisabled: false,
            IsSelected: false,
            HotKey: 0,
            BackTexture: null,
            FrontTexture: null,
            PressedTexture: null,
            DisabledTexture: null,
            SelectedTexture: null
        },
        events: {
            OnClick: null,
            OnFocus: null
        },
        ctors: {
            $ctor3: function (onClick, x, y, w, h, horAlign, verAlign, visible) {
                if (horAlign === void 0) { horAlign = 0.5; }
                if (verAlign === void 0) { verAlign = 0.5; }
                if (visible === void 0) { visible = true; }

                this.$initialize();
                MonoInterface.Container.ctor.call(this, x, y, w, h, horAlign, verAlign, visible);
                this.OnClick = onClick;
            },
            ctor: function (onClick, hotkey, x, y, w, h, horAlign, verAlign, visible) {
                if (horAlign === void 0) { horAlign = 0.5; }
                if (verAlign === void 0) { verAlign = 0.5; }
                if (visible === void 0) { visible = true; }

                this.$initialize();
                MonoInterface.Container.ctor.call(this, x, y, w, h, horAlign, verAlign, visible);
                this.OnClick = onClick;
                this.HotKey = hotkey;
            },
            $ctor2: function (onClick, onFocus, x, y, w, h, horAlign, verAlign, visible) {
                if (horAlign === void 0) { horAlign = 0.5; }
                if (verAlign === void 0) { verAlign = 0.5; }
                if (visible === void 0) { visible = true; }

                this.$initialize();
                MonoInterface.Container.ctor.call(this, x, y, w, h, horAlign, verAlign, visible);
                this.OnClick = onClick;
                this.OnFocus = onFocus;
            },
            $ctor1: function (onClick, onFocus, hotkey, x, y, w, h, horAlign, verAlign, visible) {
                if (horAlign === void 0) { horAlign = 0.5; }
                if (verAlign === void 0) { verAlign = 0.5; }
                if (visible === void 0) { visible = true; }

                this.$initialize();
                MonoInterface.Container.ctor.call(this, x, y, w, h, horAlign, verAlign, visible);
                this.OnClick = onClick;
                this.OnFocus = onFocus;
                this.HotKey = hotkey;
            }
        },
        methods: {
            Draw: function (sb, parentAlpha) {
                var $t, $t1, $t2, $t3, $t4;
                if (this.Visible) {
                    (($t = this.BackTexture, $t != null ? $t : this.CurrentTheme.ButtonBackTexture)).Draw(sb, this.FinalX, this.FinalY, this.FinalW, this.FinalH, 0, parentAlpha * this.Alpha);

                    if (this.IsSelected) {
                        (($t1 = this.SelectedTexture, $t1 != null ? $t1 : this.CurrentTheme.ButtonSelectedTexture)).Draw(sb, this.FinalX, this.FinalY, this.FinalW, this.FinalH, 0, parentAlpha * this.Alpha);
                    }

                    MonoInterface.Container.prototype.Draw.call(this, sb, parentAlpha);
                    if (this.IsDisabled) {
                        (($t2 = this.DisabledTexture, $t2 != null ? $t2 : this.CurrentTheme.ButtonDisabledTexture)).Draw(sb, this.FinalX, this.FinalY, this.FinalW, this.FinalH, 0, parentAlpha * this.Alpha);
                    }

                    if (this.IsHighlighted) {
                        (($t3 = this.FrontTexture, $t3 != null ? $t3 : this.CurrentTheme.ButtonFrontTexture)).Draw(sb, this.FinalX, this.FinalY, this.FinalW, this.FinalH, 0, parentAlpha * this.Alpha);
                        this.IsHighlighted = false;
                    }
                    if (this.IsPressed) {
                        (($t4 = this.FrontTexture, $t4 != null ? $t4 : this.CurrentTheme.ButtonFrontTexture)).Draw(sb, this.FinalX, this.FinalY, this.FinalW, this.FinalH, 0, parentAlpha * this.Alpha);
                        this.IsPressed = false;
                    }
                }

            },
            Click: function (x, y, isTouch) {
                if (!this.IsDisabled) {
                    !Bridge.staticEquals(this.OnClick, null) ? this.OnClick(this, isTouch) : null;
                }
            },
            Focus: function () {
                !Bridge.staticEquals(this.OnFocus, null) ? this.OnFocus(this, false) : null;
            },
            TapAndHold: function () {
                !Bridge.staticEquals(this.OnFocus, null) ? this.OnFocus(this, true) : null;
            }
        }
    });

    Bridge.define("MonoInterface.Frame", {
        inherits: [MonoInterface.Container],
        fields: {
            TopBorder: false,
            LeftBorder: false,
            RightBorder: false,
            BottomBorder: false,
            BackTexture: null
        },
        ctors: {
            ctor: function (x, y, w, h, horAlign, verAlign, visible) {
                if (horAlign === void 0) { horAlign = 0.5; }
                if (verAlign === void 0) { verAlign = 0.5; }
                if (visible === void 0) { visible = true; }

                this.$initialize();
                MonoInterface.Container.ctor.call(this, x, y, w, h, horAlign, verAlign, visible);
                this.TopBorder = true;
                this.LeftBorder = true;
                this.RightBorder = true;
                this.BottomBorder = true;
            }
        },
        methods: {
            Draw: function (sb, parentAlpha) {
                var $t, $t1, $t2, $t3, $t4, $t5, $t6, $t7, $t8, $t9;
                if (this.Visible) {
                    if (this.CurrentTheme.NineFrameBoderTexture != null) {
                        var topshift = 12, bottomshift = 12, leftshift = 12, rightshift = 12;
                        if (!this.TopBorder) {
                            topshift = 0;
                        }
                        if (!this.BottomBorder) {
                            bottomshift = 0;
                        }
                        if (!this.LeftBorder) {
                            leftshift = 0;
                        }
                        if (!this.RightBorder) {
                            rightshift = 0;
                        }
                        if (this.TopBorder && this.LeftBorder) {
                            ($t = this.CurrentTheme.NineFrameBoderTexture)[0].Draw(sb, ((this.FinalX - 12) | 0), ((this.FinalY - 12) | 0), 24, 24, 0, parentAlpha * this.Alpha);
                        }
                        if (this.TopBorder) {
                            ($t1 = this.CurrentTheme.NineFrameBoderTexture)[1].Draw(sb, ((this.FinalX + leftshift) | 0), ((this.FinalY - 12) | 0), ((((this.FinalW - leftshift) | 0) - rightshift) | 0), 24, 0, parentAlpha * this.Alpha);
                        }
                        if (this.TopBorder && this.RightBorder) {
                            ($t2 = this.CurrentTheme.NineFrameBoderTexture)[2].Draw(sb, ((((this.FinalX + this.FinalW) | 0) - 12) | 0), ((this.FinalY - 12) | 0), 24, 24, 0, parentAlpha * this.Alpha);
                        }
                        if (this.LeftBorder) {
                            ($t3 = this.CurrentTheme.NineFrameBoderTexture)[3].Draw(sb, ((this.FinalX - 12) | 0), ((this.FinalY + topshift) | 0), 24, ((((this.FinalH - bottomshift) | 0) - topshift) | 0), 0, parentAlpha * this.Alpha);
                        }

                        ($t4 = this.CurrentTheme.NineFrameBoderTexture)[4].Draw(sb, ((this.FinalX + leftshift) | 0), ((this.FinalY + topshift) | 0), ((((this.FinalW - leftshift) | 0) - rightshift) | 0), ((((this.FinalH - bottomshift) | 0) - topshift) | 0), 0, parentAlpha * this.Alpha);

                        if (this.RightBorder) {
                            ($t5 = this.CurrentTheme.NineFrameBoderTexture)[5].Draw(sb, ((((this.FinalX + this.FinalW) | 0) - 12) | 0), ((this.FinalY + topshift) | 0), 24, ((((this.FinalH - bottomshift) | 0) - topshift) | 0), 0, parentAlpha * this.Alpha);
                        }
                        if (this.BottomBorder && this.LeftBorder) {
                            ($t6 = this.CurrentTheme.NineFrameBoderTexture)[6].Draw(sb, ((this.FinalX - 12) | 0), ((((this.FinalY + this.FinalH) | 0) - 12) | 0), 24, 24, 0, parentAlpha * this.Alpha);
                        }
                        if (this.BottomBorder) {
                            ($t7 = this.CurrentTheme.NineFrameBoderTexture)[7].Draw(sb, ((this.FinalX + leftshift) | 0), ((((this.FinalY + this.FinalH) | 0) - 12) | 0), ((((this.FinalW - leftshift) | 0) - rightshift) | 0), 24, 0, parentAlpha * this.Alpha);
                        }
                        if (this.BottomBorder && this.RightBorder) {
                            ($t8 = this.CurrentTheme.NineFrameBoderTexture)[8].Draw(sb, ((((this.FinalX + this.FinalW) | 0) - 12) | 0), ((((this.FinalY + this.FinalH) | 0) - 12) | 0), 24, 24, 0, parentAlpha * this.Alpha);
                        }
                    } else {
                        (($t9 = this.BackTexture, $t9 != null ? $t9 : this.CurrentTheme.FrameBackTexture)).Draw(sb, this.FinalX, this.FinalY, this.FinalW, this.FinalH, 0, parentAlpha * this.Alpha);
                    }
                    MonoInterface.Container.prototype.Draw.call(this, sb, parentAlpha);
                }
            }
        }
    });

    Bridge.define("MonoInterface.Grid", {
        inherits: [MonoInterface.Container],
        fields: {
            Orientation: 0
        },
        ctors: {
            ctor: function (orientation, x, y, w, h, horAlign, verAlign, visible) {
                if (horAlign === void 0) { horAlign = 0.5; }
                if (verAlign === void 0) { verAlign = 0.5; }
                if (visible === void 0) { visible = true; }

                this.$initialize();
                MonoInterface.Container.ctor.call(this, x, y, w, h, horAlign, verAlign, visible);
                this.Orientation = orientation;
            }
        },
        methods: {
            AddChild: function (T, child) {
                if (this.Children.Count > 0) {
                    var cX = child.X;
                    var cY = child.Y;
                    if (this.Orientation === MonoInterface.Grid.Orientations.LeftToRight) {
                        cX = (System.Linq.Enumerable.from(this.Children, MonoInterface.Block).last().Right + child.X) | 0;
                        cY = System.Linq.Enumerable.from(this.Children, MonoInterface.Block).last().Y;
                        if (((cX + child.W) | 0) > this.W) {
                            cX = child.X;
                            cY = (System.Linq.Enumerable.from(this.Children, MonoInterface.Block).last().Bottom + child.Y) | 0;
                        }
                    } else if (this.Orientation === MonoInterface.Grid.Orientations.TopToBottom) {
                        cX = child.X;
                        cY = (System.Linq.Enumerable.from(this.Children, MonoInterface.Block).last().Bottom + child.Y) | 0;
                        if (((cY + child.H) | 0) > this.H) {
                            cX = (System.Linq.Enumerable.from(this.Children, MonoInterface.Block).last().Right + child.X) | 0;
                            cY = System.Linq.Enumerable.from(this.Children, MonoInterface.Block).last().Y;
                        }
                    }
                    child.X = cX;
                    child.Y = cY;
                }
                return MonoInterface.Container.prototype.AddChild.call(this, T, child);
            }
        }
    });

    Bridge.define("MonoInterface.LongLabel", {
        inherits: [MonoInterface.Container],
        fields: {
            _text: null,
            TextColor: null,
            FinalFont: null,
            _size: 0
        },
        props: {
            Text: {
                get: function () {
                    return this._text;
                },
                set: function (value) {
                    this._text = value;
                    this.IsNeedRecalc = true;
                }
            },
            Size: {
                get: function () {
                    return this._size;
                },
                set: function (value) {
                    this._size = value;
                    this.IsNeedRecalc = true;
                }
            }
        },
        ctors: {
            ctor: function (text, size, clr, x, y, w, horAlign, verAlign, visible) {
                if (clr === void 0) { clr = null; }
                if (x === void 0) { x = 0; }
                if (y === void 0) { y = 0; }
                if (w === void 0) { w = 0; }
                if (horAlign === void 0) { horAlign = 0.5; }
                if (verAlign === void 0) { verAlign = 0.5; }
                if (visible === void 0) { visible = true; }

                this.$initialize();
                MonoInterface.Container.ctor.call(this, x, y, w, 0, horAlign, verAlign, visible);
                this._size = size;
                this._text = text;
                this.TextColor = System.Nullable.lift1("$clone", clr);

            }
        },
        methods: {
            Recalc: function () {
                this.FinalFont = this.CurrentTheme.GetFont(this._size);
                this.Children.clear();
                var localizedText = this.CurrentLocalization != null ? this.CurrentLocalization.GetString(this._text) : this._text;
                var texts = System.String.split(localizedText, [32].map(function (i) {{ return String.fromCharCode(i); }}));
                var curtext = "";
                var lineH = Bridge.Int.clip32(this.FinalFont.MeasureString(localizedText).Y);
                var totalLines = 0;
                for (var i = 0; i < texts.length; i = (i + 1) | 0) {
                    if (this.FinalFont.MeasureString((curtext || "") + String.fromCharCode(32) + (texts[i] || "")).X > this.W && i > 0) {
                        this.AddChild(MonoInterface.Label, new MonoInterface.Label(curtext, this.Size, System.Nullable.lift1("$clone", this.TextColor), 0, Bridge.Int.mul(totalLines, lineH), this.Alignment.X, 0.0, true));
                        totalLines = (totalLines + 1) | 0;
                        curtext = (texts[i] || "") + String.fromCharCode(32);
                    } else {
                        curtext = (curtext || "") + (((texts[i] || "") + String.fromCharCode(32)) || "");
                    }
                }
                this.AddChild(MonoInterface.Label, new MonoInterface.Label(curtext.trim(), this.Size, System.Nullable.lift1("$clone", this.TextColor), 0, Bridge.Int.mul(totalLines, lineH), this.Alignment.X, 0.0, true));
                totalLines = (totalLines + 1) | 0;
                this.H = (Bridge.Int.mul(totalLines, lineH));
                MonoInterface.Container.prototype.ApplyTheme.call(this, this.CurrentTheme);
                MonoInterface.Container.prototype.Recalc.call(this);
            },
            ApplyTheme: function (currentTheme) {
                this.CurrentTheme = currentTheme;
                this.Size = this._size;
                this.Text = this._text;
            }
        }
    });

    Bridge.define("MonoInterface.Switcher", {
        inherits: [MonoInterface.Container],
        fields: {
            _current: 0,
            ItemsCount: 0,
            Pictures: null,
            Titles: null,
            Descriptions: null,
            pctMain: null,
            lblMain: null,
            lblDesc: null,
            pctMainOld: null,
            lblMainOld: null,
            Animator: null
        },
        props: {
            Current: {
                get: function () {
                    return this._current;
                },
                set: function (value) {
                    var $t, $t1, $t2, $t3, $t4;
                    if (this.pctMainOld != null) {
                        this.pctMainOld.spriteRef = ($t = this.Pictures)[this._current].$clone();
                    }
                    if (this.lblMainOld != null) {
                        this.lblMainOld.Text = ($t1 = this.Titles)[this._current];
                    }
                    this._current = value;
                    if (this._current >= this.ItemsCount) {
                        this._current = 0;
                    }
                    if (this._current < 0) {
                        this._current = (this.ItemsCount - 1) | 0;
                    }
                    if (this.pctMain != null) {
                        this.pctMain.spriteRef = ($t2 = this.Pictures)[this._current].$clone();
                    }
                    if (this.lblMain != null) {
                        this.lblMain.Text = ($t3 = this.Titles)[this._current];
                    }
                    if (this.lblDesc != null) {
                        this.lblDesc.Text = ($t4 = this.Descriptions)[this._current];
                    }
                }
            }
        },
        ctors: {
            ctor: function (pictures, titles, descriptions, current, animator, x, y, w, h, horAlign, verAlign, visible) {
                if (horAlign === void 0) { horAlign = 0.5; }
                if (verAlign === void 0) { verAlign = 0.5; }
                if (visible === void 0) { visible = true; }
                var $t, $t1;

                this.$initialize();
                MonoInterface.Container.ctor.call(this, x, y, w, h, horAlign, verAlign, visible);
                this.Pictures = pictures;
                this.Titles = titles;
                this.Descriptions = descriptions;
                this.Animator = animator;

                var pCnt = ($t = (pictures != null ? pictures.length : null), $t != null ? $t : 0);
                var tCnt = ($t1 = (titles != null ? titles.length : null), $t1 != null ? $t1 : 0);

                var maxCnt = pCnt > tCnt ? pCnt : tCnt;

                this.ItemsCount = maxCnt;
                this.Current = current;

            }
        },
        methods: {
            btnLeftClicked: function (btn, isTouch) {
                this.Current = (this.Current - 1) | 0;
                if (this.Animator != null) {
                    if (this.pctMain != null) {
                        this.Animator.AddChild(MonoInterface.MultiAnimation, new MonoInterface.MultiAnimation.$ctor1(Bridge.fn.bind(this, function () {
                            this.pctMainOld.Show();
                        }), Bridge.fn.bind(this, function () {
                            this.pctMainOld.Hide();
                        }), [new MonoInterface.NumberAnimation("X", 0, -50, -5, void 0, void 0, this.pctMainOld), new MonoInterface.NumberAnimation("Alpha", 1.0, 0, -0.1, void 0, void 0, this.pctMainOld)])).Begin();
                        this.Animator.AddChild(MonoInterface.MultiAnimation, new MonoInterface.MultiAnimation.ctor([new MonoInterface.NumberAnimation("X", 50, 0, -5, void 0, void 0, this.pctMain), new MonoInterface.NumberAnimation("Alpha", 0, 1.0, 0.1, void 0, void 0, this.pctMain)])).Begin();
                    } else if (this.lblMain != null) {
                        this.Animator.AddChild(MonoInterface.MultiAnimation, new MonoInterface.MultiAnimation.$ctor1(Bridge.fn.bind(this, function () {
                            this.lblMainOld.Show();
                        }), Bridge.fn.bind(this, function () {
                            this.lblMainOld.Hide();
                        }), [new MonoInterface.NumberAnimation("X", 0, -50, -5, void 0, void 0, this.lblMainOld), new MonoInterface.NumberAnimation("Alpha", 1.0, 0, -0.1, void 0, void 0, this.lblMainOld)])).Begin();
                        this.Animator.AddChild(MonoInterface.MultiAnimation, new MonoInterface.MultiAnimation.ctor([new MonoInterface.NumberAnimation("X", 50, 0, -5, void 0, void 0, this.lblMain), new MonoInterface.NumberAnimation("Alpha", 0, 1.0, 0.1, void 0, void 0, this.lblMain)])).Begin();
                    }
                }
            },
            btnRightClicked: function (btn, isTouch) {
                this.Current = (this.Current + 1) | 0;
                if (this.Animator != null) {
                    if (this.pctMain != null) {
                        this.Animator.AddChild(MonoInterface.MultiAnimation, new MonoInterface.MultiAnimation.$ctor1(Bridge.fn.bind(this, function () {
                            this.pctMainOld.Show();
                        }), Bridge.fn.bind(this, function () {
                            this.pctMainOld.Hide();
                        }), [new MonoInterface.NumberAnimation("X", 0, 50, 5, void 0, void 0, this.pctMainOld), new MonoInterface.NumberAnimation("Alpha", 1.0, 0, -0.1, void 0, void 0, this.pctMainOld)])).Begin();
                        this.Animator.AddChild(MonoInterface.MultiAnimation, new MonoInterface.MultiAnimation.ctor([new MonoInterface.NumberAnimation("X", -50, 0, 5, void 0, void 0, this.pctMain), new MonoInterface.NumberAnimation("Alpha", 0, 1.0, 0.1, void 0, void 0, this.pctMain)])).Begin();
                    } else if (this.lblMain != null) {
                        this.Animator.AddChild(MonoInterface.MultiAnimation, new MonoInterface.MultiAnimation.$ctor1(Bridge.fn.bind(this, function () {
                            this.lblMainOld.Show();
                        }), Bridge.fn.bind(this, function () {
                            this.lblMainOld.Hide();
                        }), [new MonoInterface.NumberAnimation("X", 0, 50, 5, void 0, void 0, this.lblMainOld), new MonoInterface.NumberAnimation("Alpha", 1.0, 0, -0.1, void 0, void 0, this.lblMainOld)])).Begin();
                        this.Animator.AddChild(MonoInterface.MultiAnimation, new MonoInterface.MultiAnimation.ctor([new MonoInterface.NumberAnimation("X", -50, 0, 5, void 0, void 0, this.lblMain), new MonoInterface.NumberAnimation("Alpha", 0, 1.0, 0.1, void 0, void 0, this.lblMain)])).Begin();
                    }
                }
            },
            ApplyTheme: function (currentTheme) {
                var $t, $t1, $t2, $t3, $t4, $t5, $t6, $t7;
                this.CurrentTheme = currentTheme;
                var btnLeft = this.AddChild(MonoInterface.Button, new MonoInterface.Button.ctor(Bridge.fn.cacheBind(this, this.btnLeftClicked), Microsoft.Xna.Framework.Input.Keys.Left, 0, 0, 45, 30, 0.0, 0.5, true));
                btnLeft.AddChild(MonoInterface.Picture, new MonoInterface.Picture(this.CurrentTheme.SwitcherButtonLeftTexture.$clone(), 0, 0, 45, 45, 0.5, 0.5, true));
                btnLeft.BackTexture = currentTheme.EmptyTexture.$clone();
                var btnRight = this.AddChild(MonoInterface.Button, new MonoInterface.Button.ctor(Bridge.fn.cacheBind(this, this.btnRightClicked), Microsoft.Xna.Framework.Input.Keys.Right, 0, 0, 45, 30, 1.0, 0.5, true));
                btnRight.AddChild(MonoInterface.Picture, new MonoInterface.Picture(this.CurrentTheme.SwitcherButtonRightTexture.$clone(), 0, 0, 45, 45, 0.5, 0.5, true));
                btnRight.BackTexture = currentTheme.EmptyTexture.$clone();
                if (this.Pictures != null) {
                    this.pctMain = this.AddChild(MonoInterface.Picture, new MonoInterface.Picture(($t = this.Pictures)[this.Current].$clone()));
                    this.pctMainOld = this.AddChild(MonoInterface.Picture, new MonoInterface.Picture(($t1 = this.Pictures)[this.Current].$clone(), 0, 0, 0, 0, 0.5, 0.5, false));
                    if (this.Titles != null) {
                        this.lblMain = this.AddChild(MonoInterface.Label, new MonoInterface.Label(($t2 = this.Titles)[this.Current], this.CurrentTheme.SwitcherMainFontSize, this.CurrentTheme.SwitcherMainColor.$clone(), 0, ((((Bridge.Int.div(((-this.H) | 0), 2)) | 0) - 20) | 0), 0.5, 1.0, true));
                        this.lblMainOld = this.AddChild(MonoInterface.Label, new MonoInterface.Label(($t3 = this.Titles)[this.Current], this.CurrentTheme.SwitcherMainFontSize, this.CurrentTheme.SwitcherMainColor.$clone(), 0, ((((Bridge.Int.div(((-this.H) | 0), 2)) | 0) - 20) | 0), 0.5, 1.0, false));
                    }
                    if (this.Descriptions != null) {
                        this.lblDesc = this.AddChild(MonoInterface.LongLabel, new MonoInterface.LongLabel(($t4 = this.Descriptions)[this.Current], this.CurrentTheme.SwitcherDescriptionFontSize, this.CurrentTheme.SwitcherDescriptionColor.$clone(), 0, ((((Bridge.Int.div(this.H, 2)) | 0) + 25) | 0), this.W, 0.5, 0.0, true));
                    }
                } else {
                    this.lblMain = this.AddChild(MonoInterface.Label, new MonoInterface.Label(($t5 = this.Titles)[this.Current], this.CurrentTheme.SwitcherMainFontSize, this.CurrentTheme.SwitcherMainColor.$clone()));
                    this.lblMainOld = this.AddChild(MonoInterface.Label, new MonoInterface.Label(($t6 = this.Titles)[this.Current], this.CurrentTheme.SwitcherMainFontSize, this.CurrentTheme.SwitcherMainColor.$clone(), 0, 0, 0.5, 0.5, false));
                    if (this.Descriptions != null) {
                        this.lblDesc = this.AddChild(MonoInterface.LongLabel, new MonoInterface.LongLabel(($t7 = this.Descriptions)[this.Current], this.CurrentTheme.SwitcherDescriptionFontSize, this.CurrentTheme.SwitcherDescriptionColor.$clone(), 0, ((((Bridge.Int.div(this.H, 2)) | 0) + 20) | 0), this.W, 0.5, 0.0, true));
                    }

                }
                MonoInterface.Container.prototype.ApplyTheme.call(this, currentTheme);
            }
        }
    });

    Bridge.define("MonoInterface.Window", {
        inherits: [MonoInterface.Container],
        ctors: {
            ctor: function (x, y, w, h, horAlign, verAlign, visible) {
                if (horAlign === void 0) { horAlign = 0.5; }
                if (verAlign === void 0) { verAlign = 0.5; }
                if (visible === void 0) { visible = true; }

                this.$initialize();
                MonoInterface.Container.ctor.call(this, x, y, w, h, horAlign, verAlign, visible);
            }
        },
        methods: {
            ClickButton: function (key) {
                var btn = this.GetButtonByHotKey(key);
                if (btn != null) {
                    btn.Click(0, 0, false);
                }
            },
            ClickButton$1: function (x, y, isTouch) {
                var fX = { };
                var fY = { };
                var cont = this.GetContainerByPoint(x, y, fX, fY);
                if (cont != null) {
                    cont.Click(fX.v, fY.v, isTouch);
                }
            },
            HighlightButton: function (x, y, mPressed) {
                var fX = { };
                var fY = { };
                var cont = this.GetContainerByPoint(x, y, fX, fY);
                var btn;
                if (((btn = Bridge.as(cont, MonoInterface.Button))) != null) {
                    btn.Focus();
                    if (!btn.IsDisabled) {
                        btn.IsHighlighted = true;

                        if (mPressed) {
                            btn.IsPressed = true;
                        }
                    }
                }
            },
            TapAndHoldButton: function (x, y) {
                var fX = { }, fY = { };
                var cont = this.GetContainerByPoint(x, y, fX, fY);
                var btn;
                if (((btn = Bridge.as(cont, MonoInterface.Button))) != null) {
                    btn.TapAndHold();
                    if (!btn.IsDisabled) {
                        btn.IsPressed = true;
                    }
                }

            },
            Recalc: function () {
                var $t;
                this._finalX = this.X;
                this._finalY = this.Y;
                this._finalW = this.W;
                this._finalH = this.H;
                this._finalChildrenScaleX = this.ChildrenScaleX;
                this._finalChildrenScaleY = this.ChildrenScaleY;
                $t = Bridge.getEnumerator(this.Children);
                try {
                    while ($t.moveNext()) {
                        var child = $t.Current;
                        child.Recalc();
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                this.IsNeedRecalc = false;
            }
        }
    });
});

//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAiZmlsZSI6ICJEYXJrS2luZ2RvbUpTLmpzIiwKICAic291cmNlUm9vdCI6ICIiLAogICJzb3VyY2VzIjogWyIuLi9EYXJrS2luZ2RvbUNvcmUvR2FtZSBsb2dpYy9BYmlsaXR5LmNzIiwiLi4vRGFya0tpbmdkb21Db3JlL0dhbWUgbG9naWMvQWNoaWV2ZW1lbnQuY3MiLCIuLi9EYXJrS2luZ2RvbUNvcmUvR2FtZSBsb2dpYy9BbW1vLmNzIiwiLi4vRGFya0tpbmdkb21Db3JlL1NoYXJlZFRoaW5ncy5jcyIsIi4uL0RhcmtLaW5nZG9tQ29yZS9HYW1lLmNzIiwiLi4vRGFya0tpbmdkb21Db3JlL0ludGVyZmFjZS5jcyIsIi4uL0RhcmtLaW5nZG9tQ29yZS9GaWxlU3lzdGVtLmNzIiwiLi4vRGFya0tpbmdkb21Db3JlL1VuaXRBYmlsaXRlcy5jcyIsIi4uL0RhcmtLaW5nZG9tQ29yZS9HYW1lIGxvZ2ljL1BsYXllci5jcyIsIi4uL0RhcmtLaW5nZG9tQ29yZS9HYW1lIGxvZ2ljL1Byb2ZpbGUuY3MiLCIuLi9EYXJrS2luZ2RvbUNvcmUvR2FtZSBsb2dpYy9QdXJjaGFzZS5jcyIsIi4uL0RhcmtLaW5nZG9tQ29yZS9HYW1lIGxvZ2ljL1JhY2UuY3MiLCIuLi9EYXJrS2luZ2RvbUNvcmUvR2FtZSBsb2dpYy9Vbml0LmNzIiwiQXBwLmNzIiwiLi4vRGFya0tpbmdkb21Db3JlL01haW5DbGFzcy5jcyIsIi4uL01vbm9JbnRlcmZhY2VDb3JlL0FuaW1hdG9yLmNzIiwiLi4vTW9ub0ludGVyZmFjZUNvcmUvU3RydWN0cy5jcyIsIi4uL01vbm9JbnRlcmZhY2VDb3JlL0ludGVyZmFjZS9CbG9jay5jcyIsIi4uL01vbm9JbnRlcmZhY2VDb3JlL0xvY2FsaXphdGlvbi5jcyIsIi4uL01vbm9JbnRlcmZhY2VDb3JlL1Nwcml0ZS5jcyIsIi4uL01vbm9JbnRlcmZhY2VDb3JlL1RoZW1lLmNzIiwiLi4vRGFya0tpbmdkb21Db3JlL1BhcnRpY2xlcy9JbWFnZVBhcnRpY2xlLmNzIiwiLi4vRGFya0tpbmdkb21Db3JlL1BhcnRpY2xlcy9UZXh0UGFydGljbGUuY3MiLCIuLi9Nb25vSW50ZXJmYWNlQ29yZS9JbnRlcmZhY2UvQ29udGFpbmVyLmNzIiwiLi4vTW9ub0ludGVyZmFjZUNvcmUvSW50ZXJmYWNlL0xhYmVsLmNzIiwiLi4vTW9ub0ludGVyZmFjZUNvcmUvSW50ZXJmYWNlL1BpY3R1cmUuY3MiLCIuLi9Nb25vSW50ZXJmYWNlQ29yZS9JbnRlcmZhY2UvUHJvZ3Jlc3MuY3MiLCIuLi9Nb25vSW50ZXJmYWNlQ29yZS9JbnRlcmZhY2UvQnV0dG9uLmNzIiwiLi4vTW9ub0ludGVyZmFjZUNvcmUvSW50ZXJmYWNlL0ZyYW1lLmNzIiwiLi4vTW9ub0ludGVyZmFjZUNvcmUvSW50ZXJmYWNlL0dyaWQuY3MiLCIuLi9Nb25vSW50ZXJmYWNlQ29yZS9JbnRlcmZhY2UvTG9uZ0xhYmVsLmNzIiwiLi4vTW9ub0ludGVyZmFjZUNvcmUvSW50ZXJmYWNlL1N3aXRjaGVyLmNzIiwiLi4vTW9ub0ludGVyZmFjZUNvcmUvSW50ZXJmYWNlL1dpbmRvdy5jcyJdLAogICJuYW1lcyI6IFsiIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OzRCQStCdUJBLEtBQVlBLElBQVFBLEtBQVlBLElBQVFBLEdBQWNBOztnQkFFakVBLFlBQU9BO2dCQUNQQSxhQUFRQTtnQkFDUkEsV0FBTUE7Z0JBQ05BLGlCQUFZQTtnQkFDWkEsZUFBVUE7Z0JBQ1ZBLGNBQVNBO2dCQUNUQSxJQUFJQTtvQkFDQUE7O29CQUVBQTs7Z0JBQ0pBO2dCQUNBQSxnQkFBV0Esc0JBQXNCQSxzQ0FBc0JBLGtCQUFhQTs7Ozs7Ozs7Ozs7Ozs7OzRCQ3BDckRBLEtBQVlBLElBQTZCQTs7Z0JBRXhEQSxZQUFPQTtnQkFDUEEsYUFBUUE7Z0JBQ1JBLGFBQVFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OzhCQ3lCQUEsSUFBUUEsR0FBWUEsSUFBVUEsSUFBVUEsS0FBV0EsS0FBV0EsS0FBV0EsVUFBc0NBLEtBQVVBLEdB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LE9BQU1BLDJDQUFtQkE7b0JBRXJDQTtvQkFDQUEsSUFBSUEsQ0FBQ0E7d0JBQ0RBOzs7Ozs7O2dCQVlSQSxlQUFVQTtnQkFDVkEsZUFBVUE7Z0JBQ1ZBLGVBQVVBO2dCQUNWQSxlQUFVQTtnQkFDVkEsNEJBQXVCQTtnQkFDdkJBLDRCQUF1QkE7Z0JBQ3ZCQSwwQkFBc0JBOzs7O3dCQUNsQkE7Ozs7Ozs7Z0JBQ0pBIiwKICAic291cmNlc0NvbnRlbnQiOiBbInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbXBvbmVudE1vZGVsO1xyXG51c2luZyBOZXd0b25zb2Z0Lkpzb247XHJcblxyXG5uYW1lc3BhY2UgRGFya0tpbmdkb21Db3JlXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBBYmlsaXR5XHJcbiAgICB7XHJcbiAgICAgICAgW0pzb25Qcm9wZXJ0eShcIm5hbWVcIiwgRGVmYXVsdFZhbHVlSGFuZGxpbmcgPSBEZWZhdWx0VmFsdWVIYW5kbGluZy5Qb3B1bGF0ZSldXHJcbiAgICAgICAgW0RlZmF1bHRWYWx1ZShcIlwiKV1cclxuICAgICAgICBwdWJsaWMgc3RyaW5nIG5hbWU7XHJcblxyXG4gICAgICAgIFtKc29uUHJvcGVydHkoXCJ2YWx1ZVwiLCBEZWZhdWx0VmFsdWVIYW5kbGluZyA9IERlZmF1bHRWYWx1ZUhhbmRsaW5nLlBvcHVsYXRlKV1cclxuICAgICAgICBbRGVmYXVsdFZhbHVlKDApXVxyXG4gICAgICAgIHB1YmxpYyBpbnQgdmFsdWU7XHJcblxyXG4gICAgICAgIFtKc29uUHJvcGVydHkoXCJ3aGVuXCIsIERlZmF1bHRWYWx1ZUhhbmRsaW5nID0gRGVmYXVsdFZhbHVlSGFuZGxpbmcuUG9wdWxhdGUpXVxyXG4gICAgICAgIFtEZWZhdWx0VmFsdWUoXCJcIildXHJcbiAgICAgICAgcHVibGljIHN0cmluZyBjb25kaXRpb247XHJcblxyXG4gICAgICAgIFtKc29uUHJvcGVydHkoXCJ3aGVuVmFsdWVcIildXHJcbiAgICAgICAgcHVibGljIGludCBjb25kbnVtO1xyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBjb25kQ29tcGxldGVkO1xyXG4gICAgICAgIHB1YmxpYyBFZmZlY3RUeXBlIHR5cDtcclxuXHJcbiAgICAgICAgW0pzb25Qcm9wZXJ0eShcImhpZGRlblwiKV1cclxuICAgICAgICBwdWJsaWMgYm9vbCBoaWRkZW47XHJcbiAgICAgICAgcHVibGljIGJvb2wgdXNlZDtcclxuICAgICAgICBwdWJsaWMgYm9vbCBsb25nVGltZTtcclxuXHJcbiAgICAgICAgcHVibGljIEFiaWxpdHkoc3RyaW5nIG5tZSwgaW50IG5tLCBzdHJpbmcgY29uLCBpbnQgY24sIEVmZmVjdFR5cGUgdCwgYm9vbCBoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbmFtZSA9IG5tZTtcclxuICAgICAgICAgICAgdmFsdWUgPSBubTtcclxuICAgICAgICAgICAgdHlwID0gdDtcclxuICAgICAgICAgICAgY29uZGl0aW9uID0gY29uO1xyXG4gICAgICAgICAgICBjb25kbnVtID0gY247XHJcbiAgICAgICAgICAgIGhpZGRlbiA9IGg7XHJcbiAgICAgICAgICAgIGlmIChjb25kaXRpb24gIT0gXCJcIilcclxuICAgICAgICAgICAgICAgIGNvbmRDb21wbGV0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgY29uZENvbXBsZXRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIHVzZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgbG9uZ1RpbWUgPSBBcnJheS5JbmRleE9mPHN0cmluZz4oTXlHYW1lLmxvbmdUaW1lQ29uZHMsIGNvbmRpdGlvbikgPiAtMTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwibmFtZXNwYWNlIERhcmtLaW5nZG9tQ29yZVxyXG57XHJcbiAgICBjbGFzcyBBY2hpZXZlbWVudFxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgbmFtZTtcclxuICAgICAgICBwdWJsaWMgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlIHVJY29uO1xyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgYm9vdHk7XHJcblxyXG4gICAgICAgIHB1YmxpYyBBY2hpZXZlbWVudChzdHJpbmcgbmFtLCBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2UgdWksIHN0cmluZyBib3R5KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbmFtZSA9IG5hbTtcclxuICAgICAgICAgICAgdUljb24gPSB1aTtcclxuICAgICAgICAgICAgYm9vdHkgPSBib3R5O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtO1xyXG5cclxubmFtZXNwYWNlIERhcmtLaW5nZG9tQ29yZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgQW1tb1xyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBlbnVtIEFtbW9UeXBlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBOb25lLFxyXG4gICAgICAgICAgICBBcnJvdyxcclxuICAgICAgICAgICAgQmlnQXJyb3csXHJcbiAgICAgICAgICAgIEJvbWIsXHJcbiAgICAgICAgICAgIEJsdWVCYWxsLFxyXG4gICAgICAgICAgICBSZWRCYWxsLFxyXG4gICAgICAgICAgICBWaW9sZXRCYWxsLFxyXG4gICAgICAgICAgICBHcmVlbkJhbGwsXHJcbiAgICAgICAgICAgIEJ1bGxldCxcclxuICAgICAgICAgICAgRmFzdEFycm93LFxyXG4gICAgICAgICAgICBIYW1tZXJcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBmbG9hdCB4LCB5O1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCB2eCwgdnk7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IGF5O1xyXG4gICAgICAgIHB1YmxpYyBBbW1vVHlwZSB0eXBlO1xyXG4gICAgICAgIHB1YmxpYyBVbml0IHRhcmdldDtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgZG1nO1xyXG4gICAgICAgIHB1YmxpYyBib29sIGlnbm9yZUFybW9yO1xyXG4gICAgICAgIHB1YmxpYyBib29sIGFnaWw7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IGxpZmV0aW1lO1xyXG4gICAgICAgIHB1YmxpYyBib29sIHN0b2NrID0gZmFsc2U7XHJcbiAgICAgICAgcHVibGljIGludCBwbHI7XHJcbiAgICAgICAgcHVibGljIFVuaXQgb3duZXI7XHJcbiAgICAgICAgcHVibGljIGludCBpbWc7XHJcbiAgICAgICAgcHVibGljIGJvb2wgZXhwbG9zaXZlO1xyXG5cclxuICAgICAgICBwdWJsaWMgQW1tbyhpbnQgcGwsIEFtbW9UeXBlIHQsIGZsb2F0IHh4LCBmbG9hdCB5eSwgZmxvYXQgdnh4LCBmbG9hdCB2eXksIGZsb2F0IGF5eSwgRGljdGlvbmFyeTxzdHJpbmcsIEFiaWxpdHk+IG93bmFiaWxzLCBVbml0IHRyZywgZmxvYXQgZCwgYm9vbCBpYSwgYm9vbCBhZywgZmxvYXQgbHRpbWUsIGJvb2wgZXhwID0gZmFsc2UpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB4ID0geHg7XHJcbiAgICAgICAgICAgIHkgPSB5eTtcclxuICAgICAgICAgICAgdnggPSB2eHg7XHJcbiAgICAgICAgICAgIHZ5ID0gdnl5O1xyXG4gICAgICAgICAgICBheSA9IGF5eTtcclxuICAgICAgICAgICAgdGFyZ2V0ID0gdHJnO1xyXG4gICAgICAgICAgICB0eXBlID0gdDtcclxuICAgICAgICAgICAgZG1nID0gZDtcclxuICAgICAgICAgICAgaWdub3JlQXJtb3IgPSBpYTtcclxuICAgICAgICAgICAgYWdpbCA9IGFnO1xyXG4gICAgICAgICAgICBsaWZldGltZSA9IGx0aW1lO1xyXG4gICAgICAgICAgICBwbHIgPSBwbDtcclxuICAgICAgICAgICAgZXhwbG9zaXZlID0gZXhwO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBBbW1vKGludCBwbCwgQW1tb1R5cGUgdCwgZmxvYXQgeHgsIGZsb2F0IHl5LCBVbml0IG93biwgVW5pdCB0cmcsIGZsb2F0IGQsIGJvb2wgaWEsIGJvb2wgYWcsIGZsb2F0IGx0aW1lLCBib29sIGV4cCA9IGZhbHNlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZmxvYXQgdHQ7XHJcbiAgICAgICAgICAgIGZsb2F0IGEgPSAwLjFmO1xyXG4gICAgICAgICAgICBwbHIgPSBwbDtcclxuICAgICAgICAgICAgc3dpdGNoICh0KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIEFtbW8uQW1tb1R5cGUuQXJyb3c6XHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2eCA9IDQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlIEFtbW8uQW1tb1R5cGUuQmlnQXJyb3c6XHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2eCA9IDI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlIEFtbW8uQW1tb1R5cGUuQm9tYjpcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZ4ID0gMS41ZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW1nID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgQW1tby5BbW1vVHlwZS5CbHVlQmFsbDpcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZ4ID0gMztcclxuICAgICAgICAgICAgICAgICAgICAgICAgYSA9IDAuMDNmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWcgPSAyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSBBbW1vLkFtbW9UeXBlLlJlZEJhbGw6XHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2eCA9IDM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGEgPSAwLjAzZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW1nID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgQW1tby5BbW1vVHlwZS5WaW9sZXRCYWxsOlxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdnggPSAzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhID0gMC4wM2Y7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGltZyA9IDM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlIEFtbW9UeXBlLkdyZWVuQmFsbDpcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZ4ID0gMztcclxuICAgICAgICAgICAgICAgICAgICAgICAgYSA9IDAuMDNmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWcgPSA1O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSBBbW1vLkFtbW9UeXBlLkZhc3RBcnJvdzpcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZ4ID0gNDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgQW1tby5BbW1vVHlwZS5CdWxsZXQ6XHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdnggPSA2O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWcgPSA2O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSBBbW1vVHlwZS5IYW1tZXI6XHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2eCA9IDEuNWY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGltZyA9IDQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBleHBsb3NpdmUgPSBleHA7XHJcbiAgICAgICAgICAgIHggPSB4eDtcclxuICAgICAgICAgICAgeSA9IHl5O1xyXG4gICAgICAgICAgICB2eCAqPSBNYXRoLlNpZ24odHJnLnggLSB4eCk7XHJcbiAgICAgICAgICAgIG93bmVyID0gb3duO1xyXG4gICAgICAgICAgICB0YXJnZXQgPSB0cmc7XHJcbiAgICAgICAgICAgIHR5cGUgPSB0O1xyXG4gICAgICAgICAgICBkbWcgPSBkO1xyXG4gICAgICAgICAgICBpZ25vcmVBcm1vciA9IGlhO1xyXG4gICAgICAgICAgICBhZ2lsID0gYWc7XHJcbiAgICAgICAgICAgIGxpZmV0aW1lID0gbHRpbWU7XHJcbiAgICAgICAgICAgIGlmICh0cmcueCAhPSB4eClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdHQgPSAodHJnLnggLSB4eCkgLyB2eDtcclxuICAgICAgICAgICAgICAgIHZ5ID0gKE15R2FtZS5ob3IgKyB0cmcucGFyYW1ldGVycy5yZWN0LlRvcCArIDE1IC0geXkpIC8gdHQgLSBhICogdHQgLyAyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHZ5ID0gLTE7XHJcbiAgICAgICAgICAgIGF5ID0gYTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbTtcclxudXNpbmcgTWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuR3JhcGhpY3M7XHJcbnVzaW5nIE1pY3Jvc29mdC5YbmEuRnJhbWV3b3JrO1xyXG51c2luZyBOZXd0b25zb2Z0Lkpzb247XHJcbnVzaW5nIFN5c3RlbS5Db21wb25lbnRNb2RlbDtcclxuXHJcbm5hbWVzcGFjZSBEYXJrS2luZ2RvbUNvcmVcclxue1xyXG4gICAgcHVibGljIGVudW0gUGFyVHlwZVxyXG4gICAge1xyXG4gICAgICAgIFBvaW50LFxyXG4gICAgICAgIFRleHQsXHJcbiAgICAgICAgSW1hZ2VcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZW51bSBHYW1lU3RhdGVcclxuICAgIHtcclxuICAgICAgICBNYWluTWVudSxcclxuICAgICAgICBQcmVQbGF5LFxyXG4gICAgICAgIEluR2FtZSxcclxuICAgICAgICBXaW4sXHJcbiAgICAgICAgTG9zZVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBlbnVtIEdhbWVUeXBlXHJcbiAgICB7XHJcbiAgICAgICAgUmFuZG9tR1QsXHJcbiAgICAgICAgU3RhbmRhcnRHVCxcclxuICAgICAgICBPZmZlbmNlR1QsXHJcbiAgICAgICAgRGVmZW5jZUdULFxyXG4gICAgICAgIEZpcnN0SGVyb0dUXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGVudW0gVW5pdE1vdmVUeXBlXHJcbiAgICB7XHJcbiAgICAgICAgR3JvdW5kTVQsXHJcbiAgICAgICAgRmx5aW5nTVQsXHJcbiAgICAgICAgSHVnZU1UXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGVudW0gTGFuZHNjYXBlVHlwZVxyXG4gICAge1xyXG4gICAgICAgIFBsYWluTFMsXHJcbiAgICAgICAgRGVzZXJ0TFMsXHJcbiAgICAgICAgU3dhbXBMUyxcclxuICAgICAgICBEZWF0aGxhbmRMUyxcclxuICAgICAgICBNZWNoYW5pY3NMUyxcclxuICAgICAgICBGb3Jlc3RMUyxcclxuICAgICAgICBJbmZlcm5vTFNcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZW51bSBFZmZlY3RUeXBlXHJcbiAgICB7XHJcbiAgICAgICAgTm9ybWFsLFxyXG4gICAgICAgIEJhZCxcclxuICAgICAgICBQb2lzb24sXHJcbiAgICAgICAgR29vZFxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdHJ1Y3QgVGltZUNvc3RcclxuICAgIHtcclxuICAgICAgICBbSnNvblByb3BlcnR5KFwibW9uZXlcIildXHJcbiAgICAgICAgcHVibGljIGludCBNb25leTtcclxuXHJcbiAgICAgICAgW0pzb25Qcm9wZXJ0eShcImRlYXRoXCIpXVxyXG4gICAgICAgIHB1YmxpYyBpbnQgRGVhdGg7XHJcblxyXG4gICAgICAgIFtKc29uUHJvcGVydHkoXCJ0aW1lXCIpXVxyXG4gICAgICAgIHB1YmxpYyBpbnQgVGltZTtcclxuXHJcbiAgICAgICAgW0pzb25Qcm9wZXJ0eShcInRpZXJcIiwgRGVmYXVsdFZhbHVlSGFuZGxpbmcgPSBEZWZhdWx0VmFsdWVIYW5kbGluZy5Qb3B1bGF0ZSldXHJcbiAgICAgICAgW0RlZmF1bHRWYWx1ZSgxKV1cclxuICAgICAgICBwdWJsaWMgaW50IFRpZXI7XHJcblxyXG4gICAgICAgIHB1YmxpYyBUaW1lQ29zdChpbnQgbW9uZXksIGludCBkZWF0aCwgaW50IHRpZXIsIGludCB0aW1lKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgTW9uZXkgPSBtb25leTtcclxuICAgICAgICAgICAgRGVhdGggPSBkZWF0aDtcclxuICAgICAgICAgICAgVGllciA9IHRpZXI7XHJcbiAgICAgICAgICAgIFRpbWUgPSB0aW1lO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBUaW1lQ29zdCBvcGVyYXRvciArKFRpbWVDb3N0IHIxLCBUaW1lQ29zdCByMilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgVGltZUNvc3QocjEuTW9uZXkgKyByMi5Nb25leSwgcjEuRGVhdGggKyByMi5EZWF0aCwgcjEuVGllciwgcjEuVGltZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFRpbWVDb3N0IG9wZXJhdG9yIC0oVGltZUNvc3QgcjEsIFRpbWVDb3N0IHIyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBUaW1lQ29zdChyMS5Nb25leSAtIHIyLk1vbmV5LCByMS5EZWF0aCAtIHIyLkRlYXRoLCByMS5UaWVyLCByMS5UaW1lKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBib29sIEVub3VnaEZvcihUaW1lQ29zdCBjc3QpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gTW9uZXkgPj0gY3N0Lk1vbmV5ICYmIERlYXRoID49IGNzdC5EZWF0aCAmJiBUaWVyID49IGNzdC5UaWVyO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RydWN0IEF0dGFja1xyXG4gICAge1xyXG4gICAgICAgIFtKc29uUHJvcGVydHkoXCJtaW5cIildXHJcbiAgICAgICAgcHVibGljIGludCBNaW5EYW1hZ2U7XHJcblxyXG4gICAgICAgIFtKc29uUHJvcGVydHkoXCJtYXhcIildXHJcbiAgICAgICAgcHVibGljIGludCBNYXhEYW1hZ2U7XHJcblxyXG4gICAgICAgIFtKc29uUHJvcGVydHkoXCJyYW5nZVwiLCBEZWZhdWx0VmFsdWVIYW5kbGluZyA9IERlZmF1bHRWYWx1ZUhhbmRsaW5nLlBvcHVsYXRlKV1cclxuICAgICAgICBbRGVmYXVsdFZhbHVlKDEpXVxyXG4gICAgICAgIHB1YmxpYyBpbnQgUmFuZ2U7XHJcblxyXG4gICAgICAgIFtKc29uUHJvcGVydHkoXCJzcGVlZFwiLCBEZWZhdWx0VmFsdWVIYW5kbGluZyA9IERlZmF1bHRWYWx1ZUhhbmRsaW5nLlBvcHVsYXRlKV1cclxuICAgICAgICBbRGVmYXVsdFZhbHVlKDMwKV1cclxuICAgICAgICBwdWJsaWMgaW50IFNwZWVkO1xyXG5cclxuXHJcbiAgICAgICAgcHVibGljIEF0dGFjayhpbnQgbW5kLCBpbnQgbXhkLCBpbnQgcmFuZ2UsIGludCBzcGVlZClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIE1pbkRhbWFnZSA9IG1uZDtcclxuICAgICAgICAgICAgTWF4RGFtYWdlID0gbXhkO1xyXG4gICAgICAgICAgICBSYW5nZSA9IHJhbmdlO1xyXG4gICAgICAgICAgICBTcGVlZCA9IHNwZWVkO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBBdHRhY2sgb3BlcmF0b3IgKyhBdHRhY2sgYXRrLCBpbnQgdmFsKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBBdHRhY2soYXRrLk1pbkRhbWFnZSArIHZhbCwgYXRrLk1heERhbWFnZSArIHZhbCwgYXRrLlJhbmdlLCBhdGsuU3BlZWQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBBdHRhY2sgb3BlcmF0b3IgLShBdHRhY2sgYXRrLCBpbnQgdmFsKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBBdHRhY2soYXRrLk1pbkRhbWFnZSAtIHZhbCwgYXRrLk1heERhbWFnZSAtIHZhbCwgYXRrLlJhbmdlLCBhdGsuU3BlZWQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBBdHRhY2sgb3BlcmF0b3IgKihBdHRhY2sgYXRrLCBpbnQgdmFsKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBBdHRhY2soYXRrLk1pbkRhbWFnZSAqIHZhbCwgYXRrLk1heERhbWFnZSAqIHZhbCwgYXRrLlJhbmdlLCBhdGsuU3BlZWQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBBdHRhY2sgb3BlcmF0b3IgKyhBdHRhY2sgYXRrMSwgQXR0YWNrIGF0azIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IEF0dGFjayhhdGsxLk1pbkRhbWFnZSArIGF0azIuTWluRGFtYWdlLCBhdGsxLk1heERhbWFnZSArIGF0azIuTWF4RGFtYWdlLCBhdGsxLlJhbmdlICsgYXRrMi5SYW5nZSwgYXRrMS5TcGVlZCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIEF0dGFjayBvcGVyYXRvciAtKEF0dGFjayBhdGsxLCBBdHRhY2sgYXRrMilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgQXR0YWNrKGF0azEuTWluRGFtYWdlIC0gYXRrMi5NaW5EYW1hZ2UsIGF0azEuTWF4RGFtYWdlIC0gYXRrMi5NYXhEYW1hZ2UsIGF0azEuUmFuZ2UgLSBhdGsyLlJhbmdlLCBhdGsxLlNwZWVkKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0cnVjdCBNYXRjaENvbmRpdGlvblxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgbmFtZTtcclxuICAgICAgICBwdWJsaWMgVGltZUNvc3QgcmVzMSwgcmVzMjtcclxuICAgICAgICBwdWJsaWMgaW50IGluY29tZSwgaXB0O1xyXG5cclxuICAgICAgICBwdWJsaWMgTWF0Y2hDb25kaXRpb24oc3RyaW5nIG5tZSwgVGltZUNvc3QgcjEsIFRpbWVDb3N0IHIyLCBpbnQgaW5jLCBpbnQgaXApXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBuYW1lID0gbm1lO1xyXG4gICAgICAgICAgICByZXMxID0gcjE7XHJcbiAgICAgICAgICAgIHJlczIgPSByMjtcclxuICAgICAgICAgICAgaW5jb21lID0gaW5jO1xyXG4gICAgICAgICAgICBpcHQgPSBpcDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcGFydGlhbCBjbGFzcyBNeUdhbWVcclxuICAgIHtcclxuXHJcbiAgICAgICAgLy8gUHVibGljIFNoYXJlZCByZXNNYW4gQXMgTmV3IFN5c3RlbS5SZXNvdXJjZXMuUmVzb3VyY2VNYW5hZ2VyKFwiRGFya0tpbmdkb21Db3JlLnJlc291cmNlc1wiLCBTeXN0ZW0uUmVmbGVjdGlvbi5Bc3NlbWJseS4pXHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFJhbmRvbSBybmQgPSBuZXcgUmFuZG9tKCk7XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgaW50IGdhbWVXaWR0aCA9IDgwMDtcclxuICAgICAgICBwdWJsaWMgc3RhdGljIGludCBnYW1lSGVpZ2h0ID0gNDgwO1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgaW50IGhvcjtcclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBEaWN0aW9uYXJ5PHN0cmluZywgVW5pdFBhcmFtZXRlcnM+IHVuaXRQcm1zID0gbmV3IERpY3Rpb25hcnk8c3RyaW5nLCBVbml0UGFyYW1ldGVycz4oKTtcclxuICAgICAgICBwdWJsaWMgc3RhdGljIERpY3Rpb25hcnk8c3RyaW5nLCBNb25vSW50ZXJmYWNlLlNwcml0ZT4gc3ByaXRlcyA9IG5ldyBEaWN0aW9uYXJ5PHN0cmluZywgTW9ub0ludGVyZmFjZS5TcHJpdGU+KCk7XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgTGlzdDxzdHJpbmc+IGFsbEFiaWxzID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgTGlzdDxzdHJpbmc+IGFsbENvbmRzID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFBsYXllcltdIHBscnMgPSBuZXcgUGxheWVyWzJdO1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgTGlzdDxVbml0PiB1bml0cyA9IG5ldyBMaXN0PFVuaXQ+KCk7XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgR2FtZVN0YXRlIGdTdGF0ZTtcclxuXHJcblxyXG4gICAgICAgIC8vINCn0LDRgdGC0LjRhtGLXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBMaXN0PFBhcnRpY2xlPiBwYXJzID0gbmV3IExpc3Q8UGFydGljbGU+KCk7XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBMaXN0PFBhcnRpY2xlPiB1aXBhcnMgPSBuZXcgTGlzdDxQYXJ0aWNsZT4oKTtcclxuICAgICAgICBwdWJsaWMgc3RhdGljIExpc3Q8SW1hZ2VQYXJ0aWNsZT4gY2xvdWRwYXJzID0gbmV3IExpc3Q8SW1hZ2VQYXJ0aWNsZT4oKTtcclxuICAgICAgICBwdWJsaWMgc3RhdGljIExpc3Q8SW1hZ2VQYXJ0aWNsZT4gYmFja3BhcnMgPSBuZXcgTGlzdDxJbWFnZVBhcnRpY2xlPigpO1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgTGlzdDxJbWFnZVBhcnRpY2xlPiBidXNocGFycyA9IG5ldyBMaXN0PEltYWdlUGFydGljbGU+KCk7XHJcblxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmdbXSBsb25nVGltZUNvbmRzID0gbmV3W10geyBcIlRpZXJcIiwgXCJNYWNoaW5lIGFybXlcIiB9O1xyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFRleHR1cmUyRCBmcm1GaWxsVGV4O1xyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFRleHR1cmUyRCBidG5GaWxsVGV4O1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVGV4dHVyZTJEIGJ0blNlbGVjdFRleDtcclxuICAgICAgICBwdWJsaWMgc3RhdGljIFRleHR1cmUyRCBidG5IbFRleDtcclxuICAgICAgICBwdWJsaWMgc3RhdGljIFRleHR1cmUyRCBidG5QcmVzc2VkVGV4O1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVGV4dHVyZTJEIGJ0bkRpc2FibGVkVGV4O1xyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFRleHR1cmUyRCBwcmdGaWxsVGV4O1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVGV4dHVyZTJEIHByZ0JhclRleDtcclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBDb2xvciBobGJ0bmNvbG9yID0gQ29sb3IuV2hpdGVTbW9rZTtcclxuICAgICAgICBwdWJsaWMgc3RhdGljIENvbG9yIGRpc2J0bmJydXNoID0gbmV3IENvbG9yKDEyMCwgNzUsIDc1LCA3NSk7XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBGaWxsUmVjdGFuZ2xlKFNwcml0ZUJhdGNoIHNiLCBUZXh0dXJlMkQgdGV4LCBpbnQgeCwgaW50IHksIGludCB3LCBpbnQgaClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHNiLkRyYXcodGV4LCBuZXcgUmVjdGFuZ2xlKHgsIHksIHcsIGgpLCBDb2xvci5XaGl0ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgRmlsbFJlY3RhbmdsZShTcHJpdGVCYXRjaCBzYiwgVGV4dHVyZTJEIHRleCwgUmVjdGFuZ2xlIHJlY3QpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBzYi5EcmF3KHRleCwgbmV3IFJlY3RhbmdsZShyZWN0LlgsIHJlY3QuWSwgcmVjdC5XaWR0aCwgcmVjdC5IZWlnaHQpLCBDb2xvci5XaGl0ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIE1pY3Jvc29mdC5YbmEuRnJhbWV3b3JrO1xyXG51c2luZyBNaWNyb3NvZnQuWG5hLkZyYW1ld29yay5HcmFwaGljcztcclxudXNpbmcgTWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuSW5wdXQ7XHJcbnVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzO1xyXG5cclxubmFtZXNwYWNlIERhcmtLaW5nZG9tQ29yZSB7XHJcbiAgICAvLy8gPHN1bW1hcnk+XHJcblxyXG4gICAgLy8vIFRoaXMgaXMgdGhlIG1haW4gdHlwZSBmb3IgeW91ciBnYW1lXHJcblxyXG4gICAgLy8vIDwvc3VtbWFyeT5cclxuICAgIHB1YmxpYyBwYXJ0aWFsIGNsYXNzIE15R2FtZSB7XHJcbiAgICAgICAgcHVibGljIEdyYXBoaWNzRGV2aWNlTWFuYWdlciBncmFwaGljcyB7IGdldDsgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIFNwcml0ZUJhdGNoIHNwcml0ZUJhdGNoIHsgZ2V0OyBzZXQ7IH1cclxuXHJcbiAgICAgICAgcHVibGljIExpc3Q8U3lzdGVtLlZhbHVlVHVwbGU8aW50ICxTcHJpdGVGb250ID4+IEZvbnRzO1xyXG5cclxuICAgICAgICBwdWJsaWMgTW9ub0ludGVyZmFjZS5Mb2NhbGl6YXRpb24gbG9jYWxpemU7XHJcblxyXG4gICAgICAgIHByaXZhdGUgTW91c2VTdGF0ZSBvbGRNb3VzZVN0YXRlO1xyXG5cclxuICAgICAgICBwdWJsaWMgc3RyaW5nIFBsYXRmb3JtIHsgZ2V0OyBzZXQ7IH1cclxuICAgICAgICBwdWJsaWMgYm9vbCBpc0xvYWRlZCA9IGZhbHNlO1xyXG5cclxuICAgICAgICBwdWJsaWMgTXlHYW1lKHN0cmluZyBwbGF0Zm9ybSkgOiBiYXNlKCkge1xyXG4gICAgICAgICAgICB0aGlzLlBsYXRmb3JtID0gcGxhdGZvcm07XHJcbiAgICAgICAgICAgIEZvbnRzID0gbmV3IExpc3Q8U3lzdGVtLlZhbHVlVHVwbGU8aW50ICxTcHJpdGVGb250ID4+KCk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgRXhwbG9kZShVbml0IHUsIGJvb2wgaWdub3JlQXJtb3IpIHtcclxuICAgICAgICAgICAgaW50IGJvbnVzID0gMTtcclxuICAgICAgICAgICAgZm9yZWFjaCAoVW5pdCB1dSBpbiB1bml0cykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHV1LkFic0NvbnRhaW5zKFwiRXhwbG9kZV9ib251c1wiKSlcclxuICAgICAgICAgICAgICAgICAgICBib251cyAqPSAzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKFVuaXQgdXUgaW4gdW5pdHMpIHtcclxuICAgICAgICAgICAgICAgIGlmICh1Lk5lYXIodXUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF1dS5BYnNDb250YWlucyhcIkV4cGxvZGVfcHJvdGVjdFwiKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgSGFybSh1dSwgcm5kLk5leHQoNzAsIDEwMSkgKiBib251cywgaWdub3JlQXJtb3IsIEVmZmVjdFR5cGUuTm9ybWFsKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoaWdub3JlQXJtb3IpXHJcbiAgICAgICAgICAgICAgICBwYXJzLkFkZChuZXcgSW1hZ2VQYXJ0aWNsZShuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJleHBsb2RlXCJdLCAzKSwgdS54IC0gMjUsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LkJvdHRvbSAtIHVzMiAtIDI1LCAwLCAwLCAyMCkpO1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICBwYXJzLkFkZChuZXcgSW1hZ2VQYXJ0aWNsZShuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJleHBsb2RlXCJdLCAwKSwgdS54IC0gMjUsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LkJvdHRvbSAtIHVzMiAtIDI1LCAwLCAwLCAyMCkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgSGVhbChVbml0IHUsIGZsb2F0IHZhbCwgYm9vbCByZXBhaXIgPSBmYWxzZSkge1xyXG4gICAgICAgICAgICBpZiAodS5ocCA8IHUucGFyYW1ldGVycy5tYXhocCAmJiAhdS5BYnNDb250YWlucyhcIkJvZHlsZXNzXCIsIFwiTm9uaGVhbGluZ193b3VuZHNcIiwgXCJCdWlsZGluZ1wiKSAmJiAoIXUuQWJzQ29udGFpbnMoXCJNYWNoaW5lcnlcIikgfHwgcmVwYWlyKSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlYWx2YWwgPSBNYXRoLk1pbih2YWwsIHUucGFyYW1ldGVycy5tYXhocCAtIHUuaHApO1xyXG4gICAgICAgICAgICAgICAgdS5ocCArPSByZWFsdmFsO1xyXG4gICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoc3RyaW5nLkZvcm1hdChcIit7MH1cIixyZWFsdmFsKSwgZ29vZEFiaWxDbHIsIHUueCwgaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuVG9wLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXJlcGFpciAmJiB1LkFic0NvbnRhaW5zKFwiTGlmZV9yb2xsYmFja1wiKSlcclxuICAgICAgICAgICAgICAgICAgICB1LkF0dGFjayArPSB1LmFiaWxzW1wiTGlmZV9yb2xsYmFja1wiXS52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgSGFybShVbml0IHUsIGZsb2F0IHZhbCwgYm9vbCBpZ25vcmVhcm1vciwgRWZmZWN0VHlwZSBkdCkge1xyXG4gICAgICAgICAgICBpZiAoIXUuQWJzQ29udGFpbnMoXCJJbnZ1bG5lcmFibGVcIikpIHtcclxuICAgICAgICAgICAgICAgIGlmICghaWdub3JlYXJtb3IpXHJcbiAgICAgICAgICAgICAgICAgICAgdmFsICo9IHUucGFyYW1ldGVycy5fYXJtb3I7XHJcbiAgICAgICAgICAgICAgICBpZiAodmFsIDwgMSlcclxuICAgICAgICAgICAgICAgICAgICB2YWwgPSAxO1xyXG4gICAgICAgICAgICAgICAgdS5ocCAtPSB2YWw7XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGR0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBFZmZlY3RUeXBlLk5vcm1hbDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCItXCIgKyB2YWwuVG9TdHJpbmcoKSwgQ29sb3IuUmVkLCB1LngsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LlRvcCwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBFZmZlY3RUeXBlLkJhZDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCItXCIgKyB2YWwuVG9TdHJpbmcoKSwgYmFkQWJpbENsciwgdS54LCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Ub3AsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgRWZmZWN0VHlwZS5Qb2lzb246IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwiLVwiICsgdmFsLlRvU3RyaW5nKCksIHBvaUFiaWxDbHIsIHUueCwgaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuVG9wLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHUuQWJzQ29udGFpbnMoXCJJbnZpc2libGVcIikpXHJcbiAgICAgICAgICAgICAgICAgICAgRGVpbnZpc2libGUodSk7XHJcbiAgICAgICAgICAgICAgICBmb3JlYWNoIChBYmlsaXR5IGEgaW4gdS5hYmlscy5WYWx1ZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYS5jb25kaXRpb24gPT0gXCJPbl9oYXJtXCIgJiYgIWEudXNlZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgYS5jb25kQ29tcGxldGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh1LkFic0NvbnRhaW5zKFwiRGFtYWdlX21pcnJvclwiKSAmJiBwbHJzWzEgLSB1Lm93bmVyXS5oZXJvVW5pdCAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIEhhcm0ocGxyc1sxIC0gdS5vd25lcl0uaGVyb1VuaXQsIHZhbCwgdHJ1ZSwgRWZmZWN0VHlwZS5CYWQpO1xyXG4gICAgICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwiMFwiLCBnb29kQWJpbENsciwgdS54LCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Ub3AsIGZhbHNlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIERlaW52aXNpYmxlKFVuaXQgdSkge1xyXG4gICAgICAgICAgICB1LmFiaWxzW1wiSW52aXNpYmxlXCJdLnVzZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBwYXJzLkFkZChuZXcgSW1hZ2VQYXJ0aWNsZShuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJleHBsb2RlXCJdLCAyKSwgdS54IC0gMjUsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LkJvdHRvbSAtIHVzMiAtIDI1LCAwLCAwLCAyMCkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBzdHJpbmcgbGFuZEJtcDtcclxuICAgICAgICBwdWJsaWMgaW50IGN1clByb2ZpbGU7XHJcblxyXG5cclxuXHJcblxyXG5cclxuICAgICAgICBwcml2YXRlIGZsb2F0IHN1bkFuZywgZEFuZztcclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgU2V0UGxheWVycygpIHtcclxuICAgICAgICAgICAgcGxyc1swXSA9IG5ldyBQbGF5ZXIodGhpcywgMCwgZmFsc2UsIDMwKTtcclxuICAgICAgICAgICAgcGxyc1sxXSA9IG5ldyBQbGF5ZXIodGhpcywgMSwgdHJ1ZSwgMzApO1xyXG5cclxuICAgICAgICAgICAgcGxyc1swXS5tb3Zlc2lkZSA9IDE7XHJcbiAgICAgICAgICAgIHBscnNbMV0ubW92ZXNpZGUgPSAtMTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBVcGRhdGVRdWV1ZSgpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPD0gNjsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBNb25vSW50ZXJmYWNlLkJ1dHRvbiBidG4gPSBidG5zUHJvZHVjdGlvbltpXTtcclxuICAgICAgICAgICAgICAgIGlmIChpIDwgcGxyc1swXS5yZWFkeVVuaXRzLkNvdW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYnRuLlZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIChidG4uQ2hpbGRyZW5bMF0gYXMgTW9ub0ludGVyZmFjZS5QaWN0dXJlKS5zcHJpdGVSZWYgPSB1bml0UHJtc1twbHJzWzBdLnJlYWR5VW5pdHNbaV1dLmljb25BcHA7XHJcbiAgICAgICAgICAgICAgICAgICAgYnRuLkNoaWxkcmVuWzFdLlZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHByZ3NQcm9kdWN0aW9uW2ldLkN1cnJlbnRWYWx1ZSA9IDA7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGkgLSBwbHJzWzBdLnJlYWR5VW5pdHMuQ291bnQgPCBwbHJzWzBdLnByZFEuQ291bnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBidG4uVmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgYnRuLkNoaWxkcmVuWzFdLlZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAoYnRuLkNoaWxkcmVuWzBdIGFzIE1vbm9JbnRlcmZhY2UuUGljdHVyZSkuc3ByaXRlUmVmID0gdW5pdFBybXNbcGxyc1swXS5wcmRRW2kgLSBwbHJzWzBdLnJlYWR5VW5pdHMuQ291bnRdXS5pY29uQXBwO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpID09IHBscnNbMF0ucmVhZHlVbml0cy5Db3VudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcmdzUHJvZHVjdGlvbltpXS5DdXJyZW50VmFsdWUgPSBwbHJzWzBdLnByZFByZztcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJnc1Byb2R1Y3Rpb25baV0uTWF4VmFsdWUgPSB1bml0UHJtc1twbHJzWzBdLnByZFFbMF1dLkNvc3QuVGltZTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJnc1Byb2R1Y3Rpb25baV0uQ3VycmVudFZhbHVlID0gMDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIGJ0bi5WaXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHBscnNbMF0ucHJkUS5Db3VudCA9PSAwICYmIHBscnNbMF0ucmVhZHlVbml0cy5Db3VudCA9PSAwKVxyXG4gICAgICAgICAgICAgICAgZnJtUHJvZHVjdGlvbi5IaWRlKG1haW5BbmltYXRvcik7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIGZybVByb2R1Y3Rpb24uU2hvdyhtYWluQW5pbWF0b3IpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgVXBkYXRlUmVzb3VyY2VzKCkge1xyXG4gICAgICAgICAgICBsYmxHb2xkRnJtUmVzb3VyY2VzLlRleHQgPSBjdXJNLlRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgIGxibERlYXRoRnJtUmVzb3VyY2VzLlRleHQgPSBjdXJELlRvU3RyaW5nKCk7XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBscnNbMF0udW5pdHNMaXN0LkNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgICAgIChjVW5pdHMuQ2hpbGRyZW5baV0gYXMgTW9ub0ludGVyZmFjZS5CdXR0b24pLklzRGlzYWJsZWQgPSAhcGxyc1swXS5DaGVja0ZvclByb2R1Y2UocGxyc1swXS51bml0c0xpc3RbaV0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzdHJpbmcgdGllciA9IHBscnNbMF0ucmVzLlRpZXIgPT0gMSA/IFwiVGllcl8yXCIgOiBcIlRpZXJfM1wiO1xyXG4gICAgICAgICAgICBidG5UaWVyVXBGcm1SZXNvdXJjZXMuSXNEaXNhYmxlZCA9ICFwbHJzWzBdLnJlcy5Fbm91Z2hGb3IodW5pdFBybXNbdGllcl0uQ29zdCkgfHwgcGxyc1swXS5wcmRRLkNvbnRhaW5zKHRpZXIpIHx8IHBscnNbMF0ucmVzLlRpZXIgPT0gMztcclxuXHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGxyc1swXS5zcGxsc0xpc3QuQ291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgKGNTcGVsbHMuQ2hpbGRyZW5baV0gYXMgTW9ub0ludGVyZmFjZS5CdXR0b24pLklzRGlzYWJsZWQgPSAhcGxyc1swXS5yZXMuRW5vdWdoRm9yKHNwZWxsc1twbHJzWzBdLnNwbGxzTGlzdFtpXV0uQ29zdCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBib29sIE9uRGVhZChVbml0IHUpIHtcclxuICAgICAgICAgICAgZm9yZWFjaCAoQWJpbGl0eSBhIGluIHUuYWJpbHMuVmFsdWVzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYS5jb25kaXRpb24gPT0gXCJPbl9kZWF0aFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIGEuY29uZENvbXBsZXRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgT25Vbml0c0FiaWxzKHUpO1xyXG4gICAgICAgICAgICBpZiAoIXUucGFyYW1ldGVycy5pc0J1aWxkaW5nKSB7XHJcbiAgICAgICAgICAgICAgICBib29sIG5lZWRJbmZvO1xyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAoVW5pdCB1dSBpbiB1bml0cykge1xyXG4gICAgICAgICAgICAgICAgICAgIG5lZWRJbmZvID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHV1ICE9IHUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHV1LkFic0NvbnRhaW5zKFwiRGVhdGhfcmVhcGVyXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dS5BdHRhY2sgKz0gdXUuYWJpbHNbXCJEZWF0aF9yZWFwZXJcIl0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZWVkSW5mbyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoQWJpbGl0eSBhIGluIHV1LmFiaWxzLlZhbHVlcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEuY29uZGl0aW9uID09IFwiRGVhdGhcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuY29uZG51bSAtPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhLmNvbmRudW0gPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmNvbmRpdGlvbiA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuY29uZENvbXBsZXRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5lZWRJbmZvID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodXUuQWJzQ29udGFpbnMoXCJTcGF3bl9naG9zdHNcIikgJiYgIXUuQWJzQ29udGFpbnMoXCJCb2R5bGVzc1wiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IGFsbHVuaXRzdCA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFVuaXQgbnU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChVbml0UGFyYW1ldGVycyB1cCBpbiB1bml0UHJtcy5WYWx1ZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXVwLnNwZWNpYWwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVwLkFic0NvbnRhaW5zKFwiQm9keWxlc3NcIikgJiYgdXAuQ29zdC5UaWVyID09IHUucGFyYW1ldGVycy5Db3N0LlRpZXIgJiYgcGxyc1t1dS5vd25lcl0uQ2hlY2tGb3JMaW1pdCh1cC5OYW1lKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsbHVuaXRzdC5BZGQodXAuTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFsbHVuaXRzdC5Db3VudCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudSA9IG5ldyBVbml0KHRoaXMsIHV1LnggKyB1dS5tb3Zlc2lkZSwgdXUubW92ZXNpZGUsIHV1Lm93bmVyLCB1bml0UHJtc1thbGx1bml0c3Rbcm5kLk5leHQoMCwgYWxsdW5pdHN0LkNvdW50KV1dKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhwID0gcm5kLk5leHQoNzAsIDEwMSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhhcm0odXUsIG51LmhwLCB0cnVlLCBFZmZlY3RUeXBlLkJhZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9ybkxpc3QuQWRkKG51KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZWVkSW5mbyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5lZWRJbmZvKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCLQodC80LXRgNGC0YwhXCIsIGdvb2RBYmlsQ2xyLCB1dS54LCBob3IgKyB1dS5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHV1Lm93bmVyICE9IHUub3duZXIgJiYgdXUuQWJzQ29udGFpbnMoXCJMb290ZXJcIikgJiYgdS5OZWFyKHV1KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwbHJzW3V1Lm93bmVyXS5SZXNvdXJjZXMgKz0gbmV3IFRpbWVDb3N0KHV1LmFiaWxzW1wiTG9vdGVyXCJdLnZhbHVlLCAwLCAwLCAwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoc3RyaW5nLkZvcm1hdChcIit7MH1cIix1dS5hYmlsc1tcIkxvb3RlclwiXS52YWx1ZSksIG1vbmV5Q2xyLCB1dS54LCBob3IgKyB1dS5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHV1Lm93bmVyICE9IHUub3duZXIgJiYgdXUuQWJzQ29udGFpbnMoXCJJbnZpc2libGVfb25fa2lsbFwiKSAmJiB1Lk5lYXIodXUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHV1LkFkZEFiaWxpdHkoXCJJbnZpc2libGVcIiwgRWZmZWN0VHlwZS5Ob3JtYWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCY0YHRh9C10LchXCIsIGdvb2RBYmlsQ2xyLCB1dS54LCBob3IgKyB1dS5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHUub3duZXIgIT0gdXUub3duZXIgJiYgdXUuQWJzQ29udGFpbnMoXCJOZWNyb21hbmN5XCIpICYmICF1LkFic0NvbnRhaW5zKFwiVW5kZWFkXCIsIFwiTWFjaGluZXJ5XCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJvcm5MaXN0LkFkZChuZXcgVW5pdCh0aGlzLCB1LngsIHV1Lm1vdmVzaWRlLCB1dS5vd25lciwgdW5pdFBybXNbXCJTa2VsZXRvbl9zcXVhZFwiXSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCe0LbQuNCy0LvQtdC9IVwiLCBnb29kQWJpbENsciwgdS54LCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodS5kZWF0aEZyb21Qb2lzb24gJiYgdXUuQWJzQ29udGFpbnMoXCJGbGl6YXJkIHNwYXduZXJcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYm9ybkxpc3QuQWRkKG5ldyBVbml0KHRoaXMsIHV1LngsIHV1Lm1vdmVzaWRlLCB1dS5vd25lciwgdW5pdFBybXNbXCJGbGl6YXJkXCJdKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwi0J/QvtGA0L7QttC00LXQvSFcIiwgcG9pQWJpbENsciwgdXUueCwgaG9yICsgdXUucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1dS5vd25lciAhPSB1Lm93bmVyICYmIHV1LkFic0NvbnRhaW5zKFwiQ29ycHNlZWF0aW5nXCIpICYmIHUuTmVhcih1dSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHV1LmhwIDwgdXUucGFyYW1ldGVycy5tYXhocClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhlYWwodXUsIHV1LnBhcmFtZXRlcnMubWF4aHAgLSB1dS5ocCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1dS5BYnNDb250YWlucyhcIkRldm91clwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHV1LmFiaWxzLkNvbnRhaW5zS2V5KFwiRGVueWluZ1wiKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dS5hYmlsc1tcIkRlbnlpbmdcIl0udmFsdWUgPSB1dS5hYmlsc1tcIkRlbnlpbmdcIl0udmFsdWUgKyA1MDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCe0LHQtdC0IVwiLCBnb29kQWJpbENsciwgdXUueCwgaG9yICsgdXUucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1dS5BYnNDb250YWlucyhcIkV4ZWN1dGlvblwiKSAmJiB1Lk5lYXIodXUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBscnNbdXUub3duZXJdLnZpY3RpbWNvdW50ICs9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwbHJzW3V1Lm93bmVyXS52aWN0aW1jb3VudCA+PSAxMykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IGF2dW5pdHMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChVbml0UGFyYW1ldGVycyB1cHN0ciBpbiB1bml0UHJtcy5WYWx1ZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXBzdHIuU3VicmFjZSA9PSBcIk1vbnN0ZXJcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXZ1bml0cy5BZGQodXBzdHIuTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3JuTGlzdC5BZGQobmV3IFVuaXQodGhpcywgdS54LCB1dS5tb3Zlc2lkZSwgdXUub3duZXIsIHVuaXRQcm1zW2F2dW5pdHNbcm5kLk5leHQoYXZ1bml0cy5Db3VudCldXSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxyc1t1dS5vd25lcl0udmljdGltY291bnQgLT0gMTM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCS0YvQt9Cy0LDQvSFcIiwgZ29vZEFiaWxDbHIsIHUueCwgaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihzdHJpbmcuRm9ybWF0KFwi0JXRidC1IHswfVwiLDEzIC0gcGxyc1t1dS5vd25lcl0udmljdGltY291bnQpLCBnb29kQWJpbENsciwgdS54LCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodS5BYnNDb250YWlucyhcIlZpY3RpbVwiKSkge1xyXG4gICAgICAgICAgICAgICAgcGxyc1t1Lm93bmVyXS52aWN0aW1jb3VudCArPSAxO1xyXG4gICAgICAgICAgICAgICAgaWYgKHBscnNbdS5vd25lcl0udmljdGltY291bnQgPj0gMTMpIHtcclxuICAgICAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gYXZ1bml0cyA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChVbml0UGFyYW1ldGVycyB1cHN0ciBpbiB1bml0UHJtcy5WYWx1ZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVwc3RyLlN1YnJhY2UgPT0gXCJNb25zdGVyXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdnVuaXRzLkFkZCh1cHN0ci5OYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYm9ybkxpc3QuQWRkKG5ldyBVbml0KHRoaXMsIHUueCwgdS5tb3Zlc2lkZSwgdS5vd25lciwgdW5pdFBybXNbYXZ1bml0c1tybmQuTmV4dChhdnVuaXRzLkNvdW50KV1dKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcGxyc1t1Lm93bmVyXS52aWN0aW1jb3VudCAtPSAxMztcclxuICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCS0YvQt9Cy0LDQvSFcIiwgZ29vZEFiaWxDbHIsIHUueCwgaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKHN0cmluZy5Gb3JtYXQoXCLQldGJ0LUgezB9XCIsMTMgLSBwbHJzW3Uub3duZXJdLnZpY3RpbWNvdW50KSwgZ29vZEFiaWxDbHIsIHUueCwgaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodS5BYnNDb250YWlucyhcIkltbW9ydGFsXCIpICYmIHBscnNbdS5vd25lcl0ucmVzLkRlYXRoID49IDUpIHtcclxuICAgICAgICAgICAgICAgIHBscnNbdS5vd25lcl0ucmVzLkRlYXRoIC09IDU7XHJcbiAgICAgICAgICAgICAgICB1LmhwID0gdS5wYXJhbWV0ZXJzLm1heGhwO1xyXG4gICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCLQmNC90LrQsNGA0L3QsNGG0LjRj1wiLCBnb29kQWJpbENsciwgdS54LCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh1LkFic0NvbnRhaW5zKFwiSW5jYXJuYXRpb25cIikgJiYgcm5kLk5leHQoMTAwKSA8IDI1KSB7XHJcbiAgICAgICAgICAgICAgICB1LmhwID0gdS5wYXJhbWV0ZXJzLm1heGhwO1xyXG4gICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCLQmNC90LrQsNGA0L3QsNGG0LjRj1wiLCBnb29kQWJpbENsciwgdS54LCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh1LkFic0NvbnRhaW5zKFwiVW50ZXJtaW5hdGVcIikpIHtcclxuICAgICAgICAgICAgICAgIHUuYWJpbHNbXCJVbnRlcm1pbmF0ZVwiXS51c2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHUuaHAgPSAxO1xyXG4gICAgICAgICAgICAgICAgdS5BZGRBYmlsaXR5KFwiSW52dWxuZXJhYmxlXCIsIDQwMCwgRWZmZWN0VHlwZS5Hb29kKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIXUuQWJzQ29udGFpbnMoXCJCb2R5bGVzc1wiKSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGx0aW1lID0gNzIwMDtcclxuICAgICAgICAgICAgICAgIGlmICh1LnBhcmFtZXRlcnMuaXNCdWlsZGluZylcclxuICAgICAgICAgICAgICAgICAgICBsdGltZSA9IC0xO1xyXG4gICAgICAgICAgICAgICAgcGFycy5BZGQobmV3IEltYWdlUGFydGljbGUobmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW3UucGFyYW1ldGVycy5zcHJpdGVOYW1lXSwgc3ByaXRlc1t1LnBhcmFtZXRlcnMuc3ByaXRlTmFtZV0uUmFuZ2VzW1wiQ29ycHNlXCJdLkl0ZW0yKSwgdS54ICsgdS5wYXJhbWV0ZXJzLmltZ3ggLSB1czIsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LkJvdHRvbSAtIDMwICsgMiwgMCwgNSwgbHRpbWUsIHUubW92ZXNpZGUgPT0gLTEpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpbnQgdmFsO1xyXG4gICAgICAgICAgICBpZiAodS5wYXJhbWV0ZXJzLkNvc3QuTW9uZXkgPCA1MCkge1xyXG4gICAgICAgICAgICAgICAgdmFsID0gMTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh1LnBhcmFtZXRlcnMuQ29zdC5Nb25leSA8IDE1MCkge1xyXG4gICAgICAgICAgICAgICAgdmFsID0gMjtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh1LnBhcmFtZXRlcnMuQ29zdC5Nb25leSA8IDI1MCkge1xyXG4gICAgICAgICAgICAgICAgdmFsID0gNTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZhbCA9IDEwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh1Lm93bmVyID09IDEpIHtcclxuICAgICAgICAgICAgICAgIHBscnNbMF0ucmVzLkRlYXRoICs9IHZhbDtcclxuICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwiK1wiICsgdmFsLCBkZWF0aENsciwgdS54LCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHUub3duZXIgPT0gMClcclxuICAgICAgICAgICAgICAgIHBscnNbMV0ucmVzLkRlYXRoICs9IHZhbDtcclxuICAgICAgICAgICAgaWYgKHUgPT0gc2VsVSlcclxuICAgICAgICAgICAgICAgIHNlbFUgPSBudWxsO1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwcml2YXRlIEdhbWVUeXBlIGdUeXBlO1xyXG5cclxuICAgICAgICBwcml2YXRlIExhbmRzY2FwZVR5cGUgZ2FtZWxhbmRzY2FwZTtcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBpbnQgbGFuZHNUeXBlc0NvdW50ID0gNztcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBMaXN0PEFtbW8+IGFtbW9zID0gbmV3IExpc3Q8QW1tbz4oKTtcclxuXHJcbiAgICAgICAgcHVibGljIERpY3Rpb25hcnk8c3RyaW5nLCBTcGVsbD4gc3BlbGxzID0gbmV3IERpY3Rpb25hcnk8c3RyaW5nLCBTcGVsbD4oKTtcclxuXHJcbiAgICAgICAgLy8g0JLQvdC10YjQvdC40Lkg0LLQuNC0XHJcblxyXG4gICAgICAgIHByaXZhdGUgTGlzdDxQYXJ0aWNsZT4gcGRlYXRobGlzdCA9IG5ldyBMaXN0PFBhcnRpY2xlPigpO1xyXG5cclxuICAgICAgICBwcml2YXRlIENvbG9yIGxpZmVDbHIgPSBuZXcgQ29sb3IoMjU1LCAwLCAwLCAyMDApO1xyXG4gICAgICAgIHByaXZhdGUgQ29sb3IgYWJpbENsciA9IG5ldyBDb2xvcigwLCAwLCAyNTUsIDIwMCk7XHJcbiAgICAgICAgcHJpdmF0ZSBDb2xvciBiYWNrQ2xyID0gbmV3IENvbG9yKDI1NSwgMjU1LCAyNTUsIDE1MCk7XHJcblxyXG5cclxuICAgICAgICBwcml2YXRlIENvbG9yIGNvbmRDbHIgPSBuZXcgQ29sb3IoMTAwLCAxMDAsIDEwMCk7XHJcblxyXG4gICAgICAgIC8vINCf0LDRgNCw0LzQtdGC0YDRiyDQv9C+0LvRj1xyXG4gICAgICAgIHB1YmxpYyBpbnQgdW5pdFNpemUgPSAzMDtcclxuXHJcbiAgICAgICAgcHVibGljIGludCB1czIgPSAxNTtcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgQ29sb3IgZ29vZEFiaWxDbHI7XHJcbiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgQ29sb3IgYmFkQWJpbENsciA9IENvbG9yLkRhcmtWaW9sZXQ7XHJcbiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgQ29sb3IgcG9pQWJpbENsciA9IENvbG9yLkRhcmtWaW9sZXQ7XHJcblxyXG4gICAgICAgIC8vINCd0LXQsdC+XHJcbiAgICAgICAgcHJpdmF0ZSBmbG9hdCBjc1MsIHNuUztcclxuICAgICAgICBwcml2YXRlIGZsb2F0IGNzRCwgc25EO1xyXG4gICAgICAgIHByaXZhdGUgZmxvYXQgc2t5Uiwgc2t5Qiwgc2t5RztcclxuICAgICAgICBwcml2YXRlIGZsb2F0IHNreVIyLCBza3lCMiwgc2t5RzI7XHJcbiAgICAgICAgcHJpdmF0ZSBmbG9hdCBjbnN0UiA9IDUwO1xyXG4gICAgICAgIHByaXZhdGUgZmxvYXQgY25zdEcgPSAxMzA7XHJcbiAgICAgICAgcHJpdmF0ZSBmbG9hdCBjbnN0QiA9IDIwMDtcclxuICAgICAgICBwcml2YXRlIGZsb2F0IGNuc3RSMiA9IDEyMDtcclxuICAgICAgICBwcml2YXRlIGZsb2F0IGNuc3RHMiA9IDE5MDtcclxuICAgICAgICBwcml2YXRlIGZsb2F0IGNuc3RCMiA9IDIzMDtcclxuICAgICAgICBwcml2YXRlIFZlY3RvcjJbXSBzdGFycztcclxuICAgICAgICBwcml2YXRlIFJlY3RhbmdsZSBza3lyZWN0O1xyXG4gICAgICAgIHByaXZhdGUgaW50IHN0YXJzQ250O1xyXG5cclxuXHJcbiAgICAgICAgLy8g0JHQsNC30L7QstCw0Y8g0LzQtdGF0LDQvdC40LrQsFxyXG4gICAgICAgIHB1YmxpYyBib29sIF9wYXVzZTtcclxuXHJcblxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIExpc3Q8c3RyaW5nPiBzdGFydEJ1aWxkaW5nc0xpc3QgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcblxyXG4gICAgICAgIHByaXZhdGUgaW50IGN1ck0sIGN1ckQ7XHJcblxyXG5cclxuXHJcbiAgICAgICAgLy8g0K7QvdC40YLRi1xyXG5cclxuICAgICAgICBwcml2YXRlIFVuaXQgc2VsVTtcclxuXHJcblxyXG5cclxuICAgICAgICAvLyDQktGA0LXQvNC10L3QvdGL0LUg0L/QtdGA0LXQvNC10L3Ri9C1XHJcbiAgICAgICAgcHJpdmF0ZSBmbG9hdCBkZWx0YXgsIGRlbHRheTtcclxuICAgICAgICBwcml2YXRlIExpc3Q8VW5pdD4gZGVhdGhsaXN0ID0gbmV3IExpc3Q8VW5pdD4oKTtcclxuICAgICAgICBwcml2YXRlIGludCBmbHlIZWlnaHQgPSA0ODtcclxuICAgICAgICBwcml2YXRlIGZsb2F0IHBpZWNlID0gMC4wMzkyNjk5MUY7XHJcblxyXG4gICAgICAgIHByaXZhdGUgTGlzdDxNYXRjaENvbmRpdGlvbj4gY29uZHMgPSBuZXcgTGlzdDxNYXRjaENvbmRpdGlvbj4oKTtcclxuXHJcblxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPiBsb2MgPSBuZXcgRGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4oKTtcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBMaXN0PHN0cmluZz4gcmFjZXMxLCByYWNlczI7XHJcbiAgICAgICAgcHJpdmF0ZSBMaXN0PHN0cmluZz4gZWR1bml0cyA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuXHJcblxyXG4gICAgICAgIHByaXZhdGUgUmVjdGFuZ2xlW10gc3ltYm9scyA9IG5ldyBSZWN0YW5nbGVbNF07XHJcblxyXG5cclxuXHJcbiAgICAgICAgLy8gRGltIGFyclBlbiBBcyBOZXcgUGVuKENvbG9yLkJsYWNrLCAxKVxyXG4gICAgICAgIC8vIERpbSBiQXJyUGVuIEFzIE5ldyBQZW4oQ29sb3IuQmxhY2ssIDIpXHJcblxyXG4gICAgICAgIHB1YmxpYyBjb25zdCBpbnQgZWxhcHNlX1BlcmlvZGljYWxseSA9IDE7XHJcblxyXG5cclxuICAgICAgICBwcml2YXRlIGJvb2wgaXNwbGxtb2QgPSBmYWxzZTtcclxuICAgICAgICBwcml2YXRlIHN0cmluZyBzcGVsbE5hbWUgPSBcIlwiO1xyXG5cclxuICAgICAgICAvLyBEaW0gYXR0YWNrUGVuIEFzIE5ldyBQZW4oTmV3IENvbG9yKDE1MCwgMjU1LCAwLCAwKSwgMilcclxuICAgICAgICAvLyBEaW0gYWJpbFBlbiBBcyBOZXcgUGVuKE5ldyBDb2xvcigxNTAsIDAsIDAsIDE1MCksIDIpXHJcblxyXG4gICAgICAgIHByaXZhdGUgVGV4dHVyZTJEIHN0YXJUZXg7XHJcblxyXG4gICAgICAgIHByaXZhdGUgQ29sb3Igc3Vuc2V0Y2xyID0gQ29sb3IuT3JhbmdlUmVkO1xyXG5cclxuICAgICAgICBwcml2YXRlIGludCBtYWNoaW5lbnVtO1xyXG5cclxuICAgICAgICBwcml2YXRlIExpc3Q8VW5pdD4gYm9ybkxpc3QgPSBuZXcgTGlzdDxVbml0PigpO1xyXG5cclxuICAgICAgICBwcml2YXRlIGZsb2F0IG9sZHNuUztcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBmbG9hdCBnbG9iYWxFeHBsb2RlID0gMDtcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBMaXN0PHN0cmluZz4gdW5sb2NrZWRVbml0cyA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuICAgICAgICBwcml2YXRlIExpc3Q8c3RyaW5nPiB1bmxvY2tlZEFjaGl2cyA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBib29sIHVwZGF0ZVNwZWxscyA9IGZhbHNlO1xyXG5cclxuICAgICAgICBwcml2YXRlIENvbG9yIG1vbmV5Q2xyID0gQ29sb3IuQ2hvY29sYXRlO1xyXG4gICAgICAgIHByaXZhdGUgQ29sb3IgZGVhdGhDbHIgPSBDb2xvci5Sb3lhbEJsdWU7XHJcblxyXG4gICAgICAgIHByaXZhdGUgTGlzdDxzdHJpbmc+IEFsbFVudHNMaXN0ID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG5cclxuICAgICAgICBwcml2YXRlIGJvb2wgc3RhcnRBdXRvZmlnaHQgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBEaWN0aW9uYXJ5PHN0cmluZywgQWNoaWV2ZW1lbnQ+IGFjaGl2cyA9IG5ldyBEaWN0aW9uYXJ5PHN0cmluZywgQWNoaWV2ZW1lbnQ+KCk7XHJcbiAgICAgICAgcHJpdmF0ZSBEaWN0aW9uYXJ5PHN0cmluZywgUHVyY2hhc2U+IHB1cmNoYXNlcyA9IG5ldyBEaWN0aW9uYXJ5PHN0cmluZywgUHVyY2hhc2U+KCk7XHJcbiAgICAgICAgcHJpdmF0ZSBMaXN0PHN0cmluZz4gc3RhbmRhcnRSYWNlcyA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBMaXN0PHN0cmluZz4gcHJlR2FtZVVuaXRzID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG4gICAgICAgIHByaXZhdGUgTGlzdDxzdHJpbmc+IHByZUdhbWVTcGVsbHMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcbiAgICAgICAgcHJpdmF0ZSBMaXN0PHN0cmluZz4gcHJlR2FtZUJvbnVzID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG5cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBpbnQgcHJlR2FtZVNsb3RDbnQgPSAxMDtcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBMaXN0PE1vbm9JbnRlcmZhY2UuRnJhbWU+IG1lbnVDYXJvdXNlbDtcclxuICAgICAgICBwcml2YXRlIGludCBjdXJDYXJvdXNlbFBvcyA9IDA7XHJcblxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgaW5TcGVsbE1vZGUge1xyXG4gICAgICAgICAgICBnZXQge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGlzcGxsbW9kO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldCB7XHJcbiAgICAgICAgICAgICAgICBpc3BsbG1vZCA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgTGlzdDxzdHJpbmc+IFJhbmRvbWl6ZVVuaXRzKGludCB1Y250LCBMaXN0PHN0cmluZz4gdUxpc3QsIGJvb2wgc3BlY2lhbGhlcm8pIHtcclxuICAgICAgICAgICAgTGlzdDxzdHJpbmc+IHVudHMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcbiAgICAgICAgICAgIGlmICh1Y250ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IGFsbHVuaXRzdDEgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcbiAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gYWxsdW5pdHN0MiA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBhbGx1bml0c3QzID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG4gICAgICAgICAgICAgICAgaW50IGFsbHVuaXRzY291bnQgPSAwO1xyXG5cclxuICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBhbGx1bml0cyA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBoZXJvdW5pdHMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaW50IHQxY250LCB0MmNudCwgdDNjbnQ7XHJcbiAgICAgICAgICAgICAgICBpbnQgdTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAoc3RyaW5nIHVwIGluIHVMaXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNwZWNpYWxoZXJvKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1bml0UHJtc1t1cF0uaXNIZXJvaWMpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZXJvdW5pdHMuQWRkKHVwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxsdW5pdHMuQWRkKHVwKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWxsdW5pdHMuQWRkKHVwKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc3BlY2lhbGhlcm8gJiYgaGVyb3VuaXRzLkNvdW50ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHVudHMuQWRkKGhlcm91bml0c1tybmQuTmV4dChoZXJvdW5pdHMuQ291bnQpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdWNudCAtPSAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGZvcmVhY2ggKHN0cmluZyB1cCBpbiBhbGx1bml0cykge1xyXG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodW5pdFBybXNbdXBdLkNvc3QuVGllcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGx1bml0c3QxLkFkZCh1cCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGx1bml0c3QyLkFkZCh1cCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDM6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGx1bml0c3QzLkFkZCh1cCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGFsbHVuaXRzY291bnQgKz0gMTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoYWxsdW5pdHNjb3VudCA8IHVjbnQpXHJcbiAgICAgICAgICAgICAgICAgICAgdWNudCA9IGFsbHVuaXRzY291bnQ7XHJcblxyXG4gICAgICAgICAgICAgICAgdDNjbnQgPSAxO1xyXG4gICAgICAgICAgICAgICAgdDJjbnQgPSAodWNudCAtIHQzY250KSAvIDI7XHJcbiAgICAgICAgICAgICAgICB0MWNudCA9IHVjbnQgLSB0MmNudCAtIHQzY250O1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0MWNudCA9PSAwICYmIHQyY250ID09IDAgJiYgYWxsdW5pdHN0Mi5Db3VudCA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgdDJjbnQgPSAxO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICB3aGlsZSAodDNjbnQgPiAwICYmIGFsbHVuaXRzdDMuQ291bnQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdSA9IHJuZC5OZXh0KGFsbHVuaXRzdDMuQ291bnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHVudHMuQWRkKGFsbHVuaXRzdDNbdV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGFsbHVuaXRzdDMuUmVtb3ZlQXQodSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdDNjbnQgLT0gMTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB0MWNudCArPSB0M2NudDtcclxuXHJcbiAgICAgICAgICAgICAgICB3aGlsZSAodDFjbnQgPiAwICYmIGFsbHVuaXRzdDEuQ291bnQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdSA9IHJuZC5OZXh0KGFsbHVuaXRzdDEuQ291bnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHVudHMuQWRkKGFsbHVuaXRzdDFbdV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGFsbHVuaXRzdDEuUmVtb3ZlQXQodSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdDFjbnQgLT0gMTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB0MmNudCArPSB0MWNudDtcclxuXHJcbiAgICAgICAgICAgICAgICB3aGlsZSAodDJjbnQgPiAwICYmIGFsbHVuaXRzdDIuQ291bnQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdSA9IHJuZC5OZXh0KGFsbHVuaXRzdDIuQ291bnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHVudHMuQWRkKGFsbHVuaXRzdDJbdV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGFsbHVuaXRzdDIuUmVtb3ZlQXQodSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdDJjbnQgLT0gMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHVudHMgPSBTb3J0VW5pdHNMaXN0cyh1bnRzKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHVudHM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgTGlzdDxzdHJpbmc+IFJhbmRvbWl6ZVNwZWxscyhpbnQgc0NudCwgTGlzdDxzdHJpbmc+IHNMaXN0KSB7XHJcbiAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBzcGxscyA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuICAgICAgICAgICAgaWYgKHNDbnQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gc3BlbGxzdDEgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcbiAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gc3BlbGxzdDIgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcbiAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gc3BlbGxzdDMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIGludCB0MWNudCwgdDJjbnQsIHQzY250O1xyXG4gICAgICAgICAgICAgICAgaW50IHU7XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAoc3RyaW5nIHNwIGluIHNMaXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChzcGVsbHNbc3BdLkNvc3QuVGllcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGVsbHN0MS5BZGQoc3ApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BlbGxzdDIuQWRkKHNwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwZWxsc3QzLkFkZChzcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHQzY250ID0gc0NudCAvIDM7XHJcbiAgICAgICAgICAgICAgICB0MmNudCA9IHNDbnQgLyAzO1xyXG4gICAgICAgICAgICAgICAgdDFjbnQgPSBzQ250IC0gdDJjbnQgLSB0M2NudDtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgd2hpbGUgKHQxY250ID4gMCAmJiBzcGVsbHN0MS5Db3VudCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB1ID0gcm5kLk5leHQoc3BlbGxzdDEuQ291bnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNwbGxzLkFkZChzcGVsbHN0MVt1XSk7XHJcbiAgICAgICAgICAgICAgICAgICAgc3BlbGxzdDEuUmVtb3ZlQXQodSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdDFjbnQgLT0gMTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB0MmNudCArPSB0MWNudDtcclxuXHJcbiAgICAgICAgICAgICAgICB3aGlsZSAodDJjbnQgPiAwICYmIHNwZWxsc3QyLkNvdW50ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHUgPSBybmQuTmV4dChzcGVsbHN0Mi5Db3VudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc3BsbHMuQWRkKHNwZWxsc3QyW3VdKTtcclxuICAgICAgICAgICAgICAgICAgICBzcGVsbHN0Mi5SZW1vdmVBdCh1KTtcclxuICAgICAgICAgICAgICAgICAgICB0MmNudCAtPSAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHQzY250ICs9IHQyY250O1xyXG5cclxuICAgICAgICAgICAgICAgIHdoaWxlICh0M2NudCA+IDAgJiYgc3BlbGxzdDMuQ291bnQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdSA9IHJuZC5OZXh0KHNwZWxsc3QzLkNvdW50KTtcclxuICAgICAgICAgICAgICAgICAgICBzcGxscy5BZGQoc3BlbGxzdDNbdV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHNwZWxsc3QzLlJlbW92ZUF0KHUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHQzY250IC09IDE7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgc3BsbHMgPSBTb3J0U3BlbGxzTGlzdHMoc3BsbHMpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gc3BsbHM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgTGlzdDxzdHJpbmc+IFJhbmRvbWl6ZUJ1aWxkaW5ncyhpbnQgYkNudCwgTGlzdDxzdHJpbmc+IGJMaXN0KSB7XHJcbiAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBidWlsZGluZ3MgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoYkNudCA+IDApIHtcclxuICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiB0bXBCbGRMaXN0ID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG4gICAgICAgICAgICAgICAgdG1wQmxkTGlzdC5BZGRSYW5nZShiTGlzdCk7XHJcbiAgICAgICAgICAgICAgICBpbnQgcjtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChiQ250ID4gMCAmJiB0bXBCbGRMaXN0LkNvdW50ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHIgPSBybmQuTmV4dCh0bXBCbGRMaXN0LkNvdW50KTtcclxuICAgICAgICAgICAgICAgICAgICBidWlsZGluZ3MuQWRkKHRtcEJsZExpc3Rbcl0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHRtcEJsZExpc3QuUmVtb3ZlQXQocik7XHJcbiAgICAgICAgICAgICAgICAgICAgYkNudCAtPSAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gYnVpbGRpbmdzO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgYnRuU3BlbGxfQ2xpY2tlZChNb25vSW50ZXJmYWNlLkJ1dHRvbiBidG4sIGJvb2wgaXNUb3VjaCkge1xyXG4gICAgICAgICAgICB2YXIgaW5kID0gY1NwZWxscy5DaGlsZHJlbi5JbmRleE9mKGJ0bik7XHJcbiAgICAgICAgICAgIGlmICgocGxyc1swXS5zcGVsbHNSY2hyZ1tpbmRdID09IDApKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc3BlbGxzW3BscnNbMF0uc3BsbHNMaXN0W2luZF1dLlRhcmdldCA9PSBTcGVsbC5UYXJnZXRUeXBlLlVuaXQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpblNwZWxsTW9kZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgc3BlbGxOYW1lID0gcGxyc1swXS5zcGxsc0xpc3RbaW5kXTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIERvR2xvYmFsU3BlbGxzKHBscnNbMF0uc3BsbHNMaXN0W2luZF0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgYnRuU3BlbGxfRm9jdXNlZChNb25vSW50ZXJmYWNlLkJ1dHRvbiBidG4sIGJvb2wgaXNUb3VjaCkge1xyXG4gICAgICAgICAgICB2YXIgaW5kID0gY1NwZWxscy5DaGlsZHJlbi5JbmRleE9mKGJ0bik7XHJcbiAgICAgICAgICAgIHZhciBzcGwgPSBzcGVsbHNbcGxyc1swXS5zcGxsc0xpc3RbaW5kXV07XHJcbiAgICAgICAgICAgIFNob3dNb3JlSW5mbyhzcGwuQ29zdCwgdHJ1ZSwgZGVmYXVsdChQb2ludCksIGxvY2FsaXplLkdldFN0cmluZyhzcGwuTmFtZSksIGxvY2FsaXplLkdldFN0cmluZyhzcGwuU2Nob29sLCBzcGwuQ29zdC5UaWVyKSwgc3BsLkRlc2NyaXB0aW9uKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFNldFNwZWxscygpIHtcclxuICAgICAgICAgICAgaWYgKHBscnNbMF0uc3BsbHNMaXN0LkNvdW50ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgY1NwZWxscy5DaGlsZHJlbi5DbGVhcigpO1xyXG4gICAgICAgICAgICAgICAgaW50IGQgPSAwO1xyXG4gICAgICAgICAgICAgICAgaW50IG9sZHQgPSBzcGVsbHNbcGxyc1swXS5zcGxsc0xpc3RbMF1dLkNvc3QuVGllcjtcclxuICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcGxyc1swXS5zcGxsc0xpc3QuQ291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzcGVsbHNbcGxyc1swXS5zcGxsc0xpc3RbaV1dLkNvc3QuVGllciAhPSBvbGR0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGQgKz0gNztcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2xkdCA9IHNwZWxsc1twbHJzWzBdLnNwbGxzTGlzdFtpXV0uQ29zdC5UaWVyO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJ0biA9IGNTcGVsbHMuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5CdXR0b24+KG5ldyBNb25vSW50ZXJmYWNlLkJ1dHRvbihidG5TcGVsbF9DbGlja2VkLCBidG5TcGVsbF9Gb2N1c2VkLCBudW1LZXlzW2ldLCBpICogNzAgKyBkLCAwLCA2MCwgNjAsIGhvckFsaWduOiAwLjBmKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnRuLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuUGljdHVyZT4obmV3IE1vbm9JbnRlcmZhY2UuUGljdHVyZShuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJzcGVsbHNfaWNvbnNcIl0sIHNwZWxsc1twbHJzWzBdLnNwbGxzTGlzdFtpXV0uSW1nKSwgdzogNjAsIGg6IDYwKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnRuLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuUHJvZ3Jlc3M+KG5ldyBNb25vSW50ZXJmYWNlLlByb2dyZXNzKDAsIDAsIDAsIDAsIDYwLCA2MCwgMCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHBscnNbMF0uc3BlbGxzUmNocmcuQWRkKDApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY1NwZWxscy5BcHBseVRoZW1lKGRlZmF1bHRUaGVtZSk7XHJcbiAgICAgICAgICAgICAgICBjU3BlbGxzLlcgPSBTeXN0ZW0uTGlucS5FbnVtZXJhYmxlLkxhc3Q8TW9ub0ludGVyZmFjZS5CbG9jaz4oY1NwZWxscy5DaGlsZHJlbikuRmluYWxSaWdodDtcclxuICAgICAgICAgICAgICAgIGJ0blNlbGVjdFNwZWxscy5Jc0Rpc2FibGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0gZWxzZVxyXG4gICAgICAgICAgICAgICAgYnRuU2VsZWN0U3BlbGxzLklzRGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgQ3JlYXRlQWNoaWV2ZW1lbnRzKCkge1xyXG4gICAgICAgICAgICBhY2hpdnMuQWRkKFwiU3RhcnRwYXRoXCIsIG5ldyBBY2hpZXZlbWVudChcIlN0YXJ0cGF0aFwiLCBuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJib251c19pY29uc1wiXSwgMyksIFwiNWNyeXN0YWxzXCIpKTtcclxuICAgICAgICAgICAgYWNoaXZzLkFkZChcIkFsaXR0bGVoYXJkZXJcIiwgbmV3IEFjaGlldmVtZW50KFwiQWxpdHRsZWhhcmRlclwiLCBuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJtZWRpdW1faWNvbnNcIl0sIDExKSwgXCIxMGNyeXN0YWxzXCIpKTtcclxuXHJcbiAgICAgICAgICAgIGFjaGl2cy5BZGQoXCJHZW50bGVsZWFkZXJcIiwgbmV3IEFjaGlldmVtZW50KFwiR2VudGxlbGVhZGVyXCIsIG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcImJvbnVzX2ljb25zXCJdLCA4KSwgXCIyNWNyeXN0YWxzXCIpKTtcclxuXHJcblxyXG4gICAgICAgICAgICAvLyBhY2hpdnMuQWRkKFwiU2FjcmlmYWNlaW5iYXR0bGVcIiwgTmV3IEFjaGlldmVtZW50KFwiU2FjcmlmYWNlaW5iYXR0bGVcIiwgTmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW1widW5pdHNfaWNvbnNcIl0sIDExMykpKVxyXG4gICAgICAgICAgICBhY2hpdnMuQWRkKFwiVHJ1ZW1hZ2VcIiwgbmV3IEFjaGlldmVtZW50KFwiVHJ1ZW1hZ2VcIiwgbmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW1wiYm9udXNfaWNvbnNcIl0sIDEpLCBcIjI1Y3J5c3RhbHNcIikpO1xyXG5cclxuICAgICAgICAgICAgYWNoaXZzLkFkZChcIk9wZW5lZGl0b3JcIiwgbmV3IEFjaGlldmVtZW50KFwiT3BlbmVkaXRvclwiLCBuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJiaWdfaWNvbnNcIl0sIDIpLCBcIjF1bml0XCIpKTtcclxuICAgICAgICAgICAgYWNoaXZzLkFkZChcIlNoYW1lY2hlYXRlcnNcIiwgbmV3IEFjaGlldmVtZW50KFwiU2hhbWVjaGVhdGVyc1wiLCBuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJib251c19pY29uc1wiXSwgNyksIFwiMXVuaXRcIikpO1xyXG5cclxuICAgICAgICAgICAgYWNoaXZzLkFkZChcIkZpcnN0cHVyY2hhc2VcIiwgbmV3IEFjaGlldmVtZW50KFwiRmlyc3RwdXJjaGFzZVwiLCBuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJib251c19pY29uc1wiXSwgMCksIFwiMXVuaXRcIikpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgQ3JlYXRlUHVyY2hhc2VzKCkge1xyXG4gICAgICAgICAgICBwdXJjaGFzZXMuQWRkKFwiQnVzdGVyMVRcIiwgbmV3IFB1cmNoYXNlKFwiQnVzdGVyMVRcIiwgbmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW1wicHVyY2hhc2VfaWNvbnNcIl0sIDIpLCA1KSk7XHJcblxyXG5cclxuICAgICAgICAgICAgcHVyY2hhc2VzLkFkZChcIkJ1c3RlcjJUXCIsIG5ldyBQdXJjaGFzZShcIkJ1c3RlcjJUXCIsIG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcInB1cmNoYXNlX2ljb25zXCJdLCAzKSwgMTApKTtcclxuXHJcblxyXG4gICAgICAgICAgICBwdXJjaGFzZXMuQWRkKFwiQnVzdGVyM1RcIiwgbmV3IFB1cmNoYXNlKFwiQnVzdGVyM1RcIiwgbmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW1wicHVyY2hhc2VfaWNvbnNcIl0sIDEpLCAyNSkpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIHB1cmNoYXNlcy5BZGQoXCJIZXJvYnVzdGVyXCIsIG5ldyBQdXJjaGFzZShcIkhlcm9idXN0ZXJcIiwgbmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW1wicHVyY2hhc2VfaWNvbnNcIl0sIDApLCAyNSkpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgUm90YXRlQ2Fyb3VzZWwoTW9ub0ludGVyZmFjZS5GcmFtZSBmcm0pIHtcclxuICAgICAgICAgICAgaW50IHRyZ1BvcyA9IG1lbnVDYXJvdXNlbC5JbmRleE9mKGZybSk7XHJcbiAgICAgICAgICAgIGlmICh0cmdQb3MgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRyZ1BvcyA+IGN1ckNhcm91c2VsUG9zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZybTIgPSBtZW51Q2Fyb3VzZWxbY3VyQ2Fyb3VzZWxQb3NdO1xyXG4gICAgICAgICAgICAgICAgICAgIG1haW5BbmltYXRvci5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLk51bWJlckFuaW1hdGlvbj4obmV3IE1vbm9JbnRlcmZhY2UuTnVtYmVyQW5pbWF0aW9uKFwiWFwiLCAwLCAtNDAwLCAtNTAsIHRhcmdldDogZnJtMiwgb25FbmQ6ICgpID0+IGZybTIuVmlzaWJsZSA9IGZhbHNlKSkuQmVnaW4oKTtcclxuICAgICAgICAgICAgICAgICAgICBmcm0uWSA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgZnJtLlZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIG1haW5BbmltYXRvci5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLk51bWJlckFuaW1hdGlvbj4obmV3IE1vbm9JbnRlcmZhY2UuTnVtYmVyQW5pbWF0aW9uKFwiWFwiLCA0MDAsIDAsIC01MCwgdGFyZ2V0OiBmcm0pKS5CZWdpbigpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0cmdQb3MgPCBjdXJDYXJvdXNlbFBvcykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBmcm0yID0gbWVudUNhcm91c2VsW2N1ckNhcm91c2VsUG9zXTtcclxuICAgICAgICAgICAgICAgICAgICBtYWluQW5pbWF0b3IuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5OdW1iZXJBbmltYXRpb24+KG5ldyBNb25vSW50ZXJmYWNlLk51bWJlckFuaW1hdGlvbihcIlhcIiwgMCwgNDAwLCA1MCwgdGFyZ2V0OiBmcm0yLCBvbkVuZDogKCkgPT4gZnJtMi5WaXNpYmxlID0gZmFsc2UpKS5CZWdpbigpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZybS5ZID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBmcm0uVmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgbWFpbkFuaW1hdG9yLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTnVtYmVyQW5pbWF0aW9uPihuZXcgTW9ub0ludGVyZmFjZS5OdW1iZXJBbmltYXRpb24oXCJYXCIsIC00MDAsIDAsIDUwLCB0YXJnZXQ6IGZybSkpLkJlZ2luKCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGZybS5WaXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZnJtLlkgPCAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYWluQW5pbWF0b3IuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5OdW1iZXJBbmltYXRpb24+KG5ldyBNb25vSW50ZXJmYWNlLk51bWJlckFuaW1hdGlvbihcIllcIiwgZnJtLlksIDAsIDUwLCB0YXJnZXQ6IGZybSkpLkJlZ2luKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoZnJtLlkgPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYWluQW5pbWF0b3IuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5OdW1iZXJBbmltYXRpb24+KG5ldyBNb25vSW50ZXJmYWNlLk51bWJlckFuaW1hdGlvbihcIllcIiwgZnJtLlksIDAsIC01MCwgdGFyZ2V0OiBmcm0pKS5CZWdpbigpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY3VyQ2Fyb3VzZWxQb3MgPSB0cmdQb3M7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEluaXRpYWxpemUoKSB7XHJcblxyXG4gICAgICAgICAgICBiYWNrRmlsbFRleCA9IE1vbm9JbnRlcmZhY2UuVGhlbWUuU29saWRDb2xvclRleHR1cmUoZ3JhcGhpY3MuR3JhcGhpY3NEZXZpY2UsIDAsIDAsIDAsIDE1MCk7XHJcblxyXG4gICAgICAgICAgICBmcm1GaWxsVGV4ID0gTW9ub0ludGVyZmFjZS5UaGVtZS5Tb2xpZENvbG9yVGV4dHVyZShncmFwaGljcy5HcmFwaGljc0RldmljZSwgMTkwLCAxOTAsIDE5MCwgMjIwKTtcclxuXHJcbiAgICAgICAgICAgIGJ0bkZpbGxUZXggPSBNb25vSW50ZXJmYWNlLlRoZW1lLlNvbGlkQ29sb3JUZXh0dXJlKGdyYXBoaWNzLkdyYXBoaWNzRGV2aWNlLCAxNTAsIDE1MCwgMTUwKTtcclxuICAgICAgICAgICAgYnRuU2VsZWN0VGV4ID0gTW9ub0ludGVyZmFjZS5UaGVtZS5Tb2xpZENvbG9yVGV4dHVyZShncmFwaGljcy5HcmFwaGljc0RldmljZSwgMjAwLCAyMDAsIDIwMCk7XHJcbiAgICAgICAgICAgIGJ0bkhsVGV4ID0gTW9ub0ludGVyZmFjZS5UaGVtZS5Tb2xpZENvbG9yVGV4dHVyZShncmFwaGljcy5HcmFwaGljc0RldmljZSwgMjIwLCAyMjAsIDIyMCwgMTIwKTtcclxuICAgICAgICAgICAgYnRuUHJlc3NlZFRleCA9IE1vbm9JbnRlcmZhY2UuVGhlbWUuU29saWRDb2xvclRleHR1cmUoZ3JhcGhpY3MuR3JhcGhpY3NEZXZpY2UsIDIyMCwgMjIwLCAyMjAsIDE4MCk7XHJcbiAgICAgICAgICAgIGJ0bkRpc2FibGVkVGV4ID0gTW9ub0ludGVyZmFjZS5UaGVtZS5Tb2xpZENvbG9yVGV4dHVyZShncmFwaGljcy5HcmFwaGljc0RldmljZSwgMTAwLCAxMDAsIDEwMCwgMjAwKTtcclxuXHJcbiAgICAgICAgICAgIHByZ0ZpbGxUZXggPSBNb25vSW50ZXJmYWNlLlRoZW1lLlNvbGlkQ29sb3JUZXh0dXJlKGdyYXBoaWNzLkdyYXBoaWNzRGV2aWNlLCAyMjAsIDIyMCwgMjIwKTtcclxuICAgICAgICAgICAgcHJnQmFyVGV4ID0gTW9ub0ludGVyZmFjZS5UaGVtZS5Tb2xpZENvbG9yVGV4dHVyZShncmFwaGljcy5HcmFwaGljc0RldmljZSwgMTQwLCAxNDAsIDE0MCk7XHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgIHN0YXJUZXggPSBNb25vSW50ZXJmYWNlLlRoZW1lLlNvbGlkQ29sb3JUZXh0dXJlKGdyYXBoaWNzLkdyYXBoaWNzRGV2aWNlLCAyNTUsIDI1NSwgMjU1KTtcclxuXHJcblxyXG4gICAgICAgICAgICBoZWFsdGhCYXJCYWNrVGV4ID0gTW9ub0ludGVyZmFjZS5UaGVtZS5Tb2xpZENvbG9yVGV4dHVyZShncmFwaGljcy5HcmFwaGljc0RldmljZSwgMjU1LCAyNTUsIDI1NSwgMTgwKTtcclxuICAgICAgICAgICAgaGVhbHRoQmFyTGlmZVRleCA9IE1vbm9JbnRlcmZhY2UuVGhlbWUuU29saWRDb2xvclRleHR1cmUoZ3JhcGhpY3MuR3JhcGhpY3NEZXZpY2UsIDI1NSwgMCwgMCwgMTgwKTtcclxuICAgICAgICAgICAgaGVhbHRoQmFyUG9pc29uVGV4ID0gTW9ub0ludGVyZmFjZS5UaGVtZS5Tb2xpZENvbG9yVGV4dHVyZShncmFwaGljcy5HcmFwaGljc0RldmljZSwgMCwgMTIwLCAwLCAxODApO1xyXG4gICAgICAgICAgICBoZWFsdGhCYXJBYmlsVGV4ID0gTW9ub0ludGVyZmFjZS5UaGVtZS5Tb2xpZENvbG9yVGV4dHVyZShncmFwaGljcy5HcmFwaGljc0RldmljZSwgMCwgMCwgMjU1LCAxODApO1xyXG5cclxuXHJcbiAgICAgICAgICAgIGhvciA9IGdhbWVIZWlnaHQgLSAzMDtcclxuXHJcbiAgICAgICAgICAgIHNreXJlY3QgPSBuZXcgUmVjdGFuZ2xlKDAsIDAsIGdhbWVXaWR0aCwgaG9yKTtcclxuICAgICAgICAgICAgc2t5dGV4dHVyZSA9IG5ldyBUZXh0dXJlMkQoZ3JhcGhpY3MuR3JhcGhpY3NEZXZpY2UsIDEsIGhvcik7XHJcbiAgICAgICAgICAgIHN1bnNldHRleHR1cmUgPSBuZXcgVGV4dHVyZTJEKGdyYXBoaWNzLkdyYXBoaWNzRGV2aWNlLCAxLCBob3IpO1xyXG5cclxuICAgICAgICAgICAgQ3JlYXRlQWNoaWV2ZW1lbnRzKCk7XHJcblxyXG4gICAgICAgICAgICBDcmVhdGVQdXJjaGFzZXMoKTtcclxuXHJcblxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICBPcmRlclJhY2VzKCk7XHJcblxyXG4gICAgICAgICAgICBDcmVhdGVSYWNlTGlzdCgpO1xyXG5cclxuICAgICAgICAgICAgY29uZHMuQWRkKG5ldyBNYXRjaENvbmRpdGlvbihcIkVhc3lcIiwgbmV3IFRpbWVDb3N0KDEwMDAsIDIwLCAxLCAwKSwgbmV3IFRpbWVDb3N0KDUwMCwgMTAsIDEsIDApLCA1MCwgMjUpKTtcclxuICAgICAgICAgICAgY29uZHMuQWRkKG5ldyBNYXRjaENvbmRpdGlvbihcIk1lZGl1bVwiLCBuZXcgVGltZUNvc3QoNTAwLCAxMCwgMSwgMCksIG5ldyBUaW1lQ29zdCg1MDAsIDEwLCAxLCAwKSwgNTAsIDI1KSk7XHJcbiAgICAgICAgICAgIGNvbmRzLkFkZChuZXcgTWF0Y2hDb25kaXRpb24oXCJIYXJkXCIsIG5ldyBUaW1lQ29zdCgyNTAsIDAsIDEsIDApLCBuZXcgVGltZUNvc3QoNTAwLCAxMCwgMSwgMCksIDUwLCAyNSkpO1xyXG5cclxuICAgICAgICAgICAgZm9yZWFjaCAoVW5pdFBhcmFtZXRlcnMgdXAgaW4gdW5pdFBybXMuVmFsdWVzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXVwLnNwZWNpYWwpXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdXAuaXNIZXJvaWMgVGhlblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIEFsbEhlcm9lc0xpc3QuQWRkKHVwLm5hbWUpXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gRWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIEFsbFVudHNMaXN0LkFkZCh1cC5OYW1lKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgRGljdGlvbmFyeTxzdHJpbmcsIGludD4gcmFjZXNjb3N0ID0gbmV3IERpY3Rpb25hcnk8c3RyaW5nLCBpbnQ+KCk7XHJcbiAgICAgICAgICAgIGludCByYWNlaSA9IDA7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKEtleVZhbHVlUGFpcjxzdHJpbmcsIFJhY2U+IHJjZSBpbiBSYWNlTWFuYWdlci5JbnN0YW5jZS5BbGwpIHtcclxuICAgICAgICAgICAgICAgIHJhY2VzY29zdC5BZGQocmNlLktleSwgcmFjZWkgKiA0MDAwKTtcclxuICAgICAgICAgICAgICAgIHJhY2VpICs9IDE7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIEFsbFVudHNMaXN0ID0gU3lzdGVtLkxpbnEuRW51bWVyYWJsZS5PcmRlckJ5PHN0cmluZyxpbnQ+KEFsbFVudHNMaXN0XHJcbiwoRnVuYzxzdHJpbmcsaW50PikodW5pdCA9PiB1bml0UHJtc1t1bml0XS5Db3N0Lk1vbmV5ICsgKHVuaXRQcm1zW3VuaXRdLnN1cHBvcnQgPyAtNTAwIDogMCkgKyB1bml0UHJtc1t1bml0XS5Db3N0LlRpZXIgKiAxMDAwICsgcmFjZXNjb3N0W3VuaXRQcm1zW3VuaXRdLlJhY2VdKSlcclxuICAgICAgICAgICAgICAgIC5Ub0xpc3QoKTtcclxuXHJcbiAgICAgICAgICAgIENyZWF0ZUludGVyZmFjZSgpO1xyXG5cclxuICAgICAgICAgICAgbWVudUNhcm91c2VsID0gZ2xvYmFsOjpCcmlkZ2UuU2NyaXB0LkNhbGxGb3IobmV3IExpc3Q8TW9ub0ludGVyZmFjZS5GcmFtZT4oKSwoX28xKT0+e19vMS5BZGQoZnJtQmF0dGxlKTtfbzEuQWRkKGZybVByb2ZpbGUpO3JldHVybiBfbzE7fSk7XHJcblxyXG4gICAgICAgICAgICBzdGFyc0NudCA9IDg4O1xyXG4gICAgICAgICAgICBzdGFycyA9IG5ldyBWZWN0b3IyW3N0YXJzQ250XTtcclxuICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzdGFyc0NudDsgaSsrKVxyXG4gICAgICAgICAgICAgICAgc3RhcnNbaV0gPSBuZXcgVmVjdG9yMihybmQuTmV4dCgwLCBnYW1lV2lkdGgpLCAoZmxvYXQpKDIwICsgcm5kLk5leHREb3VibGUoKSAqIChob3IgLSA2MCkpKTtcclxuXHJcbiAgICAgICAgICAgIHN5bWJvbHNbMF0gPSBuZXcgUmVjdGFuZ2xlKGdhbWVXaWR0aCAtIDksIGhvciAtIDc1LCAxNSwgMjUpO1xyXG4gICAgICAgICAgICBzeW1ib2xzWzFdID0gbmV3IFJlY3RhbmdsZShnYW1lV2lkdGggLSAzNCwgaG9yIC0gNTQsIDE1LCAyNSk7XHJcbiAgICAgICAgICAgIHN5bWJvbHNbMl0gPSBuZXcgUmVjdGFuZ2xlKC03LCBob3IgLSA3NSwgMTUsIDI1KTtcclxuICAgICAgICAgICAgc3ltYm9sc1szXSA9IG5ldyBSZWN0YW5nbGUoMjEsIGhvciAtIDU0LCAxNSwgMjUpO1xyXG5cclxuXHJcblxyXG4gICAgICAgICAgICAvLyBmcm1CYXR0bGUuU2V0UG9zaXRpb24oZnJtTWFpbk1lbnUucmVjdC5SaWdodCAvIDIgKyAoZnJtTWVudUV4aXQucmVjdC5MZWZ0IC0gZnJtQmF0dGxlLnJlY3QuV2lkdGgpIC8gMiwgKGggLSBmcm1CYXR0bGUucmVjdC5IZWlnaHQpIC8gMilcclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICBzdW5BbmcgPSAwICogKGZsb2F0KU1hdGguUEkgLyAxODA7XHJcbiAgICAgICAgICAgIGRBbmcgPSAwLjA0ZiAqIChmbG9hdClNYXRoLlBJIC8gMTgwO1xyXG5cclxuICAgICAgICAgICAgZ2FtZWxhbmRzY2FwZSA9IChMYW5kc2NhcGVUeXBlKXJuZC5OZXh0KGxhbmRzVHlwZXNDb3VudCk7XHJcblxyXG4gICAgICAgICAgICBnU3RhdGUgPSBHYW1lU3RhdGUuTWFpbk1lbnU7XHJcbiAgICAgICAgICAgIFBhdXNlID0gZmFsc2U7XHJcblxyXG5cclxuICAgICAgICAgICAgQ2hhbmdlTGFuZHNjYXBlKGdhbWVsYW5kc2NhcGUpO1xyXG5cclxuICAgICAgICAgICAgU2V0UGxheWVycygpO1xyXG5cclxuICAgICAgICAgICAgUmVzZXRXb3JsZChzdW5BbmcsIGRBbmcpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIGZybU1haW5NZW51LlNob3coKTtcclxuICAgICAgICAgICAgZnJtUmlnaHRNZW51LlNob3coKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGwuQ291bnQgPiAwKVxyXG4gICAgICAgICAgICAgICAgU3RhcnRCYXR0bGUoKTtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgU3RhcnROZXdQcm9maWxlKCk7XHJcblxyXG4gICAgICAgICAgICBpc0xvYWRlZCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgU3RhcnROZXdQcm9maWxlKCkge1xyXG4gICAgICAgICAgICBQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGwuQWRkKG5ldyBQcm9maWxlKFwi0J3QvtCy0LjRh9C10LpcIi5UcmltKCksIDAsIDEsIG5ldyBMaXN0PHN0cmluZz4oKSwgbmV3IERpY3Rpb25hcnk8c3RyaW5nLCBpbnQ+KCksIG5ldyBEaWN0aW9uYXJ5PHN0cmluZywgaW50PigpLCAtMSwgLTEsIG5ldyBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPigpLCAwLCAzKSk7XHJcbiAgICAgICAgICAgIC8vIFJhY2VNYW5hZ2VyLkluc3RhbmNlLkFsbC5BZGQoXCJDdXN0b20wXCIsIE5ldyBSYWNlKFwiQ3VzdG9tMFwiLCBcItCh0LTQtdC70LDQvdC+INGB0LLQvtC40LzQuCDRgNGD0LrQsNC80LhcIiwgXCLQodGC0LDRgNGC0L7QstGL0Lkg0L3QsNCx0L7RgFwiLCBSYWNlTWFuYWdlci5JbnN0YW5jZS5BbGwoc3RhbmRhcnRSYWNlcyhyYWNlU3dpdGNoZXJOZXdQcm9maWxlLkN1cnJlbnQpKS51bml0cywgMTAsIEZhbHNlLCBUcnVlLCBGYWxzZSwgRmFsc2UpKVxyXG4gICAgICAgICAgICBPcmRlclJhY2VzKCk7XHJcbiAgICAgICAgICAgIENyZWF0ZVJhY2VMaXN0KCk7XHJcbiAgICAgICAgICAgIFN0YXJ0QmF0dGxlKCk7XHJcbiAgICAgICAgICAgIGZybUJhdHRsZS5TaG93KG1haW5BbmltYXRvcik7XHJcblxyXG4gICAgICAgICAgICBTaG93U29tZUNoaWxkcmVuKGZybU1haW5NZW51LCBmcm1SaWdodE1lbnUpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIFN0YXJ0QmF0dGxlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBTaG93U29tZUNoaWxkcmVuKHBhcmFtcyBNb25vSW50ZXJmYWNlLkJsb2NrW10gZnJtcykge1xyXG4gICAgICAgICAgICBmb3JlYWNoICh2YXIgZnJtIGluIGZybXMpXHJcbiAgICAgICAgICAgICAgICBmcm0uU2hvdyhtYWluQW5pbWF0b3IpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEhpZGVTb21lQ2hpbGRyZW4ocGFyYW1zIE1vbm9JbnRlcmZhY2UuQmxvY2tbXSBmcm1zKSB7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKHZhciBmcm0gaW4gZnJtcylcclxuICAgICAgICAgICAgICAgIGZybS5IaWRlKG1haW5BbmltYXRvcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBTdGFydFByb2ZpbGUoKSB7XHJcbiAgICAgICAgICAgIFJvdGF0ZUNhcm91c2VsKGZybVByb2ZpbGUpO1xyXG4gICAgICAgICAgICBVcGRhdGVQcm9maWxlSW5mb0xhYmVscygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgVXBkYXRlUHJvZmlsZUluZm9MYWJlbHMoKSB7XHJcbiAgICAgICAgICAgIGxibHNmcm1Qcm9maWxlWzBdLlRleHQgPSBcItCd0LjQujogXCIgKyBQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0ubmFtZTtcclxuICAgICAgICAgICAgbGJsc2ZybVByb2ZpbGVbMV0uVGV4dCA9IFwi0KHQu9C+0LbQvdC+0YHRgtGMOiBcIiArIGxvY2FsaXplLkdldFN0cmluZyhjb25kc1tQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0uZGlmZmljdWx0XS5uYW1lKTtcclxuXHJcblxyXG4gICAgICAgICAgICBpbnQgYWxsd2lucyA9IDA7XHJcbiAgICAgICAgICAgIHN0cmluZyBtYXhyYWNlID0gXCJcIjtcclxuICAgICAgICAgICAgaW50IG1heHJhY2VwbHMgPSAwO1xyXG5cclxuICAgICAgICAgICAgZm9yZWFjaCAoc3RyaW5nIHIgaW4gUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLnJhY2VzUGxheXMuS2V5cykge1xyXG4gICAgICAgICAgICAgICAgYWxsd2lucyArPSBQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0ucmFjZXNXaW5zW3JdO1xyXG4gICAgICAgICAgICAgICAgaWYgKG1heHJhY2VwbHMgPCBQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0ucmFjZXNQbGF5c1tyXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG1heHJhY2VwbHMgPSBQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0ucmFjZXNQbGF5c1tyXTtcclxuICAgICAgICAgICAgICAgICAgICBtYXhyYWNlID0gcjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgbGJsc2ZybVByb2ZpbGVbMl0uVGV4dCA9IHN0cmluZy5Gb3JtYXQoXCLQn9C+0LHQtdC0OiB7MH1cIiwgYWxsd2lucyk7XHJcbiAgICAgICAgICAgIGxibHNmcm1Qcm9maWxlWzNdLlRleHQgPSBzdHJpbmcuRm9ybWF0KFwi0J7RgtC60YDRi9GC0L4gezB9JSDRgdGD0YnQtdGB0YLQslwiLCAoaW50KTEwMCAqIFByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS51bml0cy5Db3VudCAvIChkb3VibGUpQWxsVW50c0xpc3QuQ291bnQpO1xyXG5cclxuICAgICAgICAgICAgaW50IGFjTnVtID0gMDtcclxuXHJcbiAgICAgICAgICAgIGZvcmVhY2ggKEtleVZhbHVlUGFpcjxzdHJpbmcsIHN0cmluZz4gYSBpbiBQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0uYWNoaXZzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYS5WYWx1ZSA9PSBcIlwiKVxyXG4gICAgICAgICAgICAgICAgICAgIGFjTnVtICs9IDE7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGxibHNmcm1Qcm9maWxlWzRdLlRleHQgPSBzdHJpbmcuRm9ybWF0KFwi0J7RgtC60YDRi9GC0L4gezB9JSDQtNC+0YHRgtC40LbQtdC90LjQuVwiLCAoaW50KTEwMCAqIGFjTnVtIC8gKGRvdWJsZSlhY2hpdnMuQ291bnQpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIGxibHNmcm1Qcm9maWxlWzZdLlRleHQgPSBcItCd0LjQujogXCIgKyBQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0ubmFtZTtcclxuICAgICAgICAgICAgbGJsc2ZybVByb2ZpbGVbN10uVGV4dCA9IFwi0J3QuNC6OiBcIiArIFByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS5uYW1lO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFzdHJpbmcuSXNOdWxsT3JFbXB0eShtYXhyYWNlKSlcclxuICAgICAgICAgICAgICAgIGxibHNmcm1Qcm9maWxlWzVdLlRleHQgPSBzdHJpbmcuRm9ybWF0KFwi0JvRjtCx0LjQvNCw0Y8g0YTRgNCw0LrRhtC40Y86IHswfVwiLCBsb2NhbGl6ZS5HZXRTdHJpbmcobWF4cmFjZSkpO1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICBsYmxzZnJtUHJvZmlsZVs1XS5UZXh0ID0gXCLQm9GO0LHQuNC80LDRjyDRhNGA0LDQutGG0LjRjzogLVwiO1xyXG5cclxuICAgICAgICAgICAgaWYgKFByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS5taW52aWN0aW1zID09IC0xKVxyXG4gICAgICAgICAgICAgICAgbGJsc2ZybVByb2ZpbGVbNl0uVGV4dCA9IFwi0JzQuNC90LjQvNGD0Lwg0L/QvtGC0LXRgNGMOiAtXCI7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIGxibHNmcm1Qcm9maWxlWzZdLlRleHQgPSBzdHJpbmcuRm9ybWF0KFwi0JzQuNC90LjQvNGD0Lwg0L/QvtGC0LXRgNGMOiB7MH1cIiwgUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLm1pbnZpY3RpbXMpO1xyXG5cclxuICAgICAgICAgICAgaWYgKFByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS5tYXhraWxscyA9PSAtMSlcclxuICAgICAgICAgICAgICAgIGxibHNmcm1Qcm9maWxlWzddLlRleHQgPSBcItCc0LDQutGB0LjQvNGD0Lwg0YPQsdC40LnRgdGC0LI6IC1cIjtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgbGJsc2ZybVByb2ZpbGVbN10uVGV4dCA9IHN0cmluZy5Gb3JtYXQoXCLQnNCw0LrRgdC40LzRg9C8INGD0LHQuNC50YHRgtCyOiB7MH1cIiwgUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLm1heGtpbGxzKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBSZXNldFdvcmxkKGZsb2F0IHN1blBvcywgZmxvYXQgc3VuVikge1xyXG4gICAgICAgICAgICBjbG91ZHBhcnMuQ2xlYXIoKTtcclxuICAgICAgICAgICAgc25EID0gKGZsb2F0KU1hdGguU2luKHN1blYpO1xyXG4gICAgICAgICAgICBjc0QgPSAoZmxvYXQpTWF0aC5Db3Moc3VuVik7XHJcbiAgICAgICAgICAgIHNuUyA9IChmbG9hdClNYXRoLlNpbihzdW5Qb3MpO1xyXG4gICAgICAgICAgICBjc1MgPSAoZmxvYXQpTWF0aC5Db3Moc3VuUG9zKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPD0gMzsgaSsrKVxyXG4gICAgICAgICAgICAgICAgY2xvdWRwYXJzLkFkZChuZXcgSW1hZ2VQYXJ0aWNsZShuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJ3b3JsZFwiXSwgcm5kLk5leHQoMiwgNikpLCAtMTAwIC0gcm5kLk5leHQoMTAwKSwgaG9yIC0gMjAwIC0gaSAqIDQwLCAwLjJmICsgMC40ZiAqIChmbG9hdClybmQuTmV4dERvdWJsZSgpLCAwLCAtMSkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgYnRuVW5pdF9DbGlja2VkKE1vbm9JbnRlcmZhY2UuQnV0dG9uIGJ0biwgYm9vbCBpc1RvdWNoKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY1VuaXRzLkNoaWxkcmVuLkNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmIChjVW5pdHMuQ2hpbGRyZW5baV0gPT0gYnRuKVxyXG4gICAgICAgICAgICAgICAgICAgIFRyeUFkZFRvUXVldWVVbml0KHBscnNbMF0sIHBscnNbMF0udW5pdHNMaXN0W2ldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgYnRuVW5pdF9Gb2N1c2VkKE1vbm9JbnRlcmZhY2UuQnV0dG9uIGJ0biwgYm9vbCBpc1RvdWNoKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY1VuaXRzLkNoaWxkcmVuLkNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmIChjVW5pdHMuQ2hpbGRyZW5baV0gPT0gYnRuKVxyXG4gICAgICAgICAgICAgICAgICAgIFNob3dVbml0SW5mbyh1bml0UHJtc1twbHJzWzBdLnVuaXRzTGlzdFtpXV0sIDAsIHRydWUsIG5ldyBQb2ludCgoaW50KShidG4uRmluYWxSaWdodCAvIE1haW5Db250YWluZXIuRmluYWxDaGlsZHJlblNjYWxlWCksIChpbnQpKGJ0bi5GaW5hbEJvdHRvbSAvIE1haW5Db250YWluZXIuRmluYWxDaGlsZHJlblNjYWxlWSkpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBLZXlzW10gbnVtS2V5cyA9IG5ld1tdIHsgS2V5cy5EMSwgS2V5cy5EMiwgS2V5cy5EMywgS2V5cy5ENCwgS2V5cy5ENSwgS2V5cy5ENiwgS2V5cy5ENyB9O1xyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBTZXRVbml0cygpIHtcclxuICAgICAgICAgICAgaWYgKHBscnNbMF0udW5pdHNMaXN0LkNvdW50ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgY1VuaXRzLkNoaWxkcmVuLkNsZWFyKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaW50IGQgPSAwO1xyXG4gICAgICAgICAgICAgICAgaW50IG9sZHQgPSB1bml0UHJtc1twbHJzWzBdLnVuaXRzTGlzdFswXV0uQ29zdC5UaWVyO1xyXG4gICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwbHJzWzBdLnVuaXRzTGlzdC5Db3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVuaXRQcm1zW3BscnNbMF0udW5pdHNMaXN0W2ldXS5Db3N0LlRpZXIgIT0gb2xkdCB8fCB1bml0UHJtc1twbHJzWzBdLnVuaXRzTGlzdFtpXV0uQWJzQ29udGFpbnMoXCJUYXJnZXRcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZCArPSA3O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvbGR0ID0gdW5pdFBybXNbcGxyc1swXS51bml0c0xpc3RbaV1dLkNvc3QuVGllcjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY1VuaXRzLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuQnV0dG9uPihuZXcgTW9ub0ludGVyZmFjZS5CdXR0b24oYnRuVW5pdF9DbGlja2VkLCBidG5Vbml0X0ZvY3VzZWQsIG51bUtleXNbaV0sIGkgKiA2NSArIGQsIDAsIDYwLCA2MCwgaG9yQWxpZ246IDAuMGYpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5QaWN0dXJlPihuZXcgTW9ub0ludGVyZmFjZS5QaWN0dXJlKHVuaXRQcm1zW3BscnNbMF0udW5pdHNMaXN0W2ldXS5pY29uQXBwLCB3OiA2MCwgaDogNjApKTtcclxuICAgICAgICAgICAgICAgICAgICBjVW5pdHMuVyA9IFN5c3RlbS5MaW5xLkVudW1lcmFibGUuTGFzdDxNb25vSW50ZXJmYWNlLkJsb2NrPihjVW5pdHMuQ2hpbGRyZW4pLlJpZ2h0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY1VuaXRzLkFwcGx5VGhlbWUoZGVmYXVsdFRoZW1lKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgU3RhcnRBZ2FpbigpIHtcclxuICAgICAgICAgICAgcGxyc1swXS5SZXNldChjb25kc1tQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0uZGlmZmljdWx0XSk7XHJcbiAgICAgICAgICAgIHBscnNbMV0uUmVzZXQoY29uZHNbUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLmRpZmZpY3VsdF0pO1xyXG4gICAgICAgICAgICBwY3RUaWVyRnJtUmVzb3VyY2VzLnNwcml0ZVJlZiA9IHVuaXRQcm1zW1wiVGllcl8yXCJdLmljb25BcHA7XHJcbiAgICAgICAgICAgIGFtbW9zLkNsZWFyKCk7XHJcbiAgICAgICAgICAgIHVuaXRzLkNsZWFyKCk7XHJcbiAgICAgICAgICAgIHBhcnMuQ2xlYXIoKTtcclxuICAgICAgICAgICAgZGVhdGhsaXN0LkNsZWFyKCk7XHJcbiAgICAgICAgICAgIGJvcm5MaXN0LkNsZWFyKCk7XHJcbiAgICAgICAgICAgIGZybVByb2R1Y3Rpb24uSGlkZShtYWluQW5pbWF0b3IpO1xyXG5cclxuICAgICAgICAgICAgVXBkYXRlUXVldWUoKTtcclxuXHJcblxyXG4gICAgICAgICAgICBpbnQgYmFzZUNudCA9IDA7XHJcblxyXG4gICAgICAgICAgICBpZiAoZ1R5cGUgPT0gR2FtZVR5cGUuU3RhbmRhcnRHVCB8fCBnVHlwZSA9PSBHYW1lVHlwZS5EZWZlbmNlR1QpIHtcclxuICAgICAgICAgICAgICAgIGlmIChwbHJzWzBdLmhlcm8gPT0gXCJDYXN0bGVcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHVuaXRzLkFkZChuZXcgVW5pdCh0aGlzLCB1czIgLSAxLCAxLCAwLCB1bml0UHJtc1tcIkNhc3RsZVwiXSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHVuaXRzW2Jhc2VDbnRdLnBhcmFtZXRlcnMuc3ByaXRlTmFtZSA9IHBscnNbMF0uY2FzdGxlRmlsZU5hbWUgKyBcIjJcIjtcclxuICAgICAgICAgICAgICAgICAgICB1bml0c1tiYXNlQ250XS5wYXJhbWV0ZXJzLnJlY3QgPSBuZXcgUmVjdGFuZ2xlKC0xNSwgLTYwLCA1MCwgNjMpO1xyXG4gICAgICAgICAgICAgICAgICAgIHBscnNbYmFzZUNudF0uYmFzZVggPSB1czI7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHVuaXRzLkFkZChuZXcgVW5pdCh0aGlzLCB1bml0U2l6ZSAtIDEsIDEsIDAsIHVuaXRQcm1zW3BscnNbMF0uaGVyb10pKTtcclxuICAgICAgICAgICAgICAgICAgICBwbHJzWzBdLmJhc2VYID0gLXVzMjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHBscnNbMF0uaGVyb1VuaXQgPSB1bml0c1tiYXNlQ250XTtcclxuICAgICAgICAgICAgICAgIGJhc2VDbnQgKz0gMTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHBscnNbMF0uaGVybyA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICBwbHJzWzBdLmJhc2VYID0gLXVuaXRTaXplO1xyXG4gICAgICAgICAgICAgICAgcGxyc1swXS5oZXJvVW5pdCA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICBpZiAoZ1R5cGUgPT0gR2FtZVR5cGUuU3RhbmRhcnRHVCB8fCBnVHlwZSA9PSBHYW1lVHlwZS5PZmZlbmNlR1QpIHtcclxuICAgICAgICAgICAgICAgIGlmIChwbHJzWzFdLmhlcm8gPT0gXCJDYXN0bGVcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHVuaXRzLkFkZChuZXcgVW5pdCh0aGlzLCBnYW1lV2lkdGggLSB1czIgKyAxLCAtMSwgMSwgdW5pdFBybXNbXCJDYXN0bGVcIl0pKTtcclxuICAgICAgICAgICAgICAgICAgICB1bml0c1tiYXNlQ250XS5wYXJhbWV0ZXJzLnNwcml0ZU5hbWUgPSBwbHJzWzFdLmNhc3RsZUZpbGVOYW1lICsgMjtcclxuICAgICAgICAgICAgICAgICAgICB1bml0c1tiYXNlQ250XS5wYXJhbWV0ZXJzLmltZ3ggPSAtMjA7XHJcbiAgICAgICAgICAgICAgICAgICAgdW5pdHNbYmFzZUNudF0ucGFyYW1ldGVycy5yZWN0ID0gbmV3IFJlY3RhbmdsZSgtMzUsIC01OSwgNTAsIDYzKTtcclxuICAgICAgICAgICAgICAgICAgICBwbHJzWzFdLmJhc2VYID0gZ2FtZVdpZHRoIC0gdXMyO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB1bml0cy5BZGQobmV3IFVuaXQodGhpcywgZ2FtZVdpZHRoIC0gdW5pdFNpemUgKyAxLCAtMSwgMSwgdW5pdFBybXNbcGxyc1sxXS5oZXJvXSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHBscnNbMV0uYmFzZVggPSBnYW1lV2lkdGggKyB1czI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBwbHJzWzFdLmhlcm9Vbml0ID0gdW5pdHNbYmFzZUNudF07XHJcbiAgICAgICAgICAgICAgICBiYXNlQ250ICs9IDE7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBwbHJzWzFdLmhlcm8gPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgcGxyc1sxXS5iYXNlWCA9IGdhbWVXaWR0aCArIHVuaXRTaXplO1xyXG4gICAgICAgICAgICAgICAgcGxyc1sxXS5oZXJvVW5pdCA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGN1ck0gPSBwbHJzWzBdLnJlcy5Nb25leTtcclxuICAgICAgICAgICAgY3VyRCA9IHBscnNbMF0ucmVzLkRlYXRoO1xyXG5cclxuICAgICAgICAgICAgc2VsVSA9IG51bGw7XHJcbiAgICAgICAgICAgIFNldFVuaXRzKCk7XHJcbiAgICAgICAgICAgIFNldFNwZWxscygpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIGlmIChnVHlwZSA9PSBHYW1lVHlwZS5EZWZlbmNlR1QpXHJcbiAgICAgICAgICAgICAgICBSZXNldFdvcmxkKChmbG9hdClNYXRoLlBJLCBkQW5nIC8gMyk7XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKGdUeXBlID09IEdhbWVUeXBlLk9mZmVuY2VHVClcclxuICAgICAgICAgICAgICAgIFJlc2V0V29ybGQoMCwgZEFuZyAvIDMpO1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICBSZXNldFdvcmxkKHN1bkFuZywgZEFuZyk7XHJcbiAgICAgICAgICAgIGlmIChnVHlwZSA9PSBHYW1lVHlwZS5EZWZlbmNlR1QpIHtcclxuICAgICAgICAgICAgICAgIHBscnNbMV0ucmVzLk1vbmV5ICo9IDI7XHJcbiAgICAgICAgICAgICAgICBwbHJzWzFdLnJlcy5EZWF0aCAqPSAyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChnVHlwZSA9PSBHYW1lVHlwZS5PZmZlbmNlR1QpIHtcclxuICAgICAgICAgICAgICAgIHBscnNbMF0ucmVzLk1vbmV5ICo9IDI7XHJcbiAgICAgICAgICAgICAgICBwbHJzWzBdLnJlcy5EZWF0aCAqPSAyO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmb3JlYWNoIChQbGF5ZXIgcCBpbiBwbHJzKSB7XHJcbiAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gb3RoZXJCdWlsZGluZ3MgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcbiAgICAgICAgICAgICAgICBmb3JlYWNoIChzdHJpbmcgYiBpbiBwLmJvbnVzTGlzdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChiID09IFwiVG93ZXJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG93ZXIgPSBuZXcgVW5pdCh0aGlzLCBnYW1lV2lkdGggLyAyIC0gcC5tb3Zlc2lkZSAqIGdhbWVXaWR0aCAvIDYsIHAubW92ZXNpZGUsIHAuaWQsIHVuaXRQcm1zW1wiVG93ZXJcIl0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1bml0cy5BZGQodG93ZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvdGhlckJ1aWxkaW5ncy5BZGQoYik7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvdGhlckJ1aWxkaW5ncy5Db3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJ1aWxkaW5nID0gbmV3IFVuaXQodGhpcywgZ2FtZVdpZHRoIC8gMiAtIHAubW92ZXNpZGUgKiBnYW1lV2lkdGggLyA2IC0gcC5tb3Zlc2lkZSAqICgoZ2FtZVdpZHRoIC8gMyAtIHVzMikgLyAob3RoZXJCdWlsZGluZ3MuQ291bnQgKyAxKSkgKiAoaSArIDEpLCBwLm1vdmVzaWRlLCBwLmlkLCB1bml0UHJtc1tvdGhlckJ1aWxkaW5nc1tpXV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHVuaXRzLkFkZChidWlsZGluZyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZ1N0YXRlID0gR2FtZVN0YXRlLkluR2FtZTtcclxuICAgICAgICAgICAgUGF1c2UgPSBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwcml2YXRlIExpc3Q8c3RyaW5nPiB1bml0c1ByZUdhbWUgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcbiAgICAgICAgcHJpdmF0ZSBMaXN0PHN0cmluZz4gc3BlbGxzUHJlR2FtZSA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgU3RhcnRQcmVHYW1lKCkge1xyXG4gICAgICAgICAgICB1bml0c1ByZUdhbWUuQ2xlYXIoKTtcclxuICAgICAgICAgICAgc3BlbGxzUHJlR2FtZS5DbGVhcigpO1xyXG5cclxuICAgICAgICAgICAgaWYgKG1vZGVTd2l0Y2hlckZybUJhdHRsZS5DdXJyZW50ID09IChpbnQpR2FtZVR5cGUuUmFuZG9tR1QpXHJcbiAgICAgICAgICAgICAgICBnVHlwZSA9IChHYW1lVHlwZSlybmQuTmV4dCgxLCA2KTtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgZ1R5cGUgPSAoR2FtZVR5cGUpbW9kZVN3aXRjaGVyRnJtQmF0dGxlLkN1cnJlbnQ7XHJcblxyXG4gICAgICAgICAgICBpZiAocmFjZXMxW3JhY2VzMVN3aXRjaGVyRnJtQmF0dGxlLkN1cnJlbnRdID09IFwiUmFuZG9tXCIpXHJcbiAgICAgICAgICAgICAgICBwbHJzWzBdLnJhY2UgPSBSYWNlTWFuYWdlci5JbnN0YW5jZS5BbGxbcmFjZXMxW3JuZC5OZXh0KDEsIHJhY2VzMS5Db3VudCldXS5uYW1lO1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICBwbHJzWzBdLnJhY2UgPSByYWNlczFbcmFjZXMxU3dpdGNoZXJGcm1CYXR0bGUuQ3VycmVudF07XHJcbiAgICAgICAgICAgIGlmIChyYWNlczJbcmFjZXMyU3dpdGNoZXJGcm1CYXR0bGUuQ3VycmVudF0gPT0gXCJSYW5kb21cIilcclxuICAgICAgICAgICAgICAgIHBscnNbMV0ucmFjZSA9IFJhY2VNYW5hZ2VyLkluc3RhbmNlLkFsbFtyYWNlczJbcm5kLk5leHQoMSwgcmFjZXMyLkNvdW50KV1dLm5hbWU7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHBscnNbMV0ucmFjZSA9IHJhY2VzMltyYWNlczJTd2l0Y2hlckZybUJhdHRsZS5DdXJyZW50XTtcclxuXHJcblxyXG4gICAgICAgICAgICBwbHJzWzBdLnN5bWIgPSBSYWNlTWFuYWdlci5JbnN0YW5jZS5BbGxbcGxyc1swXS5yYWNlXS5zeW1iO1xyXG4gICAgICAgICAgICBwbHJzWzFdLnN5bWIgPSBSYWNlTWFuYWdlci5JbnN0YW5jZS5BbGxbcGxyc1sxXS5yYWNlXS5zeW1iO1xyXG5cclxuXHJcbiAgICAgICAgICAgIC8vINCS0YvQsdC40YDQsNC10Lwg0YHRg9GJ0LXRgdGC0LIg0L/QtdGA0LLQvtC80YMg0LjQs9GA0L7QutGDXHJcbiAgICAgICAgICAgIGlmIChSYWNlTWFuYWdlci5JbnN0YW5jZS5BbGxbcGxyc1swXS5yYWNlXS5jdXN0b20pIHtcclxuICAgICAgICAgICAgICAgIGZvcmVhY2ggKHN0cmluZyB1bmFtIGluIG5ldyBMaXN0PHN0cmluZz4oKSlcclxuICAgICAgICAgICAgICAgICAgICB1bml0c1ByZUdhbWUuQWRkKHVuYW0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAoVW5pdFBhcmFtZXRlcnMgdSBpbiB1bml0UHJtcy5WYWx1ZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodS5SYWNlID09IHBscnNbMF0ucmFjZSAmJiAhdS5zcGVjaWFsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB1bml0c1ByZUdhbWUuQWRkKHUuTmFtZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdW5pdHNQcmVHYW1lID0gU29ydFVuaXRzTGlzdHModW5pdHNQcmVHYW1lKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBwbHJzWzBdLnVuaXRzTGlzdCA9IHVuaXRzUHJlR2FtZTtcclxuXHJcbiAgICAgICAgICAgIGxibFZzUHJlR2FtZS5UZXh0ID0gc3RyaW5nLkZvcm1hdChcInswfSBWUyB7MX1cIixsb2NhbGl6ZS5HZXRTdHJpbmcocGxyc1swXS5yYWNlKSxsb2NhbGl6ZS5HZXRTdHJpbmcocGxyc1sxXS5yYWNlKSk7XHJcblxyXG4gICAgICAgICAgICBmb3JlYWNoIChTcGVsbCBzcGwgaW4gc3BlbGxzLlZhbHVlcykge1xyXG4gICAgICAgICAgICAgICAgc3BlbGxzUHJlR2FtZS5BZGQoc3BsLk5hbWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNwZWxsc1ByZUdhbWUgPSBTb3J0U3BlbGxzTGlzdHMoc3BlbGxzUHJlR2FtZSk7XHJcbiAgICAgICAgICAgIHBscnNbMF0uc3BsbHNMaXN0ID0gc3BlbGxzUHJlR2FtZTtcclxuXHJcblxyXG4gICAgICAgICAgICBwbHJzWzBdLmJvbnVzTGlzdC5DbGVhcigpO1xyXG4gICAgICAgICAgICBwbHJzWzFdLmJvbnVzTGlzdC5DbGVhcigpO1xyXG5cclxuICAgICAgICAgICAgTGlzdDxzdHJpbmc+IGFsbGJvbnVzZXMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcbiAgICAgICAgICAgIGFsbGJvbnVzZXMuQWRkUmFuZ2Uoc3RhcnRCdWlsZGluZ3NMaXN0KTtcclxuICAgICAgICAgICAgcGxyc1swXS5ib251c0xpc3QuQWRkUmFuZ2UoYWxsYm9udXNlcyk7XHJcbiAgICAgICAgICAgIHBscnNbMV0uYm9udXNMaXN0LkFkZFJhbmdlKGFsbGJvbnVzZXMpO1xyXG5cclxuXHJcblxyXG4gICAgICAgICAgICAvLyBmcm1QcmVHYW1lLkFkZEJ1dHRvbig1LCBkZWx0YSwgMTYsIDE2LCAsIFwiUmFuZG9tVW5pdHNcIiwgS2V5cy5EMSlcclxuICAgICAgICAgICAgLy8gZnJtUHJlR2FtZS5BZGRJbWFnZSg1LCBkZWx0YSwgMTksIDE1LCBcInNtYWxsX2ljb25zXCIsIDE2KVxyXG4gICAgICAgICAgICBjVW5pdHNQcmVHYW1lLkNoaWxkcmVuLkNsZWFyKCk7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKHZhciB1IGluIHVuaXRzUHJlR2FtZSlcclxuICAgICAgICAgICAgICAgIGNVbml0c1ByZUdhbWUuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5CdXR0b24+KG5ldyBNb25vSW50ZXJmYWNlLkJ1dHRvbihidG5Vbml0UHJlR2FtZV9DbGlja2VkLCBidG5Vbml0UHJlR2FtZV9Gb2N1c2VkLCA1LCA1LCA0NSwgNDUsIGhvckFsaWduOiAwLjBmLCB2ZXJBbGlnbjogMC4wZikpLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuUGljdHVyZT4obmV3IE1vbm9JbnRlcmZhY2UuUGljdHVyZSh1bml0UHJtc1t1XS5pY29uQXBwLCB3OiA0NSwgaDogNDUpKTtcclxuICAgICAgICAgICAgY1VuaXRzUHJlR2FtZS5BcHBseVRoZW1lKGRlZmF1bHRUaGVtZSk7XHJcbiAgICAgICAgICAgIC8vIGZybVByZUdhbWUuQWRkQnV0dG9uKDUsIGRlbHRhLCAxNiwgMTYsICwgXCJSYW5kb21TcGVsbHNcIiwgS2V5cy5EMilcclxuICAgICAgICAgICAgLy8gZnJtUHJlR2FtZS5BZGRJbWFnZSg1LCBkZWx0YSwgMTksIDE1LCBcInNtYWxsX2ljb25zXCIsIDE2KVxyXG5cclxuICAgICAgICAgICAgY1NwZWxsc1ByZUdhbWUuQ2hpbGRyZW4uQ2xlYXIoKTtcclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIHMgaW4gc3BlbGxzUHJlR2FtZSlcclxuICAgICAgICAgICAgICAgIGNTcGVsbHNQcmVHYW1lLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuQnV0dG9uPihuZXcgTW9ub0ludGVyZmFjZS5CdXR0b24oYnRuU3BlbGxzUHJlR2FtZV9DbGlja2VkLCBidG5TcGVsbHNQcmVHYW1lX0ZvY3VzZWQsIDUsIDUsIDQ1LCA0NSwgaG9yQWxpZ246IDAuMGYsIHZlckFsaWduOiAwLjBmKSkuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5QaWN0dXJlPihuZXcgTW9ub0ludGVyZmFjZS5QaWN0dXJlKG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcInNwZWxsc19pY29uc1wiXSwgc3BlbGxzW3NdLkltZyksIHc6IDQ1LCBoOiA0NSkpO1xyXG4gICAgICAgICAgICBjU3BlbGxzUHJlR2FtZS5BcHBseVRoZW1lKGRlZmF1bHRUaGVtZSk7XHJcbiAgICAgICAgICAgIC8vIGZybVByZUdhbWUuQWRkQnV0dG9uKDUsIGRlbHRhLCAxNiwgMTYsICwgXCJSYW5kb21CdWlsZGluZ3NcIiwgS2V5cy5EMylcclxuICAgICAgICAgICAgLy8gZnJtUHJlR2FtZS5BZGRJbWFnZSg1LCBkZWx0YSwgMTksIDE1LCBcInNtYWxsX2ljb25zXCIsIDE2KVxyXG5cclxuXHJcbiAgICAgICAgICAgIGNCdWlsZGluZ3NQcmVHYW1lLkNoaWxkcmVuLkNsZWFyKCk7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKHZhciBiIGluIHN0YXJ0QnVpbGRpbmdzTGlzdClcclxuICAgICAgICAgICAgICAgIGNCdWlsZGluZ3NQcmVHYW1lLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuQnV0dG9uPihuZXcgTW9ub0ludGVyZmFjZS5CdXR0b24oYnRuQnVpbGRpbmdQcmVHYW1lX0NsaWNrZWQsIGJ0bkJ1aWxkaW5nUHJlR2FtZV9Gb2N1c2VkLCA1LCA1LCA0NSwgNDUsIGhvckFsaWduOiAwLjBmLCB2ZXJBbGlnbjogMC4wZikpLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuUGljdHVyZT4obmV3IE1vbm9JbnRlcmZhY2UuUGljdHVyZSh1bml0UHJtc1tiXS5pY29uQXBwLCB3OiA0NSwgaDogNDUpKTtcclxuICAgICAgICAgICAgY0J1aWxkaW5nc1ByZUdhbWUuQXBwbHlUaGVtZShkZWZhdWx0VGhlbWUpO1xyXG5cclxuICAgICAgICAgICAgY1NlbGVjdGVkUHJlR2FtZS5DaGlsZHJlbi5DbGVhcigpO1xyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHByZUdhbWVTbG90Q250OyBpKyspXHJcbiAgICAgICAgICAgICAgICBjU2VsZWN0ZWRQcmVHYW1lLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuQnV0dG9uPihuZXcgTW9ub0ludGVyZmFjZS5CdXR0b24oYnRuU2VsZWN0ZWRQcmVHYW1lX0NsaWNrZWQsIGJ0blNlbGVjdGVkUHJlR2FtZV9Gb2N1c2VkLCA1LCA1LCA0NSwgNDUsIGhvckFsaWduOiAwLjBmKSkuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5QaWN0dXJlPihuZXcgTW9ub0ludGVyZmFjZS5QaWN0dXJlKGRlZmF1bHRUaGVtZS5FbXB0eVRleHR1cmUsIHc6IDQ1LCBoOiA0NSkpO1xyXG4gICAgICAgICAgICBjU2VsZWN0ZWRQcmVHYW1lLkFwcGx5VGhlbWUoZGVmYXVsdFRoZW1lKTtcclxuXHJcbiAgICAgICAgICAgIHByZUdhbWVVbml0cy5DbGVhcigpO1xyXG4gICAgICAgICAgICBwcmVHYW1lU3BlbGxzLkNsZWFyKCk7XHJcbiAgICAgICAgICAgIHByZUdhbWVCb251cy5DbGVhcigpO1xyXG5cclxuICAgICAgICAgICAgY1VuaXRzUHJlR2FtZS5WaXNpYmxlID0gdHJ1ZTtcclxuXHJcblxyXG4gICAgICAgICAgICBmcm1QcmVHYW1lLlNob3cobWFpbkFuaW1hdG9yKTtcclxuXHJcbiAgICAgICAgICAgIGJ0blVuaXRzUHJlR2FtZS5DbGljaygwLCAwLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIFNldFByZUdhbWVMaXN0cygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgVGFza0NvbXBsZXRpb25Tb3VyY2U8Ym9vbD4gdGFza0NvbmZpcm07XHJcblxyXG4gICAgICAgIHB1YmxpYyBUYXNrPGJvb2w+IFNob3dEaWFsb2dDb25maXJtYXRpb24oc3RyaW5nIHN0cikge1xyXG4gICAgICAgICAgICBsYmxUZXh0RnJtQ29uZmlybS5UZXh0ID0gc3RyO1xyXG4gICAgICAgICAgICBmcm1Db25maXJtLlNob3cobWFpbkFuaW1hdG9yKTtcclxuXHJcbiAgICAgICAgICAgIHRhc2tDb25maXJtID0gbmV3IFRhc2tDb21wbGV0aW9uU291cmNlPGJvb2w+KCk7XHJcbiAgICAgICAgICAgIHJldHVybiB0YXNrQ29uZmlybS5UYXNrO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFNldFBsYXllckFJKGJvb2wgdmFsKSB7XHJcbiAgICAgICAgICAgIHBscnNbMF0uQUkgPSB2YWw7XHJcbiAgICAgICAgICAgIGxibEFJRnJtQmF0dGxlTWVudS5UZXh0ID0gdmFsID8gXCLQn9C10YDQtdC60LvRjtGH0LjRgtGMINC90LAg0LjQs9GA0L7QutCwXCIgOiBcItCf0LXRgNC10LrQu9GO0YfQuNGC0Ywg0L3QsCDQmNCYXCI7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgU2VsZWN0UGxheWluZ1JhY2UoTGlzdDxzdHJpbmc+IHVMaXN0KSB7XHJcbiAgICAgICAgICAgIERpY3Rpb25hcnk8c3RyaW5nLCBpbnQ+IHRtcGRpYyA9IG5ldyBEaWN0aW9uYXJ5PHN0cmluZywgaW50PigpO1xyXG4gICAgICAgICAgICBzdHJpbmcgbWF4cmFjZSA9IFwiXCI7XHJcbiAgICAgICAgICAgIGludCBtYXhjbnQgPSAwO1xyXG4gICAgICAgICAgICBmb3JlYWNoIChzdHJpbmcgdSBpbiB1TGlzdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRtcGRpYy5Db250YWluc0tleShNeUdhbWUudW5pdFBybXNbdV0uUmFjZSkpXHJcbiAgICAgICAgICAgICAgICAgICAgdG1wZGljW3VuaXRQcm1zW3VdLlJhY2VdICs9IDE7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgdG1wZGljLkFkZCh1bml0UHJtc1t1XS5SYWNlLCAxKTtcclxuICAgICAgICAgICAgICAgIGlmICh0bXBkaWNbdW5pdFBybXNbdV0uUmFjZV0gPiBtYXhjbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBtYXhjbnQgPSB0bXBkaWNbdW5pdFBybXNbdV0uUmFjZV07XHJcbiAgICAgICAgICAgICAgICAgICAgbWF4cmFjZSA9IHVuaXRQcm1zW3VdLlJhY2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG1heHJhY2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBTdGFydFBsYXlpbmcoKSB7XHJcbiAgICAgICAgICAgIFNob3dTb21lQ2hpbGRyZW4oZnJtVW5pdHMsIGZybVJlc291cmNlcyk7XHJcbiAgICAgICAgICAgIEhpZGVTb21lQ2hpbGRyZW4oZnJtTWFpbk1lbnUsIGZybVJpZ2h0TWVudSk7XHJcblxyXG5cclxuICAgICAgICAgICAgU2V0UGxheWVyQUkoc3RhcnRBdXRvZmlnaHQpO1xyXG5cclxuICAgICAgICAgICAgcGxyc1swXS51bml0c0xpc3QuQ2xlYXIoKTtcclxuICAgICAgICAgICAgcGxyc1swXS5zcGxsc0xpc3QuQ2xlYXIoKTtcclxuICAgICAgICAgICAgcGxyc1swXS5ib251c0xpc3QuQ2xlYXIoKTtcclxuXHJcbiAgICAgICAgICAgIHBscnNbMF0udW5pdHNMaXN0LkFkZFJhbmdlKHByZUdhbWVVbml0cyk7XHJcbiAgICAgICAgICAgIHBscnNbMF0uc3BsbHNMaXN0LkFkZFJhbmdlKHByZUdhbWVTcGVsbHMpO1xyXG4gICAgICAgICAgICBwbHJzWzBdLmJvbnVzTGlzdC5BZGRSYW5nZShwcmVHYW1lQm9udXMpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIC8vINCS0YvQsdC40YDQsNC10Lwg0YHRg9GJ0LXRgdGC0LIg0LLRgtC+0YDQvtC80YMg0LjQs9GA0L7QutGDXHJcbiAgICAgICAgICAgIGlmIChSYWNlTWFuYWdlci5JbnN0YW5jZS5BbGxbcGxyc1sxXS5yYWNlXS5jdXN0b20pXHJcbiAgICAgICAgICAgICAgICBwbHJzWzFdLnVuaXRzTGlzdCA9IFJhbmRvbWl6ZVVuaXRzKDcsIG5ldyBMaXN0PHN0cmluZz4oKSwgZmFsc2UpO1xyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBhbGx1bnRzID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAoVW5pdFBhcmFtZXRlcnMgdSBpbiB1bml0UHJtcy5WYWx1ZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodS5SYWNlID09IHBscnNbMV0ucmFjZSAmJiAhdS5zcGVjaWFsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbGx1bnRzLkFkZCh1Lk5hbWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHBscnNbMV0udW5pdHNMaXN0ID0gUmFuZG9taXplVW5pdHMoNywgYWxsdW50cywgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHBscnNbMV0uYm9udXNMaXN0ID0gUmFuZG9taXplQnVpbGRpbmdzKDEwIC0gcGxyc1sxXS51bml0c0xpc3QuQ291bnQsIHBscnNbMV0uYm9udXNMaXN0KTtcclxuXHJcblxyXG5cclxuICAgICAgICAgICAgcGxyc1swXS5oZXJvID0gXCJDYXN0bGVcIjtcclxuICAgICAgICAgICAgcGxyc1sxXS5oZXJvID0gXCJDYXN0bGVcIjtcclxuXHJcbiAgICAgICAgICAgIHBscnNbMF0uY2FzdGxlRmlsZU5hbWUgPSBHZXRDYXRsZUZpbGVOYW1lKHBscnNbMF0ucmFjZSk7XHJcbiAgICAgICAgICAgIHBscnNbMV0uY2FzdGxlRmlsZU5hbWUgPSBHZXRDYXRsZUZpbGVOYW1lKHBscnNbMV0ucmFjZSk7XHJcblxyXG4gICAgICAgICAgICBTdGFydEFnYWluKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAocGxyc1swXS5oZXJvICE9IFwiXCIpXHJcbiAgICAgICAgICAgICAgICB1bml0c1swXS5wYXJhbWV0ZXJzLlJhY2UgPSBwbHJzWzBdLnJhY2U7XHJcblxyXG4gICAgICAgICAgICBpZiAocGxyc1sxXS5oZXJvICE9IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIGlmIChwbHJzWzBdLmhlcm8gPT0gXCJcIilcclxuICAgICAgICAgICAgICAgICAgICB1bml0c1swXS5wYXJhbWV0ZXJzLlJhY2UgPSBwbHJzWzFdLnJhY2U7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgdW5pdHNbMV0ucGFyYW1ldGVycy5SYWNlID0gcGxyc1sxXS5yYWNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBidG5TZWxlY3RVbml0cy5DbGljaygwLCAwLCB0cnVlKTtcclxuXHJcbiAgICAgICAgICAgIFNob3dJbmZvUGFyKGxvY2FsaXplLkdldFN0cmluZyhnVHlwZS5Ub1N0cmluZygpICsgXCJEZXNjXCIpLCBnb29kQWJpbENsciwgZ2FtZVdpZHRoIC8gMiwgZ2FtZUhlaWdodCAvIDIsIHRydWUsIHRydWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0cmluZyBHZXRDYXRsZUZpbGVOYW1lKHN0cmluZyByYWNlKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAocmFjZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcIkh1bWFuc1wiOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcImhxc19kYWVtb25pY1wiO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcIkRlbW9uc1wiOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcImhxc19odW1hblwiO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcIkR3YXJmc1wiOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcImhxc19kdmFydmVuXCI7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiRWx2ZXNcIjpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJocXNfZWx2aXNoXCI7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiSG9yZGVcIjpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJocXNfb3JjaXNoXCI7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiU3RlYW1wdW5rXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiaHFzX3N0ZWFtcHVua1wiO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcIlN3YW1wZXJzXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiaHFzX3N3YW1wY2xhblwiO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcIlVuZGVhZHNcIjpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJocXNfdW5kZWFkXCI7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHJldHVybiBcImhxc1wiO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgU3RhcnRCYXR0bGUoKSB7XHJcbiAgICAgICAgICAgIGZybUJhdHRsZS5TaG93KG1haW5BbmltYXRvcik7XHJcbiAgICAgICAgICAgIGZybVByZUdhbWUuSGlkZShtYWluQW5pbWF0b3IpO1xyXG5cclxuICAgICAgICAgICAgcmFjZXMxU3dpdGNoZXJGcm1CYXR0bGUuQ3VycmVudCA9IDA7XHJcbiAgICAgICAgICAgIHJhY2VzMlN3aXRjaGVyRnJtQmF0dGxlLkN1cnJlbnQgPSAwO1xyXG4gICAgICAgICAgICBtb2RlU3dpdGNoZXJGcm1CYXR0bGUuQ3VycmVudCA9IDE7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBTZXRQcmVHYW1lTGlzdHMoKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcHJlR2FtZVNsb3RDbnQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGJ0biA9IGNTZWxlY3RlZFByZUdhbWUuQ2hpbGRyZW5baV0gYXMgTW9ub0ludGVyZmFjZS5CdXR0b247XHJcbiAgICAgICAgICAgICAgICB2YXIgcGN0ID0gYnRuLkNoaWxkcmVuWzBdIGFzIE1vbm9JbnRlcmZhY2UuUGljdHVyZTtcclxuICAgICAgICAgICAgICAgIGlmIChwcmVHYW1lVW5pdHMuQ291bnQgPiBpKVxyXG4gICAgICAgICAgICAgICAgICAgIHBjdC5zcHJpdGVSZWYgPSB1bml0UHJtc1twcmVHYW1lVW5pdHNbaV1dLmljb25BcHA7XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChwcmVHYW1lU3BlbGxzLkNvdW50ID4gaSAtIHByZUdhbWVVbml0cy5Db3VudClcclxuICAgICAgICAgICAgICAgICAgICBwY3Quc3ByaXRlUmVmID0gbmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW1wic3BlbGxzX2ljb25zXCJdLCBzcGVsbHNbcHJlR2FtZVNwZWxsc1tpIC0gcHJlR2FtZVVuaXRzLkNvdW50XV0uSW1nKTtcclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHByZUdhbWVCb251cy5Db3VudCA+IGkgLSBwcmVHYW1lVW5pdHMuQ291bnQgLSBwcmVHYW1lU3BlbGxzLkNvdW50KVxyXG4gICAgICAgICAgICAgICAgICAgIHBjdC5zcHJpdGVSZWYgPSB1bml0UHJtc1twcmVHYW1lQm9udXNbaSAtIHByZUdhbWVVbml0cy5Db3VudCAtIHByZUdhbWVTcGVsbHMuQ291bnRdXS5pY29uQXBwO1xyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHBjdC5zcHJpdGVSZWYgPSBkZWZhdWx0VGhlbWUuRW1wdHlUZXh0dXJlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBjb21wbGV0ZWRBbGwgPSBwcmVHYW1lVW5pdHMuQ291bnQgKyBwcmVHYW1lU3BlbGxzLkNvdW50ICsgcHJlR2FtZUJvbnVzLkNvdW50ID09IDEwO1xyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB1bml0c1ByZUdhbWUuQ291bnQ7IGkrKylcclxuICAgICAgICAgICAgICAgIChjVW5pdHNQcmVHYW1lLkNoaWxkcmVuW2ldIGFzIE1vbm9JbnRlcmZhY2UuQnV0dG9uKS5Jc0Rpc2FibGVkID0gcHJlR2FtZVVuaXRzLkNvbnRhaW5zKHVuaXRzUHJlR2FtZVtpXSkgfHwgY29tcGxldGVkQWxsIHx8IHByZUdhbWVVbml0cy5Db3VudCA9PSA3O1xyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzcGVsbHNQcmVHYW1lLkNvdW50OyBpKyspXHJcbiAgICAgICAgICAgICAgICAoY1NwZWxsc1ByZUdhbWUuQ2hpbGRyZW5baV0gYXMgTW9ub0ludGVyZmFjZS5CdXR0b24pLklzRGlzYWJsZWQgPSBwcmVHYW1lU3BlbGxzLkNvbnRhaW5zKHNwZWxsc1ByZUdhbWVbaV0pIHx8IGNvbXBsZXRlZEFsbCB8fCBwcmVHYW1lU3BlbGxzLkNvdW50ID09IDc7XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0YXJ0QnVpbGRpbmdzTGlzdC5Db3VudDsgaSsrKVxyXG4gICAgICAgICAgICAgICAgKGNCdWlsZGluZ3NQcmVHYW1lLkNoaWxkcmVuW2ldIGFzIE1vbm9JbnRlcmZhY2UuQnV0dG9uKS5Jc0Rpc2FibGVkID0gcHJlR2FtZUJvbnVzLkNvbnRhaW5zKHN0YXJ0QnVpbGRpbmdzTGlzdFtpXSkgfHwgY29tcGxldGVkQWxsIHx8IHByZUdhbWVCb251cy5Db3VudCA9PSA3O1xyXG5cclxuICAgICAgICAgICAgYnRuRmlnaHRQcmVHYW1lLklzRGlzYWJsZWQgPSBwcmVHYW1lVW5pdHMuQ291bnQgKyBwcmVHYW1lU3BlbGxzLkNvdW50ICsgcHJlR2FtZUJvbnVzLkNvdW50ID09IDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBTZXRFZGl0b3JVbml0cygpIHtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBMaXN0PHN0cmluZz4gU29ydFVuaXRzTGlzdHMoTGlzdDxzdHJpbmc+IHVuaXRzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBTeXN0ZW0uTGlucS5FbnVtZXJhYmxlLk9yZGVyQnk8c3RyaW5nLGludD4odW5pdHNcclxuLChGdW5jPHN0cmluZyxpbnQ+KSh1bml0ID0+IHVuaXRQcm1zW3VuaXRdLkNvc3QuVGllcikpXHJcbiAgICAgICAgICAgICAgICAuVGhlbkJ5PGludD4oKEZ1bmM8c3RyaW5nLGludD4pKHVuaXQgPT4gdW5pdFBybXNbdW5pdF0uQ29zdC5Nb25leSkpXHJcbiAgICAgICAgICAgICAgICAuVG9MaXN0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgTGlzdDxzdHJpbmc+IFNvcnRTcGVsbHNMaXN0cyhMaXN0PHN0cmluZz4gc3BlbGxzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBTeXN0ZW0uTGlucS5FbnVtZXJhYmxlLk9yZGVyQnk8c3RyaW5nLGludD4oc3BlbGxzXHJcbiwoRnVuYzxzdHJpbmcsaW50Pikoc3BlbGwgPT4gdGhpcy5zcGVsbHNbc3BlbGxdLkNvc3QuVGllcikpXHJcbiAgICAgICAgICAgICAgICAuVGhlbkJ5PGludD4oKEZ1bmM8c3RyaW5nLGludD4pKHNwZWxsID0+IHRoaXMuc3BlbGxzW3NwZWxsXS5Db3N0LkRlYXRoKSlcclxuICAgICAgICAgICAgICAgIC5Ub0xpc3QoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBib29sIFBhdXNlIHtcclxuICAgICAgICAgICAgZ2V0IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBfcGF1c2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0IHtcclxuICAgICAgICAgICAgICAgIF9wYXVzZSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgaWYgKGdTdGF0ZSA9PSBHYW1lU3RhdGUuSW5HYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKF9wYXVzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwY3RQYXVzZUZybVJlc291cmNlcy5zcHJpdGVSZWYgPSBuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJtZWRpdW1faWNvbnNcIl0sIDgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmcm1CYXR0bGVNZW51LlNob3cobWFpbkFuaW1hdG9yKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwY3RQYXVzZUZybVJlc291cmNlcy5zcHJpdGVSZWYgPSBuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJtZWRpdW1faWNvbnNcIl0sIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmcm1CYXR0bGVNZW51LkhpZGUobWFpbkFuaW1hdG9yKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIE5ld2Jvcm4oaW50IHBsciwgVW5pdCB1LCBib29sIGluU3RhY2spIHtcclxuICAgICAgICAgICAgZm9yZWFjaCAoVW5pdCB1dSBpbiB1bml0cykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHV1Lm93bmVyID09IHBscnNbcGxyXS5pZCAmJiB1dS5BYnNDb250YWlucyhcIldvbWJBYmlsXCIpKVxyXG4gICAgICAgICAgICAgICAgICAgIHUueCA9IHV1LnggKyA1ICogcGxyc1twbHJdLm1vdmVzaWRlO1xyXG4gICAgICAgICAgICAgICAgaWYgKHV1Lm93bmVyID09IHBscnNbcGxyXS5pZCAmJiB1dS5BYnNDb250YWlucyhcIlN0YWNrX2hlbHBlclwiKSAmJiBpblN0YWNrKVxyXG4gICAgICAgICAgICAgICAgICAgIHUueCA9IHV1LnggKyAxMCAqIHBscnNbcGxyXS5tb3Zlc2lkZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodS5BYnNDb250YWlucyhcIlJhbmRvbV9wb3NpdGlvblwiKSkge1xyXG4gICAgICAgICAgICAgICAgdS54ID0gcm5kLk5leHQoNTAsIGdhbWVXaWR0aCAtIDQ5KTtcclxuICAgICAgICAgICAgICAgIHBhcnMuQWRkKG5ldyBJbWFnZVBhcnRpY2xlKG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcImV4cGxvZGVcIl0sIDIpLCB1LnggLSAyNSwgaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuQm90dG9tIC0gdXMyIC0gMjUsIDAsIDAsIDIwKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHUuQWJzQ29udGFpbnMoXCJGcmVlXCIpKSB7XHJcbiAgICAgICAgICAgICAgICB1LnBhcmFtZXRlcnMuQ29zdC5Nb25leSA9IDgwO1xyXG4gICAgICAgICAgICAgICAgaWYgKHUueCA8PSBnYW1lV2lkdGggLyAoZG91YmxlKTIpIHtcclxuICAgICAgICAgICAgICAgICAgICB1Lm93bmVyID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB1Lm1vdmVzaWRlID0gcGxyc1swXS5tb3Zlc2lkZTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdS5vd25lciA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgdS5tb3Zlc2lkZSA9IHBscnNbMV0ubW92ZXNpZGU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHUuYWJpbHMuQ29udGFpbnNLZXkoXCJTYWNyaWZpY2VcIikpIHtcclxuICAgICAgICAgICAgICAgIHZhciB1dSA9IEZpbmRSYW5kb21VbmZseVVuaXQoMSAtIHBscik7XHJcbiAgICAgICAgICAgICAgICBpZiAodXUgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHUueCA9IHV1Lng7XHJcbiAgICAgICAgICAgICAgICAgICAgS2lsbCh1dSk7XHJcbiAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCLQn9GA0LjQt9Cy0LDQvVwiLCBnb29kQWJpbENsciwgdS54LCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh1LmFiaWxzLkNvbnRhaW5zS2V5KFwiQXNzYXVsdFwiKSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHV1ID0gRmluZEZpcnN0VW5mbHlVbml0KHBscik7XHJcbiAgICAgICAgICAgICAgICBpZiAodXUgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHUueCA9IHV1LnggLSB1czIgKiBwbHJzW3Bscl0ubW92ZXNpZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFycy5BZGQobmV3IEltYWdlUGFydGljbGUobmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW1wiZXhwbG9kZVwiXSwgMiksIHUueCAtIDI1LCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Cb3R0b20gLSB1czIgLSAyNSwgMCwgMCwgMjApKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodS5hYmlscy5Db250YWluc0tleShcIkVuY291cmFnZV9maXJzdFwiKSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHV1ID0gRmluZEZpcnN0VW5mbHlVbml0KHUub3duZXIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHV1ICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICB1LmFiaWxzW1wiRW5jb3VyYWdlX2ZpcnN0XCJdLnVzZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHV1LnBhcmFtZXRlcnMuQXJtb3IgPSBcIkhlYXZ5XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgdXUuQXR0YWNrICs9IHUuYWJpbHNbXCJFbmNvdXJhZ2VfZmlyc3RcIl0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCLQo9GB0LjQu9C10L1cIiwgZ29vZEFiaWxDbHIsIHV1LngsIGhvciArIHV1LnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh1LmFiaWxzLkNvbnRhaW5zS2V5KFwiU3dhcm1cIikpIHtcclxuICAgICAgICAgICAgICAgIGZvcmVhY2ggKFVuaXQgdXUgaW4gdW5pdHMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodXUgIT0gdSAmJiB1dS5vd25lciA9PSB1Lm93bmVyICYmIHV1LkFic0NvbnRhaW5zKFwiU3dhcm1cIikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHV1LkF0dGFjayArPSB1LmFiaWxzW1wiU3dhcm1cIl0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZm9yZWFjaCAoVW5pdCB1dSBpbiB1bml0cykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHV1Lm93bmVyICE9IHUub3duZXIgJiYgdXUuQWJzQ29udGFpbnMoXCJQb2lzb25fb25fcHJvZFwiKSAmJiBybmQuTmV4dCgxMDApIDwgdXUuYWJpbHNbXCJQb2lzb25fb25fcHJvZFwiXS52YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHUuQWRkQWJpbGl0eShcIlBvaXNvblwiLCBFZmZlY3RUeXBlLlBvaXNvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCLQktGA0LDQsyDQvtGC0YDQsNCy0LvQtdC9XCIsIGdvb2RBYmlsQ2xyLCB1dS54LCBob3IgKyB1dS5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBQcm9kdWNlVW5pdChpbnQgcGxyLCBzdHJpbmcgbmFtZSwgaW50IGF0a2JvbnVzID0gMCwgaW50IGhwYm9udXMgPSAwLCBzdHJpbmcgYXJtb3JDaGFuZ2UgPSBcIlwiLCBMaXN0PEFiaWxpdHk+IGFkZGFiaWxzID0gbnVsbCwgYm9vbCBpblN0YWNrID0gZmFsc2UpIHtcclxuICAgICAgICAgICAgaWYgKCF1bml0UHJtc1tuYW1lXS51cGdyYWRlKSB7XHJcbiAgICAgICAgICAgICAgICBVbml0IHUgPSBuZXcgVW5pdCh0aGlzLCBwbHJzW3Bscl0uYmFzZVggKyBwbHJzW3Bscl0ubW92ZXNpZGUsIHBscnNbcGxyXS5tb3Zlc2lkZSwgcGxyc1twbHJdLmlkLCB1bml0UHJtc1tuYW1lXSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoYWRkYWJpbHMgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKEFiaWxpdHkgYSBpbiBhZGRhYmlscylcclxuICAgICAgICAgICAgICAgICAgICAgICAgdS5BZGRBYmlsaXR5KGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdS5BdHRhY2sgKz0gYXRrYm9udXM7XHJcbiAgICAgICAgICAgICAgICB1LnBhcmFtZXRlcnMubWF4aHAgKz0gaHBib251cztcclxuICAgICAgICAgICAgICAgIHUuaHAgKz0gaHBib251cztcclxuICAgICAgICAgICAgICAgIGlmIChhcm1vckNoYW5nZSAhPSBcIlwiKVxyXG4gICAgICAgICAgICAgICAgICAgIHUucGFyYW1ldGVycy5Bcm1vciA9IGFybW9yQ2hhbmdlO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICBOZXdib3JuKHBsciwgdSwgaW5TdGFjayk7XHJcbiAgICAgICAgICAgICAgICBib3JuTGlzdC5BZGQodSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKG5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiVGllcl8yXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBscnNbcGxyXS5yZXMuVGllciArPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBsciA9PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBjdFRpZXJGcm1SZXNvdXJjZXMuc3ByaXRlUmVmID0gdW5pdFBybXNbXCJUaWVyXzNcIl0uaWNvbkFwcDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJUaWVyXzNcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxyc1twbHJdLnJlcy5UaWVyICs9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAoVW5pdCB1IGluIHVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHUub3duZXIgPT0gcGxyICYmIHUuQWJzQ29udGFpbnMoXCJSZWZyZXNoXCIpICYmIHUuaHAgPCB1LnBhcmFtZXRlcnMubWF4aHApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdS5ocCA9IHUucGFyYW1ldGVycy5tYXhocDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCLQktC+0YHRgdGC0LDQvdC+0LLQu9C10L1cIiwgZ29vZEFiaWxDbHIsIHUueCwgaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEtpbGwoVW5pdCB1KSB7XHJcbiAgICAgICAgICAgIGlmICghZGVhdGhsaXN0LkNvbnRhaW5zKHUpKVxyXG4gICAgICAgICAgICAgICAgZGVhdGhsaXN0LkFkZCh1KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIENoYW5nZUxhbmRzY2FwZShMYW5kc2NhcGVUeXBlIG5ld2wpIHtcclxuICAgICAgICAgICAgYmFja3BhcnMuQ2xlYXIoKTtcclxuICAgICAgICAgICAgYnVzaHBhcnMuQ2xlYXIoKTtcclxuICAgICAgICAgICAgc3dpdGNoIChuZXdsKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIExhbmRzY2FwZVR5cGUuUGxhaW5MUzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYW5kQm1wID0gXCJncm91bmRcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW50IG51bSA9IHJuZC5OZXh0KDUsIDExKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW07IGkrKylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhY2twYXJzLkFkZChuZXcgSW1hZ2VQYXJ0aWNsZShuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJiYWNrMFwiXSwgcm5kLk5leHQoNCkpLCAoZmxvYXQpKDEyNSArIChnYW1lV2lkdGggLSAyNTApIC8gKG51bSAtIDEpICogaSAtIDQyICsgNDAgKiBybmQuTmV4dERvdWJsZSgpKSwgaG9yIC0gNzAsIDAsIDAsIC0xLCBybmQuTmV4dERvdWJsZSgpID4gMC41KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG51bSA9IHJuZC5OZXh0KDQwLCA1MSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtOyBpKyspXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidXNocGFycy5BZGQobmV3IEltYWdlUGFydGljbGUobmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW1wiYnVzaDBcIl0sIHJuZC5OZXh0KDUpKSwgKGZsb2F0KShnYW1lV2lkdGggLyAobnVtIC0gMSkgKiBpIC0gNDIgKyA0MCAqIHJuZC5OZXh0RG91YmxlKCkpLCBob3IgLSAxNSwgMCwgMCwgLTEpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgTGFuZHNjYXBlVHlwZS5EZXNlcnRMUzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYW5kQm1wID0gXCJkZXNlcnRcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgTGFuZHNjYXBlVHlwZS5Td2FtcExTOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhbmRCbXAgPSBcInN3YW1wXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGludCBudW0gPSBybmQuTmV4dCgxMCwgMTEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bTsgaSsrKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFja3BhcnMuQWRkKG5ldyBJbWFnZVBhcnRpY2xlKG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcImJhY2sxXCJdLCBybmQuTmV4dCgzKSksIChmbG9hdCkoMTI1ICsgKGdhbWVXaWR0aCAtIDI1MCkgLyAobnVtIC0gMSkgKiBpIC0gNDIgKyA0MCAqIHJuZC5OZXh0RG91YmxlKCkpLCBob3IgLSA3MCwgMCwgMCwgLTEsIHJuZC5OZXh0RG91YmxlKCkgPiAwLjUpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgTGFuZHNjYXBlVHlwZS5EZWF0aGxhbmRMUzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYW5kQm1wID0gXCJkZWF0aGxhbmRcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW50IG51bSA9IHJuZC5OZXh0KDUsIDExKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW07IGkrKylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhY2twYXJzLkFkZChuZXcgSW1hZ2VQYXJ0aWNsZShuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJiYWNrMlwiXSwgcm5kLk5leHQoNCkpLCAoZmxvYXQpKDEyNSArIChnYW1lV2lkdGggLSAyNTApIC8gKG51bSAtIDEpICogaSAtIDUwICsgNDAgKiBybmQuTmV4dERvdWJsZSgpKSwgaG9yIC0gNzAsIDAsIDAsIC0xLCBybmQuTmV4dERvdWJsZSgpID4gMC41KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlIExhbmRzY2FwZVR5cGUuTWVjaGFuaWNzTFM6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGFuZEJtcCA9IFwibWVjaGFuaWNzXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlIExhbmRzY2FwZVR5cGUuRm9yZXN0TFM6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGFuZEJtcCA9IFwiZm9yZXN0XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGludCBudW0gPSBybmQuTmV4dCgxMCwgMTYpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bTsgaSsrKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFja3BhcnMuQWRkKG5ldyBJbWFnZVBhcnRpY2xlKG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcImJhY2swXCJdLCBybmQuTmV4dCg0KSksIDEyNSArIChnYW1lV2lkdGggLSAyNTApIC8gKG51bSAtIDEpICogaSAtIDMyICsgMjAgKiAoZmxvYXQpcm5kLk5leHREb3VibGUoKSwgaG9yIC0gNzAsIDAsIDAsIC0xLCBybmQuTmV4dERvdWJsZSgpID4gMC41KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlIExhbmRzY2FwZVR5cGUuSW5mZXJub0xTOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhbmRCbXAgPSBcImluZmVybm9sYW5kXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBUZXh0dXJlMkQgYmFja0ZpbGxUZXg7XHJcblxyXG4gICAgICAgIHByaXZhdGUgVGV4dHVyZTJEIGhlYWx0aEJhckJhY2tUZXg7XHJcbiAgICAgICAgcHJpdmF0ZSBUZXh0dXJlMkQgaGVhbHRoQmFyTGlmZVRleDtcclxuICAgICAgICBwcml2YXRlIFRleHR1cmUyRCBoZWFsdGhCYXJQb2lzb25UZXg7XHJcbiAgICAgICAgcHJpdmF0ZSBUZXh0dXJlMkQgaGVhbHRoQmFyQWJpbFRleDtcclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgVXBkYXRlU2t5VGV4dHVyZShUZXh0dXJlMkQgdGV4LCBpbnQgaCwgZG91YmxlIGNscjFSLCBkb3VibGUgY2xyMUcsIGRvdWJsZSBjbHIxQiwgZG91YmxlIGNscjFBLCBkb3VibGUgY2xyMlIsIGRvdWJsZSBjbHIyRywgZG91YmxlIGNscjJCLCBkb3VibGUgY2xyMkEpIHtcclxuICAgICAgICAgICAgdmFyIGRSID0gKGNscjJSIC0gY2xyMVIpIC8gaDtcclxuICAgICAgICAgICAgdmFyIGRHID0gKGNscjJHIC0gY2xyMUcpIC8gaDtcclxuICAgICAgICAgICAgdmFyIGRCID0gKGNscjJCIC0gY2xyMUIpIC8gaDtcclxuICAgICAgICAgICAgdmFyIGRBID0gKGNscjJBIC0gY2xyMUEpIC8gaDtcclxuI2lmIEJST1dTRVJcclxuICAgICAgICAgICAgdmFyIGRhdGEgPSBuZXcgaW50W2ggKiA0XTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBoICogNDsgaSArPSA0KSB7XHJcbiAgICAgICAgICAgICAgICBkYXRhW2ldID0gKGludCljbHIxUjtcclxuICAgICAgICAgICAgICAgIGRhdGFbaSArIDFdID0gKGludCljbHIxRztcclxuICAgICAgICAgICAgICAgIGRhdGFbaSArIDJdID0gKGludCljbHIxQjtcclxuICAgICAgICAgICAgICAgIGRhdGFbaSArIDNdID0gKGludCljbHIxQTtcclxuICAgICAgICAgICAgICAgIGNscjFSICs9IGRSO1xyXG4gICAgICAgICAgICAgICAgY2xyMUcgKz0gZEc7XHJcbiAgICAgICAgICAgICAgICBjbHIxQiArPSBkQjtcclxuICAgICAgICAgICAgICAgIGNscjFBICs9IGRBO1xyXG4gICAgICAgICAgICB9XHJcbiNlbHNlXHJcbiAgICAgICAgICAgIHZhciBkYXRhID0gbmV3IENvbG9yW2hdO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGg7IGkgKz0gMSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZGF0YVtpXSA9IG5ldyBDb2xvcigoaW50KWNscjFSLCAoaW50KWNscjFHLCAoaW50KWNscjFCLCAoaW50KWNscjFBKTtcclxuICAgICAgICAgICAgICAgIGNscjFSICs9IGRSO1xyXG4gICAgICAgICAgICAgICAgY2xyMUcgKz0gZEc7XHJcbiAgICAgICAgICAgICAgICBjbHIxQiArPSBkQjtcclxuICAgICAgICAgICAgICAgIGNscjFBICs9IGRBO1xyXG4gICAgICAgICAgICB9XHJcbiNlbmRpZlxyXG4gICAgICAgICAgICB0ZXguU2V0RGF0YTxDb2xvcj4oZGF0YSwgMCwgaCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIFRleHR1cmUyRCBza3l0ZXh0dXJlO1xyXG4gICAgICAgIHByaXZhdGUgVGV4dHVyZTJEIHN1bnNldHRleHR1cmU7XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIERyYXcoKSB7XHJcbiAgICAgICAgICAgIHNreVIgPSBjbnN0UiAqICgwLjVmICsgc25TIC8gMik7XHJcbiAgICAgICAgICAgIHNreUcgPSBjbnN0RyAqICgwLjVmICsgc25TIC8gMik7XHJcbiAgICAgICAgICAgIHNreUIgPSBjbnN0QiAqICgwLjVmICsgc25TIC8gMik7XHJcbiAgICAgICAgICAgIHNreVIyID0gY25zdFIyICogKDAuNjZmICsgc25TIC8gMyk7XHJcbiAgICAgICAgICAgIHNreUcyID0gY25zdEcyICogKDAuNjZmICsgc25TIC8gMyk7XHJcbiAgICAgICAgICAgIHNreUIyID0gY25zdEIyICogKDAuNjZmICsgc25TIC8gMyk7XHJcbiAgICAgICAgICAgIC8vIGxnYiA9IE5ldyBEcmF3aW5nMkQuTGluZWFyR3JhZGllbnRCcnVzaChza3lyZWN0LCBOZXcgQ29sb3Ioc2t5Uiwgc2t5Rywgc2t5QiksIE5ldyBDb2xvcihza3lSMiwgc2t5RzIsIHNreUIyKSwgOTApXHJcbiAgICAgICAgICAgIC8vIGcuRmlsbFJlY3RhbmdsZShsZ2IsIHNreXJlY3QpXHJcblxyXG4gICAgICAgICAgICBVcGRhdGVTa3lUZXh0dXJlKHNreXRleHR1cmUsIHNreXJlY3QuSGVpZ2h0LCBza3lSLCBza3lHLCBza3lCLCAyNTUsIHNreVIyLCBza3lHMiwgc2t5QjIsIDI1NSk7XHJcbiAgICAgICAgICAgIEZpbGxSZWN0YW5nbGUoc3ByaXRlQmF0Y2gsIHNreXRleHR1cmUsIHNreXJlY3QpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHNuUyA+IC0wLjUgJiYgc25TIDwgMC41KSB7XHJcbiAgICAgICAgICAgICAgICAvLyBzdW5zZXRsZ2IgPSBOZXcgRHJhd2luZzJELkxpbmVhckdyYWRpZW50QnJ1c2goc2t5cmVjdCwgQ29sb3IuRW1wdHksIENvbG9yLkZyb21BcmdiKCgxIC0gTWF0aC5BYnMoc25TKSAqIDIpICogMTAwLCBzdW5zZXRjbHIpLCA5MClcclxuICAgICAgICAgICAgICAgIFVwZGF0ZVNreVRleHR1cmUoc3Vuc2V0dGV4dHVyZSwgc2t5cmVjdC5IZWlnaHQsIDAsIDAsIDAsIDAsIHN1bnNldGNsci5SLCBzdW5zZXRjbHIuRywgc3Vuc2V0Y2xyLkIsICgxIC0gTWF0aC5BYnMoc25TKSAqIDIpICogMTAwKTtcclxuICAgICAgICAgICAgICAgIEZpbGxSZWN0YW5nbGUoc3ByaXRlQmF0Y2gsIHN1bnNldHRleHR1cmUsIHNreXJlY3QpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIHN1bnNldGxnYiA9IE5ldyBEcmF3aW5nMkQuTGluZWFyR3JhZGllbnRCcnVzaChza3lyZWN0LCBDb2xvci5FbXB0eSwgTmV3IENvbG9yKCgxIC0gTWF0aC5BYnMoc25TKSAqIDIpICogMTAwLCBzdW5zZXRjbHIpLCA5MClcclxuICAgICAgICAgICAgLy8gZy5GaWxsUmVjdGFuZ2xlKHN1bnNldGxnYiwgc2t5cmVjdClcclxuXHJcbiAgICAgICAgICAgIGlmIChzblMgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN0YXJzQ250OyBpKyspXHJcbiAgICAgICAgICAgICAgICAgICAgRmlsbFJlY3RhbmdsZShzcHJpdGVCYXRjaCwgc3RhclRleCwgKGludClzdGFyc1tpXS5YLCAoaW50KXN0YXJzW2ldLlksIDEsIDEpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgIGZvcmVhY2ggKFBhcnRpY2xlIHAgaW4gYmFja3BhcnMpXHJcbiAgICAgICAgICAgICAgICBwLlhOQURyYXcoc3ByaXRlQmF0Y2gpO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGdhbWVXaWR0aDsgaSArPSAxMDApXHJcbiAgICAgICAgICAgICAgICBzcHJpdGVzW2xhbmRCbXBdLkRyYXcoMCwgaSwgaG9yIC0gMjAsIHNwcml0ZUJhdGNoKTtcclxuXHJcbiAgICAgICAgICAgIGZvcmVhY2ggKFBhcnRpY2xlIHAgaW4gYnVzaHBhcnMpXHJcbiAgICAgICAgICAgICAgICBwLlhOQURyYXcoc3ByaXRlQmF0Y2gpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHNlbFUgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgc3ByaXRlc1tcImVmZmVjdHNcIl0uRHJhdygwLCBzZWxVLnggKyBkZWx0YXggLSAxNCwgaG9yIC0gMjIsIHNwcml0ZUJhdGNoKTtcclxuICAgICAgICAgICAgICAgIGlmIChzZWxVLkF0dGFjay5SYW5nZSA+IDEpIHtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZm9yZWFjaCAoVW5pdCB1IGluIHVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodS5vd25lciA9PSAwIHx8ICF1LkFic0NvbnRhaW5zKFwiSW52aXNpYmxlXCIpKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIElmIHUgSXNOb3Qgc2VsVSBBbmQgdS54ICsgdS5wYXJhbXMucmVjdC5SaWdodCA+IG0uWCBBbmQgbS5YID4gdS54ICsgdS5wYXJhbXMucmVjdC5MZWZ0IEFuZCBob3IgKyB1LnBhcmFtcy5yZWN0LkJvdHRvbSA+IG0uWSBBbmQgbS5ZID4gaG9yICsgdS5wYXJhbXMucmVjdC5Ub3AgVGhlblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIERyYXdTcHJpdGUoc3ByaXRlQmF0Y2gsIFwiZWZmZWN0c1wiLCAwLCB1LnggKyBkZWx0YXggLSAxNCwgaG9yIC0gMjIpXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gRW5kIElmXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGRlbHRheSA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVsdGF4ID0gMDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF1LnBhcmFtZXRlcnMuaXNCdWlsZGluZyAmJiB1LmF0a1JlY2hhcmdlID4gdS5wYXJhbWV0ZXJzLkF0dGFjay5TcGVlZCAtIDMwICYmIHUuYXRrUmVjaGFyZ2UgPCB1LnBhcmFtZXRlcnMuQXR0YWNrLlNwZWVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWx0YXggPSB1Lm1vdmVzaWRlICogKHUuYXRrUmVjaGFyZ2UgLSB1LnBhcmFtZXRlcnMuQXR0YWNrLlNwZWVkICsgMzApIC8gMTA7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghdS5pc0luQ29tYmF0ICYmIHUucGFyYW1ldGVycy5tb3ZlVHlwZSA9PSBVbml0TW92ZVR5cGUuRmx5aW5nTVQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUuQWJzQ29udGFpbnMoXCJCb2R5bGVzc1wiKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbHRheSA9IDNmICogKGZsb2F0KU1hdGguU2luKHUud2luZ3NXYXZlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsdGF5ID0gMmYgKiAoZmxvYXQpTWF0aC5TaW4odS53aW5nc1dhdmUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBzcHJpdGVzW1wiZWZmZWN0c1wiXS5EcmF3KDEsIHUueCArIGRlbHRheCAtIDE1LCBob3IgLSAyMiwgc3ByaXRlQmF0Y2gpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAodS5tb3Zlc2lkZSA9PSAxKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB1LkRyYXdDdXJyZW50KChpbnQpKHUueCArIHUucGFyYW1ldGVycy5yZWN0LkxlZnQgKyBkZWx0YXggKyB1LnBhcmFtZXRlcnMuaW1neCksIChpbnQpKGhvciArIHUucGFyYW1ldGVycy5yZWN0LlRvcCArIGRlbHRheSArIHUucGFyYW1ldGVycy5pbWd5ICsgMSksIHNwcml0ZUJhdGNoKTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHUuRHJhd0N1cnJlbnQoKGludCkodS54ICsgdS5wYXJhbWV0ZXJzLnJlY3QuUmlnaHQgKyBkZWx0YXggLSBNeUdhbWUuc3ByaXRlc1t1LnBhcmFtZXRlcnMuc3ByaXRlTmFtZV0uVyAtIHUucGFyYW1ldGVycy5pbWd4KSwgKGludCkoaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuVG9wICsgZGVsdGF5ICsgdS5wYXJhbWV0ZXJzLmltZ3kgKyAxKSwgc3ByaXRlQmF0Y2gsIFNwcml0ZUVmZmVjdHMuRmxpcEhvcml6b250YWxseSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1LkFic0NvbnRhaW5zKFwiSW52aXNpYmxlXCIpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzcHJpdGVzW1wiZWZmZWN0c1wiXS5EcmF3KDIsIHUueCAtIDE2LCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5ZIC0gMzIsIHNwcml0ZUJhdGNoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIGZvcmVhY2ggKEFtbW8gYSBpbiBhbW1vcykge1xyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChhLnR5cGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIEFtbW8uQW1tb1R5cGUuQXJyb3c6XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBBbW1vLkFtbW9UeXBlLkZhc3RBcnJvdzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxvYXQgZHgsIGR5O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxvYXQgbiA9IChmbG9hdClNYXRoLlNxcnQoYS52eCAqIGEudnggKyBhLnZ5ICogYS52eSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkeCA9IGEudnggLyBuICogNjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR5ID0gYS52eSAvIG4gKiA2O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBBbW1vLkFtbW9UeXBlLkJpZ0Fycm93OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbG9hdCBkeCwgZHk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbG9hdCBuID0gKGZsb2F0KU1hdGguU3FydChhLnZ4ICogYS52eCArIGEudnkgKiBhLnZ5KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR4ID0gYS52eCAvIG4gKiAxMjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR5ID0gYS52eSAvIG4gKiAxMjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhLnZ4ID49IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ByaXRlc1tcImFtbW9zXCJdLkRyYXcoYS5pbWcsIGEueCAtIDUsIGEueSAtIDUsIHNwcml0ZUJhdGNoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcHJpdGVzW1wiYW1tb3NcIl0uRHJhdyhhLmltZywgYS54IC0gNSwgYS55IC0gNSwgc3ByaXRlQmF0Y2gsIFNwcml0ZUVmZmVjdHMuRmxpcEhvcml6b250YWxseSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgZm9yZWFjaCAoUGFydGljbGUgcCBpbiBwYXJzKVxyXG4gICAgICAgICAgICAgICAgcC5YTkFEcmF3KHNwcml0ZUJhdGNoKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChnU3RhdGUgPT0gR2FtZVN0YXRlLkluR2FtZSB8fCBnU3RhdGUgPT0gR2FtZVN0YXRlLldpbiB8fCBnU3RhdGUgPT0gR2FtZVN0YXRlLkxvc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChwbHJzWzBdLmhlcm8gPT0gXCJDYXN0bGVcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjYXN0bGVibXAgPSBwbHJzWzBdLmNhc3RsZUZpbGVOYW1lICsgXCIxXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgc3ByaXRlc1tjYXN0bGVibXBdLkRyYXcoMCwgMCwgaG9yIC0gMiAqIHVuaXRTaXplICsgMSwgc3ByaXRlQmF0Y2gpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHBscnNbMV0uaGVybyA9PSBcIkNhc3RsZVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNhc3RsZWJtcCA9IHBscnNbMV0uY2FzdGxlRmlsZU5hbWUgKyBcIjFcIjtcclxuICAgICAgICAgICAgICAgICAgICBzcHJpdGVzW2Nhc3RsZWJtcF0uRHJhdygxLCBnYW1lV2lkdGggLSB1bml0U2l6ZSArIDEsIGhvciAtIDIgKiB1bml0U2l6ZSArIDIsIHNwcml0ZUJhdGNoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHNuUyA8IDAuMikge1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoc25TID4gMClcclxuICAgICAgICAgICAgICAgIHNwcml0ZXNbXCJ3b3JsZFwiXS5EcmF3KDAsIGdhbWVXaWR0aCAvIDIgLSAoZ2FtZVdpZHRoIC8gMiArIDgwKSAqIGNzUyAtIDYwLCBnYW1lSGVpZ2h0IC0gKGdhbWVIZWlnaHQgLSAxNDApICogc25TIC0gNjAsIHNwcml0ZUJhdGNoKTtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgc3ByaXRlc1tcIndvcmxkXCJdLkRyYXcoMSwgZ2FtZVdpZHRoIC8gMiArIChnYW1lV2lkdGggLyAyICsgODApICogY3NTIC0gNjAsIGdhbWVIZWlnaHQgKyAoZ2FtZUhlaWdodCAtIDE0MCkgKiBzblMgLSA2MCwgc3ByaXRlQmF0Y2gpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIGZvcmVhY2ggKFBhcnRpY2xlIHAgaW4gY2xvdWRwYXJzKVxyXG4gICAgICAgICAgICAgICAgcC5YTkFEcmF3KHNwcml0ZUJhdGNoKTtcclxuXHJcblxyXG4gICAgICAgICAgICBmb3JlYWNoIChVbml0IHUgaW4gdW5pdHMpIHtcclxuICAgICAgICAgICAgICAgIGlmICgoIXUuQWJzQ29udGFpbnMoXCJJbnZpc2libGVcIikgfHwgdS5vd25lciA9PSAwKSAmJiAodS5ocCA8IHUucGFyYW1ldGVycy5tYXhocCB8fCB1ID09IHNlbFUgfHwgdS5zaG93bkFiaWwgIT0gXCJcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXUucGFyYW1ldGVycy5ocEJvdG9tKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1LnNob3duQWJpbCA9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGaWxsUmVjdGFuZ2xlKHNwcml0ZUJhdGNoLCBoZWFsdGhCYXJCYWNrVGV4LCAyICsgKGludCl1LnggKyB1LnBhcmFtZXRlcnMucmVjdC5YLCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5ZIC0gNiwgdS5wYXJhbWV0ZXJzLnJlY3QuV2lkdGggLSA0LCA0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1LkFic0NvbnRhaW5zKFwiUG9pc29uXCIpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZpbGxSZWN0YW5nbGUoc3ByaXRlQmF0Y2gsIGhlYWx0aEJhclBvaXNvblRleCwgMyArIChpbnQpdS54ICsgdS5wYXJhbWV0ZXJzLnJlY3QuWCwgaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuWSAtIDUsIChpbnQpKHUuaHAgKiAodS5wYXJhbWV0ZXJzLnJlY3QuV2lkdGggLSA2KSAvIHUucGFyYW1ldGVycy5tYXhocCksIDIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZpbGxSZWN0YW5nbGUoc3ByaXRlQmF0Y2gsIGhlYWx0aEJhckxpZmVUZXgsIDMgKyAoaW50KXUueCArIHUucGFyYW1ldGVycy5yZWN0LlgsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LlkgLSA1LCAoaW50KSh1LmhwICogKHUucGFyYW1ldGVycy5yZWN0LldpZHRoIC0gNikgLyAoZG91YmxlKXUucGFyYW1ldGVycy5tYXhocCksIDIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHUuYWJpbHMuQ29udGFpbnNLZXkodS5zaG93bkFiaWwpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGaWxsUmVjdGFuZ2xlKHNwcml0ZUJhdGNoLCBoZWFsdGhCYXJCYWNrVGV4LCAyICsgKGludCl1LnggKyB1LnBhcmFtZXRlcnMucmVjdC5YLCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5ZIC0gOSwgdS5wYXJhbWV0ZXJzLnJlY3QuV2lkdGggLSA0LCA3KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1LkFic0NvbnRhaW5zKFwiUG9pc29uXCIpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZpbGxSZWN0YW5nbGUoc3ByaXRlQmF0Y2gsIGhlYWx0aEJhclBvaXNvblRleCwgMyArIChpbnQpdS54ICsgdS5wYXJhbWV0ZXJzLnJlY3QuWCwgaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuWSAtIDUsIChpbnQpKHUuaHAgKiAodS5wYXJhbWV0ZXJzLnJlY3QuV2lkdGggLSA2KSAvIHUucGFyYW1ldGVycy5tYXhocCksIDIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZpbGxSZWN0YW5nbGUoc3ByaXRlQmF0Y2gsIGhlYWx0aEJhckxpZmVUZXgsIDMgKyAoaW50KXUueCArIHUucGFyYW1ldGVycy5yZWN0LlgsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LlkgLSA1LCAoaW50KXUuaHAgKiAodS5wYXJhbWV0ZXJzLnJlY3QuV2lkdGggLSA2KSAvIHUucGFyYW1ldGVycy5tYXhocCwgMik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGaWxsUmVjdGFuZ2xlKHNwcml0ZUJhdGNoLCBoZWFsdGhCYXJBYmlsVGV4LCAzICsgKGludCl1LnggKyB1LnBhcmFtZXRlcnMucmVjdC5YLCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5ZIC0gOCwgdS5hYmlsc1t1LnNob3duQWJpbF0udmFsdWUgKiAodS5wYXJhbWV0ZXJzLnJlY3QuV2lkdGggLSA2KSAvIHUuc2hvd25BYmlsTWF4VmFsLCAyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1LnNob3duQWJpbCA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgRmlsbFJlY3RhbmdsZShzcHJpdGVCYXRjaCwgaGVhbHRoQmFyQmFja1RleCwgMiArIChpbnQpdS54ICsgdS5wYXJhbWV0ZXJzLnJlY3QuWCwgaG9yICsgNiwgdS5wYXJhbWV0ZXJzLnJlY3QuV2lkdGggLSA0LCA1KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgRmlsbFJlY3RhbmdsZShzcHJpdGVCYXRjaCwgaGVhbHRoQmFyTGlmZVRleCwgMyArIChpbnQpdS54ICsgdS5wYXJhbWV0ZXJzLnJlY3QuWCwgaG9yICsgNywgKGludCkodS5ocCAqICh1LnBhcmFtZXRlcnMucmVjdC5XaWR0aCAtIDYpIC8gKGRvdWJsZSl1LnBhcmFtZXRlcnMubWF4aHApLCAzKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG5cclxuICAgICAgICAgICAgZm9yZWFjaCAoUGFydGljbGUgcCBpbiB1aXBhcnMpXHJcbiAgICAgICAgICAgICAgICBwLlhOQURyYXcoc3ByaXRlQmF0Y2gpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGdsb2JhbEV4cGxvZGUgPiAwKVxyXG4gICAgICAgICAgICAgICAgZ2xvYmFsRXhwbG9kZSAtPSAyO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgUmVzaXplKGludCB3dywgaW50IGhoLCBib29sIGZ1bGxzY3JlZW4sIGZsb2F0IHVpU2NhbGUgPSAxLjBmKSB7XHJcbiAgICAgICAgICAgIF9zY3JlZW5XaWR0aCA9IHd3O1xyXG4gICAgICAgICAgICBzY2FsZVggPSBnYW1lV2lkdGggLyAoZG91YmxlKV9zY3JlZW5XaWR0aDtcclxuICAgICAgICAgICAgX3NjcmVlbkhlaWdodCA9IGhoO1xyXG4gICAgICAgICAgICBzY2FsZVkgPSBnYW1lSGVpZ2h0IC8gKGRvdWJsZSlfc2NyZWVuSGVpZ2h0O1xyXG4gICAgICAgICAgICBpZiAoKE1haW5Db250YWluZXIgIT0gbnVsbCkpIHtcclxuICAgICAgICAgICAgICAgIE1haW5Db250YWluZXIuVyA9IF9zY3JlZW5XaWR0aDtcclxuICAgICAgICAgICAgICAgIE1haW5Db250YWluZXIuSCA9IF9zY3JlZW5IZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICBNYWluQ29udGFpbmVyLkNoaWxkcmVuU2NhbGVYID0gdWlTY2FsZTtcclxuICAgICAgICAgICAgICAgIE1haW5Db250YWluZXIuQ2hpbGRyZW5TY2FsZVkgPSB1aVNjYWxlO1xyXG4gICAgICAgICAgICAgICAgTWFpbkNvbnRhaW5lci5Jc05lZWRSZWNhbGMgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBncmFwaGljcy5QcmVmZXJyZWRCYWNrQnVmZmVyV2lkdGggPSBfc2NyZWVuV2lkdGg7XHJcbiAgICAgICAgICAgIGdyYXBoaWNzLlByZWZlcnJlZEJhY2tCdWZmZXJIZWlnaHQgPSBfc2NyZWVuSGVpZ2h0O1xyXG4gICAgICAgICAgICBncmFwaGljcy5Jc0Z1bGxTY3JlZW4gPSBmdWxsc2NyZWVuO1xyXG4gICAgICAgICAgICBncmFwaGljcy5BcHBseUNoYW5nZXMoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgX3NjcmVlbldpZHRoID0gODAwO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgX3NjcmVlbkhlaWdodCA9IDQ4MDtcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBkb3VibGUgc2NhbGVYID0gMS4wO1xyXG4gICAgICAgIHByaXZhdGUgZG91YmxlIHNjYWxlWSA9IDEuMDtcclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgU2hvd0luZm9QYXIoc3RyaW5nIHR4dCwgQ29sb3IgY2xyLCBmbG9hdCB4LCBmbG9hdCB5LCBib29sIGhhcm0sIGJvb2wgYmlnID0gZmFsc2UpIHtcclxuICAgICAgICAgICAgaWYgKCFoYXJtKVxyXG4gICAgICAgICAgICAgICAgcGFycy5BZGQobmV3IFRleHRQYXJ0aWNsZShkZWZhdWx0VGhlbWUuR2V0Rm9udCgxMiksIGNsciwgeCwgeSwgcm5kLk5leHQoLTEwLCAxMSkgLyAxMCwgLTIsIDAuMWYsIDUwLCB0eHQpKTtcclxuICAgICAgICAgICAgZWxzZSBpZiAoYmlnKVxyXG4gICAgICAgICAgICAgICAgcGFycy5BZGQobmV3IFRleHRQYXJ0aWNsZShkZWZhdWx0VGhlbWUuR2V0Rm9udCgxMiksIGNsciwgeCwgeSwgMCwgLTAuMzVmLCAtMC4wNWYsIDc1LCB0eHQpKTtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgcGFycy5BZGQobmV3IFRleHRQYXJ0aWNsZShkZWZhdWx0VGhlbWUuR2V0Rm9udCgxMiksIGNsciwgeCwgeSwgMCwgLTAuMzVmLCAtMC4wNWYsIDc1LCB0eHQpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIE9uU3VjY2Vzc2Z1bEF0dGFjayhmbG9hdCBkbWcsIFVuaXQgdSwgVW5pdCB0cmcsIGJvb2wgaWdub3JlQXJtb3IpIHtcclxuICAgICAgICAgICAgSGFybSh0cmcsIGRtZywgaWdub3JlQXJtb3IsIEVmZmVjdFR5cGUuTm9ybWFsKTtcclxuICAgICAgICAgICAgaWYgKCFpZ25vcmVBcm1vcilcclxuICAgICAgICAgICAgICAgIGRtZyAqPSB0cmcucGFyYW1ldGVycy5fYXJtb3I7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKEFiaWxpdHkgYSBpbiB1LmFiaWxzLlZhbHVlcykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGEuY29uZENvbXBsZXRlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYS5uYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJTZWxmZGFtYWdlXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIYXJtKHUsIGRtZywgdHJ1ZSwgRWZmZWN0VHlwZS5CYWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkRlbnlpbmdcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdHJnLkFic0NvbnRhaW5zKFwiQm9keWxlc3NcIiwgXCJNYWNoaW5lcnlcIikgJiYgIXRyZy5wYXJhbWV0ZXJzLmlzQnVpbGRpbmcgJiYgdHJnLmhwIDw9IGEudmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgS2lsbCh0cmcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCU0L7QsdC40LLQsNC90LjQtVwiLCBnb29kQWJpbENsciwgdS54LCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiVmFtcGlyaXNtXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRyZy5BYnNDb250YWlucyhcIkJ1aWxkaW5nXCIsIFwiVW5kZWFkXCIsIFwiTWFjaGluZXJ5XCIpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIZWFsKHUsIGRtZyAvIDIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkNyYXNoZXJcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdHJnLnBhcmFtZXRlcnMuaXNCdWlsZGluZyAmJiBkbWcgPj0gYS52YWx1ZSAmJiB0cmcucGFyYW1ldGVycy5Bcm1vciAhPSBcIk5vbmVcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmcucGFyYW1ldGVycy5Bcm1vciA9IFwiTm9uZVwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCR0YDQvtC90Y8g0YDQsNC30YDRg9GI0LXQvdCwXCIsIGJhZEFiaWxDbHIsIHRyZy54LCBob3IgKyB0cmcucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJFbmpveSBwYWluXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRyZy5wYXJhbWV0ZXJzLmlzQnVpbGRpbmcgJiYgdHJnLkFic0NvbnRhaW5zKFwiUG9pc29uXCIpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIZWFsKHUsIGRtZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiRXZpbF9leWVcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdHJnLnBhcmFtZXRlcnMuaXNCdWlsZGluZyAmJiB0cmcucGFyYW1ldGVycy5Bcm1vciA9PSBcIk5vbmVcIiAmJiAhdHJnLkFic0NvbnRhaW5zKFwiQ2x1bXNpbmVzc1wiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmcuQWRkQWJpbGl0eShcIkNsdW1zaW5lc3NcIiwgRWZmZWN0VHlwZS5CYWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCe0YHQu9Cw0LHQu9C10L1cIiwgYmFkQWJpbENsciwgdHJnLngsIGhvciArIHRyZy5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkN1cnNlclwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0cmcucGFyYW1ldGVycy5pc0J1aWxkaW5nICYmICF0cmcuQWJzQ29udGFpbnMoXCJDbHVtc2luZXNzXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZy5BZGRBYmlsaXR5KFwiQ2x1bXNpbmVzc1wiLCBFZmZlY3RUeXBlLkJhZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwi0J7RgdC70LDQsdC70LXQvVwiLCBiYWRBYmlsQ2xyLCB0cmcueCwgaG9yICsgdHJnLnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiU3Bpa2VzX2JvbWJcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0cmcucGFyYW1ldGVycy5Bcm1vciA9PSBcIk5vbmVcIiAmJiAhdHJnLkFic0NvbnRhaW5zKFwiQnVpbGRpbmdcIiwgXCJVbmRlYWRcIiwgXCJCb2R5bGVzc1wiLCBcIk1hY2hpbmVyeVwiKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJnLnBhcmFtZXRlcnMubWF4aHAgLT0gKGludClkbWc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiRGVzdHJveV9saWdodF9hcm1vclwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0cmcucGFyYW1ldGVycy5pc0J1aWxkaW5nICYmIHRyZy5wYXJhbWV0ZXJzLkFybW9yID09IFwiTGlnaHRcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmcucGFyYW1ldGVycy5Bcm1vciA9IFwiTm9uZVwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCR0YDQvtC90Y8g0YDQsNC30YDRg9GI0LXQvdCwXCIsIGJhZEFiaWxDbHIsIHRyZy54LCBob3IgKyB0cmcucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJEZXN0cm95X2hlYXZ5X2FybW9yXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRyZy5wYXJhbWV0ZXJzLmlzQnVpbGRpbmcgJiYgdHJnLnBhcmFtZXRlcnMuQXJtb3IgPT0gXCJIZWF2eVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZy5wYXJhbWV0ZXJzLkFybW9yID0gXCJOb25lXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwi0JHRgNC+0L3RjyDRgNCw0LfRgNGD0YjQtdC90LBcIiwgYmFkQWJpbENsciwgdHJnLngsIGhvciArIHRyZy5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkRlc3Ryb3lfZXRoZXJlYWxfYXJtb3JcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdHJnLnBhcmFtZXRlcnMuaXNCdWlsZGluZyAmJiB0cmcucGFyYW1ldGVycy5Bcm1vciA9PSBcIkV0aGVyZWFsXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJnLnBhcmFtZXRlcnMuQXJtb3IgPSBcIk5vbmVcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCLQkdGA0L7QvdGPINGA0LDQt9GA0YPRiNC10L3QsFwiLCBiYWRBYmlsQ2xyLCB0cmcueCwgaG9yICsgdHJnLnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiTGV2aXRhdGlvblwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRyZy5wYXJhbWV0ZXJzLm1vdmVUeXBlID09IFVuaXRNb3ZlVHlwZS5Hcm91bmRNVCAmJiAhdHJnLnBhcmFtZXRlcnMuaXNCdWlsZGluZyAmJiAhdS5pc0luUmFuZ2VDb21iYXQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZy50YWtlZE9mZiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiUHVyaWZpY2F0aW9uXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmcucHVyaWZpZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIlB1cmlmaWNhdGlvbl9vbl9maXJzdF9hdHRhY2tcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdHJnLnBhcmFtZXRlcnMuaXNCdWlsZGluZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmcucHVyaWZpZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1LmFiaWxzW1wiUHVyaWZpY2F0aW9uX29uX2ZpcnN0X2F0dGFja1wiXS51c2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkNhdGNoQWJpbFwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0cmcucGFyYW1ldGVycy5pc0J1aWxkaW5nICYmICF1LmlzSW5SYW5nZUNvbWJhdCAmJiB0cmcucGFyYW1ldGVycy5tb3ZlVHlwZSA9PSBVbml0TW92ZVR5cGUuRmx5aW5nTVQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdS5sYW5kaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJnLmxhbmRpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLnVzZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiSW5zdGFudF9raWxsXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRyZy5wYXJhbWV0ZXJzLmlzQnVpbGRpbmcgJiYgcm5kLk5leHQoMTAwKSA8IGEudmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgS2lsbCh0cmcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1LmhwIC09IHRyZy5ocDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCLQo9Cx0LjRgiFcIiwgZ29vZEFiaWxDbHIsIHUueCwgaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkNyaXBwbGluZ19pbmp1cnlcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdHJnLkFic0NvbnRhaW5zKFwiQnVpbGRpbmdcIiwgXCJVbmRlYWRcIiwgXCJCb2R5bGVzc1wiLCBcIk1hY2hpbmVyeVwiKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJnLnBhcmFtZXRlcnMubWF4aHAgLT0gKGludClkbWc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiUGxhZ3VlclwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0cmcucGFyYW1ldGVycy5pc0J1aWxkaW5nICYmICF0cmcuQWJzQ29udGFpbnMoXCJQbGFndWVcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJnLkFkZEFiaWxpdHkoXCJQbGFndWVcIiwgRWZmZWN0VHlwZS5CYWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCX0LDRh9GD0LzQu9C10L0hXCIsIGJhZEFiaWxDbHIsIHRyZy54LCBob3IgKyB0cmcucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJBY3RpdmF0ZSBwbGFndWVcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0cmcuQWJzQ29udGFpbnMoXCJQbGFndWVcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoVW5pdCB1dSBpbiB1bml0cykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF1dS5BYnNDb250YWlucyhcIlVuZGVhZFwiLCBcIk1hY2hpbmVyeVwiKSAmJiAhdXUucGFyYW1ldGVycy5pc0J1aWxkaW5nICYmIE1hdGguQWJzKHUueCAtIHV1LngpIDw9IDIgKiB1bml0U2l6ZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIYXJtKHV1LCBybmQuTmV4dCgxMCwgMjEpLCB0cnVlLCBFZmZlY3RUeXBlLkJhZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkhlYXZ5X2Fycm93c1wiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0cmcucGFyYW1ldGVycy5pc0J1aWxkaW5nICYmIHRyZy5wYXJhbWV0ZXJzLm1vdmVUeXBlID09IFVuaXRNb3ZlVHlwZS5GbHlpbmdNVCAmJiBybmQuTmV4dCgxMDApIDwgYS52YWx1ZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJnLmxhbmRpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIlNsb3dlclwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0cmcucGFyYW1ldGVycy5pc0J1aWxkaW5nICYmIHRyZy5wYXJhbWV0ZXJzLlNwZWVkICE9IFwiU2xvd1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZy5wYXJhbWV0ZXJzLlNwZWVkID0gXCJTbG93XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwi0JfQsNC80LXQtNC70LXQvSFcIiwgYmFkQWJpbENsciwgdHJnLngsIGhvciArIHRyZy5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIlBvaXNvbmVyXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocm5kLk5leHQoMTAwKSA8IGEudmFsdWUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvaXNvbih0cmcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodS5pc0luUmFuZ2VDb21iYXQpIHtcclxuICAgICAgICAgICAgICAgIGZvcmVhY2ggKFVuaXQgdXUgaW4gdW5pdHMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodXUub3duZXIgPT0gdS5vd25lciAmJiB0cmcuTmVhcih1dSkgJiYgdXUuQWJzQ29udGFpbnMoXCJTdXBwb3J0X2FyY2hlcnNcIikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEhhcm0odHJnLCBybmQuTmV4dCgxMCwgMTUpLCB0cnVlLCBFZmZlY3RUeXBlLkJhZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFBvaXNvbihVbml0IHRyZykge1xyXG4gICAgICAgICAgICBpZiAoIXRyZy5BYnNDb250YWlucyhcIlBvaXNvblwiKSAmJiAhdHJnLnBhcmFtZXRlcnMuaXNCdWlsZGluZykge1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0cmcuQWJzQ29udGFpbnMoXCJQb2lzb25wcm9vZlwiLCBcIkJvZHlsZXNzXCIsIFwiTWFjaGluZXJ5XCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHJnLkFkZEFiaWxpdHkoXCJQb2lzb25cIiwgRWZmZWN0VHlwZS5Qb2lzb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwi0J7RgtGA0LDQstC70LXQvSFcIiwgcG9pQWJpbENsciwgdHJnLngsIGhvciArIHRyZy5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgT25QcmVBdHRhY2soVW5pdCB1LCBVbml0IHRyZywgcmVmIGZsb2F0IGRtZykge1xyXG4gICAgICAgICAgICBib29sIGFnaWwgPSBmYWxzZTtcclxuICAgICAgICAgICAgZm9yZWFjaCAoQWJpbGl0eSBhIGluIHUuYWJpbHMuVmFsdWVzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYS5jb25kQ29tcGxldGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChhLm5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIldlIGFyZSBwaXJhdGVzXCI6IHtcclxuZG9cclxue1xyXG4gICAgZ2xvYmFsOjpCcmlkZ2UuU2NyaXB0LlRvVGVtcChcImNhc2VfcGF0dGVybjBcIiwgcm5kLk5leHREb3VibGUoKSk7XHJcbiAgICBpZiAoZ2xvYmFsOjpCcmlkZ2UuU2NyaXB0LkZyb21UZW1wPGRvdWJsZT4oXCJjYXNlX3BhdHRlcm4wXCIpIGlzIG9iamVjdClcclxuICAgIHtcclxuICAgICAgICB2YXIgX2Rpc2NhcmQxID0gKG9iamVjdClnbG9iYWw6OkJyaWRnZS5TY3JpcHQuRnJvbVRlbXA8ZG91YmxlPihcImNhc2VfcGF0dGVybjBcIik7XHJcbiAgICAgICAgaWYgKHJuZC5OZXh0RG91YmxlKCkgPCAwLjMzKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCLQmdCw0YDRgNGAIVwiLCBnb29kQWJpbENsciwgdS54LCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGdsb2JhbDo6QnJpZGdlLlNjcmlwdC5Gcm9tVGVtcDxkb3VibGU+KFwiY2FzZV9wYXR0ZXJuMFwiKSBpcyBvYmplY3QpXHJcbiAgICB7XHJcbiAgICAgICAgdmFyIF9kaXNjYXJkMiA9IChvYmplY3QpZ2xvYmFsOjpCcmlkZ2UuU2NyaXB0LkZyb21UZW1wPGRvdWJsZT4oXCJjYXNlX3BhdHRlcm4wXCIpO1xyXG4gICAgICAgIGlmIChybmQuTmV4dERvdWJsZSgpIDwgMC42NilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwi0KHRg9GF0L7Qv9GD0YLQvdCw0Y8g0LrRgNGA0YDRi9GB0LAhXCIsIGdvb2RBYmlsQ2xyLCB1LngsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB7XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBTaG93SW5mb1BhcihcItCi0YvRgdGP0YfQsCDRh9C10YDRgtC10LkhXCIsIGdvb2RBYmlsQ2xyLCB1LngsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG53aGlsZSAoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkF0dGFja19ib251c1wiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG1nICs9IGEudmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiU2hyYXBuZWxcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1LmlzSW5SYW5nZUNvbWJhdClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG1nIC09IDIwICogKGZsb2F0KU1hdGguQWJzKHUueCAtIHRyZy54KSAvIHVuaXRTaXplO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIlNuaXBlcmluZ1wiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUuaXNJblJhbmdlQ29tYmF0ICYmIE1hdGguQWJzKHUueCAtIHRyZy54KSA+PSB1LkF0dGFjay5SYW5nZSAqIHVuaXRTaXplIC0gdXMyKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbWcgKz0gYS52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJMYW5kc2hvb3RlclwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRyZy5wYXJhbWV0ZXJzLm1vdmVUeXBlID09IFVuaXRNb3ZlVHlwZS5GbHlpbmdNVClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG1nIC89IDI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiSGF0ZV9mbHllcnNcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0cmcucGFyYW1ldGVycy5tb3ZlVHlwZSA9PSBVbml0TW92ZVR5cGUuRmx5aW5nTVQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRtZyAqPSAyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkhhdGVfZ2lhbnRzXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHJnLnBhcmFtZXRlcnMubW92ZVR5cGUgPT0gVW5pdE1vdmVUeXBlLkh1Z2VNVClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG1nICo9IDI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiSGF0ZV9wb2lzb25lZFwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRyZy5BYnNDb250YWlucyhcIlBvaXNvblwiKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG1nICo9IDI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiSGF0ZSBtYWdlc1wiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRyZy5BYnNDb250YWlucyhcIk1hZ2VcIikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRtZyAqPSAyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIlNwaWtlc19ib21iXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHJnLnBhcmFtZXRlcnMuQXJtb3IgPT0gXCJOb25lXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRtZyAqPSAyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkJyYXZlXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocm5kLk5leHQoMTAwKSA8PSBhLnZhbHVlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG1nID0gMyAqIGRtZztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCLQmtGA0LjRgiFcIiwgZ29vZEFiaWxDbHIsIHUueCwgaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiS2FtaWthemVcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdS5BYnNDb250YWlucyhcIkV4cGxvc2l2ZVwiKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXhwbG9kZSh1LCB1LkFic0NvbnRhaW5zKFwiTWFnZVwiKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgS2lsbCh1KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJCdXJzdFwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF1LmlzSW5SYW5nZUNvbWJhdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1LnBhcmFtZXRlcnMuU3BlZWQgPSBcIk5vcm1hbFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1LmFiaWxzW1wiQnVyc3RcIl0udXNlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwi0JHQuNGC0LLQsCFcIiwgYmFkQWJpbENsciwgdS54LCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiSW5zdGFiaWxpdHlcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0cmcucGFyYW1ldGVycy5tb3ZlVHlwZSA9PSBVbml0TW92ZVR5cGUuSHVnZU1UIHx8IHRyZy5BYnNDb250YWlucyhcIkR1cmFiaWxpdHlcIikgJiYgIXUuaXNJblJhbmdlQ29tYmF0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEV4cGxvZGUodSwgdS5BYnNDb250YWlucyhcIk1hZ2VcIikpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBLaWxsKHUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiU3Bhd25fZGVtb25zXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodS5pc0luUmFuZ2VDb21iYXQgJiYgcGxyc1t1Lm93bmVyXS5wcmRRLkNvdW50ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdTIgPSBuZXcgVW5pdCh0aGlzLCB0cmcueCAtIHVzMiAqIHUubW92ZXNpZGUsIHUubW92ZXNpZGUsIHUub3duZXIsIHVuaXRQcm1zW3BscnNbdS5vd25lcl0ucHJkUVswXV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3JuTGlzdC5BZGQodTIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCf0YDQuNC30LLQsNC9IVwiLCBnb29kQWJpbENsciwgdTIueCwgaG9yICsgdTIucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnMuQWRkKG5ldyBJbWFnZVBhcnRpY2xlKG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcImV4cGxvZGVcIl0sIDIpLCB1Mi54IC0gMjUsIGhvciArIHUyLnBhcmFtZXRlcnMucmVjdC5Cb3R0b20gLSB1czIgLSAyNSwgMCwgMCwgMjApKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVtb3ZlRnJvbVF1ZXVlKHUub3duZXIsIDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiTWVsZWVfcGVuYWx0eVwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF1LmlzSW5SYW5nZUNvbWJhdClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG1nIC89IDI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiUmFuZ2VfcGVuYWx0eVwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUuaXNJblJhbmdlQ29tYmF0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbWcgLz0gMjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJGaXJzdF9zaG9vdFwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUuaXNJblJhbmdlQ29tYmF0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRtZyArPSBhLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1LmFiaWxzW1wiRmlyc3Rfc2hvb3RcIl0udXNlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwi0KPRgdC40LvQtdC90L3Ri9C5INCy0YvRgdGC0YDQtdC7IVwiLCBnb29kQWJpbENsciwgdS54LCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiU291bGxpbmtcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRtZyArPSBybmQuTmV4dCgxMCwgMjEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhhcm0odSwgcm5kLk5leHQoNSwgMTEpLCB0cnVlLCBFZmZlY3RUeXBlLkJhZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiSW52aXNpYmxlXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWludmlzaWJsZSh1KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJDbHVtc2luZXNzXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocm5kLk5leHQoMTAwKSA8IDIwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZ2lsID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZm9yZWFjaCAoQWJpbGl0eSB0YSBpbiB0cmcuYWJpbHMuVmFsdWVzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGEuY29uZENvbXBsZXRlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodGEubmFtZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQWdpbGl0eVwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJuZC5OZXh0KDEwMCkgPCB0YS52YWx1ZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWdpbCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiRXZhc2lvblwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUuaXNJblJhbmdlQ29tYmF0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZ2lsID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHUuQWJzQ29udGFpbnMoXCJBY2N1cmFjeVwiKSlcclxuICAgICAgICAgICAgICAgIGFnaWwgPSBmYWxzZTtcclxuICAgICAgICAgICAgcmV0dXJuIGFnaWw7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgT25BZ2lsKFVuaXQgdSwgVW5pdCB0cmcpIHtcclxuICAgICAgICAgICAgZm9yZWFjaCAoVW5pdCB1dSBpbiB1bml0cykge1xyXG4gICAgICAgICAgICAgICAgaWYgKCEodXUub3duZXIgPT0gdS5vd25lcikgJiYgdXUuQWJzQ29udGFpbnMoXCJQdW5pc2htZW50X29uX21pc3NcIikpXHJcbiAgICAgICAgICAgICAgICAgICAgSGFybSh1LCBybmQuTmV4dCgyMCwgNDApLCB0cnVlLCBFZmZlY3RUeXBlLkJhZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRyZy5BYnNDb250YWlucyhcIkFnaWxpdHlfcm9sbGJhY2tcIikpXHJcbiAgICAgICAgICAgICAgICB0cmcuQXR0YWNrICs9IHRyZy5hYmlsc1tcIkFnaWxpdHlfcm9sbGJhY2tcIl0udmFsdWU7XHJcbiAgICAgICAgICAgIGlmICh0cmcuQWJzQ29udGFpbnMoXCJLaWxsX29uX2FnaWxcIikpIHtcclxuICAgICAgICAgICAgICAgIEtpbGwodSk7XHJcbiAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCQ0LDQsNCw0LDQsFwiLCBiYWRBYmlsQ2xyLCB1LngsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LlRvcCwgZmFsc2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0cmcuQWJzQ29udGFpbnMoXCJIYXJtX29uX2FnaWxcIikpXHJcbiAgICAgICAgICAgICAgICBIYXJtKHUsIHJuZC5OZXh0KDIwLCA0MSksIHRydWUsIEVmZmVjdFR5cGUuQmFkKTtcclxuICAgICAgICAgICAgaWYgKHRyZy5BYnNDb250YWlucyhcIlRyaWNrXCIpKVxyXG4gICAgICAgICAgICAgICAgSGVhbCh0cmcsIHRyZy5wYXJhbWV0ZXJzLm1heGhwKTtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCIwXCIsIGdvb2RBYmlsQ2xyLCB0cmcueCwgaG9yICsgdHJnLnBhcmFtZXRlcnMucmVjdC5Ub3AsIGZhbHNlKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIENoZWNrQmFzaWNDb25kaXRpb25zKFVuaXQgdSkge1xyXG4gICAgICAgICAgICBmb3JlYWNoIChBYmlsaXR5IGEgaW4gdS5hYmlscy5WYWx1ZXMpIHtcclxuICAgICAgICAgICAgICAgIGlmIChhLnVzZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgYS5jb25kQ29tcGxldGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChhLmNvbmRpdGlvbiAhPSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChhLmNvbmRpdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiVGllclwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBscnNbdS5vd25lcl0ucmVzLlRpZXIgPj0gYS5jb25kbnVtKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmNvbmRDb21wbGV0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5jb25kQ29tcGxldGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiUG9pc29uZWRcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1LkFic0NvbnRhaW5zKFwiUG9pc29uXCIpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmNvbmRDb21wbGV0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5jb25kQ29tcGxldGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiTG93X2hlYWx0aFwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUuaHAgPD0gMC41ICogdS5wYXJhbWV0ZXJzLm1heGhwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmNvbmRDb21wbGV0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5jb25kQ29tcGxldGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiT25fZW5lbXlfc2lkZVwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh1Lm1vdmVzaWRlID09IDEgJiYgdS54ID49IGdhbWVXaWR0aCAvIChkb3VibGUpMikgfHwgKHUubW92ZXNpZGUgPT0gLTEgJiYgdS54IDw9IGdhbWVXaWR0aCAvIChkb3VibGUpMikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuY29uZENvbXBsZXRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmNvbmRDb21wbGV0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJBdF9uaWdodFwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNuUyA8IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuY29uZENvbXBsZXRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmNvbmRDb21wbGV0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJCeV9kYXlcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzblMgPj0gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5jb25kQ29tcGxldGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuY29uZENvbXBsZXRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIk1hY2hpbmVfYXJteVwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hY2hpbmVudW0gPj0gYS5jb25kbnVtKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmNvbmRDb21wbGV0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5jb25kQ29tcGxldGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiT25fZW50ZXJcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuY29uZENvbXBsZXRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgYS5jb25kQ29tcGxldGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIFVuaXQgRmluZEZpcnN0VW5mbHlVbml0KGludCBwbHIpIHtcclxuICAgICAgICAgICAgZmxvYXQgeHJlcyA9IDA7XHJcbiAgICAgICAgICAgIFVuaXQgdXJlcyA9IG51bGw7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKFVuaXQgdSBpbiB1bml0cykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHUub3duZXIgPT0gcGxyICYmICEodS5wYXJhbWV0ZXJzLm1vdmVUeXBlID09IFVuaXRNb3ZlVHlwZS5GbHlpbmdNVCkgJiYgIXUucGFyYW1ldGVycy5pc0J1aWxkaW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVyZXMgPT0gbnVsbCB8fCAodS54IC0geHJlcykgKiB1Lm1vdmVzaWRlID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB4cmVzID0gdS54O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cmVzID0gdTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHVyZXM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgVW5pdCBGaW5kUmFuZG9tVW5mbHlVbml0KGludCBwbHIpIHtcclxuICAgICAgICAgICAgTGlzdDxVbml0PiBhdnVuaXRzID0gbmV3IExpc3Q8VW5pdD4oKTtcclxuICAgICAgICAgICAgZm9yZWFjaCAoVW5pdCB1IGluIHVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodS5vd25lciA9PSBwbHIgJiYgISh1LnBhcmFtZXRlcnMubW92ZVR5cGUgPT0gVW5pdE1vdmVUeXBlLkZseWluZ01UKSAmJiAhdS5wYXJhbWV0ZXJzLmlzQnVpbGRpbmcpXHJcbiAgICAgICAgICAgICAgICAgICAgYXZ1bml0cy5BZGQodSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGF2dW5pdHMuQ291bnQgPiAwKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGF2dW5pdHNbcm5kLk5leHQoYXZ1bml0cy5Db3VudCldO1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBVbml0IEZpbmRSYW5kb21GbHlVbml0KGludCBwbHIsIGludCBocExpbSkge1xyXG4gICAgICAgICAgICBMaXN0PFVuaXQ+IGF2dW5pdHMgPSBuZXcgTGlzdDxVbml0PigpO1xyXG4gICAgICAgICAgICBmb3JlYWNoIChVbml0IHUgaW4gdW5pdHMpIHtcclxuICAgICAgICAgICAgICAgIGlmICh1Lm93bmVyID09IHBsciAmJiB1LnBhcmFtZXRlcnMubW92ZVR5cGUgPT0gVW5pdE1vdmVUeXBlLkZseWluZ01UICYmIHUuaHAgPD0gaHBMaW0gJiYgIXUucGFyYW1ldGVycy5pc0J1aWxkaW5nKVxyXG4gICAgICAgICAgICAgICAgICAgIGF2dW5pdHMuQWRkKHUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChhdnVuaXRzLkNvdW50ID4gMClcclxuICAgICAgICAgICAgICAgIHJldHVybiBhdnVuaXRzW3JuZC5OZXh0KGF2dW5pdHMuQ291bnQpXTtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBEb1VuaXRzKCkge1xyXG4gICAgICAgICAgICBMaXN0PFVuaXQ+IHRhcmdldHMgPSBuZXcgTGlzdDxVbml0PigpO1xyXG4gICAgICAgICAgICBMaXN0PFVuaXQ+IG5ld3RhcmdldHMgPSBuZXcgTGlzdDxVbml0PigpO1xyXG4gICAgICAgICAgICBmbG9hdCBkbWc7XHJcbiAgICAgICAgICAgIGJvb2wgc3RwO1xyXG4gICAgICAgICAgICBpbnQgbmVhcmVzdE9uZTtcclxuICAgICAgICAgICAgZm9yZWFjaCAoVW5pdCB1IGluIHVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodS5BYnNDb250YWlucyhcIlBvd2VyX29mX3VuaXR5XCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdS5wYXJhbWV0ZXJzLkF0dGFjay5NaW5EYW1hZ2UgPSAxMCAqIHBscnNbdS5vd25lcl0udW5pdENvdW50O1xyXG4gICAgICAgICAgICAgICAgICAgIHUucGFyYW1ldGVycy5BdHRhY2suTWF4RGFtYWdlID0gMjAgKiBwbHJzW3Uub3duZXJdLnVuaXRDb3VudDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBzdHAgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHRhcmdldHMuQ2xlYXIoKTtcclxuICAgICAgICAgICAgICAgIG5lYXJlc3RPbmUgPSAtMTtcclxuICAgICAgICAgICAgICAgIHUuYXRrTW9kLlJhbmdlID0gMDtcclxuICAgICAgICAgICAgICAgIHUucGFyYW1ldGVycy5pc0lnbm9yZVVuaXRzID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBDaGVja0Jhc2ljQ29uZGl0aW9ucyh1KTtcclxuICAgICAgICAgICAgICAgIE9uVW5pdHNBYmlscyh1KTtcclxuICAgICAgICAgICAgICAgIHUuaXNJbkNvbWJhdCA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgIGZvcmVhY2ggKFVuaXQgdTIgaW4gdW5pdHMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodSAhPSB1Mikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodS5wYXJhbWV0ZXJzLl9zcGVlZCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdS5wYXJhbWV0ZXJzLmlzSWdub3JlVW5pdHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodS5wYXJhbWV0ZXJzLk5lYXIodTIucGFyYW1ldGVycykgJiYgdS5tb3Zlc2lkZSAqICh1Mi54IC0gdS54KSA+IDAgJiYgKHUubW92ZXNpZGUgKiAodTIueCAtIHUueCkgPCB1bml0U2l6ZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF1Mi5wYXJhbWV0ZXJzLmlzSWdub3JlVW5pdHMgJiYgKHUub3duZXIgIT0gdTIub3duZXIgfHwgKHUuQWJzQ29udGFpbnMoXCJCb2R5bGVzc1wiKSA9PSB1Mi5BYnNDb250YWlucyhcIkJvZHlsZXNzXCIpICYmICF1LkFic0NvbnRhaW5zKFwiSWdub3JlX2ZyaWVuZHNcIikgJiYgIXUuQWJzQ29udGFpbnMoXCJCdXJzdFwiKSAmJiAhdTIuQWJzQ29udGFpbnMoXCJXZWFwb25yeVwiKSAmJiAhdTIucGFyYW1ldGVycy5pc0J1aWxkaW5nKSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHAgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodS5vd25lciA9PSB1Mi5vd25lciAmJiAhdS5BYnNDb250YWlucyhcIk1hZ2VcIikgJiYgdTIuQWJzQ29udGFpbnMoXCJXZWFwb25yeVwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgS2lsbCh1KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUyLmhwICs9IHUuaHA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1Mi5wYXJhbWV0ZXJzLm1heGhwICs9IChpbnQpdS5ocDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUyLnBhcmFtZXRlcnMuQXR0YWNrLk1pbkRhbWFnZSArPSB1LnBhcmFtZXRlcnMuQXR0YWNrLk1pbkRhbWFnZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUyLnBhcmFtZXRlcnMuQXR0YWNrLk1heERhbWFnZSArPSB1LnBhcmFtZXRlcnMuQXR0YWNrLk1heERhbWFnZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBscnNbdS5vd25lcl0udW5pdENvdW50IC09IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodS5tb3Zlc2lkZSAqICh1Mi54IC0gdS54KSA+PSAwICYmIHUubW92ZXNpZGUgKiAodTIueCAtIHUueCkgPCB1LnBhcmFtZXRlcnMuX3NwZWVkICsgdTIucGFyYW1ldGVycy5fc3BlZWQgJiYgdS5wYXJhbWV0ZXJzLk5lYXIodTIucGFyYW1ldGVycykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodS5vd25lciAhPSB1Mi5vd25lciAmJiB1LkFic0NvbnRhaW5zKFwiRGFtYWdlX29uX21vdmVcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUuQWJzQ29udGFpbnMoXCJNYWdlXCIpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSGFybSh1Miwgcm5kLk5leHQoNTAsIDcxKSwgdHJ1ZSwgRWZmZWN0VHlwZS5CYWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIYXJtKHUyLCBybmQuTmV4dCg1MCwgNzEpLCBmYWxzZSwgRWZmZWN0VHlwZS5Ob3JtYWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodS5vd25lciA9PSB1Mi5vd25lciAmJiB1Mi5BYnNDb250YWlucyhcIk1vbmV5X3RyZWFzdXJlXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUyLmFiaWxzW1wiTW9uZXlfdHJlYXN1cmVcIl0udXNlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlYXRobGlzdC5BZGQodTIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbHJzW3Uub3duZXJdLnJlcy5Nb25leSArPSB1Mi5hYmlsc1tcIk1vbmV5X3RyZWFzdXJlXCJdLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihzdHJpbmcuRm9ybWF0KFwiK3swfVwiLHUyLmFiaWxzW1wiTW9uZXlfdHJlYXN1cmVcIl0udmFsdWUpLCBtb25leUNsciwgdTIueCwgaG9yICsgdTIucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cCA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodS5wYXJhbWV0ZXJzLkF0dGFjay5NYXhEYW1hZ2UgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodS5vd25lciAhPSB1Mi5vd25lciAmJiAodS5wYXJhbWV0ZXJzLk5lYXIodTIucGFyYW1ldGVycykgfHwgdS5BdHRhY2suUmFuZ2UgPiAxKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgodS5tb3Zlc2lkZSAqICh1Mi54IC0gdS54KSA+IDAgJiYgdS5tb3Zlc2lkZSAqICh1Mi54IC0gdS54KSA8IHUuQXR0YWNrLlJhbmdlICogdW5pdFNpemUpICYmICF1Mi5BYnNDb250YWlucyhcIkludmlzaWJsZVwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobmVhcmVzdE9uZSA9PSAtMSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5lYXJlc3RPbmUgPSB0YXJnZXRzLkNvdW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh1Lm1vdmVzaWRlICogKHRhcmdldHNbbmVhcmVzdE9uZV0ueCAtIHUyLngpID4gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5lYXJlc3RPbmUgPSB0YXJnZXRzLkNvdW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRzLkFkZCh1Mik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUuaXNJbkNvbWJhdCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdS5pc0luUmFuZ2VDb21iYXQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIG5ld3RhcmdldHMuQ2xlYXIoKTtcclxuICAgICAgICAgICAgICAgIGlmICh0YXJnZXRzLkNvdW50ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghdS5BYnNDb250YWlucyhcIkRyYWdvbl9icmVhdGhcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoVW5pdCB0cmcgaW4gdGFyZ2V0cykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUuTmVhcih0cmcpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld3RhcmdldHMuQWRkKHRyZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5ld3RhcmdldHMuQ291bnQgPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUuQWJzQ29udGFpbnMoXCJBdHRhY2sgc2VsZWN0ZWRcIikgJiYgIXBscnNbdS5vd25lcl0uQUkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0cy5Db250YWlucyhzZWxVKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXd0YXJnZXRzLkFkZChzZWxVKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdS5pc0luUmFuZ2VDb21iYXQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3dGFyZ2V0cy5BZGQodGFyZ2V0c1tuZWFyZXN0T25lXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdS5pc0luUmFuZ2VDb21iYXQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoVW5pdCB0cmcgaW4gdGFyZ2V0cylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld3RhcmdldHMuQWRkKHRyZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHUuaXNJblJhbmdlQ29tYmF0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAobmV3dGFyZ2V0cy5Db3VudCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodS5BYnNDb250YWlucyhcIkhvdmVyXCIpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHAgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1LmF0a1JlY2hhcmdlID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUucGFyYW1ldGVycy5hbmltYXRlZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUuU3RhcnRBbmltYXRpb24oXCJBdHRhY2tcIiwgbWFpbkFuaW1hdG9yKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoVW5pdCB0cmcgaW4gbmV3dGFyZ2V0cykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoQWJpbGl0eSBhYSBpbiB1LmFiaWxzLlZhbHVlcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYS5jb25kaXRpb24gPT0gXCJPbl9hdHRhY2tcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWEuY29uZENvbXBsZXRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbWcgPSBybmQuTmV4dCgoaW50KXUuQXR0YWNrLk1pbkRhbWFnZSwgKGludCl1LkF0dGFjay5NYXhEYW1hZ2UgKyAxKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoT25QcmVBdHRhY2sodSwgdHJnLCByZWYgZG1nKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1LmlzSW5SYW5nZUNvbWJhdCAmJiAhKHUucGFyYW1ldGVycy5hbW1vVHlwZSA9PSBBbW1vLkFtbW9UeXBlLk5vbmUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1LkFic0NvbnRhaW5zKFwiUm9ja2V0X3Nob290XCIpICYmIHJuZC5OZXh0KDEwMCkgPCB1LmFiaWxzW1wiUm9ja2V0X3Nob290XCJdLnZhbHVlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1tb3MuQWRkKG5ldyBBbW1vKHUub3duZXIsIEFtbW8uQW1tb1R5cGUuUmVkQmFsbCwgdS54LCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Ub3AgKyB1czIsIHUsIHRyZywgMCwgZmFsc2UsIHRydWUsIDcyMDAsIHRydWUpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1tb3MuQWRkKG5ldyBBbW1vKHUub3duZXIsIHUucGFyYW1ldGVycy5hbW1vVHlwZSwgdS54LCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Ub3AgKyB1czIsIHUsIHRyZywgMCwgZmFsc2UsIHRydWUsIDcyMDApKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT25BZ2lsKHUsIHRyZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKFVuaXQgdXUgaW4gdW5pdHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHV1Lm93bmVyID09IHUub3duZXIgJiYgdXUuQWJzQ29udGFpbnMoXCJSYWdlcXVpdFwiKSAmJiBybmQuTmV4dCg1KSA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIYXJtKHV1LCBkbWcsIHRydWUsIEVmZmVjdFR5cGUuQmFkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRtZyA9IDMgKiBkbWc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCa0YDQuNGCIVwiLCBnb29kQWJpbENsciwgdS54LCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib29sIGlhID0gKHUuQWJzQ29udGFpbnMoXCJBcmJhbGVzdGVyXCIpICYmIHRyZy5wYXJhbWV0ZXJzLkFybW9yID09IFwiTGlnaHRcIikgfHwgKHUuQWJzQ29udGFpbnMoXCJTaG9vdGVyXCIpICYmICh0cmcucGFyYW1ldGVycy5Bcm1vciA9PSBcIkxpZ2h0XCIgfHwgdHJnLnBhcmFtZXRlcnMuQXJtb3IgPT0gXCJIZWF2eVwiKSkgfHwgdS5BYnNDb250YWlucyhcIk1hZ2VcIik7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodS5pc0luUmFuZ2VDb21iYXQgJiYgISh1LnBhcmFtZXRlcnMuYW1tb1R5cGUgPT0gQW1tby5BbW1vVHlwZS5Ob25lKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodS5BYnNDb250YWlucyhcIlJvY2tldF9zaG9vdFwiKSAmJiBybmQuTmV4dCgxMDApIDwgdS5hYmlsc1tcIlJvY2tldF9zaG9vdFwiXS52YWx1ZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtbW9zLkFkZChuZXcgQW1tbyh1Lm93bmVyLCBBbW1vLkFtbW9UeXBlLlJlZEJhbGwsIHUueCwgaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuVG9wICsgdXMyLCB1LCB0cmcsIGRtZywgaWEsIGZhbHNlLCA3MjAwLCB0cnVlKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtbW9zLkFkZChuZXcgQW1tbyh1Lm93bmVyLCB1LnBhcmFtZXRlcnMuYW1tb1R5cGUsIHUueCwgaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuVG9wICsgdXMyLCB1LCB0cmcsIGRtZywgaWEsIGZhbHNlLCA3MjAwKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9uU3VjY2Vzc2Z1bEF0dGFjayhkbWcsIHUsIHRyZywgaWEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHUuYXRrUmVjaGFyZ2UgPSB1LnBhcmFtZXRlcnMuQXR0YWNrLlNwZWVkO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh1LnBvaVJlY2hhcmdlID4gMClcclxuICAgICAgICAgICAgICAgICAgICB1LnBvaVJlY2hhcmdlIC09IDE7XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodS5BYnNDb250YWlucyhcIlJlZ2VuZXJhdGlvblwiKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgSGVhbCh1LCBybmQuTmV4dCgyMCwgNDEpKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodS5BYnNDb250YWlucyhcIkhlYWxpbmdfYXVyYVwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChVbml0IHV1IGluIHVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodSAhPSB1dSAmJiB1dS5vd25lciA9PSB1Lm93bmVyICYmIE1hdGguQWJzKHUueCAtIHV1LngpIDw9IDIgKiB1bml0U2l6ZSAmJiAhdXUuQWJzQ29udGFpbnMoXCJVbmRlYWRcIikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSGVhbCh1dSwgcm5kLk5leHQoMTAsIDIxKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHUuQWJzQ29udGFpbnMoXCJIZWFsX2ZpcnN0XCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0bXB1ID0gRmluZEZpcnN0VW5mbHlVbml0KHUub3duZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodG1wdSAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSGVhbCh0bXB1LCBybmQuTmV4dCg1LCAxMSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodS5BYnNDb250YWlucyhcIk1hc3NfaGVhbGluZ1wiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChVbml0IHV1IGluIHVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodSAhPSB1dSAmJiB1dS5vd25lciA9PSB1Lm93bmVyICYmICF1dS5BYnNDb250YWlucyhcIlVuZGVhZFwiKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIZWFsKHV1LCBybmQuTmV4dCgxMCwgMjEpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodS5BYnNDb250YWlucyhcIk1hc3NfcmVwYWlyXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKFVuaXQgdXUgaW4gdW5pdHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1ICE9IHV1ICYmIHV1Lm93bmVyID09IHUub3duZXIgJiYgdXUuQWJzQ29udGFpbnMoXCJNYWNoaW5lcnlcIikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSGVhbCh1dSwgcm5kLk5leHQoMjAsIDQxKSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHUuQWJzQ29udGFpbnMoXCJQbGFndWVcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoVW5pdCB1dSBpbiB1bml0cykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF1dS5wYXJhbWV0ZXJzLmlzQnVpbGRpbmcgJiYgTWF0aC5BYnModS54IC0gdXUueCkgPD0gMiAqIHVuaXRTaXplKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHV1LkFic0NvbnRhaW5zKFwiVW5kZWFkXCIpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIZWFsKHV1LCBybmQuTmV4dCgxMCwgMjEpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICghdXUuQWJzQ29udGFpbnMoXCJNYWNoaW5lcnlcIikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhhcm0odXUsIHJuZC5OZXh0KDEwLCAyMSksIHRydWUsIEVmZmVjdFR5cGUuQmFkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodS5BYnNDb250YWlucyhcIkV4dGluY3Rpb25cIikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEhhcm0odSwgcm5kLk5leHQoMjAsIDQxKSwgdHJ1ZSwgRWZmZWN0VHlwZS5Ob3JtYWwpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1LkFic0NvbnRhaW5zKFwiUG9pc29uXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1LkFic0NvbnRhaW5zKFwiUG9pc29uIHJlc2lzdGFuY2VcIikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIYXJtKHUsIHJuZC5OZXh0KDIwLCA0MSkgKyBwbHJzWzEgLSB1Lm93bmVyXS5wb2lzb25Cb251cywgdHJ1ZSwgRWZmZWN0VHlwZS5Qb2lzb24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIYXJtKHUsIHJuZC5OZXh0KDQwLCA4MSkgKyBwbHJzWzEgLSB1Lm93bmVyXS5wb2lzb25Cb251cywgdHJ1ZSwgRWZmZWN0VHlwZS5Qb2lzb24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodS5ocCA8PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdS5kZWF0aEZyb21Qb2lzb24gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChVbml0IHUyIGluIHVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodTIgIT0gdSAmJiBNYXRoLkFicyh1Mi54IC0gdS54KSA8PSAyICogdW5pdFNpemUgJiYgdTIuQWJzQ29udGFpbnMoXCJQYWluX2Fic29yYmVyXCIpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhlYWwodTIsIHJuZC5OZXh0KDIwLCA0MSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUyLkFic0NvbnRhaW5zKFwiRXBpZGVteVwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChybmQuTmV4dCgxMDApIDwgdTIuYWJpbHNbXCJFcGlkZW15XCJdLnZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKFVuaXQgdTMgaW4gdW5pdHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLkFicyh1LnggLSB1My54KSA8PSAyICogdW5pdFNpemUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9pc29uKHUzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB1LnBvaVJlY2hhcmdlID0gMTIwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICh1LmhwID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1LnB1cmlmaWVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdS5BYnNDb250YWlucyhcIkJ1aWxkaW5nXCIsIFwiQm9keWxlc3NcIiwgXCJFdGVybmFsXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBib29sIHNob3dpbmZvID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChBYmlsaXR5IGFhIGluIHUuYWJpbHMuVmFsdWVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFhYS51c2VkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFhLnVzZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93aW5mbyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNob3dpbmZvKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwi0JfQsNCx0LLQtdC90LjQtVwiLCBiYWRBYmlsQ2xyLCB1LngsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgdS5wdXJpZmllZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodS5sYW5kaW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdS5BYnNDb250YWlucyhcIkR1cmFiaWxpdHlcIikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1LnBhcmFtZXRlcnMubW92ZVR5cGUgPSBVbml0TW92ZVR5cGUuR3JvdW5kTVQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHUubGFuZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodS50YWtlZE9mZikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXUuQWJzQ29udGFpbnMoXCJEdXJhYmlsaXR5XCIpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdS5wYXJhbWV0ZXJzLm1vdmVUeXBlID0gVW5pdE1vdmVUeXBlLkZseWluZ01UO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1LnRha2VkT2ZmID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgS2lsbCh1KTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodS5vd25lciA9PSAwICYmIHUueCA+IGdhbWVXaWR0aCArIHVzMikge1xyXG4gICAgICAgICAgICAgICAgICAgIEtpbGwodSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGdUeXBlID09IEdhbWVUeXBlLkZpcnN0SGVyb0dUKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBnU3RhdGUgPSBHYW1lU3RhdGUuV2luO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICh1Lm93bmVyID09IDEgJiYgdS54IDwgLXVzMikge1xyXG4gICAgICAgICAgICAgICAgICAgIEtpbGwodSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGdUeXBlID09IEdhbWVUeXBlLkZpcnN0SGVyb0dUKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBnU3RhdGUgPSBHYW1lU3RhdGUuTG9zZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIXN0cCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1LkFic0NvbnRhaW5zKFwiU3BlZWRfYm9udXNcIikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHUueCArPSB1LnBhcmFtZXRlcnMuX3NwZWVkICogdS5tb3Zlc2lkZSAqIDI7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB1LnggKz0gdS5wYXJhbWV0ZXJzLl9zcGVlZCAqIHUubW92ZXNpZGU7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCgtdS5wYXJhbWV0ZXJzLnJlY3QuVG9wID4gdS5wYXJhbWV0ZXJzLnJlY3QuSGVpZ2h0ICYmICEodS5wYXJhbWV0ZXJzLm1vdmVUeXBlID09IFVuaXRNb3ZlVHlwZS5GbHlpbmdNVCkpIHx8ICgtdS5wYXJhbWV0ZXJzLnJlY3QuVG9wID4gZmx5SGVpZ2h0ICsgdS5wYXJhbWV0ZXJzLnJlY3QuSGVpZ2h0ICYmIHUucGFyYW1ldGVycy5tb3ZlVHlwZSA9PSBVbml0TW92ZVR5cGUuRmx5aW5nTVQpKVxyXG4gICAgICAgICAgICAgICAgICAgIHUucGFyYW1ldGVycy5yZWN0LlkgKz0gMztcclxuICAgICAgICAgICAgICAgIGlmICgtdS5wYXJhbWV0ZXJzLnJlY3QuVG9wIDwgZmx5SGVpZ2h0ICsgdS5wYXJhbWV0ZXJzLnJlY3QuSGVpZ2h0ICYmIHUucGFyYW1ldGVycy5tb3ZlVHlwZSA9PSBVbml0TW92ZVR5cGUuRmx5aW5nTVQpXHJcbiAgICAgICAgICAgICAgICAgICAgdS5wYXJhbWV0ZXJzLnJlY3QuWSAtPSAzO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh1LndpbmdzV2F2ZSA8IDIgKiBNYXRoLlBJKVxyXG4gICAgICAgICAgICAgICAgICAgIHUud2luZ3NXYXZlICs9IHBpZWNlO1xyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHUud2luZ3NXYXZlID0gMDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodS5hdGtSZWNoYXJnZSA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgdS5hdGtSZWNoYXJnZSAtPSAxO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghKGdTdGF0ZSA9PSBHYW1lU3RhdGUuSW5HYW1lKSlcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZ1N0YXRlID09IEdhbWVTdGF0ZS5JbkdhbWUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChib3JuTGlzdC5Db3VudCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChVbml0IHUgaW4gYm9ybkxpc3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGxyc1t1Lm93bmVyXS51Q291bnQgKz0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdW5pdHMuQWRkKHUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBib3JuTGlzdC5DbGVhcigpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGRlYXRobGlzdC5Db3VudCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBpbnQgdV9pbnQgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIHdoaWxlICh1X2ludCA8IGRlYXRobGlzdC5Db3VudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWJpbCA9IGRlYXRobGlzdFt1X2ludF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbC5wYXJhbWV0ZXJzLk5hbWUgPT0gcGxyc1swXS5oZXJvIHx8IGFiaWwucGFyYW1ldGVycy5OYW1lID09IHBscnNbMV0uaGVybykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFiaWwuaHAgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkZWF0aGxpc3RbdV9pbnRdID09IHNlbFUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbFUgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsLm93bmVyID09IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdTdGF0ZSA9IEdhbWVTdGF0ZS5Mb3NlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsLm93bmVyID09IDEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdTdGF0ZSA9IEdhbWVTdGF0ZS5XaW47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKE9uRGVhZChkZWF0aGxpc3RbdV9pbnRdKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBscnNbYWJpbC5vd25lcl0udUNvdW50IC09IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxyc1thYmlsLm93bmVyXS5zdGF0RGVhdGhzICs9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5pdHMuUmVtb3ZlKGRlYXRobGlzdFt1X2ludF0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKEFtbW8gYSBpbiBhbW1vcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYS50YXJnZXQgPT0gZGVhdGhsaXN0W3VfaW50XSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEudGFyZ2V0ID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgdV9pbnQgKz0gMTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZGVhdGhsaXN0LkNsZWFyKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBib29sIFRyeUFkZFRvUXVldWVVbml0KFBsYXllciBwbHIsIHN0cmluZyBuYW1lKSB7XHJcbiAgICAgICAgICAgIGlmIChwbHIuQ2hlY2tGb3JQcm9kdWNlKG5hbWUpKSB7XHJcbiAgICAgICAgICAgICAgICBwbHIucmVzIC09IHVuaXRQcm1zW25hbWVdLkNvc3Q7XHJcbiAgICAgICAgICAgICAgICBwbHIucHJkUS5BZGQobmFtZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAodW5pdFBybXNbbmFtZV0uc3VwcG9ydCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHBsci5haXN1cHBvcnRzdHJlYWsgKz0gMTtcclxuICAgICAgICAgICAgICAgICAgICBwbHIuYWlkZWZlbmNlc3RyZWFrID0gMDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGxyLmFpZGVmZW5jZXN0cmVhayArPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIHBsci5haXN1cHBvcnRzdHJlYWsgPSAwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHBsci5pZCA9PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgIFVwZGF0ZVF1ZXVlKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBSZW1vdmVGcm9tUXVldWUoaW50IHBsciwgaW50IHBvcykge1xyXG4gICAgICAgICAgICBwbHJzW3Bscl0ucHJkUS5SZW1vdmVBdChwb3MpO1xyXG4gICAgICAgICAgICBpZiAocG9zID09IDApXHJcbiAgICAgICAgICAgICAgICBwbHJzW3Bscl0ucHJkUHJnID0gMDtcclxuICAgICAgICAgICAgaWYgKHBsciA9PSAwKVxyXG4gICAgICAgICAgICAgICAgVXBkYXRlUXVldWUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBib29sIENoZWNrU3RhY2soc3RyaW5nIHVuYW1lLCBpbnQgcGxyKSB7XHJcbiAgICAgICAgICAgIGJvb2wgYWRkaXRpb24gPSBmYWxzZTtcclxuICAgICAgICAgICAgaWYgKHVuaXRQcm1zW3VuYW1lXS5tb3ZlVHlwZSA9PSBVbml0TW92ZVR5cGUuRmx5aW5nTVQpIHtcclxuICAgICAgICAgICAgICAgIGZvcmVhY2ggKFVuaXQgdSBpbiB1bml0cykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1Lm93bmVyID09IHBsciAmJiB1LkFic0NvbnRhaW5zKFwiRHJhZ29uX2Jvc3NcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWRkaXRpb24gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHVuaXRQcm1zW3VuYW1lXS5BYnNDb250YWlucyhcIlN0YWNrXCIpIHx8IGFkZGl0aW9uO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBLZXlzW10gbGlzdGVuaW5nS2V5cyA9IG5ld1tdIHsgS2V5cy5FbnRlciwgS2V5cy5Fc2NhcGUsIEtleXMuTGVmdCwgS2V5cy5SaWdodCwgS2V5cy5EMSwgS2V5cy5EMiwgS2V5cy5EMywgS2V5cy5ENCwgS2V5cy5ENSwgS2V5cy5ENiwgS2V5cy5ENyB9O1xyXG5cclxuICAgICAgICBwdWJsaWMgS2V5cyBDaGVja0tleXMoKSB7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKHZhciBrZXkgaW4gbGlzdGVuaW5nS2V5cykge1xyXG4gICAgICAgICAgICAgICAgaWYgKEtleWJvYXJkLkdldFN0YXRlKCkuSXNLZXlVcChrZXkpICYmIG9sZEtleWJvYXJkU3RhdGUuSXNLZXlEb3duKGtleSkpXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGtleTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoR2FtZVBhZC5HZXRTdGF0ZShQbGF5ZXJJbmRleC5PbmUpLkJ1dHRvbnMuQmFjayA9PSBCdXR0b25TdGF0ZS5QcmVzc2VkKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIEtleXMuRXNjYXBlO1xyXG4gICAgICAgICAgICByZXR1cm4gS2V5cy5Ob25lO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBLZXlib2FyZFN0YXRlIG9sZEtleWJvYXJkU3RhdGU7XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFVwZGF0ZSgpIHtcclxuICAgICAgICAgICAgbWFpbkFuaW1hdG9yLkRvKCk7XHJcbiAgICAgICAgICAgIGZybUhlbHAuVmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICBpZiAoZnJtUHJvZHVjdGlvbi5WaXNpYmxlKSB7XHJcbiAgICAgICAgICAgICAgICBmb3JlYWNoICh2YXIgYnRuIGluIGJ0bnNQcm9kdWN0aW9uKVxyXG4gICAgICAgICAgICAgICAgICAgIGJ0bi5DaGlsZHJlblsyXS5WaXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciBtID0gTW91c2UuR2V0U3RhdGUoKTtcclxuICAgICAgICAgICAgaWYgKG0uTGVmdEJ1dHRvbiA9PSBCdXR0b25TdGF0ZS5SZWxlYXNlZCAmJiBvbGRNb3VzZVN0YXRlLkxlZnRCdXR0b24gPT0gQnV0dG9uU3RhdGUuUHJlc3NlZClcclxuICAgICAgICAgICAgICAgIE1vdXNlQ2xpY2tlZChuZXcgVmVjdG9yMihtLlBvc2l0aW9uLlgsIG0uUG9zaXRpb24uWSkpO1xyXG4gICAgICAgICAgICBvbGRNb3VzZVN0YXRlID0gbTtcclxuXHJcbiAgICAgICAgICAgIGlmIChNaWNyb3NvZnQuWG5hLkZyYW1ld29yay5JbnB1dC5Ub3VjaC5Ub3VjaFBhbmVsLklzR2VzdHVyZUF2YWlsYWJsZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGdzID0gTWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuSW5wdXQuVG91Y2guVG91Y2hQYW5lbC5SZWFkR2VzdHVyZSgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGdzLkdlc3R1cmVUeXBlID09IE1pY3Jvc29mdC5YbmEuRnJhbWV3b3JrLklucHV0LlRvdWNoLkdlc3R1cmVUeXBlLlRhcClcclxuICAgICAgICAgICAgICAgICAgICBNb3VzZUNsaWNrZWQobmV3IFZlY3RvcjIoZ3MuUG9zaXRpb24uWCwgZ3MuUG9zaXRpb24uWSksIHRydWUpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgTWFpbkNvbnRhaW5lci5IaWdobGlnaHRCdXR0b24obS5YLCBtLlksIG0uTGVmdEJ1dHRvbiA9PSBCdXR0b25TdGF0ZS5QcmVzc2VkKTtcclxuXHJcbiAgICAgICAgICAgIHZhciB0b3VjaGVzID0gbmV3IExpc3Q8TWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuSW5wdXQuVG91Y2guVG91Y2hMb2NhdGlvbj4oTWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuSW5wdXQuVG91Y2guVG91Y2hQYW5lbC5HZXRTdGF0ZSgpKTtcclxuXHJcbiAgICAgICAgICAgIC8vIElmIHRvdWNoZXMgSXNOb3QgTm90aGluZyBUaGVuXHJcbiAgICAgICAgICAgIGlmICh0b3VjaGVzLkNvdW50ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIHR0IGluIHRvdWNoZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoKHR0LlN0YXRlID09IE1pY3Jvc29mdC5YbmEuRnJhbWV3b3JrLklucHV0LlRvdWNoLlRvdWNoTG9jYXRpb25TdGF0ZS5QcmVzc2VkIHx8IHR0LlN0YXRlID09IE1pY3Jvc29mdC5YbmEuRnJhbWV3b3JrLklucHV0LlRvdWNoLlRvdWNoTG9jYXRpb25TdGF0ZS5Nb3ZlZCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgTWFpbkNvbnRhaW5lci5UYXBBbmRIb2xkQnV0dG9uKChpbnQpdHQuUG9zaXRpb24uWCwgKGludCl0dC5Qb3NpdGlvbi5ZKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIEVuZCBJZlxyXG5cclxuICAgICAgICAgICAgaWYgKGdTdGF0ZSA9PSBHYW1lU3RhdGUuSW5HYW1lKSB7XHJcbiAgICAgICAgICAgICAgICBmb3JlYWNoIChVbml0IHUgaW4gdW5pdHMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodS54ICsgdS5wYXJhbWV0ZXJzLnJlY3QuUmlnaHQgPiBtLlggJiYgbS5YID4gdS54ICsgdS5wYXJhbWV0ZXJzLnJlY3QuTGVmdCAmJiBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Cb3R0b20gPiBtLlkgJiYgbS5ZID4gaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuVG9wKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1Lm93bmVyID09IDAgfHwgIXUuQWJzQ29udGFpbnMoXCJJbnZpc2libGVcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNob3dVbml0SW5mbyh1LnBhcmFtZXRlcnMsIHUub3duZXIsIGZhbHNlLCBudWxsLCB1KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHNlbFUgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICBTaG93VW5pdEluZm8oc2VsVS5wYXJhbWV0ZXJzLCBzZWxVLm93bmVyLCBmYWxzZSwgbnVsbCwgc2VsVSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICB2YXIga2V5ID0gQ2hlY2tLZXlzKCk7XHJcbiAgICAgICAgICAgIGlmIChrZXkgIT0gS2V5cy5Ob25lKVxyXG4gICAgICAgICAgICAgICAgTWFpbkNvbnRhaW5lci5DbGlja0J1dHRvbihrZXkpO1xyXG5cclxuICAgICAgICAgICAgb2xkS2V5Ym9hcmRTdGF0ZSA9IEtleWJvYXJkLkdldFN0YXRlKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoZ1N0YXRlID09IEdhbWVTdGF0ZS5JbkdhbWUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChjdXJNIDwgcGxyc1swXS5yZXMuTW9uZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocGxyc1swXS5yZXMuTW9uZXkgLSBjdXJNIDw9IDUwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJNICs9IDU7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJNICs9IDIwO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjdXJNID4gcGxyc1swXS5yZXMuTW9uZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY3VyTSAtIHBscnNbMF0ucmVzLk1vbmV5IDw9IDUwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJNIC09IDU7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJNIC09IDIwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGN1ckQgPCBwbHJzWzBdLnJlcy5EZWF0aClcclxuICAgICAgICAgICAgICAgICAgICBjdXJEICs9IDE7XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChjdXJEID4gcGxyc1swXS5yZXMuRGVhdGgpXHJcbiAgICAgICAgICAgICAgICAgICAgY3VyRCAtPSAxO1xyXG5cclxuICAgICAgICAgICAgICAgIFVwZGF0ZVJlc291cmNlcygpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBNYWluQ29udGFpbmVyLlJlY2FsYygpO1xyXG5cclxuICAgICAgICAgICAgaWYgKFBhdXNlKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgaW50IGk7XHJcbiAgICAgICAgICAgIGZsb2F0IHQ7XHJcblxyXG4gICAgICAgICAgICBpZiAoc25TID4gMCkge1xyXG4gICAgICAgICAgICAgICAgZ29vZEFiaWxDbHIgPSBDb2xvci5EYXJrQmx1ZTtcclxuICAgICAgICAgICAgICAgIHBvaUFiaWxDbHIgPSBDb2xvci5EYXJrR3JlZW47XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBnb29kQWJpbENsciA9IENvbG9yLkxpZ2h0Qmx1ZTtcclxuICAgICAgICAgICAgICAgIHBvaUFiaWxDbHIgPSBDb2xvci5MaWdodEdyZWVuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChnU3RhdGUgPT0gR2FtZVN0YXRlLkluR2FtZSkge1xyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAoUGxheWVyIHAgaW4gcGxycykge1xyXG4gICAgICAgICAgICAgICAgICAgIHAucHJkU3BkID0gMTtcclxuICAgICAgICAgICAgICAgICAgICBwLm1hZ2ljSW5jQm9udXMgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIHAubW9uZXlJbmNCb251cyA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgcC5wb2lzb25Cb251cyA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgcC5iYW5uZWQuQ2xlYXIoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGZvcmVhY2ggKFBsYXllciBwIGluIHBscnMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocC5ydXNoQm9udXMgPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwLnByZFNwZCAqPSAyO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgbWFjaGluZW51bSA9IDA7XHJcbiAgICAgICAgICAgICAgICBmb3JlYWNoIChVbml0IHUgaW4gdW5pdHMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodS5BYnNDb250YWlucyhcIk1hY2hpbmVyeVwiKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWFjaGluZW51bSArPSAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgRG9Vbml0cygpO1xyXG4gICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHBscnNbMF0uc3BsbHNMaXN0LkNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocGxyc1swXS5zcGVsbHNSY2hyZ1tpXSA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGxyc1swXS5zcGVsbHNSY2hyZ1tpXSAtPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocGxyc1swXS5zcGVsbHNSY2hyZ1tpXSA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICgoTW9ub0ludGVyZmFjZS5Qcm9ncmVzcykoKE1vbm9JbnRlcmZhY2UuQnV0dG9uKWNTcGVsbHMuQ2hpbGRyZW5baV0pLkNoaWxkcmVuWzFdKS5NYXhWYWx1ZSA9IHNwZWxsc1twbHJzWzBdLnNwbGxzTGlzdFtpXV0uQ29zdC5UaW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKChNb25vSW50ZXJmYWNlLlByb2dyZXNzKSgoTW9ub0ludGVyZmFjZS5CdXR0b24pY1NwZWxscy5DaGlsZHJlbltpXSkuQ2hpbGRyZW5bMV0pLkN1cnJlbnRWYWx1ZSA9IHBscnNbMF0uc3BlbGxzUmNocmdbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBmb3JlYWNoIChQbGF5ZXIgcGxyIGluIHBscnMpIHtcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhYmlsID0gcGxyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbC5yZXNEZWxheSA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYmlsLnJlc0RlbGF5IC09IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IHZhbCA9IGFiaWwuc3RhcnRJbmNvICsgYWJpbC5pcHQgKiAoYWJpbC5yZXMuVGllciAtIDEpICsgYWJpbC5tb25leUluY0JvbnVzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJpbC5SZXNvdXJjZXMgKz0gbmV3IFRpbWVDb3N0KHZhbCwgYWJpbC5tYWdpY0luY0JvbnVzLCAwLCAwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsLmlkID09IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCIrXCIgKyB2YWwsIG1vbmV5Q2xyLCB1bml0U2l6ZSwgaG9yIC0gNjAsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJpbC5yZXNEZWxheSA9IDQ1MDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbC5wcmRRLkNvdW50ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJpbC5wcmRQcmcgKz0gYWJpbC5wcmRTcGQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGxyLmlkID09IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXBkYXRlUXVldWUoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbC5wcmRQcmcgPj0gdW5pdFBybXNbYWJpbC5wcmRRWzBdXS5Db3N0LlRpbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbC5ydXNoQm9udXMgPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYmlsLnJ1c2hCb251cyAtPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFkZFRvUmVhZHlVbml0cyhwbHIsIGFiaWwucHJkUVswXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVtb3ZlRnJvbVF1ZXVlKGFiaWwuaWQsIDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsLkFJICYmIGFiaWwucmVhZHlVbml0cy5Db3VudCA+PSAzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKHZhciB1IGluIGFiaWwucmVhZHlVbml0cylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFByb2R1Y2VVbml0KGFiaWwuaWQsIHUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYmlsLnJlYWR5VW5pdHMuQ2xlYXIoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWwuQUkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsLmN1ckFJVmFsID4gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYmlsLmN1ckFJVmFsIC09IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYmlsLkFJVGljayh0aGlzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYmlsLmN1ckFJVmFsID0gYWJpbC5tYXhBSVZhbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGkgPSAwO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKGkgPCBhbW1vcy5Db3VudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFiaWwxID0gYW1tb3NbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFiaWwxLnggKz0gYWJpbDEudng7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFiaWwxLnkgKz0gYWJpbDEudnk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFiaWwxLmxpZmV0aW1lIC09IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsMS50YXJnZXQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdCA9IChhYmlsMS50YXJnZXQueCAtIGFiaWwxLngpIC8gYWJpbDEudng7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodCAhPSAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFiaWwxLnZ5ID0gKGhvciArIGFiaWwxLnRhcmdldC5wYXJhbWV0ZXJzLnJlY3QuVG9wICsgMTUgLSBhYmlsMS55KSAvIHQgLSBhYmlsMS5heSAqIHQgLyAyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFiaWwxLnZ5ID0gLTE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJpbDEudnkgKz0gYWJpbDEuYXk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKFVuaXQgdSBpbiB1bml0cykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWwxLnBsciAhPSB1Lm93bmVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh1LnggKyB1LnBhcmFtZXRlcnMucmVjdC5SaWdodCA+PSBhYmlsMS54ICYmIGFiaWwxLnggPj0gdS54ICsgdS5wYXJhbWV0ZXJzLnJlY3QuTGVmdCAmJiBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Cb3R0b20gPj0gYWJpbDEueSAmJiBhYmlsMS55ID49IGhvciArIHUucGFyYW1ldGVycy5yZWN0LlRvcCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWwxLmFnaWwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9uQWdpbChhYmlsMS5vd25lciwgdSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbDEuZXhwbG9zaXZlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEV4cGxvZGUodSwgYWJpbDEub3duZXIuQWJzQ29udGFpbnMoXCJNYWdlXCIpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhYmlsMS5vd25lciAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPblN1Y2Nlc3NmdWxBdHRhY2soYWJpbDEuZG1nLCBhYmlsMS5vd25lciwgdSwgYWJpbDEuaWdub3JlQXJtb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWwxLmV4cGxvc2l2ZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFeHBsb2RlKHUsIGFiaWwxLm93bmVyLkFic0NvbnRhaW5zKFwiTWFnZVwiKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbDEuZXhwbG9zaXZlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEV4cGxvZGUodSwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSGFybSh1LCBhYmlsMS5kbWcsIGFiaWwxLmlnbm9yZUFybW9yLCBFZmZlY3RUeXBlLk5vcm1hbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWwxLnR5cGUgPT0gQW1tby5BbW1vVHlwZS5Cb21iKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFycy5BZGQobmV3IEltYWdlUGFydGljbGUobmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW1wiZXhwbG9kZVwiXSwgMSksIGFiaWwxLnggLSAxMiwgYWJpbDEueSAtIDEyLCAwLCAwLCAyMCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW1vcy5SZW1vdmVBdChpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaSAtPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWwxLnkgPj0gaG9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbDEudHlwZSA9PSBBbW1vLkFtbW9UeXBlLkJvbWIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFycy5BZGQobmV3IEltYWdlUGFydGljbGUobmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW1wiZXhwbG9kZVwiXSwgMSksIGFiaWwxLnggLSAxMiwgYWJpbDEueSAtIDEyLCAwLCAwLCAyMCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1tb3MuUmVtb3ZlQXQoaSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpIC09IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWwxLmxpZmV0aW1lIDw9IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtbW9zLlJlbW92ZUF0KGkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaSAtPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGkgKz0gMTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaSA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlIChpIDwgcGFycy5Db3VudCkge1xyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBhYmlsMiA9IHBhcnNbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgYWJpbDIubHRpbWUgLT0gMTtcclxuICAgICAgICAgICAgICAgICAgICBhYmlsMi54ICs9IGFiaWwyLmR4O1xyXG4gICAgICAgICAgICAgICAgICAgIGFiaWwyLnkgKz0gYWJpbDIuZHk7XHJcbiAgICAgICAgICAgICAgICAgICAgYWJpbDIuZHkgKz0gYWJpbDIuYXk7XHJcbiAgICAgICAgICAgICAgICAgICAgYWJpbDIuYSAtPSBhYmlsMi5hc3Q7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWwyLmR5ID4gMCAmJiBhYmlsMi55ID49IGhvciAtIHVuaXRTaXplICsgMikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhYmlsMi55ID0gaG9yIC0gdW5pdFNpemUgKyAzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhYmlsMi5keSA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhYmlsMi5sdGltZSA9PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJzLlJlbW92ZUF0KGkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgaSArPSAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmb3JlYWNoIChQYXJ0aWNsZSBwIGluIGNsb3VkcGFycykge1xyXG4gICAgICAgICAgICAgICAgcC54ICs9IHAuZHg7XHJcbiAgICAgICAgICAgICAgICBpZiAocC54ID49IGdhbWVXaWR0aCArIDc1KVxyXG4gICAgICAgICAgICAgICAgICAgIHAueCA9IC0xMDA7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICBpZiAodXBkYXRlU3BlbGxzKVxyXG4gICAgICAgICAgICAgICAgU2V0U3BlbGxzKCk7XHJcbiAgICAgICAgICAgIGlmIChnU3RhdGUgPT0gR2FtZVN0YXRlLkluR2FtZSAmJiBzblMgPiAwICYmIGdUeXBlID09IEdhbWVUeXBlLkRlZmVuY2VHVClcclxuICAgICAgICAgICAgICAgIGdTdGF0ZSA9IEdhbWVTdGF0ZS5XaW47XHJcbiAgICAgICAgICAgIGlmIChnU3RhdGUgPT0gR2FtZVN0YXRlLkluR2FtZSAmJiBzblMgPCAwICYmIGdUeXBlID09IEdhbWVUeXBlLk9mZmVuY2VHVClcclxuICAgICAgICAgICAgICAgIGdTdGF0ZSA9IEdhbWVTdGF0ZS5Mb3NlO1xyXG4gICAgICAgICAgICBvbGRzblMgPSBzblM7XHJcbiAgICAgICAgICAgIHNuUyA9IHNuUyAqIGNzRCArIGNzUyAqIHNuRDtcclxuICAgICAgICAgICAgY3NTID0gY3NTICogY3NEIC0gb2xkc25TICogc25EO1xyXG4gICAgICAgICAgICBpZiAoZ1N0YXRlID09IEdhbWVTdGF0ZS5Mb3NlIHx8IGdTdGF0ZSA9PSBHYW1lU3RhdGUuV2luKVxyXG4gICAgICAgICAgICAgICAgRW5kT2ZCYXR0bGUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEVuZE9mQmF0dGxlKCkge1xyXG4gICAgICAgICAgICBfcGF1c2UgPSB0cnVlO1xyXG4gICAgICAgICAgICBmcm1EaWFsb2cuU2hvdyhtYWluQW5pbWF0b3IpO1xyXG4gICAgICAgICAgICBpZiAoUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLnJhY2VzUGxheXMuQ29udGFpbnNLZXkocGxyc1swXS5yYWNlKSkge1xyXG4gICAgICAgICAgICAgICAgUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLnJhY2VzUGxheXNbcGxyc1swXS5yYWNlXSArPSAxO1xyXG4gICAgICAgICAgICAgICAgaWYgKGdTdGF0ZSA9PSBHYW1lU3RhdGUuV2luKVxyXG4gICAgICAgICAgICAgICAgICAgIFByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS5yYWNlc1dpbnNbcGxyc1swXS5yYWNlXSArPSAxO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLnJhY2VzUGxheXMuQWRkKHBscnNbMF0ucmFjZSwgMSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZ1N0YXRlID09IEdhbWVTdGF0ZS5XaW4pXHJcbiAgICAgICAgICAgICAgICAgICAgUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLnJhY2VzV2lucy5BZGQocGxyc1swXS5yYWNlLCAxKTtcclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGdTdGF0ZSA9PSBHYW1lU3RhdGUuTG9zZSlcclxuICAgICAgICAgICAgICAgICAgICBQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0ucmFjZXNXaW5zLkFkZChwbHJzWzBdLnJhY2UsIDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHN3aXRjaCAoZ1N0YXRlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIEdhbWVTdGF0ZS5XaW46IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGJsVGl0bGVmcm1EaWFsb2cuVGV4dCA9IFwi0JLRiyDQv9C+0LHQtdC00LjQu9C4IVwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSBHYW1lU3RhdGUuTG9zZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYmxUaXRsZWZybURpYWxvZy5UZXh0ID0gXCLQktGLINC/0YDQvtC40LPRgNCw0LvQuCFcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxibExpbmUxRnJtRGlhbG9nLlRleHQgPSBzdHJpbmcuRm9ybWF0KFwi0JLQsNGI0Lgg0L/QvtGC0LXRgNC4OiB7MH1cIixwbHJzWzBdLnN0YXREZWF0aHMpO1xyXG4gICAgICAgICAgICBsYmxMaW5lMkZybURpYWxvZy5UZXh0ID0gc3RyaW5nLkZvcm1hdChcItCf0L7RgtC10YDQuCDQv9GA0L7RgtC40LLQvdC40LrQsDogezB9XCIscGxyc1sxXS5zdGF0RGVhdGhzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFNob3dVbml0SW5mbyhVbml0UGFyYW1ldGVycyB1cCwgaW50IG93biwgYm9vbCBjc3RIaWdobGlnaHQsIFBvaW50PyBwbnQgPSBudWxsLCBVbml0IHVudCA9IG51bGwpIHtcclxuICAgICAgICAgICAgbGJsVW5pdE5hbWVIZWxwVW5pdC5UZXh0ID0gbG9jYWxpemUuR2V0U3RyaW5nKHVwLk5hbWUpO1xyXG4gICAgICAgICAgICBpZiAodXAuU3VicmFjZSA9PSBcIlwiKVxyXG4gICAgICAgICAgICAgICAgbGJsUmFjZUhlbHBVbml0LlRleHQgPSBsb2NhbGl6ZS5HZXRTdHJpbmcodXAuUmFjZSk7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIGxibFJhY2VIZWxwVW5pdC5UZXh0ID0gc3RyaW5nLkZvcm1hdChcInswfSAtIHsxfVwiLGxvY2FsaXplLkdldFN0cmluZyh1cC5SYWNlKSxsb2NhbGl6ZS5HZXRTdHJpbmcodXAuU3VicmFjZSkpO1xyXG5cclxuICAgICAgICAgICAgbGJsQ29zdE1vbmV5SGVscFVuaXQuVGV4dCA9IHVwLkNvc3QuTW9uZXkuVG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgaWYgKHBscnNbMF0ucmVzLk1vbmV5IDwgdXAuQ29zdC5Nb25leSAmJiBjc3RIaWdobGlnaHQpXHJcbiAgICAgICAgICAgICAgICBsYmxDb3N0TW9uZXlIZWxwVW5pdC5UZXh0Q29sb3IgPSBDb2xvci5SZWQ7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIGxibENvc3RNb25leUhlbHBVbml0LlRleHRDb2xvciA9IG1vbmV5Q2xyO1xyXG5cclxuXHJcbiAgICAgICAgICAgIGlmICh1cC5Db3N0LkRlYXRoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgbGJsQ29zdERlYXRoSGVscFVuaXQuVGV4dCA9IHVwLkNvc3QuRGVhdGguVG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgICAgIGlmIChwbHJzWzBdLnJlcy5EZWF0aCA8IHVwLkNvc3QuRGVhdGggJiYgY3N0SGlnaGxpZ2h0KVxyXG4gICAgICAgICAgICAgICAgICAgIGxibENvc3REZWF0aEhlbHBVbml0LlRleHRDb2xvciA9IENvbG9yLlJlZDtcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICBsYmxDb3N0RGVhdGhIZWxwVW5pdC5UZXh0Q29sb3IgPSBkZWF0aENscjtcclxuICAgICAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICAgICAgICBsYmxDb3N0RGVhdGhIZWxwVW5pdC5UZXh0ID0gXCItXCI7XHJcblxyXG4gICAgICAgICAgICBjQmF0dGxlUGFyYW1ldGVycy5WaXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgQ29sb3IgYXRrY2xyID0gQ29sb3IuQmxhY2s7XHJcbiAgICAgICAgICAgIEF0dGFjayBmaW5hbEF0ayA9IHVwLkF0dGFjaztcclxuICAgICAgICAgICAgbG9uZyBmaW5hbFJuZyA9IHVwLkF0dGFjay5SYW5nZTtcclxuICAgICAgICAgICAgc3RyaW5nIGF0a1NwZCA9IGxvY2FsaXplLkdldFN0cmluZyhzdHJpbmcuRm9ybWF0KFwiQXR0YWNrU3BlZWR7MH1cIix1cC5BdHRhY2suU3BlZWQpKTtcclxuICAgICAgICAgICAgaWYgKHVudCAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBmaW5hbEF0ayArPSB1bnQuYXRrTW9kO1xyXG4gICAgICAgICAgICAgICAgZmluYWxSbmcgKz0gdW50LmF0a01vZC5SYW5nZTtcclxuICAgICAgICAgICAgICAgIGlmICh1cC5BdHRhY2suTWF4RGFtYWdlID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmaW5hbEF0ay5NaW5EYW1hZ2UgPiB1bml0UHJtc1t1cC5OYW1lXS5BdHRhY2suTWluRGFtYWdlIHx8IGZpbmFsQXRrLk1heERhbWFnZSA+IHVuaXRQcm1zW3VwLk5hbWVdLkF0dGFjay5NYXhEYW1hZ2UgfHwgZmluYWxSbmcgPiB1bml0UHJtc1t1cC5OYW1lXS5BdHRhY2suUmFuZ2UpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF0a2NsciA9IENvbG9yLkRhcmtCbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGZpbmFsQXRrLk1pbkRhbWFnZSA8IHVuaXRQcm1zW3VwLk5hbWVdLkF0dGFjay5NaW5EYW1hZ2UgfHwgZmluYWxBdGsuTWF4RGFtYWdlIDwgdW5pdFBybXNbdXAuTmFtZV0uQXR0YWNrLk1heERhbWFnZSB8fCBmaW5hbFJuZyA8IHVuaXRQcm1zW3VwLk5hbWVdLkF0dGFjay5SYW5nZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXRrY2xyID0gQ29sb3IuRGFya1Zpb2xldDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsYmxBdHRhY2tCYXNpY1BhcmFtcy5UZXh0Q29sb3IgPSBhdGtjbHI7XHJcbiAgICAgICAgICAgIGlmICh1cC5BdHRhY2suUmFuZ2UgPiAxKSB7XHJcbiAgICAgICAgICAgICAgICBwY3RBdHRhY2tCYXNpY1BhcmFtcy5zcHJpdGVSZWYgPSBuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJzbWFsbF9pY29uc1wiXSwgMCk7XHJcbiAgICAgICAgICAgICAgICBpZiAodXAuQXR0YWNrLk1heERhbWFnZSA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodXAuQXR0YWNrLlJhbmdlID4gMTAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYmxBdHRhY2tCYXNpY1BhcmFtcy5UZXh0ID0gc3RyaW5nLkZvcm1hdChcInswfS17MX0sINC00LDQu9GM0L3QvtGB0YLRjCDiiJ4sIHsyfVwiLGZpbmFsQXRrLk1pbkRhbWFnZSxmaW5hbEF0ay5NYXhEYW1hZ2UsYXRrU3BkKTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxibEF0dGFja0Jhc2ljUGFyYW1zLlRleHQgPSBzdHJpbmcuRm9ybWF0KFwiezB9LXsxfSwg0LTQsNC70YzQvdC+0YHRgtGMIHsyfSwgezN9XCIsZmluYWxBdGsuTWluRGFtYWdlLGZpbmFsQXRrLk1heERhbWFnZSxmaW5hbFJuZyxhdGtTcGQpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgbGJsQXR0YWNrQmFzaWNQYXJhbXMuVGV4dCA9IFwi0J3QtdGCXCI7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBwY3RBdHRhY2tCYXNpY1BhcmFtcy5zcHJpdGVSZWYgPSBuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJzbWFsbF9pY29uc1wiXSwgMSk7XHJcbiAgICAgICAgICAgICAgICBpZiAodXAuQXR0YWNrLk1heERhbWFnZSA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgbGJsQXR0YWNrQmFzaWNQYXJhbXMuVGV4dCA9IHN0cmluZy5Gb3JtYXQoXCJ7MH0tezF9LCB7Mn1cIixmaW5hbEF0ay5NaW5EYW1hZ2UsZmluYWxBdGsuTWF4RGFtYWdlLGF0a1NwZCk7XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmICh1cC5BdHRhY2suTWF4RGFtYWdlID09IDApXHJcbiAgICAgICAgICAgICAgICAgICAgbGJsQXR0YWNrQmFzaWNQYXJhbXMuVGV4dCA9IFwi0J3QtdGCXCI7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgbGJsQXR0YWNrQmFzaWNQYXJhbXMuVGV4dCA9IFwi0J3QtSDRg9C60LDQt9Cw0L3QsFwiO1xyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgaWYgKHVudCAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBsYmxzQmFzaWNQYXJhbXNbMF0uVGV4dCA9IHN0cmluZy5Gb3JtYXQoXCJ7MH0vezF9XCIsdW50LmhwICx1cC5tYXhocCk7XHJcbiAgICAgICAgICAgICAgICBpZiAodXAubWF4aHAgPiB1bml0UHJtc1t1cC5OYW1lXS5tYXhocClcclxuICAgICAgICAgICAgICAgICAgICBsYmxzQmFzaWNQYXJhbXNbMF0uVGV4dENvbG9yID0gQ29sb3IuRGFya0JsdWU7XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmICh1cC5tYXhocCA8IHVuaXRQcm1zW3VwLk5hbWVdLm1heGhwKVxyXG4gICAgICAgICAgICAgICAgICAgIGxibHNCYXNpY1BhcmFtc1swXS5UZXh0Q29sb3IgPSBDb2xvci5EYXJrVmlvbGV0O1xyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIGxibHNCYXNpY1BhcmFtc1swXS5UZXh0Q29sb3IgPSBDb2xvci5CbGFjaztcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh1cC5tYXhocCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGxibHNCYXNpY1BhcmFtc1swXS5UZXh0ID0gdXAubWF4aHAuVG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgICAgIGxibHNCYXNpY1BhcmFtc1swXS5UZXh0Q29sb3IgPSBDb2xvci5CbGFjaztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGxibHNCYXNpY1BhcmFtc1swXS5UZXh0ID0gXCLQndC1INGD0LrQsNC30LDQvdC+XCI7XHJcbiAgICAgICAgICAgICAgICBsYmxzQmFzaWNQYXJhbXNbMF0uVGV4dENvbG9yID0gQ29sb3IuQmxhY2s7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICBsYmxzQmFzaWNQYXJhbXNbMV0uVGV4dCA9IGxvY2FsaXplLkdldFN0cmluZyh1cC5hcm1OaWNrKTtcclxuICAgICAgICAgICAgaWYgKHVwLl9hcm1vciA8IHVuaXRQcm1zW3VwLk5hbWVdLl9hcm1vcilcclxuICAgICAgICAgICAgICAgIGxibHNCYXNpY1BhcmFtc1sxXS5UZXh0Q29sb3IgPSBDb2xvci5EYXJrQmx1ZTtcclxuICAgICAgICAgICAgZWxzZSBpZiAodXAuX2FybW9yID4gdW5pdFBybXNbdXAuTmFtZV0uX2FybW9yKVxyXG4gICAgICAgICAgICAgICAgbGJsc0Jhc2ljUGFyYW1zWzFdLlRleHRDb2xvciA9IENvbG9yLkRhcmtCbHVlO1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICBsYmxzQmFzaWNQYXJhbXNbMV0uVGV4dENvbG9yID0gQ29sb3IuQmxhY2s7XHJcblxyXG4gICAgICAgICAgICBsYmxzQmFzaWNQYXJhbXNbMl0uVGV4dCA9IHN0cmluZy5Gb3JtYXQoXCJ7MH0sIHsxfVwiLGxvY2FsaXplLkdldFN0cmluZyhzdHJpbmcuRm9ybWF0KFwiezB9U1wiLHVwLnNwZE5pY2spKSxsb2NhbGl6ZS5HZXRTdHJpbmcodXAubW92ZVR5cGUuVG9TdHJpbmcoKSkpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHVwLl9zcGVlZCA+IHVuaXRQcm1zW3VwLk5hbWVdLl9zcGVlZClcclxuICAgICAgICAgICAgICAgIGxibHNCYXNpY1BhcmFtc1syXS5UZXh0Q29sb3IgPSBDb2xvci5EYXJrQmx1ZTtcclxuICAgICAgICAgICAgZWxzZSBpZiAodXAuX3NwZWVkIDwgdW5pdFBybXNbdXAuTmFtZV0uX3NwZWVkKVxyXG4gICAgICAgICAgICAgICAgbGJsc0Jhc2ljUGFyYW1zWzJdLlRleHRDb2xvciA9IENvbG9yLkRhcmtWaW9sZXQ7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIGxibHNCYXNpY1BhcmFtc1syXS5UZXh0Q29sb3IgPSBDb2xvci5CbGFjaztcclxuXHJcbiAgICAgICAgICAgIHZhciBpID0gMDtcclxuICAgICAgICAgICAgdmFyIGxhc3RIID0gY0JhdHRsZVBhcmFtZXRlcnMuQm90dG9tO1xyXG4gICAgICAgICAgICB2YXIgYWJpbHMgPSB1bnQgIT0gbnVsbCA/IHVudC5hYmlscy5WYWx1ZXMgOiB1cC5hYmlscy5WYWx1ZXM7XHJcblxyXG4gICAgICAgICAgICBmb3JlYWNoIChBYmlsaXR5IGEgaW4gYWJpbHMpIHtcclxuICAgICAgICAgICAgICAgIGlmICghYS5oaWRkZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICBDb2xvciBjbHI7XHJcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChhLnR5cClcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRWZmZWN0VHlwZS5Ob3JtYWw6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbHIgPSBDb2xvci5CbGFjaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEVmZmVjdFR5cGUuR29vZDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsciA9IENvbG9yLkRhcmtCbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRWZmZWN0VHlwZS5CYWQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbHIgPSBDb2xvci5EYXJrVmlvbGV0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRWZmZWN0VHlwZS5Qb2lzb246XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbHIgPSBDb2xvci5EYXJrR3JlZW47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsciA9IENvbG9yLkJsYWNrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhLmNvbmRpdGlvbiA9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxibHNBYmlsc1tpXS5UZXh0ID0gc3RyaW5nLkZvcm1hdChcIuKAoiB7MH1cIixzdHJpbmcuRm9ybWF0KGxvY2FsaXplLkdldFN0cmluZyhhLm5hbWUpLCBhLnZhbHVlLCBhLnZhbHVlKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxibHNBYmlsc1tpXS5UZXh0Q29sb3IgPSBjbHI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxibHNBYmlsc1tpXS5WaXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYS5sb25nVGltZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFhLnVzZWQgJiYgIWEuY29uZENvbXBsZXRlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1bnQgIT0gbnVsbCB8fCAhKGEuY29uZGl0aW9uID09IFwiVGllclwiICYmIHBscnNbb3duXS5yZXMuVGllciA+PSBhLmNvbmRudW0pICYmICEoYS5jb25kaXRpb24gPT0gXCJNYWNoaW5lX2FybXlcIiAmJiBtYWNoaW5lbnVtID49IGEuY29uZG51bSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsciA9IGNvbmRDbHI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVuaXRfcGFyYW1ldGVycyA9IEdldFVuaXRQYXJhbWV0ZXJzRnJvbUlEKGEudmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdW5pdF9uYW1lID0gdW5pdF9wYXJhbWV0ZXJzLkhhc1ZhbHVlID8gbG9jYWxpemUuR2V0U3RyaW5nKHVuaXRfcGFyYW1ldGVycy5WYWx1ZS5OYW1lKSA6IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxibHNBYmlsc1tpXS5UZXh0ID0gc3RyaW5nLkZvcm1hdChcIuKAoiB7MH0gezF9XCIsc3RyaW5nLkZvcm1hdChsb2NhbGl6ZS5HZXRTdHJpbmcoYS5jb25kaXRpb24pLCBhLmNvbmRudW0sIEdldEVuZGluZyhhLmNvbmRudW0pKSxzdHJpbmcuRm9ybWF0KGxvY2FsaXplLkdldFN0cmluZyhhLm5hbWUpLCBhLnZhbHVlLCB1bml0X25hbWUpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGJsc0FiaWxzW2ldLlRleHRDb2xvciA9IGNscjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGJsc0FiaWxzW2ldLlZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBsYmxzQWJpbHNbaV0uWSA9IGxhc3RIICsgNTtcclxuICAgICAgICAgICAgICAgICAgICBsYXN0SCA9IGxibHNBYmlsc1tpXS5Cb3R0b207XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGEuY29uZENvbXBsZXRlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYS5uYW1lID09IFwiTWFnZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGN0QXR0YWNrQmFzaWNQYXJhbXMuc3ByaXRlUmVmID0gbmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW1wic21hbGxfaWNvbnNcIl0sIDIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChhLm5hbWUgPT0gXCJTaG9vdGVyXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwY3RBdHRhY2tCYXNpY1BhcmFtcy5zcHJpdGVSZWYgPSBuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJzbWFsbF9pY29uc1wiXSwgMTcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChhLm5hbWUgPT0gXCJBcmJhbGVzdGVyXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwY3RBdHRhY2tCYXNpY1BhcmFtcy5zcHJpdGVSZWYgPSBuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJzbWFsbF9pY29uc1wiXSwgMTgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpICs9IDE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZvciAodmFyIGogPSBpOyBqIDw9IDU7IGorKylcclxuICAgICAgICAgICAgICAgIGxibHNBYmlsc1tqXS5WaXNpYmxlID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICBmcm1IZWxwLkggPSBsYXN0SCArIDU7XHJcblxyXG4gICAgICAgICAgICBpZiAoIXBudC5IYXNWYWx1ZSkgcG50ID0gbmV3IFBvaW50KGdhbWVXaWR0aCAtIGZybUhlbHAuVyAtIDMwLCA5MCk7XHJcblxyXG4gICAgICAgICAgICBmcm1IZWxwLlggPSBwbnQuVmFsdWUuWCArIDEwO1xyXG4gICAgICAgICAgICBmcm1IZWxwLlkgPSBwbnQuVmFsdWUuWSArIDEwO1xyXG4gICAgICAgICAgICBpZiAoZnJtSGVscC5SaWdodCA+IGdhbWVXaWR0aCAtIDIwKVxyXG4gICAgICAgICAgICAgICAgZnJtSGVscC5SaWdodCA9IGdhbWVXaWR0aCAtIDIwO1xyXG4gICAgICAgICAgICBpZiAoZnJtSGVscC5Cb3R0b20gPiBnYW1lSGVpZ2h0IC0gMjApXHJcbiAgICAgICAgICAgICAgICBmcm1IZWxwLkJvdHRvbSA9IGdhbWVIZWlnaHQgLSAyMDtcclxuXHJcbiAgICAgICAgICAgIGZybUhlbHAuVmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RyaW5nIEdldEVuZGluZyhpbnQgbikge1xyXG4gICAgICAgICAgICBpZiAobiA+IDQpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJcIjtcclxuICAgICAgICAgICAgZWxzZSBpZiAobiA9PSAxKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFwi0L5cIjtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFwi0LBcIjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFNob3dJbmZvKFBvaW50IHBudCwgcGFyYW1zIHN0cmluZ1tdIGxpbmVzKSB7XHJcbiAgICAgICAgICAgIFNob3dNb3JlSW5mbyhuZXcgVGltZUNvc3QoMCwgMCwgMCwgMCksIGZhbHNlLCBwbnQsIGxpbmVzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFNob3dNb3JlSW5mbyhUaW1lQ29zdCBjb3N0LCBib29sIGNzdEhpZ2hsaWdodCwgUG9pbnQ/IHBudCwgcGFyYW1zIHN0cmluZ1tdIGxpbmVzKSB7XHJcbiAgICAgICAgICAgIGxibFVuaXROYW1lSGVscFVuaXQuVGV4dCA9IGxpbmVzWzBdO1xyXG4gICAgICAgICAgICBsYmxSYWNlSGVscFVuaXQuVGV4dCA9IGxpbmVzWzFdO1xyXG5cclxuICAgICAgICAgICAgbGJsQ29zdE1vbmV5SGVscFVuaXQuVGV4dCA9IGNvc3QuTW9uZXkuVG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgaWYgKHBscnNbMF0ucmVzLk1vbmV5IDwgY29zdC5Nb25leSAmJiBjc3RIaWdobGlnaHQpXHJcbiAgICAgICAgICAgICAgICBsYmxDb3N0TW9uZXlIZWxwVW5pdC5UZXh0Q29sb3IgPSBDb2xvci5SZWQ7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIGxibENvc3RNb25leUhlbHBVbml0LlRleHRDb2xvciA9IG1vbmV5Q2xyO1xyXG5cclxuXHJcbiAgICAgICAgICAgIGlmIChjb3N0LkRlYXRoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgbGJsQ29zdERlYXRoSGVscFVuaXQuVGV4dCA9IGNvc3QuRGVhdGguVG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgICAgIGlmIChwbHJzWzBdLnJlcy5EZWF0aCA8IGNvc3QuRGVhdGggJiYgY3N0SGlnaGxpZ2h0KVxyXG4gICAgICAgICAgICAgICAgICAgIGxibENvc3REZWF0aEhlbHBVbml0LlRleHRDb2xvciA9IENvbG9yLlJlZDtcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICBsYmxDb3N0RGVhdGhIZWxwVW5pdC5UZXh0Q29sb3IgPSBkZWF0aENscjtcclxuICAgICAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICAgICAgICBsYmxDb3N0RGVhdGhIZWxwVW5pdC5UZXh0ID0gXCItXCI7XHJcblxyXG4gICAgICAgICAgICBjQmF0dGxlUGFyYW1ldGVycy5WaXNpYmxlID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICB2YXIgaSA9IDA7XHJcbiAgICAgICAgICAgIHZhciBsYXN0SCA9IGxibENvc3RNb25leUhlbHBVbml0LkJvdHRvbTtcclxuICAgICAgICAgICAgZm9yIChpID0gMjsgaSA8IGxpbmVzLkxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBsYmxzQWJpbHNbaSAtIDJdLlRleHQgPSBsaW5lc1tpXTtcclxuICAgICAgICAgICAgICAgIGxibHNBYmlsc1tpIC0gMl0uVGV4dENvbG9yID0gQ29sb3IuQmxhY2s7XHJcbiAgICAgICAgICAgICAgICBsYmxzQWJpbHNbaSAtIDJdLlZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgbGJsc0FiaWxzW2kgLSAyXS5ZID0gbGFzdEggKyA1O1xyXG4gICAgICAgICAgICAgICAgbGFzdEggPSBsYmxzQWJpbHNbaSAtIDJdLkJvdHRvbTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IGkgLSAyOyBqIDw9IDU7IGorKylcclxuICAgICAgICAgICAgICAgIGxibHNBYmlsc1tqXS5WaXNpYmxlID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICBmcm1IZWxwLkggPSBsYXN0SCArIDU7XHJcbiAgICAgICAgICAgIGlmICghcG50Lkhhc1ZhbHVlKSBwbnQgPSBuZXcgUG9pbnQoZ2FtZVdpZHRoIC0gZnJtSGVscC5XIC0gNDAsIDgwKTtcclxuXHJcbiAgICAgICAgICAgIGZybUhlbHAuWCA9IHBudC5WYWx1ZS5YICsgMjA7XHJcbiAgICAgICAgICAgIGZybUhlbHAuWSA9IHBudC5WYWx1ZS5ZICsgMjA7XHJcbiAgICAgICAgICAgIGlmIChmcm1IZWxwLlJpZ2h0ID4gZ2FtZVdpZHRoIC0gMjApXHJcbiAgICAgICAgICAgICAgICBmcm1IZWxwLlJpZ2h0ID0gZ2FtZVdpZHRoIC0gMjA7XHJcbiAgICAgICAgICAgIGlmIChmcm1IZWxwLkJvdHRvbSA+IGdhbWVIZWlnaHQgLSAyMClcclxuICAgICAgICAgICAgICAgIGZybUhlbHAuQm90dG9tID0gZ2FtZUhlaWdodCAtIDIwO1xyXG5cclxuICAgICAgICAgICAgZnJtSGVscC5WaXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBDcmVhdGVSYWNlTGlzdCgpIHtcclxuICAgICAgICAgICAgcmFjZXMxID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG4gICAgICAgICAgICByYWNlczIgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcbiAgICAgICAgICAgIHN0YW5kYXJ0UmFjZXMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKFJhY2UgciBpbiBSYWNlTWFuYWdlci5JbnN0YW5jZS5BbGwuVmFsdWVzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXIuc3BlY2lhbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJhY2VzMS5BZGQoci5uYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXIubm9BSSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmFjZXMyLkFkZChyLm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghci5jdXN0b20gJiYgIShyLm5hbWUgPT0gXCJSYW5kb21cIikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YW5kYXJ0UmFjZXMuQWRkKHIubmFtZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEFkZEN1c3RvbVJhY2Uoc3RyaW5nIG5hbWUpIHtcclxuICAgICAgICAgICAgc3RyaW5nIG5pY2ssIGRlc2M7XHJcbiAgICAgICAgICAgIGludCBzeW1iO1xyXG4gICAgICAgICAgICBib29sIG5vQUk7XHJcbiAgICAgICAgICAgIG5pY2sgPSBsb2NhbGl6ZS5HZXRTdHJpbmcobmFtZSk7XHJcbiAgICAgICAgICAgIHN5bWIgPSAxMCArIGludC5QYXJzZShuYW1lW25hbWUuTGVuZ3RoIC0gMV0uVG9TdHJpbmcoKSk7XHJcbiAgICAgICAgICAgIGRlc2MgPSBcItCh0LTQtdC70LDQvdC+INGB0LLQvtC40LzQuCDRgNGD0LrQsNC80LhcIjtcclxuICAgICAgICAgICAgbm9BSSA9IGZhbHNlO1xyXG4gICAgICAgICAgICBSYWNlTWFuYWdlci5JbnN0YW5jZS5BbGwuQWRkKG5hbWUsIG5ldyBSYWNlKG5hbWUsIGRlc2MsIG5pY2ssIHN5bWIsIG5vQUksIHRydWUsIGZhbHNlLCBmYWxzZSkpO1xyXG4gICAgICAgICAgICBPcmRlclJhY2VzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBPcmRlclJhY2VzKCkge1xyXG4gICAgICAgICAgICB2YXIgbmV3cmFjZXMgPSBnbG9iYWw6OkJyaWRnZS5TY3JpcHQuQ2FsbEZvcihuZXcgRGljdGlvbmFyeTxzdHJpbmcsIFJhY2U+KCksKF9vMSk9PntfbzEuQWRkKFwiUmFuZG9tXCIsbmV3IFJhY2UoXCJSYW5kb21cIiwgXCLQodC70YPRh9Cw0LnQvdGL0Lkg0LLRi9Cx0L7RgCDRhNGA0LDQutGG0LjQuFwiLCBsb2NhbGl6ZS5HZXRTdHJpbmcoXCJSYW5kb21cIiksIDQsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlKSk7cmV0dXJuIF9vMTt9KTtcclxuXHJcbiAgICAgICAgICAgIGlmIChQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGwuQ291bnQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IFByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS5tYXhDdXN0b21SYWNlczsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKFJhY2VNYW5hZ2VyLkluc3RhbmNlLkFsbC5Db250YWluc0tleShzdHJpbmcuRm9ybWF0KFwiQ3VzdG9tezB9XCIsaSkpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdyYWNlcy5BZGQoc3RyaW5nLkZvcm1hdChcIkN1c3RvbXswfVwiLGkpLCBSYWNlTWFuYWdlci5JbnN0YW5jZS5BbGxbc3RyaW5nLkZvcm1hdChcIkN1c3RvbXswfVwiLGkpXSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICBmb3JlYWNoIChSYWNlIHIgaW4gUmFjZU1hbmFnZXIuSW5zdGFuY2UuQWxsLlZhbHVlcykge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFyLmN1c3RvbSAmJiAhKHIubmFtZSA9PSBcIlJhbmRvbVwiKSlcclxuICAgICAgICAgICAgICAgICAgICBuZXdyYWNlcy5BZGQoci5uYW1lLCByKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgUmFjZU1hbmFnZXIuSW5zdGFuY2UuQWxsID0gbmV3cmFjZXM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBTYXZlQ3VycmVudEVkUmFjZSgpIHtcclxuICAgICAgICAgICAgLy9pZiAoIVJhY2VNYW5hZ2VyLkluc3RhbmNlLkFsbC5Db250YWluc0tleShjdXJyZW50RWRSYWNlKSlcclxuICAgICAgICAgICAgLy8gICAgQWRkQ3VzdG9tUmFjZShjdXJyZW50RWRSYWNlKTtcclxuICAgICAgICAgICAgLy97XHJcbiAgICAgICAgICAgIC8vdmFyIGFiaWwgPSBSYWNlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VycmVudEVkUmFjZV07XHJcbiAgICAgICAgICAgIC8vaWYgKCFzdHJpbmcuSXNOdWxsT3JFbXB0eShjdXJyZW50RWRSYWNlTmljaykpXHJcbiAgICAgICAgICAgIC8vICAgIGFiaWwubmljayA9IGN1cnJlbnRFZFJhY2VOaWNrO1xyXG4gICAgICAgICAgICAvL2FiaWwudW5pdHMuQ2xlYXIoKTtcclxuICAgICAgICAgICAgLy9mb3JlYWNoIChzdHJpbmcgdSBpbiBlZHVuaXRzKVxyXG4gICAgICAgICAgICAvLyAgICBhYmlsLnVuaXRzLkFkZCh1KTtcclxuICAgICAgICAgICAgLy9VbmxvY2tBY2hpdmllbWVudChcIk9wZW5lZGl0b3JcIik7XHJcbiAgICAgICAgICAgIC8vfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgQ2xlYXJWYXJzQW5kQ2FsY0Vhcm5lZCgpIHtcclxuICAgICAgICAgICAgc2VsVSA9IG51bGw7XHJcbiAgICAgICAgICAgIHBhcnMuQ2xlYXIoKTtcclxuICAgICAgICAgICAgYW1tb3MuQ2xlYXIoKTtcclxuICAgICAgICAgICAgdW5pdHMuQ2xlYXIoKTtcclxuICAgICAgICAgICAgZGVhdGhsaXN0LkNsZWFyKCk7XHJcbiAgICAgICAgICAgIGJvcm5MaXN0LkNsZWFyKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoZ1N0YXRlID09IEdhbWVTdGF0ZS5JbkdhbWUgfHwgZ1N0YXRlID09IEdhbWVTdGF0ZS5XaW4gfHwgZ1N0YXRlID09IEdhbWVTdGF0ZS5Mb3NlKVxyXG4gICAgICAgICAgICAgICAgUmVzZXRXb3JsZChzdW5BbmcsIGRBbmcpO1xyXG4gICAgICAgICAgICBpZiAoUmFjZU1hbmFnZXIuSW5zdGFuY2UuQWxsW3BscnNbMF0ucmFjZV0uZGlzYWJsZVJld2FyZHMpIHtcclxuICAgICAgICAgICAgICAgIHVubG9ja2VkQWNoaXZzLkNsZWFyKCk7XHJcbiAgICAgICAgICAgICAgICB1bmxvY2tlZFVuaXRzLkNsZWFyKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZ1N0YXRlID09IEdhbWVTdGF0ZS5XaW4pIHtcclxuICAgICAgICAgICAgICAgICAgICBVbmxvY2tBY2hpdmllbWVudChcIlN0YXJ0cGF0aFwiKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocGxyc1swXS5zdGF0RGVhdGhzID09IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFVubG9ja0FjaGl2aWVtZW50KFwiR2VudGxlbGVhZGVyXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb25kc1tQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0uZGlmZmljdWx0XS5uYW1lID09IFwiSGFyZFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLmFjaGl2cy5Db250YWluc0tleShcIkFsaXR0bGVoYXJkZXJcIikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0uYWNoaXZzLkFkZChcIkFsaXR0bGVoYXJkZXJcIiwgXCIyXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICghc3RyaW5nLklzTnVsbE9yRW1wdHkoUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLmFjaGl2c1tcIkFsaXR0bGVoYXJkZXJcIl0pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0uYWNoaXZzW1wiQWxpdHRsZWhhcmRlclwiXSA9IChpbnQuUGFyc2UoUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLmFjaGl2c1tcIkFsaXR0bGVoYXJkZXJcIl0pIC0gMSkuVG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0uYWNoaXZzW1wiQWxpdHRsZWhhcmRlclwiXSA9PSBcIjBcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bmxvY2tlZEFjaGl2cy5BZGQoXCJBbGl0dGxlaGFyZGVyXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwbHJzWzBdLnVuaXRzTGlzdC5Db3VudCA9PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBVbmxvY2tBY2hpdmllbWVudChcIlRydWVtYWdlXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKFByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS5taW52aWN0aW1zID09IC0xIHx8IFByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS5taW52aWN0aW1zID4gcGxyc1swXS5zdGF0RGVhdGhzKVxyXG4gICAgICAgICAgICAgICAgICAgIFByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS5taW52aWN0aW1zID0gcGxyc1swXS5zdGF0RGVhdGhzO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0ubWF4a2lsbHMgPT0gLTEgfHwgUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLm1heGtpbGxzIDwgcGxyc1sxXS5zdGF0RGVhdGhzKVxyXG4gICAgICAgICAgICAgICAgICAgIFByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS5tYXhraWxscyA9IHBscnNbMV0uc3RhdERlYXRocztcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIC8vIEVuZCBJZlxyXG4gICAgICAgICAgICBnU3RhdGUgPSBHYW1lU3RhdGUuTWFpbk1lbnU7XHJcbiAgICAgICAgICAgIFBhdXNlID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFVubG9ja0FjaGl2aWVtZW50KHN0cmluZyBhY2hpdikge1xyXG4gICAgICAgICAgICBpZiAoIVByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS5hY2hpdnMuQ29udGFpbnNLZXkoYWNoaXYpICYmICF1bmxvY2tlZEFjaGl2cy5Db250YWlucyhhY2hpdikpXHJcbiAgICAgICAgICAgICAgICB1bmxvY2tlZEFjaGl2cy5BZGQoYWNoaXYpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBDaGVja1B1cmNoYXNlQ29zdChzdHJpbmcgcHJjaCkge1xyXG4gICAgICAgICAgICBpZiAoUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLmNyeXN0YWxzID49IHB1cmNoYXNlc1twcmNoXS5jcnlzdGFscykge1xyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChwdXJjaGFzZXNbcHJjaF0ubmFtZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJCdXN0ZXIxVFwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gYXZ1bml0cyA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0aWVyID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKHN0cmluZyB1IGluIEFsbFVudHNMaXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVuaXRQcm1zW3VdLkNvc3QuVGllciA9PSB0aWVyICYmICF1bml0UHJtc1t1XS5pc0hlcm9pYyAmJiAhUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLnVuaXRzLkNvbnRhaW5zKHUpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdnVuaXRzLkFkZCh1KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdnVuaXRzLkNvdW50ID4gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJCdXN0ZXIyVFwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gYXZ1bml0cyA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0aWVyID0gMjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKHN0cmluZyB1IGluIEFsbFVudHNMaXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVuaXRQcm1zW3VdLkNvc3QuVGllciA9PSB0aWVyICYmICF1bml0UHJtc1t1XS5pc0hlcm9pYyAmJiAhUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLnVuaXRzLkNvbnRhaW5zKHUpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdnVuaXRzLkFkZCh1KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdnVuaXRzLkNvdW50ID4gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJCdXN0ZXIzVFwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gYXZ1bml0cyA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0aWVyID0gMztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKHN0cmluZyB1IGluIEFsbFVudHNMaXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVuaXRQcm1zW3VdLkNvc3QuVGllciA9PSB0aWVyICYmICF1bml0UHJtc1t1XS5pc0hlcm9pYyAmJiAhUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLnVuaXRzLkNvbnRhaW5zKHUpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdnVuaXRzLkFkZCh1KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdnVuaXRzLkNvdW50ID4gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJIZXJvYnVzdGVyXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBhdnVuaXRzID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoc3RyaW5nIHUgaW4gQWxsVW50c0xpc3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodW5pdFBybXNbdV0uaXNIZXJvaWMgJiYgIVByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS51bml0cy5Db250YWlucyh1KSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXZ1bml0cy5BZGQodSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXZ1bml0cy5Db3VudCA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQWRkaXRpb25TbG90XCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0ubWF4Q3VzdG9tUmFjZXMgPCAzKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBCdXkoc3RyaW5nIHByY2gpIHtcclxuICAgICAgICAgICAgaWYgKFByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS5jcnlzdGFscyA+PSBwdXJjaGFzZXNbcHJjaF0uY3J5c3RhbHMpIHtcclxuICAgICAgICAgICAgICAgIGJvb2wgY2FuY2VsID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHB1cmNoYXNlc1twcmNoXS5uYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkJ1c3RlcjFUXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBhdnVuaXRzID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJ1c3RzaXplID0gNDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0aWVyID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKHN0cmluZyB1IGluIEFsbFVudHNMaXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVuaXRQcm1zW3VdLkNvc3QuVGllciA9PSB0aWVyICYmICF1bml0UHJtc1t1XS5pc0hlcm9pYyAmJiAhUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLnVuaXRzLkNvbnRhaW5zKHUpICYmICF1bmxvY2tlZFVuaXRzLkNvbnRhaW5zKHUpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdnVuaXRzLkFkZCh1KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdnVuaXRzLkNvdW50ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChhdnVuaXRzLkNvdW50ID4gMCAmJiBidXN0c2l6ZSA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHUgPSBhdnVuaXRzW3JuZC5OZXh0KGF2dW5pdHMuQ291bnQpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5sb2NrZWRVbml0cy5BZGQodSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF2dW5pdHMuUmVtb3ZlKHUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBidXN0c2l6ZSAtPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQnVzdGVyMlRcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IGF2dW5pdHMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYnVzdHNpemUgPSAyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRpZXIgPSAyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoc3RyaW5nIHUgaW4gQWxsVW50c0xpc3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodW5pdFBybXNbdV0uQ29zdC5UaWVyID09IHRpZXIgJiYgIXVuaXRQcm1zW3VdLmlzSGVyb2ljICYmICFQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0udW5pdHMuQ29udGFpbnModSkgJiYgIXVubG9ja2VkVW5pdHMuQ29udGFpbnModSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF2dW5pdHMuQWRkKHUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF2dW5pdHMuQ291bnQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGF2dW5pdHMuQ291bnQgPiAwICYmIGJ1c3RzaXplID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdSA9IGF2dW5pdHNbcm5kLk5leHQoYXZ1bml0cy5Db3VudCldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bmxvY2tlZFVuaXRzLkFkZCh1KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXZ1bml0cy5SZW1vdmUodSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1c3RzaXplIC09IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuY2VsID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJCdXN0ZXIzVFwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gYXZ1bml0cyA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0aWVyID0gMztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKHN0cmluZyB1IGluIEFsbFVudHNMaXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVuaXRQcm1zW3VdLkNvc3QuVGllciA9PSB0aWVyICYmICF1bml0UHJtc1t1XS5pc0hlcm9pYyAmJiAhUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLnVuaXRzLkNvbnRhaW5zKHUpICYmICF1bmxvY2tlZFVuaXRzLkNvbnRhaW5zKHUpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdnVuaXRzLkFkZCh1KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdnVuaXRzLkNvdW50ID4gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bmxvY2tlZFVuaXRzLkFkZChhdnVuaXRzW3JuZC5OZXh0KGF2dW5pdHMuQ291bnQpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuY2VsID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJIZXJvYnVzdGVyXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBhdnVuaXRzID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoc3RyaW5nIHUgaW4gQWxsVW50c0xpc3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodW5pdFBybXNbdV0uaXNIZXJvaWMgJiYgIVByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS51bml0cy5Db250YWlucyh1KSAmJiAhdW5sb2NrZWRVbml0cy5Db250YWlucyh1KSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXZ1bml0cy5BZGQodSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXZ1bml0cy5Db3VudCA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5sb2NrZWRVbml0cy5BZGQoYXZ1bml0c1tybmQuTmV4dChhdnVuaXRzLkNvdW50KV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQWRkaXRpb25TbG90XCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0ubWF4Q3VzdG9tUmFjZXMgPCAzKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS5tYXhDdXN0b21SYWNlcyArPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKCFjYW5jZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICBQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0uY3J5c3RhbHMgLT0gcHVyY2hhc2VzW3ByY2hdLmNyeXN0YWxzO1xyXG4gICAgICAgICAgICAgICAgICAgIFVubG9ja0FjaGl2aWVtZW50KFwiRmlyc3RwdXJjaGFzZVwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgYnRuVW5pdFByZUdhbWVfQ2xpY2tlZChNb25vSW50ZXJmYWNlLkJ1dHRvbiBidG4sIGJvb2wgaXNUb3VjaCkge1xyXG4gICAgICAgICAgICB2YXIgdW5hbWUgPSB1bml0c1ByZUdhbWVbY1VuaXRzUHJlR2FtZS5DaGlsZHJlbi5JbmRleE9mKGJ0bildO1xyXG4gICAgICAgICAgICBpZiAoIXByZUdhbWVVbml0cy5Db250YWlucyh1bmFtZSkgJiYgcHJlR2FtZVVuaXRzLkNvdW50ICsgcHJlR2FtZVNwZWxscy5Db3VudCArIHByZUdhbWVCb251cy5Db3VudCA8IHByZUdhbWVTbG90Q250KSB7XHJcbiAgICAgICAgICAgICAgICBwcmVHYW1lVW5pdHMuQWRkKHVuYW1lKTtcclxuICAgICAgICAgICAgICAgIHByZUdhbWVVbml0cyA9IFNvcnRVbml0c0xpc3RzKHByZUdhbWVVbml0cyk7XHJcbiAgICAgICAgICAgICAgICBTZXRQcmVHYW1lTGlzdHMoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgYnRuU3BlbGxzUHJlR2FtZV9DbGlja2VkKE1vbm9JbnRlcmZhY2UuQnV0dG9uIGJ0biwgYm9vbCBpc1RvdWNoKSB7XHJcbiAgICAgICAgICAgIHZhciBzbmFtZSA9IHNwZWxsc1ByZUdhbWVbY1NwZWxsc1ByZUdhbWUuQ2hpbGRyZW4uSW5kZXhPZihidG4pXTtcclxuICAgICAgICAgICAgaWYgKCFwcmVHYW1lU3BlbGxzLkNvbnRhaW5zKHNuYW1lKSAmJiBwcmVHYW1lVW5pdHMuQ291bnQgKyBwcmVHYW1lU3BlbGxzLkNvdW50ICsgcHJlR2FtZUJvbnVzLkNvdW50IDwgcHJlR2FtZVNsb3RDbnQpIHtcclxuICAgICAgICAgICAgICAgIHByZUdhbWVTcGVsbHMuQWRkKHNuYW1lKTtcclxuICAgICAgICAgICAgICAgIHByZUdhbWVTcGVsbHMgPSBTb3J0U3BlbGxzTGlzdHMocHJlR2FtZVNwZWxscyk7XHJcbiAgICAgICAgICAgICAgICBTZXRQcmVHYW1lTGlzdHMoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgYnRuQnVpbGRpbmdQcmVHYW1lX0NsaWNrZWQoTW9ub0ludGVyZmFjZS5CdXR0b24gYnRuLCBib29sIGlzVG91Y2gpIHtcclxuICAgICAgICAgICAgdmFyIGJuYW1lID0gc3RhcnRCdWlsZGluZ3NMaXN0W2NCdWlsZGluZ3NQcmVHYW1lLkNoaWxkcmVuLkluZGV4T2YoYnRuKV07XHJcbiAgICAgICAgICAgIGlmICghcHJlR2FtZUJvbnVzLkNvbnRhaW5zKGJuYW1lKSAmJiBwcmVHYW1lVW5pdHMuQ291bnQgKyBwcmVHYW1lU3BlbGxzLkNvdW50ICsgcHJlR2FtZUJvbnVzLkNvdW50IDwgcHJlR2FtZVNsb3RDbnQpIHtcclxuICAgICAgICAgICAgICAgIHByZUdhbWVCb251cy5BZGQoYm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgU2V0UHJlR2FtZUxpc3RzKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIGJ0blNlbGVjdGVkUHJlR2FtZV9DbGlja2VkKE1vbm9JbnRlcmZhY2UuQnV0dG9uIGJ0biwgYm9vbCBpc1RvdWNoKSB7XHJcbiAgICAgICAgICAgIHZhciBpbmQgPSBjU2VsZWN0ZWRQcmVHYW1lLkNoaWxkcmVuLkluZGV4T2YoYnRuKTtcclxuICAgICAgICAgICAgaWYgKChpbmQgPCBwcmVHYW1lVW5pdHMuQ291bnQpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdW5hbWUgPSBwcmVHYW1lVW5pdHNbaW5kXTtcclxuICAgICAgICAgICAgICAgIHByZUdhbWVVbml0cy5SZW1vdmUodW5hbWUpO1xyXG4gICAgICAgICAgICAgICAgU2V0UHJlR2FtZUxpc3RzKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoKGluZCAtIHByZUdhbWVVbml0cy5Db3VudCA8IHByZUdhbWVTcGVsbHMuQ291bnQpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc25hbWUgPSBwcmVHYW1lU3BlbGxzW2luZCAtIHByZUdhbWVVbml0cy5Db3VudF07XHJcbiAgICAgICAgICAgICAgICBwcmVHYW1lU3BlbGxzLlJlbW92ZShzbmFtZSk7XHJcbiAgICAgICAgICAgICAgICBTZXRQcmVHYW1lTGlzdHMoKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICgoaW5kIC0gcHJlR2FtZVVuaXRzLkNvdW50IC0gcHJlR2FtZVNwZWxscy5Db3VudCA8IHByZUdhbWVCb251cy5Db3VudCkpIHtcclxuICAgICAgICAgICAgICAgIHZhciBibmFtZSA9IHByZUdhbWVCb251c1tpbmQgLSBwcmVHYW1lVW5pdHMuQ291bnQgLSBwcmVHYW1lU3BlbGxzLkNvdW50XTtcclxuICAgICAgICAgICAgICAgIHByZUdhbWVCb251cy5SZW1vdmUoYm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgU2V0UHJlR2FtZUxpc3RzKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIGJ0blVuaXRQcmVHYW1lX0ZvY3VzZWQoTW9ub0ludGVyZmFjZS5CdXR0b24gYnRuLCBib29sIGlzVG91Y2gpIHtcclxuICAgICAgICAgICAgaWYgKChjVW5pdHNQcmVHYW1lLkNoaWxkcmVuLkNvdW50ID09IHVuaXRzUHJlR2FtZS5Db3VudCkpIHtcclxuICAgICAgICAgICAgICAgIHZhciB1bmFtZSA9IHVuaXRzUHJlR2FtZVtjVW5pdHNQcmVHYW1lLkNoaWxkcmVuLkluZGV4T2YoYnRuKV07XHJcbiAgICAgICAgICAgICAgICBTaG93VW5pdEluZm8odW5pdFBybXNbdW5hbWVdLCAwLCBmYWxzZSwgbmV3IFBvaW50KChpbnQpKGJ0bi5GaW5hbFJpZ2h0IC8gTWFpbkNvbnRhaW5lci5GaW5hbENoaWxkcmVuU2NhbGVYKSwgKGludCkoYnRuLkZpbmFsQm90dG9tIC8gTWFpbkNvbnRhaW5lci5GaW5hbENoaWxkcmVuU2NhbGVZKSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBidG5TcGVsbHNQcmVHYW1lX0ZvY3VzZWQoTW9ub0ludGVyZmFjZS5CdXR0b24gYnRuLCBib29sIGlzVG91Y2gpIHtcclxuICAgICAgICAgICAgaWYgKChjU3BlbGxzUHJlR2FtZS5DaGlsZHJlbi5Db3VudCA9PSBzcGVsbHNQcmVHYW1lLkNvdW50KSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHNuYW1lID0gc3BlbGxzUHJlR2FtZVtjU3BlbGxzUHJlR2FtZS5DaGlsZHJlbi5JbmRleE9mKGJ0bildO1xyXG4gICAgICAgICAgICAgICAgU2hvd01vcmVJbmZvKHNwZWxsc1tzbmFtZV0uQ29zdCwgZmFsc2UsIG5ldyBQb2ludCgoaW50KShidG4uRmluYWxSaWdodCAvIE1haW5Db250YWluZXIuRmluYWxDaGlsZHJlblNjYWxlWCksIChpbnQpKGJ0bi5GaW5hbEJvdHRvbSAvIE1haW5Db250YWluZXIuRmluYWxDaGlsZHJlblNjYWxlWSkpLCBsb2NhbGl6ZS5HZXRTdHJpbmcoc3BlbGxzW3NuYW1lXS5OYW1lKSwgbG9jYWxpemUuR2V0U3RyaW5nKHNwZWxsc1tzbmFtZV0uU2Nob29sLCBzcGVsbHNbc25hbWVdLkNvc3QuVGllciksIHNwZWxsc1tzbmFtZV0uRGVzY3JpcHRpb24pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBidG5CdWlsZGluZ1ByZUdhbWVfRm9jdXNlZChNb25vSW50ZXJmYWNlLkJ1dHRvbiBidG4sIGJvb2wgaXNUb3VjaCkge1xyXG4gICAgICAgICAgICB2YXIgYm5hbWUgPSBzdGFydEJ1aWxkaW5nc0xpc3RbY0J1aWxkaW5nc1ByZUdhbWUuQ2hpbGRyZW4uSW5kZXhPZihidG4pXTtcclxuICAgICAgICAgICAgU2hvd1VuaXRJbmZvKHVuaXRQcm1zW2JuYW1lXSwgMCwgZmFsc2UsIG5ldyBQb2ludCgoaW50KShidG4uRmluYWxSaWdodCAvIE1haW5Db250YWluZXIuRmluYWxDaGlsZHJlblNjYWxlWCksIChpbnQpKGJ0bi5GaW5hbEJvdHRvbSAvIE1haW5Db250YWluZXIuRmluYWxDaGlsZHJlblNjYWxlWSkpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIGJ0blNlbGVjdGVkUHJlR2FtZV9Gb2N1c2VkKE1vbm9JbnRlcmZhY2UuQnV0dG9uIGJ0biwgYm9vbCBpc1RvdWNoKSB7XHJcbiAgICAgICAgICAgIHZhciBpbmQgPSBjU2VsZWN0ZWRQcmVHYW1lLkNoaWxkcmVuLkluZGV4T2YoYnRuKTtcclxuICAgICAgICAgICAgaWYgKChpbmQgPCBwcmVHYW1lVW5pdHMuQ291bnQpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdW5hbWUgPSBwcmVHYW1lVW5pdHNbaW5kXTtcclxuICAgICAgICAgICAgICAgIFNob3dVbml0SW5mbyh1bml0UHJtc1t1bmFtZV0sIDAsIGZhbHNlLCBuZXcgUG9pbnQoKGludCkoYnRuLkZpbmFsUmlnaHQgLyBNYWluQ29udGFpbmVyLkZpbmFsQ2hpbGRyZW5TY2FsZVgpLCAoaW50KShidG4uRmluYWxCb3R0b20gLyBNYWluQ29udGFpbmVyLkZpbmFsQ2hpbGRyZW5TY2FsZVkpKSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoKGluZCAtIHByZUdhbWVVbml0cy5Db3VudCA8IHByZUdhbWVTcGVsbHMuQ291bnQpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc25hbWUgPSBwcmVHYW1lU3BlbGxzW2luZCAtIHByZUdhbWVVbml0cy5Db3VudF07XHJcbiAgICAgICAgICAgICAgICBTaG93TW9yZUluZm8oc3BlbGxzW3NuYW1lXS5Db3N0LCB0cnVlLCBuZXcgUG9pbnQoKGludCkoYnRuLkZpbmFsUmlnaHQgLyBNYWluQ29udGFpbmVyLkZpbmFsQ2hpbGRyZW5TY2FsZVgpLCAoaW50KShidG4uRmluYWxCb3R0b20gLyBNYWluQ29udGFpbmVyLkZpbmFsQ2hpbGRyZW5TY2FsZVkpKSwgbG9jYWxpemUuR2V0U3RyaW5nKHNwZWxsc1tzbmFtZV0uTmFtZSksIGxvY2FsaXplLkdldFN0cmluZyhzcGVsbHNbc25hbWVdLlNjaG9vbCwgc3BlbGxzW3NuYW1lXS5Db3N0LlRpZXIuVG9TdHJpbmcoKSksIHNwZWxsc1tzbmFtZV0uRGVzY3JpcHRpb24pO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKChpbmQgLSBwcmVHYW1lVW5pdHMuQ291bnQgLSBwcmVHYW1lU3BlbGxzLkNvdW50IDwgcHJlR2FtZUJvbnVzLkNvdW50KSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGJuYW1lID0gcHJlR2FtZUJvbnVzW2luZCAtIHByZUdhbWVVbml0cy5Db3VudCAtIHByZUdhbWVTcGVsbHMuQ291bnRdO1xyXG4gICAgICAgICAgICAgICAgU2hvd1VuaXRJbmZvKHVuaXRQcm1zW2JuYW1lXSwgMCwgZmFsc2UsIG5ldyBQb2ludCgoaW50KShidG4uRmluYWxSaWdodCAvIE1haW5Db250YWluZXIuRmluYWxDaGlsZHJlblNjYWxlWCksIChpbnQpKGJ0bi5GaW5hbEJvdHRvbSAvIE1haW5Db250YWluZXIuRmluYWxDaGlsZHJlblNjYWxlWSkpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgRG9Vbml0c1NwZWxscyhzdHJpbmcgbmFtZSwgTGlzdDxVbml0PiB0cmdzKSB7XHJcbiAgICAgICAgICAgIGJvb2wgY2FuY2VsID0gdHJ1ZTtcclxuICAgICAgICAgICAgZm9yZWFjaCAoVW5pdCB0cmcgaW4gdHJncykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRyZy5wYXJhbWV0ZXJzLmlzQnVpbGRpbmcpIHtcclxuICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCd0LUg0YHRg9GJ0LXRgdGC0LLQvlwiLCBiYWRBYmlsQ2xyLCB0cmcueCwgaG9yICsgdHJnLnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHRyZy5BYnNDb250YWlucyhcIlNwZWxscHJvb2ZcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCX0LDRidC40YLQsCDQvtGCINC80LDQs9C40LhcIiwgYmFkQWJpbENsciwgdHJnLngsIGhvciArIHRyZy5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChuYW1lID09IFwiTWFnaWNfYXJtb3JcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0cmcuQWJzQ29udGFpbnMoXCJJbnZ1bG5lcmFibGVcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCLQo9C20LUg0LfQsNGJ0LjRidC10L1cIiwgYmFkQWJpbENsciwgdHJnLngsIGhvciArIHRyZy5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKG5hbWUgPT0gXCJEYXJrX2Fycm93XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHJnLkFic0NvbnRhaW5zKFwiTWFjaGluZXJ5XCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwi0J3QtdC70YzQt9GPINC00L7QsdC40YLRjCDQvNC10YXQsNC90LjQt9C8XCIsIGJhZEFiaWxDbHIsIHRyZy54LCBob3IgKyB0cmcucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodHJnLkFic0NvbnRhaW5zKFwiQm9keWxlc3NcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCLQndC10LvRjNC30Y8g0LTQvtCx0LjRgtGMINCx0LXRgdGC0LXQu9C10YHQvdC+0LPQvlwiLCBiYWRBYmlsQ2xyLCB0cmcueCwgaG9yICsgdHJnLnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRyZy5ocCA+IDIwMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCh0LvQuNGI0LrQvtC8INC80L3QvtCz0L4g0LfQtNC+0YDQvtCy0YzRj1wiLCBiYWRBYmlsQ2xyLCB0cmcueCwgaG9yICsgdHJnLnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAobmFtZSA9PSBcIk9ibGl2aW9uXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHJnLkFic0NvbnRhaW5zKFwiUHVyaWZpZWRcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCLQo9C20LUg0LvQuNGI0LXQvVwiLCBiYWRBYmlsQ2xyLCB0cmcueCwgaG9yICsgdHJnLnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRyZy5BYnNDb250YWlucyhcIkV0ZXJuYWxcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCLQl9Cw0YnQuNGJ0LXQvSDQvtGCINC70LjRiNC10L3QuNGPINGB0L/QvtGB0L7QsdC90L7RgdGC0LXQuVwiLCBiYWRBYmlsQ2xyLCB0cmcueCwgaG9yICsgdHJnLnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY2FuY2VsID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChuYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkhlYWxcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSGVhbCh0cmcsIHRyZy5wYXJhbWV0ZXJzLm1heGhwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJIYXN0ZVwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmcucGFyYW1ldGVycy5TcGVlZCA9IFwiVmVyeV9mYXN0XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmcuQWRkQWJpbGl0eShcIkFnaWxpdHlcIiwgMjAsIEVmZmVjdFR5cGUuR29vZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiV2Vha25lc3NcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJnLnBhcmFtZXRlcnMuU3BlZWQgPSBcIlNsb3dcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZy5BZGRBYmlsaXR5KFwiQ2x1bXNpbmVzc1wiLCBFZmZlY3RUeXBlLkJhZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiUmVzY3VlXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZy54ID0gcGxyc1t0cmcub3duZXJdLmJhc2VYICsgdHJnLm1vdmVzaWRlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkdob3N0X21vZGVcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJnLkFkZEFiaWxpdHkoXCJVbmRlYWRcIiwgRWZmZWN0VHlwZS5Hb29kKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZy5BZGRBYmlsaXR5KFwiQm9keWxlc3NcIiwgRWZmZWN0VHlwZS5Hb29kKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZy5SZW1vdmVBYmlsKFwiUG9pc29uXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIlRoZV9Db3ZlbmFudFwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bml0c1sxIC0gdHJnLm93bmVyXS5ocCAtPSB0cmcuaHA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcIi1cIiArIHRyZy5ocC5Ub1N0cmluZygpLCBiYWRBYmlsQ2xyLCB1bml0c1sxIC0gdHJnLm93bmVyXS54LCBob3IgKyB1bml0c1sxIC0gdHJnLm93bmVyXS5wYXJhbWV0ZXJzLnJlY3QuVG9wLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBLaWxsKHRyZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiTWFnaWNfYXJyb3dcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSGFybSh0cmcsIHJuZC5OZXh0KDEwMCwgMTUxKSwgdHJ1ZSwgRWZmZWN0VHlwZS5CYWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIlBvbHltb3JwaFwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gYWxsdW5pdHN0ID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IHU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChVbml0UGFyYW1ldGVycyB1cCBpbiB1bml0UHJtcy5WYWx1ZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXVwLnNwZWNpYWwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVwLkNvc3QuVGllciA9PSB0cmcucGFyYW1ldGVycy5Db3N0LlRpZXIgJiYgcGxyc1t0cmcub3duZXJdLkNoZWNrRm9yTGltaXQodXAuTmFtZSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGx1bml0c3QuQWRkKHVwLk5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhbGx1bml0c3QuQ291bnQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdSA9IHJuZC5OZXh0KDAsIGFsbHVuaXRzdC5Db3VudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJnLlNldFBhcmFtcyh1bml0UHJtc1thbGx1bml0c3RbdV1dLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmcucHVyaWZpZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmcudGFrZWRPZmYgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmcubGFuZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWwgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwi0J3QtdGCINC/0L7QtNGF0L7QtNGP0YnQuNGFINGB0YPRidC10YHRgtCyXCIsIGJhZEFiaWxDbHIsIHRyZy54LCBob3IgKyB0cmcucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkRhcmtfYXJyb3dcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgS2lsbCh0cmcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IGFsbHVuaXRzdCA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCB1O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoVW5pdFBhcmFtZXRlcnMgdXAgaW4gdW5pdFBybXMuVmFsdWVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF1cC5zcGVjaWFsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1cC5Db3N0LlRpZXIgPT0gdHJnLnBhcmFtZXRlcnMuQ29zdC5UaWVyICYmIHVwLkFic0NvbnRhaW5zKFwiVW5kZWFkXCIpICYmIHBscnNbMF0uQ2hlY2tGb3JMaW1pdCh1cC5OYW1lKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsbHVuaXRzdC5BZGQodXAuTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFsbHVuaXRzdC5Db3VudCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1ID0gcm5kLk5leHQoMCwgYWxsdW5pdHN0LkNvdW50KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3JuTGlzdC5BZGQobmV3IFVuaXQodGhpcywgdHJnLngsIDEsIDAsIHVuaXRQcm1zW2FsbHVuaXRzdFt1XV0pKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwi0J3QtdGCINC/0L7QtNGF0L7QtNGP0YnQuNGFINGB0YPRidC10YHRgtCyXCIsIGJhZEFiaWxDbHIsIHRyZy54LCBob3IgKyB0cmcucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiVHJhbnNtdXRhdGlvblwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gYWxsdW5pdHN0ID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IHU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChVbml0UGFyYW1ldGVycyB1cCBpbiB1bml0UHJtcy5WYWx1ZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXVwLnNwZWNpYWwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVwLkNvc3QuVGllciA9PSB0cmcucGFyYW1ldGVycy5Db3N0LlRpZXIgKyAxICYmIHVwLlJhY2UgPT0gdHJnLnBhcmFtZXRlcnMuUmFjZSAmJiBwbHJzWzBdLkNoZWNrRm9yTGltaXQodXAuTmFtZSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGx1bml0c3QuQWRkKHVwLk5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhbGx1bml0c3QuQ291bnQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdSA9IHJuZC5OZXh0KDAsIGFsbHVuaXRzdC5Db3VudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJnLlNldFBhcmFtcyh1bml0UHJtc1thbGx1bml0c3RbdV1dLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRyZy5ocCA+IHRyZy5wYXJhbWV0ZXJzLm1heGhwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmcuaHAgPSB0cmcucGFyYW1ldGVycy5tYXhocDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmcucHVyaWZpZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmcudGFrZWRPZmYgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmcubGFuZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWwgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwi0J3QtdGCINC/0L7QtNGF0L7QtNGP0YnQuNGFINGB0YPRidC10YHRgtCyXCIsIGJhZEFiaWxDbHIsIHRyZy54LCBob3IgKyB0cmcucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkdvb2dsZWhhbW1lclwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmcuQWRkQWJpbGl0eShcIk1hZ2VcIiwgRWZmZWN0VHlwZS5Hb29kKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0cmcucGFyYW1ldGVycy5BdHRhY2suUmFuZ2UgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZy5wYXJhbWV0ZXJzLkF0dGFjay5SYW5nZSA9IDM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJnLnBhcmFtZXRlcnMuYW1tb1R5cGUgPSBBbW1vLkFtbW9UeXBlLkhhbW1lcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHJnLnBhcmFtZXRlcnMuQXR0YWNrLlNwZWVkIDwgNjApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZy5wYXJhbWV0ZXJzLkF0dGFjay5TcGVlZCA9IDYwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJNYWdpY19hcm1vclwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmcuQWRkQWJpbGl0eShcIkludnVsbmVyYWJsZVwiLCA0MDAsIEVmZmVjdFR5cGUuR29vZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiT2JsaXZpb25cIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJnLnB1cmlmaWVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICghY2FuY2VsKSB7XHJcbiAgICAgICAgICAgICAgICBTcGVsbENvbXBsZXRlKG5hbWUpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgRG9HbG9iYWxTcGVsbHMoc3RyaW5nIG5hbWUpIHtcclxuICAgICAgICAgICAgc3dpdGNoIChuYW1lKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiRWFydGhxdWFrZVwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKFVuaXQgdSBpbiB1bml0cykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUucGFyYW1ldGVycy5pc0J1aWxkaW5nICYmICF1LkFic0NvbnRhaW5zKFwiU3BlbGxwcm9vZlwiKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIYXJtKHUsIHJuZC5OZXh0KDI1MCwgNTAxKSwgdHJ1ZSwgRWZmZWN0VHlwZS5CYWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSBcIk1hbmFfYmxhc3RcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChVbml0IHUgaW4gdW5pdHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1LkFic0NvbnRhaW5zKFwiTWFnZVwiKSAmJiAhdS5BYnNDb250YWlucyhcIlNwZWxscHJvb2ZcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFeHBsb2RlKHUsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1LnBhcmFtZXRlcnMuQXJtb3IgIT0gXCJOb25lXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUucGFyYW1ldGVycy5Bcm1vciA9IFwiTm9uZVwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSBcIlN0b3JtXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoVW5pdCB1IGluIHVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodS5vd25lciAhPSAwICYmICF1LnBhcmFtZXRlcnMuaXNCdWlsZGluZyAmJiB1LnBhcmFtZXRlcnMubW92ZVR5cGUgPT0gVW5pdE1vdmVUeXBlLkZseWluZ01UICYmICF1LkFic0NvbnRhaW5zKFwiU3BlbGxwcm9vZlwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhhcm0odSwgcm5kLk5leHQoNzAsIDEwMSksIGZhbHNlLCBFZmZlY3RUeXBlLkJhZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdS5sYW5kaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgXCJNYXNzX3BvbHltb3JwaFwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBhbGx1bml0c3QgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGludCB1O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChVbml0IHV1IGluIHVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXV1LnBhcmFtZXRlcnMuaXNCdWlsZGluZyAmJiAhdXUuQWJzQ29udGFpbnMoXCJTcGVsbHByb29mXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxsdW5pdHN0LkNsZWFyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoVW5pdFBhcmFtZXRlcnMgdXAgaW4gdW5pdFBybXMuVmFsdWVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdXAuc3BlY2lhbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVwLkNvc3QuVGllciA9PSB1dS5wYXJhbWV0ZXJzLkNvc3QuVGllciAmJiBwbHJzW3V1Lm93bmVyXS5DaGVja0ZvckxpbWl0KHVwLk5hbWUpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsbHVuaXRzdC5BZGQodXAuTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFsbHVuaXRzdC5Db3VudCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdSA9IHJuZC5OZXh0KDAsIGFsbHVuaXRzdC5Db3VudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV1LlNldFBhcmFtcyh1bml0UHJtc1thbGx1bml0c3RbdV1dLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXUucHVyaWZpZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXUudGFrZWRPZmYgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXUubGFuZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgXCJKYWNrcG90XCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IGFsbHNwZWxscyA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoc3RyaW5nIHNwbCBpbiBzcGVsbHMuS2V5cylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsbHNwZWxscy5BZGQoc3BsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGxyc1swXS5zcGxsc0xpc3QgPSBSYW5kb21pemVTcGVsbHMocGxyc1swXS5zcGxsc0xpc3QuQ291bnQsIGFsbHNwZWxscyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZVNwZWxscyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiQXJyb3dyYWluXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoVW5pdCB1dSBpbiB1bml0cykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHV1Lm93bmVyID09IDEgJiYgISh1dS5wYXJhbWV0ZXJzLk5hbWUgPT0gcGxyc1sxXS5oZXJvKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW1vcy5BZGQobmV3IEFtbW8oMCwgQW1tby5BbW1vVHlwZS5BcnJvdywgLXVzMiwgaG9yLCBudWxsLCB1dSwgcGxyc1swXS51Q291bnQgKiBybmQuTmV4dCg1LCAxMSksIGZhbHNlLCBmYWxzZSwgNzIwMCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSBcIlBvaXNvbl93YXZlXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoVW5pdCB1dSBpbiB1bml0cykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF1dS5BYnNDb250YWlucyhcIlNwZWxscHJvb2ZcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXUuQWJzQ29udGFpbnMoXCJQb2lzb25cIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXUuUmVtb3ZlQWJpbChcIlBvaXNvblwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHV1Lm93bmVyID09IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIZWFsKHV1LCBybmQuTmV4dCg3MCwgMTAxKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHV1Lm93bmVyID09IDEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIYXJtKHV1LCBybmQuTmV4dCg3MCwgMTAxKSwgdHJ1ZSwgRWZmZWN0VHlwZS5Qb2lzb24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFNwZWxsQ29tcGxldGUobmFtZSk7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgU3BlbGxDb21wbGV0ZShzdHJpbmcgbmFtZSkge1xyXG4gICAgICAgICAgICBwbHJzWzBdLlJlc291cmNlcyA9IHBscnNbMF0uUmVzb3VyY2VzIC0gc3BlbGxzW25hbWVdLkNvc3Q7XHJcbiAgICAgICAgICAgIHBscnNbMF0uc3BlbGxzUmNocmdbcGxyc1swXS5zcGxsc0xpc3QuSW5kZXhPZihuYW1lKV0gPSBzcGVsbHNbbmFtZV0uQ29zdC5UaW1lO1xyXG4gICAgICAgICAgICBTaG93SW5mb1Bhcihsb2NhbGl6ZS5HZXRTdHJpbmcobmFtZSksIGdvb2RBYmlsQ2xyLCBnYW1lV2lkdGggLyAyLCBnYW1lSGVpZ2h0IC8gMiwgdHJ1ZSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKFVuaXQgdXUgaW4gdW5pdHMpIHtcclxuICAgICAgICAgICAgICAgIGlmICh1dS5BYnNDb250YWlucyhcIkFudGltYWdlXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdXUuQXR0YWNrICs9IHV1LmFiaWxzW1wiQW50aW1hZ2VcIl0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCLQnNCw0LPQuNGPIVwiLCBnb29kQWJpbENsciwgdXUueCwgaG9yICsgdXUucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodXUuQWJzQ29udGFpbnMoXCJNYWdpY19wb3dlclwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHV1LnBhcmFtZXRlcnMuQXR0YWNrLlJhbmdlICs9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCLQnNCw0LPQuNGPIVwiLCBnb29kQWJpbENsciwgdXUueCwgaG9yICsgdXUucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgdm9pZCBNb3VzZUNsaWNrZWQoVmVjdG9yMiBwb3MsIGJvb2wgaXNUb3VjaCA9IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIGlmIChzZWxVICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICBzZWxVID0gbnVsbDtcclxuICAgICAgICAgICAgTWFpbkNvbnRhaW5lci5DbGlja0J1dHRvbigoaW50KXBvcy5YLCAoaW50KXBvcy5ZLCBpc1RvdWNoKTtcclxuICAgICAgICAgICAgaWYgKGdTdGF0ZSA9PSBHYW1lU3RhdGUuSW5HYW1lKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVzcG9zID0gbmV3IFZlY3RvcjIocG9zLlggKiAoZmxvYXQpc2NhbGVYLCBwb3MuWSAqIChmbG9hdClzY2FsZVkpO1xyXG5cclxuICAgICAgICAgICAgICAgIExpc3Q8VW5pdD4gdHJncyA9IG5ldyBMaXN0PFVuaXQ+KCk7XHJcbiAgICAgICAgICAgICAgICBmb3JlYWNoIChVbml0IHUgaW4gdW5pdHMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodS54ICsgdS5wYXJhbWV0ZXJzLnJlY3QuUmlnaHQgPiByZXNwb3MuWCAmJiByZXNwb3MuWCA+IHUueCArIHUucGFyYW1ldGVycy5yZWN0LkxlZnQgJiYgaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuQm90dG9tID4gcmVzcG9zLlkgJiYgcmVzcG9zLlkgPiBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Ub3ApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUub3duZXIgPT0gMSB8fCAhdS5BYnNDb250YWlucyhcIkludmlzaWJsZVwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsVSA9IHU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmdzLkFkZCh1KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChpblNwZWxsTW9kZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChEb1VuaXRzU3BlbGxzKHNwZWxsTmFtZSwgdHJncykpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluU3BlbGxNb2RlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgdm9pZCBBZGRUb1JlYWR5VW5pdHMoUGxheWVyIHBsciwgc3RyaW5nIHVuaXROYW1lKSB7XHJcbiAgICAgICAgICAgIHZhciB1bml0UmVzID0gdW5pdE5hbWU7XHJcbiAgICAgICAgICAgIGlmICh1bml0UHJtc1t1bml0TmFtZV0uQWJzQ29udGFpbnMoXCJDcm93ZFwiKSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHVuaXRQcm1zW3VuaXROYW1lXS5BYnNDb250YWlucyhcIkNyb3dkMlwiKSAmJiBwbHIucmVzLlRpZXIgPT0gMikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChybmQuTmV4dERvdWJsZSgpIDwgMC41KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB1bml0UmVzID0gXCJTa2VsZXRvbl9hcmNoZXJcIjtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChybmQuTmV4dERvdWJsZSgpIDwgMC44KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB1bml0UmVzID0gXCJTa2VsZXRvbl93YXJyaW9yXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB1bml0UmVzID0gXCJTa2VsZXRvbl9rbmlnaHRcIjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocm5kLk5leHREb3VibGUoKSA8IDAuNSlcclxuICAgICAgICAgICAgICAgICAgICB1bml0UmVzID0gXCJTa2VsZXRvbl9hcmNoZXJcIjtcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICB1bml0UmVzID0gXCJTa2VsZXRvbl93YXJyaW9yXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcGxyLnJlYWR5VW5pdHMuQWRkKHVuaXRSZXMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGV2ZW50IE9uRXhpdEV2ZW50SGFuZGxlciBPbkV4aXQ7XHJcblxyXG4gICAgICAgIHB1YmxpYyBkZWxlZ2F0ZSB2b2lkIE9uRXhpdEV2ZW50SGFuZGxlcigpO1xyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW07XHJcbnVzaW5nIE1pY3Jvc29mdC5YbmEuRnJhbWV3b3JrO1xyXG51c2luZyBNaWNyb3NvZnQuWG5hLkZyYW1ld29yay5HcmFwaGljcztcclxudXNpbmcgTWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuSW5wdXQ7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG5cclxubmFtZXNwYWNlIERhcmtLaW5nZG9tQ29yZSB7XHJcbiAgICBwdWJsaWMgcGFydGlhbCBjbGFzcyBNeUdhbWUge1xyXG4gICAgICAgIHB1YmxpYyBNb25vSW50ZXJmYWNlLldpbmRvdyBNYWluQ29udGFpbmVyO1xyXG5cclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuQW5pbWF0b3IgbWFpbkFuaW1hdG9yO1xyXG5cclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuVGhlbWUgZGVmYXVsdFRoZW1lO1xyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5UaGVtZSBiYWNrVGhlbWU7XHJcblxyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5GcmFtZSBmcm1Db25maXJtO1xyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5MYWJlbCBsYmxUZXh0RnJtQ29uZmlybTtcclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuQnV0dG9uIGJ0bk9rYXlGcm1EaWFsb2dDb25maXJtO1xyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5CdXR0b24gYnRuTm9wZUZybURpYWxvZ0NvbmZpcm07XHJcblxyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5GcmFtZSBmcm1TZXR0aW5ncyB7IGdldDsgc2V0OyB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5Td2l0Y2hlciByZXNTd2l0Y2hlckZybVNldHRpbmdzIHsgZ2V0OyBzZXQ7IH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgRHJhd0ludGVyZmFjZShTcHJpdGVCYXRjaCBzYikge1xyXG4gICAgICAgICAgICBNYWluQ29udGFpbmVyLkRyYXcoc2IsIDEuMGYpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkZyYW1lIGZybU1haW5NZW51O1xyXG5wdWJsaWMgdm9pZCBiYXR0bGVGcm1NYWluTWVudShNb25vSW50ZXJmYWNlLkJ1dHRvbiBidG4sIGJvb2wgaXNUb3VjaClcclxue1xyXG4gICAgU3RhcnRCYXR0bGUoKTtcclxufXB1YmxpYyB2b2lkIHByb2ZpbGVGcm1NYWluTWVudShNb25vSW50ZXJmYWNlLkJ1dHRvbiBidG4sIGJvb2wgaXNUb3VjaClcclxue1xyXG4gICAgU3RhcnRQcm9maWxlKCk7XHJcbn1cclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuRnJhbWUgZnJtQmF0dGxlTWVudTtcclxuXHJcbiAgICAgICAgcHVibGljIGFzeW5jIHZvaWQgc3VycmVuZGVyRnJtQmF0dGxlTWVudV9DbGlja2VkKE1vbm9JbnRlcmZhY2UuQnV0dG9uIGJ0biwgYm9vbCBpc1RvdWNoKSB7XHJcbiAgICAgICAgICAgIGZybUJhdHRsZU1lbnUuSGlkZShtYWluQW5pbWF0b3IpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGF3YWl0IFNob3dEaWFsb2dDb25maXJtYXRpb24oXCLRh9GC0L4g0YXQvtGC0LjRgtC1INGB0LTQsNGC0YzRgdGPP1wiKSkge1xyXG4gICAgICAgICAgICAgICAgZ1N0YXRlID0gR2FtZVN0YXRlLkxvc2U7XHJcbiAgICAgICAgICAgICAgICBFbmRPZkJhdHRsZSgpO1xyXG4gICAgICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgICAgIGZybUJhdHRsZU1lbnUuU2hvdyhtYWluQW5pbWF0b3IpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGFzeW5jIHZvaWQgcmVzdGFydEZybUJhdHRsZU1lbnVfQ2xpY2tlZChNb25vSW50ZXJmYWNlLkJ1dHRvbiBidG4sIGJvb2wgaXNUb3VjaCkge1xyXG4gICAgICAgICAgICBmcm1CYXR0bGVNZW51LkhpZGUobWFpbkFuaW1hdG9yKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChhd2FpdCBTaG93RGlhbG9nQ29uZmlybWF0aW9uKFwi0YfRgtC+INGF0L7RgtC40YLQtSDQvdCw0YfQsNGC0Ywg0LfQsNC90L7QstC+P1wiKSlcclxuICAgICAgICAgICAgICAgIFN0YXJ0QWdhaW4oKTtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgZnJtQmF0dGxlTWVudS5TaG93KG1haW5BbmltYXRvcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBBSUZybUJhdHRsZU1lbnVfQ2xpY2tlZChNb25vSW50ZXJmYWNlLkJ1dHRvbiBidG4sIGJvb2wgaXNfdG91Y2gpIHtcclxuICAgICAgICAgICAgU2V0UGxheWVyQUkoIXBscnNbMF0uQUkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgYmFja0ZybUJhdHRsZU1lbnVfQ2xpY2tlZChNb25vSW50ZXJmYWNlLkJ1dHRvbiBidG4sIGJvb2wgaXNUb3VjaCkge1xyXG4gICAgICAgICAgICBQYXVzZSA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkxhYmVsIGxibEFJRnJtQmF0dGxlTWVudTtcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkZyYW1lIGZybVJpZ2h0TWVudTtcclxuXHJcbiAgICAgICAgcHVibGljIGFzeW5jIHZvaWQgZXhpdEZybU1lbnVFeGl0X0NsaWNrZWQoTW9ub0ludGVyZmFjZS5CdXR0b24gYnRuLCBib29sIGlzVG91Y2gpIHtcclxuICAgICAgICAgICAgaWYgKGF3YWl0IFNob3dEaWFsb2dDb25maXJtYXRpb24oXCLRh9GC0L4g0YXQvtGC0LjRgtC1INCy0YvQudGC0Lgg0LjQtyDQuNCz0YDRiz9cIikpXHJcbiAgICAgICAgICAgICAgICBPbkV4aXQhPW51bGw/Z2xvYmFsOjpCcmlkZ2UuU2NyaXB0LkZyb21MYW1iZGEoKCk9Pk9uRXhpdC5JbnZva2UoKSk6bnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgdm9pZCBzZXR0aW5nc0ZybU1lbnVFeGl0X0NsaWNrZWQoTW9ub0ludGVyZmFjZS5CdXR0b24gYnRuLCBib29sIGlzVG91Y2gpIHtcclxuICAgICAgICAgICAgZnJtU2V0dGluZ3MuU2hvdyhtYWluQW5pbWF0b3IpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5GcmFtZSBmcm1EaWFsb2c7XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIG9rYXlGcm1EaWFsb2dfQ2xpY2tlZChNb25vSW50ZXJmYWNlLkJ1dHRvbiBidG4sIGJvb2wgaXNUb3VjaCkge1xyXG4gICAgICAgICAgICBDbGVhclZhcnNBbmRDYWxjRWFybmVkKCk7XHJcbiAgICAgICAgICAgIEhpZGVTb21lQ2hpbGRyZW4oZnJtUmVzb3VyY2VzLCBmcm1Vbml0cywgZnJtUHJvZHVjdGlvbik7XHJcbiAgICAgICAgICAgIFNob3dTb21lQ2hpbGRyZW4oZnJtTWFpbk1lbnUsIGZybVJpZ2h0TWVudSk7XHJcbiAgICAgICAgICAgIGZybURpYWxvZy5IaWRlKG1haW5BbmltYXRvcik7XHJcbiAgICAgICAgICAgIFN0YXJ0QmF0dGxlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuTGFiZWwgbGJsVGl0bGVmcm1EaWFsb2c7XHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkxhYmVsIGxibExpbmUxRnJtRGlhbG9nO1xyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5MYWJlbCBsYmxMaW5lMkZybURpYWxvZztcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkZyYW1lIGZybVJlc291cmNlcztcclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgcGF1c2VGcm1SZXNvdXJjZXNfQ2xpY2tlZChNb25vSW50ZXJmYWNlLkJ1dHRvbiBidG4sIGJvb2wgaXNUb3VjaCkge1xyXG4gICAgICAgICAgICBpZiAoZ1N0YXRlID09IEdhbWVTdGF0ZS5JbkdhbWUpXHJcbiAgICAgICAgICAgICAgICBQYXVzZSA9ICFQYXVzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIHRpZXJVcEZybVJlc291cmNlc19DbGlja2VkKE1vbm9JbnRlcmZhY2UuQnV0dG9uIGJ0biwgYm9vbCBpc1RvdWNoKSB7XHJcbiAgICAgICAgICAgIHN0cmluZyB0aWVyO1xyXG4gICAgICAgICAgICBpZiAoKHBscnNbMF0ucmVzLlRpZXIgPT0gMSkpXHJcbiAgICAgICAgICAgICAgICB0aWVyID0gXCJUaWVyXzJcIjtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgdGllciA9IFwiVGllcl8zXCI7XHJcbiAgICAgICAgICAgIFRyeUFkZFRvUXVldWVVbml0KHBscnNbMF0sIHRpZXIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgdGllclVwRnJtUmVzb3VyY2VzX0ZvY3VzZWQoTW9ub0ludGVyZmFjZS5CdXR0b24gYnRuLCBib29sIGlzVG91Y2gpIHtcclxuICAgICAgICAgICAgc3RyaW5nIHRpZXI7XHJcbiAgICAgICAgICAgIGlmICgocGxyc1swXS5yZXMuVGllciA9PSAxKSlcclxuICAgICAgICAgICAgICAgIHRpZXIgPSBcIlRpZXJfMlwiO1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB0aWVyID0gXCJUaWVyXzNcIjtcclxuICAgICAgICAgICAgU2hvd01vcmVJbmZvKHVuaXRQcm1zW3RpZXJdLkNvc3QsIHRydWUsIGRlZmF1bHQoUG9pbnQpLCBsb2NhbGl6ZS5HZXRTdHJpbmcodW5pdFBybXNbdGllcl0uTmFtZSksIFwiXCIsIHVuaXRQcm1zW3RpZXJdLkRlc2NyaXB0aW9uKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5QaWN0dXJlIHBjdFRpZXJGcm1SZXNvdXJjZXM7XHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLlBpY3R1cmUgcGN0UGF1c2VGcm1SZXNvdXJjZXM7XHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkxhYmVsIGxibEdvbGRGcm1SZXNvdXJjZXM7XHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkxhYmVsIGxibERlYXRoRnJtUmVzb3VyY2VzO1xyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5CdXR0b24gYnRuVGllclVwRnJtUmVzb3VyY2VzO1xyXG5cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBMaXN0PE1vbm9JbnRlcmZhY2UuTGFiZWw+IGxibHNGcm1DdXN0b21SYWNlc0xpc3Q7XHJcbiAgICAgICAgcHJpdmF0ZSBMaXN0PE1vbm9JbnRlcmZhY2UuQnV0dG9uPiBidG5zRnJtQ3VzdG9tUmFjZXNMaXN0O1xyXG5cclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuRnJhbWUgZnJtUHJvZmlsZTtcclxuXHJcblxyXG4gICAgICAgIHByaXZhdGUgTGlzdDxNb25vSW50ZXJmYWNlLkxhYmVsPiBsYmxzZnJtUHJvZmlsZTtcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkZyYW1lIGZybUJhY2s7XHJcblxyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5GcmFtZSBmcm1CYXR0bGU7XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIGJ0blN0YXJ0QmF0dGxlKE1vbm9JbnRlcmZhY2UuQnV0dG9uIGJ0biwgYm9vbCBpc1RvdWNoKSB7XHJcbiAgICAgICAgICAgIFN0YXJ0UHJlR2FtZSgpO1xyXG4gICAgICAgICAgICBmcm1CYXR0bGUuSGlkZShtYWluQW5pbWF0b3IpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLlN3aXRjaGVyIHJhY2VzMVN3aXRjaGVyRnJtQmF0dGxlO1xyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5Td2l0Y2hlciByYWNlczJTd2l0Y2hlckZybUJhdHRsZTtcclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuU3dpdGNoZXIgbW9kZVN3aXRjaGVyRnJtQmF0dGxlO1xyXG5cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkZyYW1lIGZybVVuaXRzO1xyXG5cclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuRnJhbWUgZnJtUHJvZHVjdGlvbjtcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLlByb2dyZXNzW10gcHJnc1Byb2R1Y3Rpb24gPSBuZXcgTW9ub0ludGVyZmFjZS5Qcm9ncmVzc1s3XTtcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkZyYW1lIGZybVByZUdhbWU7XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBidG5Qcm9kdWN0aW9uX0NsaWNrZWQoTW9ub0ludGVyZmFjZS5CdXR0b24gYnRuLCBib29sIGlzVG91Y2gpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBidG5zUHJvZHVjdGlvbi5MZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGJ0biA9PSBidG5zUHJvZHVjdGlvbltpXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpIDwgcGxyc1swXS5yZWFkeVVuaXRzLkNvdW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFByb2R1Y2VVbml0KDAsIHBscnNbMF0ucmVhZHlVbml0c1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBscnNbMF0ucmVhZHlVbml0cy5SZW1vdmVBdChpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVXBkYXRlUXVldWUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpIC0gcGxyc1swXS5yZWFkeVVuaXRzLkNvdW50IDwgcGxyc1swXS5wcmRRLkNvdW50ICYmIGlzVG91Y2gpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGxyc1swXS5SZXNvdXJjZXMgKz0gdW5pdFBybXNbcGxyc1swXS5wcmRRW2kgLSBwbHJzWzBdLnJlYWR5VW5pdHMuQ291bnRdXS5Db3N0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBSZW1vdmVGcm9tUXVldWUoMCwgaSAtIHBscnNbMF0ucmVhZHlVbml0cy5Db3VudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgYnRuUHJvZHVjdGlvblJlbW92ZV9DbGlja2VkKE1vbm9JbnRlcmZhY2UuQnV0dG9uIGJ0biwgYm9vbCBpc1RvdWNoKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYnRuc1Byb2R1Y3Rpb24uTGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmIChidG4uUGFyZW50ID09IGJ0bnNQcm9kdWN0aW9uW2ldKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGkgLSBwbHJzWzBdLnJlYWR5VW5pdHMuQ291bnQgPCBwbHJzWzBdLnByZFEuQ291bnQgJiYgIWlzVG91Y2gpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGxyc1swXS5SZXNvdXJjZXMgKz0gdW5pdFBybXNbcGxyc1swXS5wcmRRW2kgLSBwbHJzWzBdLnJlYWR5VW5pdHMuQ291bnRdXS5Db3N0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBSZW1vdmVGcm9tUXVldWUoMCwgaSAtIHBscnNbMF0ucmVhZHlVbml0cy5Db3VudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgYnRuUHJvZHVjdGlvbl9Gb2N1c2VkKE1vbm9JbnRlcmZhY2UuQnV0dG9uIGJ0biwgYm9vbCBpc1RvdWNoKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYnRuc1Byb2R1Y3Rpb24uTGVuZ3RoOyBpKyspIHtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoYnRuID09IGJ0bnNQcm9kdWN0aW9uW2ldKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGkgPCBwbHJzWzBdLnJlYWR5VW5pdHMuQ291bnQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFNob3dVbml0SW5mbyh1bml0UHJtc1twbHJzWzBdLnJlYWR5VW5pdHNbaV1dLCAwLCBmYWxzZSwgbmV3IFBvaW50KGJ0bi5GaW5hbFJpZ2h0LCBidG4uRmluYWxCb3R0b20pKTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChpIC0gcGxyc1swXS5yZWFkeVVuaXRzLkNvdW50IDwgcGxyc1swXS5wcmRRLkNvdW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ0bi5DaGlsZHJlblsyXS5WaXNpYmxlID0gIWlzVG91Y2g7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFNob3dVbml0SW5mbyh1bml0UHJtc1twbHJzWzBdLnByZFFbaSAtIHBscnNbMF0ucmVhZHlVbml0cy5Db3VudF1dLCAwLCBmYWxzZSwgbmV3IFBvaW50KGJ0bi5GaW5hbFJpZ2h0LCBidG4uRmluYWxCb3R0b20pKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5CdXR0b25bXSBidG5zUHJvZHVjdGlvbiA9IG5ldyBNb25vSW50ZXJmYWNlLkJ1dHRvbls3XTtcclxuXHJcbiAgICAgICAgcHVibGljIE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZSBUZXh0dXJlVG9BcHAoVGV4dHVyZTJEIHRleClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBjb2xvcnMgPSBuZXcgQ29sb3JbMV07XHJcbiAgICAgICAgICAgIHRleC5HZXREYXRhPENvbG9yPihjb2xvcnMpO1xyXG4gICAgICAgICAgICBDb25zb2xlLldyaXRlTGluZShjb2xvcnNbMF0pO1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShuZXcgTW9ub0ludGVyZmFjZS5TcHJpdGUoKSB7IFRleHR1cmUgPSB0ZXgsIFcgPSAxLCBIID0gMSB9LCAwKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIENyZWF0ZUludGVyZmFjZVRleHVyZXMoKSB7XHJcbiAgICAgICAgICAgIGRlZmF1bHRUaGVtZS5FbXB0eVRleHR1cmUgPSBNb25vSW50ZXJmYWNlLlRoZW1lLkdldEVtcHR5QXBwKGdyYXBoaWNzLkdyYXBoaWNzRGV2aWNlKTtcclxuXHJcbiAgICAgICAgICAgIC8vZGVmYXVsdFRoZW1lLkZyYW1lQmFja1RleHR1cmUgPSBUZXh0dXJlVG9BcHAoTW9ub0ludGVyZmFjZS5UaGVtZS5Tb2xpZENvbG9yVGV4dHVyZShncmFwaGljcy5HcmFwaGljc0RldmljZSwgMTczLCAxMjIsIDcxLCAyMjApKTtcclxuICAgICAgICAgICAgZGVmYXVsdFRoZW1lLkZyYW1lQmFja1RleHR1cmUgPSBuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJlbXB0eVwiXSwgMCk7XHJcblxyXG4gICAgICAgICAgICAvL2RlZmF1bHRUaGVtZS5CdXR0b25CYWNrVGV4dHVyZSA9IFRleHR1cmVUb0FwcChNb25vSW50ZXJmYWNlLlRoZW1lLlNvbGlkQ29sb3JUZXh0dXJlKGdyYXBoaWNzLkdyYXBoaWNzRGV2aWNlLCAxMjMsIDcyLCAyMSkpO1xyXG4gICAgICAgICAgICBkZWZhdWx0VGhlbWUuQnV0dG9uQmFja1RleHR1cmUgPSBuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJlbXB0eVwiXSwgMSk7XHJcbiAgICAgICAgICAgIC8vZGVmYXVsdFRoZW1lLkJ1dHRvblNlbGVjdGVkVGV4dHVyZSA9IFRleHR1cmVUb0FwcChNb25vSW50ZXJmYWNlLlRoZW1lLlNvbGlkQ29sb3JUZXh0dXJlKGdyYXBoaWNzLkdyYXBoaWNzRGV2aWNlLCAyMDAsIDIwMCwgMjAwKSk7XHJcbiAgICAgICAgICAgIGRlZmF1bHRUaGVtZS5CdXR0b25TZWxlY3RlZFRleHR1cmUgPSBuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJlbXB0eVwiXSwgMik7XHJcbiAgICAgICAgICAgIC8vZGVmYXVsdFRoZW1lLkJ1dHRvbkZyb250VGV4dHVyZSA9IFRleHR1cmVUb0FwcChNb25vSW50ZXJmYWNlLlRoZW1lLlNvbGlkQ29sb3JUZXh0dXJlKGdyYXBoaWNzLkdyYXBoaWNzRGV2aWNlLCAyNTUsIDI1NSwgNTEsIDEyMCkpO1xyXG4gICAgICAgICAgICBkZWZhdWx0VGhlbWUuQnV0dG9uRnJvbnRUZXh0dXJlID0gbmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW1wiZW1wdHlcIl0sIDMpO1xyXG4gICAgICAgICAgICAvL2RlZmF1bHRUaGVtZS5CdXR0b25QcmVzc2VkVGV4dHVyZSA9IFRleHR1cmVUb0FwcChNb25vSW50ZXJmYWNlLlRoZW1lLlNvbGlkQ29sb3JUZXh0dXJlKGdyYXBoaWNzLkdyYXBoaWNzRGV2aWNlLCAyMjAsIDIyMCwgMjIwLCAxODApKTtcclxuICAgICAgICAgICAgZGVmYXVsdFRoZW1lLkJ1dHRvblByZXNzZWRUZXh0dXJlID0gbmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW1wiZW1wdHlcIl0sIDQpO1xyXG4gICAgICAgICAgICAvL2RlZmF1bHRUaGVtZS5CdXR0b25EaXNhYmxlZFRleHR1cmUgPSBUZXh0dXJlVG9BcHAoTW9ub0ludGVyZmFjZS5UaGVtZS5Tb2xpZENvbG9yVGV4dHVyZShncmFwaGljcy5HcmFwaGljc0RldmljZSwgMTAwLCAxMDAsIDEwMCwgMjAwKSk7XHJcbiAgICAgICAgICAgIGRlZmF1bHRUaGVtZS5CdXR0b25EaXNhYmxlZFRleHR1cmUgPSBuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJlbXB0eVwiXSwgNSk7XHJcblxyXG4gICAgICAgICAgICBkZWZhdWx0VGhlbWUuUHJvZ3Jlc3NCYWNrVGV4dHVyZSA9IGRlZmF1bHRUaGVtZS5FbXB0eVRleHR1cmU7XHJcbiAgICAgICAgICAgIC8vZGVmYXVsdFRoZW1lLlByb2dyZXNzRnJvbnRUZXh0dXJlID0gVGV4dHVyZVRvQXBwKE1vbm9JbnRlcmZhY2UuVGhlbWUuU29saWRDb2xvclRleHR1cmUoZ3JhcGhpY3MuR3JhcGhpY3NEZXZpY2UsIDE0MCwgMTQwLCAxNDAsIDIwMCkpO1xyXG4gICAgICAgICAgICBkZWZhdWx0VGhlbWUuUHJvZ3Jlc3NGcm9udFRleHR1cmUgPSBuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJlbXB0eVwiXSwgNik7XHJcblxyXG4gICAgICAgICAgICBkZWZhdWx0VGhlbWUuU3dpdGNoZXJCdXR0b25MZWZ0VGV4dHVyZSA9IG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcIm1lZGl1bV9pY29uc1wiXSwgMik7XHJcbiAgICAgICAgICAgIGRlZmF1bHRUaGVtZS5Td2l0Y2hlckJ1dHRvblJpZ2h0VGV4dHVyZSA9IG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcIm1lZGl1bV9pY29uc1wiXSwgMyk7XHJcbiAgICAgICAgICAgIGRlZmF1bHRUaGVtZS5Td2l0Y2hlckRlc2NyaXB0aW9uRm9udFNpemUgPSAxNDtcclxuICAgICAgICAgICAgZGVmYXVsdFRoZW1lLlN3aXRjaGVyRGVzY3JpcHRpb25Db2xvciA9IENvbG9yLkJsYWNrO1xyXG4gICAgICAgICAgICBkZWZhdWx0VGhlbWUuU3dpdGNoZXJNYWluRm9udFNpemUgPSAyMDtcclxuICAgICAgICAgICAgZGVmYXVsdFRoZW1lLlN3aXRjaGVyTWFpbkNvbG9yID0gQ29sb3IuQmxhY2s7XHJcblxyXG4gICAgICAgICAgICBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2VbXSBuZnRzID0gbmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZVsxMF07XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDw9IDg7IGkrKylcclxuICAgICAgICAgICAgICAgIG5mdHNbaV0gPSBuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJuaW5lZnJhbWVcIl0sIGkpO1xyXG5cclxuICAgICAgICAgICAgZGVmYXVsdFRoZW1lLk5pbmVGcmFtZUJvZGVyVGV4dHVyZSA9IG5mdHM7XHJcblxyXG4gICAgICAgICAgICBkZWZhdWx0VGhlbWUuRm9udHMgPSBGb250cztcclxuXHJcbiAgICAgICAgICAgIC8vYmFja1RoZW1lLkZyYW1lQmFja1RleHR1cmUgPSBUZXh0dXJlVG9BcHAoTW9ub0ludGVyZmFjZS5UaGVtZS5Tb2xpZENvbG9yVGV4dHVyZShncmFwaGljcy5HcmFwaGljc0RldmljZSwgMCwgMCwgMCwgMTUwKSk7XHJcbiAgICAgICAgICAgIGJhY2tUaGVtZS5GcmFtZUJhY2tUZXh0dXJlID0gbmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW1wiZW1wdHlcIl0sIDcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkNvbnRhaW5lciBjVW5pdHM7XHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkNvbnRhaW5lciBjU3BlbGxzO1xyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5Db250YWluZXIgY0J1aWxkaW5ncztcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkJ1dHRvbiBidG5TZWxlY3RVbml0cztcclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuQnV0dG9uIGJ0blNlbGVjdFNwZWxscztcclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuQnV0dG9uIGJ0blNlbGVjdEJ1aWxkaW5ncztcclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIENyZWF0ZUludGVyZmFjZSgpIHtcclxuICAgICAgICAgICAgZGVmYXVsdFRoZW1lID0gbmV3IE1vbm9JbnRlcmZhY2UuVGhlbWUoKTtcclxuICAgICAgICAgICAgYmFja1RoZW1lID0gbmV3IE1vbm9JbnRlcmZhY2UuVGhlbWUoKTtcclxuXHJcbiAgICAgICAgICAgIENyZWF0ZUludGVyZmFjZVRleHVyZXMoKTtcclxuXHJcbiAgICAgICAgICAgIE1haW5Db250YWluZXIgPSBuZXcgTW9ub0ludGVyZmFjZS5XaW5kb3coMCwgMCwgZ2FtZVdpZHRoLCBnYW1lSGVpZ2h0KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBDdXJyZW50VGhlbWUgPSBkZWZhdWx0VGhlbWVcclxuICAgICAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgICAgICBtYWluQW5pbWF0b3IgPSBuZXcgTW9ub0ludGVyZmFjZS5BbmltYXRvcigpO1xyXG5cclxuICAgICAgICAgICAgZnJtVW5pdHMgPSBNYWluQ29udGFpbmVyLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuRnJhbWU+KG5ldyBNb25vSW50ZXJmYWNlLkZyYW1lKDAsIDAsIDMwMCwgMTEwLCBob3JBbGlnbjogMC4wZiwgdmVyQWxpZ246IDAuMGYsIHZpc2libGU6IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICBMZWZ0Qm9yZGVyID0gZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBUb3BCb3JkZXIgPSBmYWxzZSxcclxuICAgICAgICAgICAgICAgIFNob3dBbmltYXRpb24gPSBuZXcgTW9ub0ludGVyZmFjZS5OdW1iZXJBbmltYXRpb24oXCJZXCIsIC04MiwgMCwgMjApXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgY1VuaXRzID0gZnJtVW5pdHMuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5Db250YWluZXI+KG5ldyBNb25vSW50ZXJmYWNlLkNvbnRhaW5lcig1LCA1LCAyOTAsIDYwLCB2ZXJBbGlnbjogMC4wZiwgaG9yQWxpZ246IDAuMGYpKTtcclxuICAgICAgICAgICAgY1NwZWxscyA9IGZybVVuaXRzLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuQ29udGFpbmVyPihuZXcgTW9ub0ludGVyZmFjZS5Db250YWluZXIoNSwgNSwgMjkwLCA2MCwgdmVyQWxpZ246IDAuMGYsIGhvckFsaWduOiAwLjBmKSk7XHJcbiAgICAgICAgICAgIGNCdWlsZGluZ3MgPSBmcm1Vbml0cy5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkNvbnRhaW5lcj4obmV3IE1vbm9JbnRlcmZhY2UuQ29udGFpbmVyKDUsIDUsIDI5MCwgNjAsIHZlckFsaWduOiAwLjBmLCBob3JBbGlnbjogMC4wZikpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIGJ0blNlbGVjdFVuaXRzID0gZnJtVW5pdHMuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5CdXR0b24+KG5ldyBNb25vSW50ZXJmYWNlLkJ1dHRvbigoYnRuLCBpc190b3VjaCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY1VuaXRzLlZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgY1NwZWxscy5WaXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBjQnVpbGRpbmdzLlZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGJ0blNlbGVjdFVuaXRzLklzU2VsZWN0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgYnRuU2VsZWN0U3BlbGxzLklzU2VsZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGJ0blNlbGVjdEJ1aWxkaW5ncy5Jc1NlbGVjdGVkID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgZnJtVW5pdHMuVyA9IE1hdGguTWF4KFN5c3RlbS5MaW5xLkVudW1lcmFibGUuTGFzdDxNb25vSW50ZXJmYWNlLkJsb2NrPihjVW5pdHMuQ2hpbGRyZW4pLlJpZ2h0LCBidG5TZWxlY3RCdWlsZGluZ3MuUmlnaHQpICsgNTtcclxuICAgICAgICAgICAgfSwgNSwgLTUsIDEwMCwgMzAsIGhvckFsaWduOiAwLjBmLCB2ZXJBbGlnbjogMS4wZikpO1xyXG4gICAgICAgICAgICBidG5TZWxlY3RVbml0cy5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkxhYmVsPihuZXcgTW9ub0ludGVyZmFjZS5MYWJlbChcItCh0YPRidC10YHRgtCy0LBcIiwgMTYsIENvbG9yLkJsYWNrKSk7XHJcblxyXG4gICAgICAgICAgICBidG5TZWxlY3RTcGVsbHMgPSBmcm1Vbml0cy5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkJ1dHRvbj4obmV3IE1vbm9JbnRlcmZhY2UuQnV0dG9uKChidG4sIGlzX3RvdWNoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjVW5pdHMuVmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgY1NwZWxscy5WaXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGNCdWlsZGluZ3MuVmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgYnRuU2VsZWN0VW5pdHMuSXNTZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgYnRuU2VsZWN0U3BlbGxzLklzU2VsZWN0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgYnRuU2VsZWN0QnVpbGRpbmdzLklzU2VsZWN0ZWQgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICBmcm1Vbml0cy5XID0gTWF0aC5NYXgoU3lzdGVtLkxpbnEuRW51bWVyYWJsZS5MYXN0PE1vbm9JbnRlcmZhY2UuQmxvY2s+KGNTcGVsbHMuQ2hpbGRyZW4pLlJpZ2h0LCBidG5TZWxlY3RCdWlsZGluZ3MuUmlnaHQpICsgNTtcclxuICAgICAgICAgICAgfSwgMTEwLCAtNSwgMTAwLCAzMCwgaG9yQWxpZ246IDAuMGYsIHZlckFsaWduOiAxLjBmKSk7XHJcblxyXG4gICAgICAgICAgICBidG5TZWxlY3RTcGVsbHMuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5MYWJlbD4obmV3IE1vbm9JbnRlcmZhY2UuTGFiZWwoXCLQl9Cw0LrQu9C40L3QsNC90LjRj1wiLCAxNiwgQ29sb3IuQmxhY2spKTtcclxuXHJcbiAgICAgICAgICAgIGJ0blNlbGVjdEJ1aWxkaW5ncyA9IGZybVVuaXRzLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuQnV0dG9uPihuZXcgTW9ub0ludGVyZmFjZS5CdXR0b24oKGJ0biwgaXNfdG91Y2gpID0+IHtcclxuICAgICAgICAgICAgICAgIGNVbml0cy5WaXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBjU3BlbGxzLlZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGNCdWlsZGluZ3MuVmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBidG5TZWxlY3RVbml0cy5Jc1NlbGVjdGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBidG5TZWxlY3RTcGVsbHMuSXNTZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgYnRuU2VsZWN0QnVpbGRpbmdzLklzU2VsZWN0ZWQgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgIGZybVVuaXRzLlcgPSBNYXRoLk1heChTeXN0ZW0uTGlucS5FbnVtZXJhYmxlLkxhc3Q8TW9ub0ludGVyZmFjZS5CbG9jaz4oY0J1aWxkaW5ncy5DaGlsZHJlbikuUmlnaHQsIGJ0blNlbGVjdEJ1aWxkaW5ncy5SaWdodCkgKyA1O1xyXG4gICAgICAgICAgICB9LCAyMTUsIC01LCAxMDAsIDMwLCBob3JBbGlnbjogMC4wZiwgdmVyQWxpZ246IDEuMGYpKTtcclxuICAgICAgICAgICAgYnRuU2VsZWN0QnVpbGRpbmdzLklzRGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBidG5TZWxlY3RCdWlsZGluZ3MuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5MYWJlbD4obmV3IE1vbm9JbnRlcmZhY2UuTGFiZWwoXCLQn9C+0YHRgtGA0L7QudC60LhcIiwgMTYsIENvbG9yLkJsYWNrKSk7XHJcblxyXG4gICAgICAgICAgICAvLyBmcm1Vbml0cy5IaWRlQW5pbWF0aW9uID0gTmV3IE1vbm9JbnRlcmZhY2UuTnVtYmVyQW5pbWF0aW9uKGZybVVuaXRzLCBcIllcIiwgMCwgLTgyLCA1MCwgTm90aGluZywgTm90aGluZylcclxuXHJcblxyXG4gICAgICAgICAgICBmcm1Qcm9kdWN0aW9uID0gTWFpbkNvbnRhaW5lci5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkZyYW1lPihuZXcgTW9ub0ludGVyZmFjZS5GcmFtZSgwLCAxMzAsIDM1NSwgNTUsIGhvckFsaWduOiAwLjBmLCB2ZXJBbGlnbjogMC4wZiwgdmlzaWJsZTogZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgIExlZnRCb3JkZXIgPSBmYWxzZSxcclxuICAgICAgICAgICAgICAgIFNob3dBbmltYXRpb24gPSBuZXcgTW9ub0ludGVyZmFjZS5OdW1iZXJBbmltYXRpb24oXCJYXCIsIC0zNTUsIDAsIDUwKSxcclxuICAgICAgICAgICAgICAgIEhpZGVBbmltYXRpb24gPSBuZXcgTW9ub0ludGVyZmFjZS5OdW1iZXJBbmltYXRpb24oXCJYXCIsIDAsIC0zNTUsIC01MClcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8PSA2OyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGJ0bnNQcm9kdWN0aW9uW2ldID0gZnJtUHJvZHVjdGlvbi5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkJ1dHRvbj4obmV3IE1vbm9JbnRlcmZhY2UuQnV0dG9uKGJ0blByb2R1Y3Rpb25fQ2xpY2tlZCwgYnRuUHJvZHVjdGlvbl9Gb2N1c2VkLCA1ICsgaSAqIDUwLCA1LCA0NSwgNDUsIGhvckFsaWduOiAwLjBmLCB2ZXJBbGlnbjogMC4wZikpO1xyXG4gICAgICAgICAgICAgICAgYnRuc1Byb2R1Y3Rpb25baV0uQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5QaWN0dXJlPihuZXcgTW9ub0ludGVyZmFjZS5QaWN0dXJlKGRlZmF1bHRUaGVtZS5FbXB0eVRleHR1cmUsIHc6IDQ1LCBoOiA0NSkpO1xyXG4gICAgICAgICAgICAgICAgYnRuc1Byb2R1Y3Rpb25baV0uQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5QaWN0dXJlPihuZXcgTW9ub0ludGVyZmFjZS5QaWN0dXJlKG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcInNtYWxsX2ljb25zXCJdLCAxOSksIHc6IDIwLCBoOiAxNiwgdmVyQWxpZ246IDEuMGYsIGhvckFsaWduOiAxLjBmKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgYnRuc1Byb2R1Y3Rpb25baV1cclxuICAgICAgICAgICAgICAgICAgICAuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5CdXR0b24+KG5ldyBNb25vSW50ZXJmYWNlLkJ1dHRvbihidG5Qcm9kdWN0aW9uUmVtb3ZlX0NsaWNrZWQsIDAsIDAsIHc6IDE2LCBoOiAxNiwgdmVyQWxpZ246IDAuMGYsIGhvckFsaWduOiAxLjBmKSlcclxuICAgICAgICAgICAgICAgICAgICAuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5QaWN0dXJlPihuZXcgTW9ub0ludGVyZmFjZS5QaWN0dXJlKG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcInNtYWxsX2ljb25zXCJdLCAyMCksIHc6IDIwLCBoOiAxNiwgdmVyQWxpZ246IDAuMGYsIGhvckFsaWduOiAxLjBmKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcHJnc1Byb2R1Y3Rpb25baV0gPSBidG5zUHJvZHVjdGlvbltpXS5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLlByb2dyZXNzPihuZXcgTW9ub0ludGVyZmFjZS5Qcm9ncmVzcygwLCAwLCAwLCAwLCA0NSwgNDUsIDApKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyAnINCk0YDQtdC50Lwg0LPQu9Cw0LLQvdC+0LPQviDQvNC10L3RjlxyXG5cclxuICAgICAgICAgICAgZnJtTWFpbk1lbnUgPSBNYWluQ29udGFpbmVyLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuRnJhbWU+KG5ldyBNb25vSW50ZXJmYWNlLkZyYW1lKDAsIDAsIDc0LCA3NCwgaG9yQWxpZ246IDAuMEYsIHZlckFsaWduOiAwLjBGLCB2aXNpYmxlOiBmYWxzZSkge1xyXG4gICAgICAgICAgICAgIExlZnRCb3JkZXIgPSBmYWxzZSxcclxuICAgICAgICAgICAgICBUb3BCb3JkZXIgPSBmYWxzZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgZnJtTWFpbk1lbnVcclxuICAgICAgICAgICAgICAgIC5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkJ1dHRvbj4obmV3IE1vbm9JbnRlcmZhY2UuQnV0dG9uKGJhdHRsZUZybU1haW5NZW51LCA1LCAwLCA2NCwgNjQsIGhvckFsaWduOiAwLjBGKSlcclxuICAgICAgICAgICAgICAgIC5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLlBpY3R1cmU+KG5ldyBNb25vSW50ZXJmYWNlLlBpY3R1cmUobmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW1wiYmlnX2ljb25zXCJdLCAxKSkpO1xyXG5cclxuICAgICAgICAgICAgLy8gJyDQpNGA0LXQudC8INGA0LXRgdGD0YDRgdC+0LIgXHJcbiAgICAgICAgICAgIGZybVJlc291cmNlcyA9IE1haW5Db250YWluZXIuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5GcmFtZT4obmV3IE1vbm9JbnRlcmZhY2UuRnJhbWUoMCwgMCwgMjUwLCA3MCwgaG9yQWxpZ246IDEuMGYsIHZlckFsaWduOiAwLjBmLCB2aXNpYmxlOiBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgUmlnaHRCb3JkZXIgPSBmYWxzZSxcclxuICAgICAgICAgICAgICAgIFRvcEJvcmRlciA9IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgU2hvd0FuaW1hdGlvbiA9IG5ldyBNb25vSW50ZXJmYWNlLk51bWJlckFuaW1hdGlvbihcIllcIiwgLTgyLCAwLCAyMClcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGJ0blRpZXJVcEZybVJlc291cmNlcyA9IGZybVJlc291cmNlcy5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkJ1dHRvbj4obmV3IE1vbm9JbnRlcmZhY2UuQnV0dG9uKHRpZXJVcEZybVJlc291cmNlc19DbGlja2VkLCB0aWVyVXBGcm1SZXNvdXJjZXNfRm9jdXNlZCwgS2V5cy5FbnRlciwgNSwgMCwgNjAsIDYwLCBob3JBbGlnbjogMC4wZikpO1xyXG4gICAgICAgICAgICBwY3RUaWVyRnJtUmVzb3VyY2VzID0gYnRuVGllclVwRnJtUmVzb3VyY2VzLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuUGljdHVyZT4obmV3IE1vbm9JbnRlcmZhY2UuUGljdHVyZSh1bml0UHJtc1tcIlRpZXJfMlwiXS5pY29uQXBwLCB3OiA2MCwgaDogNjApKTtcclxuXHJcbiAgICAgICAgICAgIGZybVJlc291cmNlcy5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLlBpY3R1cmU+KG5ldyBNb25vSW50ZXJmYWNlLlBpY3R1cmUobmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW1wic21hbGxfaWNvbnNcIl0sIDEyKSwgLTcyLCAtMTcsIDQwLCAzMiwgaG9yQWxpZ246IDEuMGYpKTtcclxuICAgICAgICAgICAgZnJtUmVzb3VyY2VzLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuUGljdHVyZT4obmV3IE1vbm9JbnRlcmZhY2UuUGljdHVyZShuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJzbWFsbF9pY29uc1wiXSwgMTMpLCAtNzIsIDE1LCA0MCwgMzIsIGhvckFsaWduOiAxLjBmKSk7XHJcblxyXG4gICAgICAgICAgICBsYmxHb2xkRnJtUmVzb3VyY2VzID0gZnJtUmVzb3VyY2VzLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTGFiZWw+KG5ldyBNb25vSW50ZXJmYWNlLkxhYmVsKFwiXCIsIDIwLCBtb25leUNsciwgLTExNSwgLTEwLCBob3JBbGlnbjogMS4wZikpO1xyXG4gICAgICAgICAgICBsYmxEZWF0aEZybVJlc291cmNlcyA9IGZybVJlc291cmNlcy5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkxhYmVsPihuZXcgTW9ub0ludGVyZmFjZS5MYWJlbChcIlwiLCAyMCwgZGVhdGhDbHIsIC0xMTUsIDIwLCBob3JBbGlnbjogMS4wZikpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIHBjdFBhdXNlRnJtUmVzb3VyY2VzID0gZnJtUmVzb3VyY2VzXHJcbiAgICAgICAgICAgICAgICAuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5CdXR0b24+KG5ldyBNb25vSW50ZXJmYWNlLkJ1dHRvbihwYXVzZUZybVJlc291cmNlc19DbGlja2VkLCBLZXlzLkVzY2FwZSwgLTUsIDAsIDYwLCA2MCwgaG9yQWxpZ246IDEuMGYpKVxyXG4gICAgICAgICAgICAgICAgLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuUGljdHVyZT4obmV3IE1vbm9JbnRlcmZhY2UuUGljdHVyZShuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJtZWRpdW1faWNvbnNcIl0sIDEpLCB3OiA2MCwgaDogNjApKTtcclxuXHJcblxyXG4gICAgICAgICAgICBmcm1SaWdodE1lbnUgPSBNYWluQ29udGFpbmVyLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuRnJhbWU+KG5ldyBNb25vSW50ZXJmYWNlLkZyYW1lKDAsIDAsIDc0LCA3NCwgMS4wZiwgMC4wZiwgdmlzaWJsZTogZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgIFJpZ2h0Qm9yZGVyID0gZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBUb3BCb3JkZXIgPSBmYWxzZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgZnJtUmlnaHRNZW51XHJcbiAgICAgICAgICAgICAgICAuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5CdXR0b24+KG5ldyBNb25vSW50ZXJmYWNlLkJ1dHRvbihleGl0RnJtTWVudUV4aXRfQ2xpY2tlZCwgS2V5cy5Fc2NhcGUsIDUsIDAsIDY0LCA2NCwgaG9yQWxpZ246IDAuMGYpKVxyXG4gICAgICAgICAgICAgICAgLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuUGljdHVyZT4obmV3IE1vbm9JbnRlcmZhY2UuUGljdHVyZShuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJtZWRpdW1faWNvbnNcIl0sIDApLCB3OiA2NCwgaDogNjQpKTtcclxuXHJcbiAgICAgICAgICAgIC8vICcg0KTRgNC10LnQvCDRgdGC0LDRgNGC0LAg0LHQuNGC0LLRi1xyXG4gICAgICAgICAgICBmcm1CYXR0bGUgPSBNYWluQ29udGFpbmVyLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuRnJhbWU+KG5ldyBNb25vSW50ZXJmYWNlLkZyYW1lKDAsIDAsIDQ1MCwgMzMwLCB2aXNpYmxlOiBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgU2hvd0FuaW1hdGlvbiA9IG5ldyBNb25vSW50ZXJmYWNlLk51bWJlckFuaW1hdGlvbihcIllcIiwgLTMwMCwgMCwgNTApLFxyXG4gICAgICAgICAgICAgICAgSGlkZUFuaW1hdGlvbiA9IG5ldyBNb25vSW50ZXJmYWNlLk51bWJlckFuaW1hdGlvbihcIllcIiwgMCwgMzAwLCA1MClcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGZybUJhdHRsZS5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkxhYmVsPihuZXcgTW9ub0ludGVyZmFjZS5MYWJlbChcItCR0LjRgtCy0LBcIiwgMzAsIENvbG9yLkJsYWNrLCB5OiA3LCB2ZXJBbGlnbjogMC4wRikpO1xyXG4gICAgICAgICAgICBmcm1CYXR0bGUuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5MYWJlbD4obmV3IE1vbm9JbnRlcmZhY2UuTGFiZWwoXCJWU1wiLCAyMCwgQ29sb3IuQmxhY2ssIHk6IDU1LCB2ZXJBbGlnbjogMC4wRikpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZVtdIHBzMSA9IG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2VbcmFjZXMxLkNvdW50IC0gMSArIDFdO1xyXG4gICAgICAgICAgICBzdHJpbmdbXSB0czEgPSBuZXcgc3RyaW5nW3JhY2VzMS5Db3VudCAtIDEgKyAxXTtcclxuICAgICAgICAgICAgc3RyaW5nW10gZHMxID0gbmV3IHN0cmluZ1tyYWNlczEuQ291bnQgLSAxICsgMV07XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmFjZXMxLkNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHBzMVtpXSA9IG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcInJhY2VfaWNvbnNcIl0sIFJhY2VNYW5hZ2VyLkluc3RhbmNlLkFsbFtyYWNlczFbaV1dLnN5bWIpO1xyXG4gICAgICAgICAgICAgICAgdHMxW2ldID0gUmFjZU1hbmFnZXIuSW5zdGFuY2UuQWxsW3JhY2VzMVtpXV0ubmFtZTtcclxuICAgICAgICAgICAgICAgIGRzMVtpXSA9IFJhY2VNYW5hZ2VyLkluc3RhbmNlLkFsbFtyYWNlczFbaV1dLmRlc2M7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZVtdIHBzMiA9IG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2VbcmFjZXMyLkNvdW50IC0gMSArIDFdO1xyXG4gICAgICAgICAgICBzdHJpbmdbXSB0czIgPSBuZXcgc3RyaW5nW3JhY2VzMi5Db3VudCAtIDEgKyAxXTtcclxuICAgICAgICAgICAgc3RyaW5nW10gZHMyID0gbmV3IHN0cmluZ1tyYWNlczIuQ291bnQgLSAxICsgMV07XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJhY2VzMi5Db3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBwczJbaV0gPSBuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJyYWNlX2ljb25zXCJdLCBSYWNlTWFuYWdlci5JbnN0YW5jZS5BbGxbcmFjZXMyW2ldXS5zeW1iKTtcclxuICAgICAgICAgICAgICAgIHRzMltpXSA9IFJhY2VNYW5hZ2VyLkluc3RhbmNlLkFsbFtyYWNlczJbaV1dLm5hbWU7XHJcbiAgICAgICAgICAgICAgICBkczJbaV0gPSBSYWNlTWFuYWdlci5JbnN0YW5jZS5BbGxbcmFjZXMyW2ldXS5kZXNjO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByYWNlczFTd2l0Y2hlckZybUJhdHRsZSA9IGZybUJhdHRsZS5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLlN3aXRjaGVyPihuZXcgTW9ub0ludGVyZmFjZS5Td2l0Y2hlcihwczEsIHRzMSwgZHMxLCAwLCBtYWluQW5pbWF0b3IsIC0xMDAsIDYwLCAxNTAsIDEwMCwgdmVyQWxpZ246IDAuMEYpKTtcclxuICAgICAgICAgICAgcmFjZXMyU3dpdGNoZXJGcm1CYXR0bGUgPSBmcm1CYXR0bGUuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5Td2l0Y2hlcj4obmV3IE1vbm9JbnRlcmZhY2UuU3dpdGNoZXIocHMyLCB0czIsIGRzMiwgMCwgbWFpbkFuaW1hdG9yLCAxMDAsIDYwLCAxNTAsIDEwMCwgdmVyQWxpZ246IDAuMEYpKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBnYW1lVHlwZXMgPSBuZXcgc3RyaW5nW10geyBcIlJhbmRvbUdUXCIsIFwiU3RhbmRhcnRHVFwiLCBcIk9mZmVuY2VHVFwiLCBcIkRlZmVuY2VHVFwiLCBcIkZpcnN0SGVyb0dUXCIgfTtcclxuICAgICAgICAgICAgdmFyIGd0cyA9IG5ldyBzdHJpbmdbZ2FtZVR5cGVzLkxlbmd0aF07XHJcbiAgICAgICAgICAgIHZhciBnZHRzID0gbmV3IHN0cmluZ1tnYW1lVHlwZXMuTGVuZ3RoXTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBnYW1lVHlwZXMuTGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGd0c1tpXSA9IGdhbWVUeXBlc1tpXTtcclxuICAgICAgICAgICAgICAgIGdkdHNbaV0gPSBnYW1lVHlwZXNbaV0gKyBcIkRlc2NcIjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgbW9kZVN3aXRjaGVyRnJtQmF0dGxlID0gZnJtQmF0dGxlLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuU3dpdGNoZXI+KG5ldyBNb25vSW50ZXJmYWNlLlN3aXRjaGVyKG51bGwsIGd0cywgZ2R0cywgMCwgbWFpbkFuaW1hdG9yLCAwLCAxNzAsIDM1MCwgMTAwLCB2ZXJBbGlnbjogMC4wRikpO1xyXG4gICAgICAgICAgICBmcm1CYXR0bGVcclxuICAgICAgICAgICAgICAgIC5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkJ1dHRvbj4obmV3IE1vbm9JbnRlcmZhY2UuQnV0dG9uKGJ0blN0YXJ0QmF0dGxlLCBLZXlzLkVudGVyLCAwLCAtMTAsIDE1MCwgNDUsIHZlckFsaWduOiAxLjBGKSlcclxuICAgICAgICAgICAgICAgIC5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkxhYmVsPihuZXcgTW9ub0ludGVyZmFjZS5MYWJlbChcItCS0L/QtdGA0LXQtFwiLCAyMCwgQ29sb3IuQmxhY2spKTtcclxuXHJcblxyXG4gICAgICAgICAgICAvLyAn0KTRgNC10LnQvCDQt9Cw0YLQtdC80L3QtdC90LjRjyBcclxuICAgICAgICAgICAgZnJtQmFjayA9IE1haW5Db250YWluZXIuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5GcmFtZT4obmV3IE1vbm9JbnRlcmZhY2UuRnJhbWUoMCwgMCwgLTEsIC0xLCB2aXNpYmxlOiBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgU2hvd0FuaW1hdGlvbiA9IG5ldyBNb25vSW50ZXJmYWNlLk51bWJlckFuaW1hdGlvbihcIkFscGhhXCIsIDAsIDEsIDAuMDVmKSxcclxuICAgICAgICAgICAgICAgIEhpZGVBbmltYXRpb24gPSBuZXcgTW9ub0ludGVyZmFjZS5OdW1iZXJBbmltYXRpb24oXCJBbHBoYVwiLCAxLCAwLCAtMC4wNWYpXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgICAgIC8vICcg0KTRgNC10LnQvCDQvdCw0YHRgtGA0L7QtdC6XHJcbiAgICAgICAgICAgIGZybVNldHRpbmdzID0gTWFpbkNvbnRhaW5lci5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkZyYW1lPihuZXcgTW9ub0ludGVyZmFjZS5GcmFtZSgwLCAwLCAzNTAsIDIwMCwgdmlzaWJsZTogZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgIFNob3dBbmltYXRpb24gPSBuZXcgTW9ub0ludGVyZmFjZS5OdW1iZXJBbmltYXRpb24oXCJZXCIsIC0zMDAsIDAsIDUwLCAoKSA9PiBmcm1CYWNrLlNob3cobWFpbkFuaW1hdG9yKSksXHJcbiAgICAgICAgICAgICAgICBIaWRlQW5pbWF0aW9uID0gbmV3IE1vbm9JbnRlcmZhY2UuTnVtYmVyQW5pbWF0aW9uKFwiWVwiLCAwLCAzMDAsIDUwLCAoKSA9PiBmcm1CYWNrLkhpZGUobWFpbkFuaW1hdG9yKSlcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGZybVNldHRpbmdzLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTGFiZWw+KG5ldyBNb25vSW50ZXJmYWNlLkxhYmVsKFwi0J3QsNGB0YLRgNC+0LnQutC4XCIsIDMwLCBDb2xvci5CbGFjaywgeTogNywgdmVyQWxpZ246IDAuMEYpKTtcclxuXHJcblxyXG4gICAgICAgICAgICBDcmVhdGVTY3JlZW5Gb3JtYXRzKCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgc01vZGVzID0gbmV3IHN0cmluZ1tzY3JlZW5Gb3JtYXRzLkNvdW50XTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzY3JlZW5Gb3JtYXRzLkNvdW50OyBpKyspXHJcbiAgICAgICAgICAgICAgICBzTW9kZXNbaV0gPSBzdHJpbmcuRm9ybWF0KFwiezB9IHggezF9IDogezJ9XCIsIHNjcmVlbkZvcm1hdHNbaV0uWCwgc2NyZWVuRm9ybWF0c1tpXS5ZLCBzY3JlZW5Gb3JtYXRzW2ldLlopO1xyXG5cclxuICAgICAgICAgICAgcmVzU3dpdGNoZXJGcm1TZXR0aW5ncyA9IGZybVNldHRpbmdzLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuU3dpdGNoZXI+KG5ldyBNb25vSW50ZXJmYWNlLlN3aXRjaGVyKG51bGwsIHNNb2RlcywgbnVsbCwgMCwgbWFpbkFuaW1hdG9yLCAwLCA0MCwgMzAwLCAxMDAsIHZlckFsaWduOiAwLjBmKSk7XHJcblxyXG4gICAgICAgICAgICBmcm1TZXR0aW5nc1xyXG4gICAgICAgICAgICAgICAgLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuQnV0dG9uPihuZXcgTW9ub0ludGVyZmFjZS5CdXR0b24oYmFja0ZybVNldHRpbmdzLCBLZXlzLkVzY2FwZSwgMTAsIC0xMCwgMTUwLCA0NSwgaG9yQWxpZ246IDAuMGYsIHZlckFsaWduOiAxLjBmKSlcclxuICAgICAgICAgICAgICAgIC5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkxhYmVsPihuZXcgTW9ub0ludGVyZmFjZS5MYWJlbChcItCd0LDQt9Cw0LRcIiwgMjAsIENvbG9yLkJsYWNrKSk7XHJcbiAgICAgICAgICAgIGZybVNldHRpbmdzXHJcbiAgICAgICAgICAgICAgICAuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5CdXR0b24+KG5ldyBNb25vSW50ZXJmYWNlLkJ1dHRvbihhcHBseUZybVNldHRpbmdzLCBLZXlzLkVudGVyLCAtMTAsIC0xMCwgMTUwLCA0NSwgaG9yQWxpZ246IDEuMGYsIHZlckFsaWduOiAxLjBmKSlcclxuICAgICAgICAgICAgICAgIC5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkxhYmVsPihuZXcgTW9ub0ludGVyZmFjZS5MYWJlbChcItCf0YDQuNC80LXQvdC40YLRjFwiLCAyMCwgQ29sb3IuQmxhY2spKTtcclxuXHJcbiAgICAgICAgICAgIC8vICcg0KTRgNC10LnQvCDQv9C+0LPQvtGC0L7QstC60Lgg0Log0LHQvtGOXHJcbiAgICAgICAgICAgIGZybVByZUdhbWUgPSBNYWluQ29udGFpbmVyLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuRnJhbWU+KG5ldyBNb25vSW50ZXJmYWNlLkZyYW1lKDAsIDAsIDUwMCwgNDAwLCB2aXNpYmxlOiBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgU2hvd0FuaW1hdGlvbiA9IG5ldyBNb25vSW50ZXJmYWNlLk51bWJlckFuaW1hdGlvbihcIllcIiwgLTMwMCwgMCwgNTAsICgpID0+IGZybUJhY2suU2hvdyhtYWluQW5pbWF0b3IpKSxcclxuICAgICAgICAgICAgICAgIEhpZGVBbmltYXRpb24gPSBuZXcgTW9ub0ludGVyZmFjZS5OdW1iZXJBbmltYXRpb24oXCJZXCIsIDAsIDMwMCwgNTAsICgpID0+IGZybUJhY2suSGlkZShtYWluQW5pbWF0b3IpKVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGxibFZzUHJlR2FtZSA9IGZybVByZUdhbWUuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5MYWJlbD4obmV3IE1vbm9JbnRlcmZhY2UuTGFiZWwoXCJcIiwgMjAsIENvbG9yLkJsYWNrLCB5OiA3LCB2ZXJBbGlnbjogMC4wRikpO1xyXG5cclxuICAgICAgICAgICAgYnRuVW5pdHNQcmVHYW1lID0gZnJtUHJlR2FtZS5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkJ1dHRvbj4obmV3IE1vbm9JbnRlcmZhY2UuQnV0dG9uKChidG4sIGlzVG91Y2gpID0+IHtcclxuICAgICAgICAgICAgICAgIGNVbml0c1ByZUdhbWUuVmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBjU3BlbGxzUHJlR2FtZS5WaXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBjQnVpbGRpbmdzUHJlR2FtZS5WaXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBidG5Vbml0c1ByZUdhbWUuSXNTZWxlY3RlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBidG5TcGVsbHNQcmVHYW1lLklzU2VsZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGJ0bkJ1aWxkaW5nc1ByZUdhbWUuSXNTZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9LCAtMTYwLCA2MCwgMTUwLCA0NSwgdmVyQWxpZ246IDAuMEYpKTtcclxuICAgICAgICAgICAgYnRuVW5pdHNQcmVHYW1lLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTGFiZWw+KG5ldyBNb25vSW50ZXJmYWNlLkxhYmVsKFwi0KHRg9GJ0LXRgdGC0LLQsFwiLCAyMCwgQ29sb3IuQmxhY2spKTtcclxuXHJcbiAgICAgICAgICAgIGJ0blNwZWxsc1ByZUdhbWUgPSBmcm1QcmVHYW1lLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuQnV0dG9uPihuZXcgTW9ub0ludGVyZmFjZS5CdXR0b24oKGJ0biwgaXNUb3VjaCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY1VuaXRzUHJlR2FtZS5WaXNpYmxlID0gZmFsc2U7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIGNTcGVsbHNQcmVHYW1lLlZpc2libGUgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgIGNCdWlsZGluZ3NQcmVHYW1lLlZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGJ0blVuaXRzUHJlR2FtZS5Jc1NlbGVjdGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBidG5TcGVsbHNQcmVHYW1lLklzU2VsZWN0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgYnRuQnVpbGRpbmdzUHJlR2FtZS5Jc1NlbGVjdGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0sIDAsIDYwLCAxNTAsIDQ1LCB2ZXJBbGlnbjogMC4wRikpO1xyXG4gICAgICAgICAgICBidG5TcGVsbHNQcmVHYW1lLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTGFiZWw+KG5ldyBNb25vSW50ZXJmYWNlLkxhYmVsKFwi0JfQsNC60LvQuNC90LDQvdC40Y9cIiwgMjAsIENvbG9yLkJsYWNrKSk7XHJcblxyXG4gICAgICAgICAgICBidG5CdWlsZGluZ3NQcmVHYW1lID0gZnJtUHJlR2FtZS5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkJ1dHRvbj4obmV3IE1vbm9JbnRlcmZhY2UuQnV0dG9uKChidG4sIGlzVG91Y2gpID0+IHtcclxuICAgICAgICAgICAgICAgIGNVbml0c1ByZUdhbWUuVmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgY1NwZWxsc1ByZUdhbWUuVmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgY0J1aWxkaW5nc1ByZUdhbWUuVmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBidG5Vbml0c1ByZUdhbWUuSXNTZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgYnRuU3BlbGxzUHJlR2FtZS5Jc1NlbGVjdGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBidG5CdWlsZGluZ3NQcmVHYW1lLklzU2VsZWN0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB9LCAxNjAsIDYwLCAxNTAsIDQ1LCB2ZXJBbGlnbjogMC4wRikpO1xyXG4gICAgICAgICAgICBidG5CdWlsZGluZ3NQcmVHYW1lLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTGFiZWw+KG5ldyBNb25vSW50ZXJmYWNlLkxhYmVsKFwi0J/QvtGB0YLRgNC+0LnQutC4XCIsIDIwLCBDb2xvci5CbGFjaykpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIGNVbml0c1ByZUdhbWUgPSBmcm1QcmVHYW1lLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuR3JpZD4obmV3IE1vbm9JbnRlcmZhY2UuR3JpZChNb25vSW50ZXJmYWNlLkdyaWQuT3JpZW50YXRpb25zLkxlZnRUb1JpZ2h0LCAtMiwgMTIwLCA1MDAsIDEwMCwgdmVyQWxpZ246IDAuMGYsIHZpc2libGU6IGZhbHNlKSk7XHJcbiAgICAgICAgICAgIGNTcGVsbHNQcmVHYW1lID0gZnJtUHJlR2FtZS5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkdyaWQ+KG5ldyBNb25vSW50ZXJmYWNlLkdyaWQoTW9ub0ludGVyZmFjZS5HcmlkLk9yaWVudGF0aW9ucy5MZWZ0VG9SaWdodCwgLTIsIDEyMCwgNTAwLCAxMDAsIHZlckFsaWduOiAwLjBmLCB2aXNpYmxlOiBmYWxzZSkpO1xyXG4gICAgICAgICAgICBjQnVpbGRpbmdzUHJlR2FtZSA9IGZybVByZUdhbWUuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5HcmlkPihuZXcgTW9ub0ludGVyZmFjZS5HcmlkKE1vbm9JbnRlcmZhY2UuR3JpZC5PcmllbnRhdGlvbnMuTGVmdFRvUmlnaHQsIC0yLCAxMjAsIDUwMCwgMTAwLCB2ZXJBbGlnbjogMC4wZiwgdmlzaWJsZTogZmFsc2UpKTtcclxuXHJcbiAgICAgICAgICAgIGNTZWxlY3RlZFByZUdhbWUgPSBmcm1QcmVHYW1lLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuR3JpZD4obmV3IE1vbm9JbnRlcmZhY2UuR3JpZChNb25vSW50ZXJmYWNlLkdyaWQuT3JpZW50YXRpb25zLkxlZnRUb1JpZ2h0LCAtMiwgLTUwLCA1MDAsIDEwMCwgdmVyQWxpZ246IDEuMGYpKTtcclxuXHJcbiAgICAgICAgICAgIGZybVByZUdhbWVcclxuICAgICAgICAgICAgICAgIC5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkJ1dHRvbj4obmV3IE1vbm9JbnRlcmZhY2UuQnV0dG9uKGJhY2tQcmVHYW1lX0NsaWNrZWQsIEtleXMuRXNjYXBlLCAxNSwgLTEwLCAxNTAsIDQ1LCAwLjBGLCAxLjBGKSlcclxuICAgICAgICAgICAgICAgIC5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkxhYmVsPihuZXcgTW9ub0ludGVyZmFjZS5MYWJlbChcItCd0LDQt9Cw0LRcIiwgMjAsIENvbG9yLkJsYWNrKSk7XHJcbiAgICAgICAgICAgIGZybVByZUdhbWVcclxuICAgICAgICAgICAgICAgIC5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkJ1dHRvbj4obmV3IE1vbm9JbnRlcmZhY2UuQnV0dG9uKGNsZWFyUHJlR2FtZV9DbGlja2VkLCAwLCAtMTAsIDE1MCwgNDUsIHZlckFsaWduOiAxLjBGKSlcclxuICAgICAgICAgICAgICAgIC5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkxhYmVsPihuZXcgTW9ub0ludGVyZmFjZS5MYWJlbChcItCe0YfQuNGB0YLQuNGC0YxcIiwgMjAsIENvbG9yLkJsYWNrKSk7XHJcbiAgICAgICAgICAgIGJ0bkZpZ2h0UHJlR2FtZSA9IGZybVByZUdhbWUuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5CdXR0b24+KG5ldyBNb25vSW50ZXJmYWNlLkJ1dHRvbihmaWdodFByZUdhbWVfQ2xpY2tlZCwgS2V5cy5FbnRlciwgLTE1LCAtMTAsIDE1MCwgNDUsIDEuMEYsIDEuMEYpKTtcclxuICAgICAgICAgICAgYnRuRmlnaHRQcmVHYW1lLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTGFiZWw+KG5ldyBNb25vSW50ZXJmYWNlLkxhYmVsKFwi0JIg0LHQvtC5IVwiLCAyMCwgQ29sb3IuQmxhY2spKTtcclxuXHJcblxyXG4gICAgICAgICAgICAvLyDQpNGA0LXQudC8INC/0L7QtNGB0LrQsNC30LrQuFxyXG4gICAgICAgICAgICBmcm1IZWxwID0gTWFpbkNvbnRhaW5lci5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkZyYW1lPihuZXcgTW9ub0ludGVyZmFjZS5GcmFtZSgwLCAwLCAyNTAsIDAsIDAuMGYsIDAuMGYpKTtcclxuXHJcbiAgICAgICAgICAgIC8vINCX0LDQs9C+0LvQvtCy0L7Quiwg0LfQvdCw0YfQvtC6INC4INC/0L7QtNC30LDQs9C+0LvQvtCy0L7QulxyXG4gICAgICAgICAgICBsYmxVbml0TmFtZUhlbHBVbml0ID0gZnJtSGVscC5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkxhYmVsPihuZXcgTW9ub0ludGVyZmFjZS5MYWJlbChcItCi0LjQs9GAXCIsIDE0LCBDb2xvci5CbGFjaywgMCwgMCwgaG9yQWxpZ246IDAuMGYsIHZlckFsaWduOiAwLjBmKSk7XHJcbiAgICAgICAgICAgIGxibFJhY2VIZWxwVW5pdCA9IGZybUhlbHAuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5MYWJlbD4obmV3IE1vbm9JbnRlcmZhY2UuTGFiZWwoXCLQotC40LPRgFwiLCAxMiwgQ29sb3IuQmxhY2ssIDAsIDIzLCBob3JBbGlnbjogMC4wZiwgdmVyQWxpZ246IDAuMGYpKTtcclxuXHJcbiAgICAgICAgICAgIC8vINCh0YLQvtC40LzQvtGB0YLRjFxyXG4gICAgICAgICAgICBsYmxDb3N0TW9uZXlIZWxwVW5pdCA9IGZybUhlbHAuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5MYWJlbD4obmV3IE1vbm9JbnRlcmZhY2UuTGFiZWwoXCLQotC40LPRgFwiLCAxMiwgQ29sb3IuQmxhY2ssIDIwLCA0MywgaG9yQWxpZ246IDAuMGYsIHZlckFsaWduOiAwLjBmKSk7XHJcbiAgICAgICAgICAgIGxibENvc3REZWF0aEhlbHBVbml0ID0gZnJtSGVscC5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkxhYmVsPihuZXcgTW9ub0ludGVyZmFjZS5MYWJlbChcItCi0LjQs9GAXCIsIDEyLCBDb2xvci5CbGFjaywgNzAsIDQzLCBob3JBbGlnbjogMC4wZiwgdmVyQWxpZ246IDAuMGYpKTtcclxuICAgICAgICAgICAgZnJtSGVscC5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLlBpY3R1cmU+KG5ldyBNb25vSW50ZXJmYWNlLlBpY3R1cmUobmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW1wic21hbGxfaWNvbnNcIl0sIDEyKSwgMCwgNDIsIGhvckFsaWduOiAwLjBmLCB2ZXJBbGlnbjogMC4wZikpO1xyXG4gICAgICAgICAgICBmcm1IZWxwLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuUGljdHVyZT4obmV3IE1vbm9JbnRlcmZhY2UuUGljdHVyZShuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJzbWFsbF9pY29uc1wiXSwgMTMpLCA1MCwgNDIsIGhvckFsaWduOiAwLjBmLCB2ZXJBbGlnbjogMC4wZikpO1xyXG5cclxuICAgICAgICAgICAgY0JhdHRsZVBhcmFtZXRlcnMgPSBmcm1IZWxwLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuQ29udGFpbmVyPihuZXcgTW9ub0ludGVyZmFjZS5Db250YWluZXIoMCwgNjUsIDI1MCwgNjAsIGhvckFsaWduOiAwLjBmLCB2ZXJBbGlnbjogMC4wZikpO1xyXG4gICAgICAgICAgICBsYmxBdHRhY2tCYXNpY1BhcmFtcyA9IGNCYXR0bGVQYXJhbWV0ZXJzLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTGFiZWw+KG5ldyBNb25vSW50ZXJmYWNlLkxhYmVsKFwi0KLQuNCz0YBcIiwgMTIsIENvbG9yLkJsYWNrLCAyMCwgMCwgaG9yQWxpZ246IDAuMGYsIHZlckFsaWduOiAwLjBmKSk7XHJcbiAgICAgICAgICAgIHBjdEF0dGFja0Jhc2ljUGFyYW1zID0gY0JhdHRsZVBhcmFtZXRlcnMuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5QaWN0dXJlPihuZXcgTW9ub0ludGVyZmFjZS5QaWN0dXJlKG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcInNtYWxsX2ljb25zXCJdLCAxKSwgMCwgMCwgaG9yQWxpZ246IDAuMGYsIHZlckFsaWduOiAwLjBmKSk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDw9IDI7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgbGJsc0Jhc2ljUGFyYW1zW2ldID0gY0JhdHRsZVBhcmFtZXRlcnMuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5MYWJlbD4obmV3IE1vbm9JbnRlcmZhY2UuTGFiZWwoXCLQotC40LPRgFwiLCAxMiwgQ29sb3IuQmxhY2ssIDIwICsgMTAwICogKGkgJSAyKSwgMjIgKyAoaSAvIDIpICogMjIsIGhvckFsaWduOiAwLjBmLCB2ZXJBbGlnbjogMC4wZikpO1xyXG4gICAgICAgICAgICAgICAgY0JhdHRsZVBhcmFtZXRlcnMuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5QaWN0dXJlPihuZXcgTW9ub0ludGVyZmFjZS5QaWN0dXJlKG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcInNtYWxsX2ljb25zXCJdLCBpICsgMyksIDEwMCAqIChpICUgMiksIDIyICsgKGkgLyAyKSAqIDIyLCBob3JBbGlnbjogMC4wZiwgdmVyQWxpZ246IDAuMGYpKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPD0gNTsgaSsrKVxyXG4gICAgICAgICAgICAgICAgbGJsc0FiaWxzW2ldID0gZnJtSGVscC5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkxvbmdMYWJlbD4obmV3IE1vbm9JbnRlcmZhY2UuTG9uZ0xhYmVsKFwi0KLQuNCz0YBcIiwgMTAsIENvbG9yLkJsYWNrLCAwLCAxNDAsIDI1MCwgaG9yQWxpZ246IDAuMGYsIHZlckFsaWduOiAwLjBmKSk7XHJcblxyXG5cclxuICAgICAgICAgICAgLy8gJyDQpNGA0LXQudC8INCx0L7QtdCy0L7Qs9C+INC80LXQvdGOXHJcbiAgICAgICAgICAgIGZybUJhdHRsZU1lbnUgPSBNYWluQ29udGFpbmVyLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuRnJhbWU+KG5ldyBNb25vSW50ZXJmYWNlLkZyYW1lKDAsIDAsIDI3MCwgMzEwLCB2aXNpYmxlOiBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgU2hvd0FuaW1hdGlvbiA9IG5ldyBNb25vSW50ZXJmYWNlLk51bWJlckFuaW1hdGlvbihcIllcIiwgLTMwMCwgMCwgNTAsICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZnJtQmFjay5WaXNpYmxlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYWluQW5pbWF0b3IuQW5pbWF0aW9ucy5SZW1vdmUoZnJtQmFjay5IaWRlQW5pbWF0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZybUJhY2suU2hvdyhtYWluQW5pbWF0b3IpO1xyXG4gICAgICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgICAgICBIaWRlQW5pbWF0aW9uID0gbmV3IE1vbm9JbnRlcmZhY2UuTnVtYmVyQW5pbWF0aW9uKFwiWVwiLCAwLCAzMDAsIDUwLCAoKSA9PiBmcm1CYWNrLkhpZGUobWFpbkFuaW1hdG9yKSlcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGZybUJhdHRsZU1lbnUuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5MYWJlbD4obmV3IE1vbm9JbnRlcmZhY2UuTGFiZWwoXCLQn9Cw0YPQt9CwXCIsIDMwLCBDb2xvci5CbGFjaywgeTogNywgdmVyQWxpZ246IDAuMEYpKTtcclxuXHJcbiAgICAgICAgICAgIGZybUJhdHRsZU1lbnVcclxuICAgICAgICAgICAgICAgIC5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkJ1dHRvbj4obmV3IE1vbm9JbnRlcmZhY2UuQnV0dG9uKHN1cnJlbmRlckZybUJhdHRsZU1lbnVfQ2xpY2tlZCwgMCwgNjAsIDI1MCwgNDUsIHZlckFsaWduOiAwLjBGKSlcclxuICAgICAgICAgICAgICAgIC5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkxhYmVsPihuZXcgTW9ub0ludGVyZmFjZS5MYWJlbChcItCh0LTQsNGC0YzRgdGPXCIsIDIwLCBDb2xvci5CbGFjaykpO1xyXG4gICAgICAgICAgICBmcm1CYXR0bGVNZW51XHJcbiAgICAgICAgICAgICAgICAuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5CdXR0b24+KG5ldyBNb25vSW50ZXJmYWNlLkJ1dHRvbihyZXN0YXJ0RnJtQmF0dGxlTWVudV9DbGlja2VkLCAwLCAxMjAsIDI1MCwgNDUsIHZlckFsaWduOiAwLjBGKSlcclxuICAgICAgICAgICAgICAgIC5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkxhYmVsPihuZXcgTW9ub0ludGVyZmFjZS5MYWJlbChcItCf0LXRgNC10LfQsNC/0YPRgdGC0LjRgtGMXCIsIDIwLCBDb2xvci5CbGFjaykpO1xyXG4gICAgICAgICAgICBsYmxBSUZybUJhdHRsZU1lbnUgPSBmcm1CYXR0bGVNZW51XHJcbiAgICAgICAgICAgICAgICAuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5CdXR0b24+KG5ldyBNb25vSW50ZXJmYWNlLkJ1dHRvbihBSUZybUJhdHRsZU1lbnVfQ2xpY2tlZCwgMCwgMTgwLCAyNTAsIDQ1LCB2ZXJBbGlnbjogMC4wRikpXHJcbiAgICAgICAgICAgICAgICAuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5MYWJlbD4obmV3IE1vbm9JbnRlcmZhY2UuTGFiZWwoXCLQn9C10YDQtdC60LvRjtGH0LjRgtGMINC90LAg0JjQmFwiLCAyMCwgQ29sb3IuQmxhY2spKTtcclxuICAgICAgICAgICAgZnJtQmF0dGxlTWVudVxyXG4gICAgICAgICAgICAgICAgLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuQnV0dG9uPihuZXcgTW9ub0ludGVyZmFjZS5CdXR0b24oYmFja0ZybUJhdHRsZU1lbnVfQ2xpY2tlZCwgS2V5cy5Fc2NhcGUsIDAsIDI1MCwgMjI1LCA0NSwgdmVyQWxpZ246IDAuMEYpKVxyXG4gICAgICAgICAgICAgICAgLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTGFiZWw+KG5ldyBNb25vSW50ZXJmYWNlLkxhYmVsKFwi0J3QsNC30LDQtCDQsiDQuNCz0YDRg1wiLCAyMCwgQ29sb3IuQmxhY2spKTtcclxuXHJcbiAgICAgICAgICAgIC8vICcg0KTRgNC10LnQvCDQtNC40LDQu9C+0LPQsCDQt9Cw0LLQtdGA0YjQtdC90LjRjyDQsdC+0Y9cclxuICAgICAgICAgICAgZnJtRGlhbG9nID0gTWFpbkNvbnRhaW5lci5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkZyYW1lPihuZXcgTW9ub0ludGVyZmFjZS5GcmFtZSgwLCAwLCAzNzUsIDE4MCwgdmlzaWJsZTogZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgIFNob3dBbmltYXRpb24gPSBuZXcgTW9ub0ludGVyZmFjZS5OdW1iZXJBbmltYXRpb24oXCJZXCIsIC0zMDAsIDAsIDUwLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZybUJhY2suVmlzaWJsZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWFpbkFuaW1hdG9yLkFuaW1hdGlvbnMuUmVtb3ZlKGZybUJhY2suSGlkZUFuaW1hdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmcm1CYWNrLlNob3cobWFpbkFuaW1hdG9yKTtcclxuICAgICAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICAgICAgSGlkZUFuaW1hdGlvbiA9IG5ldyBNb25vSW50ZXJmYWNlLk51bWJlckFuaW1hdGlvbihcIllcIiwgMCwgMzAwLCA1MCwgKCkgPT4gZnJtQmFjay5IaWRlKG1haW5BbmltYXRvcikpXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBsYmxUaXRsZWZybURpYWxvZyA9IGZybURpYWxvZy5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkxhYmVsPihuZXcgTW9ub0ludGVyZmFjZS5MYWJlbChcIlwiLCAzMCwgQ29sb3IuQmxhY2ssIHk6IDcsIHZlckFsaWduOiAwLjBmKSk7XHJcblxyXG4gICAgICAgICAgICBsYmxMaW5lMUZybURpYWxvZyA9IGZybURpYWxvZy5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkxhYmVsPihuZXcgTW9ub0ludGVyZmFjZS5MYWJlbChcIlwiLCAyMCwgQ29sb3IuQmxhY2ssIHk6IDUwLCB2ZXJBbGlnbjogMC4wZikpO1xyXG4gICAgICAgICAgICBsYmxMaW5lMkZybURpYWxvZyA9IGZybURpYWxvZy5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkxhYmVsPihuZXcgTW9ub0ludGVyZmFjZS5MYWJlbChcIlwiLCAyMCwgQ29sb3IuQmxhY2ssIHk6IDcwLCB2ZXJBbGlnbjogMC4wZikpO1xyXG5cclxuICAgICAgICAgICAgZnJtRGlhbG9nXHJcbiAgICAgICAgICAgICAgICAuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5CdXR0b24+KG5ldyBNb25vSW50ZXJmYWNlLkJ1dHRvbihva2F5RnJtRGlhbG9nX0NsaWNrZWQsIDAsIC0xNSwgMTUwLCA0NSwgdmVyQWxpZ246IDEuMGYpKVxyXG4gICAgICAgICAgICAgICAgLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTGFiZWw+KG5ldyBNb25vSW50ZXJmYWNlLkxhYmVsKFwi0JIg0LzQtdC90Y5cIiwgMjAsIENvbG9yLkJsYWNrKSk7XHJcblxyXG4gICAgICAgICAgICAvLyAnINCk0YDQtdC50Lwg0L/QvtC00YLQstC10YDQttC00LXQvdC40Y9cclxuICAgICAgICAgICAgZnJtQ29uZmlybSA9IE1haW5Db250YWluZXIuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5GcmFtZT4obmV3IE1vbm9JbnRlcmZhY2UuRnJhbWUoMCwgMCwgMzc1LCAxNTAsIHZpc2libGU6IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICBTaG93QW5pbWF0aW9uID0gbmV3IE1vbm9JbnRlcmZhY2UuTnVtYmVyQW5pbWF0aW9uKFwiWVwiLCAtMzAwLCAwLCA1MCwgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmcm1CYWNrLlZpc2libGUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1haW5BbmltYXRvci5BbmltYXRpb25zLlJlbW92ZShmcm1CYWNrLkhpZGVBbmltYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgZnJtQmFjay5TaG93KG1haW5BbmltYXRvcik7XHJcbiAgICAgICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgICAgIEhpZGVBbmltYXRpb24gPSBuZXcgTW9ub0ludGVyZmFjZS5OdW1iZXJBbmltYXRpb24oXCJZXCIsIDAsIDMwMCwgNTAsICgpID0+IGZybUJhY2suSGlkZShtYWluQW5pbWF0b3IpKVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgZnJtQ29uZmlybS5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkxhYmVsPihuZXcgTW9ub0ludGVyZmFjZS5MYWJlbChcItCS0Ysg0YPQstC10YDQtdC90YtcIiwgMzAsIENvbG9yLkJsYWNrLCB5OiA3LCB2ZXJBbGlnbjogMC4wRikpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIGxibFRleHRGcm1Db25maXJtID0gZnJtQ29uZmlybS5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkxhYmVsPihuZXcgTW9ub0ludGVyZmFjZS5MYWJlbChcIlwiLCAyMCwgQ29sb3IuQmxhY2ssIHk6IDUwLCB2ZXJBbGlnbjogMC4wRikpO1xyXG5cclxuICAgICAgICAgICAgZnJtQ29uZmlybVxyXG4gICAgICAgICAgICAgICAgLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuQnV0dG9uPihuZXcgTW9ub0ludGVyZmFjZS5CdXR0b24oKGJ0biwgaXNUb3VjaCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGZybUNvbmZpcm0uSGlkZShtYWluQW5pbWF0b3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRhc2tDb25maXJtIT1udWxsP2dsb2JhbDo6QnJpZGdlLlNjcmlwdC5Gcm9tTGFtYmRhKCgpPT50YXNrQ29uZmlybS5TZXRSZXN1bHQodHJ1ZSkpOm51bGw7XHJcbiAgICAgICAgICAgICAgICB9LCBLZXlzLkVudGVyLCAxNSwgLTEwLCAxNTAsIDQ1LCAwLjBGLCAxLjBGKSlcclxuICAgICAgICAgICAgICAgIC5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkxhYmVsPihuZXcgTW9ub0ludGVyZmFjZS5MYWJlbChcItCU0LBcIiwgMjAsIENvbG9yLkJsYWNrKSk7XHJcblxyXG4gICAgICAgICAgICBmcm1Db25maXJtXHJcbiAgICAgICAgICAgICAgICAuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5CdXR0b24+KG5ldyBNb25vSW50ZXJmYWNlLkJ1dHRvbigoYnRuLCBpc1RvdWNoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZnJtQ29uZmlybS5IaWRlKG1haW5BbmltYXRvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFza0NvbmZpcm0hPW51bGw/Z2xvYmFsOjpCcmlkZ2UuU2NyaXB0LkZyb21MYW1iZGEoKCk9PnRhc2tDb25maXJtLlNldFJlc3VsdChmYWxzZSkpOm51bGw7XHJcbiAgICAgICAgICAgICAgICB9LCBLZXlzLkVzY2FwZSwgLTE1LCAtMTAsIDE1MCwgNDUsIDEuMEYsIDEuMEYpKVxyXG4gICAgICAgICAgICAgICAgLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTGFiZWw+KG5ldyBNb25vSW50ZXJmYWNlLkxhYmVsKFwi0J3QtdGCXCIsIDIwLCBDb2xvci5CbGFjaykpO1xyXG5cclxuICAgICAgICAgICAgTWFpbkNvbnRhaW5lci5BcHBseVRoZW1lKGRlZmF1bHRUaGVtZSk7XHJcbiAgICAgICAgICAgIE1haW5Db250YWluZXIuQXBwbHlMb2NhbGl6YXRpb24obG9jYWxpemUpO1xyXG4gICAgICAgICAgICBmcm1CYWNrLkFwcGx5VGhlbWUoYmFja1RoZW1lKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuQ29udGFpbmVyIGNCYXR0bGVQYXJhbWV0ZXJzO1xyXG5cclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuTGFiZWwgbGJsVW5pdE5hbWVIZWxwVW5pdDtcclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuTGFiZWwgbGJsUmFjZUhlbHBVbml0O1xyXG5cclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuTGFiZWwgbGJsQ29zdE1vbmV5SGVscFVuaXQ7XHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkxhYmVsIGxibENvc3REZWF0aEhlbHBVbml0O1xyXG5cclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuTGFiZWwgbGJsQXR0YWNrQmFzaWNQYXJhbXM7XHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLlBpY3R1cmUgcGN0QXR0YWNrQmFzaWNQYXJhbXM7XHJcblxyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5MYWJlbFtdIGxibHNCYXNpY1BhcmFtcyA9IG5ldyBNb25vSW50ZXJmYWNlLkxhYmVsWzNdO1xyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5Mb25nTGFiZWxbXSBsYmxzQWJpbHMgPSBuZXcgTW9ub0ludGVyZmFjZS5Mb25nTGFiZWxbNl07XHJcblxyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5GcmFtZSBmcm1IZWxwO1xyXG5cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkxhYmVsIGxibFZzUHJlR2FtZTtcclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuR3JpZCBjVW5pdHNQcmVHYW1lO1xyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5HcmlkIGNTcGVsbHNQcmVHYW1lO1xyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5HcmlkIGNCdWlsZGluZ3NQcmVHYW1lO1xyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5HcmlkIGNTZWxlY3RlZFByZUdhbWU7XHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkJ1dHRvbiBidG5GaWdodFByZUdhbWU7XHJcblxyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5CdXR0b24gYnRuVW5pdHNQcmVHYW1lO1xyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5CdXR0b24gYnRuU3BlbGxzUHJlR2FtZTtcclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuQnV0dG9uIGJ0bkJ1aWxkaW5nc1ByZUdhbWU7XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIGJhY2tQcmVHYW1lX0NsaWNrZWQoTW9ub0ludGVyZmFjZS5CdXR0b24gYnRuLCBib29sIGlzVG91Y2gpIHtcclxuICAgICAgICAgICAgZ1N0YXRlID0gR2FtZVN0YXRlLk1haW5NZW51O1xyXG4gICAgICAgICAgICBTdGFydEJhdHRsZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgY2xlYXJQcmVHYW1lX0NsaWNrZWQoTW9ub0ludGVyZmFjZS5CdXR0b24gYnRuLCBib29sIGlzVG91Y2gpIHtcclxuICAgICAgICAgICAgcHJlR2FtZVVuaXRzLkNsZWFyKCk7XHJcbiAgICAgICAgICAgIHByZUdhbWVTcGVsbHMuQ2xlYXIoKTtcclxuICAgICAgICAgICAgcHJlR2FtZUJvbnVzLkNsZWFyKCk7XHJcbiAgICAgICAgICAgIFNldFByZUdhbWVMaXN0cygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgZmlnaHRQcmVHYW1lX0NsaWNrZWQoTW9ub0ludGVyZmFjZS5CdXR0b24gYnRuLCBib29sIGlzVG91Y2gpIHtcclxuICAgICAgICAgICAgZnJtUHJlR2FtZS5IaWRlKG1haW5BbmltYXRvcik7XHJcbiAgICAgICAgICAgIFN0YXJ0UGxheWluZygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSB2b2lkIGJhY2tGcm1TZXR0aW5ncyhNb25vSW50ZXJmYWNlLkJ1dHRvbiBidG4sIGJvb2wgaXNUb3VjaCkge1xyXG4gICAgICAgICAgICBmcm1TZXR0aW5ncy5IaWRlKG1haW5BbmltYXRvcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIHZvaWQgYXBwbHlGcm1TZXR0aW5ncyhNb25vSW50ZXJmYWNlLkJ1dHRvbiBidG4sIGJvb2wgaXNUb3VjaCkge1xyXG4gICAgICAgICAgICBmcm1TZXR0aW5ncy5IaWRlKG1haW5BbmltYXRvcik7XHJcbiAgICAgICAgICAgIHZhciB1aVNjYWxlID0gc2NyZWVuRm9ybWF0c1tyZXNTd2l0Y2hlckZybVNldHRpbmdzLkN1cnJlbnRdLlggLyAoZG91YmxlKTgwMDtcclxuICAgICAgICAgICAgaWYgKHVpU2NhbGUgPD0gMS4yNSlcclxuICAgICAgICAgICAgICAgIHVpU2NhbGUgPSAxLjA7XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHVpU2NhbGUgPiAxLjI1ICYmIHVpU2NhbGUgPD0gMS43NSlcclxuICAgICAgICAgICAgICAgIHVpU2NhbGUgPSAxLjU7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHVpU2NhbGUgPSAyLjA7XHJcbiAgICAgICAgICAgIFJlc2l6ZSgoaW50KXNjcmVlbkZvcm1hdHNbcmVzU3dpdGNoZXJGcm1TZXR0aW5ncy5DdXJyZW50XS5YLCAoaW50KXNjcmVlbkZvcm1hdHNbcmVzU3dpdGNoZXJGcm1TZXR0aW5ncy5DdXJyZW50XS5ZLCByZXNTd2l0Y2hlckZybVNldHRpbmdzLkN1cnJlbnQgPT0gMiwgKGZsb2F0KXVpU2NhbGUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBMaXN0PFZlY3RvcjM+IHNjcmVlbkZvcm1hdHM7XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBDcmVhdGVTY3JlZW5Gb3JtYXRzKCkge1xyXG4gICAgICAgICAgICAvLyA9IHtOZXcgVmVjdG9yMig4MDAsIDQ4MCksIE5ldyBWZWN0b3IyKDEzNjYsIDc2OCksIE5ldyBWZWN0b3IyKDE5MjAsIDEwODApfVxyXG4gICAgICAgICAgICBzY3JlZW5Gb3JtYXRzID0gbmV3IExpc3Q8VmVjdG9yMz4oKTtcclxuICAgICAgICAgICAgLy8gRm9yIEVhY2ggZm9ybWF0IEluIEdyYXBoaWNzQWRhcHRlci5EZWZhdWx0QWRhcHRlci5TdXBwb3J0ZWREaXNwbGF5TW9kZXNcclxuICAgICAgICAgICAgLy8gc2NyZWVuRm9ybWF0cy5BZGQoTmV3IFZlY3RvcjMoZm9ybWF0LldpZHRoLCBmb3JtYXQuSGVpZ2h0LCBmb3JtYXQuUmVmcmVzaFJhdGUpKVxyXG4gICAgICAgICAgICAvLyBOZXh0XHJcbiAgICAgICAgICAgIHNjcmVlbkZvcm1hdHMuQWRkUmFuZ2UobmV3W10geyBuZXcgVmVjdG9yMyg4MDAsIDQ4MCwgNjApLCBuZXcgVmVjdG9yMygxMzY2LCA3NjgsIDYwKSwgbmV3IFZlY3RvcjMoMTkyMCwgMTA4MCwgNjApIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBNaWNyb3NvZnQuWG5hLkZyYW1ld29yaztcclxudXNpbmcgTWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuQ29udGVudDtcclxudXNpbmcgTWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuR3JhcGhpY3M7XHJcbnVzaW5nIE5ld3RvbnNvZnQuSnNvbjtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5JTztcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbnVzaW5nIENvbnNvbGUgPSBTeXN0ZW0uQ29uc29sZTtcclxuXHJcbm5hbWVzcGFjZSBEYXJrS2luZ2RvbUNvcmVcclxue1xyXG4gICAgcHVibGljIHBhcnRpYWwgY2xhc3MgTXlHYW1lIHtcclxuICAgICAgICBwdWJsaWMgc3RyaW5nIEFwcEZvbGRlciwgRGF0YUZvbGRlcjtcclxuICAgICAgICBcclxuICAgICAgICBwdWJsaWMgdm9pZCBMb2FkRGF0YShDb250ZW50TWFuYWdlciBjb250ZW50ICkge1xyXG4gICAgICAgICAgICBDb25zb2xlLldyaXRlTGluZShcIlN0YXJ0IExvY2FsaXplXCIpO1xyXG4gICAgICAgICAgICBSZWFkTG9jYWxpemUoKTtcclxuICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoXCJTdGFydCBMb2FkaW5nXCIpO1xyXG5cclxuICAgICAgICAgICAgUmVhZEZvbnRzKGNvbnRlbnQpO1xyXG4gICAgICAgICAgICBSZWFkU3ByaXRlcyhjb250ZW50KTtcclxuICAgICAgICAgICAgUmVhZFVuaXRzUGFyYW1zKCk7XHJcbiAgICAgICAgICAgIFJlYWRTcGVsbHMoKTtcclxuICAgICAgICAgICAgUmVhZFJhY2VzKCk7XHJcblxyXG4gICAgICAgICAgICBDb25zb2xlLldyaXRlTGluZShcIlN0YXJ0IEluaXRpYWxpemluZ1wiKTtcclxuXHJcbiAgICAgICAgICAgIEluaXRpYWxpemUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBUIExvYWRKU09OPFQ+KHN0cmluZyBmbmFtZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHVzaW5nICh2YXIgZmlsZV9yZWFkZXIgPSBuZXcgU3RyZWFtUmVhZGVyKHN0cmluZy5Gb3JtYXQoXCJ7MH0vezF9XCIsRGF0YUZvbGRlcixmbmFtZSksIEVuY29kaW5nLlVURjgpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIganNvbiA9IGZpbGVfcmVhZGVyLlJlYWRUb0VuZCgpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIEpzb25Db252ZXJ0LkRlc2VyaWFsaXplT2JqZWN0PFQ+KGpzb24pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBSZWFkRm9udHMoQ29udGVudE1hbmFnZXIgY29udGVudClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBmb250cyA9IExvYWRKU09OPHN0cmluZ1tdPihcImZvbnRzLmpzb25cIik7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKHZhciBmaWxlbmFtZSBpbiBmb250cylcclxuICAgICAgICAgICAgICAgIC8vI2lmIEJST1dTRVJcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgIEZvbnRzLkFkZCgoc2l6ZTogaW50LlBhcnNlKGZpbGVuYW1lLlN1YnN0cmluZygzKSksIGZvbnQ6IGNvbnRlbnQuTG9hZEFzeW5jPFNwcml0ZUZvbnQ+KCRcIkZvbnRzL3tmaWxlbmFtZX1cIikpKTtcclxuICAgICAgICAgICAgICAgIC8vI2Vsc2VcclxuICAgICAgICAgICAgICAgIEZvbnRzLkFkZChuZXcgU3lzdGVtLlZhbHVlVHVwbGU8aW50LCBTcHJpdGVGb250PihpbnQuUGFyc2UoZmlsZW5hbWUuU3Vic3RyaW5nKDMpKSwgY29udGVudC5Mb2FkPFNwcml0ZUZvbnQ+KHN0cmluZy5Gb3JtYXQoXCJGb250cy97MH1cIiwgZmlsZW5hbWUpKSkpO1xyXG4gICAgICAgICAgICAvLyNlbmRpZlxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgUmVhZFJhY2VzKCkge1xyXG4gICAgICAgICAgICB2YXIgcmFjZXNfZGVmID0gTG9hZEpTT048UmFjZVtdPihcInJhY2VzLmpzb25cIik7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKHZhciByYWNlIGluIHJhY2VzX2RlZilcclxuICAgICAgICAgICAgICAgIFJhY2VNYW5hZ2VyLkluc3RhbmNlLkFsbC5BZGQocmFjZS5uYW1lLCByYWNlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFJlYWRTcGVsbHMoKSB7XHJcbiAgICAgICAgICAgIHZhciBzcGVsbHNfZGVmID0gTG9hZEpTT048U3BlbGxbXT4oXCJzcGVsbHMuanNvblwiKTtcclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIHNwZWxsIGluIHNwZWxsc19kZWYpXHJcbiAgICAgICAgICAgICAgICBzcGVsbHMuQWRkKHNwZWxsLk5hbWUsIHNwZWxsKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFJlYWRVbml0c1BhcmFtcygpIHtcclxuICAgICAgICAgICAgdmFyIHVuaXRzX2RlZiA9IExvYWRKU09OPFVuaXRQYXJhbWV0ZXJzW10+KFwidW5pdHMuanNvblwiKTtcclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIHVuaXQgaW4gdW5pdHNfZGVmKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbmV3X3VuaXQgPSB1bml0O1xyXG4gICAgICAgICAgICAgICAgbmV3X3VuaXQuc3ByaXRlTmFtZSA9IHVuaXQuTmFtZS5Ub0xvd2VyKCk7XHJcbiAgICAgICAgICAgICAgICBuZXdfdW5pdC5hbmltYXRlZCA9IHNwcml0ZXNbdW5pdC5OYW1lLlRvTG93ZXIoKV0uUmFuZ2VzLkNvbnRhaW5zS2V5KFwiQXR0YWNrXCIpO1xyXG4gICAgICAgICAgICAgICAgbmV3X3VuaXQuaWNvbkFwcCA9IG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcInVuaXRfaWNvbnNcIl0sIG5ld191bml0Lmljb25JbmQpO1xyXG4gICAgICAgICAgICAgICAgbmV3X3VuaXQuYWJpbHMgPSBuZXcgRGljdGlvbmFyeTxzdHJpbmcsIEFiaWxpdHk+KCk7XHJcbiAgICAgICAgICAgICAgICBpZiAobmV3X3VuaXQucmF3QWJpbHMgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICh2YXIgYWJpbCBpbiBuZXdfdW5pdC5yYXdBYmlscylcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld191bml0LmFiaWxzLkFkZChhYmlsLm5hbWUsIGFiaWwpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh1bml0LnNpemUudyA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgbmV3X3VuaXQucmVjdCA9IG5ldyBSZWN0YW5nbGUoLXVuaXQuc2l6ZS53IC8gMiwgLXVuaXQuc2l6ZS5oLCB1bml0LnNpemUudywgdW5pdC5zaXplLmgpO1xyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIG5ld191bml0LnJlY3QgPSBuZXcgUmVjdGFuZ2xlKC11czIsIC11bml0U2l6ZSwgdW5pdFNpemUsIHVuaXRTaXplKTtcclxuICAgICAgICAgICAgICAgIG5ld191bml0LmlzQnVpbGRpbmcgPSBuZXdfdW5pdC5hYmlscy5Db250YWluc0tleShcIkJ1aWxkaW5nXCIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKG5ld191bml0LmFiaWxzLkNvbnRhaW5zS2V5KFwiVW5pcXVlXCIpIHx8IG5ld191bml0LmFiaWxzLkNvbnRhaW5zS2V5KFwiSGVyb2ljXCIpKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIG5ld191bml0Lm1heExpbWl0ID0gMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKG5ld191bml0LmFiaWxzLkNvbnRhaW5zS2V5KFwiRWxpdGVcIikpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3X3VuaXQubWF4TGltaXQgPSAzO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgbmV3X3VuaXQuaXNIZXJvaWMgPSBuZXdfdW5pdC5hYmlscy5Db250YWluc0tleShcIkhlcm9pY1wiKTtcclxuICAgICAgICAgICAgICAgIGlmIChuZXdfdW5pdC5hYmlscy5Db250YWluc0tleShcIkh1Z2VcIikpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3X3VuaXQubW92ZVR5cGUgPSBVbml0TW92ZVR5cGUuSHVnZU1UO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAobmV3X3VuaXQuYWJpbHMuQ29udGFpbnNLZXkoXCJGbHlpbmdcIikpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3X3VuaXQubW92ZVR5cGUgPSBVbml0TW92ZVR5cGUuRmx5aW5nTVQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3X3VuaXQubW92ZVR5cGUgPSBVbml0TW92ZVR5cGUuR3JvdW5kTVQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBzdHJpbmdbXSByZW1BYmlscyA9IG5ld1tdIHsgXCJIZXJvaWNcIiwgXCJVbmlxdWVcIiwgXCJFbGl0ZVwiLCBcIkZseWluZ1wiLCBcIkh1Z2VcIiwgXCJcIiB9O1xyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIGFiIGluIHJlbUFiaWxzKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXdfdW5pdC5hYmlscy5Db250YWluc0tleShhYikpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdfdW5pdC5hYmlscy5SZW1vdmUoYWIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh1bml0LmlzU3RhcnRCdWlsZGluZylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBzdGFydEJ1aWxkaW5nc0xpc3QuQWRkKHVuaXQuTmFtZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB1bml0UHJtcy5BZGQodW5pdC5OYW1lLCBuZXdfdW5pdCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFJlYWRTcHJpdGVzKENvbnRlbnRNYW5hZ2VyIGNvbnRlbnQpIHtcclxuICAgICAgICAgICAgdmFyIHNwcml0ZXNfZGVmID0gTG9hZEpTT048TW9ub0ludGVyZmFjZS5TcHJpdGVbXT4oXCJzcHJpdGVzLmpzb25cIik7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKHZhciBzcHJpdGUgaW4gc3ByaXRlc19kZWYpIHtcclxuICAgICAgICAgICAgICAgIHNwcml0ZS5UZXh0dXJlID0gY29udGVudC5Mb2FkPFRleHR1cmUyRD4oc3RyaW5nLkZvcm1hdChcIlNwcml0ZXMvezB9XCIsc3ByaXRlLk5hbWUpKTtcclxuICAgICAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKHN0cmluZy5Gb3JtYXQoXCJTcHJpdGUgJ3swfScgbG9hZGVkXCIsc3ByaXRlLk5hbWUpKTtcclxuICAgICAgICAgICAgICAgIHNwcml0ZXMuQWRkKHNwcml0ZS5OYW1lLCBzcHJpdGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBSZWFkTG9jYWxpemUoKSB7XHJcbiAgICAgICAgICAgIHZhciBsb2FkZWQgPSBMb2FkSlNPTjxEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPj4oXCJsb2NhbGl6ZS1ydS5qc29uXCIpO1xyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IERpY3Rpb25hcnk8c3RyaW5nLCBzdHJpbmc+KCk7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKHZhciBrdnAgaW4gbG9hZGVkKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXNfZmFsbGJhY2sgPSBrdnAuVmFsdWUuQ29udGFpbnMoXCJcXHVGRkZEXCIpO1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0LkFkZChrdnAuS2V5LCBrdnAuVmFsdWUuUmVwbGFjZSgnXFx1RkZGRCcsICc/JykpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGlzX2ZhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgU3lzdGVtLkNvbnNvbGUuV3JpdGVMaW5lKGt2cC5WYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbG9jYWxpemUgPSBuZXcgTW9ub0ludGVyZmFjZS5Mb2NhbGl6YXRpb24oXCLQoNGD0YHRgdC60LjQuVwiLCByZXN1bHQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcbn0iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG5cclxubmFtZXNwYWNlIERhcmtLaW5nZG9tQ29yZSB7XHJcbiAgICBwYXJ0aWFsIGNsYXNzIE15R2FtZSB7XHJcbiAgICAgICAgcHVibGljIFVuaXRQYXJhbWV0ZXJzPyBHZXRVbml0UGFyYW1ldGVyc0Zyb21JRChpbnQgaWQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmb3JlYWNoICh2YXIgdXAgaW4gdW5pdFBybXMuVmFsdWVzKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAodXAuaWQgPT0gaWQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgT25Vbml0c0FiaWxzKFVuaXQgdSkge1xyXG4gICAgICAgICAgICBmb3JlYWNoICh2YXIgYWJpbCBpbiB1LmFiaWxzLlZhbHVlcykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGFiaWwuY29uZENvbXBsZXRlZCAmJiAhYWJpbC51c2VkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWwubmFtZSA9PSBcIlJ1c2hcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwbHJzW3Uub3duZXJdLnJ1c2hCb251cyArPSBhYmlsLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhYmlsLnVzZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWJpbC5uYW1lID09IFwiS2lsbF9mbHllclwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1dSA9IEZpbmRSYW5kb21GbHlVbml0KDEgLSB1Lm93bmVyLCA1MDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodXUgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgS2lsbCh1dSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCj0L3QuNGH0YLQvtC20LXQvVwiLCBiYWRBYmlsQ2xyLCB1dS54LCBob3IgKyB1dS5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhYmlsLnVzZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWJpbC5uYW1lID09IFwiTWFnaWNfYm9udXNcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwbHJzW3Uub3duZXJdLm1hZ2ljSW5jQm9udXMgKz0gYWJpbC52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFiaWwubmFtZSA9PSBcIlBvaXNvbl9ib251c1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBscnNbdS5vd25lcl0ucG9pc29uQm9udXMgKz0gYWJpbC52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFiaWwubmFtZSA9PSBcIlN0ZWFsaW5nXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGxyc1sxIC0gdS5vd25lcl0ubW9uZXlJbmNCb251cyAtPSAxMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGxyc1t1Lm93bmVyXS5tb25leUluY0JvbnVzICs9IDEwO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWJpbC5uYW1lID09IFwiQ2hhb3NcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXUuQWJzQ29udGFpbnMoXCJDaGFvcyBoZWxwZXJcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBhdnVuaXRzID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIHV1IGluIHBscnNbMSAtIHUub3duZXJdLnVuaXRzTGlzdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcGxyc1sxIC0gdS5vd25lcl0uYmFubmVkLkNvbnRhaW5zKHV1KSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXZ1bml0cy5BZGQodXUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF2dW5pdHMuQ291bnQgPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUuQWRkQWJpbGl0eShuZXcgQWJpbGl0eShcIkNoYW9zIGhlbHBlclwiLCB1bml0UHJtc1thdnVuaXRzW3JuZC5OZXh0KGF2dW5pdHMuQ291bnQpXV0uaWQsIFwiXCIsIDAsIEVmZmVjdFR5cGUuTm9ybWFsLCBmYWxzZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhYmlsLm5hbWUgPT0gXCJDaGFvcyBoZWxwZXJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdW5pdF9wYXJhbWV0ZXJzID0gR2V0VW5pdFBhcmFtZXRlcnNGcm9tSUQoYWJpbC52YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1bml0X3BhcmFtZXRlcnMuSGFzVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBscnNbMSAtIHUub3duZXJdLmJhbm5lZC5BZGQodW5pdF9wYXJhbWV0ZXJzLlZhbHVlLk5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhYmlsLm5hbWUgPT0gXCJQdWJsaWNhblwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBscnNbdS5vd25lcl0ubW9uZXlJbmNCb251cyArPSA1ICogcGxyc1t1Lm93bmVyXS51bml0Q291bnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhYmlsLm5hbWUgPT0gXCJCbG9jayBwcm9kXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGxyc1swXS5wcmRTcGQgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwbHJzWzFdLnByZFNwZCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhYmlsLm5hbWUgPT0gXCJJZ25vcmVfdW5pdHNcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1LnBhcmFtZXRlcnMuaXNJZ25vcmVVbml0cyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhYmlsLm5hbWUgPT0gXCJUYWtlb2ZmXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUucGFyYW1ldGVycy5tb3ZlVHlwZSA9PSBVbml0TW92ZVR5cGUuR3JvdW5kTVQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1LnRha2VkT2ZmID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdS5hYmlsc1tcIlRha2VvZmZcIl0udXNlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhYmlsLm5hbWUgPT0gXCJMYW5kaW5nXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUucGFyYW1ldGVycy5tb3ZlVHlwZSA9PSBVbml0TW92ZVR5cGUuRmx5aW5nTVQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1LmxhbmRpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1LmFiaWxzW1wiTGFuZGluZ1wiXS51c2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFiaWwubmFtZSA9PSBcIkVsaXRlX2FyY2hlclwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKHZhciB1dSBpbiB1bml0cykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUgIT0gdXUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXUub3duZXIgPT0gdS5vd25lcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXUucGFyYW1ldGVycy5BdHRhY2suUmFuZ2UgPiAxKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXUuYXRrTW9kLlJhbmdlICs9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhYmlsLm5hbWUgPT0gXCJLaWxsIGFsbFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKHZhciB1dSBpbiB1bml0cykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF1dS5wYXJhbWV0ZXJzLmlzQnVpbGRpbmcpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgS2lsbCh1dSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsRXhwbG9kZSA9IDI1NTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFiaWwubmFtZSA9PSBcIkJpZ19ib29tXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIHV1IGluIHVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIYXJtKHV1LCBybmQuTmV4dCgxMDAwLCAyMDAwKSwgZmFsc2UsIEVmZmVjdFR5cGUuTm9ybWFsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvaXNvbih1dSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsRXhwbG9kZSA9IDI1NTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFiaWwubmFtZSA9PSBcIlJhbmdlX2JvbnVzXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdS5hdGtNb2QuUmFuZ2UgKz0gYWJpbC52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFiaWwubmFtZSA9PSBcIlByb2RfYm9vc3RcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwbHJzW3Uub3duZXJdLnByZFNwZCAqPSAoMSArIChmbG9hdClhYmlsLnZhbHVlIC8gMTAwKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFiaWwubmFtZSA9PSBcIlRpbWVfY29udHJvbFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKHZhciBwIGluIHBscnMpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwLnByZFNwZCAvPSAyO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWJpbC5uYW1lID09IFwiQ2VudGF1cl9wcm9kX2Jvb3N0XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIHV1IGluIHVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXUub3duZXIgPT0gdS5vd25lciAmJiAoKHV1Lm93bmVyID09IDAgJiYgdXUueCA+PSBnYW1lV2lkdGggLyAyKSB8fCAodXUub3duZXIgPT0gMSAmJiB1dS54IDw9IGdhbWVXaWR0aCAvIDIpKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBscnNbdS5vd25lcl0ucHJkU3BkICo9ICgxICsgKGZsb2F0KWFiaWwudmFsdWUgLyAxMDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhYmlsLm5hbWUgPT0gXCJTbG93X3Byb2R1Y3Rpb25cIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwbHJzWzEgLSB1Lm93bmVyXS5wcmRTcGQgLz0gMS41ZjtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFiaWwubmFtZSA9PSBcIlJlY2hhcmdlXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIGFhIGluIHUuYWJpbHMuVmFsdWVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWEudXNlZCA9PSB0cnVlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFhLnVzZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCf0LXRgNC10LfQsNGA0Y/QtNC60LAhXCIsIGdvb2RBYmlsQ2xyLCB1LngsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHUuYWJpbHNbXCJSZWNoYXJnZVwiXS51c2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFiaWwubmFtZSA9PSBcIkx5Y2FudGhyb3B5XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5ld191bml0X3BhcmFtZXRlcnMgPSBHZXRVbml0UGFyYW1ldGVyc0Zyb21JRChhYmlsLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5ld191bml0X3BhcmFtZXRlcnMuSGFzVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCBvbGRtYXhocCA9IHUucGFyYW1ldGVycy5tYXhocDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBvbGRuYW1lID0gdS5wYXJhbWV0ZXJzLk5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1LlNldFBhcmFtcyhuZXdfdW5pdF9wYXJhbWV0ZXJzLlZhbHVlLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1LmhwICo9IHUucGFyYW1ldGVycy5tYXhocCAvIG9sZG1heGhwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCLQm9C40LrQsNC90YLRgNC+0L/QuNGPXCIsIGdvb2RBYmlsQ2xyLCB1LngsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihzdHJpbmcuRm9ybWF0KFwiV3JvbmcgdW5pdCBpZCAtIHswfVwiLGFiaWwudmFsdWUpLCBiYWRBYmlsQ2xyLCB1LngsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFiaWwubmFtZSA9PSBcIkludnVsbmVyYWJsZVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1LnNob3duQWJpbCA9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1LnNob3duQWJpbCA9IFwiSW52dWxuZXJhYmxlXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1LnNob3duQWJpbE1heFZhbCA9IGFiaWwudmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgYWJpbC52YWx1ZSAtPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbC52YWx1ZSA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1LmFiaWxzW1wiSW52dWxuZXJhYmxlXCJdLnVzZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdS5zaG93bkFiaWwgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhYmlsLm5hbWUgPT0gXCJQb2lzb25fYXJvdW5kXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIHV1IGluIHVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXUgIT0gdSAmJiB1Lk5lYXIodXUpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvaXNvbih1dSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFiaWwubmFtZSA9PSBcIkdlbmVyYXRlXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5ld191bml0X3BhcmFtZXRlcnMgPSBHZXRVbml0UGFyYW1ldGVyc0Zyb21JRChhYmlsLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5ld191bml0X3BhcmFtZXRlcnMuSGFzVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvcm5MaXN0LkFkZChuZXcgVW5pdCh0aGlzLCB1LngsIHUubW92ZXNpZGUsIHUub3duZXIsIG5ld191bml0X3BhcmFtZXRlcnMuVmFsdWUpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWJpbC5uYW1lID09IFwiR2VuZXJhdGUgZW5lbXlcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdW5pdF9wYXJhbWV0ZXJzID0gR2V0VW5pdFBhcmFtZXRlcnNGcm9tSUQoYWJpbC52YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1bml0X3BhcmFtZXRlcnMuSGFzVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvcm5MaXN0LkFkZChuZXcgVW5pdCh0aGlzLCB1LngsIHBscnNbMSAtIHUub3duZXJdLm1vdmVzaWRlLCAxIC0gdS5vd25lciwgdW5pdF9wYXJhbWV0ZXJzLlZhbHVlKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFiaWwubmFtZSA9PSBcIlN1bW1vbl9paG9yXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYm9ybkxpc3QuQWRkKG5ldyBVbml0KHRoaXMsIHUueCwgdS5tb3Zlc2lkZSwgdS5vd25lciwgdW5pdFBybXNbXCJJaG9yXCJdKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJvcm5MaXN0LkFkZChuZXcgVW5pdCh0aGlzLCB1LnggLSB1Lm1vdmVzaWRlICogdXMyLCB1Lm1vdmVzaWRlLCB1Lm93bmVyLCB1bml0UHJtc1tcIklob3JcIl0pKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCLQoNCw0YHQv9Cw0LRcIiwgZ29vZEFiaWxDbHIsIHUueCwgaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFiaWwubmFtZSA9PSBcIlN1bW1vbl9jZW50YXVyXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IGF2dW5pdHMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKHZhciB1dSBpbiB1bml0UHJtcy5WYWx1ZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1dS5TdWJyYWNlID09IFwiQ2VudGF1clwiICYmICEodXUuTmFtZSA9PSB1LnBhcmFtZXRlcnMuTmFtZSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXZ1bml0cy5BZGQodXUuTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgYm9ybkxpc3QuQWRkKG5ldyBVbml0KHRoaXMsIHUueCArIDIgKiB1Lm1vdmVzaWRlLCB1Lm1vdmVzaWRlLCB1Lm93bmVyLCB1bml0UHJtc1thdnVuaXRzW3JuZC5OZXh0KGF2dW5pdHMuQ291bnQpXV0pKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWJpbC51c2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFiaWwubmFtZSA9PSBcIkVjb25vbXlcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwbHJzW3Uub3duZXJdLnJlcy5Nb25leSArPSB1LnBhcmFtZXRlcnMuQ29zdC5Nb25leSAvIDI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKHN0cmluZy5Gb3JtYXQoXCIrezB9XCIsdS5wYXJhbWV0ZXJzLkNvc3QuTW9uZXkgLyAyKSwgbW9uZXlDbHIsIHUueCwgaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFiaWwubmFtZSA9PSBcIkxldml0YXRpb25fYXJvdW5kXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIHV1IGluIHVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXUub3duZXIgIT0gdS5vd25lciAmJiB1Lk5lYXIodXUpICYmIHV1LnBhcmFtZXRlcnMubW92ZVR5cGUgPT0gVW5pdE1vdmVUeXBlLkdyb3VuZE1UICYmICF1dS5wYXJhbWV0ZXJzLmlzQnVpbGRpbmcpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXUudGFrZWRPZmYgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhYmlsLm5hbWUgPT0gXCJIZWFsX2RlbW9uc1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKHZhciB1dSBpbiB1bml0cykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUgIT0gdXUgJiYgdS5vd25lciA9PSB1dS5vd25lciAmJiB1dS5wYXJhbWV0ZXJzLlJhY2UgPT0gXCJEZW1vbnNcIiAmJiAhdXUucGFyYW1ldGVycy5pc0J1aWxkaW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSGVhbCh1dSwgcm5kLk5leHQoNDAsIDUxKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXUuQXR0YWNrICs9IDM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFiaWwubmFtZSA9PSBcIkV4cGxvc2l2ZVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEV4cGxvZGUodSwgdS5BYnNDb250YWlucyhcIk1hZ2VcIikpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWJpbC5uYW1lID09IFwiSW52aXNpYmxlXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIHV1IGluIHVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXUub3duZXIgIT0gdS5vd25lciAmJiB1Lk5lYXIodXUpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlaW52aXNpYmxlKHUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhYmlsLm5hbWUgPT0gXCJDbGVhcl9taW5kXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHV1ID0gRmluZFJhbmRvbVVuZmx5VW5pdCgxIC0gdS5vd25lcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1dSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dS5wdXJpZmllZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1LmFiaWxzW1wiQ2xlYXJfbWluZFwiXS51c2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxuXHJcbm5hbWVzcGFjZSBEYXJrS2luZ2RvbUNvcmUge1xyXG4gICAgcHVibGljIGNsYXNzIFBsYXllciB7XHJcbiAgICAgICAgcHVibGljIGludCBpZDtcclxuXHJcbiAgICAgICAgcHVibGljIGludCBtb3Zlc2lkZTtcclxuXHJcbiAgICAgICAgcHVibGljIGludCBiYXNlWDtcclxuICAgICAgICBwdWJsaWMgc3RyaW5nIGhlcm87XHJcbiAgICAgICAgcHVibGljIFVuaXQgaGVyb1VuaXQ7XHJcblxyXG4gICAgICAgIHB1YmxpYyBUaW1lQ29zdCByZXM7XHJcbiAgICAgICAgcHVibGljIHN0cmluZyByYWNlID0gXCJcIjtcclxuICAgICAgICBwdWJsaWMgYm9vbCBBSTtcclxuXHJcbiAgICAgICAgcHVibGljIGludCBjdXJBSVZhbDtcclxuICAgICAgICBwdWJsaWMgaW50IG1heEFJVmFsO1xyXG5cclxuICAgICAgICBwdWJsaWMgaW50IHVDb3VudDtcclxuICAgICAgICBwdWJsaWMgaW50IHN0YXJ0SW5jbztcclxuICAgICAgICBwdWJsaWMgaW50IG1hZ2ljSW5jQm9udXM7XHJcbiAgICAgICAgcHVibGljIGludCBtb25leUluY0JvbnVzO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgaXB0O1xyXG4gICAgICAgIHB1YmxpYyBpbnQgcmVzRGVsYXkgPSA0NTA7XHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgc3ltYjtcclxuXHJcbiAgICAgICAgcHVibGljIExpc3Q8c3RyaW5nPiB1bml0c0xpc3QgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcbiAgICAgICAgcHVibGljIExpc3Q8c3RyaW5nPiBzcGxsc0xpc3QgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcbiAgICAgICAgcHVibGljIExpc3Q8c3RyaW5nPiBib251c0xpc3QgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgTGlzdDxzdHJpbmc+IHJlYWR5VW5pdHMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcbiAgICAgICAgcHVibGljIExpc3Q8c3RyaW5nPiBwcmRRID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBwcmRQcmcsIHByZFNwZDtcclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgc3RhdERlYXRocyA9IDA7XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgc3RyaW5nIGNhc3RsZUZpbGVOYW1lID0gXCJocXNcIjtcclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgcG9pc29uQm9udXM7XHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgdmljdGltY291bnQ7XHJcblxyXG4gICAgICAgIHB1YmxpYyBMaXN0PHN0cmluZz4gYmFubmVkID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG5cclxuICAgICAgICBwdWJsaWMgTGlzdDxmbG9hdD4gc3BlbGxzUmNocmc7XHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgcnVzaEJvbnVzO1xyXG5cclxuICAgICAgICBwdWJsaWMgTXlHYW1lIGdhbWU7XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFJlc2V0KE1hdGNoQ29uZGl0aW9uIGNvbmQpIHtcclxuICAgICAgICAgICAgaWYgKGlkID09IDApXHJcbiAgICAgICAgICAgICAgICBSZXNvdXJjZXMgPSBjb25kLnJlczE7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIFJlc291cmNlcyA9IGNvbmQucmVzMjtcclxuICAgICAgICAgICAgcmVzLlRpZXIgPSBjb25kLnJlczEuVGllcjtcclxuICAgICAgICAgICAgc3RhcnRJbmNvID0gY29uZC5pbmNvbWU7XHJcbiAgICAgICAgICAgIGlwdCA9IGNvbmQuaXB0O1xyXG4gICAgICAgICAgICB1bml0Q291bnQgPSAwO1xyXG4gICAgICAgICAgICBwcmRRLkNsZWFyKCk7XHJcbiAgICAgICAgICAgIHJlYWR5VW5pdHMuQ2xlYXIoKTtcclxuICAgICAgICAgICAgcHJkUHJnID0gMDtcclxuICAgICAgICAgICAgc3RhdERlYXRocyA9IDA7XHJcbiAgICAgICAgICAgIHJlc0RlbGF5ID0gNDUwO1xyXG4gICAgICAgICAgICB2aWN0aW1jb3VudCA9IDA7XHJcbiAgICAgICAgICAgIGJhbm5lZC5DbGVhcigpO1xyXG4gICAgICAgICAgICBzcGVsbHNSY2hyZyA9IG5ldyBMaXN0PGZsb2F0PigpO1xyXG4gICAgICAgICAgICBydXNoQm9udXMgPSAwO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBQbGF5ZXIoTXlHYW1lIGdhbWUsIGludCBpLCBib29sIGEsIGludCBhaXRpY2spIHtcclxuICAgICAgICAgICAgdGhpcy5nYW1lID0gZ2FtZTtcclxuICAgICAgICAgICAgaWQgPSBpO1xyXG4gICAgICAgICAgICBBSSA9IGE7XHJcbiAgICAgICAgICAgIHJlcy5UaWVyID0gMTtcclxuICAgICAgICAgICAgY3VyQUlWYWwgPSBhaXRpY2s7XHJcbiAgICAgICAgICAgIG1heEFJVmFsID0gYWl0aWNrO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgdW5pdENvdW50IHtcclxuICAgICAgICAgICAgZ2V0IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB1Q291bnQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0IHtcclxuICAgICAgICAgICAgICAgIHVDb3VudCA9IHZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIFRpbWVDb3N0IFJlc291cmNlcyB7XHJcbiAgICAgICAgICAgIGdldCB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldCB7XHJcbiAgICAgICAgICAgICAgICByZXMgPSB2YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgaGFzVW5pdChzdHJpbmcgbmFtZSkge1xyXG4gICAgICAgICAgICBmb3JlYWNoIChVbml0IHUgaW4gTXlHYW1lLnVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodS5vd25lciA9PSBpZCAmJiB1LnBhcmFtZXRlcnMuTmFtZSA9PSBuYW1lKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBib29sIENoZWNrRm9yUHJvZHVjZShzdHJpbmcgbmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcHJkUS5Db3VudCArIHJlYWR5VW5pdHMuQ291bnQgPCA3ICYmIHJlcy5Fbm91Z2hGb3IoTXlHYW1lLnVuaXRQcm1zW25hbWVdLkNvc3QpICYmIENoZWNrRm9yTGltaXQobmFtZSkgJiYgIWJhbm5lZC5Db250YWlucyhuYW1lKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBib29sIENoZWNrRm9yTGltaXQoc3RyaW5nIG5hbWUpIHtcclxuICAgICAgICAgICAgaWYgKE15R2FtZS51bml0UHJtc1tuYW1lXS5pc0hlcm9pYykge1xyXG4gICAgICAgICAgICAgICAgaW50IHRtcCA9IDA7XHJcbiAgICAgICAgICAgICAgICBmb3JlYWNoIChVbml0IHUgaW4gTXlHYW1lLnVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHUub3duZXIgPT0gaWQgJiYgdS5wYXJhbWV0ZXJzLmlzSGVyb2ljKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0bXAgKz0gMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGZvcmVhY2ggKHN0cmluZyB1IGluIHByZFEpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoTXlHYW1lLnVuaXRQcm1zW3VdLmlzSGVyb2ljKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0bXAgKz0gMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGZvcmVhY2ggKHZhciB1IGluIHJlYWR5VW5pdHMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodSA9PSBuYW1lKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0bXAgKz0gMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiB0bXAgPT0gMDtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChNeUdhbWUudW5pdFBybXNbbmFtZV0ubWF4TGltaXQgPT0gMClcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGludCB0bXAgPSAwO1xyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAoVW5pdCB1IGluIE15R2FtZS51bml0cykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1Lm93bmVyID09IGlkICYmIHUucGFyYW1ldGVycy5OYW1lID09IG5hbWUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRtcCArPSAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAoc3RyaW5nIHUgaW4gcHJkUSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1ID09IG5hbWUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRtcCArPSAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIHUgaW4gcmVhZHlVbml0cykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1ID09IG5hbWUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRtcCArPSAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRtcCA8IE15R2FtZS51bml0UHJtc1tuYW1lXS5tYXhMaW1pdDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgYWlkZWZlbmNlc3RyZWFrO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgYWlzdXBwb3J0c3RyZWFrO1xyXG5cclxuICAgICAgICBwcml2YXRlIGJvb2wgcHJvZHN1cHBvcnQ7XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEFJVGljayhNeUdhbWUgbWMpIHtcclxuICAgICAgICAgICAgaWYgKHJlcy5EZWF0aCA+PSAxNSAmJiByZXMuVGllciA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzLk1vbmV5ID49IDE1MClcclxuICAgICAgICAgICAgICAgICAgICBtYy5UcnlBZGRUb1F1ZXVlVW5pdCh0aGlzLCBcIlRpZXJfMlwiKTsgLy8g0JDQv9Cz0YDQtdC50LRcclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHJlcy5EZWF0aCA+PSAxNSAmJiByZXMuVGllciA9PSAyKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzLk1vbmV5ID49IDE1MClcclxuICAgICAgICAgICAgICAgICAgICBtYy5UcnlBZGRUb1F1ZXVlVW5pdCh0aGlzLCBcIlRpZXJfM1wiKTsgIC8vINCQ0L/Qs9GA0LXQudC0XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIGlmICh1bml0Q291bnQgPCAxMykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHByZFEuQ291bnQgPCAyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IGF2dW5pdHMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJvZHN1cHBvcnQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodW5pdENvdW50ID4gMCB8fCBhaWRlZmVuY2VzdHJlYWsgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhaXN1cHBvcnRzdHJlYWsgPiAwICYmIGFpc3VwcG9ydHN0cmVhayA8IDIgfHwgYWlkZWZlbmNlc3RyZWFrID49IDEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9kc3VwcG9ydCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKHN0cmluZyB1IGluIHVuaXRzTGlzdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoTXlHYW1lLnVuaXRQcm1zW3VdLnN1cHBvcnQgPT0gcHJvZHN1cHBvcnQgJiYgQ2hlY2tGb3JQcm9kdWNlKHUpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXZ1bml0cy5BZGQodSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhdnVuaXRzLkNvdW50ID4gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWMuVHJ5QWRkVG9RdWV1ZVVuaXQodGhpcywgYXZ1bml0c1tNeUdhbWUucm5kLk5leHQoMCwgYXZ1bml0cy5Db3VudCldKTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh1bml0c0xpc3QuQ291bnQgPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYy5UcnlBZGRUb1F1ZXVlVW5pdCh0aGlzLCB1bml0c0xpc3RbTXlHYW1lLnJuZC5OZXh0KDAsIHVuaXRzTGlzdC5Db3VudCldKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxuXHJcbm5hbWVzcGFjZSBEYXJrS2luZ2RvbUNvcmVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIFByb2ZpbGVcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgc3RyaW5nIG5hbWU7XHJcbiAgICAgICAgcHVibGljIGludCBhdklkO1xyXG4gICAgICAgIHB1YmxpYyBMaXN0PHN0cmluZz4gdW5pdHMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcbiAgICAgICAgcHVibGljIGludCBkaWZmaWN1bHQgPSAxO1xyXG4gICAgICAgIHB1YmxpYyBEaWN0aW9uYXJ5PHN0cmluZywgaW50PiByYWNlc1BsYXlzID0gbmV3IERpY3Rpb25hcnk8c3RyaW5nLCBpbnQ+KCksIHJhY2VzV2lucyA9IG5ldyBEaWN0aW9uYXJ5PHN0cmluZywgaW50PigpO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgbWludmljdGltcywgbWF4a2lsbHM7XHJcbiAgICAgICAgcHVibGljIERpY3Rpb25hcnk8c3RyaW5nLCBzdHJpbmc+IGFjaGl2cyA9IG5ldyBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPigpO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgY3J5c3RhbHM7XHJcbiAgICAgICAgcHVibGljIGludCBtYXhDdXN0b21SYWNlcztcclxuXHJcbiAgICAgICAgcHVibGljIFByb2ZpbGUoc3RyaW5nIG5hbSwgaW50IGF2LCBpbnQgZCwgTGlzdDxzdHJpbmc+IHVudHMsIERpY3Rpb25hcnk8c3RyaW5nLCBpbnQ+IHJQbHMsIERpY3Rpb25hcnk8c3RyaW5nLCBpbnQ+IHJXbnMsIGludCBtdiwgaW50IG1rLCBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPiBhY2h2cywgaW50IGNyc3QsIGludCBtYXhDdXN0b21SYWNzKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbmFtZSA9IG5hbTtcclxuICAgICAgICAgICAgYXZJZCA9IGF2O1xyXG4gICAgICAgICAgICB1bml0cyA9IHVudHM7XHJcbiAgICAgICAgICAgIGRpZmZpY3VsdCA9IGQ7XHJcbiAgICAgICAgICAgIHJhY2VzUGxheXMgPSByUGxzO1xyXG4gICAgICAgICAgICByYWNlc1dpbnMgPSByV25zO1xyXG4gICAgICAgICAgICBtaW52aWN0aW1zID0gbXY7XHJcbiAgICAgICAgICAgIG1heGtpbGxzID0gbWs7XHJcbiAgICAgICAgICAgIGFjaGl2cyA9IGFjaHZzO1xyXG4gICAgICAgICAgICBjcnlzdGFscyA9IGNyc3Q7XHJcbiAgICAgICAgICAgIG1heEN1c3RvbVJhY2VzID0gbWF4Q3VzdG9tUmFjcztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGNsYXNzIFByb2ZpbGVNYW5hZ2VyXHJcbiAgICB7XHJcbiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgUHJvZmlsZU1hbmFnZXIgX2luc3RhbmNlO1xyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFByb2ZpbGVNYW5hZ2VyIEluc3RhbmNlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKF9pbnN0YW5jZSA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIF9pbnN0YW5jZSA9IG5ldyBQcm9maWxlTWFuYWdlcigpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9pbnN0YW5jZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIExpc3Q8UHJvZmlsZT4gQWxsID0gbmV3IExpc3Q8UHJvZmlsZT4oKTtcclxuICAgIH1cclxufVxyXG4iLCJuYW1lc3BhY2UgRGFya0tpbmdkb21Db3JlXHJcbntcclxuICAgIGNsYXNzIFB1cmNoYXNlXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIHN0cmluZyBuYW1lO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgY3J5c3RhbHM7XHJcbiAgICAgICAgcHVibGljIE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZSB1SWNvbjtcclxuXHJcbiAgICAgICAgcHVibGljIFB1cmNoYXNlKHN0cmluZyBuYW0sIE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZSB1aSwgaW50IGNyc3QpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBuYW1lID0gbmFtO1xyXG4gICAgICAgICAgICB1SWNvbiA9IHVpO1xyXG4gICAgICAgICAgICBjcnlzdGFscyA9IGNyc3Q7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBOZXd0b25zb2Z0Lkpzb247XHJcblxyXG5uYW1lc3BhY2UgRGFya0tpbmdkb21Db3JlXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBSYWNlXHJcbiAgICB7XHJcblxyXG4gICAgICAgIFtKc29uUHJvcGVydHkoXCJuYW1lXCIpXVxyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgbmFtZTtcclxuXHJcbiAgICAgICAgW0pzb25Qcm9wZXJ0eShcIkRlc2NcIildXHJcbiAgICAgICAgcHVibGljIHN0cmluZyBkZXNjO1xyXG5cclxuICAgICAgICBbSnNvblByb3BlcnR5KFwic3ltYlwiKV1cclxuICAgICAgICBwdWJsaWMgaW50IHN5bWI7XHJcblxyXG4gICAgICAgIFtKc29uUHJvcGVydHkoXCJub0FJXCIpXVxyXG4gICAgICAgIHB1YmxpYyBib29sIG5vQUk7XHJcblxyXG4gICAgICAgIFtKc29uUHJvcGVydHkoXCJzcGVjaWFsXCIpXVxyXG4gICAgICAgIHB1YmxpYyBib29sIHNwZWNpYWw7XHJcblxyXG4gICAgICAgIFtKc29uUHJvcGVydHkoXCJkaXNhYmxlUmV3YXJkc1wiKV1cclxuICAgICAgICBwdWJsaWMgYm9vbCBkaXNhYmxlUmV3YXJkcztcclxuXHJcbiAgICAgICAgcHVibGljIHN0cmluZyBuaWNrID0gXCJcIjtcclxuICAgICAgICBcclxuICAgICAgICBwdWJsaWMgYm9vbCBjdXN0b207XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEVuYWJsZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBzcGVjaWFsID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgUmFjZShzdHJpbmcgbm1lLCBzdHJpbmcgZHNjLCBzdHJpbmcgbmljLCBpbnQgc3ltLCBib29sIG5haSwgYm9vbCBjc3QsIGJvb2wgc3BsYywgYm9vbCBkcilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIG5hbWUgPSBubWU7XHJcbiAgICAgICAgICAgIGRlc2MgPSBkc2M7XHJcbiAgICAgICAgICAgIHN5bWIgPSBzeW07XHJcbiAgICAgICAgICAgIG5vQUkgPSBuYWk7XHJcbiAgICAgICAgICAgIGN1c3RvbSA9IGNzdDtcclxuICAgICAgICAgICAgc3BlY2lhbCA9IHNwbGM7XHJcbiAgICAgICAgICAgIG5pY2sgPSBuaWM7XHJcbiAgICAgICAgICAgIGRpc2FibGVSZXdhcmRzID0gZHI7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBjbGFzcyBSYWNlTWFuYWdlclxyXG4gICAge1xyXG4gICAgICAgIHByaXZhdGUgc3RhdGljIFJhY2VNYW5hZ2VyIF9pbnN0YW5jZTtcclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBSYWNlTWFuYWdlciBJbnN0YW5jZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChfaW5zdGFuY2UgPT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICBfaW5zdGFuY2UgPSBuZXcgUmFjZU1hbmFnZXIoKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBfaW5zdGFuY2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBEaWN0aW9uYXJ5PHN0cmluZywgUmFjZT4gQWxsID0gbmV3IERpY3Rpb25hcnk8c3RyaW5nLCBSYWNlPigpO1xyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW07XHJcbnVzaW5nIE1pY3Jvc29mdC5YbmEuRnJhbWV3b3JrO1xyXG51c2luZyBNaWNyb3NvZnQuWG5hLkZyYW1ld29yay5HcmFwaGljcztcclxudXNpbmcgTmV3dG9uc29mdC5Kc29uO1xyXG51c2luZyBTeXN0ZW0uQ29tcG9uZW50TW9kZWw7XHJcblxyXG5uYW1lc3BhY2UgRGFya0tpbmdkb21Db3JlIHtcclxuICAgIHB1YmxpYyBjbGFzcyBVbml0IHtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgeDtcclxuXHJcbiAgICAgICAgcHVibGljIGludCBvd25lcjtcclxuXHJcbiAgICAgICAgcHVibGljIGludCBtb3Zlc2lkZTtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgaHA7XHJcblxyXG4gICAgICAgIHB1YmxpYyBVbml0UGFyYW1ldGVycyBwYXJhbWV0ZXJzO1xyXG5cclxuICAgICAgICBwdWJsaWMgaW50IGF0a1JlY2hhcmdlID0gMDtcclxuICAgICAgICBwdWJsaWMgaW50IHBvaVJlY2hhcmdlID0gNjA7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IHdpbmdzV2F2ZSA9IDA7XHJcblxyXG4gICAgICAgIHB1YmxpYyBib29sIGlzSW5Db21iYXQgPSBmYWxzZTtcclxuICAgICAgICBwdWJsaWMgYm9vbCBpc0luUmFuZ2VDb21iYXQgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgcHVyaWZpZWQ7XHJcbiAgICAgICAgcHVibGljIGJvb2wgbGFuZGluZztcclxuICAgICAgICBwdWJsaWMgYm9vbCB0YWtlZE9mZjtcclxuXHJcbiAgICAgICAgcHVibGljIERpY3Rpb25hcnk8c3RyaW5nLCBBYmlsaXR5PiBhYmlscztcclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgZGVhdGhGcm9tUG9pc29uO1xyXG5cclxuICAgICAgICBwdWJsaWMgc3RyaW5nIHNob3duQWJpbCA9IFwiXCI7XHJcbiAgICAgICAgcHVibGljIGludCBzaG93bkFiaWxNYXhWYWwgPSAwO1xyXG5cclxuICAgICAgICBwdWJsaWMgQXR0YWNrIGF0a01vZDtcclxuXHJcbiAgICAgICAgcHVibGljIE15R2FtZSBnYW1lO1xyXG5cclxuXHJcbiAgICAgICAgcHVibGljIEF0dGFjayBBdHRhY2sge1xyXG4gICAgICAgICAgICBnZXQge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhcmFtZXRlcnMuQXR0YWNrICsgYXRrTW9kO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldCB7XHJcbiAgICAgICAgICAgICAgICBhdGtNb2QgPSB2YWx1ZSAtIHBhcmFtZXRlcnMuQXR0YWNrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgTmVhcihVbml0IHUyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBNYXRoLkFicyh4IC0gdTIueCkgPD0gMzAgJiYgcGFyYW1ldGVycy5OZWFyKHUyLnBhcmFtZXRlcnMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgRHJhd0N1cnJlbnQoaW50IHgsIGludCB5LCBTcHJpdGVCYXRjaCBzYiwgU3ByaXRlRWZmZWN0cyBlZmZlY3QgPSBTcHJpdGVFZmZlY3RzLk5vbmUpIHtcclxuICAgICAgICAgICAgaWYgKE15R2FtZS5zcHJpdGVzW3BhcmFtZXRlcnMuc3ByaXRlTmFtZV0uUmFuZ2VzLkNvbnRhaW5zS2V5KEN1cnJlbnRBbmltYXRpb24pKSB7XHJcbiAgICAgICAgICAgICAgICBpbnQgY3VySW5kO1xyXG4gICAgICAgICAgICAgICAgY3VySW5kID0gTXlHYW1lLnNwcml0ZXNbcGFyYW1ldGVycy5zcHJpdGVOYW1lXS5SYW5nZXNbQ3VycmVudEFuaW1hdGlvbl0uSXRlbTErIChpbnQpTWF0aC5GbG9vcihDdXJyZW50RnJhbWUpO1xyXG4gICAgICAgICAgICAgICAgTXlHYW1lLnNwcml0ZXNbcGFyYW1ldGVycy5zcHJpdGVOYW1lXS5EcmF3KGN1ckluZCwgeCwgeSwgc2IsIGVmZmVjdCk7XHJcbiAgICAgICAgICAgIH0gZWxzZVxyXG4gICAgICAgICAgICAgICAgTXlHYW1lLnNwcml0ZXNbcGFyYW1ldGVycy5zcHJpdGVOYW1lXS5EcmF3KDAsIHgsIHksIHNiLCBlZmZlY3QpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgU3RhcnRBbmltYXRpb24oc3RyaW5nIG5hbWUsIE1vbm9JbnRlcmZhY2UuQW5pbWF0b3IgYW5pbWF0b3IpIHtcclxuICAgICAgICAgICAgaWYgKE15R2FtZS5zcHJpdGVzW3BhcmFtZXRlcnMuc3ByaXRlTmFtZV0uUmFuZ2VzLkNvbnRhaW5zS2V5KG5hbWUpKSB7XHJcbiAgICAgICAgICAgICAgICBDdXJyZW50QW5pbWF0aW9uID0gbmFtZTtcclxuICAgICAgICAgICAgICAgIGFuaW1hdG9yLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTnVtYmVyQW5pbWF0aW9uPihuZXcgTW9ub0ludGVyZmFjZS5OdW1iZXJBbmltYXRpb24oXCJDdXJyZW50RnJhbWVcIiwgMCwgMC45ZiwgMC4xZiwgdGFyZ2V0OiB0aGlzLCBvbkVuZDogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIEN1cnJlbnRBbmltYXRpb24gPSBcIklkbGVcIjtcclxuICAgICAgICAgICAgICAgICAgICBDdXJyZW50RnJhbWUgPSAwO1xyXG4gICAgICAgICAgICAgICAgfSkpLkJlZ2luKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgQ3VycmVudEFuaW1hdGlvbiB7IGdldDsgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIGZsb2F0IEN1cnJlbnRGcmFtZSB7IGdldDsgc2V0OyB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBBZGRBYmlsaXR5KHN0cmluZyBubWUsIGludCBudW0sIHN0cmluZyBjb25kLCBpbnQgY2RudW0sIEVmZmVjdFR5cGUgdCwgYm9vbCBoaWRkZW4gPSBmYWxzZSkge1xyXG4gICAgICAgICAgICBpZiAoIWFiaWxzLkNvbnRhaW5zS2V5KG5tZSkpXHJcbiAgICAgICAgICAgICAgICBhYmlscy5BZGQobm1lLCBuZXcgQWJpbGl0eShubWUsIG51bSwgY29uZCwgY2RudW0sIHQsIGhpZGRlbikpO1xyXG4gICAgICAgICAgICBlbHNlIGlmIChhYmlsc1tubWVdLnVzZWQpXHJcbiAgICAgICAgICAgICAgICBhYmlsc1tubWVdID0gbmV3IEFiaWxpdHkobm1lLCBudW0sIGNvbmQsIGNkbnVtLCB0LCBoaWRkZW4pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgQWRkQWJpbGl0eShBYmlsaXR5IGEpIHtcclxuICAgICAgICAgICAgQWRkQWJpbGl0eShhLm5hbWUsIGEudmFsdWUsIGEuY29uZGl0aW9uLCBhLmNvbmRudW0sIGEudHlwLCBhLmhpZGRlbik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBBZGRBYmlsaXR5KHN0cmluZyBubWUsIEVmZmVjdFR5cGUgdCwgYm9vbCBoaWRkZW4gPSBmYWxzZSkge1xyXG4gICAgICAgICAgICBBZGRBYmlsaXR5KG5tZSwgMCwgXCJcIiwgMCwgdCwgaGlkZGVuKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEFkZEFiaWxpdHkoc3RyaW5nIG5tZSwgaW50IG51bSwgRWZmZWN0VHlwZSB0LCBib29sIGhpZGRlbiA9IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIEFkZEFiaWxpdHkobm1lLCBudW0sIFwiXCIsIDAsIHQsIGhpZGRlbik7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgUmVtb3ZlQWJpbChzdHJpbmcgbm1lKSB7XHJcbiAgICAgICAgICAgIGlmIChhYmlscy5Db250YWluc0tleShubWUpKVxyXG4gICAgICAgICAgICAgICAgYWJpbHMuUmVtb3ZlKG5tZSk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgQWJzQ29udGFpbnMoc3RyaW5nIGFiaWxfbmFtZSkge1xyXG4gICAgICAgICAgICBpZiAoYWJpbHMuQ29udGFpbnNLZXkoYWJpbF9uYW1lKSlcclxuICAgICAgICAgICAgICAgIHJldHVybiBhYmlsc1thYmlsX25hbWVdLmNvbmRDb21wbGV0ZWQgJiYgIWFiaWxzW2FiaWxfbmFtZV0udXNlZDtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgQWJzQ29udGFpbnMocGFyYW1zIHN0cmluZ1tdIGFicykge1xyXG4gICAgICAgICAgICBmb3JlYWNoIChzdHJpbmcgYWIgaW4gYWJzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYWJpbHMuQ29udGFpbnNLZXkoYWIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWxzW2FiXS5jb25kQ29tcGxldGVkICYmICFhYmlsc1thYl0udXNlZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgTWluRGFtYWdlIHtcclxuICAgICAgICAgICAgZ2V0IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBwYXJhbWV0ZXJzLkF0dGFjay5NaW5EYW1hZ2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgTWF4RGFtYWdlIHtcclxuICAgICAgICAgICAgZ2V0IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBwYXJhbWV0ZXJzLkF0dGFjay5NYXhEYW1hZ2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgVW5pdChNeUdhbWUgZ2FtZSwgZmxvYXQgeHgsIGludCBtc2lkLCBpbnQgb3duLCBVbml0UGFyYW1ldGVycyBwcm1zKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZ2FtZSA9IGdhbWU7XHJcbiAgICAgICAgICAgIHggPSB4eDtcclxuICAgICAgICAgICAgbW92ZXNpZGUgPSBtc2lkO1xyXG4gICAgICAgICAgICBvd25lciA9IG93bjtcclxuICAgICAgICAgICAgU2V0UGFyYW1zKHBybXMsIHRydWUpO1xyXG4gICAgICAgICAgICBDdXJyZW50QW5pbWF0aW9uID0gXCJJZGxlXCI7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgU2V0UGFyYW1zKFVuaXRQYXJhbWV0ZXJzIG5ld3BybSwgYm9vbCBzZXRIcCkge1xyXG4gICAgICAgICAgICBwYXJhbWV0ZXJzID0gbmV3cHJtO1xyXG4gICAgICAgICAgICBhdGtNb2QgPSBuZXcgQXR0YWNrKDAsIDAsIDAsIDApO1xyXG4gICAgICAgICAgICBhYmlscyA9IG5ldyBEaWN0aW9uYXJ5PHN0cmluZywgQWJpbGl0eT4oKTtcclxuICAgICAgICAgICAgZm9yZWFjaCAoQWJpbGl0eSBhIGluIHBhcmFtZXRlcnMuYWJpbHMuVmFsdWVzKVxyXG4gICAgICAgICAgICAgICAgQWRkQWJpbGl0eShhKTtcclxuICAgICAgICAgICAgaWYgKEFic0NvbnRhaW5zKFwiUmFuZG9tIG1vZGVsXCIpKSB7XHJcbiAgICAgICAgICAgICAgICBSZW1vdmVBYmlsKFwiUmFuZG9tIG1vZGVsXCIpO1xyXG5kb1xyXG57XHJcbiAgICBnbG9iYWw6OkJyaWRnZS5TY3JpcHQuVG9UZW1wKFwiY2FzZV9wYXR0ZXJuMFwiLCBNeUdhbWUucm5kLk5leHREb3VibGUoKSk7XHJcbiAgICBpZiAoZ2xvYmFsOjpCcmlkZ2UuU2NyaXB0LkZyb21UZW1wPGRvdWJsZT4oXCJjYXNlX3BhdHRlcm4wXCIpIGlzIG9iamVjdClcclxuICAgIHtcclxuICAgICAgICB2YXIgX2Rpc2NhcmQxID0gKG9iamVjdClnbG9iYWw6OkJyaWRnZS5TY3JpcHQuRnJvbVRlbXA8ZG91YmxlPihcImNhc2VfcGF0dGVybjBcIik7XHJcbiAgICAgICAgaWYgKE15R2FtZS5ybmQuTmV4dERvdWJsZSgpIDwgMC4zMylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHBhcmFtZXRlcnMuc3ByaXRlTmFtZSA9IFwibWlsaXRpYTFcIjtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmIChnbG9iYWw6OkJyaWRnZS5TY3JpcHQuRnJvbVRlbXA8ZG91YmxlPihcImNhc2VfcGF0dGVybjBcIikgaXMgb2JqZWN0KVxyXG4gICAge1xyXG4gICAgICAgIHZhciBfZGlzY2FyZDIgPSAob2JqZWN0KWdsb2JhbDo6QnJpZGdlLlNjcmlwdC5Gcm9tVGVtcDxkb3VibGU+KFwiY2FzZV9wYXR0ZXJuMFwiKTtcclxuICAgICAgICBpZiAoTXlHYW1lLnJuZC5OZXh0RG91YmxlKCkgPCAwLjY2KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcGFyYW1ldGVycy5zcHJpdGVOYW1lID0gXCJtaWxpdGlhMlwiO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxud2hpbGUgKGZhbHNlKTsgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChBYnNDb250YWlucyhcIlVuaXZlcnNhbFwiKSkge1xyXG4gICAgICAgICAgICAgICAgUmVtb3ZlQWJpbChcIlVuaXZlcnNhbFwiKTtcclxuICAgICAgICAgICAgICAgIHZhciBtYXhyYWNlID0gTXlHYW1lLlNlbGVjdFBsYXlpbmdSYWNlKE15R2FtZS5wbHJzW293bmVyXS51bml0c0xpc3QpO1xyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChtYXhyYWNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkh1bWFuc1wiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBZGRBYmlsaXR5KFwiTGlmZV9yb2xsYmFja1wiLCAyLCBFZmZlY3RUeXBlLkdvb2QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIlVuZGVhZHNcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQWRkQWJpbGl0eShcIlVuZGVhZFwiLCBFZmZlY3RUeXBlLkdvb2QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQWRkQWJpbGl0eShcIlBsYWd1ZVwiLCBFZmZlY3RUeXBlLkdvb2QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1ldGVycy5TcGVlZCA9IFwiU2xvd1wiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkRlbW9uc1wiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBZGRBYmlsaXR5KFwiTWFnZVwiLCBFZmZlY3RUeXBlLkdvb2QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQWRkQWJpbGl0eShcIkV4cGxvc2l2ZVwiLCAwLCBcIk9uX2RlYXRoXCIsIDAsIEVmZmVjdFR5cGUuR29vZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbWV0ZXJzLkFybW9yID0gXCJOb25lXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbWV0ZXJzLlNwZWVkID0gXCJGYXN0XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiSG9yZGVcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQXR0YWNrICs9IDEwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQWRkQWJpbGl0eShcIkNyYXNoZXJcIiwgMjQsIEVmZmVjdFR5cGUuR29vZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiU3dhbXBlcnNcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQWRkQWJpbGl0eShcIlBvaXNvbmVyXCIsIDIwLCBFZmZlY3RUeXBlLkdvb2QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQWRkQWJpbGl0eShcIlBvaXNvbnByb29mXCIsIEVmZmVjdFR5cGUuR29vZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiRWx2ZXNcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQWRkQWJpbGl0eShcIkFnaWxpdHlcIiwgMjAsIEVmZmVjdFR5cGUuR29vZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBZGRBYmlsaXR5KFwiTHljYW50aHJvcHlcIiwgNTQsIFwiQXQgbmlnaHRcIiwgMCwgRWZmZWN0VHlwZS5Hb29kKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJEd2FyZnNcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1ldGVycy5Bcm1vciA9IFwiSGVhdnlcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFkZEFiaWxpdHkoXCJTcGVsbHByb29mXCIsIEVmZmVjdFR5cGUuR29vZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbWV0ZXJzLlNwZWVkID0gXCJTbG93XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiU3RlYW1wdW5rXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEF0dGFjayArPSAxMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtZXRlcnMubWF4aHAgKz0gMTAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQWRkQWJpbGl0eShcIk1hY2hpbmVyeVwiLCBFZmZlY3RUeXBlLkdvb2QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIk5ldXRyYWxzXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEF0dGFjayArPSAxMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFkZEFiaWxpdHkoXCJJbnZpc2libGVcIiwgRWZmZWN0VHlwZS5Hb29kKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAocGFyYW1ldGVycy5OYW1lID09IFwiTmV1dHJhbF93YXJyaW9yXCIgJiYgbWF4cmFjZSAhPSBcIk5ldXRyYWxzXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1ldGVycy5yZWN0LkhlaWdodCA9IDMxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChBYnNDb250YWlucyhcIkNoYW5jZV90b19mbHlcIikgJiYgTXlHYW1lLnJuZC5OZXh0RG91YmxlKCkgPiAwLjUpXHJcbiAgICAgICAgICAgICAgICBwYXJhbWV0ZXJzLm1vdmVUeXBlID0gVW5pdE1vdmVUeXBlLkZseWluZ01UO1xyXG4gICAgICAgICAgICBpZiAoc2V0SHApXHJcbiAgICAgICAgICAgICAgICBocCA9IHBhcmFtZXRlcnMubWF4aHA7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBwdWJsaWMgc3RydWN0IFdpZHRoSGVpZ2h0XHJcbiAgICB7XHJcbiAgICAgICAgW0pzb25Qcm9wZXJ0eShcIndcIildXHJcbiAgICAgICAgcHVibGljIGludCB3O1xyXG5cclxuICAgICAgICBbSnNvblByb3BlcnR5KFwiaFwiKV1cclxuICAgICAgICBwdWJsaWMgaW50IGg7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0cnVjdCBVbml0UGFyYW1ldGVycyB7XHJcbiAgICAgICAgW0pzb25Qcm9wZXJ0eShcImlkXCIpXVxyXG4gICAgICAgIHB1YmxpYyBpbnQgaWQ7XHJcblxyXG4gICAgICAgIFtKc29uUHJvcGVydHkoXCJuYW1lXCIsIERlZmF1bHRWYWx1ZUhhbmRsaW5nID0gRGVmYXVsdFZhbHVlSGFuZGxpbmcuUG9wdWxhdGUpXVxyXG4gICAgICAgIFtEZWZhdWx0VmFsdWUoXCJcIildXHJcbiAgICAgICAgcHVibGljIHN0cmluZyBOYW1lO1xyXG5cclxuICAgICAgICBbSnNvblByb3BlcnR5KFwiRGFtYWdlXCIpXVxyXG4gICAgICAgIHB1YmxpYyBBdHRhY2sgQXR0YWNrO1xyXG5cclxuICAgICAgICBbSnNvblByb3BlcnR5KFwiSGVhbHRoXCIpXVxyXG4gICAgICAgIHB1YmxpYyBpbnQgbWF4aHA7XHJcblxyXG4gICAgICAgIFtKc29uUHJvcGVydHkoXCJDb3N0XCIpXVxyXG4gICAgICAgIHB1YmxpYyBUaW1lQ29zdCBDb3N0O1xyXG5cclxuXHJcbiAgICAgICAgcHVibGljIGZsb2F0IF9hcm1vciwgX3NwZWVkO1xyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgYXJtTmljaywgc3BkTmljaztcclxuXHJcbiAgICAgICAgW0pzb25Qcm9wZXJ0eShcInJhY2VcIiwgRGVmYXVsdFZhbHVlSGFuZGxpbmcgPSBEZWZhdWx0VmFsdWVIYW5kbGluZy5Qb3B1bGF0ZSldXHJcbiAgICAgICAgW0RlZmF1bHRWYWx1ZShcIlwiKV1cclxuICAgICAgICBwdWJsaWMgc3RyaW5nIFJhY2U7XHJcbiAgICAgICAgW0pzb25Qcm9wZXJ0eShcInN1YnJhY2VcIiwgRGVmYXVsdFZhbHVlSGFuZGxpbmcgPSBEZWZhdWx0VmFsdWVIYW5kbGluZy5Qb3B1bGF0ZSldXHJcbiAgICAgICAgW0RlZmF1bHRWYWx1ZShcIlwiKV1cclxuICAgICAgICBwdWJsaWMgc3RyaW5nIFN1YnJhY2U7XHJcblxyXG4gICAgICAgIFtKc29uUHJvcGVydHkoXCJEZXNjXCIsIERlZmF1bHRWYWx1ZUhhbmRsaW5nID0gRGVmYXVsdFZhbHVlSGFuZGxpbmcuUG9wdWxhdGUpXVxyXG4gICAgICAgIFtEZWZhdWx0VmFsdWUoXCJcIildXHJcbiAgICAgICAgcHVibGljIHN0cmluZyBEZXNjcmlwdGlvbjtcclxuICAgICAgICBwdWJsaWMgYm9vbCBhbmltYXRlZDtcclxuICAgICAgICBwdWJsaWMgaW50IGltZ3gsIGltZ3k7XHJcblxyXG4gICAgICAgIHB1YmxpYyBib29sIGlzQnVpbGRpbmc7XHJcbiAgICAgICAgcHVibGljIGJvb2wgaXNJZ25vcmVVbml0cztcclxuICAgICAgICBwdWJsaWMgYm9vbCBpc0hlcm9pYztcclxuICAgICAgICBwdWJsaWMgVW5pdE1vdmVUeXBlIG1vdmVUeXBlO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgbWF4TGltaXQ7XHJcblxyXG4gICAgICAgIFtKc29uUHJvcGVydHkoXCJocEJvdHRvbVwiKV1cclxuICAgICAgICBwdWJsaWMgYm9vbCBocEJvdG9tO1xyXG5cclxuICAgICAgICBbSnNvblByb3BlcnR5KFwiUmVjdFwiKV1cclxuICAgICAgICBwdWJsaWMgV2lkdGhIZWlnaHQgc2l6ZTtcclxuXHJcbiAgICAgICAgcHVibGljIFJlY3RhbmdsZSByZWN0O1xyXG5cclxuICAgICAgICBcclxuICAgICAgICBwdWJsaWMgRGljdGlvbmFyeTxzdHJpbmcsIEFiaWxpdHk+IGFiaWxzO1xyXG5cclxuICAgICAgICBbSnNvblByb3BlcnR5KFwiQWJpbGl0ZXNcIildXHJcbiAgICAgICAgcHVibGljIExpc3Q8QWJpbGl0eT4gcmF3QWJpbHM7XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgc3ByaXRlTmFtZTtcclxuICAgICAgICBwdWJsaWMgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlIGljb25BcHA7XHJcbiAgICAgICAgW0pzb25Qcm9wZXJ0eShcImljb25cIildXHJcbiAgICAgICAgcHVibGljIGludCBpY29uSW5kO1xyXG5cclxuICAgICAgICBbSnNvblByb3BlcnR5KFwiYW1tb1wiKV1cclxuICAgICAgICBwdWJsaWMgQW1tby5BbW1vVHlwZSBhbW1vVHlwZTtcclxuXHJcbiAgICAgICAgW0pzb25Qcm9wZXJ0eShcInN1cHBvcnRcIildXHJcbiAgICAgICAgcHVibGljIGJvb2wgc3VwcG9ydDtcclxuICAgICAgICBbSnNvblByb3BlcnR5KFwidXBncmFkZVwiKV1cclxuICAgICAgICBwdWJsaWMgYm9vbCB1cGdyYWRlO1xyXG4gICAgICAgIFtKc29uUHJvcGVydHkoXCJzcGVjaWFsXCIpXVxyXG4gICAgICAgIHB1YmxpYyBib29sIHNwZWNpYWw7XHJcblxyXG4gICAgICAgIFtKc29uUHJvcGVydHkoXCJpc1N0YXJ0QnVpbGRpbmdcIildXHJcbiAgICAgICAgcHVibGljIGJvb2wgaXNTdGFydEJ1aWxkaW5nO1xyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBBYnNDb250YWlucyhzdHJpbmcgbm1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBhYmlscy5Db250YWluc0tleShubWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgTmVhcihVbml0UGFyYW1ldGVycyB1cDIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG1vdmVUeXBlID09IHVwMi5tb3ZlVHlwZSB8fCBtb3ZlVHlwZSA9PSBVbml0TW92ZVR5cGUuSHVnZU1UIHx8IHVwMi5tb3ZlVHlwZSA9PSBVbml0TW92ZVR5cGUuSHVnZU1UO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgW0pzb25Qcm9wZXJ0eShcIlNwZWVkXCIsIERlZmF1bHRWYWx1ZUhhbmRsaW5nID0gRGVmYXVsdFZhbHVlSGFuZGxpbmcuUG9wdWxhdGUpXVxyXG4gICAgICAgIFtEZWZhdWx0VmFsdWUoXCJOb3JtYWxcIildXHJcbiAgICAgICAgcHVibGljIHN0cmluZyBTcGVlZCB7XHJcbiAgICAgICAgICAgIGdldCB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc3BkTmljaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXQge1xyXG4gICAgICAgICAgICAgICAgc3BkTmljayA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgc3dpdGNoICh2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJOb25lXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9zcGVlZCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJTbG93XCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9zcGVlZCA9IDAuMTVmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiTm9ybWFsXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9zcGVlZCA9IDAuMmY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJGYXN0XCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9zcGVlZCA9IDAuM2Y7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJWZXJ5X2Zhc3RcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgX3NwZWVkID0gMC42ZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIFtKc29uUHJvcGVydHkoXCJBcm1vclwiLCBEZWZhdWx0VmFsdWVIYW5kbGluZyA9IERlZmF1bHRWYWx1ZUhhbmRsaW5nLlBvcHVsYXRlKV1cclxuICAgICAgICBbRGVmYXVsdFZhbHVlKFwiTm9uZVwiKV1cclxuICAgICAgICBwdWJsaWMgc3RyaW5nIEFybW9yIHtcclxuICAgICAgICAgICAgZ2V0IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBhcm1OaWNrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldCB7XHJcbiAgICAgICAgICAgICAgICBhcm1OaWNrID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIk5vbmVcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgX2FybW9yID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkxpZ2h0XCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hcm1vciA9IDAuNzVmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiSGVhdnlcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgX2FybW9yID0gMC41ZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkV0aGVyZWFsXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hcm1vciA9IDAuMjVmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBNaWNyb3NvZnQuWG5hLkZyYW1ld29yaztcclxuXHJcbm5hbWVzcGFjZSBEYXJrS2luZ2RvbURlc2t0b3Bcclxue1xyXG4gICAgcHVibGljIGNsYXNzIEFwcFxyXG4gICAge1xyXG5cdFx0cHJpdmF0ZSBzdGF0aWMgR2FtZSBnYW1lO1xyXG5cdFx0XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIE1haW4oKVxyXG5cdFx0e1xyXG4gICAgICAgICAgICB2YXIgY2FudmFzID0gbmV3IFJldHlwZWQuZG9tLkhUTUxDYW52YXNFbGVtZW50XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHdpZHRoID0gODAwLFxyXG4gICAgICAgICAgICAgICAgaGVpZ2h0ID0gNDgwLFxyXG4gICAgICAgICAgICAgICAgaWQgPSBcIm1vbm9nYW1lY2FudmFzXCJcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgUmV0eXBlZC5kb20uZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZDxSZXR5cGVkLmRvbS5IVE1MQ2FudmFzRWxlbWVudD4oY2FudmFzKTtcclxuXHJcbiAgICAgICAgICAgIGdhbWUgPSBuZXcgTWFpbkNsYXNzKCk7XHJcblx0XHRcdGdhbWUuUnVuKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsIlxyXG5cclxuI3JlZ2lvbiBcIlVzaW5nIFN0YXRlbWVudHNcIlxyXG51c2luZyBNaWNyb3NvZnQuWG5hLkZyYW1ld29yaztcclxudXNpbmcgTWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuR3JhcGhpY3M7XHJcbnVzaW5nIE1pY3Jvc29mdC5YbmEuRnJhbWV3b3JrLklucHV0LlRvdWNoO1xyXG4jZW5kcmVnaW9uXHJcblxyXG5cclxubmFtZXNwYWNlIERhcmtLaW5nZG9tRGVza3RvcCB7XHJcbiAgICAvLy8gPHN1bW1hcnk+XHJcbiAgICAvLy8gVGhpcyBpcyB0aGUgbWFpbiB0eXBlIGZvciB5b3VyIGdhbWVcclxuICAgIC8vLyA8L3N1bW1hcnk+XHJcbiAgICBwdWJsaWMgcGFydGlhbCBjbGFzcyBNYWluQ2xhc3MgOiBHYW1lIHtcclxuXHJcbiAgICAgICAgcHVibGljIERhcmtLaW5nZG9tQ29yZS5NeUdhbWUgZ2FtZUNsYXNzO1xyXG4gICAgICAgIHByaXZhdGUgR3JhcGhpY3NEZXZpY2VNYW5hZ2VyIGdyYXBoaWNzO1xyXG4gICAgICAgIHByaXZhdGUgU3ByaXRlQmF0Y2ggc3ByaXRlQmF0Y2g7XHJcblxyXG4gICAgICAgIC8vcHJpdmF0ZSBSZW5kZXJUYXJnZXQyRCBiYWNrQnVmZmVyO1xyXG5cclxuICAgICAgICBwdWJsaWMgTWFpbkNsYXNzKClcclxuICAgICAgICAgICAgOiBiYXNlKCkge1xyXG4gICAgICAgICAgICBncmFwaGljcyA9IG5ldyBHcmFwaGljc0RldmljZU1hbmFnZXIodGhpcylcclxuICAgICAgICAgICAge1xyXG4jaWYgQlJPV1NFUlxyXG4gICAgICAgICAgICAgICAgSGFyZHdhcmVNb2RlU3dpdGNoID0gZmFsc2VcclxuI2VuZGlmXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHN0cmluZyBwbGF0Zm9ybSA9IFwiV2luZG93c1wiO1xyXG5cclxuICAgICAgICAgICAgZ2FtZUNsYXNzID0gbmV3IERhcmtLaW5nZG9tQ29yZS5NeUdhbWUocGxhdGZvcm0pIHtcclxuICAgICAgICAgICAgICAgIGdyYXBoaWNzID0gZ3JhcGhpY3MsXHJcbiAgICAgICAgICAgICAgICBBcHBGb2xkZXIgPSBcIlwiLFxyXG4gICAgICAgICAgICAgICAgRGF0YUZvbGRlciA9IFwiQ29udGVudFwiXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBDb250ZW50LlJvb3REaXJlY3RvcnkgPSBcIkNvbnRlbnRcIjtcclxuXHJcbiAgICAgICAgICAgIGdhbWVDbGFzcy5PbkV4aXQgKz0gT25FeGl0O1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFJlc2l6ZShpbnQgdywgaW50IGgpIHtcclxuXHJcbiAgICAgICAgICAgIC8vdmFyIHNjYWxlRmFjdG9yID0gMS4wZjtcclxuXHJcbiAgICAgICAgICAgIC8vaW50IGZpbmFsVyA9IChpbnQpKHcgKiBzY2FsZUZhY3Rvcik7XHJcbiAgICAgICAgICAgIC8vaW50IGZpbmFsSCA9IChpbnQpKGggKiBzY2FsZUZhY3Rvcik7XHJcbiAgICAgICAgICAgIC8vdmFyIHVpU2NhbGUgPSAxLjBmO1xyXG4gICAgICAgICAgICAvL2lmIChmaW5hbFcgPiAxMDAwKVxyXG4gICAgICAgICAgICAvLyAgICB1aVNjYWxlID0gMS4yNWY7XHJcbiAgICAgICAgICAgIC8vaWYgKGZpbmFsVyA+IDE1MDApXHJcbiAgICAgICAgICAgIC8vICAgIHVpU2NhbGUgPSAxLjVmO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8vIDxzdW1tYXJ5PlxyXG4gICAgICAgIC8vLyBBbGxvd3MgdGhlIGdhbWUgdG8gcGVyZm9ybSBhbnkgaW5pdGlhbGl6YXRpb24gaXQgbmVlZHMgdG8gYmVmb3JlIHN0YXJ0aW5nIHRvIHJ1bi5cclxuICAgICAgICAvLy8gVGhpcyBpcyB3aGVyZSBpdCBjYW4gcXVlcnkgZm9yIGFueSByZXF1aXJlZCBzZXJ2aWNlcyBhbmQgbG9hZCBhbnkgbm9uLWdyYXBoaWNcclxuICAgICAgICAvLy8gcmVsYXRlZCBjb250ZW50LiAgQ2FsbGluZyBiYXNlLkluaXRpYWxpemUgd2lsbCBlbnVtZXJhdGUgdGhyb3VnaCBhbnkgY29tcG9uZW50c1xyXG4gICAgICAgIC8vLyBhbmQgaW5pdGlhbGl6ZSB0aGVtIGFzIHdlbGwuXHJcbiAgICAgICAgLy8vIDwvc3VtbWFyeT5cclxuICAgICAgICBwcm90ZWN0ZWQgb3ZlcnJpZGUgdm9pZCBJbml0aWFsaXplKCkge1xyXG4gICAgICAgICAgICAvLyBUT0RPOiBBZGQgeW91ciBpbml0aWFsaXphdGlvbiBsb2dpYyBoZXJlXHJcbiAgICAgICAgICAgIElzTW91c2VWaXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgVG91Y2hQYW5lbC5FbmFibGVkR2VzdHVyZXMgPSBHZXN0dXJlVHlwZS5UYXAgfCBHZXN0dXJlVHlwZS5Ib2xkO1xyXG4gICAgICAgICAgICBiYXNlLkluaXRpYWxpemUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgQXBwRm9sZGVyO1xyXG5cclxuICAgICAgICBwdWJsaWMgc3RyaW5nIERhdGFGb2xkZXI7XHJcbiAgICAgICAgLy8vIDxzdW1tYXJ5PlxyXG4gICAgICAgIC8vLyBMb2FkQ29udGVudCB3aWxsIGJlIGNhbGxlZCBvbmNlIHBlciBnYW1lIGFuZCBpcyB0aGUgcGxhY2UgdG8gbG9hZFxyXG4gICAgICAgIC8vLyBhbGwgb2YgeW91ciBjb250ZW50LlxyXG4gICAgICAgIC8vLyA8L3N1bW1hcnk+XHJcbiAgICAgICAgcHJvdGVjdGVkIG92ZXJyaWRlIHZvaWQgTG9hZENvbnRlbnQoKSB7XHJcbiAgICAgICAgICAgIC8vIENyZWF0ZSBhIG5ldyBTcHJpdGVCYXRjaCwgd2hpY2ggY2FuIGJlIHVzZWQgdG8gZHJhdyB0ZXh0dXJlcy5cclxuICAgICAgICAgICAgLy9iYWNrQnVmZmVyID0gbmV3IFJlbmRlclRhcmdldDJEKGdyYXBoaWNzLkdyYXBoaWNzRGV2aWNlLCA4MDAsIDQ4MCk7XHJcbiAgICAgICAgICAgIHNwcml0ZUJhdGNoID0gbmV3IFNwcml0ZUJhdGNoKEdyYXBoaWNzRGV2aWNlKTtcclxuICAgICAgICAgICAgZ2FtZUNsYXNzLnNwcml0ZUJhdGNoID0gc3ByaXRlQmF0Y2g7XHJcblxyXG4gICAgICAgICAgICAvL1x0UmVhZFByb2ZpbGVzKCk7XHJcbiAgICAgICAgICAgIC8vUmVhZFNwcml0ZXMoQ29udGVudCk7XHJcblxyXG4gICAgICAgICAgICAvL2ludCB0ZXN0X3cgPSA1MCwgdGVzdF9oID0gNTA7XHJcbiAgICAgICAgICAgIC8vdGVzdF90ZXh0ID0gbmV3IFRleHR1cmUyRChHcmFwaGljc0RldmljZSwgdGVzdF93LCB0ZXN0X2gpO1xyXG4gICAgICAgICAgICAvL3ZhciBmaWxsX2FyciA9IG5ldyBpbnRbdGVzdF93ICogdGVzdF9oICogNF07XHJcbiAgICAgICAgICAgIC8vZm9yICh2YXIgaSA9IDA7IGkgPCB0ZXN0X3cgKiB0ZXN0X2ggKiA0OyBpICs9IDQpXHJcbiAgICAgICAgICAgIC8ve1xyXG4gICAgICAgICAgICAvLyAgICBmaWxsX2FycltpXSA9IDI1NTtcclxuICAgICAgICAgICAgLy8gICAgZmlsbF9hcnJbaSArIDFdID0gMDtcclxuICAgICAgICAgICAgLy8gICAgZmlsbF9hcnJbaSArIDJdID0gMjU1O1xyXG4gICAgICAgICAgICAvLyAgICBmaWxsX2FycltpICsgM10gPSAxMjg7XHJcbiAgICAgICAgICAgIC8vfVxyXG4gICAgICAgICAgICAvL3Rlc3RfdGV4dC5TZXREYXRhKGZpbGxfYXJyKTtcclxuICAgICAgICAgICAgZ2FtZUNsYXNzLkxvYWREYXRhKENvbnRlbnQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8vIDxzdW1tYXJ5PlxyXG4gICAgICAgIC8vLyBVbmxvYWRDb250ZW50IHdpbGwgYmUgY2FsbGVkIG9uY2UgcGVyIGdhbWUgYW5kIGlzIHRoZSBwbGFjZSB0byB1bmxvYWRcclxuICAgICAgICAvLy8gYWxsIGNvbnRlbnQuXHJcbiAgICAgICAgLy8vIDwvc3VtbWFyeT5cclxuICAgICAgICBwcm90ZWN0ZWQgb3ZlcnJpZGUgdm9pZCBVbmxvYWRDb250ZW50KCkge1xyXG4gICAgICAgICAgICAvLyBUT0RPOiBVbmxvYWQgYW55IG5vbiBDb250ZW50TWFuYWdlciBjb250ZW50IGhlcmVcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vLyA8c3VtbWFyeT5cclxuICAgICAgICAvLy8gQWxsb3dzIHRoZSBnYW1lIHRvIHJ1biBsb2dpYyBzdWNoIGFzIHVwZGF0aW5nIHRoZSB3b3JsZCxcclxuICAgICAgICAvLy8gY2hlY2tpbmcgZm9yIGNvbGxpc2lvbnMsIGdhdGhlcmluZyBpbnB1dCwgYW5kIHBsYXlpbmcgYXVkaW8uXHJcbiAgICAgICAgLy8vIDwvc3VtbWFyeT5cclxuICAgICAgICAvLy8gPHBhcmFtIG5hbWU9XCJnYW1lVGltZVwiPlByb3ZpZGVzIGEgc25hcHNob3Qgb2YgdGltaW5nIHZhbHVlcy48L3BhcmFtPlxyXG4gICAgICAgIC8vLyBcclxuXHJcblxyXG4gICAgICAgIHByb3RlY3RlZCBvdmVycmlkZSB2b2lkIFVwZGF0ZShHYW1lVGltZSBnYW1lVGltZSkge1xyXG4gICAgICAgICAgICBpZiAoZ2FtZUNsYXNzLmlzTG9hZGVkKVxyXG4gICAgICAgICAgICAgICAgZ2FtZUNsYXNzLlVwZGF0ZSgpO1xyXG4gICAgICAgICAgICBiYXNlLlVwZGF0ZShnYW1lVGltZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLy8gPHN1bW1hcnk+XHJcbiAgICAgICAgLy8vIFRoaXMgaXMgY2FsbGVkIHdoZW4gdGhlIGdhbWUgc2hvdWxkIGRyYXcgaXRzZWxmLlxyXG4gICAgICAgIC8vLyA8L3N1bW1hcnk+XHJcbiAgICAgICAgLy8vIDxwYXJhbSBuYW1lPVwiZ2FtZVRpbWVcIj5Qcm92aWRlcyBhIHNuYXBzaG90IG9mIHRpbWluZyB2YWx1ZXMuPC9wYXJhbT5cclxuICAgICAgICBwcm90ZWN0ZWQgb3ZlcnJpZGUgdm9pZCBEcmF3KEdhbWVUaW1lIGdhbWVUaW1lKSB7XHJcbiAgICAgICAgICAgIC8vIFRPRE86IEFkZCB5b3VyIGRyYXdpbmcgY29kZSBoZXJlXHJcbiAgICAgICAgICAgIGlmIChnYW1lQ2xhc3MuaXNMb2FkZWQpIHtcclxuICAgICAgICAgICAgICAgIC8vZ3JhcGhpY3MuR3JhcGhpY3NEZXZpY2UuU2V0UmVuZGVyVGFyZ2V0KGJhY2tCdWZmZXIpO1xyXG4gICAgICAgICAgICAgICAgc3ByaXRlQmF0Y2guQmVnaW4oU3ByaXRlU29ydE1vZGUuRGVmZXJyZWQsIEJsZW5kU3RhdGUuTm9uUHJlbXVsdGlwbGllZCwgU2FtcGxlclN0YXRlLlBvaW50Q2xhbXAsIERlcHRoU3RlbmNpbFN0YXRlLkRlZmF1bHQsIFJhc3Rlcml6ZXJTdGF0ZS5DdWxsTm9uZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgZ2FtZUNsYXNzLkRyYXcoKTtcclxuICAgICAgICAgICAgICAgIC8vc3ByaXRlQmF0Y2guRW5kKCk7XHJcbiAgICAgICAgICAgICAgICAvL2dyYXBoaWNzLkdyYXBoaWNzRGV2aWNlLlNldFJlbmRlclRhcmdldChudWxsKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL3Nwcml0ZUJhdGNoLkJlZ2luKFNwcml0ZVNvcnRNb2RlLkRlZmVycmVkLCBCbGVuZFN0YXRlLk5vblByZW11bHRpcGxpZWQsIFNhbXBsZXJTdGF0ZS5Qb2ludENsYW1wLCBEZXB0aFN0ZW5jaWxTdGF0ZS5EZWZhdWx0LCBSYXN0ZXJpemVyU3RhdGUuQ3VsbE5vbmUpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vc3ByaXRlQmF0Y2guRHJhdyhiYWNrQnVmZmVyLCBuZXcgUmVjdGFuZ2xlKDAsIDAsIGdhbWVDbGFzcy5fc2NyZWVuV2lkdGgsIGdhbWVDbGFzcy5fc2NyZWVuSGVpZ2h0KSwgQ29sb3IuV2hpdGUpO1xyXG5cclxuICAgICAgICAgICAgICAgIGdhbWVDbGFzcy5EcmF3SW50ZXJmYWNlKHNwcml0ZUJhdGNoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL3Nwcml0ZUJhdGNoLkRyYXcodGVzdF90ZXh0LCBuZXcgVmVjdG9yMigxMDAsIDEwMCksIENvbG9yLldoaXRlKTtcclxuXHJcbiAgICAgICAgICAgICAgICBzcHJpdGVCYXRjaC5FbmQoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgYmFzZS5EcmF3KGdhbWVUaW1lKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIE9uRXhpdCgpIHtcclxuICAgICAgICAgICAgRXhpdCgpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgfVxyXG59IiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLlJlZmxlY3Rpb247XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcblxyXG5uYW1lc3BhY2UgTW9ub0ludGVyZmFjZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgQW5pbWF0b3Ige1xyXG4gICAgICAgIHB1YmxpYyBMaXN0PEFuaW1hdGlvbj4gQW5pbWF0aW9ucyB7IGdldDsgc2V0OyB9XHJcbiAgICAgICAgcHJpdmF0ZSBMaXN0PEFuaW1hdGlvbj4gY29tcGxldGVkID0gbmV3IExpc3Q8QW5pbWF0aW9uPigpO1xyXG5cclxuICAgICAgICBwdWJsaWMgVCBBZGRDaGlsZDxUPihUIGNoaWxkKSB3aGVyZSBUIDogQW5pbWF0aW9uIHtcclxuICAgICAgICAgICAgQW5pbWF0aW9ucy5BZGQoY2hpbGQpO1xyXG4gICAgICAgICAgICByZXR1cm4gY2hpbGQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBEbygpIHtcclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIGFuaW0gaW4gQW5pbWF0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgYW5pbS5EbygpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGFuaW0uSXNDb21wbGV0ZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkLkFkZChhbmltKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoY29tcGxldGVkLkNvdW50ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIGFuaW0gaW4gY29tcGxldGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5pbS5FbmQoKTtcclxuICAgICAgICAgICAgICAgICAgICBBbmltYXRpb25zLlJlbW92ZShhbmltKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNvbXBsZXRlZC5DbGVhcigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgQW5pbWF0b3IoKSB7XHJcbiAgICAgICAgICAgIEFuaW1hdGlvbnMgPSBuZXcgTGlzdDxBbmltYXRpb24+KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhYnN0cmFjdCBjbGFzcyBBbmltYXRpb24ge1xyXG4gICAgICAgIHB1YmxpYyBib29sIElzUnVubmluZyB7IGdldDsgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIGJvb2wgSXNDb21wbGV0ZWQgeyBnZXQ7IHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBldmVudCBBY3Rpb24gT25TdGFydDtcclxuICAgICAgICBwdWJsaWMgZXZlbnQgQWN0aW9uIE9uRW5kO1xyXG5cclxuICAgICAgICBwcml2YXRlIFRhc2tDb21wbGV0aW9uU291cmNlPG9iamVjdD4gYW5pbWF0aW9uVGFzaztcclxuXHJcbiAgICAgICAgcHVibGljIGFic3RyYWN0IHZvaWQgRG8oKTtcclxuXHJcbiAgICAgICAgcHVibGljIHZpcnR1YWwgVGFzazxvYmplY3Q+IEJlZ2luKCkge1xyXG4gICAgICAgICAgICBJc1J1bm5pbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICBJc0NvbXBsZXRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBPblN0YXJ0IT1udWxsP2dsb2JhbDo6QnJpZGdlLlNjcmlwdC5Gcm9tTGFtYmRhKCgpPT5PblN0YXJ0Lkludm9rZSgpKTpudWxsO1xyXG4gICAgICAgICAgICBhbmltYXRpb25UYXNrID0gbmV3IFRhc2tDb21wbGV0aW9uU291cmNlPG9iamVjdD4oKTtcclxuICAgICAgICAgICAgcmV0dXJuIGFuaW1hdGlvblRhc2suVGFzaztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIENvbXBsZXRlKCkge1xyXG4gICAgICAgICAgICBJc1J1bm5pbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgSXNDb21wbGV0ZWQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgRW5kKCkge1xyXG4gICAgICAgICAgICBPbkVuZCE9bnVsbD9nbG9iYWw6OkJyaWRnZS5TY3JpcHQuRnJvbUxhbWJkYSgoKT0+T25FbmQuSW52b2tlKCkpOm51bGw7XHJcbiAgICAgICAgICAgIGFuaW1hdGlvblRhc2suU2V0UmVzdWx0KG51bGwpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIEFuaW1hdGlvbihBY3Rpb24gb25TdGFydCA9IG51bGwsIEFjdGlvbiBvbkVuZCA9IG51bGwpIHtcclxuICAgICAgICAgICAgT25TdGFydCA9IG9uU3RhcnQ7XHJcbiAgICAgICAgICAgIE9uRW5kID0gb25FbmQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBjbGFzcyBOdW1iZXJBbmltYXRpb24gOiBBbmltYXRpb24ge1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBjdXJyZW50O1xyXG5cclxuICAgICAgICBwdWJsaWMgZmxvYXQgc3RhcnRWYWx1ZTtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgZW5kVmFsdWU7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IHN0ZXA7XHJcblxyXG4gICAgICAgIHB1YmxpYyBvYmplY3QgdGFyZ2V0O1xyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgcHJvcGVydHk7XHJcbiAgICAgICAgcHJpdmF0ZSBQcm9wZXJ0eUluZm8gcHJvcGVydHlJbmZvO1xyXG5cclxuXHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgRG8oKSB7XHJcbiAgICAgICAgICAgIGlmIChJc1J1bm5pbmcpIHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnQgKz0gc3RlcDtcclxuICAgICAgICAgICAgICAgIGlmICgoc3RlcCA+IDAgJiYgY3VycmVudCA+IGVuZFZhbHVlKSB8fCAoc3RlcCA8IDAgJiYgY3VycmVudCA8IGVuZFZhbHVlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnQgPSBlbmRWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBDb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4jaWYgQlJPV1NFUlxyXG4gICAgICAgICAgICAgICAgcHJvcGVydHlJbmZvLlNldFZhbHVlKHRhcmdldCwgY3VycmVudCk7XHJcbiNlbHNlXHJcbiAgICAgICAgICAgICAgICBwcm9wZXJ0eUluZm8uU2V0VmFsdWUodGFyZ2V0LCBDb252ZXJ0LkNoYW5nZVR5cGUoY3VycmVudCwgcHJvcGVydHlJbmZvLlByb3BlcnR5VHlwZSkpO1xyXG4jZW5kaWZcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIE51bWJlckFuaW1hdGlvbihzdHJpbmcgcHJvcGVydHksIGZsb2F0IHN0YXJ0LCBmbG9hdCBlbmQsIGZsb2F0IHN0ZXAsIEFjdGlvbiBvblN0YXJ0ID0gbnVsbCwgQWN0aW9uIG9uRW5kID0gbnVsbCwgb2JqZWN0IHRhcmdldCA9IG51bGwpIDogYmFzZShvblN0YXJ0LCBvbkVuZCkge1xyXG4gICAgICAgICAgICB0aGlzLnByb3BlcnR5ID0gcHJvcGVydHk7XHJcbiAgICAgICAgICAgIHN0YXJ0VmFsdWUgPSBzdGFydDtcclxuICAgICAgICAgICAgZW5kVmFsdWUgPSBlbmQ7XHJcbiAgICAgICAgICAgIHRoaXMuc3RlcCA9IHN0ZXA7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnRhcmdldCA9IHRhcmdldDtcclxuICAgICAgICAgICAgcHJvcGVydHlJbmZvID0gdGFyZ2V0IT1udWxsP3RhcmdldC5HZXRUeXBlKCkuR2V0UHJvcGVydHkocHJvcGVydHkpOihQcm9wZXJ0eUluZm8pbnVsbDtcclxuXHJcbiAgICAgICAgICAgIElzUnVubmluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICBJc0NvbXBsZXRlZCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgU2V0VGFyZ2V0KG9iamVjdCB0YXJnZXQpIHtcclxuICAgICAgICAgICAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7XHJcbiAgICAgICAgICAgIHRoaXMucHJvcGVydHlJbmZvID0gdGFyZ2V0LkdldFR5cGUoKS5HZXRQcm9wZXJ0eSh0aGlzLnByb3BlcnR5KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSBUYXNrPG9iamVjdD4gQmVnaW4oKSB7XHJcbiAgICAgICAgICAgIGN1cnJlbnQgPSBzdGFydFZhbHVlO1xyXG4gICAgICAgICAgICByZXR1cm4gYmFzZS5CZWdpbigpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2xhc3MgQmxvY2tBbmltYXRpb24gOiBBbmltYXRpb24ge1xyXG4gICAgICAgIHB1YmxpYyBlbnVtIHByb3BlcnRpZXMge1xyXG4gICAgICAgICAgICBYLCBZLCBBbHBoYVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGZsb2F0IGN1cnJlbnQ7XHJcblxyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBzdGFydFZhbHVlO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBlbmRWYWx1ZTtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgc3RlcDtcclxuXHJcbiAgICAgICAgcHVibGljIEJsb2NrIHRhcmdldDtcclxuICAgICAgICBwdWJsaWMgcHJvcGVydGllcyBwcm9wZXJ0eTtcclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIERvKCkge1xyXG4gICAgICAgICAgICBpZiAoSXNSdW5uaW5nKSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50ICs9IHN0ZXA7XHJcbiAgICAgICAgICAgICAgICBpZiAoKHN0ZXAgPiAwICYmIGN1cnJlbnQgPiBlbmRWYWx1ZSkgfHwgKHN0ZXAgPCAwICYmIGN1cnJlbnQgPCBlbmRWYWx1ZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50ID0gZW5kVmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgQ29tcGxldGUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHN3aXRjaCAocHJvcGVydHkpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIHByb3BlcnRpZXMuWDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LlggPSAoaW50KWN1cnJlbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgcHJvcGVydGllcy5ZOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQuWSA9IChpbnQpY3VycmVudDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBwcm9wZXJ0aWVzLkFscGhhOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQuQWxwaGEgPSBjdXJyZW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIEJsb2NrQW5pbWF0aW9uKHByb3BlcnRpZXMgcHJvcGVydHksIGZsb2F0IHN0YXJ0LCBmbG9hdCBlbmQsIGZsb2F0IHN0ZXAsIEFjdGlvbiBvblN0YXJ0ID0gbnVsbCwgQWN0aW9uIG9uRW5kID0gbnVsbCwgQmxvY2sgdGFyZ2V0ID0gbnVsbCkgOiBiYXNlKG9uU3RhcnQsIG9uRW5kKSB7XHJcbiAgICAgICAgICAgIHRoaXMucHJvcGVydHkgPSBwcm9wZXJ0eTtcclxuICAgICAgICAgICAgc3RhcnRWYWx1ZSA9IHN0YXJ0O1xyXG4gICAgICAgICAgICBlbmRWYWx1ZSA9IGVuZDtcclxuICAgICAgICAgICAgdGhpcy5zdGVwID0gc3RlcDtcclxuXHJcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0ID0gdGFyZ2V0O1xyXG5cclxuICAgICAgICAgICAgSXNSdW5uaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIElzQ29tcGxldGVkID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBTZXRUYXJnZXQoQmxvY2sgdGFyZ2V0KSB7XHJcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0ID0gdGFyZ2V0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIFRhc2s8b2JqZWN0PiBCZWdpbigpIHtcclxuICAgICAgICAgICAgY3VycmVudCA9IHN0YXJ0VmFsdWU7XHJcbiAgICAgICAgICAgIHJldHVybiBiYXNlLkJlZ2luKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwdWJsaWMgY2xhc3MgTGlzdEFuaW1hdGlvbiA6IEFuaW1hdGlvbiB7XHJcbiAgICAgICAgcHVibGljIExpc3Q8QW5pbWF0aW9uPiBDaGlsZHJlbjtcclxuXHJcbiAgICAgICAgaW50IF9jdXJyZW50O1xyXG5cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBEbygpIHtcclxuICAgICAgICAgICAgaWYgKElzUnVubmluZykge1xyXG4gICAgICAgICAgICAgICAgQ2hpbGRyZW5bX2N1cnJlbnRdLkRvKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoQ2hpbGRyZW5bX2N1cnJlbnRdLklzQ29tcGxldGVkKVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChfY3VycmVudCArIDEgPCBDaGlsZHJlbi5Db3VudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfY3VycmVudCsrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBDaGlsZHJlbltfY3VycmVudF0uQmVnaW4oKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgQ29tcGxldGUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIFRhc2s8b2JqZWN0PiBCZWdpbigpIHtcclxuICAgICAgICAgICAgX2N1cnJlbnQgPSAwO1xyXG4gICAgICAgICAgICBDaGlsZHJlbltfY3VycmVudF0uQmVnaW4oKTtcclxuICAgICAgICAgICAgcmV0dXJuIGJhc2UuQmVnaW4oKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBMaXN0QW5pbWF0aW9uKEFjdGlvbiBvblN0YXJ0LCBBY3Rpb24gb25FbmQpXHJcbiAgICAgICAgICAgIDogYmFzZShvblN0YXJ0LCBvbkVuZCkge1xyXG4gICAgICAgICAgICBDaGlsZHJlbiA9IG5ldyBMaXN0PEFuaW1hdGlvbj4oKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBUIEFkZENoaWxkPFQ+KFQgY2hpbGQpIHdoZXJlIFQgOiBBbmltYXRpb24ge1xyXG4gICAgICAgICAgICBDaGlsZHJlbi5BZGQoY2hpbGQpO1xyXG4gICAgICAgICAgICByZXR1cm4gY2hpbGQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBjbGFzcyBNdWx0aUFuaW1hdGlvbiA6IEFuaW1hdGlvbiB7XHJcbiAgICAgICAgcHVibGljIExpc3Q8QW5pbWF0aW9uPiBDaGlsZHJlbjtcclxuXHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgRG8oKSB7XHJcbiAgICAgICAgICAgIGlmIChJc1J1bm5pbmcpIHtcclxuICAgICAgICAgICAgICAgIGZvcmVhY2ggKHZhciBjaGlsZCBpbiBDaGlsZHJlbilcclxuICAgICAgICAgICAgICAgICAgICBjaGlsZC5EbygpO1xyXG4gICAgICAgICAgICAgICAgYm9vbCBpc0VuZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBmb3JlYWNoICh2YXIgY2hpbGQgaW4gQ2hpbGRyZW4pXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjaGlsZC5Jc0NvbXBsZXRlZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXNFbmQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGlmIChpc0VuZClcclxuICAgICAgICAgICAgICAgICAgICBDb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgVGFzazxvYmplY3Q+IEJlZ2luKCkge1xyXG4gICAgICAgICAgICBmb3JlYWNoICh2YXIgY2hpbGQgaW4gQ2hpbGRyZW4pXHJcbiAgICAgICAgICAgICAgICBjaGlsZC5CZWdpbigpO1xyXG4gICAgICAgICAgICByZXR1cm4gYmFzZS5CZWdpbigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIE11bHRpQW5pbWF0aW9uKHBhcmFtcyBBbmltYXRpb25bXSBjaGlsZHJlbilcclxuICAgICAgICAgICAgOiBiYXNlKCkge1xyXG4gICAgICAgICAgICBDaGlsZHJlbiA9IG5ldyBMaXN0PEFuaW1hdGlvbj4oKTtcclxuICAgICAgICAgICAgQ2hpbGRyZW4uQWRkUmFuZ2UoY2hpbGRyZW4pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIE11bHRpQW5pbWF0aW9uKEFjdGlvbiBvblN0YXJ0ID0gbnVsbCwgQWN0aW9uIG9uRW5kID0gbnVsbCwgcGFyYW1zIEFuaW1hdGlvbltdIGNoaWxkcmVuKVxyXG4gICAgICAgICAgICA6IGJhc2Uob25TdGFydCwgb25FbmQpIHtcclxuICAgICAgICAgICAgQ2hpbGRyZW4gPSBuZXcgTGlzdDxBbmltYXRpb24+KCk7XHJcbiAgICAgICAgICAgIENoaWxkcmVuLkFkZFJhbmdlKGNoaWxkcmVuKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBUIEFkZENoaWxkPFQ+KFQgY2hpbGQpIHdoZXJlIFQgOiBBbmltYXRpb24ge1xyXG4gICAgICAgICAgICBDaGlsZHJlbi5BZGQoY2hpbGQpO1xyXG4gICAgICAgICAgICByZXR1cm4gY2hpbGQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIE1pY3Jvc29mdC5YbmEuRnJhbWV3b3JrLkdyYXBoaWNzO1xyXG5cclxubmFtZXNwYWNlIE1vbm9JbnRlcmZhY2Vcclxue1xyXG4gICAgcHVibGljIHN0cnVjdCBBcHBlYXJhbmNlXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIFNwcml0ZSBzcHJpdGU7XHJcbiAgICAgICAgcHVibGljIGludCBpbWc7XHJcblxyXG4gICAgICAgIHB1YmxpYyBBcHBlYXJhbmNlKFNwcml0ZSBzcHJpdGUsIGludCBpbWcpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLnNwcml0ZSA9IHNwcml0ZTtcclxuICAgICAgICAgICAgdGhpcy5pbWcgPSBpbWc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBEcmF3KFNwcml0ZUJhdGNoIHNiLCBmbG9hdCB4LCBmbG9hdCB5LCBTcHJpdGVFZmZlY3RzIGVmZmVjdCA9IFNwcml0ZUVmZmVjdHMuTm9uZSwgZmxvYXQgYWxwaGEgPSAxLjBmKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgc3ByaXRlLkRyYXcoaW1nLCB4LCB5LCBzYiwgZWZmZWN0LCBhbHBoYSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBEcmF3KFNwcml0ZUJhdGNoIHNiLCBpbnQgeCwgaW50IHksIGludCB3LCBpbnQgaCwgU3ByaXRlRWZmZWN0cyBlZmZlY3QgPSBTcHJpdGVFZmZlY3RzLk5vbmUsIGZsb2F0IGFscGhhID0gMS4wZilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHNwcml0ZS5EcmF3KGltZywgeCwgeSwgdywgaCwgc2IsIGVmZmVjdCwgYWxwaGEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSIsInVzaW5nIE1pY3Jvc29mdC5YbmEuRnJhbWV3b3JrO1xyXG51c2luZyBNaWNyb3NvZnQuWG5hLkZyYW1ld29yay5HcmFwaGljcztcclxuXHJcbm5hbWVzcGFjZSBNb25vSW50ZXJmYWNlXHJcbntcclxuICAgIHB1YmxpYyBhYnN0cmFjdCBjbGFzcyBCbG9ja1xyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBDb250YWluZXIgUGFyZW50IHsgZ2V0OyBzZXQ7IH1cclxuXHJcbiAgICAgICAgcHVibGljIGludCBYIHsgZ2V0OyBzZXQ7IH1cclxuICAgICAgICBwdWJsaWMgaW50IFkgeyBnZXQ7IHNldDsgfVxyXG5cclxuICAgICAgICBwcm90ZWN0ZWQgaW50IF93O1xyXG4gICAgICAgIHByb3RlY3RlZCBpbnQgX2g7XHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgVyB7XHJcbiAgICAgICAgICAgIGdldCB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gKF93ID09IC0xICYmIFBhcmVudCAhPSBudWxsKSA/IFBhcmVudC5XIDogX3c7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0IHtcclxuICAgICAgICAgICAgICAgIF93ID0gdmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgSCB7XHJcbiAgICAgICAgICAgIGdldCB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gKF9oID09IC0xICYmIFBhcmVudCAhPSBudWxsKSA/IFBhcmVudC5IIDogX2g7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0IHtcclxuICAgICAgICAgICAgICAgIF9oID0gdmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgUmlnaHQge1xyXG4gICAgICAgICAgICBnZXQgeyByZXR1cm4gWCArIFc7IH1cclxuICAgICAgICAgICAgc2V0IHtcclxuICAgICAgICAgICAgICAgIFggPSB2YWx1ZSAtIFc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgQm90dG9tIHtcclxuICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIFkgKyBIOyB9XHJcbiAgICAgICAgICAgIHNldCB7XHJcbiAgICAgICAgICAgICAgICBZID0gdmFsdWUgLSBIO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgVmVjdG9yMiBBbGlnbm1lbnQgeyBnZXQ7IHNldDsgfVxyXG5cclxuICAgICAgICBwdWJsaWMgZmxvYXQgQWxwaGEgeyBnZXQ7IHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBib29sIFZpc2libGUgeyBnZXQ7IHNldDsgfVxyXG5cclxuICAgICAgICBwdWJsaWMgVGhlbWUgQ3VycmVudFRoZW1lIHsgZ2V0OyBzZXQ7IH1cclxuICAgICAgICBwdWJsaWMgTG9jYWxpemF0aW9uIEN1cnJlbnRMb2NhbGl6YXRpb24geyBnZXQ7IHNldDsgfVxyXG5cclxuICAgICAgICBwcm90ZWN0ZWQgaW50IF9maW5hbFgsIF9maW5hbFksIF9maW5hbFcsIF9maW5hbEg7XHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgRmluYWxYIHtcclxuICAgICAgICAgICAgZ2V0IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBfZmluYWxYO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgaW50IEZpbmFsWSB7XHJcbiAgICAgICAgICAgIGdldCB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX2ZpbmFsWTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgRmluYWxXIHtcclxuICAgICAgICAgICAgZ2V0IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBfZmluYWxXO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIGludCBGaW5hbEgge1xyXG4gICAgICAgICAgICBnZXQge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9maW5hbEg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgRmluYWxSaWdodCB7XHJcbiAgICAgICAgICAgIGdldCB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX2ZpbmFsWCArIF9maW5hbFc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgRmluYWxCb3R0b20ge1xyXG4gICAgICAgICAgICBnZXQge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9maW5hbFkgKyBfZmluYWxIO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBJc05lZWRSZWNhbGMgeyBnZXQ7IHNldDsgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdmlydHVhbCB2b2lkIENoZWNrRm9yUmVjYWxjKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChJc05lZWRSZWNhbGMpXHJcbiAgICAgICAgICAgICAgICBSZWNhbGMoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2aXJ0dWFsIHZvaWQgUmVjYWxjKClcclxuICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICBfZmluYWxXID0gX3cgPT0gLTEgPyBQYXJlbnQuRmluYWxXIDogKGludCkoVyAqIFBhcmVudC5GaW5hbENoaWxkcmVuU2NhbGVYKTtcclxuICAgICAgICAgICAgX2ZpbmFsSCA9IF9oID09IC0xID8gUGFyZW50LkZpbmFsSCA6IChpbnQpKEggKiBQYXJlbnQuRmluYWxDaGlsZHJlblNjYWxlWSk7XHJcbiAgICAgICAgICAgIF9maW5hbFggPSBQYXJlbnQuRmluYWxYICsgKGludCkoUGFyZW50LkZpbmFsQ2hpbGRyZW5TY2FsZVggKiBYICsgKFBhcmVudC5GaW5hbFcgLSBfZmluYWxXKSAqIEFsaWdubWVudC5YKTtcclxuICAgICAgICAgICAgX2ZpbmFsWSA9IFBhcmVudC5GaW5hbFkgKyAoaW50KShQYXJlbnQuRmluYWxDaGlsZHJlblNjYWxlWSAqIFkgKyAoUGFyZW50LkZpbmFsSCAtIF9maW5hbEgpICogQWxpZ25tZW50LlkpO1xyXG4gICAgICAgICAgICBJc05lZWRSZWNhbGMgPSBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBhYnN0cmFjdCB2b2lkIERyYXcoU3ByaXRlQmF0Y2ggc2IsIGZsb2F0IHBhcmVudEFscGhhID0gMS4wZik7XHJcblxyXG4gICAgICAgIHByaXZhdGUgQW5pbWF0aW9uIF9zaG93QW5pbWF0aW9uO1xyXG4gICAgICAgIHByaXZhdGUgQW5pbWF0aW9uIF9oaWRlQW5pbWF0aW9uO1xyXG5cclxuICAgICAgICBwdWJsaWMgQW5pbWF0aW9uIFNob3dBbmltYXRpb24ge1xyXG4gICAgICAgICAgICBnZXQge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9zaG93QW5pbWF0aW9uO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldCB7XHJcbiAgICAgICAgICAgICAgICBfc2hvd0FuaW1hdGlvbiA9IHZhbHVlO1xyXG5OdW1iZXJBbmltYXRpb24gbmE7ICAgICAgICAgICAgICAgIGlmICgobmEgPSBfc2hvd0FuaW1hdGlvbiBhcyBOdW1iZXJBbmltYXRpb24pICE9IG51bGwmJiBuYS50YXJnZXQgPT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICBuYS5TZXRUYXJnZXQodGhpcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBBbmltYXRpb24gSGlkZUFuaW1hdGlvbiB7XHJcbiAgICAgICAgICAgIGdldCB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX2hpZGVBbmltYXRpb247XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0IHtcclxuICAgICAgICAgICAgICAgIF9oaWRlQW5pbWF0aW9uID0gdmFsdWU7XHJcbk51bWJlckFuaW1hdGlvbiBuYTsgICAgICAgICAgICAgICAgaWYgKChuYSA9IF9oaWRlQW5pbWF0aW9uIGFzIE51bWJlckFuaW1hdGlvbikgIT0gbnVsbCYmIG5hLnRhcmdldCA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIG5hLlNldFRhcmdldCh0aGlzKTtcclxuICAgICAgICAgICAgICAgIEhpZGVBbmltYXRpb24uT25FbmQgKz0gKCkgPT4gdGhpcy5WaXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFNob3coQW5pbWF0b3IgYW5pbWF0b3IgPSBudWxsKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuVmlzaWJsZSA9PSBmYWxzZSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5WaXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGlmIChhbmltYXRvciAhPSBudWxsICYmIFNob3dBbmltYXRpb24gIT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICBhbmltYXRvci5BZGRDaGlsZDxBbmltYXRpb24+KFNob3dBbmltYXRpb24pLkJlZ2luKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBIaWRlKEFuaW1hdG9yIGFuaW1hdG9yID0gbnVsbClcclxuICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5WaXNpYmxlID09IHRydWUpXHJcbiAgICAgICAgICAgICAgICBpZiAoYW5pbWF0b3IgIT0gbnVsbCAmJiBIaWRlQW5pbWF0aW9uICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgYW5pbWF0b3IuQWRkQ2hpbGQ8QW5pbWF0aW9uPihIaWRlQW5pbWF0aW9uKS5CZWdpbigpO1xyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuVmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZpcnR1YWwgdm9pZCBBcHBseVRoZW1lKFRoZW1lIGN1cnJlbnRUaGVtZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEN1cnJlbnRUaGVtZSA9IGN1cnJlbnRUaGVtZTtcclxuICAgICAgICAgICAgSXNOZWVkUmVjYWxjID0gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2aXJ0dWFsIHZvaWQgQXBwbHlMb2NhbGl6YXRpb24oTG9jYWxpemF0aW9uIGN1cnJlbnRMb2NhbGl6YXRpb24pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBDdXJyZW50TG9jYWxpemF0aW9uID0gY3VycmVudExvY2FsaXphdGlvbjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcblxyXG5uYW1lc3BhY2UgTW9ub0ludGVyZmFjZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgTG9jYWxpemF0aW9uXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIHN0cmluZyBOYW1lIHsgZ2V0OyBzZXQ7IH1cclxuXHJcbiAgICAgICAgcmVhZG9ubHkgRGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4gX3N0cmluZ3MgPSBuZXcgRGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4oKTtcclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBMb2NhbGl6YXRpb24oc3RyaW5nIG5hbWUsIERpY3Rpb25hcnk8c3RyaW5nLCBzdHJpbmc+IHN0cmluZ3MpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBOYW1lID0gbmFtZTtcclxuICAgICAgICAgICAgX3N0cmluZ3MgPSBzdHJpbmdzO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgQWRkU3RyaW5nKHN0cmluZyBrZXksIHN0cmluZyB0ZXh0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgX3N0cmluZ3MuQWRkKGtleSwgdGV4dCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RyaW5nIEdldFN0cmluZyhzdHJpbmcga2V5KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKF9zdHJpbmdzLkNvbnRhaW5zS2V5KGtleSkpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX3N0cmluZ3Nba2V5XTtcclxuICAgICAgICAgICAgcmV0dXJuIGtleTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgR2V0U3RyaW5nKHN0cmluZyBrZXksIHBhcmFtcyBvYmplY3RbXSBhcmdzKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKF9zdHJpbmdzLkNvbnRhaW5zS2V5KGtleSkpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc3RyaW5nLkZvcm1hdChfc3RyaW5nc1trZXldLCBhcmdzKTtcclxuICAgICAgICAgICAgcmV0dXJuIGtleTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIE1pY3Jvc29mdC5YbmEuRnJhbWV3b3JrO1xyXG51c2luZyBNaWNyb3NvZnQuWG5hLkZyYW1ld29yay5HcmFwaGljcztcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIE5ld3RvbnNvZnQuSnNvbjtcclxuXHJcbm5hbWVzcGFjZSBNb25vSW50ZXJmYWNlIHtcclxuXHJcbiAgICBwdWJsaWMgY2xhc3MgU3ByaXRlIHtcclxuICAgICAgICBwdWJsaWMgVGV4dHVyZTJEIFRleHR1cmUgeyBnZXQ7IHNldDsgfVxyXG5cclxuICAgICAgICBbSnNvblByb3BlcnR5KFwibmFtZVwiKV1cclxuICAgICAgICBwdWJsaWMgc3RyaW5nIE5hbWUgeyBnZXQ7IHNldDsgfVxyXG5cclxuICAgICAgICBbSnNvblByb3BlcnR5KFwiV2lkdGhcIildXHJcbiAgICAgICAgcHVibGljIGludCBXIHsgZ2V0OyBzZXQ7IH1cclxuICAgICAgICBbSnNvblByb3BlcnR5KFwiSGVpZ2h0XCIpXVxyXG4gICAgICAgIHB1YmxpYyBpbnQgSCB7IGdldDsgc2V0OyB9XHJcblxyXG4gICAgICAgIFtKc29uUHJvcGVydHkoXCJBbmltYXRpb25zXCIpXVxyXG4gICAgICAgIHB1YmxpYyBEaWN0aW9uYXJ5PHN0cmluZywgU3lzdGVtLlZhbHVlVHVwbGU8aW50ICxpbnQgPj4gUmFuZ2VzIHsgZ2V0OyBzZXQ7IH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgRHJhdyhpbnQgaW5kLCBmbG9hdCB4LCBmbG9hdCB5LCBTcHJpdGVCYXRjaCBzYiwgU3ByaXRlRWZmZWN0cyBlZmZlY3QgPSBTcHJpdGVFZmZlY3RzLk5vbmUsIGZsb2F0IGFscGhhID0gMS4wZikge1xyXG4gICAgICAgICAgICBpZiAoYWxwaGEgIT0gMS4wZilcclxuICAgICAgICAgICAgICAgIHNiLkRyYXcoVGV4dHVyZSwgcG9zaXRpb246IG5ldyBWZWN0b3IyKHgsIHkpLCBzb3VyY2VSZWN0YW5nbGU6IFJlY3RGcm9tSW5kZXgoaW5kKSwgY29sb3I6IG5ldyBDb2xvcigxLjBmLCAxLjBmLCAxLjBmLCBhbHBoYSksIGVmZmVjdHM6IGVmZmVjdCk7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHNiLkRyYXcoVGV4dHVyZSwgcG9zaXRpb246IG5ldyBWZWN0b3IyKHgsIHkpLCBzb3VyY2VSZWN0YW5nbGU6IFJlY3RGcm9tSW5kZXgoaW5kKSwgY29sb3I6IENvbG9yLldoaXRlLCBlZmZlY3RzOiBlZmZlY3QpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgRHJhdyhpbnQgaW5kLCBpbnQgeCwgaW50IHksIGludCB3LCBpbnQgaCwgU3ByaXRlQmF0Y2ggc2IsIFNwcml0ZUVmZmVjdHMgZWZmZWN0ID0gU3ByaXRlRWZmZWN0cy5Ob25lLCBmbG9hdCBhbHBoYSA9IDEuMGYpIHtcclxuICAgICAgICAgICAgaWYgKGFscGhhICE9IDEuMGYpXHJcbiAgICAgICAgICAgICAgICBzYi5EcmF3KFRleHR1cmUsIGRlc3RpbmF0aW9uUmVjdGFuZ2xlOiBuZXcgUmVjdGFuZ2xlKHgsIHksIHcsIGgpLCBzb3VyY2VSZWN0YW5nbGU6IFJlY3RGcm9tSW5kZXgoaW5kKSwgY29sb3I6IG5ldyBDb2xvcigxLjBmLCAxLjBmLCAxLjBmLCBhbHBoYSksIGVmZmVjdHM6IGVmZmVjdCk7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHNiLkRyYXcoVGV4dHVyZSwgZGVzdGluYXRpb25SZWN0YW5nbGU6IG5ldyBSZWN0YW5nbGUoeCwgeSwgdywgaCksIHNvdXJjZVJlY3RhbmdsZTogUmVjdEZyb21JbmRleChpbmQpLCBjb2xvcjogQ29sb3IuV2hpdGUsIGVmZmVjdHM6IGVmZmVjdCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgUmVjdGFuZ2xlIFJlY3RGcm9tSW5kZXgoaW50IGluZCkge1xyXG4gICAgICAgICAgICBpbnQgY29sdW1ucyA9IFRleHR1cmUuV2lkdGggLyBXO1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFJlY3RhbmdsZSgoaW5kICUgY29sdW1ucykgKiBXLCAoaW5kIC8gY29sdW1ucykgKiBILCBXLCBIKTtcclxuICAgICAgICB9XHJcblxuICAgIFxucHJpdmF0ZSBEaWN0aW9uYXJ5PHN0cmluZywgU3lzdGVtLlZhbHVlVHVwbGU8aW50ICxpbnQgPj4gX19Qcm9wZXJ0eV9fSW5pdGlhbGl6ZXJfX1Jhbmdlcz1uZXcgRGljdGlvbmFyeTxzdHJpbmcsIFN5c3RlbS5WYWx1ZVR1cGxlPGludCAsaW50ID4+KCk7fVxyXG59XHJcbiIsInVzaW5nIE1pY3Jvc29mdC5YbmEuRnJhbWV3b3JrO1xyXG51c2luZyBNaWNyb3NvZnQuWG5hLkZyYW1ld29yay5HcmFwaGljcztcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcblxyXG5uYW1lc3BhY2UgTW9ub0ludGVyZmFjZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgVGhlbWVcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgQXBwZWFyYW5jZSBGcmFtZUJhY2tUZXh0dXJlIHsgZ2V0OyBzZXQ7IH1cclxuXHJcbiAgICAgICAgcHVibGljIEFwcGVhcmFuY2UgQnV0dG9uQmFja1RleHR1cmUgeyBnZXQ7IHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBBcHBlYXJhbmNlIEJ1dHRvbkZyb250VGV4dHVyZSB7IGdldDsgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIEFwcGVhcmFuY2UgQnV0dG9uUHJlc3NlZFRleHR1cmUgeyBnZXQ7IHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBBcHBlYXJhbmNlIEJ1dHRvbkRpc2FibGVkVGV4dHVyZSB7IGdldDsgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIEFwcGVhcmFuY2UgQnV0dG9uU2VsZWN0ZWRUZXh0dXJlIHsgZ2V0OyBzZXQ7IH1cclxuXHJcbiAgICAgICAgcHVibGljIENvbG9yIEZvbnRDb2xvciB7IGdldDsgc2V0OyB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBBcHBlYXJhbmNlIFByb2dyZXNzQmFja1RleHR1cmUgeyBnZXQ7IHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBBcHBlYXJhbmNlIFByb2dyZXNzRnJvbnRUZXh0dXJlIHsgZ2V0OyBzZXQ7IH1cclxuXHJcbiAgICAgICAgcHVibGljIEFwcGVhcmFuY2UgU3dpdGNoZXJCdXR0b25MZWZ0VGV4dHVyZSB7IGdldDsgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIEFwcGVhcmFuY2UgU3dpdGNoZXJCdXR0b25SaWdodFRleHR1cmUgeyBnZXQ7IHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBpbnQgU3dpdGNoZXJNYWluRm9udFNpemUgeyBnZXQ7IHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBDb2xvciBTd2l0Y2hlck1haW5Db2xvciB7IGdldDsgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIGludCBTd2l0Y2hlckRlc2NyaXB0aW9uRm9udFNpemUgeyBnZXQ7IHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBDb2xvciBTd2l0Y2hlckRlc2NyaXB0aW9uQ29sb3IgeyBnZXQ7IHNldDsgfVxyXG5cclxuICAgICAgICBwdWJsaWMgQXBwZWFyYW5jZVtdIE5pbmVGcmFtZUJvZGVyVGV4dHVyZSB7IGdldDsgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIEFwcGVhcmFuY2VbXSBOaW5lU2xpY2VCdXR0b25CYWNrVGV4dHVyZSB7IGdldDsgc2V0OyB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBMaXN0PFN5c3RlbS5WYWx1ZVR1cGxlPGludCAsU3ByaXRlRm9udCA+PiBGb250cyB7IGdldDsgc2V0OyB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBBcHBlYXJhbmNlIEVtcHR5VGV4dHVyZSB7IGdldDsgc2V0OyB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBTcHJpdGVGb250IEdldEZvbnQoaW50IHNpemUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IEZvbnRzLkNvdW50OyBpKyspXHJcbiAgICAgICAgICAgICAgICBpZiAoRm9udHNbaV0uSXRlbTE+PSBzaXplKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBGb250c1tpXS5JdGVtMjtcclxuICAgICAgICAgICAgcmV0dXJuIEZvbnRzW0ZvbnRzLkNvdW50IC0gMV0uSXRlbTI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgVGhlbWUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgRm9udHMgPSBuZXcgTGlzdDxTeXN0ZW0uVmFsdWVUdXBsZTxpbnQgLFNwcml0ZUZvbnQgPj4oKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVGV4dHVyZTJEIFNvbGlkQ29sb3JUZXh0dXJlKEdyYXBoaWNzRGV2aWNlIGdkLCBpbnQgciwgaW50IGcsIGludCBiLCBpbnQgYSA9IDI1NSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciB0ZXggPSBuZXcgVGV4dHVyZTJEKGdkLCAxLCAxKTtcclxuICAgICAgICAgICAgaW50W10gZGF0YSA9IHsgciwgZywgYiwgYSB9O1xyXG4gICAgICAgICAgICB0ZXguU2V0RGF0YTxpbnQ+KGRhdGEsIDAsIDEpO1xyXG4gICAgICAgICAgICByZXR1cm4gdGV4O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBBcHBlYXJhbmNlIEdldEVtcHR5QXBwKEdyYXBoaWNzRGV2aWNlIGdkKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBBcHBlYXJhbmNlKG5ldyBTcHJpdGUoKSB7IFRleHR1cmUgPSBuZXcgVGV4dHVyZTJEKGdkLCAxLCAxKSwgVyA9IDEsIEggPSAxIH0sIDApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBNaWNyb3NvZnQuWG5hLkZyYW1ld29yay5HcmFwaGljcztcclxuXHJcbm5hbWVzcGFjZSBEYXJrS2luZ2RvbUNvcmVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIEltYWdlUGFydGljbGUgOiBQYXJ0aWNsZVxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Ugc3ByaXRlUmVmO1xyXG4gICAgICAgIHB1YmxpYyBib29sIGlzTWlycm9yZWQ7XHJcblxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIFhOQURyYXcoU3ByaXRlQmF0Y2ggc2IpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBzcHJpdGVSZWYuRHJhdyhzYiwgeCwgeSwgaXNNaXJyb3JlZCA/IFNwcml0ZUVmZmVjdHMuRmxpcEhvcml6b250YWxseSA6IFNwcml0ZUVmZmVjdHMuTm9uZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgSW1hZ2VQYXJ0aWNsZShNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Ugc3ByaXRlUmVmLCBmbG9hdCB4eCwgZmxvYXQgeXksIGZsb2F0IGR4eCwgZmxvYXQgZHl5LCBpbnQgbHQsIGJvb2wgaXNNaXIgPSBmYWxzZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHggPSB4eDtcclxuICAgICAgICAgICAgeSA9IHl5O1xyXG4gICAgICAgICAgICBkeCA9IGR4eDtcclxuICAgICAgICAgICAgZHkgPSBkeXk7XHJcbiAgICAgICAgICAgIGx0aW1lID0gbHQ7XHJcbiAgICAgICAgICAgIHRoaXMuc3ByaXRlUmVmID0gc3ByaXRlUmVmO1xyXG4gICAgICAgICAgICBwVHlwZSA9IFBhclR5cGUuSW1hZ2U7XHJcbiAgICAgICAgICAgIGlzTWlycm9yZWQgPSBpc01pcjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgTWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuR3JhcGhpY3M7XHJcbnVzaW5nIE1pY3Jvc29mdC5YbmEuRnJhbWV3b3JrO1xyXG5cclxubmFtZXNwYWNlIERhcmtLaW5nZG9tQ29yZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgVGV4dFBhcnRpY2xlIDogUGFydGljbGVcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgc3RyaW5nIHN0cjtcclxuICAgICAgICBwdWJsaWMgQ29sb3IgY2xyO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBzaGlmdFg7XHJcbiAgICAgICAgcHVibGljIFNwcml0ZUZvbnQgZm9udDtcclxuXHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgWE5BRHJhdyhTcHJpdGVCYXRjaCBzYilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHNiLkRyYXdTdHJpbmcoZm9udCwgc3RyLCBuZXcgVmVjdG9yMih4ICsgc2hpZnRYLCB5KSwgY2xyKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBUZXh0UGFydGljbGUoU3ByaXRlRm9udCBmbnQsIENvbG9yIGMsIGZsb2F0IHh4LCBmbG9hdCB5eSwgZmxvYXQgZHh4LCBmbG9hdCBkeXksIGZsb2F0IGF5eSwgaW50IGx0LCBzdHJpbmcgcylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGNsciA9IGM7XHJcbiAgICAgICAgICAgIHggPSB4eDtcclxuICAgICAgICAgICAgeSA9IHl5O1xyXG4gICAgICAgICAgICBkeCA9IGR4eDtcclxuICAgICAgICAgICAgZHkgPSBkeXk7XHJcbiAgICAgICAgICAgIGx0aW1lID0gbHQ7XHJcbiAgICAgICAgICAgIGF5ID0gYXl5O1xyXG4gICAgICAgICAgICBzdHIgPSBzO1xyXG4gICAgICAgICAgICBhID0gNzY4O1xyXG4gICAgICAgICAgICBmb250ID0gZm50O1xyXG4gICAgICAgICAgICBhc3QgPSA3NjggLyBsdGltZTtcclxuICAgICAgICAgICAgcFR5cGUgPSBQYXJUeXBlLlRleHQ7XHJcbiAgICAgICAgICAgIHNoaWZ0WCA9IC1mbnQuTWVhc3VyZVN0cmluZyhzdHIpLlggLyAyO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBNaWNyb3NvZnQuWG5hLkZyYW1ld29yaztcclxudXNpbmcgTWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuR3JhcGhpY3M7XHJcbnVzaW5nIE1pY3Jvc29mdC5YbmEuRnJhbWV3b3JrLklucHV0O1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxuXHJcbm5hbWVzcGFjZSBNb25vSW50ZXJmYWNlXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBDb250YWluZXIgOiBCbG9ja1xyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBDaGlsZHJlblNjYWxlWCB7IGdldDsgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIGZsb2F0IENoaWxkcmVuU2NhbGVZIHsgZ2V0OyBzZXQ7IH1cclxuXHJcbiAgICAgICAgcHJvdGVjdGVkIGZsb2F0IF9maW5hbENoaWxkcmVuU2NhbGVYO1xyXG4gICAgICAgIHByb3RlY3RlZCBmbG9hdCBfZmluYWxDaGlsZHJlblNjYWxlWTtcclxuXHJcbiAgICAgICAgcHVibGljIGZsb2F0IEZpbmFsQ2hpbGRyZW5TY2FsZVggeyBnZXQgeyByZXR1cm4gX2ZpbmFsQ2hpbGRyZW5TY2FsZVg7IH0gfVxyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBGaW5hbENoaWxkcmVuU2NhbGVZIHsgZ2V0IHsgcmV0dXJuIF9maW5hbENoaWxkcmVuU2NhbGVZOyB9IH1cclxuXHJcbiAgICAgICAgcHVibGljIExpc3Q8QmxvY2s+IENoaWxkcmVuIHsgZ2V0OyBwcml2YXRlIHNldDsgfVxyXG5cclxuICAgICAgICBwdWJsaWMgIHZpcnR1YWwgVCBBZGRDaGlsZDxUPihUIGNoaWxkKSB3aGVyZSBUIDogQmxvY2tcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGNoaWxkLlBhcmVudCA9IHRoaXM7XHJcbiAgICAgICAgICAgIENoaWxkcmVuLkFkZChjaGlsZCk7XHJcbiAgICAgICAgICAgIHJldHVybiBjaGlsZDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIERyYXcoU3ByaXRlQmF0Y2ggc2IsIGZsb2F0IHBhcmVudEFscGhhKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKFZpc2libGUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGZvcmVhY2ggKHZhciBjaGlsZCBpbiBDaGlsZHJlbilcclxuICAgICAgICAgICAgICAgICAgICBjaGlsZC5EcmF3KHNiLCBwYXJlbnRBbHBoYSAqIEFscGhhKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIENvbnRhaW5lcihpbnQgeCwgaW50IHksIGludCB3LCBpbnQgaCwgZmxvYXQgaG9yQWxpZ24gPSAwLjVmLCBmbG9hdCB2ZXJBbGlnbiA9IDAuNWYsIGJvb2wgdmlzaWJsZSA9IHRydWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBYID0geDtcclxuICAgICAgICAgICAgWSA9IHk7XHJcbiAgICAgICAgICAgIFcgPSB3O1xyXG4gICAgICAgICAgICBIID0gaDtcclxuICAgICAgICAgICAgQ2hpbGRyZW5TY2FsZVggPSAxLjBmO1xyXG4gICAgICAgICAgICBDaGlsZHJlblNjYWxlWSA9IDEuMGY7XHJcbiAgICAgICAgICAgIEFscGhhID0gMS4wZjtcclxuICAgICAgICAgICAgQWxpZ25tZW50ID0gbmV3IFZlY3RvcjIoaG9yQWxpZ24sIHZlckFsaWduKTtcclxuICAgICAgICAgICAgVmlzaWJsZSA9IHZpc2libGU7XHJcbiAgICAgICAgICAgIENoaWxkcmVuID0gbmV3IExpc3Q8QmxvY2s+KCk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIHZpcnR1YWwgdm9pZCBDbGljayhpbnQgeCwgaW50IHksIGJvb2wgaXNUb3VjaClcclxuICAgICAgICB7IH1cclxuXHJcbiAgICAgICAgcHVibGljIHZpcnR1YWwgdm9pZCBGb2N1cygpXHJcbiAgICAgICAgeyB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2aXJ0dWFsIHZvaWQgVGFwQW5kSG9sZCgpXHJcbiAgICAgICAgeyB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIENoZWNrRm9yUmVjYWxjKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChJc05lZWRSZWNhbGMpXHJcbiAgICAgICAgICAgICAgICBSZWNhbGMoKTtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIGNoaWxkIGluIENoaWxkcmVuKVxyXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkLkNoZWNrRm9yUmVjYWxjKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBSZWNhbGMoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYmFzZS5SZWNhbGMoKTtcclxuICAgICAgICAgICAgX2ZpbmFsQ2hpbGRyZW5TY2FsZVggPSBDaGlsZHJlblNjYWxlWCAqIFBhcmVudC5GaW5hbENoaWxkcmVuU2NhbGVYO1xyXG4gICAgICAgICAgICBfZmluYWxDaGlsZHJlblNjYWxlWSA9IENoaWxkcmVuU2NhbGVZICogUGFyZW50LkZpbmFsQ2hpbGRyZW5TY2FsZVk7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKHZhciBjaGlsZCBpbiBDaGlsZHJlbilcclxuICAgICAgICAgICAgICAgIGNoaWxkLlJlY2FsYygpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgQ29udGFpbmVyIEdldENvbnRhaW5lckJ5UG9pbnQoaW50IHgsIGludCB5LCBvdXQgaW50IGZpbmFsWCwgb3V0IGludCBmaW5hbFkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoVmlzaWJsZSA9PSB0cnVlICYmXHJcbiAgICAgICAgICAgICAgICAgRmluYWxYIDw9IHggJiYgeCA8PSBGaW5hbFggKyBGaW5hbFcgJiZcclxuICAgICAgICAgICAgICAgICBGaW5hbFkgPD0geSAmJiB5IDw9IEZpbmFsWSArIEZpbmFsSClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZmluYWxYID0geCAtIEZpbmFsWDtcclxuICAgICAgICAgICAgICAgIGZpbmFsWSA9IHkgLSBGaW5hbFk7XHJcbiAgICAgICAgICAgICAgICBDb250YWluZXIgY29udCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBmb3JlYWNoICh2YXIgY2hpbGQgaW4gQ2hpbGRyZW4pXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkIGlzIENvbnRhaW5lcilcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbmludCBmWDtcbmludCBmWTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gKChDb250YWluZXIpY2hpbGQpLkdldENvbnRhaW5lckJ5UG9pbnQoeCwgeSwgb3V0IGZYLCBvdXQgZlkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYyAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbFggPSBmWDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsWSA9IGZZO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udCA9IGM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29udCA/PyB0aGlzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZpbmFsWCA9IDA7XHJcbiAgICAgICAgICAgIGZpbmFsWSA9IDA7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIEJ1dHRvbiBHZXRCdXR0b25CeUhvdEtleShLZXlzIGtleSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEJ1dHRvbiByZXN1bHQgPSBudWxsO1xyXG4gICAgICAgICAgICBmb3JlYWNoICh2YXIgY2hpbGQgaW4gQ2hpbGRyZW4pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChjaGlsZC5WaXNpYmxlKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjaGlsZCBpcyBCdXR0b24gJiYgKChCdXR0b24pY2hpbGQpLkhvdEtleSA9PSBrZXkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IChCdXR0b24pY2hpbGQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkIGlzIENvbnRhaW5lcilcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gKChDb250YWluZXIpY2hpbGQpLkdldEJ1dHRvbkJ5SG90S2V5KGtleSkgPz8gcmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgQXBwbHlUaGVtZShUaGVtZSBjdXJyZW50VGhlbWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBiYXNlLkFwcGx5VGhlbWUoY3VycmVudFRoZW1lKTtcclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIGNoaWxkIGluIENoaWxkcmVuKVxyXG4gICAgICAgICAgICAgICAgY2hpbGQuQXBwbHlUaGVtZShjdXJyZW50VGhlbWUpO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIEFwcGx5TG9jYWxpemF0aW9uKExvY2FsaXphdGlvbiBjdXJyZW50TG9jYWxpemF0aW9uKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYmFzZS5BcHBseUxvY2FsaXphdGlvbihjdXJyZW50TG9jYWxpemF0aW9uKTtcclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIGNoaWxkIGluIENoaWxkcmVuKVxyXG4gICAgICAgICAgICAgICAgY2hpbGQuQXBwbHlMb2NhbGl6YXRpb24oY3VycmVudExvY2FsaXphdGlvbik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBNaWNyb3NvZnQuWG5hLkZyYW1ld29yaztcclxudXNpbmcgTWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuR3JhcGhpY3M7XHJcblxyXG5uYW1lc3BhY2UgTW9ub0ludGVyZmFjZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgTGFiZWwgOiBCbG9ja1xyXG4gICAge1xyXG4gICAgICAgIHByaXZhdGUgc3RyaW5nIF90ZXh0O1xyXG4gICAgICAgIHByaXZhdGUgaW50IF9zaXplO1xyXG5cclxuICAgICAgICBwdWJsaWMgc3RyaW5nIFRleHRcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7IHJldHVybiBfdGV4dDsgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgX3RleHQgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgIElzTmVlZFJlY2FsYyA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGludCBTaXplXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXQgeyByZXR1cm4gX3NpemU7IH1cclxuICAgICAgICAgICAgc2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIF9zaXplID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICBJc05lZWRSZWNhbGMgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgQ29sb3I/IFRleHRDb2xvciB7IGdldDsgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIFNwcml0ZUZvbnQgRmluYWxGb250IHsgZ2V0OyBwcml2YXRlIHNldDsgfVxyXG5cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBSZWNhbGMoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgRmluYWxGb250ID0gQ3VycmVudFRoZW1lLkdldEZvbnQoKGludCkoU2l6ZSAqIFBhcmVudC5GaW5hbENoaWxkcmVuU2NhbGVZKSk7XHJcbiAgICAgICAgICAgIHZhciB3aCA9IEZpbmFsRm9udC5NZWFzdXJlU3RyaW5nKEN1cnJlbnRMb2NhbGl6YXRpb24gPT0gbnVsbCA/IFRleHQgOiBDdXJyZW50TG9jYWxpemF0aW9uLkdldFN0cmluZyhUZXh0KSk7XHJcbiAgICAgICAgICAgIF9maW5hbFcgPSBXID0gKGludCl3aC5YO1xyXG4gICAgICAgICAgICBfZmluYWxIID0gSCA9IChpbnQpd2guWTtcclxuICAgICAgICAgICAgX2ZpbmFsWCA9IFBhcmVudC5GaW5hbFggKyAoaW50KShQYXJlbnQuRmluYWxDaGlsZHJlblNjYWxlWCAqIFggKyAoUGFyZW50LkZpbmFsVyAtIF9maW5hbFcpICogQWxpZ25tZW50LlgpO1xyXG4gICAgICAgICAgICBfZmluYWxZID0gUGFyZW50LkZpbmFsWSArIChpbnQpKFBhcmVudC5GaW5hbENoaWxkcmVuU2NhbGVZICogWSArIChQYXJlbnQuRmluYWxIIC0gX2ZpbmFsSCkgKiBBbGlnbm1lbnQuWSk7XHJcbiAgICAgICAgICAgIElzTmVlZFJlY2FsYyA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgRHJhdyhTcHJpdGVCYXRjaCBzYiwgZmxvYXQgcGFyZW50QWxwaGEpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoVmlzaWJsZSAmJiAhSXNOZWVkUmVjYWxjKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdGV4dCA9IChnbG9iYWw6OkJyaWRnZS5TY3JpcHQuVG9UZW1wKFwia2V5MVwiLEN1cnJlbnRMb2NhbGl6YXRpb24pIT1udWxsP2dsb2JhbDo6QnJpZGdlLlNjcmlwdC5Gcm9tVGVtcDxMb2NhbGl6YXRpb24+KFwia2V5MVwiKS5HZXRTdHJpbmcoVGV4dCk6KHN0cmluZyludWxsKSA/PyBUZXh0O1xyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAoY2hhciBjIGluIHRleHQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFGaW5hbEZvbnQuQ2hhcmFjdGVycy5Db250YWlucyhjKSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFN5c3RlbS5Db25zb2xlLldyaXRlTGluZSh0ZXh0KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBzYi5EcmF3U3RyaW5nKEZpbmFsRm9udCwgdGV4dCwgbmV3IFZlY3RvcjIoRmluYWxYLCBGaW5hbFkpLCBuZXcgQ29sb3IoVGV4dENvbG9yID8/IEN1cnJlbnRUaGVtZS5Gb250Q29sb3IsIHBhcmVudEFscGhhICogQWxwaGEpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIExhYmVsKHN0cmluZyB0ZXh0LCBpbnQgc2l6ZSwgQ29sb3I/IGNsciA9IG51bGwsIGludCB4ID0gMCwgaW50IHkgPSAwLCBmbG9hdCBob3JBbGlnbiA9IDAuNUYsIGZsb2F0IHZlckFsaWduID0gMC41RiwgYm9vbCB2aXNpYmxlID0gdHJ1ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFggPSB4O1xyXG4gICAgICAgICAgICBZID0geTtcclxuICAgICAgICAgICAgVyA9IDA7XHJcbiAgICAgICAgICAgIEggPSAwO1xyXG4gICAgICAgICAgICBBbHBoYSA9IDEuMGY7XHJcbiAgICAgICAgICAgIEFsaWdubWVudCA9IG5ldyBWZWN0b3IyKGhvckFsaWduLCB2ZXJBbGlnbik7XHJcbiAgICAgICAgICAgIFNpemUgPSBzaXplO1xyXG4gICAgICAgICAgICBUZXh0ID0gdGV4dDtcclxuICAgICAgICAgICAgVGV4dENvbG9yID0gY2xyO1xyXG4gICAgICAgICAgICBWaXNpYmxlID0gdmlzaWJsZTtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIE1pY3Jvc29mdC5YbmEuRnJhbWV3b3JrO1xyXG51c2luZyBNaWNyb3NvZnQuWG5hLkZyYW1ld29yay5HcmFwaGljcztcclxuXHJcblxyXG5uYW1lc3BhY2UgTW9ub0ludGVyZmFjZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgUGljdHVyZSA6IEJsb2NrXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIEFwcGVhcmFuY2Ugc3ByaXRlUmVmIHsgZ2V0OyBzZXQ7IH1cclxuXHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgRHJhdyhTcHJpdGVCYXRjaCBzYiwgZmxvYXQgcGFyZW50QWxwaGEpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoVmlzaWJsZSlcclxuICAgICAgICAgICAgICAgIHNwcml0ZVJlZi5EcmF3KHNiLCBGaW5hbFgsIEZpbmFsWSwgRmluYWxXLCBGaW5hbEgsIGFscGhhOiBwYXJlbnRBbHBoYSAqIEFscGhhKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBQaWN0dXJlKEFwcGVhcmFuY2Ugc3ByaXRlUmVmLCBpbnQgeCA9IDAsIGludCB5ID0gMCwgaW50IHcgPSAwLCBpbnQgaCA9IDAsIGZsb2F0IGhvckFsaWduID0gMC41ZiwgZmxvYXQgdmVyQWxpZ24gPSAwLjVmLCBib29sIHZpc2libGUgPSB0cnVlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5zcHJpdGVSZWYgPSBzcHJpdGVSZWY7XHJcbiAgICAgICAgICAgIFggPSB4O1xyXG4gICAgICAgICAgICBZID0geTtcclxuICAgICAgICAgICAgQWxwaGEgPSAxLjBmO1xyXG4gICAgICAgICAgICBpZiAodyA9PSAwKVxyXG4gICAgICAgICAgICAgICAgVyA9IHNwcml0ZVJlZi5zcHJpdGUuVztcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgVyA9IHc7XHJcbiAgICAgICAgICAgIGlmIChoID09IDApIFxyXG4gICAgICAgICAgICAgICAgSCA9IHNwcml0ZVJlZi5zcHJpdGUuSDsgXHJcbiAgICAgICAgICAgIGVsc2UgXHJcbiAgICAgICAgICAgICAgICBIID0gaDtcclxuICAgICAgICAgICAgQWxpZ25tZW50ID0gbmV3IFZlY3RvcjIoaG9yQWxpZ24sIHZlckFsaWduKTtcclxuICAgICAgICAgICBcclxuICAgICAgICAgICAgVmlzaWJsZSA9IHZpc2libGU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBBcHBseVRoZW1lKFRoZW1lIGN1cnJlbnRUaGVtZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEN1cnJlbnRUaGVtZSA9IGN1cnJlbnRUaGVtZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgTWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuR3JhcGhpY3M7XHJcblxyXG5uYW1lc3BhY2UgTW9ub0ludGVyZmFjZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgUHJvZ3Jlc3MgOiBCbG9ja1xyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBkb3VibGUgQ3VycmVudFZhbHVlIHsgZ2V0OyBzZXQ7IH1cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBkb3VibGUgTWF4VmFsdWUgeyBnZXQ7IHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBkb3VibGUgU3RlcCB7IGdldDsgc2V0OyB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIERyYXcoU3ByaXRlQmF0Y2ggc2IsIGZsb2F0IHBhcmVudEFscGhhKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKFZpc2libGUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEN1cnJlbnRUaGVtZS5Qcm9ncmVzc0JhY2tUZXh0dXJlLkRyYXcoc2IsIEZpbmFsWCwgRmluYWxZLCBGaW5hbFcsIEZpbmFsSCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoTWF4VmFsdWUgPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgIEN1cnJlbnRUaGVtZS5Qcm9ncmVzc0Zyb250VGV4dHVyZS5EcmF3KHNiLCBGaW5hbFgsIEZpbmFsWSwgKGludCkoRmluYWxXICogKEN1cnJlbnRWYWx1ZSAvIE1heFZhbHVlKSksIEZpbmFsSCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBQcm9ncmVzcyhkb3VibGUgY3VyVmFsdWUsIGRvdWJsZSBtYXhWYWx1ZSwgaW50IHgsIGludCB5LCBpbnQgdywgaW50IGgsIGRvdWJsZSBzdGVwLCBib29sIHZpc2libGUgPSB0cnVlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgWCA9IHg7XHJcbiAgICAgICAgICAgIFkgPSB5O1xyXG4gICAgICAgICAgICBXID0gdztcclxuICAgICAgICAgICAgSCA9IGg7XHJcbiAgICAgICAgICAgIE1heFZhbHVlID0gbWF4VmFsdWU7XHJcbiAgICAgICAgICAgIEN1cnJlbnRWYWx1ZSA9IGN1clZhbHVlO1xyXG4gICAgICAgICAgICBTdGVwID0gc3RlcDtcclxuICAgICAgICAgICAgVmlzaWJsZSA9IHZpc2libGU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBBcHBseVRoZW1lKFRoZW1lIGN1cnJlbnRUaGVtZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEN1cnJlbnRUaGVtZSA9IGN1cnJlbnRUaGVtZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxufVxyXG4iLCJ1c2luZyBNaWNyb3NvZnQuWG5hLkZyYW1ld29yay5HcmFwaGljcztcclxudXNpbmcgTWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuSW5wdXQ7XHJcbnVzaW5nIFN5c3RlbTtcclxuXHJcbm5hbWVzcGFjZSBNb25vSW50ZXJmYWNlXHJcbntcclxuXHJcbiAgICBwdWJsaWMgY2xhc3MgQnV0dG9uIDogQ29udGFpbmVyXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIGJvb2wgSXNIaWdobGlnaHRlZCB7IGdldDsgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIGJvb2wgSXNQcmVzc2VkIHsgZ2V0OyBzZXQ7IH1cclxuICAgICAgICBwdWJsaWMgYm9vbCBJc0Rpc2FibGVkIHsgZ2V0OyBzZXQ7IH1cclxuICAgICAgICBwdWJsaWMgYm9vbCBJc1NlbGVjdGVkIHsgZ2V0OyBzZXQ7IH1cclxuXHJcbiAgICAgICAgcHVibGljIGV2ZW50IEFjdGlvbjxCdXR0b24sIGJvb2w+IE9uQ2xpY2s7XHJcbiAgICAgICAgcHVibGljIGV2ZW50IEFjdGlvbjxCdXR0b24sIGJvb2w+IE9uRm9jdXM7XHJcblxyXG4gICAgICAgIHB1YmxpYyBLZXlzIEhvdEtleSB7IGdldDsgc2V0OyB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIERyYXcoU3ByaXRlQmF0Y2ggc2IsIGZsb2F0IHBhcmVudEFscGhhKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKFZpc2libGUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIChCYWNrVGV4dHVyZSA/PyBDdXJyZW50VGhlbWUuQnV0dG9uQmFja1RleHR1cmUpLkRyYXcoc2IsIEZpbmFsWCwgRmluYWxZLCBGaW5hbFcsIEZpbmFsSCwgYWxwaGE6IHBhcmVudEFscGhhICogQWxwaGEpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChJc1NlbGVjdGVkKVxyXG4gICAgICAgICAgICAgICAgICAgIChTZWxlY3RlZFRleHR1cmUgPz8gQ3VycmVudFRoZW1lLkJ1dHRvblNlbGVjdGVkVGV4dHVyZSkuRHJhdyhzYiwgRmluYWxYLCBGaW5hbFksIEZpbmFsVywgRmluYWxILCBhbHBoYTogcGFyZW50QWxwaGEgKiBBbHBoYSk7XHJcblxyXG4gICAgICAgICAgICAgICAgYmFzZS5EcmF3KHNiLCBwYXJlbnRBbHBoYSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoSXNEaXNhYmxlZClcclxuICAgICAgICAgICAgICAgICAgICAoRGlzYWJsZWRUZXh0dXJlID8/IEN1cnJlbnRUaGVtZS5CdXR0b25EaXNhYmxlZFRleHR1cmUpLkRyYXcoc2IsIEZpbmFsWCwgRmluYWxZLCBGaW5hbFcsIEZpbmFsSCwgYWxwaGE6IHBhcmVudEFscGhhICogQWxwaGEpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChJc0hpZ2hsaWdodGVkKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIChGcm9udFRleHR1cmUgPz8gQ3VycmVudFRoZW1lLkJ1dHRvbkZyb250VGV4dHVyZSkuRHJhdyhzYiwgRmluYWxYLCBGaW5hbFksIEZpbmFsVywgRmluYWxILCBhbHBoYTogcGFyZW50QWxwaGEgKiBBbHBoYSk7XHJcbiAgICAgICAgICAgICAgICAgICAgSXNIaWdobGlnaHRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKElzUHJlc3NlZClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAoRnJvbnRUZXh0dXJlID8/IEN1cnJlbnRUaGVtZS5CdXR0b25Gcm9udFRleHR1cmUpLkRyYXcoc2IsIEZpbmFsWCwgRmluYWxZLCBGaW5hbFcsIEZpbmFsSCwgYWxwaGE6IHBhcmVudEFscGhhICogQWxwaGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIElzUHJlc3NlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIEJ1dHRvbihBY3Rpb248QnV0dG9uLCBib29sPiBvbkNsaWNrLCBpbnQgeCwgaW50IHksIGludCB3LCBpbnQgaCwgZmxvYXQgaG9yQWxpZ24gPSAwLjVmLCBmbG9hdCB2ZXJBbGlnbiA9IDAuNWYsIGJvb2wgdmlzaWJsZSA9IHRydWUpXHJcbiAgICAgICAgICAgIDogYmFzZSh4LCB5LCB3LCBoLCBob3JBbGlnbiwgdmVyQWxpZ24sIHZpc2libGUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBPbkNsaWNrID0gb25DbGljaztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBCdXR0b24oQWN0aW9uPEJ1dHRvbiwgYm9vbD4gb25DbGljaywgS2V5cyBob3RrZXksIGludCB4LCBpbnQgeSwgaW50IHcsIGludCBoLCBmbG9hdCBob3JBbGlnbiA9IDAuNWYsIGZsb2F0IHZlckFsaWduID0gMC41ZiwgYm9vbCB2aXNpYmxlID0gdHJ1ZSlcclxuICAgICAgICAgICAgOiBiYXNlKHgsIHksIHcsIGgsIGhvckFsaWduLCB2ZXJBbGlnbiwgdmlzaWJsZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIE9uQ2xpY2sgPSBvbkNsaWNrO1xyXG4gICAgICAgICAgICBIb3RLZXkgPSBob3RrZXk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgQnV0dG9uKEFjdGlvbjxCdXR0b24sIGJvb2w+IG9uQ2xpY2ssIEFjdGlvbjxCdXR0b24sIGJvb2w+IG9uRm9jdXMsIGludCB4LCBpbnQgeSwgaW50IHcsIGludCBoLCBmbG9hdCBob3JBbGlnbiA9IDAuNWYsIGZsb2F0IHZlckFsaWduID0gMC41ZiwgYm9vbCB2aXNpYmxlID0gdHJ1ZSlcclxuICAgICAgICAgICAgOiBiYXNlKHgsIHksIHcsIGgsIGhvckFsaWduLCB2ZXJBbGlnbiwgdmlzaWJsZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIE9uQ2xpY2sgPSBvbkNsaWNrO1xyXG4gICAgICAgICAgICBPbkZvY3VzID0gb25Gb2N1cztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBCdXR0b24oQWN0aW9uPEJ1dHRvbiwgYm9vbD4gb25DbGljaywgQWN0aW9uPEJ1dHRvbiwgYm9vbD4gb25Gb2N1cywgS2V5cyBob3RrZXksIGludCB4LCBpbnQgeSwgaW50IHcsIGludCBoLCBmbG9hdCBob3JBbGlnbiA9IDAuNWYsIGZsb2F0IHZlckFsaWduID0gMC41ZiwgYm9vbCB2aXNpYmxlID0gdHJ1ZSlcclxuICAgICAgICAgICAgOiBiYXNlKHgsIHksIHcsIGgsIGhvckFsaWduLCB2ZXJBbGlnbiwgdmlzaWJsZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIE9uQ2xpY2sgPSBvbkNsaWNrO1xyXG4gICAgICAgICAgICBPbkZvY3VzID0gb25Gb2N1cztcclxuICAgICAgICAgICAgSG90S2V5ID0gaG90a2V5O1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIENsaWNrKGludCB4LCBpbnQgeSwgYm9vbCBpc1RvdWNoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKCFJc0Rpc2FibGVkKVxyXG4gICAgICAgICAgICAgICAgT25DbGljayE9bnVsbD9nbG9iYWw6OkJyaWRnZS5TY3JpcHQuRnJvbUxhbWJkYSgoKT0+T25DbGljay5JbnZva2UodGhpcywgaXNUb3VjaCkpOm51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBGb2N1cygpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBPbkZvY3VzIT1udWxsP2dsb2JhbDo6QnJpZGdlLlNjcmlwdC5Gcm9tTGFtYmRhKCgpPT5PbkZvY3VzLkludm9rZSh0aGlzLCBmYWxzZSkpOm51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBUYXBBbmRIb2xkKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIE9uRm9jdXMhPW51bGw/Z2xvYmFsOjpCcmlkZ2UuU2NyaXB0LkZyb21MYW1iZGEoKCk9Pk9uRm9jdXMuSW52b2tlKHRoaXMsIHRydWUpKTpudWxsO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBBcHBlYXJhbmNlPyBCYWNrVGV4dHVyZSB7IGdldDsgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIEFwcGVhcmFuY2U/IEZyb250VGV4dHVyZSB7IGdldDsgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIEFwcGVhcmFuY2U/IFByZXNzZWRUZXh0dXJlIHsgZ2V0OyBzZXQ7IH1cclxuICAgICAgICBwdWJsaWMgQXBwZWFyYW5jZT8gRGlzYWJsZWRUZXh0dXJlIHsgZ2V0OyBzZXQ7IH1cclxuICAgICAgICBwdWJsaWMgQXBwZWFyYW5jZT8gU2VsZWN0ZWRUZXh0dXJlIHsgZ2V0OyBzZXQ7IH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBNaWNyb3NvZnQuWG5hLkZyYW1ld29yay5HcmFwaGljcztcclxuXHJcbm5hbWVzcGFjZSBNb25vSW50ZXJmYWNlXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBGcmFtZSA6IENvbnRhaW5lclxyXG4gICAge1xyXG5cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBEcmF3KFNwcml0ZUJhdGNoIHNiLCBmbG9hdCBwYXJlbnRBbHBoYSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChWaXNpYmxlKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoQ3VycmVudFRoZW1lLk5pbmVGcmFtZUJvZGVyVGV4dHVyZSAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGludCB0b3BzaGlmdCA9IDEyLCBib3R0b21zaGlmdCA9IDEyLCBsZWZ0c2hpZnQgPSAxMiwgcmlnaHRzaGlmdCA9IDEyO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghVG9wQm9yZGVyKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3BzaGlmdCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFCb3R0b21Cb3JkZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJvdHRvbXNoaWZ0ID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIUxlZnRCb3JkZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnRzaGlmdCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFSaWdodEJvcmRlcilcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmlnaHRzaGlmdCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKFRvcEJvcmRlciAmJiBMZWZ0Qm9yZGVyKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBDdXJyZW50VGhlbWUuTmluZUZyYW1lQm9kZXJUZXh0dXJlWzBdLkRyYXcoc2IsIEZpbmFsWCAtIDEyLCBGaW5hbFkgLSAxMiwgMjQsIDI0LCBhbHBoYTogcGFyZW50QWxwaGEgKiBBbHBoYSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKFRvcEJvcmRlcilcclxuICAgICAgICAgICAgICAgICAgICAgICAgQ3VycmVudFRoZW1lLk5pbmVGcmFtZUJvZGVyVGV4dHVyZVsxXS5EcmF3KHNiLCBGaW5hbFggKyBsZWZ0c2hpZnQsIEZpbmFsWSAtIDEyLCBGaW5hbFcgLSBsZWZ0c2hpZnQgLSByaWdodHNoaWZ0LCAyNCwgYWxwaGE6IHBhcmVudEFscGhhICogQWxwaGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChUb3BCb3JkZXIgJiYgUmlnaHRCb3JkZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEN1cnJlbnRUaGVtZS5OaW5lRnJhbWVCb2RlclRleHR1cmVbMl0uRHJhdyhzYiwgRmluYWxYICsgRmluYWxXIC0gMTIsIEZpbmFsWSAtIDEyLCAyNCwgMjQsIGFscGhhOiBwYXJlbnRBbHBoYSAqIEFscGhhKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoTGVmdEJvcmRlcilcclxuICAgICAgICAgICAgICAgICAgICAgICAgQ3VycmVudFRoZW1lLk5pbmVGcmFtZUJvZGVyVGV4dHVyZVszXS5EcmF3KHNiLCBGaW5hbFggLSAxMiwgRmluYWxZICsgdG9wc2hpZnQsIDI0LCBGaW5hbEggLSBib3R0b21zaGlmdCAtIHRvcHNoaWZ0LCBhbHBoYTogcGFyZW50QWxwaGEgKiBBbHBoYSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIEN1cnJlbnRUaGVtZS5OaW5lRnJhbWVCb2RlclRleHR1cmVbNF0uRHJhdyhzYiwgRmluYWxYICsgbGVmdHNoaWZ0LCBGaW5hbFkgKyB0b3BzaGlmdCwgRmluYWxXIC0gbGVmdHNoaWZ0IC0gcmlnaHRzaGlmdCwgRmluYWxIIC0gYm90dG9tc2hpZnQgLSB0b3BzaGlmdCwgYWxwaGE6IHBhcmVudEFscGhhICogQWxwaGEpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoUmlnaHRCb3JkZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEN1cnJlbnRUaGVtZS5OaW5lRnJhbWVCb2RlclRleHR1cmVbNV0uRHJhdyhzYiwgRmluYWxYICsgRmluYWxXIC0gMTIsIEZpbmFsWSArIHRvcHNoaWZ0LCAyNCwgRmluYWxIIC0gYm90dG9tc2hpZnQgLSB0b3BzaGlmdCwgYWxwaGE6IHBhcmVudEFscGhhICogQWxwaGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChCb3R0b21Cb3JkZXIgJiYgTGVmdEJvcmRlcilcclxuICAgICAgICAgICAgICAgICAgICAgICAgQ3VycmVudFRoZW1lLk5pbmVGcmFtZUJvZGVyVGV4dHVyZVs2XS5EcmF3KHNiLCBGaW5hbFggLSAxMiwgRmluYWxZICsgRmluYWxIIC0gMTIsIDI0LCAyNCwgYWxwaGE6IHBhcmVudEFscGhhICogQWxwaGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChCb3R0b21Cb3JkZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEN1cnJlbnRUaGVtZS5OaW5lRnJhbWVCb2RlclRleHR1cmVbN10uRHJhdyhzYiwgRmluYWxYICsgbGVmdHNoaWZ0LCBGaW5hbFkgKyBGaW5hbEggLSAxMiwgRmluYWxXIC0gbGVmdHNoaWZ0IC0gcmlnaHRzaGlmdCwgMjQsIGFscGhhOiBwYXJlbnRBbHBoYSAqIEFscGhhKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoQm90dG9tQm9yZGVyICYmIFJpZ2h0Qm9yZGVyKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBDdXJyZW50VGhlbWUuTmluZUZyYW1lQm9kZXJUZXh0dXJlWzhdLkRyYXcoc2IsIEZpbmFsWCArIEZpbmFsVyAtIDEyLCBGaW5hbFkgKyBGaW5hbEggLSAxMiwgMjQsIDI0LCBhbHBoYTogcGFyZW50QWxwaGEgKiBBbHBoYSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgKEJhY2tUZXh0dXJlID8/IEN1cnJlbnRUaGVtZS5GcmFtZUJhY2tUZXh0dXJlKS5EcmF3KHNiLCBGaW5hbFgsIEZpbmFsWSwgRmluYWxXLCBGaW5hbEgsIGFscGhhOiBwYXJlbnRBbHBoYSAqIEFscGhhKTsgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgYmFzZS5EcmF3KHNiLCBwYXJlbnRBbHBoYSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBib29sIFRvcEJvcmRlciB7IGdldDsgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIGJvb2wgTGVmdEJvcmRlciB7IGdldDsgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIGJvb2wgUmlnaHRCb3JkZXIgeyBnZXQ7IHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBib29sIEJvdHRvbUJvcmRlciB7IGdldDsgc2V0OyB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBGcmFtZShpbnQgeCwgaW50IHksIGludCB3LCBpbnQgaCwgZmxvYXQgaG9yQWxpZ24gPSAwLjVmLCBmbG9hdCB2ZXJBbGlnbiA9IDAuNWYsIGJvb2wgdmlzaWJsZSA9IHRydWUpXHJcbiAgICAgICAgICAgIDogYmFzZSh4LCB5LCB3LCBoLCBob3JBbGlnbiwgdmVyQWxpZ24sIHZpc2libGUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBUb3BCb3JkZXIgPSB0cnVlO1xyXG4gICAgICAgICAgICBMZWZ0Qm9yZGVyID0gdHJ1ZTtcclxuICAgICAgICAgICAgUmlnaHRCb3JkZXIgPSB0cnVlO1xyXG4gICAgICAgICAgICBCb3R0b21Cb3JkZXIgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIEFwcGVhcmFuY2U/IEJhY2tUZXh0dXJlIHsgZ2V0OyBzZXQ7IH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW0uTGlucTtcclxuXHJcbm5hbWVzcGFjZSBNb25vSW50ZXJmYWNlXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBHcmlkIDogQ29udGFpbmVyXHJcbiAgICB7XHJcblxyXG4gICAgICAgIHB1YmxpYyBlbnVtIE9yaWVudGF0aW9uc1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgTGVmdFRvUmlnaHQsXHJcbiAgICAgICAgICAgIFRvcFRvQm90dG9tXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgT3JpZW50YXRpb25zIE9yaWVudGF0aW9uIHsgZ2V0OyBzZXQ7IH1cclxuXHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIFQgQWRkQ2hpbGQ8VD4oVCBjaGlsZClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChDaGlsZHJlbi5Db3VudCA+IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGludCBjWCA9IGNoaWxkLlg7XHJcbiAgICAgICAgICAgICAgICBpbnQgY1kgPSBjaGlsZC5ZO1xyXG4gICAgICAgICAgICAgICAgaWYgKE9yaWVudGF0aW9uID09IE9yaWVudGF0aW9ucy5MZWZ0VG9SaWdodClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBjWCA9IFN5c3RlbS5MaW5xLkVudW1lcmFibGUuTGFzdDxCbG9jaz4oQ2hpbGRyZW4pLlJpZ2h0ICsgY2hpbGQuWDtcclxuICAgICAgICAgICAgICAgICAgICBjWSA9IFN5c3RlbS5MaW5xLkVudW1lcmFibGUuTGFzdDxCbG9jaz4oQ2hpbGRyZW4pLlk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNYICsgY2hpbGQuVyA+IFcpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjWCA9IGNoaWxkLlg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNZID0gU3lzdGVtLkxpbnEuRW51bWVyYWJsZS5MYXN0PEJsb2NrPihDaGlsZHJlbikuQm90dG9tICsgY2hpbGQuWTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChPcmllbnRhdGlvbiA9PSBPcmllbnRhdGlvbnMuVG9wVG9Cb3R0b20pXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgY1ggPSBjaGlsZC5YO1xyXG4gICAgICAgICAgICAgICAgICAgIGNZID0gU3lzdGVtLkxpbnEuRW51bWVyYWJsZS5MYXN0PEJsb2NrPihDaGlsZHJlbikuQm90dG9tICsgY2hpbGQuWTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY1kgKyBjaGlsZC5IID4gSClcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNYID0gU3lzdGVtLkxpbnEuRW51bWVyYWJsZS5MYXN0PEJsb2NrPihDaGlsZHJlbikuUmlnaHQgKyBjaGlsZC5YO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjWSA9IFN5c3RlbS5MaW5xLkVudW1lcmFibGUuTGFzdDxCbG9jaz4oQ2hpbGRyZW4pLlk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY2hpbGQuWCA9IGNYO1xyXG4gICAgICAgICAgICAgICAgY2hpbGQuWSA9IGNZO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBiYXNlLkFkZENoaWxkPFQ+KGNoaWxkKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgXHJcbiAgICAgICAgcHVibGljIEdyaWQoT3JpZW50YXRpb25zIG9yaWVudGF0aW9uLCBpbnQgeCwgaW50IHksIGludCB3LCBpbnQgaCwgZmxvYXQgaG9yQWxpZ24gPSAwLjVmLCBmbG9hdCB2ZXJBbGlnbiA9IDAuNWYsIGJvb2wgdmlzaWJsZSA9IHRydWUpXHJcbiAgICAgICAgICAgIDogYmFzZSh4LCB5LCB3LCBoLCBob3JBbGlnbiwgdmVyQWxpZ24sIHZpc2libGUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBPcmllbnRhdGlvbiA9IG9yaWVudGF0aW9uO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBNaWNyb3NvZnQuWG5hLkZyYW1ld29yaztcclxudXNpbmcgTWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuR3JhcGhpY3M7XHJcblxyXG5uYW1lc3BhY2UgTW9ub0ludGVyZmFjZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgTG9uZ0xhYmVsIDogQ29udGFpbmVyXHJcbiAgICB7XHJcbiAgICAgICAgcHJpdmF0ZSBzdHJpbmcgX3RleHQ7XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgVGV4dFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIF90ZXh0OyB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBfdGV4dCA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgSXNOZWVkUmVjYWxjID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgUmVjYWxjKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEZpbmFsRm9udCA9IEN1cnJlbnRUaGVtZS5HZXRGb250KF9zaXplKTtcclxuICAgICAgICAgICAgQ2hpbGRyZW4uQ2xlYXIoKTtcclxuICAgICAgICAgICAgc3RyaW5nIGxvY2FsaXplZFRleHQgPSBDdXJyZW50TG9jYWxpemF0aW9uICE9IG51bGwgPyBDdXJyZW50TG9jYWxpemF0aW9uLkdldFN0cmluZyhfdGV4dCkgOiBfdGV4dDtcclxuICAgICAgICAgICAgc3RyaW5nW10gdGV4dHMgPSBsb2NhbGl6ZWRUZXh0LlNwbGl0KCcgJyk7XHJcbiAgICAgICAgICAgIHN0cmluZyBjdXJ0ZXh0ID0gXCJcIjtcclxuICAgICAgICAgICAgaW50IGxpbmVIID0gKGludClGaW5hbEZvbnQuTWVhc3VyZVN0cmluZyhsb2NhbGl6ZWRUZXh0KS5ZO1xyXG4gICAgICAgICAgICBpbnQgdG90YWxMaW5lcyA9IDA7XHJcbiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdGV4dHMuTGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChGaW5hbEZvbnQuTWVhc3VyZVN0cmluZyhjdXJ0ZXh0ICsgJyAnICsgdGV4dHNbaV0pLlggPiBXICYmIGkgPiAwKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuQWRkQ2hpbGQ8TGFiZWw+KG5ldyBMYWJlbChjdXJ0ZXh0LCBTaXplLCBUZXh0Q29sb3IsIHk6IHRvdGFsTGluZXMgKiBsaW5lSCwgaG9yQWxpZ246IEFsaWdubWVudC5YLCB2ZXJBbGlnbjogMC4wZikpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsTGluZXMgKz0gMTtcclxuICAgICAgICAgICAgICAgICAgICBjdXJ0ZXh0ID0gdGV4dHNbaV0gKyAnICc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgY3VydGV4dCArPSB0ZXh0c1tpXSArICcgJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLkFkZENoaWxkPExhYmVsPihuZXcgTGFiZWwoY3VydGV4dC5UcmltKCksIFNpemUsIFRleHRDb2xvciwgeTogdG90YWxMaW5lcyAqIGxpbmVILCBob3JBbGlnbjogQWxpZ25tZW50LlgsIHZlckFsaWduOiAwLjBmKSk7XHJcbiAgICAgICAgICAgIHRvdGFsTGluZXMgKz0gMTtcclxuICAgICAgICAgICAgSCA9ICh0b3RhbExpbmVzICogbGluZUgpO1xyXG4gICAgICAgICAgICBiYXNlLkFwcGx5VGhlbWUoQ3VycmVudFRoZW1lKTtcclxuICAgICAgICAgICAgYmFzZS5SZWNhbGMoKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgQ29sb3I/IFRleHRDb2xvciB7IGdldDsgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIFNwcml0ZUZvbnQgRmluYWxGb250IHsgZ2V0OyBwcml2YXRlIHNldDsgfVxyXG4gICAgICAgIHByaXZhdGUgaW50IF9zaXplO1xyXG5cclxuICAgICAgICBwdWJsaWMgaW50IFNpemVcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7IHJldHVybiBfc2l6ZTsgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgX3NpemUgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgIElzTmVlZFJlY2FsYyA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBMb25nTGFiZWwoc3RyaW5nIHRleHQsIGludCBzaXplLCBDb2xvcj8gY2xyID0gbnVsbCwgaW50IHggPSAwLCBpbnQgeSA9IDAsIGludCB3ID0gMCwgZmxvYXQgaG9yQWxpZ24gPSAwLjVGLCBmbG9hdCB2ZXJBbGlnbiA9IDAuNUYsIGJvb2wgdmlzaWJsZSA9IHRydWUpXHJcbiAgICAgICAgICAgIDogYmFzZSh4LCB5LCB3LCAwLCBob3JBbGlnbiwgdmVyQWxpZ24sIHZpc2libGUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBfc2l6ZSA9IHNpemU7XHJcbiAgICAgICAgICAgIF90ZXh0ID0gdGV4dDtcclxuICAgICAgICAgICAgVGV4dENvbG9yID0gY2xyO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIEFwcGx5VGhlbWUoVGhlbWUgY3VycmVudFRoZW1lKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgQ3VycmVudFRoZW1lID0gY3VycmVudFRoZW1lO1xyXG4gICAgICAgICAgICBTaXplID0gX3NpemU7XHJcbiAgICAgICAgICAgIFRleHQgPSBfdGV4dDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwibmFtZXNwYWNlIE1vbm9JbnRlcmZhY2Vcclxue1xyXG4gICAgcHVibGljIGNsYXNzIFN3aXRjaGVyIDogQ29udGFpbmVyIHtcclxuXHJcblxyXG4gICAgICAgIHByaXZhdGUgaW50IF9jdXJyZW50O1xyXG4gICAgICAgIHB1YmxpYyBpbnQgQ3VycmVudCB7XHJcbiAgICAgICAgICAgIGdldCB7IHJldHVybiBfY3VycmVudDsgfVxyXG4gICAgICAgICAgICBzZXQge1xyXG4gICAgICAgICAgICAgICAgaWYgKHBjdE1haW5PbGQgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICBwY3RNYWluT2xkLnNwcml0ZVJlZiA9IFBpY3R1cmVzW19jdXJyZW50XTtcclxuICAgICAgICAgICAgICAgIGlmIChsYmxNYWluT2xkICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgbGJsTWFpbk9sZC5UZXh0ID0gVGl0bGVzW19jdXJyZW50XTtcclxuICAgICAgICAgICAgICAgIF9jdXJyZW50ID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICBpZiAoX2N1cnJlbnQgPj0gSXRlbXNDb3VudClcclxuICAgICAgICAgICAgICAgICAgICBfY3VycmVudCA9IDA7XHJcbiAgICAgICAgICAgICAgICBpZiAoX2N1cnJlbnQgPCAwKVxyXG4gICAgICAgICAgICAgICAgICAgIF9jdXJyZW50ID0gSXRlbXNDb3VudCAtIDE7XHJcbiAgICAgICAgICAgICAgICBpZiAocGN0TWFpbiAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIHBjdE1haW4uc3ByaXRlUmVmID0gUGljdHVyZXNbX2N1cnJlbnRdO1xyXG4gICAgICAgICAgICAgICAgaWYgKGxibE1haW4gIT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICBsYmxNYWluLlRleHQgPSBUaXRsZXNbX2N1cnJlbnRdO1xyXG4gICAgICAgICAgICAgICAgaWYgKGxibERlc2MgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICBsYmxEZXNjLlRleHQgPSBEZXNjcmlwdGlvbnNbX2N1cnJlbnRdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgaW50IEl0ZW1zQ291bnQgeyBnZXQ7IHNldDsgfVxyXG5cclxuICAgICAgICBwdWJsaWMgQXBwZWFyYW5jZVtdIFBpY3R1cmVzIHsgZ2V0OyBzZXQ7IH1cclxuICAgICAgICBwdWJsaWMgc3RyaW5nW10gVGl0bGVzIHsgZ2V0OyBzZXQ7IH1cclxuICAgICAgICBwdWJsaWMgc3RyaW5nW10gRGVzY3JpcHRpb25zIHsgZ2V0OyBzZXQ7IH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBQaWN0dXJlIHBjdE1haW47XHJcbiAgICAgICAgcHJpdmF0ZSBMYWJlbCBsYmxNYWluO1xyXG4gICAgICAgIHByaXZhdGUgTG9uZ0xhYmVsIGxibERlc2M7XHJcblxyXG4gICAgICAgIHByaXZhdGUgUGljdHVyZSBwY3RNYWluT2xkO1xyXG4gICAgICAgIHByaXZhdGUgTGFiZWwgbGJsTWFpbk9sZDtcclxuXHJcbiAgICAgICAgcHVibGljIEFuaW1hdG9yIEFuaW1hdG9yIHsgZ2V0OyBzZXQ7IH1cclxuXHJcbiAgICAgICAgcHVibGljIFN3aXRjaGVyKEFwcGVhcmFuY2VbXSBwaWN0dXJlcywgc3RyaW5nW10gdGl0bGVzLCBzdHJpbmdbXSBkZXNjcmlwdGlvbnMsIGludCBjdXJyZW50LCBBbmltYXRvciBhbmltYXRvciwgaW50IHgsIGludCB5LCBpbnQgdywgaW50IGgsIGZsb2F0IGhvckFsaWduID0gMC41ZiwgZmxvYXQgdmVyQWxpZ24gPSAwLjVmLCBib29sIHZpc2libGUgPSB0cnVlKVxyXG4gICAgICAgICAgICA6IGJhc2UoeCwgeSwgdywgaCwgaG9yQWxpZ24sIHZlckFsaWduLCB2aXNpYmxlKSB7XHJcbiAgICAgICAgICAgIFBpY3R1cmVzID0gcGljdHVyZXM7XHJcbiAgICAgICAgICAgIFRpdGxlcyA9IHRpdGxlcztcclxuICAgICAgICAgICAgRGVzY3JpcHRpb25zID0gZGVzY3JpcHRpb25zO1xyXG4gICAgICAgICAgICBBbmltYXRvciA9IGFuaW1hdG9yO1xyXG5cclxuICAgICAgICAgICAgaW50IHBDbnQgPSAocGljdHVyZXMhPW51bGw/cGljdHVyZXMuTGVuZ3RoOihpbnQ/KW51bGwpID8/IDA7XHJcbiAgICAgICAgICAgIGludCB0Q250ID0gKHRpdGxlcyE9bnVsbD90aXRsZXMuTGVuZ3RoOihpbnQ/KW51bGwpID8/IDA7XHJcblxyXG4gICAgICAgICAgICBpbnQgbWF4Q250ID0gcENudCA+IHRDbnQgPyBwQ250IDogdENudDtcclxuXHJcbiAgICAgICAgICAgIEl0ZW1zQ291bnQgPSBtYXhDbnQ7XHJcbiAgICAgICAgICAgIEN1cnJlbnQgPSBjdXJyZW50O1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgdm9pZCBidG5MZWZ0Q2xpY2tlZChCdXR0b24gYnRuLCBib29sIGlzVG91Y2gpIHtcclxuICAgICAgICAgICAgQ3VycmVudCAtPSAxO1xyXG4gICAgICAgICAgICBpZiAoQW5pbWF0b3IgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHBjdE1haW4gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIEFuaW1hdG9yLkFkZENoaWxkPE11bHRpQW5pbWF0aW9uPihuZXcgTXVsdGlBbmltYXRpb24oKCkgPT4gcGN0TWFpbk9sZC5TaG93KCksICgpID0+IHBjdE1haW5PbGQuSGlkZSgpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgTnVtYmVyQW5pbWF0aW9uKFwiWFwiLCAwLCAtNTAsIC01LCB0YXJnZXQ6IHBjdE1haW5PbGQpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgTnVtYmVyQW5pbWF0aW9uKFwiQWxwaGFcIiwgMS4wZiwgMCwgLTAuMWYsIHRhcmdldDogcGN0TWFpbk9sZCkpKS5CZWdpbigpO1xyXG4gICAgICAgICAgICAgICAgICAgIEFuaW1hdG9yLkFkZENoaWxkPE11bHRpQW5pbWF0aW9uPihuZXcgTXVsdGlBbmltYXRpb24oXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBOdW1iZXJBbmltYXRpb24oXCJYXCIsIDUwLCAwLCAtNSwgdGFyZ2V0OiBwY3RNYWluKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE51bWJlckFuaW1hdGlvbihcIkFscGhhXCIsIDAsIDEuMGYsIDAuMWYsIHRhcmdldDogcGN0TWFpbikpKS5CZWdpbigpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChsYmxNYWluICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBBbmltYXRvci5BZGRDaGlsZDxNdWx0aUFuaW1hdGlvbj4obmV3IE11bHRpQW5pbWF0aW9uKCgpID0+IGxibE1haW5PbGQuU2hvdygpLCAoKSA9PiBsYmxNYWluT2xkLkhpZGUoKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE51bWJlckFuaW1hdGlvbihcIlhcIiwgMCwgLTUwLCAtNSwgdGFyZ2V0OiBsYmxNYWluT2xkKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE51bWJlckFuaW1hdGlvbihcIkFscGhhXCIsIDEuMGYsIDAsIC0wLjFmLCB0YXJnZXQ6IGxibE1haW5PbGQpKSkuQmVnaW4oKTtcclxuICAgICAgICAgICAgICAgICAgICBBbmltYXRvci5BZGRDaGlsZDxNdWx0aUFuaW1hdGlvbj4obmV3IE11bHRpQW5pbWF0aW9uKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgTnVtYmVyQW5pbWF0aW9uKFwiWFwiLCA1MCwgMCwgLTUsIHRhcmdldDogbGJsTWFpbiksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBOdW1iZXJBbmltYXRpb24oXCJBbHBoYVwiLCAwLCAxLjBmLCAwLjFmLCB0YXJnZXQ6IGxibE1haW4pKSkuQmVnaW4oKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSB2b2lkIGJ0blJpZ2h0Q2xpY2tlZChCdXR0b24gYnRuLCBib29sIGlzVG91Y2gpIHtcclxuICAgICAgICAgICAgQ3VycmVudCArPSAxO1xyXG4gICAgICAgICAgICBpZiAoQW5pbWF0b3IgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHBjdE1haW4gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIEFuaW1hdG9yLkFkZENoaWxkPE11bHRpQW5pbWF0aW9uPihuZXcgTXVsdGlBbmltYXRpb24oKCkgPT4gcGN0TWFpbk9sZC5TaG93KCksICgpID0+IHBjdE1haW5PbGQuSGlkZSgpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgTnVtYmVyQW5pbWF0aW9uKFwiWFwiLCAwLCA1MCwgNSwgdGFyZ2V0OiBwY3RNYWluT2xkKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE51bWJlckFuaW1hdGlvbihcIkFscGhhXCIsIDEuMGYsIDAsIC0wLjFmLCB0YXJnZXQ6IHBjdE1haW5PbGQpKSkuQmVnaW4oKTtcclxuICAgICAgICAgICAgICAgICAgICBBbmltYXRvci5BZGRDaGlsZDxNdWx0aUFuaW1hdGlvbj4obmV3IE11bHRpQW5pbWF0aW9uKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgTnVtYmVyQW5pbWF0aW9uKFwiWFwiLCAtNTAsIDAsIDUsIHRhcmdldDogcGN0TWFpbiksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBOdW1iZXJBbmltYXRpb24oXCJBbHBoYVwiLCAwLCAxLjBmLCAwLjFmLCB0YXJnZXQ6IHBjdE1haW4pKSkuQmVnaW4oKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobGJsTWFpbiAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgQW5pbWF0b3IuQWRkQ2hpbGQ8TXVsdGlBbmltYXRpb24+KG5ldyBNdWx0aUFuaW1hdGlvbigoKSA9PiBsYmxNYWluT2xkLlNob3coKSwgKCkgPT4gbGJsTWFpbk9sZC5IaWRlKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBOdW1iZXJBbmltYXRpb24oXCJYXCIsIDAsIDUwLCA1LCB0YXJnZXQ6IGxibE1haW5PbGQpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgTnVtYmVyQW5pbWF0aW9uKFwiQWxwaGFcIiwgMS4wZiwgMCwgLTAuMWYsIHRhcmdldDogbGJsTWFpbk9sZCkpKS5CZWdpbigpO1xyXG4gICAgICAgICAgICAgICAgICAgIEFuaW1hdG9yLkFkZENoaWxkPE11bHRpQW5pbWF0aW9uPihuZXcgTXVsdGlBbmltYXRpb24oXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBOdW1iZXJBbmltYXRpb24oXCJYXCIsIC01MCwgMCwgNSwgdGFyZ2V0OiBsYmxNYWluKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE51bWJlckFuaW1hdGlvbihcIkFscGhhXCIsIDAsIDEuMGYsIDAuMWYsIHRhcmdldDogbGJsTWFpbikpKS5CZWdpbigpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBBcHBseVRoZW1lKFRoZW1lIGN1cnJlbnRUaGVtZSkge1xyXG4gICAgICAgICAgICBDdXJyZW50VGhlbWUgPSBjdXJyZW50VGhlbWU7XHJcbiAgICAgICAgICAgIHZhciBidG5MZWZ0ID0gdGhpcy5BZGRDaGlsZDxCdXR0b24+KG5ldyBCdXR0b24oYnRuTGVmdENsaWNrZWQsIE1pY3Jvc29mdC5YbmEuRnJhbWV3b3JrLklucHV0LktleXMuTGVmdCwgMCwgMCwgNDUsIDMwLCBob3JBbGlnbjogMC4wZikpO1xyXG4gICAgICAgICAgICBidG5MZWZ0LkFkZENoaWxkPFBpY3R1cmU+KG5ldyBQaWN0dXJlKEN1cnJlbnRUaGVtZS5Td2l0Y2hlckJ1dHRvbkxlZnRUZXh0dXJlLCB3OiA0NSwgaDogNDUpKTtcclxuICAgICAgICAgICAgYnRuTGVmdC5CYWNrVGV4dHVyZSA9IGN1cnJlbnRUaGVtZS5FbXB0eVRleHR1cmU7XHJcbiAgICAgICAgICAgIHZhciBidG5SaWdodCA9IHRoaXMuQWRkQ2hpbGQ8QnV0dG9uPihuZXcgQnV0dG9uKGJ0blJpZ2h0Q2xpY2tlZCwgTWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuSW5wdXQuS2V5cy5SaWdodCwgMCwgMCwgNDUsIDMwLCBob3JBbGlnbjogMS4wZikpO1xyXG4gICAgICAgICAgICBidG5SaWdodC5BZGRDaGlsZDxQaWN0dXJlPihuZXcgUGljdHVyZShDdXJyZW50VGhlbWUuU3dpdGNoZXJCdXR0b25SaWdodFRleHR1cmUsIHc6IDQ1LCBoOiA0NSkpO1xyXG4gICAgICAgICAgICBidG5SaWdodC5CYWNrVGV4dHVyZSA9IGN1cnJlbnRUaGVtZS5FbXB0eVRleHR1cmU7XHJcbiAgICAgICAgICAgIGlmIChQaWN0dXJlcyAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBwY3RNYWluID0gdGhpcy5BZGRDaGlsZDxQaWN0dXJlPihuZXcgUGljdHVyZShQaWN0dXJlc1tDdXJyZW50XSkpO1xyXG4gICAgICAgICAgICAgICAgcGN0TWFpbk9sZCA9IHRoaXMuQWRkQ2hpbGQ8UGljdHVyZT4obmV3IFBpY3R1cmUoUGljdHVyZXNbQ3VycmVudF0sIHZpc2libGU6IGZhbHNlKSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoVGl0bGVzICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBsYmxNYWluID0gdGhpcy5BZGRDaGlsZDxMYWJlbD4obmV3IExhYmVsKFRpdGxlc1tDdXJyZW50XSwgQ3VycmVudFRoZW1lLlN3aXRjaGVyTWFpbkZvbnRTaXplLCBDdXJyZW50VGhlbWUuU3dpdGNoZXJNYWluQ29sb3IsIHk6IC1IIC8gMiAtIDIwLCB2ZXJBbGlnbjogMS4wZikpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxibE1haW5PbGQgPSB0aGlzLkFkZENoaWxkPExhYmVsPihuZXcgTGFiZWwoVGl0bGVzW0N1cnJlbnRdLCBDdXJyZW50VGhlbWUuU3dpdGNoZXJNYWluRm9udFNpemUsIEN1cnJlbnRUaGVtZS5Td2l0Y2hlck1haW5Db2xvciwgeTogLUggLyAyIC0gMjAsIHZlckFsaWduOiAxLjBmLCB2aXNpYmxlOiBmYWxzZSkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKERlc2NyaXB0aW9ucyAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIGxibERlc2MgPSB0aGlzLkFkZENoaWxkPExvbmdMYWJlbD4obmV3IExvbmdMYWJlbChEZXNjcmlwdGlvbnNbQ3VycmVudF0sIEN1cnJlbnRUaGVtZS5Td2l0Y2hlckRlc2NyaXB0aW9uRm9udFNpemUsIEN1cnJlbnRUaGVtZS5Td2l0Y2hlckRlc2NyaXB0aW9uQ29sb3IsIHk6IEggLyAyICsgMjUsIHc6IFcsIHZlckFsaWduOiAwLjBmKSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBsYmxNYWluID0gdGhpcy5BZGRDaGlsZDxMYWJlbD4obmV3IExhYmVsKFRpdGxlc1tDdXJyZW50XSwgQ3VycmVudFRoZW1lLlN3aXRjaGVyTWFpbkZvbnRTaXplLCBDdXJyZW50VGhlbWUuU3dpdGNoZXJNYWluQ29sb3IpKTtcclxuICAgICAgICAgICAgICAgIGxibE1haW5PbGQgPSB0aGlzLkFkZENoaWxkPExhYmVsPihuZXcgTGFiZWwoVGl0bGVzW0N1cnJlbnRdLCBDdXJyZW50VGhlbWUuU3dpdGNoZXJNYWluRm9udFNpemUsIEN1cnJlbnRUaGVtZS5Td2l0Y2hlck1haW5Db2xvciwgdmlzaWJsZTogZmFsc2UpKTtcclxuICAgICAgICAgICAgICAgIGlmIChEZXNjcmlwdGlvbnMgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICBsYmxEZXNjID0gdGhpcy5BZGRDaGlsZDxMb25nTGFiZWw+KG5ldyBMb25nTGFiZWwoRGVzY3JpcHRpb25zW0N1cnJlbnRdLCBDdXJyZW50VGhlbWUuU3dpdGNoZXJEZXNjcmlwdGlvbkZvbnRTaXplLCBDdXJyZW50VGhlbWUuU3dpdGNoZXJEZXNjcmlwdGlvbkNvbG9yLCB5OiBIIC8gMiArIDIwLCB3OiBXLCB2ZXJBbGlnbjogMC4wZikpO1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBiYXNlLkFwcGx5VGhlbWUoY3VycmVudFRoZW1lKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIE1pY3Jvc29mdC5YbmEuRnJhbWV3b3JrLklucHV0O1xyXG5cclxubmFtZXNwYWNlIE1vbm9JbnRlcmZhY2Vcclxue1xyXG4gICAgcHVibGljIGNsYXNzIFdpbmRvdyA6IENvbnRhaW5lclxyXG4gICAge1xyXG5cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgQ2xpY2tCdXR0b24oS2V5cyBrZXkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgYnRuID0gR2V0QnV0dG9uQnlIb3RLZXkoa2V5KTtcclxuICAgICAgICAgICAgaWYgKGJ0biAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgYnRuLkNsaWNrKDAsIDAsIGZhbHNlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIENsaWNrQnV0dG9uKGludCB4LCBpbnQgeSwgYm9vbCBpc1RvdWNoKVxyXG4gICAgICAgIHtcclxuaW50IGZYO1xuaW50IGZZO1xuICAgICAgICAgICAgdmFyIGNvbnQgPSBHZXRDb250YWluZXJCeVBvaW50KHgsIHksIG91dCBmWCwgb3V0IGZZKTtcclxuICAgICAgICAgICAgaWYgKGNvbnQgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgIGNvbnQuQ2xpY2soZlgsIGZZLCBpc1RvdWNoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEhpZ2hsaWdodEJ1dHRvbihpbnQgeCwgaW50IHksIGJvb2wgbVByZXNzZWQpXHJcbiAgICAgICAge1xyXG5pbnQgZlg7XG5pbnQgZlk7XG4gICAgICAgICAgICB2YXIgY29udCA9IEdldENvbnRhaW5lckJ5UG9pbnQoeCwgeSwgb3V0IGZYLCBvdXQgZlkpO1xyXG5CdXR0b24gYnRuOyAgICAgICAgICAgIGlmICgoYnRuID0gY29udCBhcyBCdXR0b24pICE9IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGJ0bi5Gb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFidG4uSXNEaXNhYmxlZClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBidG4uSXNIaWdobGlnaHRlZCA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChtUHJlc3NlZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnRuLklzUHJlc3NlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFRhcEFuZEhvbGRCdXR0b24oaW50IHgsIGludCB5KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaW50IGZYLCBmWTtcclxuICAgICAgICAgICAgdmFyIGNvbnQgPSBHZXRDb250YWluZXJCeVBvaW50KHgsIHksIG91dCBmWCwgb3V0IGZZKTtcclxuQnV0dG9uIGJ0bjsgICAgICAgICAgICBpZiAoKGJ0biA9IGNvbnQgYXMgQnV0dG9uKSAhPSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBidG4uVGFwQW5kSG9sZCgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFidG4uSXNEaXNhYmxlZClcclxuICAgICAgICAgICAgICAgICAgICBidG4uSXNQcmVzc2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBXaW5kb3coaW50IHgsIGludCB5LCBpbnQgdywgaW50IGgsIGZsb2F0IGhvckFsaWduID0gMC41ZiwgZmxvYXQgdmVyQWxpZ24gPSAwLjVmLCBib29sIHZpc2libGUgPSB0cnVlKVxyXG4gICAgICAgICAgICA6IGJhc2UoeCwgeSwgdywgaCwgaG9yQWxpZ24sIHZlckFsaWduLCB2aXNpYmxlKVxyXG4gICAgICAgIHtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIFJlY2FsYygpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBfZmluYWxYID0gWDtcclxuICAgICAgICAgICAgX2ZpbmFsWSA9IFk7XHJcbiAgICAgICAgICAgIF9maW5hbFcgPSBXO1xyXG4gICAgICAgICAgICBfZmluYWxIID0gSDtcclxuICAgICAgICAgICAgX2ZpbmFsQ2hpbGRyZW5TY2FsZVggPSBDaGlsZHJlblNjYWxlWDtcclxuICAgICAgICAgICAgX2ZpbmFsQ2hpbGRyZW5TY2FsZVkgPSBDaGlsZHJlblNjYWxlWTtcclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIGNoaWxkIGluIENoaWxkcmVuKVxyXG4gICAgICAgICAgICAgICAgY2hpbGQuUmVjYWxjKCk7XHJcbiAgICAgICAgICAgIElzTmVlZFJlY2FsYyA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcbn1cclxuIl0KfQo=
