/**
 * @version 1.0.0.0
 * @copyright Copyright Â©  2019
 * @compiler Bridge.NET 17.10.1
 */
Bridge.assembly("DarkKingdomJS", function ($asm, globals) {
    "use strict";

    Bridge.define("DarkKingdomCore.Ability", {
        fields: {
            name: null,
            value: 0,
            condition: null,
            condnum: 0,
            condCompleted: false,
            typ: 0,
            hidden: false,
            used: false,
            longTime: false
        },
        ctors: {
            ctor: function (nme, nm, con, cn, t, h) {
                this.$initialize();
                this.name = nme;
                this.value = nm;
                this.typ = t;
                this.condition = con;
                this.condnum = cn;
                this.hidden = h;
                if (!Bridge.referenceEquals(this.condition, "")) {
                    this.condCompleted = false;
                } else {
                    this.condCompleted = true;
                }
                this.used = false;
                this.longTime = System.Array.indexOfT(DarkKingdomCore.MyGame.longTimeConds, this.condition) > -1;
            }
        }
    });

    Bridge.define("DarkKingdomCore.Achievement", {
        fields: {
            name: null,
            uIcon: null,
            booty: null
        },
        ctors: {
            init: function () {
                this.uIcon = new MonoInterface.Appearance();
            },
            ctor: function (nam, ui, boty) {
                this.$initialize();
                this.name = nam;
                this.uIcon = ui.$clone();
                this.booty = boty;
            }
        }
    });

    Bridge.define("DarkKingdomCore.Ammo", {
        fields: {
            x: 0,
            y: 0,
            vx: 0,
            vy: 0,
            ay: 0,
            type: 0,
            target: null,
            dmg: 0,
            ignoreArmor: false,
            agil: false,
            lifetime: 0,
            stock: false,
            plr: 0,
            owner: null,
            img: 0,
            explosive: false
        },
        ctors: {
            init: function () {
                this.stock = false;
            },
            $ctor1: function (pl, t, xx, yy, vxx, vyy, ayy, ownabils, trg, d, ia, ag, ltime, exp) {
                if (exp === void 0) { exp = false; }

                this.$initialize();
                this.x = xx;
                this.y = yy;
                this.vx = vxx;
                this.vy = vyy;
                this.ay = ayy;
                this.target = trg;
                this.type = t;
                this.dmg = d;
                this.ignoreArmor = ia;
                this.agil = ag;
                this.lifetime = ltime;
                this.plr = pl;
                this.explosive = exp;
            },
            ctor: function (pl, t, xx, yy, own, trg, d, ia, ag, ltime, exp) {
                if (exp === void 0) { exp = false; }

                this.$initialize();
                var tt;
                var a = 0.1;
                this.plr = pl;
                switch (t) {
                    case DarkKingdomCore.Ammo.AmmoType.Arrow: 
                        {
                            this.vx = 4;
                            break;
                        }
                    case DarkKingdomCore.Ammo.AmmoType.BigArrow: 
                        {
                            this.vx = 2;
                            break;
                        }
                    case DarkKingdomCore.Ammo.AmmoType.Bomb: 
                        {
                            this.vx = 1.5;
                            this.img = 1;
                            break;
                        }
                    case DarkKingdomCore.Ammo.AmmoType.BlueBall: 
                        {
                            this.vx = 3;
                            a = 0.03;
                            this.img = 2;
                            break;
                        }
                    case DarkKingdomCore.Ammo.AmmoType.RedBall: 
                        {
                            this.vx = 3;
                            a = 0.03;
                            this.img = 0;
                            break;
                        }
                    case DarkKingdomCore.Ammo.AmmoType.VioletBall: 
                        {
                            this.vx = 3;
                            a = 0.03;
                            this.img = 3;
                            break;
                        }
                    case DarkKingdomCore.Ammo.AmmoType.GreenBall: 
                        {
                            this.vx = 3;
                            a = 0.03;
                            this.img = 5;
                            break;
                        }
                    case DarkKingdomCore.Ammo.AmmoType.FastArrow: 
                        {
                            this.vx = 4;
                            break;
                        }
                    case DarkKingdomCore.Ammo.AmmoType.Bullet: 
                        {
                            a = 0;
                            this.vx = 6;
                            this.img = 6;
                            break;
                        }
                    case DarkKingdomCore.Ammo.AmmoType.Hammer: 
                        {
                            this.vx = 1.5;
                            this.img = 4;
                            break;
                        }
                }
                this.explosive = exp;
                this.x = xx;
                this.y = yy;
                this.vx *= Bridge.Int.sign(trg.x - xx);
                this.owner = own;
                this.target = trg;
                this.type = t;
                this.dmg = d;
                this.ignoreArmor = ia;
                this.agil = ag;
                this.lifetime = ltime;
                if (trg.x !== xx) {
                    tt = (trg.x - xx) / this.vx;
                    this.vy = (((((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0) + 15) | 0) - yy) / tt - a * tt / 2;
                } else {
                    this.vy = -1;
                }
                this.ay = a;
            }
        }
    });

    Bridge.define("DarkKingdomCore.Ammo.AmmoType", {
        $kind: "nested enum",
        statics: {
            fields: {
                None: 0,
                Arrow: 1,
                BigArrow: 2,
                Bomb: 3,
                BlueBall: 4,
                RedBall: 5,
                VioletBall: 6,
                GreenBall: 7,
                Bullet: 8,
                FastArrow: 9,
                Hammer: 10
            }
        }
    });

    Bridge.define("DarkKingdomCore.Attack", {
        $kind: "struct",
        statics: {
            methods: {
                op_Addition$1: function (atk, val) {
                    return new DarkKingdomCore.Attack.$ctor1(((atk.MinDamage + val) | 0), ((atk.MaxDamage + val) | 0), atk.Range, atk.Speed);
                },
                op_Addition: function (atk1, atk2) {
                    return new DarkKingdomCore.Attack.$ctor1(((atk1.MinDamage + atk2.MinDamage) | 0), ((atk1.MaxDamage + atk2.MaxDamage) | 0), ((atk1.Range + atk2.Range) | 0), atk1.Speed);
                },
                op_Subtraction$1: function (atk, val) {
                    return new DarkKingdomCore.Attack.$ctor1(((atk.MinDamage - val) | 0), ((atk.MaxDamage - val) | 0), atk.Range, atk.Speed);
                },
                op_Subtraction: function (atk1, atk2) {
                    return new DarkKingdomCore.Attack.$ctor1(((atk1.MinDamage - atk2.MinDamage) | 0), ((atk1.MaxDamage - atk2.MaxDamage) | 0), ((atk1.Range - atk2.Range) | 0), atk1.Speed);
                },
                op_Multiply: function (atk, val) {
                    return new DarkKingdomCore.Attack.$ctor1(Bridge.Int.mul(atk.MinDamage, val), Bridge.Int.mul(atk.MaxDamage, val), atk.Range, atk.Speed);
                },
                getDefaultValue: function () { return new DarkKingdomCore.Attack(); }
            }
        },
        fields: {
            MinDamage: 0,
            MaxDamage: 0,
            Range: 0,
            Speed: 0
        },
        ctors: {
            $ctor1: function (mnd, mxd, range, speed) {
                this.$initialize();
                this.MinDamage = mnd;
                this.MaxDamage = mxd;
                this.Range = range;
                this.Speed = speed;
            },
            ctor: function () {
                this.$initialize();
            }
        },
        methods: {
            getHashCode: function () {
                var h = Bridge.addHash([1635049380, this.MinDamage, this.MaxDamage, this.Range, this.Speed]);
                return h;
            },
            equals: function (o) {
                if (!Bridge.is(o, DarkKingdomCore.Attack)) {
                    return false;
                }
                return Bridge.equals(this.MinDamage, o.MinDamage) && Bridge.equals(this.MaxDamage, o.MaxDamage) && Bridge.equals(this.Range, o.Range) && Bridge.equals(this.Speed, o.Speed);
            },
            $clone: function (to) {
                var s = to || new DarkKingdomCore.Attack();
                s.MinDamage = this.MinDamage;
                s.MaxDamage = this.MaxDamage;
                s.Range = this.Range;
                s.Speed = this.Speed;
                return s;
            }
        }
    });

    Bridge.define("DarkKingdomCore.EffectType", {
        $kind: "enum",
        statics: {
            fields: {
                Normal: 0,
                Bad: 1,
                Poison: 2,
                Good: 3
            }
        }
    });

    Bridge.define("DarkKingdomCore.GameState", {
        $kind: "enum",
        statics: {
            fields: {
                MainMenu: 0,
                PrePlay: 1,
                InGame: 2,
                Win: 3,
                Lose: 4
            }
        }
    });

    Bridge.define("DarkKingdomCore.GameType", {
        $kind: "enum",
        statics: {
            fields: {
                RandomGT: 0,
                StandartGT: 1,
                OffenceGT: 2,
                DefenceGT: 3,
                FirstHeroGT: 4
            }
        }
    });

    Bridge.define("DarkKingdomCore.Particle", {
        fields: {
            x: 0,
            y: 0,
            dx: 0,
            dy: 0,
            ltime: 0,
            pType: 0,
            a: 0,
            ast: 0,
            ay: 0
        }
    });

    Bridge.define("DarkKingdomCore.LandscapeType", {
        $kind: "enum",
        statics: {
            fields: {
                PlainLS: 0,
                DesertLS: 1,
                SwampLS: 2,
                DeathlandLS: 3,
                MechanicsLS: 4,
                ForestLS: 5,
                InfernoLS: 6
            }
        }
    });

    Bridge.define("DarkKingdomCore.MatchCondition", {
        $kind: "struct",
        statics: {
            methods: {
                getDefaultValue: function () { return new DarkKingdomCore.MatchCondition(); }
            }
        },
        fields: {
            name: null,
            res1: null,
            res2: null,
            income: 0,
            ipt: 0
        },
        ctors: {
            init: function () {
                this.res1 = new DarkKingdomCore.TimeCost();
                this.res2 = new DarkKingdomCore.TimeCost();
            },
            $ctor1: function (nme, r1, r2, inc, ip) {
                this.$initialize();
                this.name = nme;
                this.res1 = r1.$clone();
                this.res2 = r2.$clone();
                this.income = inc;
                this.ipt = ip;
            },
            ctor: function () {
                this.$initialize();
            }
        },
        methods: {
            getHashCode: function () {
                var h = Bridge.addHash([5290622088, this.name, this.res1, this.res2, this.income, this.ipt]);
                return h;
            },
            equals: function (o) {
                if (!Bridge.is(o, DarkKingdomCore.MatchCondition)) {
                    return false;
                }
                return Bridge.equals(this.name, o.name) && Bridge.equals(this.res1, o.res1) && Bridge.equals(this.res2, o.res2) && Bridge.equals(this.income, o.income) && Bridge.equals(this.ipt, o.ipt);
            },
            $clone: function (to) {
                var s = to || new DarkKingdomCore.MatchCondition();
                s.name = this.name;
                s.res1 = this.res1.$clone();
                s.res2 = this.res2.$clone();
                s.income = this.income;
                s.ipt = this.ipt;
                return s;
            }
        }
    });

    Bridge.define("DarkKingdomCore.MyGame", {
        statics: {
            fields: {
                elapse_Periodically: 0,
                goodAbilClr: null,
                badAbilClr: null,
                poiAbilClr: null,
                loc: null,
                rnd: null,
                gameWidth: 0,
                gameHeight: 0,
                hor: 0,
                unitPrms: null,
                sprites: null,
                allAbils: null,
                allConds: null,
                plrs: null,
                units: null,
                gState: 0,
                pars: null,
                uipars: null,
                cloudpars: null,
                backpars: null,
                bushpars: null,
                longTimeConds: null,
                frmFillTex: null,
                btnFillTex: null,
                btnSelectTex: null,
                btnHlTex: null,
                btnPressedTex: null,
                btnDisabledTex: null,
                prgFillTex: null,
                prgBarTex: null,
                hlbtncolor: null,
                disbtnbrush: null
            },
            ctors: {
                init: function () {
                    this.goodAbilClr = new Microsoft.Xna.Framework.Color();
                    this.badAbilClr = new Microsoft.Xna.Framework.Color();
                    this.poiAbilClr = new Microsoft.Xna.Framework.Color();
                    this.hlbtncolor = new Microsoft.Xna.Framework.Color();
                    this.disbtnbrush = new Microsoft.Xna.Framework.Color();
                    this.elapse_Periodically = 1;
                    this.badAbilClr = Microsoft.Xna.Framework.Color.DarkViolet.$clone();
                    this.poiAbilClr = Microsoft.Xna.Framework.Color.DarkViolet.$clone();
                    this.loc = new (System.Collections.Generic.Dictionary$2(System.String,System.String)).ctor();
                    this.rnd = new System.Random.ctor();
                    this.gameWidth = 800;
                    this.gameHeight = 480;
                    this.unitPrms = new (System.Collections.Generic.Dictionary$2(System.String,DarkKingdomCore.UnitParameters)).ctor();
                    this.sprites = new (System.Collections.Generic.Dictionary$2(System.String,MonoInterface.Sprite)).ctor();
                    this.allAbils = new (System.Collections.Generic.List$1(System.String)).ctor();
                    this.allConds = new (System.Collections.Generic.List$1(System.String)).ctor();
                    this.plrs = System.Array.init(2, null, DarkKingdomCore.Player);
                    this.units = new (System.Collections.Generic.List$1(DarkKingdomCore.Unit)).ctor();
                    this.pars = new (System.Collections.Generic.List$1(DarkKingdomCore.Particle)).ctor();
                    this.uipars = new (System.Collections.Generic.List$1(DarkKingdomCore.Particle)).ctor();
                    this.cloudpars = new (System.Collections.Generic.List$1(DarkKingdomCore.ImageParticle)).ctor();
                    this.backpars = new (System.Collections.Generic.List$1(DarkKingdomCore.ImageParticle)).ctor();
                    this.bushpars = new (System.Collections.Generic.List$1(DarkKingdomCore.ImageParticle)).ctor();
                    this.longTimeConds = System.Array.init(["Tier", "Machine army"], System.String);
                    this.hlbtncolor = Microsoft.Xna.Framework.Color.WhiteSmoke.$clone();
                    this.disbtnbrush = new Microsoft.Xna.Framework.Color.$ctor7(120, 75, 75, 75);
                }
            },
            methods: {
                SelectPlayingRace: function (uList) {
                    var $t;
                    var tmpdic = new (System.Collections.Generic.Dictionary$2(System.String,System.Int32)).ctor();
                    var maxrace = "";
                    var maxcnt = 0;
                    $t = Bridge.getEnumerator(uList);
                    try {
                        while ($t.moveNext()) {
                            var u = $t.Current;
                            if (tmpdic.containsKey(DarkKingdomCore.MyGame.unitPrms.getItem(u).$clone().Race)) {
                                tmpdic.setItem(DarkKingdomCore.MyGame.unitPrms.getItem(u).$clone().Race, (tmpdic.getItem(DarkKingdomCore.MyGame.unitPrms.getItem(u).$clone().Race) + 1) | 0);
                            } else {
                                tmpdic.add(DarkKingdomCore.MyGame.unitPrms.getItem(u).$clone().Race, 1);
                            }
                            if (tmpdic.getItem(DarkKingdomCore.MyGame.unitPrms.getItem(u).$clone().Race) > maxcnt) {
                                maxcnt = tmpdic.getItem(DarkKingdomCore.MyGame.unitPrms.getItem(u).$clone().Race);
                                maxrace = DarkKingdomCore.MyGame.unitPrms.getItem(u).$clone().Race;
                            }
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                    return maxrace;
                },
                FillRectangle$1: function (sb, tex, x, y, w, h) {
                    sb.Draw(tex, new Microsoft.Xna.Framework.Rectangle.$ctor2(x, y, w, h), Microsoft.Xna.Framework.Color.White.$clone());
                },
                FillRectangle: function (sb, tex, rect) {
                    sb.Draw(tex, new Microsoft.Xna.Framework.Rectangle.$ctor2(rect.X, rect.Y, rect.Width, rect.Height), Microsoft.Xna.Framework.Color.White.$clone());
                }
            }
        },
        fields: {
            AppFolder: null,
            DataFolder: null,
            graphics: null,
            spriteBatch: null,
            Fonts: null,
            localize: null,
            oldMouseState: null,
            Platform: null,
            isLoaded: false,
            landBmp: null,
            curProfile: 0,
            sunAng: 0,
            dAng: 0,
            gType: 0,
            gamelandscape: 0,
            landsTypesCount: 0,
            ammos: null,
            spells: null,
            pdeathlist: null,
            lifeClr: null,
            abilClr: null,
            backClr: null,
            condClr: null,
            unitSize: 0,
            us2: 0,
            csS: 0,
            snS: 0,
            csD: 0,
            snD: 0,
            skyR: 0,
            skyB: 0,
            skyG: 0,
            skyR2: 0,
            skyB2: 0,
            skyG2: 0,
            cnstR: 0,
            cnstG: 0,
            cnstB: 0,
            cnstR2: 0,
            cnstG2: 0,
            cnstB2: 0,
            stars: null,
            skyrect: null,
            starsCnt: 0,
            _pause: false,
            startBuildingsList: null,
            curM: 0,
            curD: 0,
            selU: null,
            deltax: 0,
            deltay: 0,
            deathlist: null,
            flyHeight: 0,
            piece: 0,
            conds: null,
            races1: null,
            races2: null,
            edunits: null,
            symbols: null,
            ispllmod: false,
            spellName: null,
            starTex: null,
            sunsetclr: null,
            machinenum: 0,
            bornList: null,
            oldsnS: 0,
            globalExplode: 0,
            unlockedUnits: null,
            unlockedAchivs: null,
            updateSpells: false,
            moneyClr: null,
            deathClr: null,
            AllUntsList: null,
            startAutofight: false,
            achivs: null,
            purchases: null,
            standartRaces: null,
            preGameUnits: null,
            preGameSpells: null,
            preGameBonus: null,
            preGameSlotCnt: 0,
            menuCarousel: null,
            curCarouselPos: 0,
            numKeys: null,
            unitsPreGame: null,
            spellsPreGame: null,
            taskConfirm: null,
            backFillTex: null,
            healthBarBackTex: null,
            healthBarLifeTex: null,
            healthBarPoisonTex: null,
            healthBarAbilTex: null,
            skytexture: null,
            sunsettexture: null,
            _screenWidth: 0,
            _screenHeight: 0,
            scaleX: 0,
            scaleY: 0,
            listeningKeys: null,
            oldKeyboardState: null,
            MainContainer: null,
            mainAnimator: null,
            defaultTheme: null,
            backTheme: null,
            frmConfirm: null,
            lblTextFrmConfirm: null,
            btnOkayFrmDialogConfirm: null,
            btnNopeFrmDialogConfirm: null,
            frmSettings: null,
            resSwitcherFrmSettings: null,
            frmMainMenu: null,
            frmBattleMenu: null,
            lblAIFrmBattleMenu: null,
            frmRightMenu: null,
            frmDialog: null,
            lblTitlefrmDialog: null,
            lblLine1FrmDialog: null,
            lblLine2FrmDialog: null,
            frmResources: null,
            pctTierFrmResources: null,
            pctPauseFrmResources: null,
            lblGoldFrmResources: null,
            lblDeathFrmResources: null,
            btnTierUpFrmResources: null,
            lblsFrmCustomRacesList: null,
            btnsFrmCustomRacesList: null,
            frmProfile: null,
            lblsfrmProfile: null,
            frmBack: null,
            frmBattle: null,
            races1SwitcherFrmBattle: null,
            races2SwitcherFrmBattle: null,
            modeSwitcherFrmBattle: null,
            frmUnits: null,
            frmProduction: null,
            prgsProduction: null,
            frmPreGame: null,
            btnsProduction: null,
            cUnits: null,
            cSpells: null,
            cBuildings: null,
            btnSelectUnits: null,
            btnSelectSpells: null,
            btnSelectBuildings: null,
            cBattleParameters: null,
            lblUnitNameHelpUnit: null,
            lblRaceHelpUnit: null,
            lblCostMoneyHelpUnit: null,
            lblCostDeathHelpUnit: null,
            lblAttackBasicParams: null,
            pctAttackBasicParams: null,
            lblsBasicParams: null,
            lblsAbils: null,
            frmHelp: null,
            lblVsPreGame: null,
            cUnitsPreGame: null,
            cSpellsPreGame: null,
            cBuildingsPreGame: null,
            cSelectedPreGame: null,
            btnFightPreGame: null,
            btnUnitsPreGame: null,
            btnSpellsPreGame: null,
            btnBuildingsPreGame: null,
            screenFormats: null
        },
        events: {
            OnExit: null
        },
        props: {
            inSpellMode: {
                get: function () {
                    return this.ispllmod;
                },
                set: function (value) {
                    this.ispllmod = value;
                    if (value) {
                    } else {
                    }
                }
            },
            Pause: {
                get: function () {
                    return this._pause;
                },
                set: function (value) {
                    this._pause = value;
                    if (DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.InGame) {
                        if (this._pause) {
                            this.pctPauseFrmResources.spriteRef = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("medium_icons"), 8);
                            this.frmBattleMenu.Show(this.mainAnimator);
                        } else {
                            this.pctPauseFrmResources.spriteRef = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("medium_icons"), 1);
                            this.frmBattleMenu.Hide(this.mainAnimator);
                        }
                    }
                }
            }
        },
        ctors: {
            init: function () {
                this.oldMouseState = new Microsoft.Xna.Framework.Input.MouseState();
                this.lifeClr = new Microsoft.Xna.Framework.Color();
                this.abilClr = new Microsoft.Xna.Framework.Color();
                this.backClr = new Microsoft.Xna.Framework.Color();
                this.condClr = new Microsoft.Xna.Framework.Color();
                this.skyrect = new Microsoft.Xna.Framework.Rectangle();
                this.sunsetclr = new Microsoft.Xna.Framework.Color();
                this.moneyClr = new Microsoft.Xna.Framework.Color();
                this.deathClr = new Microsoft.Xna.Framework.Color();
                this.oldKeyboardState = new Microsoft.Xna.Framework.Input.KeyboardState();
                this.isLoaded = false;
                this.landsTypesCount = 7;
                this.ammos = new (System.Collections.Generic.List$1(DarkKingdomCore.Ammo)).ctor();
                this.spells = new (System.Collections.Generic.Dictionary$2(System.String,DarkKingdomCore.Spell)).ctor();
                this.pdeathlist = new (System.Collections.Generic.List$1(DarkKingdomCore.Particle)).ctor();
                this.lifeClr = new Microsoft.Xna.Framework.Color.$ctor7(255, 0, 0, 200);
                this.abilClr = new Microsoft.Xna.Framework.Color.$ctor7(0, 0, 255, 200);
                this.backClr = new Microsoft.Xna.Framework.Color.$ctor7(255, 255, 255, 150);
                this.condClr = new Microsoft.Xna.Framework.Color.$ctor6(100, 100, 100);
                this.unitSize = 30;
                this.us2 = 15;
                this.cnstR = 50;
                this.cnstG = 130;
                this.cnstB = 200;
                this.cnstR2 = 120;
                this.cnstG2 = 190;
                this.cnstB2 = 230;
                this.startBuildingsList = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.deathlist = new (System.Collections.Generic.List$1(DarkKingdomCore.Unit)).ctor();
                this.flyHeight = 48;
                this.piece = 0.03926991;
                this.conds = new (System.Collections.Generic.List$1(DarkKingdomCore.MatchCondition)).ctor();
                this.edunits = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.symbols = System.Array.init(4, function (){
                    return new Microsoft.Xna.Framework.Rectangle();
                }, Microsoft.Xna.Framework.Rectangle);
                this.ispllmod = false;
                this.spellName = "";
                this.sunsetclr = Microsoft.Xna.Framework.Color.OrangeRed.$clone();
                this.bornList = new (System.Collections.Generic.List$1(DarkKingdomCore.Unit)).ctor();
                this.globalExplode = 0;
                this.unlockedUnits = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.unlockedAchivs = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.updateSpells = false;
                this.moneyClr = Microsoft.Xna.Framework.Color.Chocolate.$clone();
                this.deathClr = Microsoft.Xna.Framework.Color.RoyalBlue.$clone();
                this.AllUntsList = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.startAutofight = false;
                this.achivs = new (System.Collections.Generic.Dictionary$2(System.String,DarkKingdomCore.Achievement)).ctor();
                this.purchases = new (System.Collections.Generic.Dictionary$2(System.String,DarkKingdomCore.Purchase)).ctor();
                this.standartRaces = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.preGameUnits = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.preGameSpells = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.preGameBonus = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.preGameSlotCnt = 10;
                this.curCarouselPos = 0;
                this.numKeys = System.Array.init([Microsoft.Xna.Framework.Input.Keys.D1, Microsoft.Xna.Framework.Input.Keys.D2, Microsoft.Xna.Framework.Input.Keys.D3, Microsoft.Xna.Framework.Input.Keys.D4, Microsoft.Xna.Framework.Input.Keys.D5, Microsoft.Xna.Framework.Input.Keys.D6, Microsoft.Xna.Framework.Input.Keys.D7], Microsoft.Xna.Framework.Input.Keys);
                this.unitsPreGame = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.spellsPreGame = new (System.Collections.Generic.List$1(System.String)).ctor();
                this._screenWidth = 800;
                this._screenHeight = 480;
                this.scaleX = 1.0;
                this.scaleY = 1.0;
                this.listeningKeys = System.Array.init([Microsoft.Xna.Framework.Input.Keys.Enter, Microsoft.Xna.Framework.Input.Keys.Escape, Microsoft.Xna.Framework.Input.Keys.Left, Microsoft.Xna.Framework.Input.Keys.Right, Microsoft.Xna.Framework.Input.Keys.D1, Microsoft.Xna.Framework.Input.Keys.D2, Microsoft.Xna.Framework.Input.Keys.D3, Microsoft.Xna.Framework.Input.Keys.D4, Microsoft.Xna.Framework.Input.Keys.D5, Microsoft.Xna.Framework.Input.Keys.D6, Microsoft.Xna.Framework.Input.Keys.D7], Microsoft.Xna.Framework.Input.Keys);
                this.prgsProduction = System.Array.init(7, null, MonoInterface.Progress);
                this.btnsProduction = System.Array.init(7, null, MonoInterface.Button);
                this.lblsBasicParams = System.Array.init(3, null, MonoInterface.Label);
                this.lblsAbils = System.Array.init(6, null, MonoInterface.LongLabel);
            },
            ctor: function (platform) {
                this.$initialize();
                System.Object.call(this);
                this.Platform = platform;
                this.Fonts = new (System.Collections.Generic.List$1(System.ValueTuple$2(System.Int32,Microsoft.Xna.Framework.Graphics.SpriteFont))).ctor();
            }
        },
        methods: {
            LoadData: function (content) {
                System.Console.WriteLine("Start Localize");
                this.ReadLocalize();
                System.Console.WriteLine("Start Loading");

                this.ReadFonts(content);
                this.ReadSprites(content);
                this.ReadUnitsParams();
                this.ReadSpells();
                this.ReadRaces();

                System.Console.WriteLine("Start Initializing");

                this.Initialize();
            },
            LoadJSON: function (T, fname) {
                var file_reader = new System.IO.StreamReader.$ctor9(System.String.format("{0}/{1}", this.DataFolder, fname), System.Text.Encoding.UTF8);
                try {
                    var json = file_reader.ReadToEnd();
                    return Newtonsoft.Json.JsonConvert.DeserializeObject(json, T);
                }
                finally {
                    if (Bridge.hasValue(file_reader)) {
                        file_reader.System$IDisposable$Dispose();
                    }
                }
            },
            ReadFonts: function (content) {
                var $t;
                var fonts = this.LoadJSON(System.Array.type(System.String), "fonts.json");
                $t = Bridge.getEnumerator(fonts);
                try {
                    while ($t.moveNext()) {
                        var filename = $t.Current;
                        this.Fonts.add(new (System.ValueTuple$2(System.Int32,Microsoft.Xna.Framework.Graphics.SpriteFont)).$ctor1(System.Int32.parse(filename.substr(3)), content.Load(Microsoft.Xna.Framework.Graphics.SpriteFont, System.String.format("Fonts/{0}", [filename]))));
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                //#endif
            },
            ReadRaces: function () {
                var $t;
                var races_def = this.LoadJSON(System.Array.type(DarkKingdomCore.Race), "races.json");
                $t = Bridge.getEnumerator(races_def);
                try {
                    while ($t.moveNext()) {
                        var race = $t.Current;
                        DarkKingdomCore.RaceManager.Instance.All.add(race.name, race);
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            },
            ReadSpells: function () {
                var $t;
                var spells_def = this.LoadJSON(System.Array.type(DarkKingdomCore.Spell), "spells.json");
                $t = Bridge.getEnumerator(spells_def);
                try {
                    while ($t.moveNext()) {
                        var spell = $t.Current;
                        this.spells.add(spell.Name, spell);
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            },
            ReadUnitsParams: function () {
                var $t, $t1, $t2;
                var units_def = this.LoadJSON(System.Array.type(DarkKingdomCore.UnitParameters), "units.json");
                $t = Bridge.getEnumerator(units_def);
                try {
                    while ($t.moveNext()) {
                        var unit = $t.Current.$clone();
                        var new_unit = unit.$clone();
                        new_unit.spriteName = unit.Name.toLowerCase();
                        new_unit.animated = DarkKingdomCore.MyGame.sprites.getItem(unit.Name.toLowerCase()).Ranges.containsKey("Attack");
                        new_unit.iconApp = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("unit_icons"), new_unit.iconInd);
                        new_unit.abils = new (System.Collections.Generic.Dictionary$2(System.String,DarkKingdomCore.Ability)).ctor();
                        if (new_unit.rawAbils != null) {
                            $t1 = Bridge.getEnumerator(new_unit.rawAbils);
                            try {
                                while ($t1.moveNext()) {
                                    var abil = $t1.Current;
                                    new_unit.abils.add(abil.name, abil);
                                }
                            } finally {
                                if (Bridge.is($t1, System.IDisposable)) {
                                    $t1.System$IDisposable$Dispose();
                                }
                            }
                        }
                        if (unit.size.w > 0) {
                            new_unit.rect = new Microsoft.Xna.Framework.Rectangle.$ctor2(((Bridge.Int.div(((-unit.size.w) | 0), 2)) | 0), ((-unit.size.h) | 0), unit.size.w, unit.size.h);
                        } else {
                            new_unit.rect = new Microsoft.Xna.Framework.Rectangle.$ctor2(((-this.us2) | 0), ((-this.unitSize) | 0), this.unitSize, this.unitSize);
                        }
                        new_unit.isBuilding = new_unit.abils.containsKey("Building");
                        if (new_unit.abils.containsKey("Unique") || new_unit.abils.containsKey("Heroic")) {
                            new_unit.maxLimit = 1;
                        } else if (new_unit.abils.containsKey("Elite")) {
                            new_unit.maxLimit = 3;
                        }
                        new_unit.isHeroic = new_unit.abils.containsKey("Heroic");
                        if (new_unit.abils.containsKey("Huge")) {
                            new_unit.moveType = DarkKingdomCore.UnitMoveType.HugeMT;
                        } else if (new_unit.abils.containsKey("Flying")) {
                            new_unit.moveType = DarkKingdomCore.UnitMoveType.FlyingMT;
                        } else {
                            new_unit.moveType = DarkKingdomCore.UnitMoveType.GroundMT;
                        }
                        var remAbils = System.Array.init(["Heroic", "Unique", "Elite", "Flying", "Huge", ""], System.String);
                        $t2 = Bridge.getEnumerator(remAbils);
                        try {
                            while ($t2.moveNext()) {
                                var ab = $t2.Current;
                                if (new_unit.abils.containsKey(ab)) {
                                    new_unit.abils.remove(ab);
                                }
                            }
                        } finally {
                            if (Bridge.is($t2, System.IDisposable)) {
                                $t2.System$IDisposable$Dispose();
                            }
                        }
                        if (unit.isStartBuilding) {
                            this.startBuildingsList.add(unit.Name);
                        }
                        DarkKingdomCore.MyGame.unitPrms.add(unit.Name, new_unit.$clone());
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            },
            ReadSprites: function (content) {
                var $t;
                var sprites_def = this.LoadJSON(System.Array.type(MonoInterface.Sprite), "sprites.json");
                $t = Bridge.getEnumerator(sprites_def);
                try {
                    while ($t.moveNext()) {
                        var sprite = $t.Current;
                        sprite.Texture = content.Load(Microsoft.Xna.Framework.Graphics.Texture2D, System.String.format("Sprites/{0}", [sprite.Name]));
                        System.Console.WriteLine(System.String.format("Sprite '{0}' loaded", [sprite.Name]));
                        DarkKingdomCore.MyGame.sprites.add(sprite.Name, sprite);
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            },
            ReadLocalize: function () {
                var $t;
                var loaded = this.LoadJSON(System.Collections.Generic.Dictionary$2(System.String,System.String), "localize-ru.json");
                var result = new (System.Collections.Generic.Dictionary$2(System.String,System.String)).ctor();
                $t = Bridge.getEnumerator(loaded);
                try {
                    while ($t.moveNext()) {
                        var kvp = $t.Current;
                        var is_fallback = System.String.contains(kvp.value,"\ufffd");
                        result.add(kvp.key, System.String.replaceAll(kvp.value, String.fromCharCode(65533), String.fromCharCode(63)));
                        if (is_fallback) {
                            System.Console.WriteLine(kvp.value);
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                this.localize = new MonoInterface.Localization("\u0420\u0443\u0441\u0441\u043a\u0438\u0439", result);
            },
            Explode: function (u, ignoreArmor) {
                var $t, $t1;
                var bonus = 1;
                $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                try {
                    while ($t.moveNext()) {
                        var uu = $t.Current;
                        if (uu.AbsContains("Explode_bonus")) {
                            bonus = Bridge.Int.mul(bonus, 3);
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                $t1 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                try {
                    while ($t1.moveNext()) {
                        var uu1 = $t1.Current;
                        if (u.Near(uu1)) {
                            if (!uu1.AbsContains("Explode_protect")) {
                                this.Harm(uu1, Bridge.Int.mul(DarkKingdomCore.MyGame.rnd.Next$2(70, 101), bonus), ignoreArmor, DarkKingdomCore.EffectType.Normal);
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t1, System.IDisposable)) {
                        $t1.System$IDisposable$Dispose();
                    }
                }
                if (ignoreArmor) {
                    DarkKingdomCore.MyGame.pars.add(new DarkKingdomCore.ImageParticle(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("explode"), 3), u.x - 25, ((((((DarkKingdomCore.MyGame.hor + u.parameters.rect.Bottom) | 0) - this.us2) | 0) - 25) | 0), 0, 0, 20));
                } else {
                    DarkKingdomCore.MyGame.pars.add(new DarkKingdomCore.ImageParticle(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("explode"), 0), u.x - 25, ((((((DarkKingdomCore.MyGame.hor + u.parameters.rect.Bottom) | 0) - this.us2) | 0) - 25) | 0), 0, 0, 20));
                }
            },
            Heal: function (u, val, repair) {
                if (repair === void 0) { repair = false; }
                if (u.hp < u.parameters.maxhp && !u.AbsContains$1(["Bodyless", "Nonhealing_wounds", "Building"]) && (!u.AbsContains("Machinery") || repair)) {
                    var realval = Math.min(val, u.parameters.maxhp - u.hp);
                    u.hp += realval;
                    this.ShowInfoPar(System.String.format("+{0}", [realval]), DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), false);
                    if (!repair && u.AbsContains("Life_rollback")) {
                        u.Attack = DarkKingdomCore.Attack.op_Addition$1(u.Attack.$clone(), (u.abils.getItem("Life_rollback").value) | 0);
                    }
                }
            },
            Harm: function (u, val, ignorearmor, dt) {
                var $t;
                if (!u.AbsContains("Invulnerable")) {
                    if (!ignorearmor) {
                        val *= u.parameters._armor;
                    }
                    if (val < 1) {
                        val = 1;
                    }
                    u.hp -= val;
                    switch (dt) {
                        case DarkKingdomCore.EffectType.Normal: 
                            {
                                this.ShowInfoPar("-" + (System.Single.format(val) || ""), Microsoft.Xna.Framework.Color.Red.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), false);
                                break;
                            }
                        case DarkKingdomCore.EffectType.Bad: 
                            {
                                this.ShowInfoPar("-" + (System.Single.format(val) || ""), DarkKingdomCore.MyGame.badAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), false);
                                break;
                            }
                        case DarkKingdomCore.EffectType.Poison: 
                            {
                                this.ShowInfoPar("-" + (System.Single.format(val) || ""), DarkKingdomCore.MyGame.poiAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), false);
                                break;
                            }
                    }
                    if (u.AbsContains("Invisible")) {
                        this.Deinvisible(u);
                    }
                    $t = Bridge.getEnumerator(u.abils.Values);
                    try {
                        while ($t.moveNext()) {
                            var a = $t.Current;
                            if (Bridge.referenceEquals(a.condition, "On_harm") && !a.used) {
                                a.condCompleted = true;
                            }
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                    if (u.AbsContains("Damage_mirror") && DarkKingdomCore.MyGame.plrs[((1 - u.owner) | 0)].heroUnit != null) {
                        this.Harm(DarkKingdomCore.MyGame.plrs[((1 - u.owner) | 0)].heroUnit, val, true, DarkKingdomCore.EffectType.Bad);
                    }
                } else {
                    this.ShowInfoPar("0", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), false);
                }
            },
            Deinvisible: function (u) {
                u.abils.getItem("Invisible").used = true;
                DarkKingdomCore.MyGame.pars.add(new DarkKingdomCore.ImageParticle(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("explode"), 2), u.x - 25, ((((((DarkKingdomCore.MyGame.hor + u.parameters.rect.Bottom) | 0) - this.us2) | 0) - 25) | 0), 0, 0, 20));
            },
            SetPlayers: function () {
                DarkKingdomCore.MyGame.plrs[0] = new DarkKingdomCore.Player(this, 0, false, 30);
                DarkKingdomCore.MyGame.plrs[1] = new DarkKingdomCore.Player(this, 1, true, 30);

                DarkKingdomCore.MyGame.plrs[0].moveside = 1;
                DarkKingdomCore.MyGame.plrs[1].moveside = -1;
            },
            UpdateQueue: function () {
                for (var i = 0; i <= 6; i = (i + 1) | 0) {
                    var btn = this.btnsProduction[i];
                    if (i < DarkKingdomCore.MyGame.plrs[0].readyUnits.Count) {
                        btn.Visible = true;
                        (Bridge.as(btn.Children.getItem(0), MonoInterface.Picture)).spriteRef = DarkKingdomCore.MyGame.unitPrms.getItem(DarkKingdomCore.MyGame.plrs[0].readyUnits.getItem(i)).$clone().iconApp.$clone();
                        btn.Children.getItem(1).Visible = true;
                        this.prgsProduction[i].CurrentValue = 0;
                    } else if (((i - DarkKingdomCore.MyGame.plrs[0].readyUnits.Count) | 0) < DarkKingdomCore.MyGame.plrs[0].prdQ.Count) {
                        btn.Visible = true;
                        btn.Children.getItem(1).Visible = false;
                        (Bridge.as(btn.Children.getItem(0), MonoInterface.Picture)).spriteRef = DarkKingdomCore.MyGame.unitPrms.getItem(DarkKingdomCore.MyGame.plrs[0].prdQ.getItem(((i - DarkKingdomCore.MyGame.plrs[0].readyUnits.Count) | 0))).$clone().iconApp.$clone();
                        if (i === DarkKingdomCore.MyGame.plrs[0].readyUnits.Count) {
                            this.prgsProduction[i].CurrentValue = DarkKingdomCore.MyGame.plrs[0].prdPrg;
                            this.prgsProduction[i].MaxValue = DarkKingdomCore.MyGame.unitPrms.getItem(DarkKingdomCore.MyGame.plrs[0].prdQ.getItem(0)).$clone().Cost.Time;
                        } else {
                            this.prgsProduction[i].CurrentValue = 0;
                        }
                    } else {
                        btn.Visible = false;
                    }
                }
                if (DarkKingdomCore.MyGame.plrs[0].prdQ.Count === 0 && DarkKingdomCore.MyGame.plrs[0].readyUnits.Count === 0) {
                    this.frmProduction.Hide(this.mainAnimator);
                } else {
                    this.frmProduction.Show(this.mainAnimator);
                }
            },
            UpdateResources: function () {
                this.lblGoldFrmResources.Text = Bridge.toString(this.curM);
                this.lblDeathFrmResources.Text = Bridge.toString(this.curD);

                for (var i = 0; i < DarkKingdomCore.MyGame.plrs[0].unitsList.Count; i = (i + 1) | 0) {
                    (Bridge.as(this.cUnits.Children.getItem(i), MonoInterface.Button)).IsDisabled = !DarkKingdomCore.MyGame.plrs[0].CheckForProduce(DarkKingdomCore.MyGame.plrs[0].unitsList.getItem(i));
                }

                var tier = DarkKingdomCore.MyGame.plrs[0].res.Tier === 1 ? "Tier_2" : "Tier_3";
                this.btnTierUpFrmResources.IsDisabled = !DarkKingdomCore.MyGame.plrs[0].res.EnoughFor(DarkKingdomCore.MyGame.unitPrms.getItem(tier).$clone().Cost.$clone()) || DarkKingdomCore.MyGame.plrs[0].prdQ.contains(tier) || DarkKingdomCore.MyGame.plrs[0].res.Tier === 3;

                for (var i1 = 0; i1 < DarkKingdomCore.MyGame.plrs[0].spllsList.Count; i1 = (i1 + 1) | 0) {
                    (Bridge.as(this.cSpells.Children.getItem(i1), MonoInterface.Button)).IsDisabled = !DarkKingdomCore.MyGame.plrs[0].res.EnoughFor(this.spells.getItem(DarkKingdomCore.MyGame.plrs[0].spllsList.getItem(i1)).Cost.$clone());
                }
            },
            OnDead: function (u) {
                var $t, $t1, $t2, $t3, $t4, $t5, $t6, $t7, $t8, $t9, $t10, $t11, $t12;
                $t = Bridge.getEnumerator(u.abils.Values);
                try {
                    while ($t.moveNext()) {
                        var a = $t.Current;
                        if (Bridge.referenceEquals(a.condition, "On_death")) {
                            a.condCompleted = true;
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                this.OnUnitsAbils(u);
                if (!u.parameters.isBuilding) {
                    var needInfo;
                    $t1 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                    try {
                        while ($t1.moveNext()) {
                            var uu = $t1.Current;
                            needInfo = false;
                            if (!Bridge.referenceEquals(uu, u)) {
                                if (uu.AbsContains("Death_reaper")) {
                                    uu.Attack = DarkKingdomCore.Attack.op_Addition$1(uu.Attack.$clone(), (uu.abils.getItem("Death_reaper").value) | 0);
                                    needInfo = true;
                                }
                                $t2 = Bridge.getEnumerator(uu.abils.Values);
                                try {
                                    while ($t2.moveNext()) {
                                        var a1 = $t2.Current;
                                        if (Bridge.referenceEquals(a1.condition, "Death")) {
                                            a1.condnum = (a1.condnum - 1) | 0;
                                            if (a1.condnum === 0) {
                                                a1.condition = "";
                                                a1.condCompleted = true;
                                            }
                                            needInfo = true;
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t2, System.IDisposable)) {
                                        $t2.System$IDisposable$Dispose();
                                    }
                                }
                                if (uu.AbsContains("Spawn_ghosts") && !u.AbsContains("Bodyless")) {
                                    var allunitst = new (System.Collections.Generic.List$1(System.String)).ctor();
                                    var nu;
                                    $t3 = Bridge.getEnumerator(DarkKingdomCore.MyGame.unitPrms.Values);
                                    try {
                                        while ($t3.moveNext()) {
                                            var up = $t3.Current.$clone();
                                            if (!up.special) {
                                                if (up.AbsContains("Bodyless") && up.Cost.Tier === u.parameters.Cost.Tier && DarkKingdomCore.MyGame.plrs[uu.owner].CheckForLimit(up.Name)) {
                                                    allunitst.add(up.Name);
                                                }
                                            }
                                        }
                                    } finally {
                                        if (Bridge.is($t3, System.IDisposable)) {
                                            $t3.System$IDisposable$Dispose();
                                        }
                                    }
                                    if (allunitst.Count > 0) {
                                        nu = ($t4 = new DarkKingdomCore.Unit(this, uu.x + uu.moveside, uu.moveside, uu.owner, DarkKingdomCore.MyGame.unitPrms.getItem(allunitst.getItem(DarkKingdomCore.MyGame.rnd.Next$2(0, allunitst.Count))).$clone()), $t4.hp = DarkKingdomCore.MyGame.rnd.Next$2(70, 101), $t4);
                                        this.Harm(uu, nu.hp, true, DarkKingdomCore.EffectType.Bad);
                                        this.bornList.add(nu);
                                        needInfo = true;
                                    }
                                }
                                if (needInfo) {
                                    this.ShowInfoPar("\u0421\u043c\u0435\u0440\u0442\u044c!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), uu.x, ((DarkKingdomCore.MyGame.hor + uu.parameters.rect.Top) | 0), true);
                                }
                            }
                            if (uu.owner !== u.owner && uu.AbsContains("Looter") && u.Near(uu)) {
                                DarkKingdomCore.MyGame.plrs[uu.owner].Resources = DarkKingdomCore.TimeCost.op_Addition(DarkKingdomCore.MyGame.plrs[uu.owner].Resources.$clone(), new DarkKingdomCore.TimeCost.$ctor1(uu.abils.getItem("Looter").value, 0, 0, 0));
                                this.ShowInfoPar(System.String.format("+{0}", [uu.abils.getItem("Looter").value]), this.moneyClr.$clone(), uu.x, ((DarkKingdomCore.MyGame.hor + uu.parameters.rect.Top) | 0), true);
                            }
                            if (uu.owner !== u.owner && uu.AbsContains("Invisible_on_kill") && u.Near(uu)) {
                                uu.AddAbility$1("Invisible", DarkKingdomCore.EffectType.Normal);
                                this.ShowInfoPar("\u0418\u0441\u0447\u0435\u0437!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), uu.x, ((DarkKingdomCore.MyGame.hor + uu.parameters.rect.Top) | 0), true);
                            }
                            if (u.owner !== uu.owner && uu.AbsContains("Necromancy") && !u.AbsContains$1(["Undead", "Machinery"])) {
                                this.bornList.add(new DarkKingdomCore.Unit(this, u.x, uu.moveside, uu.owner, DarkKingdomCore.MyGame.unitPrms.getItem("Skeleton_squad").$clone()));
                                this.ShowInfoPar("\u041e\u0436\u0438\u0432\u043b\u0435\u043d!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                            }
                            if (u.deathFromPoison && uu.AbsContains("Flizard spawner")) {
                                this.bornList.add(new DarkKingdomCore.Unit(this, uu.x, uu.moveside, uu.owner, DarkKingdomCore.MyGame.unitPrms.getItem("Flizard").$clone()));
                                this.ShowInfoPar("\u041f\u043e\u0440\u043e\u0436\u0434\u0435\u043d!", DarkKingdomCore.MyGame.poiAbilClr.$clone(), uu.x, ((DarkKingdomCore.MyGame.hor + uu.parameters.rect.Top) | 0), true);
                            }
                            if (uu.owner !== u.owner && uu.AbsContains("Corpseeating") && u.Near(uu)) {
                                if (uu.hp < uu.parameters.maxhp) {
                                    this.Heal(uu, uu.parameters.maxhp - uu.hp);
                                }
                                if (uu.AbsContains("Devour")) {
                                    if (uu.abils.containsKey("Denying")) {
                                        uu.abils.getItem("Denying").value = (uu.abils.getItem("Denying").value + 50) | 0;
                                    }
                                }
                                this.ShowInfoPar("\u041e\u0431\u0435\u0434!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), uu.x, ((DarkKingdomCore.MyGame.hor + uu.parameters.rect.Top) | 0), true);
                            }
                            if (uu.AbsContains("Execution") && u.Near(uu)) {
                                ($t4 = DarkKingdomCore.MyGame.plrs[uu.owner]).victimcount = ($t4.victimcount + 1) | 0;
                                if (DarkKingdomCore.MyGame.plrs[uu.owner].victimcount >= 13) {
                                    var avunits = new (System.Collections.Generic.List$1(System.String)).ctor();
                                    $t5 = Bridge.getEnumerator(DarkKingdomCore.MyGame.unitPrms.Values);
                                    try {
                                        while ($t5.moveNext()) {
                                            var upstr = $t5.Current.$clone();
                                            if (Bridge.referenceEquals(upstr.Subrace, "Monster")) {
                                                avunits.add(upstr.Name);
                                            }
                                        }
                                    } finally {
                                        if (Bridge.is($t5, System.IDisposable)) {
                                            $t5.System$IDisposable$Dispose();
                                        }
                                    }
                                    this.bornList.add(new DarkKingdomCore.Unit(this, u.x, uu.moveside, uu.owner, DarkKingdomCore.MyGame.unitPrms.getItem(avunits.getItem(DarkKingdomCore.MyGame.rnd.Next$1(avunits.Count))).$clone()));
                                    ($t6 = DarkKingdomCore.MyGame.plrs[uu.owner]).victimcount = ($t6.victimcount - 13) | 0;
                                    this.ShowInfoPar("\u0412\u044b\u0437\u0432\u0430\u043d!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                                } else {
                                    this.ShowInfoPar(System.String.format("\u0415\u0449\u0435 {0}", [((13 - DarkKingdomCore.MyGame.plrs[uu.owner].victimcount) | 0)]), DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                                }
                            }
                        }
                    } finally {
                        if (Bridge.is($t1, System.IDisposable)) {
                            $t1.System$IDisposable$Dispose();
                        }
                    }
                }
                if (u.AbsContains("Victim")) {
                    ($t7 = DarkKingdomCore.MyGame.plrs[u.owner]).victimcount = ($t7.victimcount + 1) | 0;
                    if (DarkKingdomCore.MyGame.plrs[u.owner].victimcount >= 13) {
                        var avunits1 = new (System.Collections.Generic.List$1(System.String)).ctor();
                        $t8 = Bridge.getEnumerator(DarkKingdomCore.MyGame.unitPrms.Values);
                        try {
                            while ($t8.moveNext()) {
                                var upstr1 = $t8.Current.$clone();
                                if (Bridge.referenceEquals(upstr1.Subrace, "Monster")) {
                                    avunits1.add(upstr1.Name);
                                }
                            }
                        } finally {
                            if (Bridge.is($t8, System.IDisposable)) {
                                $t8.System$IDisposable$Dispose();
                            }
                        }
                        this.bornList.add(new DarkKingdomCore.Unit(this, u.x, u.moveside, u.owner, DarkKingdomCore.MyGame.unitPrms.getItem(avunits1.getItem(DarkKingdomCore.MyGame.rnd.Next$1(avunits1.Count))).$clone()));
                        ($t9 = DarkKingdomCore.MyGame.plrs[u.owner]).victimcount = ($t9.victimcount - 13) | 0;
                        this.ShowInfoPar("\u0412\u044b\u0437\u0432\u0430\u043d!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                    } else {
                        this.ShowInfoPar(System.String.format("\u0415\u0449\u0435 {0}", [((13 - DarkKingdomCore.MyGame.plrs[u.owner].victimcount) | 0)]), DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                    }
                }
                if (u.AbsContains("Immortal") && DarkKingdomCore.MyGame.plrs[u.owner].res.Death >= 5) {
                    ($t10 = DarkKingdomCore.MyGame.plrs[u.owner].res.$clone()).Death = ($t10.Death - 5) | 0;
                    u.hp = u.parameters.maxhp;
                    this.ShowInfoPar("\u0418\u043d\u043a\u0430\u0440\u043d\u0430\u0446\u0438\u044f", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                    return false;
                }
                if (u.AbsContains("Incarnation") && DarkKingdomCore.MyGame.rnd.Next$1(100) < 25) {
                    u.hp = u.parameters.maxhp;
                    this.ShowInfoPar("\u0418\u043d\u043a\u0430\u0440\u043d\u0430\u0446\u0438\u044f", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                    return false;
                }
                if (u.AbsContains("Unterminate")) {
                    u.abils.getItem("Unterminate").used = true;
                    u.hp = 1;
                    u.AddAbility$2("Invulnerable", 400, DarkKingdomCore.EffectType.Good);
                    return false;
                }
                if (!u.AbsContains("Bodyless")) {
                    var ltime = 7200;
                    if (u.parameters.isBuilding) {
                        ltime = -1;
                    }
                    DarkKingdomCore.MyGame.pars.add(new DarkKingdomCore.ImageParticle(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem(u.parameters.spriteName), DarkKingdomCore.MyGame.sprites.getItem(u.parameters.spriteName).Ranges.getItem("Corpse").$clone().Item2), u.x + u.parameters.imgx - this.us2, ((((((DarkKingdomCore.MyGame.hor + u.parameters.rect.Bottom) | 0) - 30) | 0) + 2) | 0), 0, 5, ltime, u.moveside === -1));
                }
                var val;
                if (u.parameters.Cost.Money < 50) {
                    val = 1;
                } else if (u.parameters.Cost.Money < 150) {
                    val = 2;
                } else if (u.parameters.Cost.Money < 250) {
                    val = 5;
                } else {
                    val = 10;
                }
                if (u.owner === 1) {
                    ($t11 = DarkKingdomCore.MyGame.plrs[0].res.$clone()).Death = ($t11.Death + val) | 0;
                    this.ShowInfoPar("+" + val, this.deathClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                } else if (u.owner === 0) {
                    ($t12 = DarkKingdomCore.MyGame.plrs[1].res.$clone()).Death = ($t12.Death + val) | 0;
                }
                if (Bridge.referenceEquals(u, this.selU)) {
                    this.selU = null;
                }
                return true;
            },
            RandomizeUnits: function (ucnt, uList, specialhero) {
                var $t, $t1;
                var unts = new (System.Collections.Generic.List$1(System.String)).ctor();
                if (ucnt > 0) {
                    var allunitst1 = new (System.Collections.Generic.List$1(System.String)).ctor();
                    var allunitst2 = new (System.Collections.Generic.List$1(System.String)).ctor();
                    var allunitst3 = new (System.Collections.Generic.List$1(System.String)).ctor();
                    var allunitscount = 0;

                    var allunits = new (System.Collections.Generic.List$1(System.String)).ctor();
                    var herounits = new (System.Collections.Generic.List$1(System.String)).ctor();

                    var t1cnt, t2cnt, t3cnt;
                    var u;


                    $t = Bridge.getEnumerator(uList);
                    try {
                        while ($t.moveNext()) {
                            var up = $t.Current;
                            if (specialhero) {
                                if (DarkKingdomCore.MyGame.unitPrms.getItem(up).$clone().isHeroic) {
                                    herounits.add(up);
                                } else {
                                    allunits.add(up);
                                }
                            } else {
                                allunits.add(up);
                            }
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }

                    if (specialhero && herounits.Count > 0) {
                        unts.add(herounits.getItem(DarkKingdomCore.MyGame.rnd.Next$1(herounits.Count)));
                        ucnt = (ucnt - 1) | 0;
                    }

                    $t1 = Bridge.getEnumerator(allunits);
                    try {
                        while ($t1.moveNext()) {
                            var up1 = $t1.Current;
                            switch (DarkKingdomCore.MyGame.unitPrms.getItem(up1).$clone().Cost.Tier) {
                                case 1: 
                                    {
                                        allunitst1.add(up1);
                                        break;
                                    }
                                case 2: 
                                    {
                                        allunitst2.add(up1);
                                        break;
                                    }
                                case 3: 
                                    {
                                        allunitst3.add(up1);
                                        break;
                                    }
                            }
                            allunitscount = (allunitscount + 1) | 0;
                        }
                    } finally {
                        if (Bridge.is($t1, System.IDisposable)) {
                            $t1.System$IDisposable$Dispose();
                        }
                    }

                    if (allunitscount < ucnt) {
                        ucnt = allunitscount;
                    }

                    t3cnt = 1;
                    t2cnt = (Bridge.Int.div((((ucnt - t3cnt) | 0)), 2)) | 0;
                    t1cnt = (((ucnt - t2cnt) | 0) - t3cnt) | 0;

                    if (t1cnt === 0 && t2cnt === 0 && allunitst2.Count > 0) {
                        t2cnt = 1;
                    }


                    while (t3cnt > 0 && allunitst3.Count > 0) {
                        u = DarkKingdomCore.MyGame.rnd.Next$1(allunitst3.Count);
                        unts.add(allunitst3.getItem(u));
                        allunitst3.removeAt(u);
                        t3cnt = (t3cnt - 1) | 0;
                    }

                    t1cnt = (t1cnt + t3cnt) | 0;

                    while (t1cnt > 0 && allunitst1.Count > 0) {
                        u = DarkKingdomCore.MyGame.rnd.Next$1(allunitst1.Count);
                        unts.add(allunitst1.getItem(u));
                        allunitst1.removeAt(u);
                        t1cnt = (t1cnt - 1) | 0;
                    }

                    t2cnt = (t2cnt + t1cnt) | 0;

                    while (t2cnt > 0 && allunitst2.Count > 0) {
                        u = DarkKingdomCore.MyGame.rnd.Next$1(allunitst2.Count);
                        unts.add(allunitst2.getItem(u));
                        allunitst2.removeAt(u);
                        t2cnt = (t2cnt - 1) | 0;
                    }
                    unts = this.SortUnitsLists(unts);
                }

                return unts;
            },
            RandomizeSpells: function (sCnt, sList) {
                var $t;
                var splls = new (System.Collections.Generic.List$1(System.String)).ctor();
                if (sCnt > 0) {
                    var spellst1 = new (System.Collections.Generic.List$1(System.String)).ctor();
                    var spellst2 = new (System.Collections.Generic.List$1(System.String)).ctor();
                    var spellst3 = new (System.Collections.Generic.List$1(System.String)).ctor();


                    var t1cnt, t2cnt, t3cnt;
                    var u;

                    $t = Bridge.getEnumerator(sList);
                    try {
                        while ($t.moveNext()) {
                            var sp = $t.Current;
                            switch (this.spells.getItem(sp).Cost.Tier) {
                                case 1: 
                                    {
                                        spellst1.add(sp);
                                        break;
                                    }
                                case 2: 
                                    {
                                        spellst2.add(sp);
                                        break;
                                    }
                                case 3: 
                                    {
                                        spellst3.add(sp);
                                        break;
                                    }
                            }
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }

                    t3cnt = (Bridge.Int.div(sCnt, 3)) | 0;
                    t2cnt = (Bridge.Int.div(sCnt, 3)) | 0;
                    t1cnt = (((sCnt - t2cnt) | 0) - t3cnt) | 0;


                    while (t1cnt > 0 && spellst1.Count > 0) {
                        u = DarkKingdomCore.MyGame.rnd.Next$1(spellst1.Count);
                        splls.add(spellst1.getItem(u));
                        spellst1.removeAt(u);
                        t1cnt = (t1cnt - 1) | 0;
                    }

                    t2cnt = (t2cnt + t1cnt) | 0;

                    while (t2cnt > 0 && spellst2.Count > 0) {
                        u = DarkKingdomCore.MyGame.rnd.Next$1(spellst2.Count);
                        splls.add(spellst2.getItem(u));
                        spellst2.removeAt(u);
                        t2cnt = (t2cnt - 1) | 0;
                    }

                    t3cnt = (t3cnt + t2cnt) | 0;

                    while (t3cnt > 0 && spellst3.Count > 0) {
                        u = DarkKingdomCore.MyGame.rnd.Next$1(spellst3.Count);
                        splls.add(spellst3.getItem(u));
                        spellst3.removeAt(u);
                        t3cnt = (t3cnt - 1) | 0;
                    }

                    splls = this.SortSpellsLists(splls);
                }

                return splls;
            },
            RandomizeBuildings: function (bCnt, bList) {
                var buildings = new (System.Collections.Generic.List$1(System.String)).ctor();

                if (bCnt > 0) {
                    var tmpBldList = new (System.Collections.Generic.List$1(System.String)).ctor();
                    tmpBldList.AddRange(bList);
                    var r;
                    while (bCnt > 0 && tmpBldList.Count > 0) {
                        r = DarkKingdomCore.MyGame.rnd.Next$1(tmpBldList.Count);
                        buildings.add(tmpBldList.getItem(r));
                        tmpBldList.removeAt(r);
                        bCnt = (bCnt - 1) | 0;
                    }
                }

                return buildings;
            },
            btnSpell_Clicked: function (btn, isTouch) {
                var ind = this.cSpells.Children.indexOf(btn);
                if ((DarkKingdomCore.MyGame.plrs[0].spellsRchrg.getItem(ind) === 0)) {
                    if (this.spells.getItem(DarkKingdomCore.MyGame.plrs[0].spllsList.getItem(ind)).Target === DarkKingdomCore.Spell.TargetType.Unit) {
                        this.inSpellMode = true;
                        this.spellName = DarkKingdomCore.MyGame.plrs[0].spllsList.getItem(ind);
                    } else {
                        this.DoGlobalSpells(DarkKingdomCore.MyGame.plrs[0].spllsList.getItem(ind));
                    }
                }
            },
            btnSpell_Focused: function (btn, isTouch) {
                var ind = this.cSpells.Children.indexOf(btn);
                var spl = this.spells.getItem(DarkKingdomCore.MyGame.plrs[0].spllsList.getItem(ind));
                this.ShowMoreInfo(spl.Cost.$clone(), true, Bridge.getDefaultValue(Microsoft.Xna.Framework.Point), [this.localize.GetString(spl.Name), this.localize.GetString$1(spl.School, [spl.Cost.Tier]), spl.Description]);
            },
            SetSpells: function () {
                if (DarkKingdomCore.MyGame.plrs[0].spllsList.Count > 0) {
                    this.cSpells.Children.clear();
                    var d = 0;
                    var oldt = this.spells.getItem(DarkKingdomCore.MyGame.plrs[0].spllsList.getItem(0)).Cost.Tier;
                    for (var i = 0; i < DarkKingdomCore.MyGame.plrs[0].spllsList.Count; i = (i + 1) | 0) {
                        if (this.spells.getItem(DarkKingdomCore.MyGame.plrs[0].spllsList.getItem(i)).Cost.Tier !== oldt) {
                            d = (d + 7) | 0;
                            oldt = this.spells.getItem(DarkKingdomCore.MyGame.plrs[0].spllsList.getItem(i)).Cost.Tier;
                        }

                        var btn = this.cSpells.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor1(Bridge.fn.cacheBind(this, this.btnSpell_Clicked), Bridge.fn.cacheBind(this, this.btnSpell_Focused), this.numKeys[i], ((Bridge.Int.mul(i, 70) + d) | 0), 0, 60, 60, 0.0, 0.5, true));
                        btn.AddChild(MonoInterface.Picture, new MonoInterface.Picture(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("spells_icons"), this.spells.getItem(DarkKingdomCore.MyGame.plrs[0].spllsList.getItem(i)).Img), 0, 0, 60, 60, 0.5, 0.5, true));
                        btn.AddChild(MonoInterface.Progress, new MonoInterface.Progress(0, 0, 0, 0, 60, 60, 0));
                        DarkKingdomCore.MyGame.plrs[0].spellsRchrg.add(0);
                    }
                    this.cSpells.ApplyTheme(this.defaultTheme);
                    this.cSpells.W = System.Linq.Enumerable.from(this.cSpells.Children, MonoInterface.Block).last().FinalRight;
                    this.btnSelectSpells.IsDisabled = false;
                } else {
                    this.btnSelectSpells.IsDisabled = true;
                }
            },
            CreateAchievements: function () {
                this.achivs.add("Startpath", new DarkKingdomCore.Achievement("Startpath", new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("bonus_icons"), 3), "5crystals"));
                this.achivs.add("Alittleharder", new DarkKingdomCore.Achievement("Alittleharder", new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("medium_icons"), 11), "10crystals"));

                this.achivs.add("Gentleleader", new DarkKingdomCore.Achievement("Gentleleader", new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("bonus_icons"), 8), "25crystals"));


                // achivs.Add("Sacrifaceinbattle", New Achievement("Sacrifaceinbattle", New MonoInterface.Appearance(sprites["units_icons"], 113)))
                this.achivs.add("Truemage", new DarkKingdomCore.Achievement("Truemage", new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("bonus_icons"), 1), "25crystals"));

                this.achivs.add("Openeditor", new DarkKingdomCore.Achievement("Openeditor", new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("big_icons"), 2), "1unit"));
                this.achivs.add("Shamecheaters", new DarkKingdomCore.Achievement("Shamecheaters", new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("bonus_icons"), 7), "1unit"));

                this.achivs.add("Firstpurchase", new DarkKingdomCore.Achievement("Firstpurchase", new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("bonus_icons"), 0), "1unit"));
            },
            CreatePurchases: function () {
                this.purchases.add("Buster1T", new DarkKingdomCore.Purchase("Buster1T", new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("purchase_icons"), 2), 5));


                this.purchases.add("Buster2T", new DarkKingdomCore.Purchase("Buster2T", new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("purchase_icons"), 3), 10));


                this.purchases.add("Buster3T", new DarkKingdomCore.Purchase("Buster3T", new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("purchase_icons"), 1), 25));


                this.purchases.add("Herobuster", new DarkKingdomCore.Purchase("Herobuster", new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("purchase_icons"), 0), 25));
            },
            RotateCarousel: function (frm) {
                var trgPos = this.menuCarousel.indexOf(frm);
                if (trgPos > -1) {
                    if (trgPos > this.curCarouselPos) {
                        var frm2 = this.menuCarousel.getItem(this.curCarouselPos);
                        this.mainAnimator.AddChild(MonoInterface.NumberAnimation, new MonoInterface.NumberAnimation("X", 0, -400, -50, void 0, function () {
                            frm2.Visible = false;
                        }, frm2)).Begin();
                        frm.Y = 0;
                        frm.Visible = true;
                        this.mainAnimator.AddChild(MonoInterface.NumberAnimation, new MonoInterface.NumberAnimation("X", 400, 0, -50, void 0, void 0, frm)).Begin();
                    } else if (trgPos < this.curCarouselPos) {
                        var frm21 = this.menuCarousel.getItem(this.curCarouselPos);
                        this.mainAnimator.AddChild(MonoInterface.NumberAnimation, new MonoInterface.NumberAnimation("X", 0, 400, 50, void 0, function () {
                            frm21.Visible = false;
                        }, frm21)).Begin();
                        frm.Y = 0;
                        frm.Visible = true;
                        this.mainAnimator.AddChild(MonoInterface.NumberAnimation, new MonoInterface.NumberAnimation("X", -400, 0, 50, void 0, void 0, frm)).Begin();
                    } else {
                        frm.Visible = true;
                        if (frm.Y < 0) {
                            this.mainAnimator.AddChild(MonoInterface.NumberAnimation, new MonoInterface.NumberAnimation("Y", frm.Y, 0, 50, void 0, void 0, frm)).Begin();
                        } else {
                            if (frm.Y > 0) {
                                this.mainAnimator.AddChild(MonoInterface.NumberAnimation, new MonoInterface.NumberAnimation("Y", frm.Y, 0, -50, void 0, void 0, frm)).Begin();
                            }
                        }
                    }
                    this.curCarouselPos = trgPos;
                }
            },
            Initialize: function () {
                var $t, $t1;

                this.backFillTex = MonoInterface.Theme.SolidColorTexture(this.graphics.GraphicsDevice, 0, 0, 0, 150);

                DarkKingdomCore.MyGame.frmFillTex = MonoInterface.Theme.SolidColorTexture(this.graphics.GraphicsDevice, 190, 190, 190, 220);

                DarkKingdomCore.MyGame.btnFillTex = MonoInterface.Theme.SolidColorTexture(this.graphics.GraphicsDevice, 150, 150, 150);
                DarkKingdomCore.MyGame.btnSelectTex = MonoInterface.Theme.SolidColorTexture(this.graphics.GraphicsDevice, 200, 200, 200);
                DarkKingdomCore.MyGame.btnHlTex = MonoInterface.Theme.SolidColorTexture(this.graphics.GraphicsDevice, 220, 220, 220, 120);
                DarkKingdomCore.MyGame.btnPressedTex = MonoInterface.Theme.SolidColorTexture(this.graphics.GraphicsDevice, 220, 220, 220, 180);
                DarkKingdomCore.MyGame.btnDisabledTex = MonoInterface.Theme.SolidColorTexture(this.graphics.GraphicsDevice, 100, 100, 100, 200);

                DarkKingdomCore.MyGame.prgFillTex = MonoInterface.Theme.SolidColorTexture(this.graphics.GraphicsDevice, 220, 220, 220);
                DarkKingdomCore.MyGame.prgBarTex = MonoInterface.Theme.SolidColorTexture(this.graphics.GraphicsDevice, 140, 140, 140);



                this.starTex = MonoInterface.Theme.SolidColorTexture(this.graphics.GraphicsDevice, 255, 255, 255);


                this.healthBarBackTex = MonoInterface.Theme.SolidColorTexture(this.graphics.GraphicsDevice, 255, 255, 255, 180);
                this.healthBarLifeTex = MonoInterface.Theme.SolidColorTexture(this.graphics.GraphicsDevice, 255, 0, 0, 180);
                this.healthBarPoisonTex = MonoInterface.Theme.SolidColorTexture(this.graphics.GraphicsDevice, 0, 120, 0, 180);
                this.healthBarAbilTex = MonoInterface.Theme.SolidColorTexture(this.graphics.GraphicsDevice, 0, 0, 255, 180);


                DarkKingdomCore.MyGame.hor = (DarkKingdomCore.MyGame.gameHeight - 30) | 0;

                this.skyrect = new Microsoft.Xna.Framework.Rectangle.$ctor2(0, 0, DarkKingdomCore.MyGame.gameWidth, DarkKingdomCore.MyGame.hor);
                this.skytexture = new Microsoft.Xna.Framework.Graphics.Texture2D.ctor(this.graphics.GraphicsDevice, 1, DarkKingdomCore.MyGame.hor);
                this.sunsettexture = new Microsoft.Xna.Framework.Graphics.Texture2D.ctor(this.graphics.GraphicsDevice, 1, DarkKingdomCore.MyGame.hor);

                this.CreateAchievements();

                this.CreatePurchases();





                this.OrderRaces();

                this.CreateRaceList();

                this.conds.add(new DarkKingdomCore.MatchCondition.$ctor1("Easy", new DarkKingdomCore.TimeCost.$ctor1(1000, 20, 1, 0), new DarkKingdomCore.TimeCost.$ctor1(500, 10, 1, 0), 50, 25));
                this.conds.add(new DarkKingdomCore.MatchCondition.$ctor1("Medium", new DarkKingdomCore.TimeCost.$ctor1(500, 10, 1, 0), new DarkKingdomCore.TimeCost.$ctor1(500, 10, 1, 0), 50, 25));
                this.conds.add(new DarkKingdomCore.MatchCondition.$ctor1("Hard", new DarkKingdomCore.TimeCost.$ctor1(250, 0, 1, 0), new DarkKingdomCore.TimeCost.$ctor1(500, 10, 1, 0), 50, 25));

                $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.unitPrms.Values);
                try {
                    while ($t.moveNext()) {
                        var up = $t.Current.$clone();
                        if (!up.special) {
                            this.AllUntsList.add(up.Name);
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }

                var racescost = new (System.Collections.Generic.Dictionary$2(System.String,System.Int32)).ctor();
                var racei = 0;
                $t1 = Bridge.getEnumerator(DarkKingdomCore.RaceManager.Instance.All);
                try {
                    while ($t1.moveNext()) {
                        var rce = $t1.Current;
                        racescost.add(rce.key, Bridge.Int.mul(racei, 4000));
                        racei = (racei + 1) | 0;
                    }
                } finally {
                    if (Bridge.is($t1, System.IDisposable)) {
                        $t1.System$IDisposable$Dispose();
                    }
                }

                this.AllUntsList = System.Linq.Enumerable.from(this.AllUntsList, System.String).orderBy(function (unit) {
                        return ((((((DarkKingdomCore.MyGame.unitPrms.getItem(unit).$clone().Cost.Money + (DarkKingdomCore.MyGame.unitPrms.getItem(unit).$clone().support ? -500 : 0)) | 0) + Bridge.Int.mul(DarkKingdomCore.MyGame.unitPrms.getItem(unit).$clone().Cost.Tier, 1000)) | 0) + racescost.getItem(DarkKingdomCore.MyGame.unitPrms.getItem(unit).$clone().Race)) | 0);
                    }).toList(System.String);

                this.CreateInterface();

                this.menuCarousel = Bridge.fn.bind(this, function (_o1) {
                        _o1.add(this.frmBattle);
                        _o1.add(this.frmProfile);
                        return _o1;
                    })(new (System.Collections.Generic.List$1(MonoInterface.Frame)).ctor());

                this.starsCnt = 88;
                this.stars = System.Array.init(this.starsCnt, function (){
                    return new Microsoft.Xna.Framework.Vector2();
                }, Microsoft.Xna.Framework.Vector2);
                for (var i = 0; i < this.starsCnt; i = (i + 1) | 0) {
                    this.stars[i] = new Microsoft.Xna.Framework.Vector2.$ctor2(DarkKingdomCore.MyGame.rnd.Next$2(0, DarkKingdomCore.MyGame.gameWidth), 20 + DarkKingdomCore.MyGame.rnd.NextDouble() * (((DarkKingdomCore.MyGame.hor - 60) | 0)));
                }

                this.symbols[0] = new Microsoft.Xna.Framework.Rectangle.$ctor2(((DarkKingdomCore.MyGame.gameWidth - 9) | 0), ((DarkKingdomCore.MyGame.hor - 75) | 0), 15, 25);
                this.symbols[1] = new Microsoft.Xna.Framework.Rectangle.$ctor2(((DarkKingdomCore.MyGame.gameWidth - 34) | 0), ((DarkKingdomCore.MyGame.hor - 54) | 0), 15, 25);
                this.symbols[2] = new Microsoft.Xna.Framework.Rectangle.$ctor2(-7, ((DarkKingdomCore.MyGame.hor - 75) | 0), 15, 25);
                this.symbols[3] = new Microsoft.Xna.Framework.Rectangle.$ctor2(21, ((DarkKingdomCore.MyGame.hor - 54) | 0), 15, 25);



                // frmBattle.SetPosition(frmMainMenu.rect.Right / 2 + (frmMenuExit.rect.Left - frmBattle.rect.Width) / 2, (h - frmBattle.rect.Height) / 2)








                this.sunAng = 0.0;
                this.dAng = 0.000698131742;

                this.gamelandscape = DarkKingdomCore.MyGame.rnd.Next$1(this.landsTypesCount);

                DarkKingdomCore.MyGame.gState = DarkKingdomCore.GameState.MainMenu;
                this.Pause = false;


                this.ChangeLandscape(this.gamelandscape);

                this.SetPlayers();

                this.ResetWorld(this.sunAng, this.dAng);


                this.frmMainMenu.Show();
                this.frmRightMenu.Show();

                if (DarkKingdomCore.ProfileManager.Instance.All.Count > 0) {
                    this.StartBattle();
                } else {
                    this.StartNewProfile();
                }

                this.isLoaded = true;
            },
            StartNewProfile: function () {
                DarkKingdomCore.ProfileManager.Instance.All.add(new DarkKingdomCore.Profile(("\u041d\u043e\u0432\u0438\u0447\u0435\u043a").trim(), 0, 1, new (System.Collections.Generic.List$1(System.String)).ctor(), new (System.Collections.Generic.Dictionary$2(System.String,System.Int32)).ctor(), new (System.Collections.Generic.Dictionary$2(System.String,System.Int32)).ctor(), -1, -1, new (System.Collections.Generic.Dictionary$2(System.String,System.String)).ctor(), 0, 3));
                // RaceManager.Instance.All.Add("Custom0", New Race("Custom0", "Ð¡Ð´ÐµÐ»Ð°Ð½Ð¾ ÑÐ²Ð¾Ð¸Ð¼Ð¸ ÑÑÐºÐ°Ð¼Ð¸", "Ð¡ÑÐ°ÑÑÐ¾Ð²ÑÐ¹ Ð½Ð°Ð±Ð¾Ñ", RaceManager.Instance.All(standartRaces(raceSwitcherNewProfile.Current)).units, 10, False, True, False, False))
                this.OrderRaces();
                this.CreateRaceList();
                this.StartBattle();
                this.frmBattle.Show(this.mainAnimator);

                this.ShowSomeChildren([this.frmMainMenu, this.frmRightMenu]);


                this.StartBattle();
            },
            ShowSomeChildren: function (frms) {
                var $t;
                if (frms === void 0) { frms = []; }
                $t = Bridge.getEnumerator(frms);
                try {
                    while ($t.moveNext()) {
                        var frm = $t.Current;
                        frm.Show(this.mainAnimator);
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            },
            HideSomeChildren: function (frms) {
                var $t;
                if (frms === void 0) { frms = []; }
                $t = Bridge.getEnumerator(frms);
                try {
                    while ($t.moveNext()) {
                        var frm = $t.Current;
                        frm.Hide(this.mainAnimator);
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            },
            StartProfile: function () {
                this.RotateCarousel(this.frmProfile);
                this.UpdateProfileInfoLabels();
            },
            UpdateProfileInfoLabels: function () {
                var $t, $t1;
                this.lblsfrmProfile.getItem(0).Text = "\u041d\u0438\u043a: " + (DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).name || "");
                this.lblsfrmProfile.getItem(1).Text = "\u0421\u043b\u043e\u0436\u043d\u043e\u0441\u0442\u044c: " + (this.localize.GetString(this.conds.getItem(DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).difficult).$clone().name) || "");


                var allwins = 0;
                var maxrace = "";
                var maxracepls = 0;

                $t = Bridge.getEnumerator(DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).racesPlays.Keys);
                try {
                    while ($t.moveNext()) {
                        var r = $t.Current;
                        allwins = (allwins + DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).racesWins.getItem(r)) | 0;
                        if (maxracepls < DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).racesPlays.getItem(r)) {
                            maxracepls = DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).racesPlays.getItem(r);
                            maxrace = r;
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }

                this.lblsfrmProfile.getItem(2).Text = System.String.format("\u041f\u043e\u0431\u0435\u0434: {0}", [allwins]);
                this.lblsfrmProfile.getItem(3).Text = System.String.format("\u041e\u0442\u043a\u0440\u044b\u0442\u043e {0}% \u0441\u0443\u0449\u0435\u0441\u0442\u0432", [Bridge.Int.mul(100, DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).units.Count) / this.AllUntsList.Count]);

                var acNum = 0;

                $t1 = Bridge.getEnumerator(DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).achivs);
                try {
                    while ($t1.moveNext()) {
                        var a = $t1.Current;
                        if (Bridge.referenceEquals(a.value, "")) {
                            acNum = (acNum + 1) | 0;
                        }
                    }
                } finally {
                    if (Bridge.is($t1, System.IDisposable)) {
                        $t1.System$IDisposable$Dispose();
                    }
                }

                this.lblsfrmProfile.getItem(4).Text = System.String.format("\u041e\u0442\u043a\u0440\u044b\u0442\u043e {0}% \u0434\u043e\u0441\u0442\u0438\u0436\u0435\u043d\u0438\u0439", [Bridge.Int.mul(100, acNum) / this.achivs.Count]);


                this.lblsfrmProfile.getItem(6).Text = "\u041d\u0438\u043a: " + (DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).name || "");
                this.lblsfrmProfile.getItem(7).Text = "\u041d\u0438\u043a: " + (DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).name || "");

                if (!System.String.isNullOrEmpty(maxrace)) {
                    this.lblsfrmProfile.getItem(5).Text = System.String.format("\u041b\u044e\u0431\u0438\u043c\u0430\u044f \u0444\u0440\u0430\u043a\u0446\u0438\u044f: {0}", [this.localize.GetString(maxrace)]);
                } else {
                    this.lblsfrmProfile.getItem(5).Text = "\u041b\u044e\u0431\u0438\u043c\u0430\u044f \u0444\u0440\u0430\u043a\u0446\u0438\u044f: -";
                }

                if (DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).minvictims === -1) {
                    this.lblsfrmProfile.getItem(6).Text = "\u041c\u0438\u043d\u0438\u043c\u0443\u043c \u043f\u043e\u0442\u0435\u0440\u044c: -";
                } else {
                    this.lblsfrmProfile.getItem(6).Text = System.String.format("\u041c\u0438\u043d\u0438\u043c\u0443\u043c \u043f\u043e\u0442\u0435\u0440\u044c: {0}", [DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).minvictims]);
                }

                if (DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).maxkills === -1) {
                    this.lblsfrmProfile.getItem(7).Text = "\u041c\u0430\u043a\u0441\u0438\u043c\u0443\u043c \u0443\u0431\u0438\u0439\u0441\u0442\u0432: -";
                } else {
                    this.lblsfrmProfile.getItem(7).Text = System.String.format("\u041c\u0430\u043a\u0441\u0438\u043c\u0443\u043c \u0443\u0431\u0438\u0439\u0441\u0442\u0432: {0}", [DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).maxkills]);
                }
            },
            ResetWorld: function (sunPos, sunV) {
                DarkKingdomCore.MyGame.cloudpars.clear();
                this.snD = Math.sin(sunV);
                this.csD = Math.cos(sunV);
                this.snS = Math.sin(sunPos);
                this.csS = Math.cos(sunPos);
                for (var i = 0; i <= 3; i = (i + 1) | 0) {
                    DarkKingdomCore.MyGame.cloudpars.add(new DarkKingdomCore.ImageParticle(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("world"), DarkKingdomCore.MyGame.rnd.Next$2(2, 6)), ((-100 - DarkKingdomCore.MyGame.rnd.Next$1(100)) | 0), ((((DarkKingdomCore.MyGame.hor - 200) | 0) - Bridge.Int.mul(i, 40)) | 0), 0.2 + 0.4 * DarkKingdomCore.MyGame.rnd.NextDouble(), 0, -1));
                }
            },
            btnUnit_Clicked: function (btn, isTouch) {
                for (var i = 0; i < this.cUnits.Children.Count; i = (i + 1) | 0) {
                    if (Bridge.referenceEquals(this.cUnits.Children.getItem(i), btn)) {
                        this.TryAddToQueueUnit(DarkKingdomCore.MyGame.plrs[0], DarkKingdomCore.MyGame.plrs[0].unitsList.getItem(i));
                    }
                }
            },
            btnUnit_Focused: function (btn, isTouch) {
                for (var i = 0; i < this.cUnits.Children.Count; i = (i + 1) | 0) {
                    if (Bridge.referenceEquals(this.cUnits.Children.getItem(i), btn)) {
                        this.ShowUnitInfo(DarkKingdomCore.MyGame.unitPrms.getItem(DarkKingdomCore.MyGame.plrs[0].unitsList.getItem(i)).$clone(), 0, true, new Microsoft.Xna.Framework.Point.$ctor2(Bridge.Int.clip32(btn.FinalRight / this.MainContainer.FinalChildrenScaleX), Bridge.Int.clip32(btn.FinalBottom / this.MainContainer.FinalChildrenScaleY)));
                    }
                }
            },
            SetUnits: function () {
                if (DarkKingdomCore.MyGame.plrs[0].unitsList.Count > 0) {
                    this.cUnits.Children.clear();

                    var d = 0;
                    var oldt = DarkKingdomCore.MyGame.unitPrms.getItem(DarkKingdomCore.MyGame.plrs[0].unitsList.getItem(0)).$clone().Cost.Tier;
                    for (var i = 0; i < DarkKingdomCore.MyGame.plrs[0].unitsList.Count; i = (i + 1) | 0) {
                        if (DarkKingdomCore.MyGame.unitPrms.getItem(DarkKingdomCore.MyGame.plrs[0].unitsList.getItem(i)).$clone().Cost.Tier !== oldt || DarkKingdomCore.MyGame.unitPrms.getItem(DarkKingdomCore.MyGame.plrs[0].unitsList.getItem(i)).$clone().AbsContains("Target")) {
                            d = (d + 7) | 0;
                            oldt = DarkKingdomCore.MyGame.unitPrms.getItem(DarkKingdomCore.MyGame.plrs[0].unitsList.getItem(i)).$clone().Cost.Tier;
                        }
                        this.cUnits.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor1(Bridge.fn.cacheBind(this, this.btnUnit_Clicked), Bridge.fn.cacheBind(this, this.btnUnit_Focused), this.numKeys[i], ((Bridge.Int.mul(i, 65) + d) | 0), 0, 60, 60, 0.0, 0.5, true)).AddChild(MonoInterface.Picture, new MonoInterface.Picture(DarkKingdomCore.MyGame.unitPrms.getItem(DarkKingdomCore.MyGame.plrs[0].unitsList.getItem(i)).$clone().iconApp.$clone(), 0, 0, 60, 60, 0.5, 0.5, true));
                        this.cUnits.W = System.Linq.Enumerable.from(this.cUnits.Children, MonoInterface.Block).last().Right;
                    }
                    this.cUnits.ApplyTheme(this.defaultTheme);
                } else {
                }
            },
            StartAgain: function () {
                var $t, $t1, $t2, $t3, $t4, $t5;
                DarkKingdomCore.MyGame.plrs[0].Reset(this.conds.getItem(DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).difficult).$clone());
                DarkKingdomCore.MyGame.plrs[1].Reset(this.conds.getItem(DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).difficult).$clone());
                this.pctTierFrmResources.spriteRef = DarkKingdomCore.MyGame.unitPrms.getItem("Tier_2").$clone().iconApp.$clone();
                this.ammos.clear();
                DarkKingdomCore.MyGame.units.clear();
                DarkKingdomCore.MyGame.pars.clear();
                this.deathlist.clear();
                this.bornList.clear();
                this.frmProduction.Hide(this.mainAnimator);

                this.UpdateQueue();


                var baseCnt = 0;

                if (this.gType === DarkKingdomCore.GameType.StandartGT || this.gType === DarkKingdomCore.GameType.DefenceGT) {
                    if (Bridge.referenceEquals(DarkKingdomCore.MyGame.plrs[0].hero, "Castle")) {
                        DarkKingdomCore.MyGame.units.add(new DarkKingdomCore.Unit(this, ((this.us2 - 1) | 0), 1, 0, DarkKingdomCore.MyGame.unitPrms.getItem("Castle").$clone()));
                        DarkKingdomCore.MyGame.units.getItem(baseCnt).parameters.spriteName = (DarkKingdomCore.MyGame.plrs[0].castleFileName || "") + "2";
                        DarkKingdomCore.MyGame.units.getItem(baseCnt).parameters.rect = new Microsoft.Xna.Framework.Rectangle.$ctor2(-15, -60, 50, 63);
                        DarkKingdomCore.MyGame.plrs[baseCnt].baseX = this.us2;
                    } else {
                        DarkKingdomCore.MyGame.units.add(new DarkKingdomCore.Unit(this, ((this.unitSize - 1) | 0), 1, 0, DarkKingdomCore.MyGame.unitPrms.getItem(DarkKingdomCore.MyGame.plrs[0].hero).$clone()));
                        DarkKingdomCore.MyGame.plrs[0].baseX = (-this.us2) | 0;
                    }
                    DarkKingdomCore.MyGame.plrs[0].heroUnit = DarkKingdomCore.MyGame.units.getItem(baseCnt);
                    baseCnt = (baseCnt + 1) | 0;
                } else {
                    DarkKingdomCore.MyGame.plrs[0].hero = "";
                    DarkKingdomCore.MyGame.plrs[0].baseX = (-this.unitSize) | 0;
                    DarkKingdomCore.MyGame.plrs[0].heroUnit = null;
                }


                if (this.gType === DarkKingdomCore.GameType.StandartGT || this.gType === DarkKingdomCore.GameType.OffenceGT) {
                    if (Bridge.referenceEquals(DarkKingdomCore.MyGame.plrs[1].hero, "Castle")) {
                        DarkKingdomCore.MyGame.units.add(new DarkKingdomCore.Unit(this, ((((DarkKingdomCore.MyGame.gameWidth - this.us2) | 0) + 1) | 0), -1, 1, DarkKingdomCore.MyGame.unitPrms.getItem("Castle").$clone()));
                        DarkKingdomCore.MyGame.units.getItem(baseCnt).parameters.spriteName = (DarkKingdomCore.MyGame.plrs[1].castleFileName || "") + 2;
                        DarkKingdomCore.MyGame.units.getItem(baseCnt).parameters.imgx = -20;
                        DarkKingdomCore.MyGame.units.getItem(baseCnt).parameters.rect = new Microsoft.Xna.Framework.Rectangle.$ctor2(-35, -59, 50, 63);
                        DarkKingdomCore.MyGame.plrs[1].baseX = (DarkKingdomCore.MyGame.gameWidth - this.us2) | 0;
                    } else {
                        DarkKingdomCore.MyGame.units.add(new DarkKingdomCore.Unit(this, ((((DarkKingdomCore.MyGame.gameWidth - this.unitSize) | 0) + 1) | 0), -1, 1, DarkKingdomCore.MyGame.unitPrms.getItem(DarkKingdomCore.MyGame.plrs[1].hero).$clone()));
                        DarkKingdomCore.MyGame.plrs[1].baseX = (DarkKingdomCore.MyGame.gameWidth + this.us2) | 0;
                    }
                    DarkKingdomCore.MyGame.plrs[1].heroUnit = DarkKingdomCore.MyGame.units.getItem(baseCnt);
                    baseCnt = (baseCnt + 1) | 0;
                } else {
                    DarkKingdomCore.MyGame.plrs[1].hero = "";
                    DarkKingdomCore.MyGame.plrs[1].baseX = (DarkKingdomCore.MyGame.gameWidth + this.unitSize) | 0;
                    DarkKingdomCore.MyGame.plrs[1].heroUnit = null;
                }

                this.curM = DarkKingdomCore.MyGame.plrs[0].res.Money;
                this.curD = DarkKingdomCore.MyGame.plrs[0].res.Death;

                this.selU = null;
                this.SetUnits();
                this.SetSpells();


                if (this.gType === DarkKingdomCore.GameType.DefenceGT) {
                    this.ResetWorld(3.14159274, this.dAng / 3);
                } else {
                    if (this.gType === DarkKingdomCore.GameType.OffenceGT) {
                        this.ResetWorld(0, this.dAng / 3);
                    } else {
                        this.ResetWorld(this.sunAng, this.dAng);
                    }
                }
                if (this.gType === DarkKingdomCore.GameType.DefenceGT) {
                    ($t = DarkKingdomCore.MyGame.plrs[1].res.$clone()).Money = Bridge.Int.mul($t.Money, 2);
                    ($t1 = DarkKingdomCore.MyGame.plrs[1].res.$clone()).Death = Bridge.Int.mul($t1.Death, 2);
                }
                if (this.gType === DarkKingdomCore.GameType.OffenceGT) {
                    ($t2 = DarkKingdomCore.MyGame.plrs[0].res.$clone()).Money = Bridge.Int.mul($t2.Money, 2);
                    ($t3 = DarkKingdomCore.MyGame.plrs[0].res.$clone()).Death = Bridge.Int.mul($t3.Death, 2);
                }

                $t4 = Bridge.getEnumerator(DarkKingdomCore.MyGame.plrs);
                try {
                    while ($t4.moveNext()) {
                        var p = $t4.Current;
                        var otherBuildings = new (System.Collections.Generic.List$1(System.String)).ctor();
                        $t5 = Bridge.getEnumerator(p.bonusList);
                        try {
                            while ($t5.moveNext()) {
                                var b = $t5.Current;
                                if (Bridge.referenceEquals(b, "Tower")) {
                                    var tower = new DarkKingdomCore.Unit(this, ((((Bridge.Int.div(DarkKingdomCore.MyGame.gameWidth, 2)) | 0) - ((Bridge.Int.div(Bridge.Int.mul(p.moveside, DarkKingdomCore.MyGame.gameWidth), 6)) | 0)) | 0), p.moveside, p.id, DarkKingdomCore.MyGame.unitPrms.getItem("Tower").$clone());
                                    DarkKingdomCore.MyGame.units.add(tower);
                                } else {
                                    otherBuildings.add(b);
                                }
                            }
                        } finally {
                            if (Bridge.is($t5, System.IDisposable)) {
                                $t5.System$IDisposable$Dispose();
                            }
                        }

                        for (var i = 0; i < otherBuildings.Count; i = (i + 1) | 0) {
                            var building = new DarkKingdomCore.Unit(this, ((((((Bridge.Int.div(DarkKingdomCore.MyGame.gameWidth, 2)) | 0) - ((Bridge.Int.div(Bridge.Int.mul(p.moveside, DarkKingdomCore.MyGame.gameWidth), 6)) | 0)) | 0) - Bridge.Int.mul(Bridge.Int.mul(p.moveside, (((Bridge.Int.div((((((Bridge.Int.div(DarkKingdomCore.MyGame.gameWidth, 3)) | 0) - this.us2) | 0)), (((otherBuildings.Count + 1) | 0)))) | 0))), (((i + 1) | 0)))) | 0), p.moveside, p.id, DarkKingdomCore.MyGame.unitPrms.getItem(otherBuildings.getItem(i)).$clone());
                            DarkKingdomCore.MyGame.units.add(building);
                        }
                    }
                } finally {
                    if (Bridge.is($t4, System.IDisposable)) {
                        $t4.System$IDisposable$Dispose();
                    }
                }
                DarkKingdomCore.MyGame.gState = DarkKingdomCore.GameState.InGame;
                this.Pause = false;
            },
            StartPreGame: function () {
                var $t, $t1, $t2, $t3, $t4, $t5;
                this.unitsPreGame.clear();
                this.spellsPreGame.clear();

                if (this.modeSwitcherFrmBattle.Current === DarkKingdomCore.GameType.RandomGT) {
                    this.gType = DarkKingdomCore.MyGame.rnd.Next$2(1, 6);
                } else {
                    this.gType = this.modeSwitcherFrmBattle.Current;
                }

                if (Bridge.referenceEquals(this.races1.getItem(this.races1SwitcherFrmBattle.Current), "Random")) {
                    DarkKingdomCore.MyGame.plrs[0].race = DarkKingdomCore.RaceManager.Instance.All.getItem(this.races1.getItem(DarkKingdomCore.MyGame.rnd.Next$2(1, this.races1.Count))).name;
                } else {
                    DarkKingdomCore.MyGame.plrs[0].race = this.races1.getItem(this.races1SwitcherFrmBattle.Current);
                }
                if (Bridge.referenceEquals(this.races2.getItem(this.races2SwitcherFrmBattle.Current), "Random")) {
                    DarkKingdomCore.MyGame.plrs[1].race = DarkKingdomCore.RaceManager.Instance.All.getItem(this.races2.getItem(DarkKingdomCore.MyGame.rnd.Next$2(1, this.races2.Count))).name;
                } else {
                    DarkKingdomCore.MyGame.plrs[1].race = this.races2.getItem(this.races2SwitcherFrmBattle.Current);
                }


                DarkKingdomCore.MyGame.plrs[0].symb = DarkKingdomCore.RaceManager.Instance.All.getItem(DarkKingdomCore.MyGame.plrs[0].race).symb;
                DarkKingdomCore.MyGame.plrs[1].symb = DarkKingdomCore.RaceManager.Instance.All.getItem(DarkKingdomCore.MyGame.plrs[1].race).symb;


                // ÐÑÐ±Ð¸ÑÐ°ÐµÐ¼ ÑÑÑÐµÑÑÐ² Ð¿ÐµÑÐ²Ð¾Ð¼Ñ Ð¸Ð³ÑÐ¾ÐºÑ
                if (DarkKingdomCore.RaceManager.Instance.All.getItem(DarkKingdomCore.MyGame.plrs[0].race).custom) {
                    $t = Bridge.getEnumerator(new (System.Collections.Generic.List$1(System.String)).ctor());
                    try {
                        while ($t.moveNext()) {
                            var unam = $t.Current;
                            this.unitsPreGame.add(unam);
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                } else {
                    $t1 = Bridge.getEnumerator(DarkKingdomCore.MyGame.unitPrms.Values);
                    try {
                        while ($t1.moveNext()) {
                            var u = $t1.Current.$clone();
                            if (Bridge.referenceEquals(u.Race, DarkKingdomCore.MyGame.plrs[0].race) && !u.special) {
                                this.unitsPreGame.add(u.Name);
                            }
                        }
                    } finally {
                        if (Bridge.is($t1, System.IDisposable)) {
                            $t1.System$IDisposable$Dispose();
                        }
                    }

                    this.unitsPreGame = this.SortUnitsLists(this.unitsPreGame);
                }
                DarkKingdomCore.MyGame.plrs[0].unitsList = this.unitsPreGame;

                this.lblVsPreGame.Text = System.String.format("{0} VS {1}", this.localize.GetString(DarkKingdomCore.MyGame.plrs[0].race), this.localize.GetString(DarkKingdomCore.MyGame.plrs[1].race));

                $t2 = Bridge.getEnumerator(this.spells.Values);
                try {
                    while ($t2.moveNext()) {
                        var spl = $t2.Current;
                        this.spellsPreGame.add(spl.Name);
                    }
                } finally {
                    if (Bridge.is($t2, System.IDisposable)) {
                        $t2.System$IDisposable$Dispose();
                    }
                }
                this.spellsPreGame = this.SortSpellsLists(this.spellsPreGame);
                DarkKingdomCore.MyGame.plrs[0].spllsList = this.spellsPreGame;


                DarkKingdomCore.MyGame.plrs[0].bonusList.clear();
                DarkKingdomCore.MyGame.plrs[1].bonusList.clear();

                var allbonuses = new (System.Collections.Generic.List$1(System.String)).ctor();
                allbonuses.AddRange(this.startBuildingsList);
                DarkKingdomCore.MyGame.plrs[0].bonusList.AddRange(allbonuses);
                DarkKingdomCore.MyGame.plrs[1].bonusList.AddRange(allbonuses);



                // frmPreGame.AddButton(5, delta, 16, 16, , "RandomUnits", Keys.D1)
                // frmPreGame.AddImage(5, delta, 19, 15, "small_icons", 16)
                this.cUnitsPreGame.Children.clear();
                $t3 = Bridge.getEnumerator(this.unitsPreGame);
                try {
                    while ($t3.moveNext()) {
                        var u1 = $t3.Current;
                        this.cUnitsPreGame.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor2(Bridge.fn.cacheBind(this, this.btnUnitPreGame_Clicked), Bridge.fn.cacheBind(this, this.btnUnitPreGame_Focused), 5, 5, 45, 45, 0.0, 0.0, true)).AddChild(MonoInterface.Picture, new MonoInterface.Picture(DarkKingdomCore.MyGame.unitPrms.getItem(u1).$clone().iconApp.$clone(), 0, 0, 45, 45, 0.5, 0.5, true));
                    }
                } finally {
                    if (Bridge.is($t3, System.IDisposable)) {
                        $t3.System$IDisposable$Dispose();
                    }
                }
                this.cUnitsPreGame.ApplyTheme(this.defaultTheme);
                // frmPreGame.AddButton(5, delta, 16, 16, , "RandomSpells", Keys.D2)
                // frmPreGame.AddImage(5, delta, 19, 15, "small_icons", 16)

                this.cSpellsPreGame.Children.clear();
                $t4 = Bridge.getEnumerator(this.spellsPreGame);
                try {
                    while ($t4.moveNext()) {
                        var s = $t4.Current;
                        this.cSpellsPreGame.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor2(Bridge.fn.cacheBind(this, this.btnSpellsPreGame_Clicked), Bridge.fn.cacheBind(this, this.btnSpellsPreGame_Focused), 5, 5, 45, 45, 0.0, 0.0, true)).AddChild(MonoInterface.Picture, new MonoInterface.Picture(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("spells_icons"), this.spells.getItem(s).Img), 0, 0, 45, 45, 0.5, 0.5, true));
                    }
                } finally {
                    if (Bridge.is($t4, System.IDisposable)) {
                        $t4.System$IDisposable$Dispose();
                    }
                }
                this.cSpellsPreGame.ApplyTheme(this.defaultTheme);
                // frmPreGame.AddButton(5, delta, 16, 16, , "RandomBuildings", Keys.D3)
                // frmPreGame.AddImage(5, delta, 19, 15, "small_icons", 16)


                this.cBuildingsPreGame.Children.clear();
                $t5 = Bridge.getEnumerator(this.startBuildingsList);
                try {
                    while ($t5.moveNext()) {
                        var b = $t5.Current;
                        this.cBuildingsPreGame.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor2(Bridge.fn.cacheBind(this, this.btnBuildingPreGame_Clicked), Bridge.fn.cacheBind(this, this.btnBuildingPreGame_Focused), 5, 5, 45, 45, 0.0, 0.0, true)).AddChild(MonoInterface.Picture, new MonoInterface.Picture(DarkKingdomCore.MyGame.unitPrms.getItem(b).$clone().iconApp.$clone(), 0, 0, 45, 45, 0.5, 0.5, true));
                    }
                } finally {
                    if (Bridge.is($t5, System.IDisposable)) {
                        $t5.System$IDisposable$Dispose();
                    }
                }
                this.cBuildingsPreGame.ApplyTheme(this.defaultTheme);

                this.cSelectedPreGame.Children.clear();
                for (var i = 0; i < this.preGameSlotCnt; i = (i + 1) | 0) {
                    this.cSelectedPreGame.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor2(Bridge.fn.cacheBind(this, this.btnSelectedPreGame_Clicked), Bridge.fn.cacheBind(this, this.btnSelectedPreGame_Focused), 5, 5, 45, 45, 0.0, 0.5, true)).AddChild(MonoInterface.Picture, new MonoInterface.Picture(this.defaultTheme.EmptyTexture.$clone(), 0, 0, 45, 45, 0.5, 0.5, true));
                }
                this.cSelectedPreGame.ApplyTheme(this.defaultTheme);

                this.preGameUnits.clear();
                this.preGameSpells.clear();
                this.preGameBonus.clear();

                this.cUnitsPreGame.Visible = true;


                this.frmPreGame.Show(this.mainAnimator);

                this.btnUnitsPreGame.Click(0, 0, false);
                this.SetPreGameLists();
            },
            ShowDialogConfirmation: function (str) {
                this.lblTextFrmConfirm.Text = str;
                this.frmConfirm.Show(this.mainAnimator);

                this.taskConfirm = new System.Threading.Tasks.TaskCompletionSource();
                return this.taskConfirm.task;
            },
            SetPlayerAI: function (val) {
                DarkKingdomCore.MyGame.plrs[0].AI = val;
                this.lblAIFrmBattleMenu.Text = val ? "\u041f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043d\u0430 \u0438\u0433\u0440\u043e\u043a\u0430" : "\u041f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043d\u0430 \u0418\u0418";
            },
            StartPlaying: function () {
                var $t;
                this.ShowSomeChildren([this.frmUnits, this.frmResources]);
                this.HideSomeChildren([this.frmMainMenu, this.frmRightMenu]);


                this.SetPlayerAI(this.startAutofight);

                DarkKingdomCore.MyGame.plrs[0].unitsList.clear();
                DarkKingdomCore.MyGame.plrs[0].spllsList.clear();
                DarkKingdomCore.MyGame.plrs[0].bonusList.clear();

                DarkKingdomCore.MyGame.plrs[0].unitsList.AddRange(this.preGameUnits);
                DarkKingdomCore.MyGame.plrs[0].spllsList.AddRange(this.preGameSpells);
                DarkKingdomCore.MyGame.plrs[0].bonusList.AddRange(this.preGameBonus);


                // ÐÑÐ±Ð¸ÑÐ°ÐµÐ¼ ÑÑÑÐµÑÑÐ² Ð²ÑÐ¾ÑÐ¾Ð¼Ñ Ð¸Ð³ÑÐ¾ÐºÑ
                if (DarkKingdomCore.RaceManager.Instance.All.getItem(DarkKingdomCore.MyGame.plrs[1].race).custom) {
                    DarkKingdomCore.MyGame.plrs[1].unitsList = this.RandomizeUnits(7, new (System.Collections.Generic.List$1(System.String)).ctor(), false);
                } else {
                    var allunts = new (System.Collections.Generic.List$1(System.String)).ctor();
                    $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.unitPrms.Values);
                    try {
                        while ($t.moveNext()) {
                            var u = $t.Current.$clone();
                            if (Bridge.referenceEquals(u.Race, DarkKingdomCore.MyGame.plrs[1].race) && !u.special) {
                                allunts.add(u.Name);
                            }
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }

                    DarkKingdomCore.MyGame.plrs[1].unitsList = this.RandomizeUnits(7, allunts, true);
                }

                DarkKingdomCore.MyGame.plrs[1].bonusList = this.RandomizeBuildings(((10 - DarkKingdomCore.MyGame.plrs[1].unitsList.Count) | 0), DarkKingdomCore.MyGame.plrs[1].bonusList);



                DarkKingdomCore.MyGame.plrs[0].hero = "Castle";
                DarkKingdomCore.MyGame.plrs[1].hero = "Castle";

                DarkKingdomCore.MyGame.plrs[0].castleFileName = this.GetCatleFileName(DarkKingdomCore.MyGame.plrs[0].race);
                DarkKingdomCore.MyGame.plrs[1].castleFileName = this.GetCatleFileName(DarkKingdomCore.MyGame.plrs[1].race);

                this.StartAgain();

                if (!Bridge.referenceEquals(DarkKingdomCore.MyGame.plrs[0].hero, "")) {
                    DarkKingdomCore.MyGame.units.getItem(0).parameters.Race = DarkKingdomCore.MyGame.plrs[0].race;
                }

                if (!Bridge.referenceEquals(DarkKingdomCore.MyGame.plrs[1].hero, "")) {
                    if (Bridge.referenceEquals(DarkKingdomCore.MyGame.plrs[0].hero, "")) {
                        DarkKingdomCore.MyGame.units.getItem(0).parameters.Race = DarkKingdomCore.MyGame.plrs[1].race;
                    } else {
                        DarkKingdomCore.MyGame.units.getItem(1).parameters.Race = DarkKingdomCore.MyGame.plrs[1].race;
                    }
                }

                this.btnSelectUnits.Click(0, 0, true);

                this.ShowInfoPar(this.localize.GetString((System.Enum.toString(DarkKingdomCore.GameType, this.gType) || "") + "Desc"), DarkKingdomCore.MyGame.goodAbilClr.$clone(), ((Bridge.Int.div(DarkKingdomCore.MyGame.gameWidth, 2)) | 0), ((Bridge.Int.div(DarkKingdomCore.MyGame.gameHeight, 2)) | 0), true, true);
            },
            GetCatleFileName: function (race) {
                switch (race) {
                    case "Humans": 
                        return "hqs_daemonic";
                    case "Demons": 
                        return "hqs_human";
                    case "Dwarfs": 
                        return "hqs_dvarven";
                    case "Elves": 
                        return "hqs_elvish";
                    case "Horde": 
                        return "hqs_orcish";
                    case "Steampunk": 
                        return "hqs_steampunk";
                    case "Swampers": 
                        return "hqs_swampclan";
                    case "Undeads": 
                        return "hqs_undead";
                }
                ;
                return "hqs";
            },
            StartBattle: function () {
                this.frmBattle.Show(this.mainAnimator);
                this.frmPreGame.Hide(this.mainAnimator);

                this.races1SwitcherFrmBattle.Current = 0;
                this.races2SwitcherFrmBattle.Current = 0;
                this.modeSwitcherFrmBattle.Current = 1;
            },
            SetPreGameLists: function () {
                for (var i = 0; i < this.preGameSlotCnt; i = (i + 1) | 0) {
                    var btn = Bridge.as(this.cSelectedPreGame.Children.getItem(i), MonoInterface.Button);
                    var pct = Bridge.as(btn.Children.getItem(0), MonoInterface.Picture);
                    if (this.preGameUnits.Count > i) {
                        pct.spriteRef = DarkKingdomCore.MyGame.unitPrms.getItem(this.preGameUnits.getItem(i)).$clone().iconApp.$clone();
                    } else {
                        if (this.preGameSpells.Count > ((i - this.preGameUnits.Count) | 0)) {
                            pct.spriteRef = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("spells_icons"), this.spells.getItem(this.preGameSpells.getItem(((i - this.preGameUnits.Count) | 0))).Img);
                        } else {
                            if (this.preGameBonus.Count > ((((i - this.preGameUnits.Count) | 0) - this.preGameSpells.Count) | 0)) {
                                pct.spriteRef = DarkKingdomCore.MyGame.unitPrms.getItem(this.preGameBonus.getItem(((((i - this.preGameUnits.Count) | 0) - this.preGameSpells.Count) | 0))).$clone().iconApp.$clone();
                            } else {
                                pct.spriteRef = this.defaultTheme.EmptyTexture.$clone();
                            }
                        }
                    }
                }
                var completedAll = ((((this.preGameUnits.Count + this.preGameSpells.Count) | 0) + this.preGameBonus.Count) | 0) === 10;

                for (var i1 = 0; i1 < this.unitsPreGame.Count; i1 = (i1 + 1) | 0) {
                    (Bridge.as(this.cUnitsPreGame.Children.getItem(i1), MonoInterface.Button)).IsDisabled = this.preGameUnits.contains(this.unitsPreGame.getItem(i1)) || completedAll || this.preGameUnits.Count === 7;
                }

                for (var i2 = 0; i2 < this.spellsPreGame.Count; i2 = (i2 + 1) | 0) {
                    (Bridge.as(this.cSpellsPreGame.Children.getItem(i2), MonoInterface.Button)).IsDisabled = this.preGameSpells.contains(this.spellsPreGame.getItem(i2)) || completedAll || this.preGameSpells.Count === 7;
                }

                for (var i3 = 0; i3 < this.startBuildingsList.Count; i3 = (i3 + 1) | 0) {
                    (Bridge.as(this.cBuildingsPreGame.Children.getItem(i3), MonoInterface.Button)).IsDisabled = this.preGameBonus.contains(this.startBuildingsList.getItem(i3)) || completedAll || this.preGameBonus.Count === 7;
                }

                this.btnFightPreGame.IsDisabled = ((((this.preGameUnits.Count + this.preGameSpells.Count) | 0) + this.preGameBonus.Count) | 0) === 0;
            },
            SetEditorUnits: function () { },
            SortUnitsLists: function (units) {
                return System.Linq.Enumerable.from(units, System.String).orderBy(function (unit) {
                        return DarkKingdomCore.MyGame.unitPrms.getItem(unit).$clone().Cost.Tier;
                    }).thenBy(function (unit) {
                    return DarkKingdomCore.MyGame.unitPrms.getItem(unit).$clone().Cost.Money;
                }).toList(System.String);
            },
            SortSpellsLists: function (spells) {
                return System.Linq.Enumerable.from(spells, System.String).orderBy(Bridge.fn.bind(this, function (spell) {
                        return this.spells.getItem(spell).Cost.Tier;
                    })).thenBy(Bridge.fn.bind(this, function (spell) {
                    return this.spells.getItem(spell).Cost.Death;
                })).toList(System.String);
            },
            Newborn: function (plr, u, inStack) {
                var $t, $t1, $t2;
                $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                try {
                    while ($t.moveNext()) {
                        var uu = $t.Current;
                        if (uu.owner === DarkKingdomCore.MyGame.plrs[plr].id && uu.AbsContains("WombAbil")) {
                            u.x = uu.x + Bridge.Int.mul(5, DarkKingdomCore.MyGame.plrs[plr].moveside);
                        }
                        if (uu.owner === DarkKingdomCore.MyGame.plrs[plr].id && uu.AbsContains("Stack_helper") && inStack) {
                            u.x = uu.x + Bridge.Int.mul(10, DarkKingdomCore.MyGame.plrs[plr].moveside);
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                if (u.AbsContains("Random_position")) {
                    u.x = DarkKingdomCore.MyGame.rnd.Next$2(50, ((DarkKingdomCore.MyGame.gameWidth - 49) | 0));
                    DarkKingdomCore.MyGame.pars.add(new DarkKingdomCore.ImageParticle(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("explode"), 2), u.x - 25, ((((((DarkKingdomCore.MyGame.hor + u.parameters.rect.Bottom) | 0) - this.us2) | 0) - 25) | 0), 0, 0, 20));
                }
                if (u.AbsContains("Free")) {
                    u.parameters.Cost.Money = 80;
                    if (u.x <= DarkKingdomCore.MyGame.gameWidth / 2.0) {
                        u.owner = 0;
                        u.moveside = DarkKingdomCore.MyGame.plrs[0].moveside;
                    } else {
                        u.owner = 1;
                        u.moveside = DarkKingdomCore.MyGame.plrs[1].moveside;
                    }
                }
                if (u.abils.containsKey("Sacrifice")) {
                    var uu1 = this.FindRandomUnflyUnit(((1 - plr) | 0));
                    if (uu1 != null) {
                        u.x = uu1.x;
                        this.Kill(uu1);
                        this.ShowInfoPar("\u041f\u0440\u0438\u0437\u0432\u0430\u043d", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                    }
                }
                if (u.abils.containsKey("Assault")) {
                    var uu2 = this.FindFirstUnflyUnit(plr);
                    if (uu2 != null) {
                        u.x = uu2.x - Bridge.Int.mul(this.us2, DarkKingdomCore.MyGame.plrs[plr].moveside);
                        DarkKingdomCore.MyGame.pars.add(new DarkKingdomCore.ImageParticle(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("explode"), 2), u.x - 25, ((((((DarkKingdomCore.MyGame.hor + u.parameters.rect.Bottom) | 0) - this.us2) | 0) - 25) | 0), 0, 0, 20));
                    }
                }
                if (u.abils.containsKey("Encourage_first")) {
                    var uu3 = this.FindFirstUnflyUnit(u.owner);
                    if (uu3 != null) {
                        u.abils.getItem("Encourage_first").used = true;
                        uu3.parameters.Armor = "Heavy";
                        uu3.Attack = DarkKingdomCore.Attack.op_Addition$1(uu3.Attack.$clone(), (u.abils.getItem("Encourage_first").value) | 0);
                        this.ShowInfoPar("\u0423\u0441\u0438\u043b\u0435\u043d", DarkKingdomCore.MyGame.goodAbilClr.$clone(), uu3.x, ((DarkKingdomCore.MyGame.hor + uu3.parameters.rect.Top) | 0), true);
                    }
                }
                if (u.abils.containsKey("Swarm")) {
                    $t1 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                    try {
                        while ($t1.moveNext()) {
                            var uu4 = $t1.Current;
                            if (!Bridge.referenceEquals(uu4, u) && uu4.owner === u.owner && uu4.AbsContains("Swarm")) {
                                uu4.Attack = DarkKingdomCore.Attack.op_Addition$1(uu4.Attack.$clone(), (u.abils.getItem("Swarm").value) | 0);
                            }
                        }
                    } finally {
                        if (Bridge.is($t1, System.IDisposable)) {
                            $t1.System$IDisposable$Dispose();
                        }
                    }
                }
                $t2 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                try {
                    while ($t2.moveNext()) {
                        var uu5 = $t2.Current;
                        if (uu5.owner !== u.owner && uu5.AbsContains("Poison_on_prod") && DarkKingdomCore.MyGame.rnd.Next$1(100) < uu5.abils.getItem("Poison_on_prod").value) {
                            u.AddAbility$1("Poison", DarkKingdomCore.EffectType.Poison);
                            this.ShowInfoPar("\u0412\u0440\u0430\u0433 \u043e\u0442\u0440\u0430\u0432\u043b\u0435\u043d", DarkKingdomCore.MyGame.goodAbilClr.$clone(), uu5.x, ((DarkKingdomCore.MyGame.hor + uu5.parameters.rect.Top) | 0), true);
                        }
                    }
                } finally {
                    if (Bridge.is($t2, System.IDisposable)) {
                        $t2.System$IDisposable$Dispose();
                    }
                }
            },
            ProduceUnit: function (plr, name, atkbonus, hpbonus, armorChange, addabils, inStack) {
                var $t, $t1, $t2, $t3, $t4;
                if (atkbonus === void 0) { atkbonus = 0; }
                if (hpbonus === void 0) { hpbonus = 0; }
                if (armorChange === void 0) { armorChange = ""; }
                if (addabils === void 0) { addabils = null; }
                if (inStack === void 0) { inStack = false; }
                if (!DarkKingdomCore.MyGame.unitPrms.getItem(name).$clone().upgrade) {
                    var u = new DarkKingdomCore.Unit(this, ((DarkKingdomCore.MyGame.plrs[plr].baseX + DarkKingdomCore.MyGame.plrs[plr].moveside) | 0), DarkKingdomCore.MyGame.plrs[plr].moveside, DarkKingdomCore.MyGame.plrs[plr].id, DarkKingdomCore.MyGame.unitPrms.getItem(name).$clone());
                    if (addabils != null) {
                        $t = Bridge.getEnumerator(addabils);
                        try {
                            while ($t.moveNext()) {
                                var a = $t.Current;
                                u.AddAbility(a);
                            }
                        } finally {
                            if (Bridge.is($t, System.IDisposable)) {
                                $t.System$IDisposable$Dispose();
                            }
                        }
                    }
                    u.Attack = DarkKingdomCore.Attack.op_Addition$1(u.Attack.$clone(), atkbonus | 0);
                    ($t1 = u.parameters.$clone()).maxhp = ($t1.maxhp + hpbonus) | 0;
                    u.hp += hpbonus;
                    if (!Bridge.referenceEquals(armorChange, "")) {
                        u.parameters.Armor = armorChange;
                    }


                    this.Newborn(plr, u, inStack);
                    this.bornList.add(u);
                } else {
                    switch (name) {
                        case "Tier_2": 
                            {
                                ($t2 = DarkKingdomCore.MyGame.plrs[plr].res.$clone()).Tier = ($t2.Tier + 1) | 0;
                                if (plr === 0) {
                                    this.pctTierFrmResources.spriteRef = DarkKingdomCore.MyGame.unitPrms.getItem("Tier_3").$clone().iconApp.$clone();
                                }
                                break;
                            }
                        case "Tier_3": 
                            {
                                ($t3 = DarkKingdomCore.MyGame.plrs[plr].res.$clone()).Tier = ($t3.Tier + 1) | 0;
                                break;
                            }
                    }
                    $t4 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                    try {
                        while ($t4.moveNext()) {
                            var u1 = $t4.Current;
                            if (u1.owner === plr && u1.AbsContains("Refresh") && u1.hp < u1.parameters.maxhp) {
                                u1.hp = u1.parameters.maxhp;
                                this.ShowInfoPar("\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u1.x, ((DarkKingdomCore.MyGame.hor + u1.parameters.rect.Top) | 0), true);
                            }
                        }
                    } finally {
                        if (Bridge.is($t4, System.IDisposable)) {
                            $t4.System$IDisposable$Dispose();
                        }
                    }
                }
            },
            Kill: function (u) {
                if (!this.deathlist.contains(u)) {
                    this.deathlist.add(u);
                }
            },
            ChangeLandscape: function (newl) {
                DarkKingdomCore.MyGame.backpars.clear();
                DarkKingdomCore.MyGame.bushpars.clear();
                switch (newl) {
                    case DarkKingdomCore.LandscapeType.PlainLS: 
                        {
                            this.landBmp = "ground";
                            var num = DarkKingdomCore.MyGame.rnd.Next$2(5, 11);
                            for (var i = 0; i < num; i = (i + 1) | 0) {
                                DarkKingdomCore.MyGame.backpars.add(new DarkKingdomCore.ImageParticle(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("back0"), DarkKingdomCore.MyGame.rnd.Next$1(4)), ((((125 + Bridge.Int.mul(((Bridge.Int.div((((DarkKingdomCore.MyGame.gameWidth - 250) | 0)), (((num - 1) | 0)))) | 0), i)) | 0) - 42) | 0) + 40 * DarkKingdomCore.MyGame.rnd.NextDouble(), ((DarkKingdomCore.MyGame.hor - 70) | 0), 0, 0, -1, DarkKingdomCore.MyGame.rnd.NextDouble() > 0.5));
                            }
                            num = DarkKingdomCore.MyGame.rnd.Next$2(40, 51);
                            for (var i1 = 0; i1 < num; i1 = (i1 + 1) | 0) {
                                DarkKingdomCore.MyGame.bushpars.add(new DarkKingdomCore.ImageParticle(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("bush0"), DarkKingdomCore.MyGame.rnd.Next$1(5)), ((Bridge.Int.mul(((Bridge.Int.div(DarkKingdomCore.MyGame.gameWidth, (((num - 1) | 0)))) | 0), i1) - 42) | 0) + 40 * DarkKingdomCore.MyGame.rnd.NextDouble(), ((DarkKingdomCore.MyGame.hor - 15) | 0), 0, 0, -1));
                            }
                            break;
                        }
                    case DarkKingdomCore.LandscapeType.DesertLS: 
                        {
                            this.landBmp = "desert";
                            break;
                        }
                    case DarkKingdomCore.LandscapeType.SwampLS: 
                        {
                            this.landBmp = "swamp";
                            var num1 = DarkKingdomCore.MyGame.rnd.Next$2(10, 11);
                            for (var i2 = 0; i2 < num1; i2 = (i2 + 1) | 0) {
                                DarkKingdomCore.MyGame.backpars.add(new DarkKingdomCore.ImageParticle(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("back1"), DarkKingdomCore.MyGame.rnd.Next$1(3)), ((((125 + Bridge.Int.mul(((Bridge.Int.div((((DarkKingdomCore.MyGame.gameWidth - 250) | 0)), (((num1 - 1) | 0)))) | 0), i2)) | 0) - 42) | 0) + 40 * DarkKingdomCore.MyGame.rnd.NextDouble(), ((DarkKingdomCore.MyGame.hor - 70) | 0), 0, 0, -1, DarkKingdomCore.MyGame.rnd.NextDouble() > 0.5));
                            }
                            break;
                        }
                    case DarkKingdomCore.LandscapeType.DeathlandLS: 
                        {
                            this.landBmp = "deathland";
                            var num2 = DarkKingdomCore.MyGame.rnd.Next$2(5, 11);
                            for (var i3 = 0; i3 < num2; i3 = (i3 + 1) | 0) {
                                DarkKingdomCore.MyGame.backpars.add(new DarkKingdomCore.ImageParticle(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("back2"), DarkKingdomCore.MyGame.rnd.Next$1(4)), ((((125 + Bridge.Int.mul(((Bridge.Int.div((((DarkKingdomCore.MyGame.gameWidth - 250) | 0)), (((num2 - 1) | 0)))) | 0), i3)) | 0) - 50) | 0) + 40 * DarkKingdomCore.MyGame.rnd.NextDouble(), ((DarkKingdomCore.MyGame.hor - 70) | 0), 0, 0, -1, DarkKingdomCore.MyGame.rnd.NextDouble() > 0.5));
                            }
                            break;
                        }
                    case DarkKingdomCore.LandscapeType.MechanicsLS: 
                        {
                            this.landBmp = "mechanics";
                            break;
                        }
                    case DarkKingdomCore.LandscapeType.ForestLS: 
                        {
                            this.landBmp = "forest";
                            var num3 = DarkKingdomCore.MyGame.rnd.Next$2(10, 16);
                            for (var i4 = 0; i4 < num3; i4 = (i4 + 1) | 0) {
                                DarkKingdomCore.MyGame.backpars.add(new DarkKingdomCore.ImageParticle(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("back0"), DarkKingdomCore.MyGame.rnd.Next$1(4)), ((((125 + Bridge.Int.mul(((Bridge.Int.div((((DarkKingdomCore.MyGame.gameWidth - 250) | 0)), (((num3 - 1) | 0)))) | 0), i4)) | 0) - 32) | 0) + 20 * DarkKingdomCore.MyGame.rnd.NextDouble(), ((DarkKingdomCore.MyGame.hor - 70) | 0), 0, 0, -1, DarkKingdomCore.MyGame.rnd.NextDouble() > 0.5));
                            }
                            break;
                        }
                    case DarkKingdomCore.LandscapeType.InfernoLS: 
                        {
                            this.landBmp = "infernoland";
                            break;
                        }
                }
            },
            UpdateSkyTexture: function (tex, h, clr1R, clr1G, clr1B, clr1A, clr2R, clr2G, clr2B, clr2A) {
                var dR = (clr2R - clr1R) / h;
                var dG = (clr2G - clr1G) / h;
                var dB = (clr2B - clr1B) / h;
                var dA = (clr2A - clr1A) / h;
                var data = System.Array.init(h, function (){
                    return new Microsoft.Xna.Framework.Color();
                }, Microsoft.Xna.Framework.Color);
                for (var i = 0; i < h; i = (i + 1) | 0) {
                    data[i] = new Microsoft.Xna.Framework.Color.$ctor7(Bridge.Int.clip32(clr1R), Bridge.Int.clip32(clr1G), Bridge.Int.clip32(clr1B), Bridge.Int.clip32(clr1A));
                    clr1R += dR;
                    clr1G += dG;
                    clr1B += dB;
                    clr1A += dA;
                }
                tex.SetData$1(Microsoft.Xna.Framework.Color, data, 0, h);
            },
            Draw: function () {
                var $t, $t1, $t2, $t3, $t4, $t5, $t6, $t7;
                this.skyR = this.cnstR * (0.5 + this.snS / 2);
                this.skyG = this.cnstG * (0.5 + this.snS / 2);
                this.skyB = this.cnstB * (0.5 + this.snS / 2);
                this.skyR2 = this.cnstR2 * (0.66 + this.snS / 3);
                this.skyG2 = this.cnstG2 * (0.66 + this.snS / 3);
                this.skyB2 = this.cnstB2 * (0.66 + this.snS / 3);
                // lgb = New Drawing2D.LinearGradientBrush(skyrect, New Color(skyR, skyG, skyB), New Color(skyR2, skyG2, skyB2), 90)
                // g.FillRectangle(lgb, skyrect)

                this.UpdateSkyTexture(this.skytexture, this.skyrect.Height, this.skyR, this.skyG, this.skyB, 255, this.skyR2, this.skyG2, this.skyB2, 255);
                DarkKingdomCore.MyGame.FillRectangle(this.spriteBatch, this.skytexture, this.skyrect.$clone());

                if (this.snS > -0.5 && this.snS < 0.5) {
                    // sunsetlgb = New Drawing2D.LinearGradientBrush(skyrect, Color.Empty, Color.FromArgb((1 - Math.Abs(snS) * 2) * 100, sunsetclr), 90)
                    this.UpdateSkyTexture(this.sunsettexture, this.skyrect.Height, 0, 0, 0, 0, this.sunsetclr.R, this.sunsetclr.G, this.sunsetclr.B, (1 - Math.abs(this.snS) * 2) * 100);
                    DarkKingdomCore.MyGame.FillRectangle(this.spriteBatch, this.sunsettexture, this.skyrect.$clone());
                }
                // sunsetlgb = New Drawing2D.LinearGradientBrush(skyrect, Color.Empty, New Color((1 - Math.Abs(snS) * 2) * 100, sunsetclr), 90)
                // g.FillRectangle(sunsetlgb, skyrect)

                if (this.snS < 0) {
                    for (var i = 0; i < this.starsCnt; i = (i + 1) | 0) {
                        DarkKingdomCore.MyGame.FillRectangle$1(this.spriteBatch, this.starTex, Bridge.Int.clip32(this.stars[i].X), Bridge.Int.clip32(this.stars[i].Y), 1, 1);
                    }
                }



                $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.backpars);
                try {
                    while ($t.moveNext()) {
                        var p = Bridge.cast($t.Current, DarkKingdomCore.Particle);
                        p.XNADraw(this.spriteBatch);
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                for (var i1 = 0; i1 < DarkKingdomCore.MyGame.gameWidth; i1 = (i1 + 100) | 0) {
                    DarkKingdomCore.MyGame.sprites.getItem(this.landBmp).Draw$1(0, i1, ((DarkKingdomCore.MyGame.hor - 20) | 0), this.spriteBatch);
                }

                $t1 = Bridge.getEnumerator(DarkKingdomCore.MyGame.bushpars);
                try {
                    while ($t1.moveNext()) {
                        var p1 = Bridge.cast($t1.Current, DarkKingdomCore.Particle);
                        p1.XNADraw(this.spriteBatch);
                    }
                } finally {
                    if (Bridge.is($t1, System.IDisposable)) {
                        $t1.System$IDisposable$Dispose();
                    }
                }

                if (this.selU != null) {
                    DarkKingdomCore.MyGame.sprites.getItem("effects").Draw$1(0, this.selU.x + this.deltax - 14, ((DarkKingdomCore.MyGame.hor - 22) | 0), this.spriteBatch);
                    if (this.selU.Attack.Range > 1) {
                    }
                }

                $t2 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                try {
                    while ($t2.moveNext()) {
                        var u = $t2.Current;
                        if (u.owner === 0 || !u.AbsContains("Invisible")) {

                            // If u IsNot selU And u.x + u.params.rect.Right > m.X And m.X > u.x + u.params.rect.Left And hor + u.params.rect.Bottom > m.Y And m.Y > hor + u.params.rect.Top Then
                            // DrawSprite(spriteBatch, "effects", 0, u.x + deltax - 14, hor - 22)
                            // End If

                            this.deltay = 0;
                            this.deltax = 0;

                            if (!u.parameters.isBuilding && u.atkRecharge > ((u.parameters.Attack.Speed - 30) | 0) && u.atkRecharge < u.parameters.Attack.Speed) {
                                this.deltax = (Bridge.Int.div(Bridge.Int.mul(u.moveside, (((((u.atkRecharge - u.parameters.Attack.Speed) | 0) + 30) | 0))), 10)) | 0;
                            }

                            if (!u.isInCombat && u.parameters.moveType === DarkKingdomCore.UnitMoveType.FlyingMT) {
                                if (u.AbsContains("Bodyless")) {
                                    this.deltay = 3.0 * Math.sin(u.wingsWave);
                                } else {
                                    this.deltay = 2.0 * Math.sin(u.wingsWave);
                                }
                            }
                            DarkKingdomCore.MyGame.sprites.getItem("effects").Draw$1(1, u.x + this.deltax - 15, ((DarkKingdomCore.MyGame.hor - 22) | 0), this.spriteBatch);

                            if (u.moveside === 1) {
                                u.DrawCurrent(Bridge.Int.clip32(u.x + u.parameters.rect.Left + this.deltax + u.parameters.imgx), Bridge.Int.clip32(((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0) + this.deltay + u.parameters.imgy + 1), this.spriteBatch);
                            } else {
                                u.DrawCurrent(Bridge.Int.clip32(u.x + u.parameters.rect.Right + this.deltax - DarkKingdomCore.MyGame.sprites.getItem(u.parameters.spriteName).W - u.parameters.imgx), Bridge.Int.clip32(((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0) + this.deltay + u.parameters.imgy + 1), this.spriteBatch, Microsoft.Xna.Framework.Graphics.SpriteEffects.FlipHorizontally);
                            }

                            if (u.AbsContains("Invisible")) {
                                DarkKingdomCore.MyGame.sprites.getItem("effects").Draw$1(2, u.x - 16, ((((DarkKingdomCore.MyGame.hor + u.parameters.rect.Y) | 0) - 32) | 0), this.spriteBatch);
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t2, System.IDisposable)) {
                        $t2.System$IDisposable$Dispose();
                    }
                }


                $t3 = Bridge.getEnumerator(this.ammos);
                try {
                    while ($t3.moveNext()) {
                        var a = $t3.Current;
                        switch (a.type) {
                            case DarkKingdomCore.Ammo.AmmoType.Arrow: 
                            case DarkKingdomCore.Ammo.AmmoType.FastArrow: 
                                {
                                    var dx, dy;
                                    var n = Math.sqrt(a.vx * a.vx + a.vy * a.vy);
                                    dx = a.vx / n * 6;
                                    dy = a.vy / n * 6;
                                    break;
                                }
                            case DarkKingdomCore.Ammo.AmmoType.BigArrow: 
                                {
                                    var dx1, dy1;
                                    var n1 = Math.sqrt(a.vx * a.vx + a.vy * a.vy);
                                    dx1 = a.vx / n1 * 12;
                                    dy1 = a.vy / n1 * 12;
                                    break;
                                }
                            default: 
                                {
                                    if (a.vx >= 0) {
                                        DarkKingdomCore.MyGame.sprites.getItem("ammos").Draw$1(a.img, a.x - 5, a.y - 5, this.spriteBatch);
                                    } else {
                                        DarkKingdomCore.MyGame.sprites.getItem("ammos").Draw$1(a.img, a.x - 5, a.y - 5, this.spriteBatch, Microsoft.Xna.Framework.Graphics.SpriteEffects.FlipHorizontally);
                                    }
                                    break;
                                }
                        }
                    }
                } finally {
                    if (Bridge.is($t3, System.IDisposable)) {
                        $t3.System$IDisposable$Dispose();
                    }
                }


                $t4 = Bridge.getEnumerator(DarkKingdomCore.MyGame.pars);
                try {
                    while ($t4.moveNext()) {
                        var p2 = $t4.Current;
                        p2.XNADraw(this.spriteBatch);
                    }
                } finally {
                    if (Bridge.is($t4, System.IDisposable)) {
                        $t4.System$IDisposable$Dispose();
                    }
                }

                if (DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.InGame || DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.Win || DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.Lose) {
                    if (Bridge.referenceEquals(DarkKingdomCore.MyGame.plrs[0].hero, "Castle")) {
                        var castlebmp = (DarkKingdomCore.MyGame.plrs[0].castleFileName || "") + "1";
                        DarkKingdomCore.MyGame.sprites.getItem(castlebmp).Draw$1(0, 0, ((((DarkKingdomCore.MyGame.hor - Bridge.Int.mul(2, this.unitSize)) | 0) + 1) | 0), this.spriteBatch);
                    }
                    if (Bridge.referenceEquals(DarkKingdomCore.MyGame.plrs[1].hero, "Castle")) {
                        var castlebmp1 = (DarkKingdomCore.MyGame.plrs[1].castleFileName || "") + "1";
                        DarkKingdomCore.MyGame.sprites.getItem(castlebmp1).Draw$1(1, ((((DarkKingdomCore.MyGame.gameWidth - this.unitSize) | 0) + 1) | 0), ((((DarkKingdomCore.MyGame.hor - Bridge.Int.mul(2, this.unitSize)) | 0) + 2) | 0), this.spriteBatch);
                    }
                }

                if (this.snS < 0.2) {
                }

                if (this.snS > 0) {
                    DarkKingdomCore.MyGame.sprites.getItem("world").Draw$1(0, ((Bridge.Int.div(DarkKingdomCore.MyGame.gameWidth, 2)) | 0) - (((((Bridge.Int.div(DarkKingdomCore.MyGame.gameWidth, 2)) | 0) + 80) | 0)) * this.csS - 60, DarkKingdomCore.MyGame.gameHeight - (((DarkKingdomCore.MyGame.gameHeight - 140) | 0)) * this.snS - 60, this.spriteBatch);
                } else {
                    DarkKingdomCore.MyGame.sprites.getItem("world").Draw$1(1, ((Bridge.Int.div(DarkKingdomCore.MyGame.gameWidth, 2)) | 0) + (((((Bridge.Int.div(DarkKingdomCore.MyGame.gameWidth, 2)) | 0) + 80) | 0)) * this.csS - 60, DarkKingdomCore.MyGame.gameHeight + (((DarkKingdomCore.MyGame.gameHeight - 140) | 0)) * this.snS - 60, this.spriteBatch);
                }


                $t5 = Bridge.getEnumerator(DarkKingdomCore.MyGame.cloudpars);
                try {
                    while ($t5.moveNext()) {
                        var p3 = Bridge.cast($t5.Current, DarkKingdomCore.Particle);
                        p3.XNADraw(this.spriteBatch);
                    }
                } finally {
                    if (Bridge.is($t5, System.IDisposable)) {
                        $t5.System$IDisposable$Dispose();
                    }
                }


                $t6 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                try {
                    while ($t6.moveNext()) {
                        var u1 = $t6.Current;
                        if ((!u1.AbsContains("Invisible") || u1.owner === 0) && (u1.hp < u1.parameters.maxhp || Bridge.referenceEquals(u1, this.selU) || !Bridge.referenceEquals(u1.shownAbil, ""))) {
                            if (!u1.parameters.hpBotom) {
                                if (Bridge.referenceEquals(u1.shownAbil, "")) {
                                    DarkKingdomCore.MyGame.FillRectangle$1(this.spriteBatch, this.healthBarBackTex, ((((2 + Bridge.Int.clip32(u1.x)) | 0) + u1.parameters.rect.X) | 0), ((((DarkKingdomCore.MyGame.hor + u1.parameters.rect.Y) | 0) - 6) | 0), ((u1.parameters.rect.Width - 4) | 0), 4);
                                    if (u1.AbsContains("Poison")) {
                                        DarkKingdomCore.MyGame.FillRectangle$1(this.spriteBatch, this.healthBarPoisonTex, ((((3 + Bridge.Int.clip32(u1.x)) | 0) + u1.parameters.rect.X) | 0), ((((DarkKingdomCore.MyGame.hor + u1.parameters.rect.Y) | 0) - 5) | 0), Bridge.Int.clip32(u1.hp * (((u1.parameters.rect.Width - 6) | 0)) / u1.parameters.maxhp), 2);
                                    } else {
                                        DarkKingdomCore.MyGame.FillRectangle$1(this.spriteBatch, this.healthBarLifeTex, ((((3 + Bridge.Int.clip32(u1.x)) | 0) + u1.parameters.rect.X) | 0), ((((DarkKingdomCore.MyGame.hor + u1.parameters.rect.Y) | 0) - 5) | 0), Bridge.Int.clip32(u1.hp * (((u1.parameters.rect.Width - 6) | 0)) / u1.parameters.maxhp), 2);
                                    }
                                } else if (u1.abils.containsKey(u1.shownAbil)) {
                                    DarkKingdomCore.MyGame.FillRectangle$1(this.spriteBatch, this.healthBarBackTex, ((((2 + Bridge.Int.clip32(u1.x)) | 0) + u1.parameters.rect.X) | 0), ((((DarkKingdomCore.MyGame.hor + u1.parameters.rect.Y) | 0) - 9) | 0), ((u1.parameters.rect.Width - 4) | 0), 7);
                                    if (u1.AbsContains("Poison")) {
                                        DarkKingdomCore.MyGame.FillRectangle$1(this.spriteBatch, this.healthBarPoisonTex, ((((3 + Bridge.Int.clip32(u1.x)) | 0) + u1.parameters.rect.X) | 0), ((((DarkKingdomCore.MyGame.hor + u1.parameters.rect.Y) | 0) - 5) | 0), Bridge.Int.clip32(u1.hp * (((u1.parameters.rect.Width - 6) | 0)) / u1.parameters.maxhp), 2);
                                    } else {
                                        DarkKingdomCore.MyGame.FillRectangle$1(this.spriteBatch, this.healthBarLifeTex, ((((3 + Bridge.Int.clip32(u1.x)) | 0) + u1.parameters.rect.X) | 0), ((((DarkKingdomCore.MyGame.hor + u1.parameters.rect.Y) | 0) - 5) | 0), ((Bridge.Int.div(Bridge.Int.mul(Bridge.Int.clip32(u1.hp), (((u1.parameters.rect.Width - 6) | 0))), u1.parameters.maxhp)) | 0), 2);
                                    }
                                    DarkKingdomCore.MyGame.FillRectangle$1(this.spriteBatch, this.healthBarAbilTex, ((((3 + Bridge.Int.clip32(u1.x)) | 0) + u1.parameters.rect.X) | 0), ((((DarkKingdomCore.MyGame.hor + u1.parameters.rect.Y) | 0) - 8) | 0), ((Bridge.Int.div(Bridge.Int.mul(u1.abils.getItem(u1.shownAbil).value, (((u1.parameters.rect.Width - 6) | 0))), u1.shownAbilMaxVal)) | 0), 2);
                                } else {
                                    u1.shownAbil = "";
                                }
                            } else {
                                DarkKingdomCore.MyGame.FillRectangle$1(this.spriteBatch, this.healthBarBackTex, ((((2 + Bridge.Int.clip32(u1.x)) | 0) + u1.parameters.rect.X) | 0), ((DarkKingdomCore.MyGame.hor + 6) | 0), ((u1.parameters.rect.Width - 4) | 0), 5);
                                DarkKingdomCore.MyGame.FillRectangle$1(this.spriteBatch, this.healthBarLifeTex, ((((3 + Bridge.Int.clip32(u1.x)) | 0) + u1.parameters.rect.X) | 0), ((DarkKingdomCore.MyGame.hor + 7) | 0), Bridge.Int.clip32(u1.hp * (((u1.parameters.rect.Width - 6) | 0)) / u1.parameters.maxhp), 3);
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t6, System.IDisposable)) {
                        $t6.System$IDisposable$Dispose();
                    }
                }



                $t7 = Bridge.getEnumerator(DarkKingdomCore.MyGame.uipars);
                try {
                    while ($t7.moveNext()) {
                        var p4 = $t7.Current;
                        p4.XNADraw(this.spriteBatch);
                    }
                } finally {
                    if (Bridge.is($t7, System.IDisposable)) {
                        $t7.System$IDisposable$Dispose();
                    }
                }

                if (this.globalExplode > 0) {
                    this.globalExplode -= 2;
                }
            },
            Resize: function (ww, hh, fullscreen, uiScale) {
                if (uiScale === void 0) { uiScale = 1.0; }
                this._screenWidth = ww;
                this.scaleX = DarkKingdomCore.MyGame.gameWidth / this._screenWidth;
                this._screenHeight = hh;
                this.scaleY = DarkKingdomCore.MyGame.gameHeight / this._screenHeight;
                if ((this.MainContainer != null)) {
                    this.MainContainer.W = this._screenWidth;
                    this.MainContainer.H = this._screenHeight;
                    this.MainContainer.ChildrenScaleX = uiScale;
                    this.MainContainer.ChildrenScaleY = uiScale;
                    this.MainContainer.IsNeedRecalc = true;
                }

                this.graphics.PreferredBackBufferWidth = this._screenWidth;
                this.graphics.PreferredBackBufferHeight = this._screenHeight;
                this.graphics.IsFullScreen = fullscreen;
                this.graphics.ApplyChanges();
            },
            ShowInfoPar: function (txt, clr, x, y, harm, big) {
                if (big === void 0) { big = false; }
                if (!harm) {
                    DarkKingdomCore.MyGame.pars.add(new DarkKingdomCore.TextParticle(this.defaultTheme.GetFont(12), clr.$clone(), x, y, ((Bridge.Int.div(DarkKingdomCore.MyGame.rnd.Next$2(-10, 11), 10)) | 0), -2, 0.1, 50, txt));
                } else {
                    if (big) {
                        DarkKingdomCore.MyGame.pars.add(new DarkKingdomCore.TextParticle(this.defaultTheme.GetFont(12), clr.$clone(), x, y, 0, -0.35, -0.05, 75, txt));
                    } else {
                        DarkKingdomCore.MyGame.pars.add(new DarkKingdomCore.TextParticle(this.defaultTheme.GetFont(12), clr.$clone(), x, y, 0, -0.35, -0.05, 75, txt));
                    }
                }
            },
            OnSuccessfulAttack: function (dmg, u, trg, ignoreArmor) {
                var $t, $t1, $t2, $t3, $t4;
                this.Harm(trg, dmg, ignoreArmor, DarkKingdomCore.EffectType.Normal);
                if (!ignoreArmor) {
                    dmg *= trg.parameters._armor;
                }
                $t = Bridge.getEnumerator(u.abils.Values);
                try {
                    while ($t.moveNext()) {
                        var a = $t.Current;
                        if (a.condCompleted) {
                            switch (a.name) {
                                case "Selfdamage": 
                                    {
                                        this.Harm(u, dmg, true, DarkKingdomCore.EffectType.Bad);
                                        break;
                                    }
                                case "Denying": 
                                    {
                                        if (!trg.AbsContains$1(["Bodyless", "Machinery"]) && !trg.parameters.isBuilding && trg.hp <= a.value) {
                                            this.Kill(trg);
                                            this.ShowInfoPar("\u0414\u043e\u0431\u0438\u0432\u0430\u043d\u0438\u0435", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                                        }

                                        break;
                                    }
                                case "Vampirism": 
                                    {
                                        if (!trg.AbsContains$1(["Building", "Undead", "Machinery"])) {
                                            this.Heal(u, dmg / 2);
                                        }
                                        break;
                                    }
                                case "Crasher": 
                                    {
                                        if (!trg.parameters.isBuilding && dmg >= a.value && !Bridge.referenceEquals(trg.parameters.Armor, "None")) {
                                            trg.parameters.Armor = "None";
                                            this.ShowInfoPar("\u0411\u0440\u043e\u043d\u044f \u0440\u0430\u0437\u0440\u0443\u0448\u0435\u043d\u0430", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                        }

                                        break;
                                    }
                                case "Enjoy pain": 
                                    {
                                        if (!trg.parameters.isBuilding && trg.AbsContains("Poison")) {
                                            this.Heal(u, dmg);
                                        }
                                        break;
                                    }
                                case "Evil_eye": 
                                    {
                                        if (!trg.parameters.isBuilding && Bridge.referenceEquals(trg.parameters.Armor, "None") && !trg.AbsContains("Clumsiness")) {
                                            trg.AddAbility$1("Clumsiness", DarkKingdomCore.EffectType.Bad);
                                            this.ShowInfoPar("\u041e\u0441\u043b\u0430\u0431\u043b\u0435\u043d", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                        }

                                        break;
                                    }
                                case "Curser": 
                                    {
                                        if (!trg.parameters.isBuilding && !trg.AbsContains("Clumsiness")) {
                                            trg.AddAbility$1("Clumsiness", DarkKingdomCore.EffectType.Bad);
                                            this.ShowInfoPar("\u041e\u0441\u043b\u0430\u0431\u043b\u0435\u043d", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                        }

                                        break;
                                    }
                                case "Spikes_bomb": 
                                    {
                                        if (Bridge.referenceEquals(trg.parameters.Armor, "None") && !trg.AbsContains$1(["Building", "Undead", "Bodyless", "Machinery"])) {
                                            ($t1 = trg.parameters.$clone()).maxhp = ($t1.maxhp - Bridge.Int.clip32(dmg)) | 0;
                                        }
                                        break;
                                    }
                                case "Destroy_light_armor": 
                                    {
                                        if (!trg.parameters.isBuilding && Bridge.referenceEquals(trg.parameters.Armor, "Light")) {
                                            trg.parameters.Armor = "None";
                                            this.ShowInfoPar("\u0411\u0440\u043e\u043d\u044f \u0440\u0430\u0437\u0440\u0443\u0448\u0435\u043d\u0430", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                        }

                                        break;
                                    }
                                case "Destroy_heavy_armor": 
                                    {
                                        if (!trg.parameters.isBuilding && Bridge.referenceEquals(trg.parameters.Armor, "Heavy")) {
                                            trg.parameters.Armor = "None";
                                            this.ShowInfoPar("\u0411\u0440\u043e\u043d\u044f \u0440\u0430\u0437\u0440\u0443\u0448\u0435\u043d\u0430", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                        }

                                        break;
                                    }
                                case "Destroy_ethereal_armor": 
                                    {
                                        if (!trg.parameters.isBuilding && Bridge.referenceEquals(trg.parameters.Armor, "Ethereal")) {
                                            trg.parameters.Armor = "None";
                                            this.ShowInfoPar("\u0411\u0440\u043e\u043d\u044f \u0440\u0430\u0437\u0440\u0443\u0448\u0435\u043d\u0430", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                        }

                                        break;
                                    }
                                case "Levitation": 
                                    {
                                        if (trg.parameters.moveType === DarkKingdomCore.UnitMoveType.GroundMT && !trg.parameters.isBuilding && !u.isInRangeCombat) {
                                            trg.takedOff = true;
                                        }
                                        break;
                                    }
                                case "Purification": 
                                    {
                                        trg.purified = true;
                                        break;
                                    }
                                case "Purification_on_first_attack": 
                                    {
                                        if (!trg.parameters.isBuilding) {
                                            trg.purified = true;
                                            u.abils.getItem("Purification_on_first_attack").used = true;
                                        }

                                        break;
                                    }
                                case "CatchAbil": 
                                    {
                                        if (!trg.parameters.isBuilding && !u.isInRangeCombat && trg.parameters.moveType === DarkKingdomCore.UnitMoveType.FlyingMT) {
                                            u.landing = true;
                                            trg.landing = true;
                                            a.used = true;
                                        }

                                        break;
                                    }
                                case "Instant_kill": 
                                    {
                                        if (!trg.parameters.isBuilding && DarkKingdomCore.MyGame.rnd.Next$1(100) < a.value) {
                                            this.Kill(trg);
                                            u.hp -= trg.hp;
                                            this.ShowInfoPar("\u0423\u0431\u0438\u0442!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                                        }

                                        break;
                                    }
                                case "Crippling_injury": 
                                    {
                                        if (!trg.AbsContains$1(["Building", "Undead", "Bodyless", "Machinery"])) {
                                            ($t2 = trg.parameters.$clone()).maxhp = ($t2.maxhp - Bridge.Int.clip32(dmg)) | 0;
                                        }
                                        break;
                                    }
                                case "Plaguer": 
                                    {
                                        if (!trg.parameters.isBuilding && !trg.AbsContains("Plague")) {
                                            trg.AddAbility$1("Plague", DarkKingdomCore.EffectType.Bad);
                                            this.ShowInfoPar("\u0417\u0430\u0447\u0443\u043c\u043b\u0435\u043d!", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                        }

                                        break;
                                    }
                                case "Activate plague": 
                                    {
                                        if (trg.AbsContains("Plague")) {
                                            $t3 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                                            try {
                                                while ($t3.moveNext()) {
                                                    var uu = $t3.Current;
                                                    if (!uu.AbsContains$1(["Undead", "Machinery"]) && !uu.parameters.isBuilding && Math.abs(u.x - uu.x) <= Bridge.Int.mul(2, this.unitSize)) {
                                                        this.Harm(uu, DarkKingdomCore.MyGame.rnd.Next$2(10, 21), true, DarkKingdomCore.EffectType.Bad);
                                                    }
                                                }
                                            } finally {
                                                if (Bridge.is($t3, System.IDisposable)) {
                                                    $t3.System$IDisposable$Dispose();
                                                }
                                            }
                                        }

                                        break;
                                    }
                                case "Heavy_arrows": 
                                    {
                                        if (!trg.parameters.isBuilding && trg.parameters.moveType === DarkKingdomCore.UnitMoveType.FlyingMT && DarkKingdomCore.MyGame.rnd.Next$1(100) < a.value) {
                                            trg.landing = true;
                                        }
                                        break;
                                    }
                                case "Slower": 
                                    {
                                        if (!trg.parameters.isBuilding && !Bridge.referenceEquals(trg.parameters.Speed, "Slow")) {
                                            trg.parameters.Speed = "Slow";
                                            this.ShowInfoPar("\u0417\u0430\u043c\u0435\u0434\u043b\u0435\u043d!", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                        }

                                        break;
                                    }
                                case "Poisoner": 
                                    {
                                        if (DarkKingdomCore.MyGame.rnd.Next$1(100) < a.value) {
                                            this.Poison(trg);
                                        }
                                        break;
                                    }
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                if (u.isInRangeCombat) {
                    $t4 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                    try {
                        while ($t4.moveNext()) {
                            var uu1 = $t4.Current;
                            if (uu1.owner === u.owner && trg.Near(uu1) && uu1.AbsContains("Support_archers")) {
                                this.Harm(trg, DarkKingdomCore.MyGame.rnd.Next$2(10, 15), true, DarkKingdomCore.EffectType.Bad);
                            }
                        }
                    } finally {
                        if (Bridge.is($t4, System.IDisposable)) {
                            $t4.System$IDisposable$Dispose();
                        }
                    }
                }
            },
            Poison: function (trg) {
                if (!trg.AbsContains("Poison") && !trg.parameters.isBuilding) {
                    if (!trg.AbsContains$1(["Poisonproof", "Bodyless", "Machinery"])) {
                        trg.AddAbility$1("Poison", DarkKingdomCore.EffectType.Poison);
                        this.ShowInfoPar("\u041e\u0442\u0440\u0430\u0432\u043b\u0435\u043d!", DarkKingdomCore.MyGame.poiAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                    }
                }
            },
            OnPreAttack: function (u, trg, dmg) {
                var $t, $t1, $t2;
                var agil = false;
                $t = Bridge.getEnumerator(u.abils.Values);
                try {
                    while ($t.moveNext()) {
                        var a = $t.Current;
                        if (a.condCompleted) {
                            switch (a.name) {
                                case "We are pirates": 
                                    {
                                        do {
                                            ($t1 = DarkKingdomCore.MyGame.rnd.NextDouble());
                                            if (Bridge.is($t1, System.Object)) {
                                                var _discard1 = $t1;
                                                if (DarkKingdomCore.MyGame.rnd.NextDouble() < 0.33) {
                                                    {
                                                        this.ShowInfoPar("\u0419\u0430\u0440\u0440\u0440!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                                                        break;
                                                    }
                                                }
                                            }

                                            if (Bridge.is($t1, System.Object)) {
                                                var _discard2 = $t1;
                                                if (DarkKingdomCore.MyGame.rnd.NextDouble() < 0.66) {
                                                    {
                                                        this.ShowInfoPar("\u0421\u0443\u0445\u043e\u043f\u0443\u0442\u043d\u0430\u044f \u043a\u0440\u0440\u0440\u044b\u0441\u0430!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                                                        break;
                                                    }
                                                }
                                            }

                                            {
                                                {
                                                    this.ShowInfoPar("\u0422\u044b\u0441\u044f\u0447\u0430 \u0447\u0435\u0440\u0442\u0435\u0439!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                                                    break;
                                                }
                                            }
                                        } while (false);
                                        break;
                                    }
                                case "Attack_bonus": 
                                    {
                                        dmg.v += a.value;
                                        break;
                                    }
                                case "Shrapnel": 
                                    {
                                        if (u.isInRangeCombat) {
                                            dmg.v -= 20 * Math.abs(u.x - trg.x) / this.unitSize;
                                        }
                                        break;
                                    }
                                case "Snipering": 
                                    {
                                        if (u.isInRangeCombat && Math.abs(u.x - trg.x) >= ((Bridge.Int.mul(u.Attack.Range, this.unitSize) - this.us2) | 0)) {
                                            dmg.v += a.value;
                                        }
                                        break;
                                    }
                                case "Landshooter": 
                                    {
                                        if (trg.parameters.moveType === DarkKingdomCore.UnitMoveType.FlyingMT) {
                                            dmg.v /= 2;
                                        }
                                        break;
                                    }
                                case "Hate_flyers": 
                                    {
                                        if (trg.parameters.moveType === DarkKingdomCore.UnitMoveType.FlyingMT) {
                                            dmg.v *= 2;
                                        }
                                        break;
                                    }
                                case "Hate_giants": 
                                    {
                                        if (trg.parameters.moveType === DarkKingdomCore.UnitMoveType.HugeMT) {
                                            dmg.v *= 2;
                                        }
                                        break;
                                    }
                                case "Hate_poisoned": 
                                    {
                                        if (trg.AbsContains("Poison")) {
                                            dmg.v *= 2;
                                        }
                                        break;
                                    }
                                case "Hate mages": 
                                    {
                                        if (trg.AbsContains("Mage")) {
                                            dmg.v *= 2;
                                        }
                                        break;
                                    }
                                case "Spikes_bomb": 
                                    {
                                        if (Bridge.referenceEquals(trg.parameters.Armor, "None")) {
                                            dmg.v *= 2;
                                        }
                                        break;
                                    }
                                case "Brave": 
                                    {
                                        if (DarkKingdomCore.MyGame.rnd.Next$1(100) <= a.value) {
                                            dmg.v = 3 * dmg.v;
                                            this.ShowInfoPar("\u041a\u0440\u0438\u0442!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                                        }
                                        break;
                                    }
                                case "Kamikaze": 
                                    {
                                        if (!u.AbsContains("Explosive")) {
                                            this.Explode(u, u.AbsContains("Mage"));
                                        }
                                        this.Kill(u);
                                        break;
                                    }
                                case "Burst": 
                                    {
                                        if (!u.isInRangeCombat) {
                                            u.parameters.Speed = "Normal";
                                            u.abils.getItem("Burst").used = true;
                                            this.ShowInfoPar("\u0411\u0438\u0442\u0432\u0430!", DarkKingdomCore.MyGame.badAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                                        }

                                        break;
                                    }
                                case "Instability": 
                                    {
                                        if (trg.parameters.moveType === DarkKingdomCore.UnitMoveType.HugeMT || trg.AbsContains("Durability") && !u.isInRangeCombat) {
                                            this.Explode(u, u.AbsContains("Mage"));
                                            this.Kill(u);
                                        }

                                        break;
                                    }
                                case "Spawn_demons": 
                                    {
                                        if (u.isInRangeCombat && DarkKingdomCore.MyGame.plrs[u.owner].prdQ.Count > 0) {
                                            var u2 = new DarkKingdomCore.Unit(this, trg.x - Bridge.Int.mul(this.us2, u.moveside), u.moveside, u.owner, DarkKingdomCore.MyGame.unitPrms.getItem(DarkKingdomCore.MyGame.plrs[u.owner].prdQ.getItem(0)).$clone());
                                            this.bornList.add(u2);
                                            this.ShowInfoPar("\u041f\u0440\u0438\u0437\u0432\u0430\u043d!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u2.x, ((DarkKingdomCore.MyGame.hor + u2.parameters.rect.Top) | 0), true);
                                            DarkKingdomCore.MyGame.pars.add(new DarkKingdomCore.ImageParticle(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("explode"), 2), u2.x - 25, ((((((DarkKingdomCore.MyGame.hor + u2.parameters.rect.Bottom) | 0) - this.us2) | 0) - 25) | 0), 0, 0, 20));
                                            this.RemoveFromQueue(u.owner, 0);
                                        }

                                        break;
                                    }
                                case "Melee_penalty": 
                                    {
                                        if (!u.isInRangeCombat) {
                                            dmg.v /= 2;
                                        }
                                        break;
                                    }
                                case "Range_penalty": 
                                    {
                                        if (u.isInRangeCombat) {
                                            dmg.v /= 2;
                                        }
                                        break;
                                    }
                                case "First_shoot": 
                                    {
                                        if (u.isInRangeCombat) {
                                            dmg.v += a.value;
                                            u.abils.getItem("First_shoot").used = true;
                                            this.ShowInfoPar("\u0423\u0441\u0438\u043b\u0435\u043d\u043d\u044b\u0439 \u0432\u044b\u0441\u0442\u0440\u0435\u043b!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                                        }

                                        break;
                                    }
                                case "Soullink": 
                                    {
                                        dmg.v += DarkKingdomCore.MyGame.rnd.Next$2(10, 21);
                                        this.Harm(u, DarkKingdomCore.MyGame.rnd.Next$2(5, 11), true, DarkKingdomCore.EffectType.Bad);
                                        break;
                                    }
                                case "Invisible": 
                                    {
                                        this.Deinvisible(u);
                                        break;
                                    }
                                case "Clumsiness": 
                                    {
                                        if (DarkKingdomCore.MyGame.rnd.Next$1(100) < 20) {
                                            agil = true;
                                        }
                                        break;
                                    }
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                $t2 = Bridge.getEnumerator(trg.abils.Values);
                try {
                    while ($t2.moveNext()) {
                        var ta = $t2.Current;
                        if (ta.condCompleted) {
                            switch (ta.name) {
                                case "Agility": 
                                    {
                                        if (DarkKingdomCore.MyGame.rnd.Next$1(100) < ta.value) {
                                            agil = true;
                                        }
                                        break;
                                    }
                                case "Evasion": 
                                    {
                                        if (u.isInRangeCombat) {
                                            agil = true;
                                        }
                                        break;
                                    }
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t2, System.IDisposable)) {
                        $t2.System$IDisposable$Dispose();
                    }
                }
                if (u.AbsContains("Accuracy")) {
                    agil = false;
                }
                return agil;
            },
            OnAgil: function (u, trg) {
                var $t;
                $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                try {
                    while ($t.moveNext()) {
                        var uu = $t.Current;
                        if (!(uu.owner === u.owner) && uu.AbsContains("Punishment_on_miss")) {
                            this.Harm(u, DarkKingdomCore.MyGame.rnd.Next$2(20, 40), true, DarkKingdomCore.EffectType.Bad);
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                if (trg.AbsContains("Agility_rollback")) {
                    trg.Attack = DarkKingdomCore.Attack.op_Addition$1(trg.Attack.$clone(), (trg.abils.getItem("Agility_rollback").value) | 0);
                }
                if (trg.AbsContains("Kill_on_agil")) {
                    this.Kill(u);
                    this.ShowInfoPar("\u0410\u0430\u0430\u0430\u0430\u0430", DarkKingdomCore.MyGame.badAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), false);
                }
                if (trg.AbsContains("Harm_on_agil")) {
                    this.Harm(u, DarkKingdomCore.MyGame.rnd.Next$2(20, 41), true, DarkKingdomCore.EffectType.Bad);
                }
                if (trg.AbsContains("Trick")) {
                    this.Heal(trg, trg.parameters.maxhp);
                } else {
                    this.ShowInfoPar("0", DarkKingdomCore.MyGame.goodAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), false);
                }
            },
            CheckBasicConditions: function (u) {
                var $t;
                $t = Bridge.getEnumerator(u.abils.Values);
                try {
                    while ($t.moveNext()) {
                        var a = $t.Current;
                        if (a.used) {
                            a.condCompleted = false;
                        } else {
                            if (!Bridge.referenceEquals(a.condition, "")) {
                                switch (a.condition) {
                                    case "Tier": 
                                        {
                                            if (DarkKingdomCore.MyGame.plrs[u.owner].res.Tier >= a.condnum) {
                                                a.condCompleted = true;
                                            } else {
                                                a.condCompleted = false;
                                            }
                                            break;
                                        }
                                    case "Poisoned": 
                                        {
                                            if (u.AbsContains("Poison")) {
                                                a.condCompleted = true;
                                            } else {
                                                a.condCompleted = false;
                                            }
                                            break;
                                        }
                                    case "Low_health": 
                                        {
                                            if (u.hp <= 0.5 * u.parameters.maxhp) {
                                                a.condCompleted = true;
                                            } else {
                                                a.condCompleted = false;
                                            }
                                            break;
                                        }
                                    case "On_enemy_side": 
                                        {
                                            if ((u.moveside === 1 && u.x >= DarkKingdomCore.MyGame.gameWidth / 2.0) || (u.moveside === -1 && u.x <= DarkKingdomCore.MyGame.gameWidth / 2.0)) {
                                                a.condCompleted = true;
                                            } else {
                                                a.condCompleted = false;
                                            }
                                            break;
                                        }
                                    case "At_night": 
                                        {
                                            if (this.snS < 0) {
                                                a.condCompleted = true;
                                            } else {
                                                a.condCompleted = false;
                                            }
                                            break;
                                        }
                                    case "By_day": 
                                        {
                                            if (this.snS >= 0) {
                                                a.condCompleted = true;
                                            } else {
                                                a.condCompleted = false;
                                            }
                                            break;
                                        }
                                    case "Machine_army": 
                                        {
                                            if (this.machinenum >= a.condnum) {
                                                a.condCompleted = true;
                                            } else {
                                                a.condCompleted = false;
                                            }
                                            break;
                                        }
                                    case "On_enter": 
                                        {
                                            a.condCompleted = true;
                                            break;
                                        }
                                }
                            } else {
                                a.condCompleted = true;
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            },
            FindFirstUnflyUnit: function (plr) {
                var $t;
                var xres = 0;
                var ures = null;
                $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                try {
                    while ($t.moveNext()) {
                        var u = $t.Current;
                        if (u.owner === plr && !(u.parameters.moveType === DarkKingdomCore.UnitMoveType.FlyingMT) && !u.parameters.isBuilding) {
                            if (ures == null || (u.x - xres) * u.moveside > 0) {
                                xres = u.x;
                                ures = u;
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                return ures;
            },
            FindRandomUnflyUnit: function (plr) {
                var $t;
                var avunits = new (System.Collections.Generic.List$1(DarkKingdomCore.Unit)).ctor();
                $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                try {
                    while ($t.moveNext()) {
                        var u = $t.Current;
                        if (u.owner === plr && !(u.parameters.moveType === DarkKingdomCore.UnitMoveType.FlyingMT) && !u.parameters.isBuilding) {
                            avunits.add(u);
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                if (avunits.Count > 0) {
                    return avunits.getItem(DarkKingdomCore.MyGame.rnd.Next$1(avunits.Count));
                }
                return null;
            },
            FindRandomFlyUnit: function (plr, hpLim) {
                var $t;
                var avunits = new (System.Collections.Generic.List$1(DarkKingdomCore.Unit)).ctor();
                $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                try {
                    while ($t.moveNext()) {
                        var u = $t.Current;
                        if (u.owner === plr && u.parameters.moveType === DarkKingdomCore.UnitMoveType.FlyingMT && u.hp <= hpLim && !u.parameters.isBuilding) {
                            avunits.add(u);
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                if (avunits.Count > 0) {
                    return avunits.getItem(DarkKingdomCore.MyGame.rnd.Next$1(avunits.Count));
                }
                return null;
            },
            DoUnits: function () {
                var $t, $t1, $t2, $t3, $t4, $t5, $t6, $t7, $t8, $t9, $t10, $t11, $t12, $t13, $t14, $t15, $t16, $t17, $t18, $t19, $t20, $t21, $t22, $t23, $t24, $t25;
                var targets = new (System.Collections.Generic.List$1(DarkKingdomCore.Unit)).ctor();
                var newtargets = new (System.Collections.Generic.List$1(DarkKingdomCore.Unit)).ctor();
                var dmg = { };
                var stp;
                var nearestOne;
                $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                try {
                    while ($t.moveNext()) {
                        var u = $t.Current;
                        if (u.AbsContains("Power_of_unity")) {
                            u.parameters.Attack.MinDamage = Bridge.Int.mul(10, DarkKingdomCore.MyGame.plrs[u.owner].unitCount);
                            u.parameters.Attack.MaxDamage = Bridge.Int.mul(20, DarkKingdomCore.MyGame.plrs[u.owner].unitCount);
                        }

                        stp = false;
                        targets.clear();
                        nearestOne = -1;
                        u.atkMod.Range = 0;
                        u.parameters.isIgnoreUnits = false;
                        this.CheckBasicConditions(u);
                        this.OnUnitsAbils(u);
                        u.isInCombat = false;

                        $t1 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                        try {
                            while ($t1.moveNext()) {
                                var u2 = $t1.Current;
                                if (!Bridge.referenceEquals(u, u2)) {
                                    if (u.parameters._speed > 0) {
                                        if (!u.parameters.isIgnoreUnits) {
                                            if (u.parameters.Near(u2.parameters.$clone()) && u.moveside * (u2.x - u.x) > 0 && (u.moveside * (u2.x - u.x) < this.unitSize)) {
                                                if (!u2.parameters.isIgnoreUnits && (u.owner !== u2.owner || (u.AbsContains("Bodyless") === u2.AbsContains("Bodyless") && !u.AbsContains("Ignore_friends") && !u.AbsContains("Burst") && !u2.AbsContains("Weaponry") && !u2.parameters.isBuilding))) {
                                                    stp = true;
                                                }
                                                if (u.owner === u2.owner && !u.AbsContains("Mage") && u2.AbsContains("Weaponry")) {
                                                    this.Kill(u);
                                                    u2.hp += u.hp;
                                                    ($t2 = u2.parameters.$clone()).maxhp = ($t2.maxhp + Bridge.Int.clip32(u.hp)) | 0;
                                                    ($t3 = u2.parameters.Attack.$clone()).MinDamage = ($t3.MinDamage + u.parameters.Attack.MinDamage) | 0;
                                                    ($t4 = u2.parameters.Attack.$clone()).MaxDamage = ($t4.MaxDamage + u.parameters.Attack.MaxDamage) | 0;
                                                    ($t5 = DarkKingdomCore.MyGame.plrs[u.owner]).unitCount = ($t5.unitCount - 1) | 0;
                                                }
                                            }
                                        }
                                        if (u.moveside * (u2.x - u.x) >= 0 && u.moveside * (u2.x - u.x) < u.parameters._speed + u2.parameters._speed && u.parameters.Near(u2.parameters.$clone())) {
                                            if (u.owner !== u2.owner && u.AbsContains("Damage_on_move")) {
                                                if (u.AbsContains("Mage")) {
                                                    this.Harm(u2, DarkKingdomCore.MyGame.rnd.Next$2(50, 71), true, DarkKingdomCore.EffectType.Bad);
                                                } else {
                                                    this.Harm(u2, DarkKingdomCore.MyGame.rnd.Next$2(50, 71), false, DarkKingdomCore.EffectType.Normal);
                                                }
                                            }
                                            if (u.owner === u2.owner && u2.AbsContains("Money_treasure")) {
                                                u2.abils.getItem("Money_treasure").used = true;
                                                this.deathlist.add(u2);
                                                ($t6 = DarkKingdomCore.MyGame.plrs[u.owner].res.$clone()).Money = ($t6.Money + u2.abils.getItem("Money_treasure").value) | 0;
                                                this.ShowInfoPar(System.String.format("+{0}", [u2.abils.getItem("Money_treasure").value]), this.moneyClr.$clone(), u2.x, ((DarkKingdomCore.MyGame.hor + u2.parameters.rect.Top) | 0), true);
                                            }
                                        }
                                    } else {
                                        stp = true;
                                    }

                                    if (u.parameters.Attack.MaxDamage > 0) {
                                        if (u.owner !== u2.owner && (u.parameters.Near(u2.parameters.$clone()) || u.Attack.Range > 1)) {
                                            if ((u.moveside * (u2.x - u.x) > 0 && u.moveside * (u2.x - u.x) < Bridge.Int.mul(u.Attack.Range, this.unitSize)) && !u2.AbsContains("Invisible")) {
                                                if (nearestOne === -1) {
                                                    nearestOne = targets.Count;
                                                } else {
                                                    if (u.moveside * (targets.getItem(nearestOne).x - u2.x) > 0) {
                                                        nearestOne = targets.Count;
                                                    }
                                                }
                                                targets.add(u2);
                                                u.isInCombat = true;
                                            }
                                        }
                                    }
                                }
                            }
                        } finally {
                            if (Bridge.is($t1, System.IDisposable)) {
                                $t1.System$IDisposable$Dispose();
                            }
                        }
                        u.isInRangeCombat = false;
                        newtargets.clear();
                        if (targets.Count > 0) {
                            if (!u.AbsContains("Dragon_breath")) {
                                $t7 = Bridge.getEnumerator(targets);
                                try {
                                    while ($t7.moveNext()) {
                                        var trg = $t7.Current;
                                        if (u.Near(trg)) {
                                            newtargets.add(trg);
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t7, System.IDisposable)) {
                                        $t7.System$IDisposable$Dispose();
                                    }
                                }
                                if (newtargets.Count === 0) {
                                    if (u.AbsContains("Attack selected") && !DarkKingdomCore.MyGame.plrs[u.owner].AI) {
                                        if (targets.contains(this.selU)) {
                                            newtargets.add(this.selU);
                                            u.isInRangeCombat = true;
                                        }
                                    } else {
                                        newtargets.add(targets.getItem(nearestOne));
                                        u.isInRangeCombat = true;
                                    }
                                }
                            } else {
                                $t8 = Bridge.getEnumerator(targets);
                                try {
                                    while ($t8.moveNext()) {
                                        var trg1 = $t8.Current;
                                        newtargets.add(trg1);
                                    }
                                } finally {
                                    if (Bridge.is($t8, System.IDisposable)) {
                                        $t8.System$IDisposable$Dispose();
                                    }
                                }
                                u.isInRangeCombat = true;
                            }
                        }
                        if (newtargets.Count > 0) {
                            if (u.AbsContains("Hover")) {
                                stp = true;
                            }
                            if (u.atkRecharge === 0) {
                                if (u.parameters.animated) {
                                    u.StartAnimation("Attack", this.mainAnimator);
                                }
                                $t9 = Bridge.getEnumerator(newtargets);
                                try {
                                    while ($t9.moveNext()) {
                                        var trg2 = $t9.Current;
                                        $t10 = Bridge.getEnumerator(u.abils.Values);
                                        try {
                                            while ($t10.moveNext()) {
                                                var aa = $t10.Current;
                                                if (Bridge.referenceEquals(aa.condition, "On_attack")) {
                                                    aa.condCompleted = true;
                                                }
                                            }
                                        } finally {
                                            if (Bridge.is($t10, System.IDisposable)) {
                                                $t10.System$IDisposable$Dispose();
                                            }
                                        }
                                        dmg.v = DarkKingdomCore.MyGame.rnd.Next$2(u.Attack.MinDamage, ((u.Attack.MaxDamage + 1) | 0));

                                        if (this.OnPreAttack(u, trg2, dmg)) {
                                            if (u.isInRangeCombat && !(u.parameters.ammoType === DarkKingdomCore.Ammo.AmmoType.None)) {
                                                if (u.AbsContains("Rocket_shoot") && DarkKingdomCore.MyGame.rnd.Next$1(100) < u.abils.getItem("Rocket_shoot").value) {
                                                    this.ammos.add(new DarkKingdomCore.Ammo.ctor(u.owner, DarkKingdomCore.Ammo.AmmoType.RedBall, u.x, ((((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0) + this.us2) | 0), u, trg2, 0, false, true, 7200, true));
                                                } else {
                                                    this.ammos.add(new DarkKingdomCore.Ammo.ctor(u.owner, u.parameters.ammoType, u.x, ((((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0) + this.us2) | 0), u, trg2, 0, false, true, 7200));
                                                }
                                            } else {
                                                this.OnAgil(u, trg2);
                                            }
                                        } else {
                                            $t11 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                                            try {
                                                while ($t11.moveNext()) {
                                                    var uu = $t11.Current;
                                                    if (uu.owner === u.owner && uu.AbsContains("Ragequit") && DarkKingdomCore.MyGame.rnd.Next$1(5) === 0) {
                                                        this.Harm(uu, dmg.v, true, DarkKingdomCore.EffectType.Bad);
                                                        dmg.v = 3 * dmg.v;
                                                        this.ShowInfoPar("\u041a\u0440\u0438\u0442!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                                                    }
                                                }
                                            } finally {
                                                if (Bridge.is($t11, System.IDisposable)) {
                                                    $t11.System$IDisposable$Dispose();
                                                }
                                            }

                                            var ia = (u.AbsContains("Arbalester") && Bridge.referenceEquals(trg2.parameters.Armor, "Light")) || (u.AbsContains("Shooter") && (Bridge.referenceEquals(trg2.parameters.Armor, "Light") || Bridge.referenceEquals(trg2.parameters.Armor, "Heavy"))) || u.AbsContains("Mage");


                                            if (u.isInRangeCombat && !(u.parameters.ammoType === DarkKingdomCore.Ammo.AmmoType.None)) {
                                                if (u.AbsContains("Rocket_shoot") && DarkKingdomCore.MyGame.rnd.Next$1(100) < u.abils.getItem("Rocket_shoot").value) {
                                                    this.ammos.add(new DarkKingdomCore.Ammo.ctor(u.owner, DarkKingdomCore.Ammo.AmmoType.RedBall, u.x, ((((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0) + this.us2) | 0), u, trg2, dmg.v, ia, false, 7200, true));
                                                } else {
                                                    this.ammos.add(new DarkKingdomCore.Ammo.ctor(u.owner, u.parameters.ammoType, u.x, ((((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0) + this.us2) | 0), u, trg2, dmg.v, ia, false, 7200));
                                                }
                                            } else {
                                                this.OnSuccessfulAttack(dmg.v, u, trg2, ia);
                                            }
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t9, System.IDisposable)) {
                                        $t9.System$IDisposable$Dispose();
                                    }
                                }
                                u.atkRecharge = u.parameters.Attack.Speed;
                            }
                        }
                        if (u.poiRecharge > 0) {
                            u.poiRecharge = (u.poiRecharge - 1) | 0;
                        } else {
                            if (u.AbsContains("Regeneration")) {
                                this.Heal(u, DarkKingdomCore.MyGame.rnd.Next$2(20, 41));
                            }
                            if (u.AbsContains("Healing_aura")) {
                                $t12 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                                try {
                                    while ($t12.moveNext()) {
                                        var uu1 = $t12.Current;
                                        if (!Bridge.referenceEquals(u, uu1) && uu1.owner === u.owner && Math.abs(u.x - uu1.x) <= Bridge.Int.mul(2, this.unitSize) && !uu1.AbsContains("Undead")) {
                                            this.Heal(uu1, DarkKingdomCore.MyGame.rnd.Next$2(10, 21));
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t12, System.IDisposable)) {
                                        $t12.System$IDisposable$Dispose();
                                    }
                                }
                            }
                            if (u.AbsContains("Heal_first")) {
                                var tmpu = this.FindFirstUnflyUnit(u.owner);
                                if (tmpu != null) {
                                    this.Heal(tmpu, DarkKingdomCore.MyGame.rnd.Next$2(5, 11));
                                }
                            }
                            if (u.AbsContains("Mass_healing")) {
                                $t13 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                                try {
                                    while ($t13.moveNext()) {
                                        var uu2 = $t13.Current;
                                        if (!Bridge.referenceEquals(u, uu2) && uu2.owner === u.owner && !uu2.AbsContains("Undead")) {
                                            this.Heal(uu2, DarkKingdomCore.MyGame.rnd.Next$2(10, 21));
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t13, System.IDisposable)) {
                                        $t13.System$IDisposable$Dispose();
                                    }
                                }
                            }
                            if (u.AbsContains("Mass_repair")) {
                                $t14 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                                try {
                                    while ($t14.moveNext()) {
                                        var uu3 = $t14.Current;
                                        if (!Bridge.referenceEquals(u, uu3) && uu3.owner === u.owner && uu3.AbsContains("Machinery")) {
                                            this.Heal(uu3, DarkKingdomCore.MyGame.rnd.Next$2(20, 41), true);
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t14, System.IDisposable)) {
                                        $t14.System$IDisposable$Dispose();
                                    }
                                }
                            }
                            if (u.AbsContains("Plague")) {
                                $t15 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                                try {
                                    while ($t15.moveNext()) {
                                        var uu4 = $t15.Current;
                                        if (!uu4.parameters.isBuilding && Math.abs(u.x - uu4.x) <= Bridge.Int.mul(2, this.unitSize)) {
                                            if (uu4.AbsContains("Undead")) {
                                                this.Heal(uu4, DarkKingdomCore.MyGame.rnd.Next$2(10, 21));
                                            } else {
                                                if (!uu4.AbsContains("Machinery")) {
                                                    this.Harm(uu4, DarkKingdomCore.MyGame.rnd.Next$2(10, 21), true, DarkKingdomCore.EffectType.Bad);
                                                }
                                            }
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t15, System.IDisposable)) {
                                        $t15.System$IDisposable$Dispose();
                                    }
                                }
                            }
                            if (u.AbsContains("Extinction")) {
                                this.Harm(u, DarkKingdomCore.MyGame.rnd.Next$2(20, 41), true, DarkKingdomCore.EffectType.Normal);
                            }
                            if (u.AbsContains("Poison")) {
                                if (u.AbsContains("Poison resistance")) {
                                    this.Harm(u, ((DarkKingdomCore.MyGame.rnd.Next$2(20, 41) + DarkKingdomCore.MyGame.plrs[((1 - u.owner) | 0)].poisonBonus) | 0), true, DarkKingdomCore.EffectType.Poison);
                                } else {
                                    this.Harm(u, ((DarkKingdomCore.MyGame.rnd.Next$2(40, 81) + DarkKingdomCore.MyGame.plrs[((1 - u.owner) | 0)].poisonBonus) | 0), true, DarkKingdomCore.EffectType.Poison);
                                }
                                if (u.hp <= 0) {
                                    u.deathFromPoison = true;
                                }
                                $t16 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                                try {
                                    while ($t16.moveNext()) {
                                        var u21 = $t16.Current;
                                        if (!Bridge.referenceEquals(u21, u) && Math.abs(u21.x - u.x) <= Bridge.Int.mul(2, this.unitSize) && u21.AbsContains("Pain_absorber")) {
                                            this.Heal(u21, DarkKingdomCore.MyGame.rnd.Next$2(20, 41));
                                        }
                                        if (u21.AbsContains("Epidemy")) {
                                            if (DarkKingdomCore.MyGame.rnd.Next$1(100) < u21.abils.getItem("Epidemy").value) {
                                                $t17 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                                                try {
                                                    while ($t17.moveNext()) {
                                                        var u3 = $t17.Current;
                                                        if (Math.abs(u.x - u3.x) <= Bridge.Int.mul(2, this.unitSize)) {
                                                            this.Poison(u3);
                                                        }
                                                    }
                                                } finally {
                                                    if (Bridge.is($t17, System.IDisposable)) {
                                                        $t17.System$IDisposable$Dispose();
                                                    }
                                                }
                                            }
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t16, System.IDisposable)) {
                                        $t16.System$IDisposable$Dispose();
                                    }
                                }
                            }
                            u.poiRecharge = 120;
                        }

                        if (u.hp > 0) {
                            if (u.purified) {
                                if (!u.AbsContains$1(["Building", "Bodyless", "Eternal"])) {
                                    var showinfo = false;
                                    $t18 = Bridge.getEnumerator(u.abils.Values);
                                    try {
                                        while ($t18.moveNext()) {
                                            var aa1 = $t18.Current;
                                            if (!aa1.used) {
                                                aa1.used = true;
                                                showinfo = true;
                                            }
                                        }
                                    } finally {
                                        if (Bridge.is($t18, System.IDisposable)) {
                                            $t18.System$IDisposable$Dispose();
                                        }
                                    }
                                    if (showinfo) {
                                        this.ShowInfoPar("\u0417\u0430\u0431\u0432\u0435\u043d\u0438\u0435", DarkKingdomCore.MyGame.badAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                                    }
                                }
                                u.purified = false;
                            }
                            if (u.landing) {
                                if (!u.AbsContains("Durability")) {
                                    u.parameters.moveType = DarkKingdomCore.UnitMoveType.GroundMT;
                                }
                                u.landing = false;
                            }
                            if (u.takedOff) {
                                if (!u.AbsContains("Durability")) {
                                    u.parameters.moveType = DarkKingdomCore.UnitMoveType.FlyingMT;
                                }
                                u.takedOff = false;
                            }
                        } else {
                            this.Kill(u);
                        }

                        if (u.owner === 0 && u.x > ((DarkKingdomCore.MyGame.gameWidth + this.us2) | 0)) {
                            this.Kill(u);
                            if (this.gType === DarkKingdomCore.GameType.FirstHeroGT) {
                                DarkKingdomCore.MyGame.gState = DarkKingdomCore.GameState.Win;
                            }
                        }

                        if (u.owner === 1 && u.x < ((-this.us2) | 0)) {
                            this.Kill(u);
                            if (this.gType === DarkKingdomCore.GameType.FirstHeroGT) {
                                DarkKingdomCore.MyGame.gState = DarkKingdomCore.GameState.Lose;
                            }
                        }

                        if (!stp) {
                            if (u.AbsContains("Speed_bonus")) {
                                u.x += u.parameters._speed * u.moveside * 2;
                            } else {
                                u.x += u.parameters._speed * u.moveside;
                            }
                        }

                        if ((((-u.parameters.rect.Top) | 0) > u.parameters.rect.Height && !(u.parameters.moveType === DarkKingdomCore.UnitMoveType.FlyingMT)) || (((-u.parameters.rect.Top) | 0) > ((this.flyHeight + u.parameters.rect.Height) | 0) && u.parameters.moveType === DarkKingdomCore.UnitMoveType.FlyingMT)) {
                            ($t19 = u.parameters.rect.$clone()).Y = ($t19.Y + 3) | 0;
                        }
                        if (((-u.parameters.rect.Top) | 0) < ((this.flyHeight + u.parameters.rect.Height) | 0) && u.parameters.moveType === DarkKingdomCore.UnitMoveType.FlyingMT) {
                            ($t20 = u.parameters.rect.$clone()).Y = ($t20.Y - 3) | 0;
                        }

                        if (u.wingsWave < 6.2831853071795862) {
                            u.wingsWave += this.piece;
                        } else {
                            u.wingsWave = 0;
                        }

                        if (u.atkRecharge > 0) {
                            u.atkRecharge = (u.atkRecharge - 1) | 0;
                        }

                        if (!(DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.InGame)) {
                            break;
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                if (DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.InGame) {
                    if (this.bornList.Count > 0) {
                        $t21 = Bridge.getEnumerator(this.bornList);
                        try {
                            while ($t21.moveNext()) {
                                var u1 = $t21.Current;
                                ($t22 = DarkKingdomCore.MyGame.plrs[u1.owner]).uCount = ($t22.uCount + 1) | 0;
                                DarkKingdomCore.MyGame.units.add(u1);
                            }
                        } finally {
                            if (Bridge.is($t21, System.IDisposable)) {
                                $t21.System$IDisposable$Dispose();
                            }
                        }
                        this.bornList.clear();
                    }
                    if (this.deathlist.Count > 0) {
                        var u_int = 0;
                        while (u_int < this.deathlist.Count) {
                            {
                                var abil = this.deathlist.getItem(u_int);
                                if (Bridge.referenceEquals(abil.parameters.Name, DarkKingdomCore.MyGame.plrs[0].hero) || Bridge.referenceEquals(abil.parameters.Name, DarkKingdomCore.MyGame.plrs[1].hero)) {
                                    abil.hp = 0;
                                    if (Bridge.referenceEquals(this.deathlist.getItem(u_int), this.selU)) {
                                        this.selU = null;
                                    }
                                    if (abil.owner === 0) {
                                        DarkKingdomCore.MyGame.gState = DarkKingdomCore.GameState.Lose;
                                    }
                                    if (abil.owner === 1) {
                                        DarkKingdomCore.MyGame.gState = DarkKingdomCore.GameState.Win;
                                    }
                                } else if (this.OnDead(this.deathlist.getItem(u_int))) {
                                    ($t23 = DarkKingdomCore.MyGame.plrs[abil.owner]).uCount = ($t23.uCount - 1) | 0;
                                    ($t24 = DarkKingdomCore.MyGame.plrs[abil.owner]).statDeaths = ($t24.statDeaths + 1) | 0;
                                    DarkKingdomCore.MyGame.units.remove(this.deathlist.getItem(u_int));
                                    $t25 = Bridge.getEnumerator(this.ammos);
                                    try {
                                        while ($t25.moveNext()) {
                                            var a = $t25.Current;
                                            if (Bridge.referenceEquals(a.target, this.deathlist.getItem(u_int))) {
                                                a.target = null;
                                            }
                                        }
                                    } finally {
                                        if (Bridge.is($t25, System.IDisposable)) {
                                            $t25.System$IDisposable$Dispose();
                                        }
                                    }
                                }
                            }
                            u_int = (u_int + 1) | 0;
                        }
                        this.deathlist.clear();
                    }
                }
            },
            TryAddToQueueUnit: function (plr, name) {
                if (plr.CheckForProduce(name)) {
                    plr.res = DarkKingdomCore.TimeCost.op_Subtraction(plr.res.$clone(), DarkKingdomCore.MyGame.unitPrms.getItem(name).$clone().Cost.$clone());
                    plr.prdQ.add(name);
                    if (DarkKingdomCore.MyGame.unitPrms.getItem(name).$clone().support) {
                        plr.aisupportstreak = (plr.aisupportstreak + 1) | 0;
                        plr.aidefencestreak = 0;
                    } else {
                        plr.aidefencestreak = (plr.aidefencestreak + 1) | 0;
                        plr.aisupportstreak = 0;
                    }
                    if (plr.id === 0) {
                        this.UpdateQueue();
                    }
                    return true;
                }
                return false;
            },
            RemoveFromQueue: function (plr, pos) {
                DarkKingdomCore.MyGame.plrs[plr].prdQ.removeAt(pos);
                if (pos === 0) {
                    DarkKingdomCore.MyGame.plrs[plr].prdPrg = 0;
                }
                if (plr === 0) {
                    this.UpdateQueue();
                }
            },
            CheckStack: function (uname, plr) {
                var $t;
                var addition = false;
                if (DarkKingdomCore.MyGame.unitPrms.getItem(uname).$clone().moveType === DarkKingdomCore.UnitMoveType.FlyingMT) {
                    $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                    try {
                        while ($t.moveNext()) {
                            var u = $t.Current;
                            if (u.owner === plr && u.AbsContains("Dragon_boss")) {
                                addition = true;
                                break;
                            }
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                }
                return DarkKingdomCore.MyGame.unitPrms.getItem(uname).$clone().AbsContains("Stack") || addition;
            },
            CheckKeys: function () {
                var $t;
                $t = Bridge.getEnumerator(this.listeningKeys);
                try {
                    while ($t.moveNext()) {
                        var key = $t.Current;
                        if (Microsoft.Xna.Framework.Input.Keyboard.GetState().IsKeyUp(key) && this.oldKeyboardState.IsKeyDown(key)) {
                            return key;
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                if (Microsoft.Xna.Framework.Input.GamePad.GetState(Microsoft.Xna.Framework.PlayerIndex.One).Buttons.Back === Microsoft.Xna.Framework.Input.ButtonState.Pressed) {
                    return Microsoft.Xna.Framework.Input.Keys.Escape;
                }
                return Microsoft.Xna.Framework.Input.Keys.None;
            },
            Update: function () {
                var $t, $t1, $t2, $t3, $t4, $t5, $t6, $t7, $t8, $t9;
                this.mainAnimator.Do();
                this.frmHelp.Visible = false;
                if (this.frmProduction.Visible) {
                    $t = Bridge.getEnumerator(this.btnsProduction);
                    try {
                        while ($t.moveNext()) {
                            var btn = $t.Current;
                            btn.Children.getItem(2).Visible = false;
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                }

                var m = Microsoft.Xna.Framework.Input.Mouse.GetState();
                if (m.LeftButton === Microsoft.Xna.Framework.Input.ButtonState.Released && this.oldMouseState.LeftButton === Microsoft.Xna.Framework.Input.ButtonState.Pressed) {
                    this.MouseClicked(new Microsoft.Xna.Framework.Vector2.$ctor2(m.Position.X, m.Position.Y));
                }
                this.oldMouseState = m.$clone();

                if (Microsoft.Xna.Framework.Input.Touch.TouchPanel.IsGestureAvailable) {
                    var gs = Microsoft.Xna.Framework.Input.Touch.TouchPanel.ReadGesture();
                    if (gs.GestureType === Microsoft.Xna.Framework.Input.Touch.GestureType.Tap) {
                        this.MouseClicked(new Microsoft.Xna.Framework.Vector2.$ctor2(gs.Position.X, gs.Position.Y), true);
                    }
                }


                this.MainContainer.HighlightButton(m.X, m.Y, m.LeftButton === Microsoft.Xna.Framework.Input.ButtonState.Pressed);

                var touches = new (System.Collections.Generic.List$1(Microsoft.Xna.Framework.Input.Touch.TouchLocation)).$ctor1(Microsoft.Xna.Framework.Input.Touch.TouchPanel.GetState());

                // If touches IsNot Nothing Then
                if (touches.Count > 0) {
                    $t1 = Bridge.getEnumerator(touches);
                    try {
                        while ($t1.moveNext()) {
                            var tt = $t1.Current.$clone();
                            if ((tt.State === Microsoft.Xna.Framework.Input.Touch.TouchLocationState.Pressed || tt.State === Microsoft.Xna.Framework.Input.Touch.TouchLocationState.Moved)) {
                                this.MainContainer.TapAndHoldButton(Bridge.Int.clip32(tt.Position.X), Bridge.Int.clip32(tt.Position.Y));
                                break;
                            }
                        }
                    } finally {
                        if (Bridge.is($t1, System.IDisposable)) {
                            $t1.System$IDisposable$Dispose();
                        }
                    }
                }
                // End If

                if (DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.InGame) {
                    $t2 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                    try {
                        while ($t2.moveNext()) {
                            var u = $t2.Current;
                            if (u.x + u.parameters.rect.Right > m.X && m.X > u.x + u.parameters.rect.Left && ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Bottom) | 0) > m.Y && m.Y > ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0)) {
                                if (u.owner === 0 || !u.AbsContains("Invisible")) {
                                    this.ShowUnitInfo(u.parameters.$clone(), u.owner, false, null, u);
                                    break;
                                }
                            }
                        }
                    } finally {
                        if (Bridge.is($t2, System.IDisposable)) {
                            $t2.System$IDisposable$Dispose();
                        }
                    }
                    if (this.selU != null) {
                        this.ShowUnitInfo(this.selU.parameters.$clone(), this.selU.owner, false, null, this.selU);
                    }
                }


                var key = this.CheckKeys();
                if (key !== Microsoft.Xna.Framework.Input.Keys.None) {
                    this.MainContainer.ClickButton(key);
                }

                this.oldKeyboardState = Microsoft.Xna.Framework.Input.Keyboard.GetState();

                if (DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.InGame) {
                    if (this.curM < DarkKingdomCore.MyGame.plrs[0].res.Money) {
                        if (((DarkKingdomCore.MyGame.plrs[0].res.Money - this.curM) | 0) <= 50) {
                            this.curM = (this.curM + 5) | 0;
                        } else {
                            this.curM = (this.curM + 20) | 0;
                        }
                    } else if (this.curM > DarkKingdomCore.MyGame.plrs[0].res.Money) {
                        if (((this.curM - DarkKingdomCore.MyGame.plrs[0].res.Money) | 0) <= 50) {
                            this.curM = (this.curM - 5) | 0;
                        } else {
                            this.curM = (this.curM - 20) | 0;
                        }
                    }
                    if (this.curD < DarkKingdomCore.MyGame.plrs[0].res.Death) {
                        this.curD = (this.curD + 1) | 0;
                    } else {
                        if (this.curD > DarkKingdomCore.MyGame.plrs[0].res.Death) {
                            this.curD = (this.curD - 1) | 0;
                        }
                    }

                    this.UpdateResources();
                }

                this.MainContainer.Recalc();

                if (this.Pause) {
                    return;
                }

                var i;
                var t;

                if (this.snS > 0) {
                    DarkKingdomCore.MyGame.goodAbilClr = Microsoft.Xna.Framework.Color.DarkBlue.$clone();
                    DarkKingdomCore.MyGame.poiAbilClr = Microsoft.Xna.Framework.Color.DarkGreen.$clone();
                } else {
                    DarkKingdomCore.MyGame.goodAbilClr = Microsoft.Xna.Framework.Color.LightBlue.$clone();
                    DarkKingdomCore.MyGame.poiAbilClr = Microsoft.Xna.Framework.Color.LightGreen.$clone();
                }
                if (DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.InGame) {
                    $t3 = Bridge.getEnumerator(DarkKingdomCore.MyGame.plrs);
                    try {
                        while ($t3.moveNext()) {
                            var p = $t3.Current;
                            p.prdSpd = 1;
                            p.magicIncBonus = 0;
                            p.moneyIncBonus = 0;
                            p.poisonBonus = 0;
                            p.banned.clear();
                        }
                    } finally {
                        if (Bridge.is($t3, System.IDisposable)) {
                            $t3.System$IDisposable$Dispose();
                        }
                    }
                    $t4 = Bridge.getEnumerator(DarkKingdomCore.MyGame.plrs);
                    try {
                        while ($t4.moveNext()) {
                            var p1 = $t4.Current;
                            if (p1.rushBonus > 0) {
                                p1.prdSpd *= 2;
                            }
                        }
                    } finally {
                        if (Bridge.is($t4, System.IDisposable)) {
                            $t4.System$IDisposable$Dispose();
                        }
                    }
                    this.machinenum = 0;
                    $t5 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                    try {
                        while ($t5.moveNext()) {
                            var u1 = $t5.Current;
                            if (u1.AbsContains("Machinery")) {
                                this.machinenum = (this.machinenum + 1) | 0;
                            }
                        }
                    } finally {
                        if (Bridge.is($t5, System.IDisposable)) {
                            $t5.System$IDisposable$Dispose();
                        }
                    }
                    this.DoUnits();
                    for (i = 0; i < DarkKingdomCore.MyGame.plrs[0].spllsList.Count; i = (i + 1) | 0) {
                        if (DarkKingdomCore.MyGame.plrs[0].spellsRchrg.getItem(i) > 0) {
                            DarkKingdomCore.MyGame.plrs[0].spellsRchrg.setItem(i, DarkKingdomCore.MyGame.plrs[0].spellsRchrg.getItem(i) -1);
                            if (DarkKingdomCore.MyGame.plrs[0].spellsRchrg.getItem(i) > 0) {
                                Bridge.cast(Bridge.cast(this.cSpells.Children.getItem(i), MonoInterface.Button).Children.getItem(1), MonoInterface.Progress).MaxValue = this.spells.getItem(DarkKingdomCore.MyGame.plrs[0].spllsList.getItem(i)).Cost.Time;
                                Bridge.cast(Bridge.cast(this.cSpells.Children.getItem(i), MonoInterface.Button).Children.getItem(1), MonoInterface.Progress).CurrentValue = DarkKingdomCore.MyGame.plrs[0].spellsRchrg.getItem(i);
                            }
                        }
                    }
                    $t6 = Bridge.getEnumerator(DarkKingdomCore.MyGame.plrs);
                    try {
                        while ($t6.moveNext()) {
                            var plr = $t6.Current;
                            {
                                var abil = plr;
                                if (abil.resDelay > 0) {
                                    abil.resDelay = (abil.resDelay - 1) | 0;
                                } else {
                                    var val = (((abil.startInco + Bridge.Int.mul(abil.ipt, (((abil.res.Tier - 1) | 0)))) | 0) + abil.moneyIncBonus) | 0;
                                    abil.Resources = DarkKingdomCore.TimeCost.op_Addition(abil.Resources.$clone(), new DarkKingdomCore.TimeCost.$ctor1(val, abil.magicIncBonus, 0, 0));
                                    if (abil.id === 0) {
                                        this.ShowInfoPar("+" + val, this.moneyClr.$clone(), this.unitSize, ((DarkKingdomCore.MyGame.hor - 60) | 0), true);
                                    }
                                    abil.resDelay = 450;
                                }
                                if (abil.prdQ.Count > 0) {
                                    abil.prdPrg += abil.prdSpd;
                                    if (plr.id === 0) {
                                        this.UpdateQueue();
                                    }

                                    if (abil.prdPrg >= DarkKingdomCore.MyGame.unitPrms.getItem(abil.prdQ.getItem(0)).$clone().Cost.Time) {
                                        if (abil.rushBonus > 0) {
                                            abil.rushBonus = (abil.rushBonus - 1) | 0;
                                        }
                                        this.AddToReadyUnits(plr, abil.prdQ.getItem(0));
                                        this.RemoveFromQueue(abil.id, 0);
                                        if (abil.AI && abil.readyUnits.Count >= 3) {
                                            $t7 = Bridge.getEnumerator(abil.readyUnits);
                                            try {
                                                while ($t7.moveNext()) {
                                                    var u2 = $t7.Current;
                                                    this.ProduceUnit(abil.id, u2);
                                                }
                                            } finally {
                                                if (Bridge.is($t7, System.IDisposable)) {
                                                    $t7.System$IDisposable$Dispose();
                                                }
                                            }
                                            abil.readyUnits.clear();
                                        }
                                    }
                                }
                                if (abil.AI) {
                                    if (abil.curAIVal > 0) {
                                        abil.curAIVal = (abil.curAIVal - 1) | 0;
                                    } else {
                                        abil.AITick(this);
                                        abil.curAIVal = abil.maxAIVal;
                                    }
                                }
                            }
                        }
                    } finally {
                        if (Bridge.is($t6, System.IDisposable)) {
                            $t6.System$IDisposable$Dispose();
                        }
                    }
                    i = 0;
                    while (i < this.ammos.Count) {
                        {
                            var abil1 = this.ammos.getItem(i);
                            abil1.x += abil1.vx;
                            abil1.y += abil1.vy;
                            abil1.lifetime -= 1;
                            if (abil1.target != null) {
                                t = (abil1.target.x - abil1.x) / abil1.vx;
                                if (t !== 0) {
                                    abil1.vy = (((((DarkKingdomCore.MyGame.hor + abil1.target.parameters.rect.Top) | 0) + 15) | 0) - abil1.y) / t - abil1.ay * t / 2;
                                } else {
                                    abil1.vy = -1;
                                }
                            } else {
                                abil1.vy += abil1.ay;
                            }
                            $t8 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                            try {
                                while ($t8.moveNext()) {
                                    var u3 = $t8.Current;
                                    if (abil1.plr !== u3.owner) {
                                        if ((u3.x + u3.parameters.rect.Right >= abil1.x && abil1.x >= u3.x + u3.parameters.rect.Left && ((DarkKingdomCore.MyGame.hor + u3.parameters.rect.Bottom) | 0) >= abil1.y && abil1.y >= ((DarkKingdomCore.MyGame.hor + u3.parameters.rect.Top) | 0))) {
                                            if (abil1.agil) {
                                                this.OnAgil(abil1.owner, u3);
                                                if (abil1.explosive) {
                                                    this.Explode(u3, abil1.owner.AbsContains("Mage"));
                                                }
                                            } else if (abil1.owner != null) {
                                                this.OnSuccessfulAttack(abil1.dmg, abil1.owner, u3, abil1.ignoreArmor);
                                                if (abil1.explosive) {
                                                    this.Explode(u3, abil1.owner.AbsContains("Mage"));
                                                }
                                            } else {
                                                if (abil1.explosive) {
                                                    this.Explode(u3, false);
                                                }
                                                this.Harm(u3, abil1.dmg, abil1.ignoreArmor, DarkKingdomCore.EffectType.Normal);
                                            }
                                            if (abil1.type === DarkKingdomCore.Ammo.AmmoType.Bomb) {
                                                DarkKingdomCore.MyGame.pars.add(new DarkKingdomCore.ImageParticle(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("explode"), 1), abil1.x - 12, abil1.y - 12, 0, 0, 20));
                                            }
                                            this.ammos.removeAt(i);
                                            i = (i - 1) | 0;
                                            break;
                                        }
                                    }
                                }
                            } finally {
                                if (Bridge.is($t8, System.IDisposable)) {
                                    $t8.System$IDisposable$Dispose();
                                }
                            }
                            if (abil1.y >= DarkKingdomCore.MyGame.hor) {
                                if (abil1.type === DarkKingdomCore.Ammo.AmmoType.Bomb) {
                                    DarkKingdomCore.MyGame.pars.add(new DarkKingdomCore.ImageParticle(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("explode"), 1), abil1.x - 12, abil1.y - 12, 0, 0, 20));
                                }
                                this.ammos.removeAt(i);
                                i = (i - 1) | 0;
                            }
                            if (abil1.lifetime <= 0) {
                                this.ammos.removeAt(i);
                                i = (i - 1) | 0;
                            }
                            i = (i + 1) | 0;
                        }
                    }
                }
                i = 0;
                while (i < DarkKingdomCore.MyGame.pars.Count) {
                    {
                        var abil2 = DarkKingdomCore.MyGame.pars.getItem(i);
                        abil2.ltime = (abil2.ltime - 1) | 0;
                        abil2.x += abil2.dx;
                        abil2.y += abil2.dy;
                        abil2.dy += abil2.ay;
                        abil2.a -= abil2.ast;
                        if (abil2.dy > 0 && abil2.y >= ((((DarkKingdomCore.MyGame.hor - this.unitSize) | 0) + 2) | 0)) {
                            abil2.y = (((DarkKingdomCore.MyGame.hor - this.unitSize) | 0) + 3) | 0;
                            abil2.dy = 0;
                        }
                        if (abil2.ltime === 0) {
                            DarkKingdomCore.MyGame.pars.removeAt(i);
                        } else {
                            i = (i + 1) | 0;
                        }
                    }
                }

                $t9 = Bridge.getEnumerator(DarkKingdomCore.MyGame.cloudpars);
                try {
                    while ($t9.moveNext()) {
                        var p2 = Bridge.cast($t9.Current, DarkKingdomCore.Particle);
                        p2.x += p2.dx;
                        if (p2.x >= ((DarkKingdomCore.MyGame.gameWidth + 75) | 0)) {
                            p2.x = -100;
                        }
                    }
                } finally {
                    if (Bridge.is($t9, System.IDisposable)) {
                        $t9.System$IDisposable$Dispose();
                    }
                }


                if (this.updateSpells) {
                    this.SetSpells();
                }
                if (DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.InGame && this.snS > 0 && this.gType === DarkKingdomCore.GameType.DefenceGT) {
                    DarkKingdomCore.MyGame.gState = DarkKingdomCore.GameState.Win;
                }
                if (DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.InGame && this.snS < 0 && this.gType === DarkKingdomCore.GameType.OffenceGT) {
                    DarkKingdomCore.MyGame.gState = DarkKingdomCore.GameState.Lose;
                }
                this.oldsnS = this.snS;
                this.snS = this.snS * this.csD + this.csS * this.snD;
                this.csS = this.csS * this.csD - this.oldsnS * this.snD;
                if (DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.Lose || DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.Win) {
                    this.EndOfBattle();
                }
            },
            EndOfBattle: function () {
                this._pause = true;
                this.frmDialog.Show(this.mainAnimator);
                if (DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).racesPlays.containsKey(DarkKingdomCore.MyGame.plrs[0].race)) {
                    DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).racesPlays.setItem(DarkKingdomCore.MyGame.plrs[0].race, (DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).racesPlays.getItem(DarkKingdomCore.MyGame.plrs[0].race) + 1) | 0);
                    if (DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.Win) {
                        DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).racesWins.setItem(DarkKingdomCore.MyGame.plrs[0].race, (DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).racesWins.getItem(DarkKingdomCore.MyGame.plrs[0].race) + 1) | 0);
                    }
                } else {
                    DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).racesPlays.add(DarkKingdomCore.MyGame.plrs[0].race, 1);
                    if (DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.Win) {
                        DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).racesWins.add(DarkKingdomCore.MyGame.plrs[0].race, 1);
                    } else {
                        if (DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.Lose) {
                            DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).racesWins.add(DarkKingdomCore.MyGame.plrs[0].race, 0);
                        }
                    }
                }
                switch (DarkKingdomCore.MyGame.gState) {
                    case DarkKingdomCore.GameState.Win: 
                        {
                            this.lblTitlefrmDialog.Text = "\u0412\u044b \u043f\u043e\u0431\u0435\u0434\u0438\u043b\u0438!";
                            break;
                        }
                    case DarkKingdomCore.GameState.Lose: 
                        {
                            this.lblTitlefrmDialog.Text = "\u0412\u044b \u043f\u0440\u043e\u0438\u0433\u0440\u0430\u043b\u0438!";
                            break;
                        }
                }
                this.lblLine1FrmDialog.Text = System.String.format("\u0412\u0430\u0448\u0438 \u043f\u043e\u0442\u0435\u0440\u0438: {0}", [DarkKingdomCore.MyGame.plrs[0].statDeaths]);
                this.lblLine2FrmDialog.Text = System.String.format("\u041f\u043e\u0442\u0435\u0440\u0438 \u043f\u0440\u043e\u0442\u0438\u0432\u043d\u0438\u043a\u0430: {0}", [DarkKingdomCore.MyGame.plrs[1].statDeaths]);
            },
            ShowUnitInfo: function (up, own, cstHighlight, pnt, unt) {
                var $t;
                if (pnt === void 0) { pnt = null; }
                if (unt === void 0) { unt = null; }
                this.lblUnitNameHelpUnit.Text = this.localize.GetString(up.Name);
                if (Bridge.referenceEquals(up.Subrace, "")) {
                    this.lblRaceHelpUnit.Text = this.localize.GetString(up.Race);
                } else {
                    this.lblRaceHelpUnit.Text = System.String.format("{0} - {1}", this.localize.GetString(up.Race), this.localize.GetString(up.Subrace));
                }

                this.lblCostMoneyHelpUnit.Text = Bridge.toString(up.Cost.Money);
                if (DarkKingdomCore.MyGame.plrs[0].res.Money < up.Cost.Money && cstHighlight) {
                    this.lblCostMoneyHelpUnit.TextColor = Microsoft.Xna.Framework.Color.Red.$clone();
                } else {
                    this.lblCostMoneyHelpUnit.TextColor = this.moneyClr.$clone();
                }


                if (up.Cost.Death > 0) {
                    this.lblCostDeathHelpUnit.Text = Bridge.toString(up.Cost.Death);
                    if (DarkKingdomCore.MyGame.plrs[0].res.Death < up.Cost.Death && cstHighlight) {
                        this.lblCostDeathHelpUnit.TextColor = Microsoft.Xna.Framework.Color.Red.$clone();
                    } else {
                        this.lblCostDeathHelpUnit.TextColor = this.deathClr.$clone();
                    }
                } else {
                    this.lblCostDeathHelpUnit.Text = "-";
                }

                this.cBattleParameters.Visible = true;
                var atkclr = Microsoft.Xna.Framework.Color.Black.$clone();
                var finalAtk = up.Attack.$clone();
                var finalRng = System.Int64(up.Attack.Range);
                var atkSpd = this.localize.GetString(System.String.format("AttackSpeed{0}", [up.Attack.Speed]));
                if (unt != null) {
                    finalAtk = DarkKingdomCore.Attack.op_Addition(finalAtk.$clone(), unt.atkMod.$clone());
                    finalRng = finalRng.add(System.Int64(unt.atkMod.Range));
                    if (up.Attack.MaxDamage > 0) {
                        if (finalAtk.MinDamage > DarkKingdomCore.MyGame.unitPrms.getItem(up.Name).$clone().Attack.MinDamage || finalAtk.MaxDamage > DarkKingdomCore.MyGame.unitPrms.getItem(up.Name).$clone().Attack.MaxDamage || finalRng.gt(System.Int64(DarkKingdomCore.MyGame.unitPrms.getItem(up.Name).$clone().Attack.Range))) {
                            atkclr = Microsoft.Xna.Framework.Color.DarkBlue.$clone();
                        } else {
                            if (finalAtk.MinDamage < DarkKingdomCore.MyGame.unitPrms.getItem(up.Name).$clone().Attack.MinDamage || finalAtk.MaxDamage < DarkKingdomCore.MyGame.unitPrms.getItem(up.Name).$clone().Attack.MaxDamage || finalRng.lt(System.Int64(DarkKingdomCore.MyGame.unitPrms.getItem(up.Name).$clone().Attack.Range))) {
                                atkclr = Microsoft.Xna.Framework.Color.DarkViolet.$clone();
                            }
                        }
                    }
                }
                this.lblAttackBasicParams.TextColor = atkclr.$clone();
                if (up.Attack.Range > 1) {
                    this.pctAttackBasicParams.spriteRef = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("small_icons"), 0);
                    if (up.Attack.MaxDamage > 0) {
                        if (up.Attack.Range > 100) {
                            this.lblAttackBasicParams.Text = System.String.format("{0}-{1}, \u0434\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u221e, {2}", finalAtk.MinDamage, finalAtk.MaxDamage, atkSpd);
                        } else {
                            this.lblAttackBasicParams.Text = System.String.format("{0}-{1}, \u0434\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u044c {2}, {3}", finalAtk.MinDamage, finalAtk.MaxDamage, finalRng, atkSpd);
                        }
                    } else {
                        this.lblAttackBasicParams.Text = "\u041d\u0435\u0442";
                    }
                } else {
                    this.pctAttackBasicParams.spriteRef = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("small_icons"), 1);
                    if (up.Attack.MaxDamage > 0) {
                        this.lblAttackBasicParams.Text = System.String.format("{0}-{1}, {2}", finalAtk.MinDamage, finalAtk.MaxDamage, atkSpd);
                    } else {
                        if (up.Attack.MaxDamage === 0) {
                            this.lblAttackBasicParams.Text = "\u041d\u0435\u0442";
                        } else {
                            this.lblAttackBasicParams.Text = "\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u0430";
                        }
                    }
                }


                if (unt != null) {
                    this.lblsBasicParams[0].Text = System.String.format("{0}/{1}", unt.hp, up.maxhp);
                    if (up.maxhp > DarkKingdomCore.MyGame.unitPrms.getItem(up.Name).$clone().maxhp) {
                        this.lblsBasicParams[0].TextColor = Microsoft.Xna.Framework.Color.DarkBlue.$clone();
                    } else {
                        if (up.maxhp < DarkKingdomCore.MyGame.unitPrms.getItem(up.Name).$clone().maxhp) {
                            this.lblsBasicParams[0].TextColor = Microsoft.Xna.Framework.Color.DarkViolet.$clone();
                        } else {
                            this.lblsBasicParams[0].TextColor = Microsoft.Xna.Framework.Color.Black.$clone();
                        }
                    }
                } else if (up.maxhp > 0) {
                    this.lblsBasicParams[0].Text = Bridge.toString(up.maxhp);
                    this.lblsBasicParams[0].TextColor = Microsoft.Xna.Framework.Color.Black.$clone();
                } else {
                    this.lblsBasicParams[0].Text = "\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e";
                    this.lblsBasicParams[0].TextColor = Microsoft.Xna.Framework.Color.Black.$clone();
                }


                this.lblsBasicParams[1].Text = this.localize.GetString(up.armNick);
                if (up._armor < DarkKingdomCore.MyGame.unitPrms.getItem(up.Name).$clone()._armor) {
                    this.lblsBasicParams[1].TextColor = Microsoft.Xna.Framework.Color.DarkBlue.$clone();
                } else {
                    if (up._armor > DarkKingdomCore.MyGame.unitPrms.getItem(up.Name).$clone()._armor) {
                        this.lblsBasicParams[1].TextColor = Microsoft.Xna.Framework.Color.DarkBlue.$clone();
                    } else {
                        this.lblsBasicParams[1].TextColor = Microsoft.Xna.Framework.Color.Black.$clone();
                    }
                }

                this.lblsBasicParams[2].Text = System.String.format("{0}, {1}", this.localize.GetString(System.String.format("{0}S", [up.spdNick])), this.localize.GetString(System.Enum.toString(DarkKingdomCore.UnitMoveType, up.moveType)));

                if (up._speed > DarkKingdomCore.MyGame.unitPrms.getItem(up.Name).$clone()._speed) {
                    this.lblsBasicParams[2].TextColor = Microsoft.Xna.Framework.Color.DarkBlue.$clone();
                } else {
                    if (up._speed < DarkKingdomCore.MyGame.unitPrms.getItem(up.Name).$clone()._speed) {
                        this.lblsBasicParams[2].TextColor = Microsoft.Xna.Framework.Color.DarkViolet.$clone();
                    } else {
                        this.lblsBasicParams[2].TextColor = Microsoft.Xna.Framework.Color.Black.$clone();
                    }
                }

                var i = 0;
                var lastH = this.cBattleParameters.Bottom;
                var abils = unt != null ? unt.abils.Values : up.abils.Values;

                $t = Bridge.getEnumerator(abils);
                try {
                    while ($t.moveNext()) {
                        var a = $t.Current;
                        if (!a.hidden) {
                            var clr = new Microsoft.Xna.Framework.Color();
                            switch (a.typ) {
                                case DarkKingdomCore.EffectType.Normal: 
                                    clr = Microsoft.Xna.Framework.Color.Black.$clone();
                                    break;
                                case DarkKingdomCore.EffectType.Good: 
                                    clr = Microsoft.Xna.Framework.Color.DarkBlue.$clone();
                                    break;
                                case DarkKingdomCore.EffectType.Bad: 
                                    clr = Microsoft.Xna.Framework.Color.DarkViolet.$clone();
                                    break;
                                case DarkKingdomCore.EffectType.Poison: 
                                    clr = Microsoft.Xna.Framework.Color.DarkGreen.$clone();
                                    break;
                                default: 
                                    clr = Microsoft.Xna.Framework.Color.Black.$clone();
                                    break;
                            }
                            if (Bridge.referenceEquals(a.condition, "")) {
                                this.lblsAbils[i].Text = System.String.format("\u2022 {0}", [System.String.format(this.localize.GetString(a.name), a.value, a.value)]);
                                this.lblsAbils[i].TextColor = clr.$clone();
                                this.lblsAbils[i].Visible = true;
                            } else {
                                if (a.longTime) {
                                    if (!a.used && !a.condCompleted) {
                                        if (unt != null || !(Bridge.referenceEquals(a.condition, "Tier") && DarkKingdomCore.MyGame.plrs[own].res.Tier >= a.condnum) && !(Bridge.referenceEquals(a.condition, "Machine_army") && this.machinenum >= a.condnum)) {
                                            clr = this.condClr.$clone();
                                        }
                                    }
                                }
                                var unit_parameters = this.GetUnitParametersFromID(a.value);
                                var unit_name = System.Nullable.hasValue(unit_parameters) ? this.localize.GetString(System.Nullable.getValue(unit_parameters).Name) : "";
                                this.lblsAbils[i].Text = System.String.format("\u2022 {0} {1}", System.String.format(this.localize.GetString(a.condition), a.condnum, this.GetEnding(a.condnum)), System.String.format(this.localize.GetString(a.name), a.value, unit_name));
                                this.lblsAbils[i].TextColor = clr.$clone();
                                this.lblsAbils[i].Visible = true;
                            }
                            this.lblsAbils[i].Y = (lastH + 5) | 0;
                            lastH = this.lblsAbils[i].Bottom;
                            if (a.condCompleted) {
                                if (Bridge.referenceEquals(a.name, "Mage")) {
                                    this.pctAttackBasicParams.spriteRef = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("small_icons"), 2);
                                } else {
                                    if (Bridge.referenceEquals(a.name, "Shooter")) {
                                        this.pctAttackBasicParams.spriteRef = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("small_icons"), 17);
                                    } else {
                                        if (Bridge.referenceEquals(a.name, "Arbalester")) {
                                            this.pctAttackBasicParams.spriteRef = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("small_icons"), 18);
                                        }
                                    }
                                }
                            }
                            i = (i + 1) | 0;
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }

                for (var j = i; j <= 5; j = (j + 1) | 0) {
                    this.lblsAbils[j].Visible = false;
                }

                this.frmHelp.H = (lastH + 5) | 0;

                if (!System.Nullable.hasValue(pnt)) {
                    pnt = new Microsoft.Xna.Framework.Point.$ctor2(((((DarkKingdomCore.MyGame.gameWidth - this.frmHelp.W) | 0) - 30) | 0), 90);
                }

                this.frmHelp.X = (System.Nullable.getValue(pnt).X + 10) | 0;
                this.frmHelp.Y = (System.Nullable.getValue(pnt).Y + 10) | 0;
                if (this.frmHelp.Right > ((DarkKingdomCore.MyGame.gameWidth - 20) | 0)) {
                    this.frmHelp.Right = (DarkKingdomCore.MyGame.gameWidth - 20) | 0;
                }
                if (this.frmHelp.Bottom > ((DarkKingdomCore.MyGame.gameHeight - 20) | 0)) {
                    this.frmHelp.Bottom = (DarkKingdomCore.MyGame.gameHeight - 20) | 0;
                }

                this.frmHelp.Visible = true;
            },
            GetEnding: function (n) {
                if (n > 4) {
                    return "";
                } else {
                    if (n === 1) {
                        return "\u043e";
                    } else {
                        return "\u0430";
                    }
                }
            },
            ShowInfo: function (pnt, lines) {
                if (lines === void 0) { lines = []; }
                this.ShowMoreInfo(new DarkKingdomCore.TimeCost.$ctor1(0, 0, 0, 0), false, pnt.$clone(), lines);
            },
            ShowMoreInfo: function (cost, cstHighlight, pnt, lines) {
                if (lines === void 0) { lines = []; }
                this.lblUnitNameHelpUnit.Text = lines[0];
                this.lblRaceHelpUnit.Text = lines[1];

                this.lblCostMoneyHelpUnit.Text = Bridge.toString(cost.Money);
                if (DarkKingdomCore.MyGame.plrs[0].res.Money < cost.Money && cstHighlight) {
                    this.lblCostMoneyHelpUnit.TextColor = Microsoft.Xna.Framework.Color.Red.$clone();
                } else {
                    this.lblCostMoneyHelpUnit.TextColor = this.moneyClr.$clone();
                }


                if (cost.Death > 0) {
                    this.lblCostDeathHelpUnit.Text = Bridge.toString(cost.Death);
                    if (DarkKingdomCore.MyGame.plrs[0].res.Death < cost.Death && cstHighlight) {
                        this.lblCostDeathHelpUnit.TextColor = Microsoft.Xna.Framework.Color.Red.$clone();
                    } else {
                        this.lblCostDeathHelpUnit.TextColor = this.deathClr.$clone();
                    }
                } else {
                    this.lblCostDeathHelpUnit.Text = "-";
                }

                this.cBattleParameters.Visible = false;

                var i = 0;
                var lastH = this.lblCostMoneyHelpUnit.Bottom;
                for (i = 2; i < lines.length; i = (i + 1) | 0) {
                    this.lblsAbils[((i - 2) | 0)].Text = lines[i];
                    this.lblsAbils[((i - 2) | 0)].TextColor = Microsoft.Xna.Framework.Color.Black.$clone();
                    this.lblsAbils[((i - 2) | 0)].Visible = true;
                    this.lblsAbils[((i - 2) | 0)].Y = (lastH + 5) | 0;
                    lastH = this.lblsAbils[((i - 2) | 0)].Bottom;
                }

                for (var j = (i - 2) | 0; j <= 5; j = (j + 1) | 0) {
                    this.lblsAbils[j].Visible = false;
                }

                this.frmHelp.H = (lastH + 5) | 0;
                if (!System.Nullable.hasValue(pnt)) {
                    pnt = new Microsoft.Xna.Framework.Point.$ctor2(((((DarkKingdomCore.MyGame.gameWidth - this.frmHelp.W) | 0) - 40) | 0), 80);
                }

                this.frmHelp.X = (System.Nullable.getValue(pnt).X + 20) | 0;
                this.frmHelp.Y = (System.Nullable.getValue(pnt).Y + 20) | 0;
                if (this.frmHelp.Right > ((DarkKingdomCore.MyGame.gameWidth - 20) | 0)) {
                    this.frmHelp.Right = (DarkKingdomCore.MyGame.gameWidth - 20) | 0;
                }
                if (this.frmHelp.Bottom > ((DarkKingdomCore.MyGame.gameHeight - 20) | 0)) {
                    this.frmHelp.Bottom = (DarkKingdomCore.MyGame.gameHeight - 20) | 0;
                }

                this.frmHelp.Visible = true;
            },
            CreateRaceList: function () {
                var $t;
                this.races1 = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.races2 = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.standartRaces = new (System.Collections.Generic.List$1(System.String)).ctor();
                $t = Bridge.getEnumerator(DarkKingdomCore.RaceManager.Instance.All.Values);
                try {
                    while ($t.moveNext()) {
                        var r = $t.Current;
                        if (!r.special) {
                            this.races1.add(r.name);
                            if (!r.noAI) {
                                this.races2.add(r.name);
                            }
                            if (!r.custom && !(Bridge.referenceEquals(r.name, "Random"))) {
                                this.standartRaces.add(r.name);
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            },
            AddCustomRace: function (name) {
                var nick, desc;
                var symb;
                var noAI;
                nick = this.localize.GetString(name);
                symb = (10 + System.Int32.parse(String.fromCharCode(name.charCodeAt(((name.length - 1) | 0))))) | 0;
                desc = "\u0421\u0434\u0435\u043b\u0430\u043d\u043e \u0441\u0432\u043e\u0438\u043c\u0438 \u0440\u0443\u043a\u0430\u043c\u0438";
                noAI = false;
                DarkKingdomCore.RaceManager.Instance.All.add(name, new DarkKingdomCore.Race(name, desc, nick, symb, noAI, true, false, false));
                this.OrderRaces();
            },
            OrderRaces: function () {
                var $t;
                var newraces = Bridge.fn.bind(this, function (_o1) {
                        _o1.add("Random", new DarkKingdomCore.Race("Random", "\u0421\u043b\u0443\u0447\u0430\u0439\u043d\u044b\u0439 \u0432\u044b\u0431\u043e\u0440 \u0444\u0440\u0430\u043a\u0446\u0438\u0438", this.localize.GetString("Random"), 4, false, false, false, false));
                        return _o1;
                    })(new (System.Collections.Generic.Dictionary$2(System.String,DarkKingdomCore.Race)).ctor());

                if (DarkKingdomCore.ProfileManager.Instance.All.Count > 0) {
                    for (var i = 0; i < DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).maxCustomRaces; i = (i + 1) | 0) {
                        if (DarkKingdomCore.RaceManager.Instance.All.containsKey(System.String.format("Custom{0}", [i]))) {
                            newraces.add(System.String.format("Custom{0}", [i]), DarkKingdomCore.RaceManager.Instance.All.getItem(System.String.format("Custom{0}", [i])));
                        }
                    }
                }


                $t = Bridge.getEnumerator(DarkKingdomCore.RaceManager.Instance.All.Values);
                try {
                    while ($t.moveNext()) {
                        var r = $t.Current;
                        if (!r.custom && !(Bridge.referenceEquals(r.name, "Random"))) {
                            newraces.add(r.name, r);
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }

                DarkKingdomCore.RaceManager.Instance.All = newraces;
            },
            SaveCurrentEdRace: function () {
                //if (!RaceManager.Instance.All.ContainsKey(currentEdRace))
                //    AddCustomRace(currentEdRace);
                //{
                //var abil = RaceManager.Instance.All[currentEdRace];
                //if (!string.IsNullOrEmpty(currentEdRaceNick))
                //    abil.nick = currentEdRaceNick;
                //abil.units.Clear();
                //foreach (string u in edunits)
                //    abil.units.Add(u);
                //UnlockAchiviement("Openeditor");
                //}
            },
            ClearVarsAndCalcEarned: function () {
                this.selU = null;
                DarkKingdomCore.MyGame.pars.clear();
                this.ammos.clear();
                DarkKingdomCore.MyGame.units.clear();
                this.deathlist.clear();
                this.bornList.clear();

                if (DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.InGame || DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.Win || DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.Lose) {
                    this.ResetWorld(this.sunAng, this.dAng);
                }
                if (DarkKingdomCore.RaceManager.Instance.All.getItem(DarkKingdomCore.MyGame.plrs[0].race).disableRewards) {
                    this.unlockedAchivs.clear();
                    this.unlockedUnits.clear();
                } else {
                    if (DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.Win) {
                        this.UnlockAchiviement("Startpath");
                        if (DarkKingdomCore.MyGame.plrs[0].statDeaths === 0) {
                            this.UnlockAchiviement("Gentleleader");
                        }
                        if (Bridge.referenceEquals(this.conds.getItem(DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).difficult).$clone().name, "Hard")) {
                            if (!DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).achivs.containsKey("Alittleharder")) {
                                DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).achivs.add("Alittleharder", "2");
                            } else {
                                if (!System.String.isNullOrEmpty(DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).achivs.getItem("Alittleharder"))) {
                                    DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).achivs.setItem("Alittleharder", Bridge.toString((((System.Int32.parse(DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).achivs.getItem("Alittleharder")) - 1) | 0))));
                                    if (Bridge.referenceEquals(DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).achivs.getItem("Alittleharder"), "0")) {
                                        this.unlockedAchivs.add("Alittleharder");
                                    }
                                }
                            }
                        }
                        if (DarkKingdomCore.MyGame.plrs[0].unitsList.Count === 0) {
                            this.UnlockAchiviement("Truemage");
                        }
                    }
                    if (DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).minvictims === -1 || DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).minvictims > DarkKingdomCore.MyGame.plrs[0].statDeaths) {
                        DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).minvictims = DarkKingdomCore.MyGame.plrs[0].statDeaths;
                    }

                    if (DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).maxkills === -1 || DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).maxkills < DarkKingdomCore.MyGame.plrs[1].statDeaths) {
                        DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).maxkills = DarkKingdomCore.MyGame.plrs[1].statDeaths;
                    }
                }


                // End If
                DarkKingdomCore.MyGame.gState = DarkKingdomCore.GameState.MainMenu;
                this.Pause = false;
            },
            UnlockAchiviement: function (achiv) {
                if (!DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).achivs.containsKey(achiv) && !this.unlockedAchivs.contains(achiv)) {
                    this.unlockedAchivs.add(achiv);
                }
            },
            CheckPurchaseCost: function (prch) {
                var $t, $t1, $t2, $t3;
                if (DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).crystals >= this.purchases.getItem(prch).crystals) {
                    switch (this.purchases.getItem(prch).name) {
                        case "Buster1T": 
                            {
                                var avunits = new (System.Collections.Generic.List$1(System.String)).ctor();
                                var tier = 1;
                                $t = Bridge.getEnumerator(this.AllUntsList);
                                try {
                                    while ($t.moveNext()) {
                                        var u = $t.Current;
                                        if (DarkKingdomCore.MyGame.unitPrms.getItem(u).$clone().Cost.Tier === tier && !DarkKingdomCore.MyGame.unitPrms.getItem(u).$clone().isHeroic && !DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).units.contains(u)) {
                                            avunits.add(u);
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t, System.IDisposable)) {
                                        $t.System$IDisposable$Dispose();
                                    }
                                }
                                if (avunits.Count > 0) {
                                    return true;
                                }
                                break;
                            }
                        case "Buster2T": 
                            {
                                var avunits1 = new (System.Collections.Generic.List$1(System.String)).ctor();
                                var tier1 = 2;
                                $t1 = Bridge.getEnumerator(this.AllUntsList);
                                try {
                                    while ($t1.moveNext()) {
                                        var u1 = $t1.Current;
                                        if (DarkKingdomCore.MyGame.unitPrms.getItem(u1).$clone().Cost.Tier === tier1 && !DarkKingdomCore.MyGame.unitPrms.getItem(u1).$clone().isHeroic && !DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).units.contains(u1)) {
                                            avunits1.add(u1);
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t1, System.IDisposable)) {
                                        $t1.System$IDisposable$Dispose();
                                    }
                                }
                                if (avunits1.Count > 0) {
                                    return true;
                                }
                                break;
                            }
                        case "Buster3T": 
                            {
                                var avunits2 = new (System.Collections.Generic.List$1(System.String)).ctor();
                                var tier2 = 3;
                                $t2 = Bridge.getEnumerator(this.AllUntsList);
                                try {
                                    while ($t2.moveNext()) {
                                        var u2 = $t2.Current;
                                        if (DarkKingdomCore.MyGame.unitPrms.getItem(u2).$clone().Cost.Tier === tier2 && !DarkKingdomCore.MyGame.unitPrms.getItem(u2).$clone().isHeroic && !DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).units.contains(u2)) {
                                            avunits2.add(u2);
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t2, System.IDisposable)) {
                                        $t2.System$IDisposable$Dispose();
                                    }
                                }
                                if (avunits2.Count > 0) {
                                    return true;
                                }
                                break;
                            }
                        case "Herobuster": 
                            {
                                var avunits3 = new (System.Collections.Generic.List$1(System.String)).ctor();
                                $t3 = Bridge.getEnumerator(this.AllUntsList);
                                try {
                                    while ($t3.moveNext()) {
                                        var u3 = $t3.Current;
                                        if (DarkKingdomCore.MyGame.unitPrms.getItem(u3).$clone().isHeroic && !DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).units.contains(u3)) {
                                            avunits3.add(u3);
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t3, System.IDisposable)) {
                                        $t3.System$IDisposable$Dispose();
                                    }
                                }
                                if (avunits3.Count > 0) {
                                    return true;
                                }
                                break;
                            }
                        case "AdditionSlot": 
                            {
                                if (DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).maxCustomRaces < 3) {
                                    return true;
                                }
                                break;
                            }
                    }
                }
                return false;
            },
            Buy: function (prch) {
                var $t, $t1, $t2, $t3, $t4, $t5;
                if (DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).crystals >= this.purchases.getItem(prch).crystals) {
                    var cancel = false;
                    switch (this.purchases.getItem(prch).name) {
                        case "Buster1T": 
                            {
                                var avunits = new (System.Collections.Generic.List$1(System.String)).ctor();
                                var bustsize = 4;
                                var tier = 1;
                                $t = Bridge.getEnumerator(this.AllUntsList);
                                try {
                                    while ($t.moveNext()) {
                                        var u = $t.Current;
                                        if (DarkKingdomCore.MyGame.unitPrms.getItem(u).$clone().Cost.Tier === tier && !DarkKingdomCore.MyGame.unitPrms.getItem(u).$clone().isHeroic && !DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).units.contains(u) && !this.unlockedUnits.contains(u)) {
                                            avunits.add(u);
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t, System.IDisposable)) {
                                        $t.System$IDisposable$Dispose();
                                    }
                                }
                                if (avunits.Count > 0) {
                                    while (avunits.Count > 0 && bustsize > 0) {
                                        var u1 = avunits.getItem(DarkKingdomCore.MyGame.rnd.Next$1(avunits.Count));
                                        this.unlockedUnits.add(u1);
                                        avunits.remove(u1);
                                        bustsize = (bustsize - 1) | 0;
                                    }
                                } else {
                                    cancel = true;
                                }
                                break;
                            }
                        case "Buster2T": 
                            {
                                var avunits1 = new (System.Collections.Generic.List$1(System.String)).ctor();
                                var bustsize1 = 2;
                                var tier1 = 2;
                                $t1 = Bridge.getEnumerator(this.AllUntsList);
                                try {
                                    while ($t1.moveNext()) {
                                        var u2 = $t1.Current;
                                        if (DarkKingdomCore.MyGame.unitPrms.getItem(u2).$clone().Cost.Tier === tier1 && !DarkKingdomCore.MyGame.unitPrms.getItem(u2).$clone().isHeroic && !DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).units.contains(u2) && !this.unlockedUnits.contains(u2)) {
                                            avunits1.add(u2);
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t1, System.IDisposable)) {
                                        $t1.System$IDisposable$Dispose();
                                    }
                                }
                                if (avunits1.Count > 0) {
                                    while (avunits1.Count > 0 && bustsize1 > 0) {
                                        var u3 = avunits1.getItem(DarkKingdomCore.MyGame.rnd.Next$1(avunits1.Count));
                                        this.unlockedUnits.add(u3);
                                        avunits1.remove(u3);
                                        bustsize1 = (bustsize1 - 1) | 0;
                                    }
                                } else {
                                    cancel = true;
                                }
                                break;
                            }
                        case "Buster3T": 
                            {
                                var avunits2 = new (System.Collections.Generic.List$1(System.String)).ctor();
                                var tier2 = 3;
                                $t2 = Bridge.getEnumerator(this.AllUntsList);
                                try {
                                    while ($t2.moveNext()) {
                                        var u4 = $t2.Current;
                                        if (DarkKingdomCore.MyGame.unitPrms.getItem(u4).$clone().Cost.Tier === tier2 && !DarkKingdomCore.MyGame.unitPrms.getItem(u4).$clone().isHeroic && !DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).units.contains(u4) && !this.unlockedUnits.contains(u4)) {
                                            avunits2.add(u4);
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t2, System.IDisposable)) {
                                        $t2.System$IDisposable$Dispose();
                                    }
                                }
                                if (avunits2.Count > 0) {
                                    this.unlockedUnits.add(avunits2.getItem(DarkKingdomCore.MyGame.rnd.Next$1(avunits2.Count)));
                                } else {
                                    cancel = true;
                                }
                                break;
                            }
                        case "Herobuster": 
                            {
                                var avunits3 = new (System.Collections.Generic.List$1(System.String)).ctor();
                                $t3 = Bridge.getEnumerator(this.AllUntsList);
                                try {
                                    while ($t3.moveNext()) {
                                        var u5 = $t3.Current;
                                        if (DarkKingdomCore.MyGame.unitPrms.getItem(u5).$clone().isHeroic && !DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).units.contains(u5) && !this.unlockedUnits.contains(u5)) {
                                            avunits3.add(u5);
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t3, System.IDisposable)) {
                                        $t3.System$IDisposable$Dispose();
                                    }
                                }
                                if (avunits3.Count > 0) {
                                    this.unlockedUnits.add(avunits3.getItem(DarkKingdomCore.MyGame.rnd.Next$1(avunits3.Count)));
                                } else {
                                    cancel = true;
                                }
                                break;
                            }
                        case "AdditionSlot": 
                            {
                                if (DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile).maxCustomRaces < 3) {
                                    ($t4 = DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile)).maxCustomRaces = ($t4.maxCustomRaces + 1) | 0;
                                } else {
                                    cancel = true;
                                }
                                break;
                            }
                    }
                    if (!cancel) {
                        ($t5 = DarkKingdomCore.ProfileManager.Instance.All.getItem(this.curProfile)).crystals = ($t5.crystals - this.purchases.getItem(prch).crystals) | 0;
                        this.UnlockAchiviement("Firstpurchase");
                    }
                }
            },
            btnUnitPreGame_Clicked: function (btn, isTouch) {
                var uname = this.unitsPreGame.getItem(this.cUnitsPreGame.Children.indexOf(btn));
                if (!this.preGameUnits.contains(uname) && ((((this.preGameUnits.Count + this.preGameSpells.Count) | 0) + this.preGameBonus.Count) | 0) < this.preGameSlotCnt) {
                    this.preGameUnits.add(uname);
                    this.preGameUnits = this.SortUnitsLists(this.preGameUnits);
                    this.SetPreGameLists();
                }
            },
            btnSpellsPreGame_Clicked: function (btn, isTouch) {
                var sname = this.spellsPreGame.getItem(this.cSpellsPreGame.Children.indexOf(btn));
                if (!this.preGameSpells.contains(sname) && ((((this.preGameUnits.Count + this.preGameSpells.Count) | 0) + this.preGameBonus.Count) | 0) < this.preGameSlotCnt) {
                    this.preGameSpells.add(sname);
                    this.preGameSpells = this.SortSpellsLists(this.preGameSpells);
                    this.SetPreGameLists();
                }
            },
            btnBuildingPreGame_Clicked: function (btn, isTouch) {
                var bname = this.startBuildingsList.getItem(this.cBuildingsPreGame.Children.indexOf(btn));
                if (!this.preGameBonus.contains(bname) && ((((this.preGameUnits.Count + this.preGameSpells.Count) | 0) + this.preGameBonus.Count) | 0) < this.preGameSlotCnt) {
                    this.preGameBonus.add(bname);
                    this.SetPreGameLists();
                }
            },
            btnSelectedPreGame_Clicked: function (btn, isTouch) {
                var ind = this.cSelectedPreGame.Children.indexOf(btn);
                if ((ind < this.preGameUnits.Count)) {
                    var uname = this.preGameUnits.getItem(ind);
                    this.preGameUnits.remove(uname);
                    this.SetPreGameLists();
                } else if ((((ind - this.preGameUnits.Count) | 0) < this.preGameSpells.Count)) {
                    var sname = this.preGameSpells.getItem(((ind - this.preGameUnits.Count) | 0));
                    this.preGameSpells.remove(sname);
                    this.SetPreGameLists();
                } else if ((((((ind - this.preGameUnits.Count) | 0) - this.preGameSpells.Count) | 0) < this.preGameBonus.Count)) {
                    var bname = this.preGameBonus.getItem(((((ind - this.preGameUnits.Count) | 0) - this.preGameSpells.Count) | 0));
                    this.preGameBonus.remove(bname);
                    this.SetPreGameLists();
                }
            },
            btnUnitPreGame_Focused: function (btn, isTouch) {
                if ((this.cUnitsPreGame.Children.Count === this.unitsPreGame.Count)) {
                    var uname = this.unitsPreGame.getItem(this.cUnitsPreGame.Children.indexOf(btn));
                    this.ShowUnitInfo(DarkKingdomCore.MyGame.unitPrms.getItem(uname).$clone(), 0, false, new Microsoft.Xna.Framework.Point.$ctor2(Bridge.Int.clip32(btn.FinalRight / this.MainContainer.FinalChildrenScaleX), Bridge.Int.clip32(btn.FinalBottom / this.MainContainer.FinalChildrenScaleY)));
                }
            },
            btnSpellsPreGame_Focused: function (btn, isTouch) {
                if ((this.cSpellsPreGame.Children.Count === this.spellsPreGame.Count)) {
                    var sname = this.spellsPreGame.getItem(this.cSpellsPreGame.Children.indexOf(btn));
                    this.ShowMoreInfo(this.spells.getItem(sname).Cost.$clone(), false, new Microsoft.Xna.Framework.Point.$ctor2(Bridge.Int.clip32(btn.FinalRight / this.MainContainer.FinalChildrenScaleX), Bridge.Int.clip32(btn.FinalBottom / this.MainContainer.FinalChildrenScaleY)), [this.localize.GetString(this.spells.getItem(sname).Name), this.localize.GetString$1(this.spells.getItem(sname).School, [this.spells.getItem(sname).Cost.Tier]), this.spells.getItem(sname).Description]);
                }
            },
            btnBuildingPreGame_Focused: function (btn, isTouch) {
                var bname = this.startBuildingsList.getItem(this.cBuildingsPreGame.Children.indexOf(btn));
                this.ShowUnitInfo(DarkKingdomCore.MyGame.unitPrms.getItem(bname).$clone(), 0, false, new Microsoft.Xna.Framework.Point.$ctor2(Bridge.Int.clip32(btn.FinalRight / this.MainContainer.FinalChildrenScaleX), Bridge.Int.clip32(btn.FinalBottom / this.MainContainer.FinalChildrenScaleY)));
            },
            btnSelectedPreGame_Focused: function (btn, isTouch) {
                var ind = this.cSelectedPreGame.Children.indexOf(btn);
                if ((ind < this.preGameUnits.Count)) {
                    var uname = this.preGameUnits.getItem(ind);
                    this.ShowUnitInfo(DarkKingdomCore.MyGame.unitPrms.getItem(uname).$clone(), 0, false, new Microsoft.Xna.Framework.Point.$ctor2(Bridge.Int.clip32(btn.FinalRight / this.MainContainer.FinalChildrenScaleX), Bridge.Int.clip32(btn.FinalBottom / this.MainContainer.FinalChildrenScaleY)));
                } else if ((((ind - this.preGameUnits.Count) | 0) < this.preGameSpells.Count)) {
                    var sname = this.preGameSpells.getItem(((ind - this.preGameUnits.Count) | 0));
                    this.ShowMoreInfo(this.spells.getItem(sname).Cost.$clone(), true, new Microsoft.Xna.Framework.Point.$ctor2(Bridge.Int.clip32(btn.FinalRight / this.MainContainer.FinalChildrenScaleX), Bridge.Int.clip32(btn.FinalBottom / this.MainContainer.FinalChildrenScaleY)), [this.localize.GetString(this.spells.getItem(sname).Name), this.localize.GetString$1(this.spells.getItem(sname).School, [Bridge.toString(this.spells.getItem(sname).Cost.Tier)]), this.spells.getItem(sname).Description]);
                } else if ((((((ind - this.preGameUnits.Count) | 0) - this.preGameSpells.Count) | 0) < this.preGameBonus.Count)) {
                    var bname = this.preGameBonus.getItem(((((ind - this.preGameUnits.Count) | 0) - this.preGameSpells.Count) | 0));
                    this.ShowUnitInfo(DarkKingdomCore.MyGame.unitPrms.getItem(bname).$clone(), 0, false, new Microsoft.Xna.Framework.Point.$ctor2(Bridge.Int.clip32(btn.FinalRight / this.MainContainer.FinalChildrenScaleX), Bridge.Int.clip32(btn.FinalBottom / this.MainContainer.FinalChildrenScaleY)));
                }
            },
            DoUnitsSpells: function (name, trgs) {
                var $t, $t1, $t2, $t3;
                var cancel = true;
                $t = Bridge.getEnumerator(trgs);
                try {
                    while ($t.moveNext()) {
                        var trg = $t.Current;
                        if (trg.parameters.isBuilding) {
                            this.ShowInfoPar("\u041d\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u043e", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                            continue;
                        }
                        if (trg.AbsContains("Spellproof")) {
                            this.ShowInfoPar("\u0417\u0430\u0449\u0438\u0442\u0430 \u043e\u0442 \u043c\u0430\u0433\u0438\u0438", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                            continue;
                        }
                        if (Bridge.referenceEquals(name, "Magic_armor")) {
                            if (trg.AbsContains("Invulnerable")) {
                                this.ShowInfoPar("\u0423\u0436\u0435 \u0437\u0430\u0449\u0438\u0449\u0435\u043d", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                continue;
                            }
                        }
                        if (Bridge.referenceEquals(name, "Dark_arrow")) {
                            if (trg.AbsContains("Machinery")) {
                                this.ShowInfoPar("\u041d\u0435\u043b\u044c\u0437\u044f \u0434\u043e\u0431\u0438\u0442\u044c \u043c\u0435\u0445\u0430\u043d\u0438\u0437\u043c", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                continue;
                            }
                            if (trg.AbsContains("Bodyless")) {
                                this.ShowInfoPar("\u041d\u0435\u043b\u044c\u0437\u044f \u0434\u043e\u0431\u0438\u0442\u044c \u0431\u0435\u0441\u0442\u0435\u043b\u0435\u0441\u043d\u043e\u0433\u043e", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                continue;
                            }
                            if (trg.hp > 200) {
                                this.ShowInfoPar("\u0421\u043b\u0438\u0448\u043a\u043e\u043c \u043c\u043d\u043e\u0433\u043e \u0437\u0434\u043e\u0440\u043e\u0432\u044c\u044f", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                continue;
                            }
                        }
                        if (Bridge.referenceEquals(name, "Oblivion")) {
                            if (trg.AbsContains("Purified")) {
                                this.ShowInfoPar("\u0423\u0436\u0435 \u043b\u0438\u0448\u0435\u043d", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                continue;
                            }
                            if (trg.AbsContains("Eternal")) {
                                this.ShowInfoPar("\u0417\u0430\u0449\u0438\u0449\u0435\u043d \u043e\u0442 \u043b\u0438\u0448\u0435\u043d\u0438\u044f \u0441\u043f\u043e\u0441\u043e\u0431\u043d\u043e\u0441\u0442\u0435\u0439", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                continue;
                            }
                        }

                        cancel = false;

                        switch (name) {
                            case "Heal": 
                                {
                                    this.Heal(trg, trg.parameters.maxhp);
                                    break;
                                }
                            case "Haste": 
                                {
                                    trg.parameters.Speed = "Very_fast";
                                    trg.AddAbility$2("Agility", 20, DarkKingdomCore.EffectType.Good);
                                    break;
                                }
                            case "Weakness": 
                                {
                                    trg.parameters.Speed = "Slow";
                                    trg.AddAbility$1("Clumsiness", DarkKingdomCore.EffectType.Bad);
                                    break;
                                }
                            case "Rescue": 
                                {
                                    trg.x = (DarkKingdomCore.MyGame.plrs[trg.owner].baseX + trg.moveside) | 0;
                                    break;
                                }
                            case "Ghost_mode": 
                                {
                                    trg.AddAbility$1("Undead", DarkKingdomCore.EffectType.Good);
                                    trg.AddAbility$1("Bodyless", DarkKingdomCore.EffectType.Good);
                                    trg.RemoveAbil("Poison");
                                    break;
                                }
                            case "The_Covenant": 
                                {
                                    DarkKingdomCore.MyGame.units.getItem(((1 - trg.owner) | 0)).hp -= trg.hp;
                                    this.ShowInfoPar("-" + (System.Single.format(trg.hp) || ""), DarkKingdomCore.MyGame.badAbilClr.$clone(), DarkKingdomCore.MyGame.units.getItem(((1 - trg.owner) | 0)).x, ((DarkKingdomCore.MyGame.hor + DarkKingdomCore.MyGame.units.getItem(((1 - trg.owner) | 0)).parameters.rect.Top) | 0), false);
                                    this.Kill(trg);
                                    break;
                                }
                            case "Magic_arrow": 
                                {
                                    this.Harm(trg, DarkKingdomCore.MyGame.rnd.Next$2(100, 151), true, DarkKingdomCore.EffectType.Bad);
                                    break;
                                }
                            case "Polymorph": 
                                {
                                    var allunitst = new (System.Collections.Generic.List$1(System.String)).ctor();
                                    var u;
                                    $t1 = Bridge.getEnumerator(DarkKingdomCore.MyGame.unitPrms.Values);
                                    try {
                                        while ($t1.moveNext()) {
                                            var up = $t1.Current.$clone();
                                            if (!up.special) {
                                                if (up.Cost.Tier === trg.parameters.Cost.Tier && DarkKingdomCore.MyGame.plrs[trg.owner].CheckForLimit(up.Name)) {
                                                    allunitst.add(up.Name);
                                                }
                                            }
                                        }
                                    } finally {
                                        if (Bridge.is($t1, System.IDisposable)) {
                                            $t1.System$IDisposable$Dispose();
                                        }
                                    }
                                    if (allunitst.Count > 0) {
                                        u = DarkKingdomCore.MyGame.rnd.Next$2(0, allunitst.Count);
                                        trg.SetParams(DarkKingdomCore.MyGame.unitPrms.getItem(allunitst.getItem(u)).$clone(), true);
                                        trg.purified = false;
                                        trg.takedOff = false;
                                        trg.landing = false;
                                    } else {
                                        cancel = true;
                                        this.ShowInfoPar("\u041d\u0435\u0442 \u043f\u043e\u0434\u0445\u043e\u0434\u044f\u0449\u0438\u0445 \u0441\u0443\u0449\u0435\u0441\u0442\u0432", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                    }

                                    break;
                                }
                            case "Dark_arrow": 
                                {
                                    this.Kill(trg);
                                    var allunitst1 = new (System.Collections.Generic.List$1(System.String)).ctor();
                                    var u1;
                                    $t2 = Bridge.getEnumerator(DarkKingdomCore.MyGame.unitPrms.Values);
                                    try {
                                        while ($t2.moveNext()) {
                                            var up1 = $t2.Current.$clone();
                                            if (!up1.special) {
                                                if (up1.Cost.Tier === trg.parameters.Cost.Tier && up1.AbsContains("Undead") && DarkKingdomCore.MyGame.plrs[0].CheckForLimit(up1.Name)) {
                                                    allunitst1.add(up1.Name);
                                                }
                                            }
                                        }
                                    } finally {
                                        if (Bridge.is($t2, System.IDisposable)) {
                                            $t2.System$IDisposable$Dispose();
                                        }
                                    }
                                    if (allunitst1.Count > 0) {
                                        u1 = DarkKingdomCore.MyGame.rnd.Next$2(0, allunitst1.Count);
                                        this.bornList.add(new DarkKingdomCore.Unit(this, trg.x, 1, 0, DarkKingdomCore.MyGame.unitPrms.getItem(allunitst1.getItem(u1)).$clone()));
                                    } else {
                                        this.ShowInfoPar("\u041d\u0435\u0442 \u043f\u043e\u0434\u0445\u043e\u0434\u044f\u0449\u0438\u0445 \u0441\u0443\u0449\u0435\u0441\u0442\u0432", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                    }
                                    break;
                                }
                            case "Transmutation": 
                                {
                                    var allunitst2 = new (System.Collections.Generic.List$1(System.String)).ctor();
                                    var u2;
                                    $t3 = Bridge.getEnumerator(DarkKingdomCore.MyGame.unitPrms.Values);
                                    try {
                                        while ($t3.moveNext()) {
                                            var up2 = $t3.Current.$clone();
                                            if (!up2.special) {
                                                if (up2.Cost.Tier === ((trg.parameters.Cost.Tier + 1) | 0) && Bridge.referenceEquals(up2.Race, trg.parameters.Race) && DarkKingdomCore.MyGame.plrs[0].CheckForLimit(up2.Name)) {
                                                    allunitst2.add(up2.Name);
                                                }
                                            }
                                        }
                                    } finally {
                                        if (Bridge.is($t3, System.IDisposable)) {
                                            $t3.System$IDisposable$Dispose();
                                        }
                                    }
                                    if (allunitst2.Count > 0) {
                                        u2 = DarkKingdomCore.MyGame.rnd.Next$2(0, allunitst2.Count);
                                        trg.SetParams(DarkKingdomCore.MyGame.unitPrms.getItem(allunitst2.getItem(u2)).$clone(), false);
                                        if (trg.hp > trg.parameters.maxhp) {
                                            trg.hp = trg.parameters.maxhp;
                                        }
                                        trg.purified = false;
                                        trg.takedOff = false;
                                        trg.landing = false;
                                    } else {
                                        cancel = true;
                                        this.ShowInfoPar("\u041d\u0435\u0442 \u043f\u043e\u0434\u0445\u043e\u0434\u044f\u0449\u0438\u0445 \u0441\u0443\u0449\u0435\u0441\u0442\u0432", DarkKingdomCore.MyGame.badAbilClr.$clone(), trg.x, ((DarkKingdomCore.MyGame.hor + trg.parameters.rect.Top) | 0), true);
                                    }

                                    break;
                                }
                            case "Googlehammer": 
                                {
                                    trg.AddAbility$1("Mage", DarkKingdomCore.EffectType.Good);
                                    if (trg.parameters.Attack.Range === 1) {
                                        trg.parameters.Attack.Range = 3;
                                        trg.parameters.ammoType = DarkKingdomCore.Ammo.AmmoType.Hammer;
                                        if (trg.parameters.Attack.Speed < 60) {
                                            trg.parameters.Attack.Speed = 60;
                                        }
                                    }

                                    break;
                                }
                            case "Magic_armor": 
                                {
                                    trg.AddAbility$2("Invulnerable", 400, DarkKingdomCore.EffectType.Good);
                                    break;
                                }
                            case "Oblivion": 
                                {
                                    trg.purified = true;
                                    break;
                                }
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }

                if (!cancel) {
                    this.SpellComplete(name);
                    return true;
                }
                return false;
            },
            DoGlobalSpells: function (name) {
                var $t, $t1, $t2, $t3, $t4, $t5, $t6, $t7;
                switch (name) {
                    case "Earthquake": 
                        {
                            $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                            try {
                                while ($t.moveNext()) {
                                    var u = $t.Current;
                                    if (u.parameters.isBuilding && !u.AbsContains("Spellproof")) {
                                        this.Harm(u, DarkKingdomCore.MyGame.rnd.Next$2(250, 501), true, DarkKingdomCore.EffectType.Bad);
                                    }
                                }
                            } finally {
                                if (Bridge.is($t, System.IDisposable)) {
                                    $t.System$IDisposable$Dispose();
                                }
                            }

                            break;
                        }
                    case "Mana_blast": 
                        {
                            $t1 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                            try {
                                while ($t1.moveNext()) {
                                    var u1 = $t1.Current;
                                    if (u1.AbsContains("Mage") && !u1.AbsContains("Spellproof")) {
                                        this.Explode(u1, true);
                                        if (!Bridge.referenceEquals(u1.parameters.Armor, "None")) {
                                            u1.parameters.Armor = "None";
                                        }
                                    }
                                }
                            } finally {
                                if (Bridge.is($t1, System.IDisposable)) {
                                    $t1.System$IDisposable$Dispose();
                                }
                            }

                            break;
                        }
                    case "Storm": 
                        {
                            $t2 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                            try {
                                while ($t2.moveNext()) {
                                    var u2 = $t2.Current;
                                    if (u2.owner !== 0 && !u2.parameters.isBuilding && u2.parameters.moveType === DarkKingdomCore.UnitMoveType.FlyingMT && !u2.AbsContains("Spellproof")) {
                                        this.Harm(u2, DarkKingdomCore.MyGame.rnd.Next$2(70, 101), false, DarkKingdomCore.EffectType.Bad);
                                        u2.landing = true;
                                    }
                                }
                            } finally {
                                if (Bridge.is($t2, System.IDisposable)) {
                                    $t2.System$IDisposable$Dispose();
                                }
                            }

                            break;
                        }
                    case "Mass_polymorph": 
                        {
                            var allunitst = new (System.Collections.Generic.List$1(System.String)).ctor();
                            var u3;
                            $t3 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                            try {
                                while ($t3.moveNext()) {
                                    var uu = $t3.Current;
                                    if (!uu.parameters.isBuilding && !uu.AbsContains("Spellproof")) {
                                        allunitst.clear();
                                        $t4 = Bridge.getEnumerator(DarkKingdomCore.MyGame.unitPrms.Values);
                                        try {
                                            while ($t4.moveNext()) {
                                                var up = $t4.Current.$clone();
                                                if (!up.special) {
                                                    if (up.Cost.Tier === uu.parameters.Cost.Tier && DarkKingdomCore.MyGame.plrs[uu.owner].CheckForLimit(up.Name)) {
                                                        allunitst.add(up.Name);
                                                    }
                                                }
                                            }
                                        } finally {
                                            if (Bridge.is($t4, System.IDisposable)) {
                                                $t4.System$IDisposable$Dispose();
                                            }
                                        }
                                        if (allunitst.Count > 0) {
                                            u3 = DarkKingdomCore.MyGame.rnd.Next$2(0, allunitst.Count);
                                            uu.SetParams(DarkKingdomCore.MyGame.unitPrms.getItem(allunitst.getItem(u3)).$clone(), true);
                                            uu.purified = false;
                                            uu.takedOff = false;
                                            uu.landing = false;
                                        }
                                    }
                                }
                            } finally {
                                if (Bridge.is($t3, System.IDisposable)) {
                                    $t3.System$IDisposable$Dispose();
                                }
                            }

                            break;
                        }
                    case "Jackpot": 
                        {
                            var allspells = new (System.Collections.Generic.List$1(System.String)).ctor();
                            $t5 = Bridge.getEnumerator(this.spells.Keys);
                            try {
                                while ($t5.moveNext()) {
                                    var spl = $t5.Current;
                                    allspells.add(spl);
                                }
                            } finally {
                                if (Bridge.is($t5, System.IDisposable)) {
                                    $t5.System$IDisposable$Dispose();
                                }
                            }
                            DarkKingdomCore.MyGame.plrs[0].spllsList = this.RandomizeSpells(DarkKingdomCore.MyGame.plrs[0].spllsList.Count, allspells);
                            this.updateSpells = true;
                            break;
                        }
                    case "Arrowrain": 
                        {
                            $t6 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                            try {
                                while ($t6.moveNext()) {
                                    var uu1 = $t6.Current;
                                    if (uu1.owner === 1 && !(Bridge.referenceEquals(uu1.parameters.Name, DarkKingdomCore.MyGame.plrs[1].hero))) {
                                        this.ammos.add(new DarkKingdomCore.Ammo.ctor(0, DarkKingdomCore.Ammo.AmmoType.Arrow, ((-this.us2) | 0), DarkKingdomCore.MyGame.hor, null, uu1, Bridge.Int.mul(DarkKingdomCore.MyGame.plrs[0].uCount, DarkKingdomCore.MyGame.rnd.Next$2(5, 11)), false, false, 7200));
                                    }
                                }
                            } finally {
                                if (Bridge.is($t6, System.IDisposable)) {
                                    $t6.System$IDisposable$Dispose();
                                }
                            }

                            break;
                        }
                    case "Poison_wave": 
                        {
                            $t7 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                            try {
                                while ($t7.moveNext()) {
                                    var uu2 = $t7.Current;
                                    if (!uu2.AbsContains("Spellproof")) {
                                        if (uu2.AbsContains("Poison")) {
                                            uu2.RemoveAbil("Poison");
                                            if (uu2.owner === 0) {
                                                this.Heal(uu2, DarkKingdomCore.MyGame.rnd.Next$2(70, 101));
                                            } else {
                                                if (uu2.owner === 1) {
                                                    this.Harm(uu2, DarkKingdomCore.MyGame.rnd.Next$2(70, 101), true, DarkKingdomCore.EffectType.Poison);
                                                }
                                            }
                                        }
                                    }
                                }
                            } finally {
                                if (Bridge.is($t7, System.IDisposable)) {
                                    $t7.System$IDisposable$Dispose();
                                }
                            }

                            break;
                        }
                }
                this.SpellComplete(name);
                return true;
            },
            SpellComplete: function (name) {
                var $t, $t1;
                DarkKingdomCore.MyGame.plrs[0].Resources = DarkKingdomCore.TimeCost.op_Subtraction(DarkKingdomCore.MyGame.plrs[0].Resources.$clone(), this.spells.getItem(name).Cost.$clone());
                DarkKingdomCore.MyGame.plrs[0].spellsRchrg.setItem(DarkKingdomCore.MyGame.plrs[0].spllsList.indexOf(name), this.spells.getItem(name).Cost.Time);
                this.ShowInfoPar(this.localize.GetString(name), DarkKingdomCore.MyGame.goodAbilClr.$clone(), ((Bridge.Int.div(DarkKingdomCore.MyGame.gameWidth, 2)) | 0), ((Bridge.Int.div(DarkKingdomCore.MyGame.gameHeight, 2)) | 0), true, true);
                $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                try {
                    while ($t.moveNext()) {
                        var uu = $t.Current;
                        if (uu.AbsContains("Antimage")) {
                            uu.Attack = DarkKingdomCore.Attack.op_Addition$1(uu.Attack.$clone(), (uu.abils.getItem("Antimage").value) | 0);
                            this.ShowInfoPar("\u041c\u0430\u0433\u0438\u044f!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), uu.x, ((DarkKingdomCore.MyGame.hor + uu.parameters.rect.Top) | 0), true);
                        }
                        if (uu.AbsContains("Magic_power")) {
                            ($t1 = uu.parameters.Attack.$clone()).Range = ($t1.Range + 1) | 0;
                            this.ShowInfoPar("\u041c\u0430\u0433\u0438\u044f!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), uu.x, ((DarkKingdomCore.MyGame.hor + uu.parameters.rect.Top) | 0), true);
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            },
            MouseClicked: function (pos, isTouch) {
                var $t;
                if (isTouch === void 0) { isTouch = false; }
                if (this.selU != null) {
                    this.selU = null;
                }
                this.MainContainer.ClickButton$1(Bridge.Int.clip32(pos.X), Bridge.Int.clip32(pos.Y), isTouch);
                if (DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.InGame) {
                    var respos = new Microsoft.Xna.Framework.Vector2.$ctor2(pos.X * this.scaleX, pos.Y * this.scaleY);

                    var trgs = new (System.Collections.Generic.List$1(DarkKingdomCore.Unit)).ctor();
                    $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                    try {
                        while ($t.moveNext()) {
                            var u = $t.Current;
                            if (u.x + u.parameters.rect.Right > respos.X && respos.X > u.x + u.parameters.rect.Left && ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Bottom) | 0) > respos.Y && respos.Y > ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0)) {
                                if (u.owner === 1 || !u.AbsContains("Invisible")) {
                                    this.selU = u;
                                    trgs.add(u);
                                }
                            }
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                    if (this.inSpellMode) {
                        if (this.DoUnitsSpells(this.spellName, trgs)) {
                            this.inSpellMode = false;
                        }
                    }
                }
            },
            AddToReadyUnits: function (plr, unitName) {
                var unitRes = unitName;
                if (DarkKingdomCore.MyGame.unitPrms.getItem(unitName).$clone().AbsContains("Crowd")) {
                    if (DarkKingdomCore.MyGame.unitPrms.getItem(unitName).$clone().AbsContains("Crowd2") && plr.res.Tier === 2) {
                        if (DarkKingdomCore.MyGame.rnd.NextDouble() < 0.5) {
                            unitRes = "Skeleton_archer";
                        } else {
                            if (DarkKingdomCore.MyGame.rnd.NextDouble() < 0.8) {
                                unitRes = "Skeleton_warrior";
                            } else {
                                unitRes = "Skeleton_knight";
                            }
                        }
                    } else if (DarkKingdomCore.MyGame.rnd.NextDouble() < 0.5) {
                        unitRes = "Skeleton_archer";
                    } else {
                        unitRes = "Skeleton_warrior";
                    }
                }
                plr.readyUnits.add(unitRes);
            },
            DrawInterface: function (sb) {
                this.MainContainer.Draw(sb, 1.0);
            },
            battleFrmMainMenu: function (btn, isTouch) {
                this.StartBattle();
            },
            profileFrmMainMenu: function (btn, isTouch) {
                this.StartProfile();
            },
            surrenderFrmBattleMenu_Clicked: function (btn, isTouch) {
                var $step = 0,
                    $task1, 
                    $taskResult1, 
                    $jumpFromFinally, 
                    $asyncBody = Bridge.fn.bind(this, function () {
                        for (;;) {
                            $step = System.Array.min([0,1,2,3,4], $step);
                            switch ($step) {
                                case 0: {
                                    this.frmBattleMenu.Hide(this.mainAnimator);

                                    $task1 = this.ShowDialogConfirmation("\u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0441\u0434\u0430\u0442\u044c\u0441\u044f?");
                                    $step = 1;
                                    if ($task1.isCompleted()) {
                                        continue;
                                    }
                                    $task1.continue($asyncBody);
                                    return;
                                }
                                case 1: {
                                    $taskResult1 = $task1.getAwaitedResult();
                                    if ($taskResult1) {
                                        $step = 2;
                                        continue;
                                    } else  {
                                        $step = 3;
                                        continue;
                                    }
                                }
                                case 2: {
                                    DarkKingdomCore.MyGame.gState = DarkKingdomCore.GameState.Lose;
                                    this.EndOfBattle();
                                    $step = 4;
                                    continue;
                                }
                                case 3: {
                                    this.frmBattleMenu.Show(this.mainAnimator);
                                    $step = 4;
                                    continue;
                                }
                                case 4: {
                                    return;
                                }
                                default: {
                                    return;
                                }
                            }
                        }
                    }, arguments);

                $asyncBody();
            },
            restartFrmBattleMenu_Clicked: function (btn, isTouch) {
                var $step = 0,
                    $task1, 
                    $taskResult1, 
                    $jumpFromFinally, 
                    $asyncBody = Bridge.fn.bind(this, function () {
                        for (;;) {
                            $step = System.Array.min([0,1,2,3,4], $step);
                            switch ($step) {
                                case 0: {
                                    this.frmBattleMenu.Hide(this.mainAnimator);

                                    $task1 = this.ShowDialogConfirmation("\u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u043d\u0430\u0447\u0430\u0442\u044c \u0437\u0430\u043d\u043e\u0432\u043e?");
                                    $step = 1;
                                    if ($task1.isCompleted()) {
                                        continue;
                                    }
                                    $task1.continue($asyncBody);
                                    return;
                                }
                                case 1: {
                                    $taskResult1 = $task1.getAwaitedResult();
                                    if ($taskResult1) {
                                        $step = 2;
                                        continue;
                                    } else  {
                                        $step = 3;
                                        continue;
                                    }
                                }
                                case 2: {
                                    this.StartAgain();
                                    $step = 4;
                                    continue;
                                }
                                case 3: {
                                    this.frmBattleMenu.Show(this.mainAnimator);
                                    $step = 4;
                                    continue;
                                }
                                case 4: {
                                    return;
                                }
                                default: {
                                    return;
                                }
                            }
                        }
                    }, arguments);

                $asyncBody();
            },
            AIFrmBattleMenu_Clicked: function (btn, is_touch) {
                this.SetPlayerAI(!DarkKingdomCore.MyGame.plrs[0].AI);
            },
            backFrmBattleMenu_Clicked: function (btn, isTouch) {
                this.Pause = false;
            },
            exitFrmMenuExit_Clicked: function (btn, isTouch) {
                var $step = 0,
                    $task1, 
                    $taskResult1, 
                    $jumpFromFinally, 
                    $asyncBody = Bridge.fn.bind(this, function () {
                        for (;;) {
                            $step = System.Array.min([0,1,2,3], $step);
                            switch ($step) {
                                case 0: {
                                    $task1 = this.ShowDialogConfirmation("\u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0432\u044b\u0439\u0442\u0438 \u0438\u0437 \u0438\u0433\u0440\u044b?");
                                    $step = 1;
                                    if ($task1.isCompleted()) {
                                        continue;
                                    }
                                    $task1.continue($asyncBody);
                                    return;
                                }
                                case 1: {
                                    $taskResult1 = $task1.getAwaitedResult();
                                    if ($taskResult1) {
                                        $step = 2;
                                        continue;
                                    } 
                                    $step = 3;
                                    continue;
                                }
                                case 2: {
                                    !Bridge.staticEquals(this.OnExit, null) ? this.OnExit() : null;
                                    $step = 3;
                                    continue;
                                }
                                case 3: {
                                    return;
                                }
                                default: {
                                    return;
                                }
                            }
                        }
                    }, arguments);

                $asyncBody();
            },
            settingsFrmMenuExit_Clicked: function (btn, isTouch) {
                this.frmSettings.Show(this.mainAnimator);
            },
            okayFrmDialog_Clicked: function (btn, isTouch) {
                this.ClearVarsAndCalcEarned();
                this.HideSomeChildren([this.frmResources, this.frmUnits, this.frmProduction]);
                this.ShowSomeChildren([this.frmMainMenu, this.frmRightMenu]);
                this.frmDialog.Hide(this.mainAnimator);
                this.StartBattle();
            },
            pauseFrmResources_Clicked: function (btn, isTouch) {
                if (DarkKingdomCore.MyGame.gState === DarkKingdomCore.GameState.InGame) {
                    this.Pause = !this.Pause;
                }
            },
            tierUpFrmResources_Clicked: function (btn, isTouch) {
                var tier;
                if ((DarkKingdomCore.MyGame.plrs[0].res.Tier === 1)) {
                    tier = "Tier_2";
                } else {
                    tier = "Tier_3";
                }
                this.TryAddToQueueUnit(DarkKingdomCore.MyGame.plrs[0], tier);
            },
            tierUpFrmResources_Focused: function (btn, isTouch) {
                var tier;
                if ((DarkKingdomCore.MyGame.plrs[0].res.Tier === 1)) {
                    tier = "Tier_2";
                } else {
                    tier = "Tier_3";
                }
                this.ShowMoreInfo(DarkKingdomCore.MyGame.unitPrms.getItem(tier).$clone().Cost.$clone(), true, Bridge.getDefaultValue(Microsoft.Xna.Framework.Point), [this.localize.GetString(DarkKingdomCore.MyGame.unitPrms.getItem(tier).$clone().Name), "", DarkKingdomCore.MyGame.unitPrms.getItem(tier).$clone().Description]);
            },
            btnStartBattle: function (btn, isTouch) {
                this.StartPreGame();
                this.frmBattle.Hide(this.mainAnimator);
            },
            btnProduction_Clicked: function (btn, isTouch) {
                for (var i = 0; i < this.btnsProduction.length; i = (i + 1) | 0) {
                    if (Bridge.referenceEquals(btn, this.btnsProduction[i])) {
                        if (i < DarkKingdomCore.MyGame.plrs[0].readyUnits.Count) {
                            this.ProduceUnit(0, DarkKingdomCore.MyGame.plrs[0].readyUnits.getItem(i));
                            DarkKingdomCore.MyGame.plrs[0].readyUnits.removeAt(i);
                            this.UpdateQueue();
                            break;
                        } else if (((i - DarkKingdomCore.MyGame.plrs[0].readyUnits.Count) | 0) < DarkKingdomCore.MyGame.plrs[0].prdQ.Count && isTouch) {
                            DarkKingdomCore.MyGame.plrs[0].Resources = DarkKingdomCore.TimeCost.op_Addition(DarkKingdomCore.MyGame.plrs[0].Resources.$clone(), DarkKingdomCore.MyGame.unitPrms.getItem(DarkKingdomCore.MyGame.plrs[0].prdQ.getItem(((i - DarkKingdomCore.MyGame.plrs[0].readyUnits.Count) | 0))).$clone().Cost.$clone());
                            this.RemoveFromQueue(0, ((i - DarkKingdomCore.MyGame.plrs[0].readyUnits.Count) | 0));
                            break;
                        }
                    }
                }
            },
            btnProductionRemove_Clicked: function (btn, isTouch) {
                for (var i = 0; i < this.btnsProduction.length; i = (i + 1) | 0) {
                    if (Bridge.referenceEquals(btn.Parent, this.btnsProduction[i])) {
                        if (((i - DarkKingdomCore.MyGame.plrs[0].readyUnits.Count) | 0) < DarkKingdomCore.MyGame.plrs[0].prdQ.Count && !isTouch) {
                            DarkKingdomCore.MyGame.plrs[0].Resources = DarkKingdomCore.TimeCost.op_Addition(DarkKingdomCore.MyGame.plrs[0].Resources.$clone(), DarkKingdomCore.MyGame.unitPrms.getItem(DarkKingdomCore.MyGame.plrs[0].prdQ.getItem(((i - DarkKingdomCore.MyGame.plrs[0].readyUnits.Count) | 0))).$clone().Cost.$clone());
                            this.RemoveFromQueue(0, ((i - DarkKingdomCore.MyGame.plrs[0].readyUnits.Count) | 0));
                            break;
                        }
                    }
                }
            },
            btnProduction_Focused: function (btn, isTouch) {
                for (var i = 0; i < this.btnsProduction.length; i = (i + 1) | 0) {

                    if (Bridge.referenceEquals(btn, this.btnsProduction[i])) {
                        if (i < DarkKingdomCore.MyGame.plrs[0].readyUnits.Count) {
                            this.ShowUnitInfo(DarkKingdomCore.MyGame.unitPrms.getItem(DarkKingdomCore.MyGame.plrs[0].readyUnits.getItem(i)).$clone(), 0, false, new Microsoft.Xna.Framework.Point.$ctor2(btn.FinalRight, btn.FinalBottom));
                        } else {
                            if (((i - DarkKingdomCore.MyGame.plrs[0].readyUnits.Count) | 0) < DarkKingdomCore.MyGame.plrs[0].prdQ.Count) {
                                btn.Children.getItem(2).Visible = !isTouch;
                                this.ShowUnitInfo(DarkKingdomCore.MyGame.unitPrms.getItem(DarkKingdomCore.MyGame.plrs[0].prdQ.getItem(((i - DarkKingdomCore.MyGame.plrs[0].readyUnits.Count) | 0))).$clone(), 0, false, new Microsoft.Xna.Framework.Point.$ctor2(btn.FinalRight, btn.FinalBottom));
                            }
                        }
                    }
                }
            },
            TextureToApp: function (tex) {
                var $t;
                var colors = System.Array.init(1, function (){
                    return new Microsoft.Xna.Framework.Color();
                }, Microsoft.Xna.Framework.Color);
                tex.GetData(Microsoft.Xna.Framework.Color, colors);
                System.Console.WriteLine(colors[0].$clone());
                return new MonoInterface.Appearance.$ctor1(($t = new MonoInterface.Sprite(), $t.Texture = tex, $t.W = 1, $t.H = 1, $t), 0);
            },
            CreateInterfaceTexures: function () {
                this.defaultTheme.EmptyTexture = MonoInterface.Theme.GetEmptyApp(this.graphics.GraphicsDevice);

                //defaultTheme.FrameBackTexture = TextureToApp(MonoInterface.Theme.SolidColorTexture(graphics.GraphicsDevice, 173, 122, 71, 220));
                this.defaultTheme.FrameBackTexture = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("empty"), 0);

                //defaultTheme.ButtonBackTexture = TextureToApp(MonoInterface.Theme.SolidColorTexture(graphics.GraphicsDevice, 123, 72, 21));
                this.defaultTheme.ButtonBackTexture = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("empty"), 1);
                //defaultTheme.ButtonSelectedTexture = TextureToApp(MonoInterface.Theme.SolidColorTexture(graphics.GraphicsDevice, 200, 200, 200));
                this.defaultTheme.ButtonSelectedTexture = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("empty"), 2);
                //defaultTheme.ButtonFrontTexture = TextureToApp(MonoInterface.Theme.SolidColorTexture(graphics.GraphicsDevice, 255, 255, 51, 120));
                this.defaultTheme.ButtonFrontTexture = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("empty"), 3);
                //defaultTheme.ButtonPressedTexture = TextureToApp(MonoInterface.Theme.SolidColorTexture(graphics.GraphicsDevice, 220, 220, 220, 180));
                this.defaultTheme.ButtonPressedTexture = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("empty"), 4);
                //defaultTheme.ButtonDisabledTexture = TextureToApp(MonoInterface.Theme.SolidColorTexture(graphics.GraphicsDevice, 100, 100, 100, 200));
                this.defaultTheme.ButtonDisabledTexture = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("empty"), 5);

                this.defaultTheme.ProgressBackTexture = this.defaultTheme.EmptyTexture.$clone();
                //defaultTheme.ProgressFrontTexture = TextureToApp(MonoInterface.Theme.SolidColorTexture(graphics.GraphicsDevice, 140, 140, 140, 200));
                this.defaultTheme.ProgressFrontTexture = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("empty"), 6);

                this.defaultTheme.SwitcherButtonLeftTexture = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("medium_icons"), 2);
                this.defaultTheme.SwitcherButtonRightTexture = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("medium_icons"), 3);
                this.defaultTheme.SwitcherDescriptionFontSize = 14;
                this.defaultTheme.SwitcherDescriptionColor = Microsoft.Xna.Framework.Color.Black.$clone();
                this.defaultTheme.SwitcherMainFontSize = 20;
                this.defaultTheme.SwitcherMainColor = Microsoft.Xna.Framework.Color.Black.$clone();

                var nfts = System.Array.init(10, function (){
                    return new MonoInterface.Appearance();
                }, MonoInterface.Appearance);
                for (var i = 0; i <= 8; i = (i + 1) | 0) {
                    nfts[i] = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("nineframe"), i);
                }

                this.defaultTheme.NineFrameBoderTexture = nfts;

                this.defaultTheme.Fonts = this.Fonts;

                //backTheme.FrameBackTexture = TextureToApp(MonoInterface.Theme.SolidColorTexture(graphics.GraphicsDevice, 0, 0, 0, 150));
                this.backTheme.FrameBackTexture = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("empty"), 7);
            },
            CreateInterface: function () {
                var $t;
                this.defaultTheme = new MonoInterface.Theme();
                this.backTheme = new MonoInterface.Theme();

                this.CreateInterfaceTexures();

                this.MainContainer = ($t = new MonoInterface.Window(0, 0, DarkKingdomCore.MyGame.gameWidth, DarkKingdomCore.MyGame.gameHeight), $t.CurrentTheme = this.defaultTheme, $t);


                this.mainAnimator = new MonoInterface.Animator();

                this.frmUnits = this.MainContainer.AddChild(MonoInterface.Frame, ($t = new MonoInterface.Frame(0, 0, 300, 110, 0.0, 0.0, false), $t.LeftBorder = false, $t.TopBorder = false, $t.ShowAnimation = new MonoInterface.NumberAnimation("Y", -82, 0, 20), $t));

                this.cUnits = this.frmUnits.AddChild(MonoInterface.Container, new MonoInterface.Container(5, 5, 290, 60, 0.0, 0.0, true));
                this.cSpells = this.frmUnits.AddChild(MonoInterface.Container, new MonoInterface.Container(5, 5, 290, 60, 0.0, 0.0, true));
                this.cBuildings = this.frmUnits.AddChild(MonoInterface.Container, new MonoInterface.Container(5, 5, 290, 60, 0.0, 0.0, true));


                this.btnSelectUnits = this.frmUnits.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor3(Bridge.fn.bind(this, function (btn, is_touch) {
                    this.cUnits.Visible = true;
                    this.cSpells.Visible = false;
                    this.cBuildings.Visible = false;
                    this.btnSelectUnits.IsSelected = true;
                    this.btnSelectSpells.IsSelected = false;
                    this.btnSelectBuildings.IsSelected = false;

                    this.frmUnits.W = (Math.max(System.Linq.Enumerable.from(this.cUnits.Children, MonoInterface.Block).last().Right, this.btnSelectBuildings.Right) + 5) | 0;
                }), 5, -5, 100, 30, 0.0, 1.0, true));
                this.btnSelectUnits.AddChild(MonoInterface.Label, new MonoInterface.Label("\u0421\u0443\u0449\u0435\u0441\u0442\u0432\u0430", 16, Microsoft.Xna.Framework.Color.Black.$clone()));

                this.btnSelectSpells = this.frmUnits.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor3(Bridge.fn.bind(this, function (btn, is_touch) {
                    this.cUnits.Visible = false;
                    this.cSpells.Visible = true;
                    this.cBuildings.Visible = false;
                    this.btnSelectUnits.IsSelected = false;
                    this.btnSelectSpells.IsSelected = true;
                    this.btnSelectBuildings.IsSelected = false;

                    this.frmUnits.W = (Math.max(System.Linq.Enumerable.from(this.cSpells.Children, MonoInterface.Block).last().Right, this.btnSelectBuildings.Right) + 5) | 0;
                }), 110, -5, 100, 30, 0.0, 1.0, true));

                this.btnSelectSpells.AddChild(MonoInterface.Label, new MonoInterface.Label("\u0417\u0430\u043a\u043b\u0438\u043d\u0430\u043d\u0438\u044f", 16, Microsoft.Xna.Framework.Color.Black.$clone()));

                this.btnSelectBuildings = this.frmUnits.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor3(Bridge.fn.bind(this, function (btn, is_touch) {
                    this.cUnits.Visible = false;
                    this.cSpells.Visible = false;
                    this.cBuildings.Visible = true;
                    this.btnSelectUnits.IsSelected = false;
                    this.btnSelectSpells.IsSelected = false;
                    this.btnSelectBuildings.IsSelected = true;

                    this.frmUnits.W = (Math.max(System.Linq.Enumerable.from(this.cBuildings.Children, MonoInterface.Block).last().Right, this.btnSelectBuildings.Right) + 5) | 0;
                }), 215, -5, 100, 30, 0.0, 1.0, true));
                this.btnSelectBuildings.IsDisabled = true;
                this.btnSelectBuildings.AddChild(MonoInterface.Label, new MonoInterface.Label("\u041f\u043e\u0441\u0442\u0440\u043e\u0439\u043a\u0438", 16, Microsoft.Xna.Framework.Color.Black.$clone()));

                // frmUnits.HideAnimation = New MonoInterface.NumberAnimation(frmUnits, "Y", 0, -82, 50, Nothing, Nothing)


                this.frmProduction = this.MainContainer.AddChild(MonoInterface.Frame, ($t = new MonoInterface.Frame(0, 130, 355, 55, 0.0, 0.0, false), $t.LeftBorder = false, $t.ShowAnimation = new MonoInterface.NumberAnimation("X", -355, 0, 50), $t.HideAnimation = new MonoInterface.NumberAnimation("X", 0, -355, -50), $t));

                for (var i = 0; i <= 6; i = (i + 1) | 0) {
                    this.btnsProduction[i] = this.frmProduction.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor2(Bridge.fn.cacheBind(this, this.btnProduction_Clicked), Bridge.fn.cacheBind(this, this.btnProduction_Focused), ((5 + Bridge.Int.mul(i, 50)) | 0), 5, 45, 45, 0.0, 0.0, true));
                    this.btnsProduction[i].AddChild(MonoInterface.Picture, new MonoInterface.Picture(this.defaultTheme.EmptyTexture.$clone(), 0, 0, 45, 45, 0.5, 0.5, true));
                    this.btnsProduction[i].AddChild(MonoInterface.Picture, new MonoInterface.Picture(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("small_icons"), 19), 0, 0, 20, 16, 1.0, 1.0, true));

                    this.btnsProduction[i].AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor3(Bridge.fn.cacheBind(this, this.btnProductionRemove_Clicked), 0, 0, 16, 16, 1.0, 0.0, true)).AddChild(MonoInterface.Picture, new MonoInterface.Picture(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("small_icons"), 20), 0, 0, 20, 16, 1.0, 0.0, true));

                    this.prgsProduction[i] = this.btnsProduction[i].AddChild(MonoInterface.Progress, new MonoInterface.Progress(0, 0, 0, 0, 45, 45, 0));
                }
                // ' Ð¤ÑÐµÐ¹Ð¼ Ð³Ð»Ð°Ð²Ð½Ð¾Ð³Ð¾ Ð¼ÐµÐ½Ñ

                this.frmMainMenu = this.MainContainer.AddChild(MonoInterface.Frame, ($t = new MonoInterface.Frame(0, 0, 74, 74, 0.0, 0.0, false), $t.LeftBorder = false, $t.TopBorder = false, $t));
                this.frmMainMenu.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor3(Bridge.fn.cacheBind(this, this.battleFrmMainMenu), 5, 0, 64, 64, 0.0, 0.5, true)).AddChild(MonoInterface.Picture, new MonoInterface.Picture(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("big_icons"), 1)));

                // ' Ð¤ÑÐµÐ¹Ð¼ ÑÐµÑÑÑÑÐ¾Ð² 
                this.frmResources = this.MainContainer.AddChild(MonoInterface.Frame, ($t = new MonoInterface.Frame(0, 0, 250, 70, 1.0, 0.0, false), $t.RightBorder = false, $t.TopBorder = false, $t.ShowAnimation = new MonoInterface.NumberAnimation("Y", -82, 0, 20), $t));
                this.btnTierUpFrmResources = this.frmResources.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor1(Bridge.fn.cacheBind(this, this.tierUpFrmResources_Clicked), Bridge.fn.cacheBind(this, this.tierUpFrmResources_Focused), Microsoft.Xna.Framework.Input.Keys.Enter, 5, 0, 60, 60, 0.0, 0.5, true));
                this.pctTierFrmResources = this.btnTierUpFrmResources.AddChild(MonoInterface.Picture, new MonoInterface.Picture(DarkKingdomCore.MyGame.unitPrms.getItem("Tier_2").$clone().iconApp.$clone(), 0, 0, 60, 60, 0.5, 0.5, true));

                this.frmResources.AddChild(MonoInterface.Picture, new MonoInterface.Picture(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("small_icons"), 12), -72, -17, 40, 32, 1.0, 0.5, true));
                this.frmResources.AddChild(MonoInterface.Picture, new MonoInterface.Picture(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("small_icons"), 13), -72, 15, 40, 32, 1.0, 0.5, true));

                this.lblGoldFrmResources = this.frmResources.AddChild(MonoInterface.Label, new MonoInterface.Label("", 20, this.moneyClr.$clone(), -115, -10, 1.0, 0.5, true));
                this.lblDeathFrmResources = this.frmResources.AddChild(MonoInterface.Label, new MonoInterface.Label("", 20, this.deathClr.$clone(), -115, 20, 1.0, 0.5, true));


                this.pctPauseFrmResources = this.frmResources.AddChild(MonoInterface.Button, new MonoInterface.Button.ctor(Bridge.fn.cacheBind(this, this.pauseFrmResources_Clicked), Microsoft.Xna.Framework.Input.Keys.Escape, -5, 0, 60, 60, 1.0, 0.5, true)).AddChild(MonoInterface.Picture, new MonoInterface.Picture(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("medium_icons"), 1), 0, 0, 60, 60, 0.5, 0.5, true));


                this.frmRightMenu = this.MainContainer.AddChild(MonoInterface.Frame, ($t = new MonoInterface.Frame(0, 0, 74, 74, 1.0, 0.0, false), $t.RightBorder = false, $t.TopBorder = false, $t));
                this.frmRightMenu.AddChild(MonoInterface.Button, new MonoInterface.Button.ctor(Bridge.fn.cacheBind(this, this.exitFrmMenuExit_Clicked), Microsoft.Xna.Framework.Input.Keys.Escape, 5, 0, 64, 64, 0.0, 0.5, true)).AddChild(MonoInterface.Picture, new MonoInterface.Picture(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("medium_icons"), 0), 0, 0, 64, 64, 0.5, 0.5, true));

                // ' Ð¤ÑÐµÐ¹Ð¼ ÑÑÐ°ÑÑÐ° Ð±Ð¸ÑÐ²Ñ
                this.frmBattle = this.MainContainer.AddChild(MonoInterface.Frame, ($t = new MonoInterface.Frame(0, 0, 450, 330, 0.5, 0.5, false), $t.ShowAnimation = new MonoInterface.NumberAnimation("Y", -300, 0, 50), $t.HideAnimation = new MonoInterface.NumberAnimation("Y", 0, 300, 50), $t));
                this.frmBattle.AddChild(MonoInterface.Label, new MonoInterface.Label("\u0411\u0438\u0442\u0432\u0430", 30, Microsoft.Xna.Framework.Color.Black.$clone(), 0, 7, 0.5, 0.0, true));
                this.frmBattle.AddChild(MonoInterface.Label, new MonoInterface.Label("VS", 20, Microsoft.Xna.Framework.Color.Black.$clone(), 0, 55, 0.5, 0.0, true));


                var ps1 = System.Array.init(((((this.races1.Count - 1) | 0) + 1) | 0), function (){
                    return new MonoInterface.Appearance();
                }, MonoInterface.Appearance);
                var ts1 = System.Array.init(((((this.races1.Count - 1) | 0) + 1) | 0), null, System.String);
                var ds1 = System.Array.init(((((this.races1.Count - 1) | 0) + 1) | 0), null, System.String);
                for (var i1 = 0; i1 < this.races1.Count; i1 = (i1 + 1) | 0) {
                    ps1[i1] = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("race_icons"), DarkKingdomCore.RaceManager.Instance.All.getItem(this.races1.getItem(i1)).symb);
                    ts1[i1] = DarkKingdomCore.RaceManager.Instance.All.getItem(this.races1.getItem(i1)).name;
                    ds1[i1] = DarkKingdomCore.RaceManager.Instance.All.getItem(this.races1.getItem(i1)).desc;
                }

                var ps2 = System.Array.init(((((this.races2.Count - 1) | 0) + 1) | 0), function (){
                    return new MonoInterface.Appearance();
                }, MonoInterface.Appearance);
                var ts2 = System.Array.init(((((this.races2.Count - 1) | 0) + 1) | 0), null, System.String);
                var ds2 = System.Array.init(((((this.races2.Count - 1) | 0) + 1) | 0), null, System.String);

                for (var i2 = 0; i2 < this.races2.Count; i2 = (i2 + 1) | 0) {
                    ps2[i2] = new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("race_icons"), DarkKingdomCore.RaceManager.Instance.All.getItem(this.races2.getItem(i2)).symb);
                    ts2[i2] = DarkKingdomCore.RaceManager.Instance.All.getItem(this.races2.getItem(i2)).name;
                    ds2[i2] = DarkKingdomCore.RaceManager.Instance.All.getItem(this.races2.getItem(i2)).desc;
                }

                this.races1SwitcherFrmBattle = this.frmBattle.AddChild(MonoInterface.Switcher, new MonoInterface.Switcher(ps1, ts1, ds1, 0, this.mainAnimator, -100, 60, 150, 100, 0.5, 0.0, true));
                this.races2SwitcherFrmBattle = this.frmBattle.AddChild(MonoInterface.Switcher, new MonoInterface.Switcher(ps2, ts2, ds2, 0, this.mainAnimator, 100, 60, 150, 100, 0.5, 0.0, true));

                var gameTypes = System.Array.init(["RandomGT", "StandartGT", "OffenceGT", "DefenceGT", "FirstHeroGT"], System.String);
                var gts = System.Array.init(gameTypes.length, null, System.String);
                var gdts = System.Array.init(gameTypes.length, null, System.String);
                for (var i3 = 0; i3 < gameTypes.length; i3 = (i3 + 1) | 0) {
                    gts[i3] = gameTypes[i3];
                    gdts[i3] = (gameTypes[i3] || "") + "Desc";
                }

                this.modeSwitcherFrmBattle = this.frmBattle.AddChild(MonoInterface.Switcher, new MonoInterface.Switcher(null, gts, gdts, 0, this.mainAnimator, 0, 170, 350, 100, 0.5, 0.0, true));
                this.frmBattle.AddChild(MonoInterface.Button, new MonoInterface.Button.ctor(Bridge.fn.cacheBind(this, this.btnStartBattle), Microsoft.Xna.Framework.Input.Keys.Enter, 0, -10, 150, 45, 0.5, 1.0, true)).AddChild(MonoInterface.Label, new MonoInterface.Label("\u0412\u043f\u0435\u0440\u0435\u0434", 20, Microsoft.Xna.Framework.Color.Black.$clone()));


                // 'Ð¤ÑÐµÐ¹Ð¼ Ð·Ð°ÑÐµÐ¼Ð½ÐµÐ½Ð¸Ñ 
                this.frmBack = this.MainContainer.AddChild(MonoInterface.Frame, ($t = new MonoInterface.Frame(0, 0, -1, -1, 0.5, 0.5, false), $t.ShowAnimation = new MonoInterface.NumberAnimation("Alpha", 0, 1, 0.05), $t.HideAnimation = new MonoInterface.NumberAnimation("Alpha", 1, 0, -0.05), $t));


                // ' Ð¤ÑÐµÐ¹Ð¼ Ð½Ð°ÑÑÑÐ¾ÐµÐº
                this.frmSettings = this.MainContainer.AddChild(MonoInterface.Frame, ($t = new MonoInterface.Frame(0, 0, 350, 200, 0.5, 0.5, false), $t.ShowAnimation = new MonoInterface.NumberAnimation("Y", -300, 0, 50, Bridge.fn.bind(this, function () {
                    this.frmBack.Show(this.mainAnimator);
                })), $t.HideAnimation = new MonoInterface.NumberAnimation("Y", 0, 300, 50, Bridge.fn.bind(this, function () {
                    this.frmBack.Hide(this.mainAnimator);
                })), $t));
                this.frmSettings.AddChild(MonoInterface.Label, new MonoInterface.Label("\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438", 30, Microsoft.Xna.Framework.Color.Black.$clone(), 0, 7, 0.5, 0.0, true));


                this.CreateScreenFormats();

                var sModes = System.Array.init(this.screenFormats.Count, null, System.String);
                for (var i4 = 0; i4 < this.screenFormats.Count; i4 = (i4 + 1) | 0) {
                    sModes[i4] = System.String.format("{0} x {1} : {2}", this.screenFormats.getItem(i4).$clone().X, this.screenFormats.getItem(i4).$clone().Y, this.screenFormats.getItem(i4).$clone().Z);
                }

                this.resSwitcherFrmSettings = this.frmSettings.AddChild(MonoInterface.Switcher, new MonoInterface.Switcher(null, sModes, null, 0, this.mainAnimator, 0, 40, 300, 100, 0.5, 0.0, true));

                this.frmSettings.AddChild(MonoInterface.Button, new MonoInterface.Button.ctor(Bridge.fn.cacheBind(this, this.backFrmSettings), Microsoft.Xna.Framework.Input.Keys.Escape, 10, -10, 150, 45, 0.0, 1.0, true)).AddChild(MonoInterface.Label, new MonoInterface.Label("\u041d\u0430\u0437\u0430\u0434", 20, Microsoft.Xna.Framework.Color.Black.$clone()));
                this.frmSettings.AddChild(MonoInterface.Button, new MonoInterface.Button.ctor(Bridge.fn.cacheBind(this, this.applyFrmSettings), Microsoft.Xna.Framework.Input.Keys.Enter, -10, -10, 150, 45, 1.0, 1.0, true)).AddChild(MonoInterface.Label, new MonoInterface.Label("\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c", 20, Microsoft.Xna.Framework.Color.Black.$clone()));

                // ' Ð¤ÑÐµÐ¹Ð¼ Ð¿Ð¾Ð³Ð¾ÑÐ¾Ð²ÐºÐ¸ Ðº Ð±Ð¾Ñ
                this.frmPreGame = this.MainContainer.AddChild(MonoInterface.Frame, ($t = new MonoInterface.Frame(0, 0, 500, 400, 0.5, 0.5, false), $t.ShowAnimation = new MonoInterface.NumberAnimation("Y", -300, 0, 50, Bridge.fn.bind(this, function () {
                    this.frmBack.Show(this.mainAnimator);
                })), $t.HideAnimation = new MonoInterface.NumberAnimation("Y", 0, 300, 50, Bridge.fn.bind(this, function () {
                    this.frmBack.Hide(this.mainAnimator);
                })), $t));

                this.lblVsPreGame = this.frmPreGame.AddChild(MonoInterface.Label, new MonoInterface.Label("", 20, Microsoft.Xna.Framework.Color.Black.$clone(), 0, 7, 0.5, 0.0, true));

                this.btnUnitsPreGame = this.frmPreGame.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor3(Bridge.fn.bind(this, function (btn, isTouch) {
                    this.cUnitsPreGame.Visible = true;
                    this.cSpellsPreGame.Visible = false;
                    this.cBuildingsPreGame.Visible = false;
                    this.btnUnitsPreGame.IsSelected = true;
                    this.btnSpellsPreGame.IsSelected = false;
                    this.btnBuildingsPreGame.IsSelected = false;
                }), -160, 60, 150, 45, 0.5, 0.0, true));
                this.btnUnitsPreGame.AddChild(MonoInterface.Label, new MonoInterface.Label("\u0421\u0443\u0449\u0435\u0441\u0442\u0432\u0430", 20, Microsoft.Xna.Framework.Color.Black.$clone()));

                this.btnSpellsPreGame = this.frmPreGame.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor3(Bridge.fn.bind(this, function (btn, isTouch) {
                    this.cUnitsPreGame.Visible = false;


                    this.cSpellsPreGame.Visible = true;

                    this.cBuildingsPreGame.Visible = false;
                    this.btnUnitsPreGame.IsSelected = false;
                    this.btnSpellsPreGame.IsSelected = true;
                    this.btnBuildingsPreGame.IsSelected = false;
                }), 0, 60, 150, 45, 0.5, 0.0, true));
                this.btnSpellsPreGame.AddChild(MonoInterface.Label, new MonoInterface.Label("\u0417\u0430\u043a\u043b\u0438\u043d\u0430\u043d\u0438\u044f", 20, Microsoft.Xna.Framework.Color.Black.$clone()));

                this.btnBuildingsPreGame = this.frmPreGame.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor3(Bridge.fn.bind(this, function (btn, isTouch) {
                    this.cUnitsPreGame.Visible = false;
                    this.cSpellsPreGame.Visible = false;
                    this.cBuildingsPreGame.Visible = true;
                    this.btnUnitsPreGame.IsSelected = false;
                    this.btnSpellsPreGame.IsSelected = false;
                    this.btnBuildingsPreGame.IsSelected = true;
                }), 160, 60, 150, 45, 0.5, 0.0, true));
                this.btnBuildingsPreGame.AddChild(MonoInterface.Label, new MonoInterface.Label("\u041f\u043e\u0441\u0442\u0440\u043e\u0439\u043a\u0438", 20, Microsoft.Xna.Framework.Color.Black.$clone()));


                this.cUnitsPreGame = this.frmPreGame.AddChild(MonoInterface.Grid, new MonoInterface.Grid(MonoInterface.Grid.Orientations.LeftToRight, -2, 120, 500, 100, 0.5, 0.0, false));
                this.cSpellsPreGame = this.frmPreGame.AddChild(MonoInterface.Grid, new MonoInterface.Grid(MonoInterface.Grid.Orientations.LeftToRight, -2, 120, 500, 100, 0.5, 0.0, false));
                this.cBuildingsPreGame = this.frmPreGame.AddChild(MonoInterface.Grid, new MonoInterface.Grid(MonoInterface.Grid.Orientations.LeftToRight, -2, 120, 500, 100, 0.5, 0.0, false));

                this.cSelectedPreGame = this.frmPreGame.AddChild(MonoInterface.Grid, new MonoInterface.Grid(MonoInterface.Grid.Orientations.LeftToRight, -2, -50, 500, 100, 0.5, 1.0, true));

                this.frmPreGame.AddChild(MonoInterface.Button, new MonoInterface.Button.ctor(Bridge.fn.cacheBind(this, this.backPreGame_Clicked), Microsoft.Xna.Framework.Input.Keys.Escape, 15, -10, 150, 45, 0.0, 1.0)).AddChild(MonoInterface.Label, new MonoInterface.Label("\u041d\u0430\u0437\u0430\u0434", 20, Microsoft.Xna.Framework.Color.Black.$clone()));
                this.frmPreGame.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor3(Bridge.fn.cacheBind(this, this.clearPreGame_Clicked), 0, -10, 150, 45, 0.5, 1.0, true)).AddChild(MonoInterface.Label, new MonoInterface.Label("\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c", 20, Microsoft.Xna.Framework.Color.Black.$clone()));
                this.btnFightPreGame = this.frmPreGame.AddChild(MonoInterface.Button, new MonoInterface.Button.ctor(Bridge.fn.cacheBind(this, this.fightPreGame_Clicked), Microsoft.Xna.Framework.Input.Keys.Enter, -15, -10, 150, 45, 1.0, 1.0));
                this.btnFightPreGame.AddChild(MonoInterface.Label, new MonoInterface.Label("\u0412 \u0431\u043e\u0439!", 20, Microsoft.Xna.Framework.Color.Black.$clone()));


                // Ð¤ÑÐµÐ¹Ð¼ Ð¿Ð¾Ð´ÑÐºÐ°Ð·ÐºÐ¸
                this.frmHelp = this.MainContainer.AddChild(MonoInterface.Frame, new MonoInterface.Frame(0, 0, 250, 0, 0.0, 0.0));

                // ÐÐ°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº, Ð·Ð½Ð°ÑÐ¾Ðº Ð¸ Ð¿Ð¾Ð´Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº
                this.lblUnitNameHelpUnit = this.frmHelp.AddChild(MonoInterface.Label, new MonoInterface.Label("\u0422\u0438\u0433\u0440", 14, Microsoft.Xna.Framework.Color.Black.$clone(), 0, 0, 0.0, 0.0, true));
                this.lblRaceHelpUnit = this.frmHelp.AddChild(MonoInterface.Label, new MonoInterface.Label("\u0422\u0438\u0433\u0440", 12, Microsoft.Xna.Framework.Color.Black.$clone(), 0, 23, 0.0, 0.0, true));

                // Ð¡ÑÐ¾Ð¸Ð¼Ð¾ÑÑÑ
                this.lblCostMoneyHelpUnit = this.frmHelp.AddChild(MonoInterface.Label, new MonoInterface.Label("\u0422\u0438\u0433\u0440", 12, Microsoft.Xna.Framework.Color.Black.$clone(), 20, 43, 0.0, 0.0, true));
                this.lblCostDeathHelpUnit = this.frmHelp.AddChild(MonoInterface.Label, new MonoInterface.Label("\u0422\u0438\u0433\u0440", 12, Microsoft.Xna.Framework.Color.Black.$clone(), 70, 43, 0.0, 0.0, true));
                this.frmHelp.AddChild(MonoInterface.Picture, new MonoInterface.Picture(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("small_icons"), 12), 0, 42, 0, 0, 0.0, 0.0, true));
                this.frmHelp.AddChild(MonoInterface.Picture, new MonoInterface.Picture(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("small_icons"), 13), 50, 42, 0, 0, 0.0, 0.0, true));

                this.cBattleParameters = this.frmHelp.AddChild(MonoInterface.Container, new MonoInterface.Container(0, 65, 250, 60, 0.0, 0.0, true));
                this.lblAttackBasicParams = this.cBattleParameters.AddChild(MonoInterface.Label, new MonoInterface.Label("\u0422\u0438\u0433\u0440", 12, Microsoft.Xna.Framework.Color.Black.$clone(), 20, 0, 0.0, 0.0, true));
                this.pctAttackBasicParams = this.cBattleParameters.AddChild(MonoInterface.Picture, new MonoInterface.Picture(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("small_icons"), 1), 0, 0, 0, 0, 0.0, 0.0, true));
                for (var i5 = 0; i5 <= 2; i5 = (i5 + 1) | 0) {
                    this.lblsBasicParams[i5] = this.cBattleParameters.AddChild(MonoInterface.Label, new MonoInterface.Label("\u0422\u0438\u0433\u0440", 12, Microsoft.Xna.Framework.Color.Black.$clone(), ((20 + Bridge.Int.mul(100, (i5 % 2))) | 0), ((22 + Bridge.Int.mul((((Bridge.Int.div(i5, 2)) | 0)), 22)) | 0), 0.0, 0.0, true));
                    this.cBattleParameters.AddChild(MonoInterface.Picture, new MonoInterface.Picture(new MonoInterface.Appearance.$ctor1(DarkKingdomCore.MyGame.sprites.getItem("small_icons"), ((i5 + 3) | 0)), Bridge.Int.mul(100, (i5 % 2)), ((22 + Bridge.Int.mul((((Bridge.Int.div(i5, 2)) | 0)), 22)) | 0), 0, 0, 0.0, 0.0, true));
                }

                for (var i6 = 0; i6 <= 5; i6 = (i6 + 1) | 0) {
                    this.lblsAbils[i6] = this.frmHelp.AddChild(MonoInterface.LongLabel, new MonoInterface.LongLabel("\u0422\u0438\u0433\u0440", 10, Microsoft.Xna.Framework.Color.Black.$clone(), 0, 140, 250, 0.0, 0.0, true));
                }


                // ' Ð¤ÑÐµÐ¹Ð¼ Ð±Ð¾ÐµÐ²Ð¾Ð³Ð¾ Ð¼ÐµÐ½Ñ
                this.frmBattleMenu = this.MainContainer.AddChild(MonoInterface.Frame, ($t = new MonoInterface.Frame(0, 0, 270, 310, 0.5, 0.5, false), $t.ShowAnimation = new MonoInterface.NumberAnimation("Y", -300, 0, 50, Bridge.fn.bind(this, function () {
                    if (this.frmBack.Visible) {
                        this.mainAnimator.Animations.remove(this.frmBack.HideAnimation);
                    } else {
                        this.frmBack.Show(this.mainAnimator);
                    }
                })), $t.HideAnimation = new MonoInterface.NumberAnimation("Y", 0, 300, 50, Bridge.fn.bind(this, function () {
                    this.frmBack.Hide(this.mainAnimator);
                })), $t));
                this.frmBattleMenu.AddChild(MonoInterface.Label, new MonoInterface.Label("\u041f\u0430\u0443\u0437\u0430", 30, Microsoft.Xna.Framework.Color.Black.$clone(), 0, 7, 0.5, 0.0, true));

                this.frmBattleMenu.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor3(Bridge.fn.cacheBind(this, this.surrenderFrmBattleMenu_Clicked), 0, 60, 250, 45, 0.5, 0.0, true)).AddChild(MonoInterface.Label, new MonoInterface.Label("\u0421\u0434\u0430\u0442\u044c\u0441\u044f", 20, Microsoft.Xna.Framework.Color.Black.$clone()));
                this.frmBattleMenu.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor3(Bridge.fn.cacheBind(this, this.restartFrmBattleMenu_Clicked), 0, 120, 250, 45, 0.5, 0.0, true)).AddChild(MonoInterface.Label, new MonoInterface.Label("\u041f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c", 20, Microsoft.Xna.Framework.Color.Black.$clone()));
                this.lblAIFrmBattleMenu = this.frmBattleMenu.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor3(Bridge.fn.cacheBind(this, this.AIFrmBattleMenu_Clicked), 0, 180, 250, 45, 0.5, 0.0, true)).AddChild(MonoInterface.Label, new MonoInterface.Label("\u041f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043d\u0430 \u0418\u0418", 20, Microsoft.Xna.Framework.Color.Black.$clone()));
                this.frmBattleMenu.AddChild(MonoInterface.Button, new MonoInterface.Button.ctor(Bridge.fn.cacheBind(this, this.backFrmBattleMenu_Clicked), Microsoft.Xna.Framework.Input.Keys.Escape, 0, 250, 225, 45, 0.5, 0.0, true)).AddChild(MonoInterface.Label, new MonoInterface.Label("\u041d\u0430\u0437\u0430\u0434 \u0432 \u0438\u0433\u0440\u0443", 20, Microsoft.Xna.Framework.Color.Black.$clone()));

                // ' Ð¤ÑÐµÐ¹Ð¼ Ð´Ð¸Ð°Ð»Ð¾Ð³Ð° Ð·Ð°Ð²ÐµÑÑÐµÐ½Ð¸Ñ Ð±Ð¾Ñ
                this.frmDialog = this.MainContainer.AddChild(MonoInterface.Frame, ($t = new MonoInterface.Frame(0, 0, 375, 180, 0.5, 0.5, false), $t.ShowAnimation = new MonoInterface.NumberAnimation("Y", -300, 0, 50, Bridge.fn.bind(this, function () {
                    if (this.frmBack.Visible) {
                        this.mainAnimator.Animations.remove(this.frmBack.HideAnimation);
                    } else {
                        this.frmBack.Show(this.mainAnimator);
                    }
                })), $t.HideAnimation = new MonoInterface.NumberAnimation("Y", 0, 300, 50, Bridge.fn.bind(this, function () {
                    this.frmBack.Hide(this.mainAnimator);
                })), $t));
                this.lblTitlefrmDialog = this.frmDialog.AddChild(MonoInterface.Label, new MonoInterface.Label("", 30, Microsoft.Xna.Framework.Color.Black.$clone(), 0, 7, 0.5, 0.0, true));

                this.lblLine1FrmDialog = this.frmDialog.AddChild(MonoInterface.Label, new MonoInterface.Label("", 20, Microsoft.Xna.Framework.Color.Black.$clone(), 0, 50, 0.5, 0.0, true));
                this.lblLine2FrmDialog = this.frmDialog.AddChild(MonoInterface.Label, new MonoInterface.Label("", 20, Microsoft.Xna.Framework.Color.Black.$clone(), 0, 70, 0.5, 0.0, true));

                this.frmDialog.AddChild(MonoInterface.Button, new MonoInterface.Button.$ctor3(Bridge.fn.cacheBind(this, this.okayFrmDialog_Clicked), 0, -15, 150, 45, 0.5, 1.0, true)).AddChild(MonoInterface.Label, new MonoInterface.Label("\u0412 \u043c\u0435\u043d\u044e", 20, Microsoft.Xna.Framework.Color.Black.$clone()));

                // ' Ð¤ÑÐµÐ¹Ð¼ Ð¿Ð¾Ð´ÑÐ²ÐµÑÐ¶Ð´ÐµÐ½Ð¸Ñ
                this.frmConfirm = this.MainContainer.AddChild(MonoInterface.Frame, ($t = new MonoInterface.Frame(0, 0, 375, 150, 0.5, 0.5, false), $t.ShowAnimation = new MonoInterface.NumberAnimation("Y", -300, 0, 50, Bridge.fn.bind(this, function () {
                    if (this.frmBack.Visible) {
                        this.mainAnimator.Animations.remove(this.frmBack.HideAnimation);
                    } else {
                        this.frmBack.Show(this.mainAnimator);
                    }
                })), $t.HideAnimation = new MonoInterface.NumberAnimation("Y", 0, 300, 50, Bridge.fn.bind(this, function () {
                    this.frmBack.Hide(this.mainAnimator);
                })), $t));
                this.frmConfirm.AddChild(MonoInterface.Label, new MonoInterface.Label("\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b", 30, Microsoft.Xna.Framework.Color.Black.$clone(), 0, 7, 0.5, 0.0, true));


                this.lblTextFrmConfirm = this.frmConfirm.AddChild(MonoInterface.Label, new MonoInterface.Label("", 20, Microsoft.Xna.Framework.Color.Black.$clone(), 0, 50, 0.5, 0.0, true));

                this.frmConfirm.AddChild(MonoInterface.Button, new MonoInterface.Button.ctor(Bridge.fn.bind(this, function (btn, isTouch) {
                    this.frmConfirm.Hide(this.mainAnimator);
                    this.taskConfirm != null ? this.taskConfirm.setResult(true) : null;
                }), Microsoft.Xna.Framework.Input.Keys.Enter, 15, -10, 150, 45, 0.0, 1.0)).AddChild(MonoInterface.Label, new MonoInterface.Label("\u0414\u0430", 20, Microsoft.Xna.Framework.Color.Black.$clone()));

                this.frmConfirm.AddChild(MonoInterface.Button, new MonoInterface.Button.ctor(Bridge.fn.bind(this, function (btn, isTouch) {
                    this.frmConfirm.Hide(this.mainAnimator);
                    this.taskConfirm != null ? this.taskConfirm.setResult(false) : null;
                }), Microsoft.Xna.Framework.Input.Keys.Escape, -15, -10, 150, 45, 1.0, 1.0)).AddChild(MonoInterface.Label, new MonoInterface.Label("\u041d\u0435\u0442", 20, Microsoft.Xna.Framework.Color.Black.$clone()));

                this.MainContainer.ApplyTheme(this.defaultTheme);
                this.MainContainer.ApplyLocalization(this.localize);
                this.frmBack.ApplyTheme(this.backTheme);
            },
            backPreGame_Clicked: function (btn, isTouch) {
                DarkKingdomCore.MyGame.gState = DarkKingdomCore.GameState.MainMenu;
                this.StartBattle();
            },
            clearPreGame_Clicked: function (btn, isTouch) {
                this.preGameUnits.clear();
                this.preGameSpells.clear();
                this.preGameBonus.clear();
                this.SetPreGameLists();
            },
            fightPreGame_Clicked: function (btn, isTouch) {
                this.frmPreGame.Hide(this.mainAnimator);
                this.StartPlaying();
            },
            backFrmSettings: function (btn, isTouch) {
                this.frmSettings.Hide(this.mainAnimator);
            },
            applyFrmSettings: function (btn, isTouch) {
                this.frmSettings.Hide(this.mainAnimator);
                var uiScale = this.screenFormats.getItem(this.resSwitcherFrmSettings.Current).$clone().X / 800.0;
                if (uiScale <= 1.25) {
                    uiScale = 1.0;
                } else {
                    if (uiScale > 1.25 && uiScale <= 1.75) {
                        uiScale = 1.5;
                    } else {
                        uiScale = 2.0;
                    }
                }
                this.Resize(Bridge.Int.clip32(this.screenFormats.getItem(this.resSwitcherFrmSettings.Current).$clone().X), Bridge.Int.clip32(this.screenFormats.getItem(this.resSwitcherFrmSettings.Current).$clone().Y), this.resSwitcherFrmSettings.Current === 2, uiScale);
            },
            CreateScreenFormats: function () {
                // = {New Vector2(800, 480), New Vector2(1366, 768), New Vector2(1920, 1080)}
                this.screenFormats = new (System.Collections.Generic.List$1(Microsoft.Xna.Framework.Vector3)).ctor();
                // For Each format In GraphicsAdapter.DefaultAdapter.SupportedDisplayModes
                // screenFormats.Add(New Vector3(format.Width, format.Height, format.RefreshRate))
                // Next
                this.screenFormats.AddRange(System.Array.init([new Microsoft.Xna.Framework.Vector3.$ctor3(800, 480, 60), new Microsoft.Xna.Framework.Vector3.$ctor3(1366, 768, 60), new Microsoft.Xna.Framework.Vector3.$ctor3(1920, 1080, 60)], Microsoft.Xna.Framework.Vector3));
            },
            GetUnitParametersFromID: function (id) {
                var $t;
                $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.unitPrms.Values);
                try {
                    while ($t.moveNext()) {
                        var up = $t.Current.$clone();
                        if (up.id === id) {
                            return up.$clone();
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                return null;
            },
            OnUnitsAbils: function (u) {
                var $t, $t1, $t2, $t3, $t4, $t5, $t6, $t7, $t8, $t9, $t10, $t11, $t12, $t13, $t14, $t15, $t16, $t17, $t18, $t19, $t20, $t21;
                $t = Bridge.getEnumerator(u.abils.Values);
                try {
                    while ($t.moveNext()) {
                        var abil = $t.Current;
                        if (abil.condCompleted && !abil.used) {
                            if (Bridge.referenceEquals(abil.name, "Rush")) {
                                ($t1 = DarkKingdomCore.MyGame.plrs[u.owner]).rushBonus = ($t1.rushBonus + abil.value) | 0;
                                abil.used = true;
                            } else if (Bridge.referenceEquals(abil.name, "Kill_flyer")) {
                                var uu = this.FindRandomFlyUnit(((1 - u.owner) | 0), 500);
                                if (uu != null) {
                                    this.Kill(uu);
                                    this.ShowInfoPar("\u0423\u043d\u0438\u0447\u0442\u043e\u0436\u0435\u043d", DarkKingdomCore.MyGame.badAbilClr.$clone(), uu.x, ((DarkKingdomCore.MyGame.hor + uu.parameters.rect.Top) | 0), true);
                                }
                                abil.used = true;
                            } else if (Bridge.referenceEquals(abil.name, "Magic_bonus")) {
                                ($t2 = DarkKingdomCore.MyGame.plrs[u.owner]).magicIncBonus = ($t2.magicIncBonus + abil.value) | 0;
                            } else if (Bridge.referenceEquals(abil.name, "Poison_bonus")) {
                                ($t3 = DarkKingdomCore.MyGame.plrs[u.owner]).poisonBonus = ($t3.poisonBonus + abil.value) | 0;
                            } else if (Bridge.referenceEquals(abil.name, "Stealing")) {
                                ($t4 = DarkKingdomCore.MyGame.plrs[((1 - u.owner) | 0)]).moneyIncBonus = ($t4.moneyIncBonus - 10) | 0;
                                ($t5 = DarkKingdomCore.MyGame.plrs[u.owner]).moneyIncBonus = ($t5.moneyIncBonus + 10) | 0;
                            } else if (Bridge.referenceEquals(abil.name, "Chaos")) {
                                if (!u.AbsContains("Chaos helper")) {
                                    var avunits = new (System.Collections.Generic.List$1(System.String)).ctor();
                                    $t6 = Bridge.getEnumerator(DarkKingdomCore.MyGame.plrs[((1 - u.owner) | 0)].unitsList);
                                    try {
                                        while ($t6.moveNext()) {
                                            var uu1 = $t6.Current;
                                            if (!DarkKingdomCore.MyGame.plrs[((1 - u.owner) | 0)].banned.contains(uu1)) {
                                                avunits.add(uu1);
                                            }
                                        }
                                    } finally {
                                        if (Bridge.is($t6, System.IDisposable)) {
                                            $t6.System$IDisposable$Dispose();
                                        }
                                    }
                                    if (avunits.Count > 0) {
                                        u.AddAbility(new DarkKingdomCore.Ability("Chaos helper", DarkKingdomCore.MyGame.unitPrms.getItem(avunits.getItem(DarkKingdomCore.MyGame.rnd.Next$1(avunits.Count))).$clone().id, "", 0, DarkKingdomCore.EffectType.Normal, false));
                                    }
                                }
                            } else if (Bridge.referenceEquals(abil.name, "Chaos helper")) {
                                var unit_parameters = this.GetUnitParametersFromID(abil.value);
                                if (System.Nullable.hasValue(unit_parameters)) {
                                    DarkKingdomCore.MyGame.plrs[((1 - u.owner) | 0)].banned.add(System.Nullable.getValue(unit_parameters).Name);
                                }
                            } else if (Bridge.referenceEquals(abil.name, "Publican")) {
                                ($t7 = DarkKingdomCore.MyGame.plrs[u.owner]).moneyIncBonus = ($t7.moneyIncBonus + Bridge.Int.mul(5, DarkKingdomCore.MyGame.plrs[u.owner].unitCount)) | 0;
                            } else if (Bridge.referenceEquals(abil.name, "Block prod")) {
                                DarkKingdomCore.MyGame.plrs[0].prdSpd = 0;
                                DarkKingdomCore.MyGame.plrs[1].prdSpd = 0;
                            } else if (Bridge.referenceEquals(abil.name, "Ignore_units")) {
                                u.parameters.isIgnoreUnits = true;
                            } else if (Bridge.referenceEquals(abil.name, "Takeoff")) {
                                if (u.parameters.moveType === DarkKingdomCore.UnitMoveType.GroundMT) {
                                    u.takedOff = true;
                                }
                                u.abils.getItem("Takeoff").used = true;
                            } else if (Bridge.referenceEquals(abil.name, "Landing")) {
                                if (u.parameters.moveType === DarkKingdomCore.UnitMoveType.FlyingMT) {
                                    u.landing = true;
                                }
                                u.abils.getItem("Landing").used = true;
                            } else if (Bridge.referenceEquals(abil.name, "Elite_archer")) {
                                $t8 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                                try {
                                    while ($t8.moveNext()) {
                                        var uu2 = $t8.Current;
                                        if (!Bridge.referenceEquals(u, uu2)) {
                                            if (uu2.owner === u.owner) {
                                                if (uu2.parameters.Attack.Range > 1) {
                                                    ($t9 = uu2.atkMod.$clone()).Range = ($t9.Range + 1) | 0;
                                                }
                                            }
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t8, System.IDisposable)) {
                                        $t8.System$IDisposable$Dispose();
                                    }
                                }
                            } else if (Bridge.referenceEquals(abil.name, "Kill all")) {
                                $t10 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                                try {
                                    while ($t10.moveNext()) {
                                        var uu3 = $t10.Current;
                                        if (!uu3.parameters.isBuilding) {
                                            this.Kill(uu3);
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t10, System.IDisposable)) {
                                        $t10.System$IDisposable$Dispose();
                                    }
                                }
                                this.globalExplode = 255;
                            } else if (Bridge.referenceEquals(abil.name, "Big_boom")) {
                                $t11 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                                try {
                                    while ($t11.moveNext()) {
                                        var uu4 = $t11.Current;
                                        this.Harm(uu4, DarkKingdomCore.MyGame.rnd.Next$2(1000, 2000), false, DarkKingdomCore.EffectType.Normal);
                                        this.Poison(uu4);
                                    }
                                } finally {
                                    if (Bridge.is($t11, System.IDisposable)) {
                                        $t11.System$IDisposable$Dispose();
                                    }
                                }
                                this.globalExplode = 255;
                            } else if (Bridge.referenceEquals(abil.name, "Range_bonus")) {
                                ($t12 = u.atkMod.$clone()).Range = ($t12.Range + abil.value) | 0;
                            } else if (Bridge.referenceEquals(abil.name, "Prod_boost")) {
                                DarkKingdomCore.MyGame.plrs[u.owner].prdSpd *= (1 + abil.value / 100);
                            } else if (Bridge.referenceEquals(abil.name, "Time_control")) {
                                $t13 = Bridge.getEnumerator(DarkKingdomCore.MyGame.plrs);
                                try {
                                    while ($t13.moveNext()) {
                                        var p = $t13.Current;
                                        p.prdSpd /= 2;
                                    }
                                } finally {
                                    if (Bridge.is($t13, System.IDisposable)) {
                                        $t13.System$IDisposable$Dispose();
                                    }
                                }
                            } else if (Bridge.referenceEquals(abil.name, "Centaur_prod_boost")) {
                                $t14 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                                try {
                                    while ($t14.moveNext()) {
                                        var uu5 = $t14.Current;
                                        if (uu5.owner === u.owner && ((uu5.owner === 0 && uu5.x >= ((Bridge.Int.div(DarkKingdomCore.MyGame.gameWidth, 2)) | 0)) || (uu5.owner === 1 && uu5.x <= ((Bridge.Int.div(DarkKingdomCore.MyGame.gameWidth, 2)) | 0)))) {
                                            DarkKingdomCore.MyGame.plrs[u.owner].prdSpd *= (1 + abil.value / 100);
                                            break;
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t14, System.IDisposable)) {
                                        $t14.System$IDisposable$Dispose();
                                    }
                                }
                            } else if (Bridge.referenceEquals(abil.name, "Slow_production")) {
                                DarkKingdomCore.MyGame.plrs[((1 - u.owner) | 0)].prdSpd /= 1.5;
                            } else if (Bridge.referenceEquals(abil.name, "Recharge")) {
                                $t15 = Bridge.getEnumerator(u.abils.Values);
                                try {
                                    while ($t15.moveNext()) {
                                        var aa = $t15.Current;
                                        if (aa.used === true) {
                                            aa.used = false;
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t15, System.IDisposable)) {
                                        $t15.System$IDisposable$Dispose();
                                    }
                                }
                                this.ShowInfoPar("\u041f\u0435\u0440\u0435\u0437\u0430\u0440\u044f\u0434\u043a\u0430!", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                                u.abils.getItem("Recharge").used = true;
                            } else if (Bridge.referenceEquals(abil.name, "Lycanthropy")) {
                                var new_unit_parameters = this.GetUnitParametersFromID(abil.value);
                                if (System.Nullable.hasValue(new_unit_parameters)) {
                                    var oldmaxhp = u.parameters.maxhp;
                                    var oldname = u.parameters.Name;
                                    u.SetParams(System.Nullable.getValue(new_unit_parameters).$clone(), false);
                                    u.hp *= (Bridge.Int.div(u.parameters.maxhp, oldmaxhp)) | 0;
                                    this.ShowInfoPar("\u041b\u0438\u043a\u0430\u043d\u0442\u0440\u043e\u043f\u0438\u044f", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                                } else {
                                    this.ShowInfoPar(System.String.format("Wrong unit id - {0}", [abil.value]), DarkKingdomCore.MyGame.badAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                                }
                            } else if (Bridge.referenceEquals(abil.name, "Invulnerable")) {
                                if (Bridge.referenceEquals(u.shownAbil, "")) {
                                    u.shownAbil = "Invulnerable";
                                    u.shownAbilMaxVal = abil.value;
                                }
                                abil.value = (abil.value - 1) | 0;
                                if (abil.value === 0) {
                                    u.abils.getItem("Invulnerable").used = true;
                                    u.shownAbil = "";
                                }
                            } else if (Bridge.referenceEquals(abil.name, "Poison_around")) {
                                $t16 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                                try {
                                    while ($t16.moveNext()) {
                                        var uu6 = $t16.Current;
                                        if (!Bridge.referenceEquals(uu6, u) && u.Near(uu6)) {
                                            this.Poison(uu6);
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t16, System.IDisposable)) {
                                        $t16.System$IDisposable$Dispose();
                                    }
                                }
                            } else if (Bridge.referenceEquals(abil.name, "Generate")) {
                                var new_unit_parameters1 = this.GetUnitParametersFromID(abil.value);
                                if (System.Nullable.hasValue(new_unit_parameters1)) {
                                    this.bornList.add(new DarkKingdomCore.Unit(this, u.x, u.moveside, u.owner, System.Nullable.getValue(new_unit_parameters1).$clone()));
                                }
                            } else if (Bridge.referenceEquals(abil.name, "Generate enemy")) {
                                var unit_parameters1 = this.GetUnitParametersFromID(abil.value);
                                if (System.Nullable.hasValue(unit_parameters1)) {
                                    this.bornList.add(new DarkKingdomCore.Unit(this, u.x, DarkKingdomCore.MyGame.plrs[((1 - u.owner) | 0)].moveside, ((1 - u.owner) | 0), System.Nullable.getValue(unit_parameters1).$clone()));
                                }
                            } else if (Bridge.referenceEquals(abil.name, "Summon_ihor")) {
                                this.bornList.add(new DarkKingdomCore.Unit(this, u.x, u.moveside, u.owner, DarkKingdomCore.MyGame.unitPrms.getItem("Ihor").$clone()));
                                this.bornList.add(new DarkKingdomCore.Unit(this, u.x - Bridge.Int.mul(u.moveside, this.us2), u.moveside, u.owner, DarkKingdomCore.MyGame.unitPrms.getItem("Ihor").$clone()));
                                this.ShowInfoPar("\u0420\u0430\u0441\u043f\u0430\u0434", DarkKingdomCore.MyGame.goodAbilClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                            } else if (Bridge.referenceEquals(abil.name, "Summon_centaur")) {
                                var avunits1 = new (System.Collections.Generic.List$1(System.String)).ctor();
                                $t17 = Bridge.getEnumerator(DarkKingdomCore.MyGame.unitPrms.Values);
                                try {
                                    while ($t17.moveNext()) {
                                        var uu7 = $t17.Current.$clone();
                                        if (Bridge.referenceEquals(uu7.Subrace, "Centaur") && !(Bridge.referenceEquals(uu7.Name, u.parameters.Name))) {
                                            avunits1.add(uu7.Name);
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t17, System.IDisposable)) {
                                        $t17.System$IDisposable$Dispose();
                                    }
                                }
                                this.bornList.add(new DarkKingdomCore.Unit(this, u.x + Bridge.Int.mul(2, u.moveside), u.moveside, u.owner, DarkKingdomCore.MyGame.unitPrms.getItem(avunits1.getItem(DarkKingdomCore.MyGame.rnd.Next$1(avunits1.Count))).$clone()));
                                abil.used = true;
                            } else if (Bridge.referenceEquals(abil.name, "Economy")) {
                                ($t18 = DarkKingdomCore.MyGame.plrs[u.owner].res.$clone()).Money = ($t18.Money + ((Bridge.Int.div(u.parameters.Cost.Money, 2)) | 0)) | 0;
                                this.ShowInfoPar(System.String.format("+{0}", [((Bridge.Int.div(u.parameters.Cost.Money, 2)) | 0)]), this.moneyClr.$clone(), u.x, ((DarkKingdomCore.MyGame.hor + u.parameters.rect.Top) | 0), true);
                            } else if (Bridge.referenceEquals(abil.name, "Levitation_around")) {
                                $t19 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                                try {
                                    while ($t19.moveNext()) {
                                        var uu8 = $t19.Current;
                                        if (uu8.owner !== u.owner && u.Near(uu8) && uu8.parameters.moveType === DarkKingdomCore.UnitMoveType.GroundMT && !uu8.parameters.isBuilding) {
                                            uu8.takedOff = true;
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t19, System.IDisposable)) {
                                        $t19.System$IDisposable$Dispose();
                                    }
                                }
                            } else if (Bridge.referenceEquals(abil.name, "Heal_demons")) {
                                $t20 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                                try {
                                    while ($t20.moveNext()) {
                                        var uu9 = $t20.Current;
                                        if (!Bridge.referenceEquals(u, uu9) && u.owner === uu9.owner && Bridge.referenceEquals(uu9.parameters.Race, "Demons") && !uu9.parameters.isBuilding) {
                                            this.Heal(uu9, DarkKingdomCore.MyGame.rnd.Next$2(40, 51));
                                            uu9.Attack = DarkKingdomCore.Attack.op_Addition$1(uu9.Attack.$clone(), 3);
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t20, System.IDisposable)) {
                                        $t20.System$IDisposable$Dispose();
                                    }
                                }
                            } else if (Bridge.referenceEquals(abil.name, "Explosive")) {
                                this.Explode(u, u.AbsContains("Mage"));
                            } else if (Bridge.referenceEquals(abil.name, "Invisible")) {
                                $t21 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                                try {
                                    while ($t21.moveNext()) {
                                        var uu10 = $t21.Current;
                                        if (uu10.owner !== u.owner && u.Near(uu10)) {
                                            this.Deinvisible(u);
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t21, System.IDisposable)) {
                                        $t21.System$IDisposable$Dispose();
                                    }
                                }
                            } else if (Bridge.referenceEquals(abil.name, "Clear_mind")) {
                                var uu11 = this.FindRandomUnflyUnit(((1 - u.owner) | 0));
                                if (uu11 != null) {
                                    uu11.purified = true;
                                    u.abils.getItem("Clear_mind").used = true;
                                }
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            }
        }
    });

    Bridge.define("DarkKingdomCore.ParType", {
        $kind: "enum",
        statics: {
            fields: {
                Point: 0,
                Text: 1,
                Image: 2
            }
        }
    });

    Bridge.define("DarkKingdomCore.Player", {
        fields: {
            id: 0,
            moveside: 0,
            baseX: 0,
            hero: null,
            heroUnit: null,
            res: null,
            race: null,
            AI: false,
            curAIVal: 0,
            maxAIVal: 0,
            uCount: 0,
            startInco: 0,
            magicIncBonus: 0,
            moneyIncBonus: 0,
            ipt: 0,
            resDelay: 0,
            symb: 0,
            unitsList: null,
            spllsList: null,
            bonusList: null,
            readyUnits: null,
            prdQ: null,
            prdPrg: 0,
            prdSpd: 0,
            statDeaths: 0,
            castleFileName: null,
            poisonBonus: 0,
            victimcount: 0,
            banned: null,
            spellsRchrg: null,
            rushBonus: 0,
            game: null,
            aidefencestreak: 0,
            aisupportstreak: 0,
            prodsupport: false
        },
        props: {
            unitCount: {
                get: function () {
                    return this.uCount;
                },
                set: function (value) {
                    this.uCount = value;
                }
            },
            Resources: {
                get: function () {
                    return this.res.$clone();
                },
                set: function (value) {
                    this.res = value.$clone();
                }
            }
        },
        ctors: {
            init: function () {
                this.res = new DarkKingdomCore.TimeCost();
                this.race = "";
                this.resDelay = 450;
                this.unitsList = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.spllsList = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.bonusList = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.readyUnits = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.prdQ = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.statDeaths = 0;
                this.castleFileName = "hqs";
                this.banned = new (System.Collections.Generic.List$1(System.String)).ctor();
            },
            ctor: function (game, i, a, aitick) {
                this.$initialize();
                this.game = game;
                this.id = i;
                this.AI = a;
                this.res.Tier = 1;
                this.curAIVal = aitick;
                this.maxAIVal = aitick;
            }
        },
        methods: {
            Reset: function (cond) {
                if (this.id === 0) {
                    this.Resources = cond.res1.$clone();
                } else {
                    this.Resources = cond.res2.$clone();
                }
                this.res.Tier = cond.res1.Tier;
                this.startInco = cond.income;
                this.ipt = cond.ipt;
                this.unitCount = 0;
                this.prdQ.clear();
                this.readyUnits.clear();
                this.prdPrg = 0;
                this.statDeaths = 0;
                this.resDelay = 450;
                this.victimcount = 0;
                this.banned.clear();
                this.spellsRchrg = new (System.Collections.Generic.List$1(System.Single)).ctor();
                this.rushBonus = 0;
            },
            hasUnit: function (name) {
                var $t;
                $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                try {
                    while ($t.moveNext()) {
                        var u = $t.Current;
                        if (u.owner === this.id && Bridge.referenceEquals(u.parameters.Name, name)) {
                            return true;
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                return false;
            },
            CheckForProduce: function (name) {
                return ((this.prdQ.Count + this.readyUnits.Count) | 0) < 7 && this.res.EnoughFor(DarkKingdomCore.MyGame.unitPrms.getItem(name).$clone().Cost.$clone()) && this.CheckForLimit(name) && !this.banned.contains(name);
            },
            CheckForLimit: function (name) {
                var $t, $t1, $t2, $t3, $t4, $t5;
                if (DarkKingdomCore.MyGame.unitPrms.getItem(name).$clone().isHeroic) {
                    var tmp = 0;
                    $t = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                    try {
                        while ($t.moveNext()) {
                            var u = $t.Current;
                            if (u.owner === this.id && u.parameters.isHeroic) {
                                tmp = (tmp + 1) | 0;
                            }
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                    $t1 = Bridge.getEnumerator(this.prdQ);
                    try {
                        while ($t1.moveNext()) {
                            var u1 = $t1.Current;
                            if (DarkKingdomCore.MyGame.unitPrms.getItem(u1).$clone().isHeroic) {
                                tmp = (tmp + 1) | 0;
                            }
                        }
                    } finally {
                        if (Bridge.is($t1, System.IDisposable)) {
                            $t1.System$IDisposable$Dispose();
                        }
                    }
                    $t2 = Bridge.getEnumerator(this.readyUnits);
                    try {
                        while ($t2.moveNext()) {
                            var u2 = $t2.Current;
                            if (Bridge.referenceEquals(u2, name)) {
                                tmp = (tmp + 1) | 0;
                            }
                        }
                    } finally {
                        if (Bridge.is($t2, System.IDisposable)) {
                            $t2.System$IDisposable$Dispose();
                        }
                    }
                    return tmp === 0;
                } else if (DarkKingdomCore.MyGame.unitPrms.getItem(name).$clone().maxLimit === 0) {
                    return true;
                } else {
                    var tmp1 = 0;
                    $t3 = Bridge.getEnumerator(DarkKingdomCore.MyGame.units);
                    try {
                        while ($t3.moveNext()) {
                            var u3 = $t3.Current;
                            if (u3.owner === this.id && Bridge.referenceEquals(u3.parameters.Name, name)) {
                                tmp1 = (tmp1 + 1) | 0;
                            }
                        }
                    } finally {
                        if (Bridge.is($t3, System.IDisposable)) {
                            $t3.System$IDisposable$Dispose();
                        }
                    }
                    $t4 = Bridge.getEnumerator(this.prdQ);
                    try {
                        while ($t4.moveNext()) {
                            var u4 = $t4.Current;
                            if (Bridge.referenceEquals(u4, name)) {
                                tmp1 = (tmp1 + 1) | 0;
                            }
                        }
                    } finally {
                        if (Bridge.is($t4, System.IDisposable)) {
                            $t4.System$IDisposable$Dispose();
                        }
                    }
                    $t5 = Bridge.getEnumerator(this.readyUnits);
                    try {
                        while ($t5.moveNext()) {
                            var u5 = $t5.Current;
                            if (Bridge.referenceEquals(u5, name)) {
                                tmp1 = (tmp1 + 1) | 0;
                            }
                        }
                    } finally {
                        if (Bridge.is($t5, System.IDisposable)) {
                            $t5.System$IDisposable$Dispose();
                        }
                    }
                    return tmp1 < DarkKingdomCore.MyGame.unitPrms.getItem(name).$clone().maxLimit;
                }
            },
            AITick: function (mc) {
                var $t;
                if (this.res.Death >= 15 && this.res.Tier === 1) {
                    if (this.res.Money >= 150) {
                        mc.TryAddToQueueUnit(this, "Tier_2");
                    } else {
                    }
                } else if (this.res.Death >= 15 && this.res.Tier === 2) {
                    if (this.res.Money >= 150) {
                        mc.TryAddToQueueUnit(this, "Tier_3");
                    } else {
                    }
                } else if (this.unitCount < 13) {
                    if (this.prdQ.Count < 2) {
                        var avunits = new (System.Collections.Generic.List$1(System.String)).ctor();
                        this.prodsupport = false;
                        if (this.unitCount > 0 || this.aidefencestreak > 0) {
                            if (this.aisupportstreak > 0 && this.aisupportstreak < 2 || this.aidefencestreak >= 1) {
                                this.prodsupport = true;
                            }
                        }
                        $t = Bridge.getEnumerator(this.unitsList);
                        try {
                            while ($t.moveNext()) {
                                var u = $t.Current;
                                if (DarkKingdomCore.MyGame.unitPrms.getItem(u).$clone().support === this.prodsupport && this.CheckForProduce(u)) {
                                    avunits.add(u);
                                }
                            }
                        } finally {
                            if (Bridge.is($t, System.IDisposable)) {
                                $t.System$IDisposable$Dispose();
                            }
                        }
                        if (avunits.Count > 0) {
                            mc.TryAddToQueueUnit(this, avunits.getItem(DarkKingdomCore.MyGame.rnd.Next$2(0, avunits.Count)));
                        } else {
                            if (this.unitsList.Count > 0) {
                                mc.TryAddToQueueUnit(this, this.unitsList.getItem(DarkKingdomCore.MyGame.rnd.Next$2(0, this.unitsList.Count)));
                            }
                        }
                    }
                }
            }
        }
    });

    Bridge.define("DarkKingdomCore.Profile", {
        fields: {
            name: null,
            avId: 0,
            units: null,
            difficult: 0,
            racesPlays: null,
            racesWins: null,
            minvictims: 0,
            maxkills: 0,
            achivs: null,
            crystals: 0,
            maxCustomRaces: 0
        },
        ctors: {
            init: function () {
                this.units = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.difficult = 1;
                this.racesPlays = new (System.Collections.Generic.Dictionary$2(System.String,System.Int32)).ctor();
                this.racesWins = new (System.Collections.Generic.Dictionary$2(System.String,System.Int32)).ctor();
                this.achivs = new (System.Collections.Generic.Dictionary$2(System.String,System.String)).ctor();
            },
            ctor: function (nam, av, d, unts, rPls, rWns, mv, mk, achvs, crst, maxCustomRacs) {
                this.$initialize();
                this.name = nam;
                this.avId = av;
                this.units = unts;
                this.difficult = d;
                this.racesPlays = rPls;
                this.racesWins = rWns;
                this.minvictims = mv;
                this.maxkills = mk;
                this.achivs = achvs;
                this.crystals = crst;
                this.maxCustomRaces = maxCustomRacs;
            }
        }
    });

    Bridge.define("DarkKingdomCore.ProfileManager", {
        statics: {
            fields: {
                _instance: null
            },
            props: {
                Instance: {
                    get: function () {
                        if (DarkKingdomCore.ProfileManager._instance == null) {
                            DarkKingdomCore.ProfileManager._instance = new DarkKingdomCore.ProfileManager();
                        }
                        return DarkKingdomCore.ProfileManager._instance;
                    }
                }
            }
        },
        fields: {
            All: null
        },
        ctors: {
            init: function () {
                this.All = new (System.Collections.Generic.List$1(DarkKingdomCore.Profile)).ctor();
            }
        }
    });

    Bridge.define("DarkKingdomCore.Purchase", {
        fields: {
            name: null,
            crystals: 0,
            uIcon: null
        },
        ctors: {
            init: function () {
                this.uIcon = new MonoInterface.Appearance();
            },
            ctor: function (nam, ui, crst) {
                this.$initialize();
                this.name = nam;
                this.uIcon = ui.$clone();
                this.crystals = crst;
            }
        }
    });

    Bridge.define("DarkKingdomCore.Race", {
        fields: {
            name: null,
            desc: null,
            symb: 0,
            noAI: false,
            special: false,
            disableRewards: false,
            nick: null,
            custom: false
        },
        ctors: {
            init: function () {
                this.nick = "";
            },
            ctor: function (nme, dsc, nic, sym, nai, cst, splc, dr) {
                this.$initialize();
                this.name = nme;
                this.desc = dsc;
                this.symb = sym;
                this.noAI = nai;
                this.custom = cst;
                this.special = splc;
                this.nick = nic;
                this.disableRewards = dr;
            }
        },
        methods: {
            Enable: function () {
                this.special = false;
            }
        }
    });

    Bridge.define("DarkKingdomCore.RaceManager", {
        statics: {
            fields: {
                _instance: null
            },
            props: {
                Instance: {
                    get: function () {
                        if (DarkKingdomCore.RaceManager._instance == null) {
                            DarkKingdomCore.RaceManager._instance = new DarkKingdomCore.RaceManager();
                        }
                        return DarkKingdomCore.RaceManager._instance;
                    }
                }
            }
        },
        fields: {
            All: null
        },
        ctors: {
            init: function () {
                this.All = new (System.Collections.Generic.Dictionary$2(System.String,DarkKingdomCore.Race)).ctor();
            }
        }
    });

    Bridge.define("DarkKingdomCore.Spell", {
        fields: {
            Name: null,
            School: null,
            Description: null,
            Cost: null,
            Target: 0,
            Img: 0
        },
        ctors: {
            init: function () {
                this.Cost = new DarkKingdomCore.TimeCost();
            }
        }
    });

    Bridge.define("DarkKingdomCore.Spell.TargetType", {
        $kind: "nested enum",
        statics: {
            fields: {
                Mass: 0,
                Unit: 1,
                Ground: 2
            }
        }
    });

    Bridge.define("DarkKingdomCore.TimeCost", {
        $kind: "struct",
        statics: {
            methods: {
                op_Addition: function (r1, r2) {
                    return new DarkKingdomCore.TimeCost.$ctor1(((r1.Money + r2.Money) | 0), ((r1.Death + r2.Death) | 0), r1.Tier, r1.Time);
                },
                op_Subtraction: function (r1, r2) {
                    return new DarkKingdomCore.TimeCost.$ctor1(((r1.Money - r2.Money) | 0), ((r1.Death - r2.Death) | 0), r1.Tier, r1.Time);
                },
                getDefaultValue: function () { return new DarkKingdomCore.TimeCost(); }
            }
        },
        fields: {
            Money: 0,
            Death: 0,
            Time: 0,
            Tier: 0
        },
        ctors: {
            $ctor1: function (money, death, tier, time) {
                this.$initialize();
                this.Money = money;
                this.Death = death;
                this.Tier = tier;
                this.Time = time;
            },
            ctor: function () {
                this.$initialize();
            }
        },
        methods: {
            EnoughFor: function (cst) {
                return this.Money >= cst.Money && this.Death >= cst.Death && this.Tier >= cst.Tier;
            },
            getHashCode: function () {
                var h = Bridge.addHash([3655391383, this.Money, this.Death, this.Time, this.Tier]);
                return h;
            },
            equals: function (o) {
                if (!Bridge.is(o, DarkKingdomCore.TimeCost)) {
                    return false;
                }
                return Bridge.equals(this.Money, o.Money) && Bridge.equals(this.Death, o.Death) && Bridge.equals(this.Time, o.Time) && Bridge.equals(this.Tier, o.Tier);
            },
            $clone: function (to) {
                var s = to || new DarkKingdomCore.TimeCost();
                s.Money = this.Money;
                s.Death = this.Death;
                s.Time = this.Time;
                s.Tier = this.Tier;
                return s;
            }
        }
    });

    Bridge.define("DarkKingdomCore.Unit", {
        fields: {
            x: 0,
            owner: 0,
            moveside: 0,
            hp: 0,
            parameters: null,
            atkRecharge: 0,
            poiRecharge: 0,
            wingsWave: 0,
            isInCombat: false,
            isInRangeCombat: false,
            purified: false,
            landing: false,
            takedOff: false,
            abils: null,
            deathFromPoison: false,
            shownAbil: null,
            shownAbilMaxVal: 0,
            atkMod: null,
            game: null,
            CurrentAnimation: null,
            CurrentFrame: 0
        },
        props: {
            Attack: {
                get: function () {
                    return DarkKingdomCore.Attack.op_Addition(this.parameters.Attack.$clone(), this.atkMod.$clone());
                },
                set: function (value) {
                    this.atkMod = DarkKingdomCore.Attack.op_Subtraction(value.$clone(), this.parameters.Attack.$clone());
                }
            },
            MinDamage: {
                get: function () {
                    return this.parameters.Attack.MinDamage;
                }
            },
            MaxDamage: {
                get: function () {
                    return this.parameters.Attack.MaxDamage;
                }
            }
        },
        ctors: {
            init: function () {
                this.parameters = new DarkKingdomCore.UnitParameters();
                this.atkMod = new DarkKingdomCore.Attack();
                this.atkRecharge = 0;
                this.poiRecharge = 60;
                this.wingsWave = 0;
                this.isInCombat = false;
                this.isInRangeCombat = false;
                this.shownAbil = "";
                this.shownAbilMaxVal = 0;
            },
            ctor: function (game, xx, msid, own, prms) {
                this.$initialize();
                this.game = game;
                this.x = xx;
                this.moveside = msid;
                this.owner = own;
                this.SetParams(prms.$clone(), true);
                this.CurrentAnimation = "Idle";
            }
        },
        methods: {
            Near: function (u2) {
                return Math.abs(this.x - u2.x) <= 30 && this.parameters.Near(u2.parameters.$clone());
            },
            DrawCurrent: function (x, y, sb, effect) {
                if (effect === void 0) { effect = 0; }
                if (DarkKingdomCore.MyGame.sprites.getItem(this.parameters.spriteName).Ranges.containsKey(this.CurrentAnimation)) {
                    var curInd;
                    curInd = (DarkKingdomCore.MyGame.sprites.getItem(this.parameters.spriteName).Ranges.getItem(this.CurrentAnimation).$clone().Item1 + Bridge.Int.clip32(Math.floor(this.CurrentFrame))) | 0;
                    DarkKingdomCore.MyGame.sprites.getItem(this.parameters.spriteName).Draw$1(curInd, x, y, sb, effect);
                } else {
                    DarkKingdomCore.MyGame.sprites.getItem(this.parameters.spriteName).Draw$1(0, x, y, sb, effect);
                }
            },
            StartAnimation: function (name, animator) {
                if (DarkKingdomCore.MyGame.sprites.getItem(this.parameters.spriteName).Ranges.containsKey(name)) {
                    this.CurrentAnimation = name;
                    animator.AddChild(MonoInterface.NumberAnimation, new MonoInterface.NumberAnimation("CurrentFrame", 0, 0.9, 0.1, void 0, Bridge.fn.bind(this, function () {
                        this.CurrentAnimation = "Idle";
                        this.CurrentFrame = 0;
                    }), this)).Begin();
                }
            },
            AddAbility$3: function (nme, num, cond, cdnum, t, hidden) {
                if (hidden === void 0) { hidden = false; }
                if (!this.abils.containsKey(nme)) {
                    this.abils.add(nme, new DarkKingdomCore.Ability(nme, num, cond, cdnum, t, hidden));
                } else {
                    if (this.abils.getItem(nme).used) {
                        this.abils.setItem(nme, new DarkKingdomCore.Ability(nme, num, cond, cdnum, t, hidden));
                    }
                }
            },
            AddAbility: function (a) {
                this.AddAbility$3(a.name, a.value, a.condition, a.condnum, a.typ, a.hidden);
            },
            AddAbility$1: function (nme, t, hidden) {
                if (hidden === void 0) { hidden = false; }
                this.AddAbility$3(nme, 0, "", 0, t, hidden);
            },
            AddAbility$2: function (nme, num, t, hidden) {
                if (hidden === void 0) { hidden = false; }
                this.AddAbility$3(nme, num, "", 0, t, hidden);
            },
            RemoveAbil: function (nme) {
                if (this.abils.containsKey(nme)) {
                    this.abils.remove(nme);
                }
            },
            AbsContains: function (abil_name) {
                if (this.abils.containsKey(abil_name)) {
                    return this.abils.getItem(abil_name).condCompleted && !this.abils.getItem(abil_name).used;
                }
                return false;
            },
            AbsContains$1: function (abs) {
                var $t;
                if (abs === void 0) { abs = []; }
                $t = Bridge.getEnumerator(abs);
                try {
                    while ($t.moveNext()) {
                        var ab = $t.Current;
                        if (this.abils.containsKey(ab)) {
                            if (this.abils.getItem(ab).condCompleted && !this.abils.getItem(ab).used) {
                                return true;
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                return false;
            },
            SetParams: function (newprm, setHp) {
                var $t, $t1, $t2;
                this.parameters = newprm.$clone();
                this.atkMod = new DarkKingdomCore.Attack.$ctor1(0, 0, 0, 0);
                this.abils = new (System.Collections.Generic.Dictionary$2(System.String,DarkKingdomCore.Ability)).ctor();
                $t = Bridge.getEnumerator(this.parameters.abils.Values);
                try {
                    while ($t.moveNext()) {
                        var a = $t.Current;
                        this.AddAbility(a);
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                if (this.AbsContains("Random model")) {
                    this.RemoveAbil("Random model");
                    do {
                        ($t1 = DarkKingdomCore.MyGame.rnd.NextDouble());
                        if (Bridge.is($t1, System.Object)) {
                            var _discard1 = $t1;
                            if (DarkKingdomCore.MyGame.rnd.NextDouble() < 0.33) {
                                {
                                    this.parameters.spriteName = "militia1";
                                    break;
                                }
                            }
                        }

                        if (Bridge.is($t1, System.Object)) {
                            var _discard2 = $t1;
                            if (DarkKingdomCore.MyGame.rnd.NextDouble() < 0.66) {
                                {
                                    this.parameters.spriteName = "militia2";
                                    break;
                                }
                            }
                        }
                    } while (false);
                }
                if (this.AbsContains("Universal")) {
                    this.RemoveAbil("Universal");
                    var maxrace = DarkKingdomCore.MyGame.SelectPlayingRace(DarkKingdomCore.MyGame.plrs[this.owner].unitsList);
                    switch (maxrace) {
                        case "Humans": 
                            {
                                this.AddAbility$2("Life_rollback", 2, DarkKingdomCore.EffectType.Good);
                                break;
                            }
                        case "Undeads": 
                            {
                                this.AddAbility$1("Undead", DarkKingdomCore.EffectType.Good);
                                this.AddAbility$1("Plague", DarkKingdomCore.EffectType.Good);
                                this.parameters.Speed = "Slow";
                                break;
                            }
                        case "Demons": 
                            {
                                this.AddAbility$1("Mage", DarkKingdomCore.EffectType.Good);
                                this.AddAbility$3("Explosive", 0, "On_death", 0, DarkKingdomCore.EffectType.Good);
                                this.parameters.Armor = "None";
                                this.parameters.Speed = "Fast";
                                break;
                            }
                        case "Horde": 
                            {
                                this.Attack = DarkKingdomCore.Attack.op_Addition$1(this.Attack.$clone(), 10);
                                this.AddAbility$2("Crasher", 24, DarkKingdomCore.EffectType.Good);
                                break;
                            }
                        case "Swampers": 
                            {
                                this.AddAbility$2("Poisoner", 20, DarkKingdomCore.EffectType.Good);
                                this.AddAbility$1("Poisonproof", DarkKingdomCore.EffectType.Good);
                                break;
                            }
                        case "Elves": 
                            {
                                this.AddAbility$2("Agility", 20, DarkKingdomCore.EffectType.Good);
                                this.AddAbility$3("Lycanthropy", 54, "At night", 0, DarkKingdomCore.EffectType.Good);
                                break;
                            }
                        case "Dwarfs": 
                            {
                                this.parameters.Armor = "Heavy";
                                this.AddAbility$1("Spellproof", DarkKingdomCore.EffectType.Good);
                                this.parameters.Speed = "Slow";
                                break;
                            }
                        case "Steampunk": 
                            {
                                this.Attack = DarkKingdomCore.Attack.op_Addition$1(this.Attack.$clone(), 10);
                                ($t2 = this.parameters.$clone()).maxhp = ($t2.maxhp + 100) | 0;
                                this.AddAbility$1("Machinery", DarkKingdomCore.EffectType.Good);
                                break;
                            }
                        case "Neutrals": 
                            {
                                this.Attack = DarkKingdomCore.Attack.op_Addition$1(this.Attack.$clone(), 10);
                                this.AddAbility$1("Invisible", DarkKingdomCore.EffectType.Good);
                                break;
                            }
                    }
                    if (Bridge.referenceEquals(this.parameters.Name, "Neutral_warrior") && !Bridge.referenceEquals(maxrace, "Neutrals")) {
                        this.parameters.rect.Height = 31;
                    }
                }
                if (this.AbsContains("Chance_to_fly") && DarkKingdomCore.MyGame.rnd.NextDouble() > 0.5) {
                    this.parameters.moveType = DarkKingdomCore.UnitMoveType.FlyingMT;
                }
                if (setHp) {
                    this.hp = this.parameters.maxhp;
                }
            }
        }
    });

    Bridge.define("DarkKingdomCore.UnitMoveType", {
        $kind: "enum",
        statics: {
            fields: {
                GroundMT: 0,
                FlyingMT: 1,
                HugeMT: 2
            }
        }
    });

    Bridge.define("DarkKingdomCore.UnitParameters", {
        $kind: "struct",
        statics: {
            methods: {
                getDefaultValue: function () { return new DarkKingdomCore.UnitParameters(); }
            }
        },
        fields: {
            id: 0,
            Name: null,
            Attack: null,
            maxhp: 0,
            Cost: null,
            _armor: 0,
            _speed: 0,
            armNick: null,
            spdNick: null,
            Race: null,
            Subrace: null,
            Description: null,
            animated: false,
            imgx: 0,
            imgy: 0,
            isBuilding: false,
            isIgnoreUnits: false,
            isHeroic: false,
            moveType: 0,
            maxLimit: 0,
            hpBotom: false,
            size: null,
            rect: null,
            abils: null,
            rawAbils: null,
            spriteName: null,
            iconApp: null,
            iconInd: 0,
            ammoType: 0,
            support: false,
            upgrade: false,
            special: false,
            isStartBuilding: false
        },
        props: {
            Speed: {
                get: function () {
                    return this.spdNick;
                },
                set: function (value) {
                    this.spdNick = value;
                    switch (value) {
                        case "None": 
                            this._speed = 0;
                            break;
                        case "Slow": 
                            this._speed = 0.15;
                            break;
                        case "Normal": 
                            this._speed = 0.2;
                            break;
                        case "Fast": 
                            this._speed = 0.3;
                            break;
                        case "Very_fast": 
                            this._speed = 0.6;
                            break;
                    }
                }
            },
            Armor: {
                get: function () {
                    return this.armNick;
                },
                set: function (value) {
                    this.armNick = value;
                    switch (value) {
                        case "None": 
                            this._armor = 1;
                            break;
                        case "Light": 
                            this._armor = 0.75;
                            break;
                        case "Heavy": 
                            this._armor = 0.5;
                            break;
                        case "Ethereal": 
                            this._armor = 0.25;
                            break;
                    }
                }
            }
        },
        ctors: {
            init: function () {
                this.Attack = new DarkKingdomCore.Attack();
                this.Cost = new DarkKingdomCore.TimeCost();
                this.size = new DarkKingdomCore.WidthHeight();
                this.rect = new Microsoft.Xna.Framework.Rectangle();
                this.iconApp = new MonoInterface.Appearance();
            },
            ctor: function () {
                this.$initialize();
            }
        },
        methods: {
            AbsContains: function (nme) {
                return this.abils.containsKey(nme);
            },
            Near: function (up2) {
                return this.moveType === up2.moveType || this.moveType === DarkKingdomCore.UnitMoveType.HugeMT || up2.moveType === DarkKingdomCore.UnitMoveType.HugeMT;
            },
            getHashCode: function () {
                var h = Bridge.addHash([5290109060, this.id, this.Name, this.Attack, this.maxhp, this.Cost, this._armor, this._speed, this.armNick, this.spdNick, this.Race, this.Subrace, this.Description, this.animated, this.imgx, this.imgy, this.isBuilding, this.isIgnoreUnits, this.isHeroic, this.moveType, this.maxLimit, this.hpBotom, this.size, this.rect, this.abils, this.rawAbils, this.spriteName, this.iconApp, this.iconInd, this.ammoType, this.support, this.upgrade, this.special, this.isStartBuilding]);
                return h;
            },
            equals: function (o) {
                if (!Bridge.is(o, DarkKingdomCore.UnitParameters)) {
                    return false;
                }
                return Bridge.equals(this.id, o.id) && Bridge.equals(this.Name, o.Name) && Bridge.equals(this.Attack, o.Attack) && Bridge.equals(this.maxhp, o.maxhp) && Bridge.equals(this.Cost, o.Cost) && Bridge.equals(this._armor, o._armor) && Bridge.equals(this._speed, o._speed) && Bridge.equals(this.armNick, o.armNick) && Bridge.equals(this.spdNick, o.spdNick) && Bridge.equals(this.Race, o.Race) && Bridge.equals(this.Subrace, o.Subrace) && Bridge.equals(this.Description, o.Description) && Bridge.equals(this.animated, o.animated) && Bridge.equals(this.imgx, o.imgx) && Bridge.equals(this.imgy, o.imgy) && Bridge.equals(this.isBuilding, o.isBuilding) && Bridge.equals(this.isIgnoreUnits, o.isIgnoreUnits) && Bridge.equals(this.isHeroic, o.isHeroic) && Bridge.equals(this.moveType, o.moveType) && Bridge.equals(this.maxLimit, o.maxLimit) && Bridge.equals(this.hpBotom, o.hpBotom) && Bridge.equals(this.size, o.size) && Bridge.equals(this.rect, o.rect) && Bridge.equals(this.abils, o.abils) && Bridge.equals(this.rawAbils, o.rawAbils) && Bridge.equals(this.spriteName, o.spriteName) && Bridge.equals(this.iconApp, o.iconApp) && Bridge.equals(this.iconInd, o.iconInd) && Bridge.equals(this.ammoType, o.ammoType) && Bridge.equals(this.support, o.support) && Bridge.equals(this.upgrade, o.upgrade) && Bridge.equals(this.special, o.special) && Bridge.equals(this.isStartBuilding, o.isStartBuilding);
            },
            $clone: function (to) {
                var s = to || new DarkKingdomCore.UnitParameters();
                s.id = this.id;
                s.Name = this.Name;
                s.Attack = this.Attack.$clone();
                s.maxhp = this.maxhp;
                s.Cost = this.Cost.$clone();
                s._armor = this._armor;
                s._speed = this._speed;
                s.armNick = this.armNick;
                s.spdNick = this.spdNick;
                s.Race = this.Race;
                s.Subrace = this.Subrace;
                s.Description = this.Description;
                s.animated = this.animated;
                s.imgx = this.imgx;
                s.imgy = this.imgy;
                s.isBuilding = this.isBuilding;
                s.isIgnoreUnits = this.isIgnoreUnits;
                s.isHeroic = this.isHeroic;
                s.moveType = this.moveType;
                s.maxLimit = this.maxLimit;
                s.hpBotom = this.hpBotom;
                s.size = this.size.$clone();
                s.rect = this.rect.$clone();
                s.abils = this.abils;
                s.rawAbils = this.rawAbils;
                s.spriteName = this.spriteName;
                s.iconApp = this.iconApp.$clone();
                s.iconInd = this.iconInd;
                s.ammoType = this.ammoType;
                s.support = this.support;
                s.upgrade = this.upgrade;
                s.special = this.special;
                s.isStartBuilding = this.isStartBuilding;
                return s;
            }
        }
    });

    Bridge.define("DarkKingdomCore.WidthHeight", {
        $kind: "struct",
        statics: {
            methods: {
                getDefaultValue: function () { return new DarkKingdomCore.WidthHeight(); }
            }
        },
        fields: {
            w: 0,
            h: 0
        },
        ctors: {
            ctor: function () {
                this.$initialize();
            }
        },
        methods: {
            getHashCode: function () {
                var h = Bridge.addHash([3728611878, this.w, this.h]);
                return h;
            },
            equals: function (o) {
                if (!Bridge.is(o, DarkKingdomCore.WidthHeight)) {
                    return false;
                }
                return Bridge.equals(this.w, o.w) && Bridge.equals(this.h, o.h);
            },
            $clone: function (to) {
                var s = to || new DarkKingdomCore.WidthHeight();
                s.w = this.w;
                s.h = this.h;
                return s;
            }
        }
    });

    Bridge.define("DarkKingdomDesktop.App", {
        main: function Main () {
            var $t;
            var canvas = ($t = document.createElement("canvas"), $t.width = 800, $t.height = 480, $t.id = "monogamecanvas", $t);
            document.body.appendChild(canvas);

            DarkKingdomDesktop.App.game = new DarkKingdomDesktop.MainClass();
            DarkKingdomDesktop.App.game.Run();
        },
        statics: {
            fields: {
                game: null
            }
        }
    });

    /** @namespace DarkKingdomDesktop */

    /**
     * This is the main type for your game
     *
     * @public
     * @class DarkKingdomDesktop.MainClass
     * @augments Microsoft.Xna.Framework.Game
     */
    Bridge.define("DarkKingdomDesktop.MainClass", {
        inherits: [Microsoft.Xna.Framework.Game],
        fields: {
            gameClass: null,
            graphics: null,
            spriteBatch: null,
            AppFolder: null,
            DataFolder: null
        },
        ctors: {
            ctor: function () {
                var $t;
                this.$initialize();
                Microsoft.Xna.Framework.Game.ctor.call(this);
                this.graphics = new Microsoft.Xna.Framework.GraphicsDeviceManager(this);
                var platform = "Windows";

                this.gameClass = ($t = new DarkKingdomCore.MyGame(platform), $t.graphics = this.graphics, $t.AppFolder = "", $t.DataFolder = "Content", $t);

                this.Content.RootDirectory = "Content";

                this.gameClass.addOnExit(Bridge.fn.cacheBind(this, this.OnExit));

            }
        },
        methods: {
            Resize: function (w, h) {

                //var scaleFactor = 1.0f;

                //int finalW = (int)(w * scaleFactor);
                //int finalH = (int)(h * scaleFactor);
                //var uiScale = 1.0f;
                //if (finalW > 1000)
                //    uiScale = 1.25f;
                //if (finalW > 1500)
                //    uiScale = 1.5f;
            },
            /**
             * Allows the game to perform any initialization it needs to before starting to run.
             This is where it can query for any required services and load any non-graphic
             related content.  Calling base.Initialize will enumerate through any components
             and initialize them as well.
             *
             * @instance
             * @protected
             * @override
             * @this DarkKingdomDesktop.MainClass
             * @memberof DarkKingdomDesktop.MainClass
             * @return  {void}
             */
            Initialize: function () {
                // TODO: Add your initialization logic here
                this.IsMouseVisible = true;
                Microsoft.Xna.Framework.Input.Touch.TouchPanel.EnabledGestures = 17;
                Microsoft.Xna.Framework.Game.prototype.Initialize.call(this);
            },
            /**
             * LoadContent will be called once per game and is the place to load
             all of your content.
             *
             * @instance
             * @protected
             * @override
             * @this DarkKingdomDesktop.MainClass
             * @memberof DarkKingdomDesktop.MainClass
             * @return  {void}
             */
            LoadContent: function () {
                // Create a new SpriteBatch, which can be used to draw textures.
                //backBuffer = new RenderTarget2D(graphics.GraphicsDevice, 800, 480);
                this.spriteBatch = new Microsoft.Xna.Framework.Graphics.SpriteBatch(this.GraphicsDevice);
                this.gameClass.spriteBatch = this.spriteBatch;

                //	ReadProfiles();
                //ReadSprites(Content);

                //int test_w = 50, test_h = 50;
                //test_text = new Texture2D(GraphicsDevice, test_w, test_h);
                //var fill_arr = new int[test_w * test_h * 4];
                //for (var i = 0; i < test_w * test_h * 4; i += 4)
                //{
                //    fill_arr[i] = 255;
                //    fill_arr[i + 1] = 0;
                //    fill_arr[i + 2] = 255;
                //    fill_arr[i + 3] = 128;
                //}
                //test_text.SetData(fill_arr);
                this.gameClass.LoadData(this.Content);
            },
            /**
             * UnloadContent will be called once per game and is the place to unload
             all content.
             *
             * @instance
             * @protected
             * @override
             * @this DarkKingdomDesktop.MainClass
             * @memberof DarkKingdomDesktop.MainClass
             * @return  {void}
             */
            UnloadContent: function () {
                // TODO: Unload any non ContentManager content here
            },
            /**
             * Allows the game to run logic such as updating the world,
             checking for collisions, gathering input, and playing audio.
             *
             * @instance
             * @protected
             * @override
             * @this DarkKingdomDesktop.MainClass
             * @memberof DarkKingdomDesktop.MainClass
             * @param   {Microsoft.Xna.Framework.GameTime}    gameTime    Provides a snapshot of timing values.
             * @return  {void}
             */
            Update: function (gameTime) {
                if (this.gameClass.isLoaded) {
                    this.gameClass.Update();
                }
                Microsoft.Xna.Framework.Game.prototype.Update.call(this, gameTime);
            },
            /**
             * This is called when the game should draw itself.
             *
             * @instance
             * @protected
             * @override
             * @this DarkKingdomDesktop.MainClass
             * @memberof DarkKingdomDesktop.MainClass
             * @param   {Microsoft.Xna.Framework.GameTime}    gameTime    Provides a snapshot of timing values.
             * @return  {void}
             */
            Draw: function (gameTime) {
                // TODO: Add your drawing code here
                if (this.gameClass.isLoaded) {
                    //graphics.GraphicsDevice.SetRenderTarget(backBuffer);
                    this.spriteBatch.Begin(Microsoft.Xna.Framework.Graphics.SpriteSortMode.Deferred, Microsoft.Xna.Framework.Graphics.BlendState.NonPremultiplied, Microsoft.Xna.Framework.Graphics.SamplerState.PointClamp, Microsoft.Xna.Framework.Graphics.DepthStencilState.Default, Microsoft.Xna.Framework.Graphics.RasterizerState.CullNone);

                    this.gameClass.Draw();
                    //spriteBatch.End();
                    //graphics.GraphicsDevice.SetRenderTarget(null);

                    //spriteBatch.Begin(SpriteSortMode.Deferred, BlendState.NonPremultiplied, SamplerState.PointClamp, DepthStencilState.Default, RasterizerState.CullNone);

                    //spriteBatch.Draw(backBuffer, new Rectangle(0, 0, gameClass._screenWidth, gameClass._screenHeight), Color.White);

                    this.gameClass.DrawInterface(this.spriteBatch);

                    //spriteBatch.Draw(test_text, new Vector2(100, 100), Color.White);

                    this.spriteBatch.End();
                }

                Microsoft.Xna.Framework.Game.prototype.Draw.call(this, gameTime);
            },
            OnExit: function () {
                this.Exit();
            }
        }
    });

    Bridge.define("MonoInterface.Animation", {
        fields: {
            IsRunning: false,
            IsCompleted: false,
            animationTask: null
        },
        events: {
            OnStart: null,
            OnEnd: null
        },
        ctors: {
            ctor: function (onStart, onEnd) {
                if (onStart === void 0) { onStart = null; }
                if (onEnd === void 0) { onEnd = null; }

                this.$initialize();
                this.OnStart = onStart;
                this.OnEnd = onEnd;
            }
        },
        methods: {
            Begin: function () {
                this.IsRunning = true;
                this.IsCompleted = false;
                !Bridge.staticEquals(this.OnStart, null) ? this.OnStart() : null;
                this.animationTask = new System.Threading.Tasks.TaskCompletionSource();
                return this.animationTask.task;
            },
            Complete: function () {
                this.IsRunning = false;
                this.IsCompleted = true;
            },
            End: function () {
                !Bridge.staticEquals(this.OnEnd, null) ? this.OnEnd() : null;
                this.animationTask.setResult(null);
            }
        }
    });

    Bridge.define("MonoInterface.Animator", {
        fields: {
            Animations: null,
            completed: null
        },
        ctors: {
            init: function () {
                this.completed = new (System.Collections.Generic.List$1(MonoInterface.Animation)).ctor();
            },
            ctor: function () {
                this.$initialize();
                this.Animations = new (System.Collections.Generic.List$1(MonoInterface.Animation)).ctor();
            }
        },
        methods: {
            AddChild: function (T, child) {
                this.Animations.add(child);
                return child;
            },
            Do: function () {
                var $t, $t1;
                $t = Bridge.getEnumerator(this.Animations);
                try {
                    while ($t.moveNext()) {
                        var anim = $t.Current;
                        anim.Do();
                        if (anim.IsCompleted) {
                            this.completed.add(anim);
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                if (this.completed.Count > 0) {
                    $t1 = Bridge.getEnumerator(this.completed);
                    try {
                        while ($t1.moveNext()) {
                            var anim1 = $t1.Current;
                            anim1.End();
                            this.Animations.remove(anim1);
                        }
                    } finally {
                        if (Bridge.is($t1, System.IDisposable)) {
                            $t1.System$IDisposable$Dispose();
                        }
                    }
                    this.completed.clear();
                }
            }
        }
    });

    Bridge.define("MonoInterface.Appearance", {
        $kind: "struct",
        statics: {
            methods: {
                getDefaultValue: function () { return new MonoInterface.Appearance(); }
            }
        },
        fields: {
            sprite: null,
            img: 0
        },
        ctors: {
            $ctor1: function (sprite, img) {
                this.$initialize();
                this.sprite = sprite;
                this.img = img;
            },
            ctor: function () {
                this.$initialize();
            }
        },
        methods: {
            Draw$1: function (sb, x, y, effect, alpha) {
                if (effect === void 0) { effect = 0; }
                if (alpha === void 0) { alpha = 1.0; }
                this.sprite.Draw$1(this.img, x, y, sb, effect, alpha);
            },
            Draw: function (sb, x, y, w, h, effect, alpha) {
                if (effect === void 0) { effect = 0; }
                if (alpha === void 0) { alpha = 1.0; }
                this.sprite.Draw(this.img, x, y, w, h, sb, effect, alpha);
            },
            getHashCode: function () {
                var h = Bridge.addHash([3553773573, this.sprite, this.img]);
                return h;
            },
            equals: function (o) {
                if (!Bridge.is(o, MonoInterface.Appearance)) {
                    return false;
                }
                return Bridge.equals(this.sprite, o.sprite) && Bridge.equals(this.img, o.img);
            },
            $clone: function (to) {
                var s = to || new MonoInterface.Appearance();
                s.sprite = this.sprite;
                s.img = this.img;
                return s;
            }
        }
    });

    Bridge.define("MonoInterface.Block", {
        fields: {
            Parent: null,
            X: 0,
            Y: 0,
            _w: 0,
            _h: 0,
            Alignment: null,
            Alpha: 0,
            Visible: false,
            CurrentTheme: null,
            CurrentLocalization: null,
            _finalX: 0,
            _finalY: 0,
            _finalW: 0,
            _finalH: 0,
            IsNeedRecalc: false,
            _showAnimation: null,
            _hideAnimation: null
        },
        props: {
            W: {
                get: function () {
                    return (this._w === -1 && this.Parent != null) ? this.Parent.W : this._w;
                },
                set: function (value) {
                    this._w = value;
                }
            },
            H: {
                get: function () {
                    return (this._h === -1 && this.Parent != null) ? this.Parent.H : this._h;
                },
                set: function (value) {
                    this._h = value;
                }
            },
            Right: {
                get: function () {
                    return ((this.X + this.W) | 0);
                },
                set: function (value) {
                    this.X = (value - this.W) | 0;
                }
            },
            Bottom: {
                get: function () {
                    return ((this.Y + this.H) | 0);
                },
                set: function (value) {
                    this.Y = (value - this.H) | 0;
                }
            },
            FinalX: {
                get: function () {
                    return this._finalX;
                }
            },
            FinalY: {
                get: function () {
                    return this._finalY;
                }
            },
            FinalW: {
                get: function () {
                    return this._finalW;
                }
            },
            FinalH: {
                get: function () {
                    return this._finalH;
                }
            },
            FinalRight: {
                get: function () {
                    return ((this._finalX + this._finalW) | 0);
                }
            },
            FinalBottom: {
                get: function () {
                    return ((this._finalY + this._finalH) | 0);
                }
            },
            ShowAnimation: {
                get: function () {
                    return this._showAnimation;
                },
                set: function (value) {
                    this._showAnimation = value;
                    var na;
                    if (((na = Bridge.as(this._showAnimation, MonoInterface.NumberAnimation))) != null && na.target == null) {
                        na.SetTarget(this);
                    }
                }
            },
            HideAnimation: {
                get: function () {
                    return this._hideAnimation;
                },
                set: function (value) {
                    this._hideAnimation = value;
                    var na;
                    if (((na = Bridge.as(this._hideAnimation, MonoInterface.NumberAnimation))) != null && na.target == null) {
                        na.SetTarget(this);
                    }
                    this.HideAnimation.addOnEnd(Bridge.fn.bind(this, function () {
                        this.Visible = false;
                    }));
                }
            }
        },
        ctors: {
            init: function () {
                this.Alignment = new Microsoft.Xna.Framework.Vector2();
            }
        },
        methods: {
            CheckForRecalc: function () {
                if (this.IsNeedRecalc) {
                    this.Recalc();
                }
            },
            Recalc: function () {

                this._finalW = this._w === -1 ? this.Parent.FinalW : Bridge.Int.clip32(this.W * this.Parent.FinalChildrenScaleX);
                this._finalH = this._h === -1 ? this.Parent.FinalH : Bridge.Int.clip32(this.H * this.Parent.FinalChildrenScaleY);
                this._finalX = (this.Parent.FinalX + Bridge.Int.clip32((this.Parent.FinalChildrenScaleX * this.X + (((this.Parent.FinalW - this._finalW) | 0)) * this.Alignment.X))) | 0;
                this._finalY = (this.Parent.FinalY + Bridge.Int.clip32((this.Parent.FinalChildrenScaleY * this.Y + (((this.Parent.FinalH - this._finalH) | 0)) * this.Alignment.Y))) | 0;
                this.IsNeedRecalc = false;
            },
            Show: function (animator) {
                if (animator === void 0) { animator = null; }
                if (this.Visible === false) {
                    this.Visible = true;
                    if (animator != null && this.ShowAnimation != null) {
                        animator.AddChild(MonoInterface.Animation, this.ShowAnimation).Begin();
                    }
                }
            },
            Hide: function (animator) {
                if (animator === void 0) { animator = null; }

                if (this.Visible === true) {
                    if (animator != null && this.HideAnimation != null) {
                        animator.AddChild(MonoInterface.Animation, this.HideAnimation).Begin();
                    } else {
                        this.Visible = false;
                    }
                }
            },
            ApplyTheme: function (currentTheme) {
                this.CurrentTheme = currentTheme;
                this.IsNeedRecalc = true;
            },
            ApplyLocalization: function (currentLocalization) {
                this.CurrentLocalization = currentLocalization;
            }
        }
    });

    Bridge.define("MonoInterface.BlockAnimation.properties", {
        $kind: "nested enum",
        statics: {
            fields: {
                X: 0,
                Y: 1,
                Alpha: 2
            }
        }
    });

    Bridge.define("MonoInterface.Grid.Orientations", {
        $kind: "nested enum",
        statics: {
            fields: {
                LeftToRight: 0,
                TopToBottom: 1
            }
        }
    });

    Bridge.define("MonoInterface.Localization", {
        fields: {
            Name: null,
            _strings: null
        },
        ctors: {
            init: function () {
                this._strings = new (System.Collections.Generic.Dictionary$2(System.String,System.String)).ctor();
            },
            ctor: function (name, strings) {
                this.$initialize();
                this.Name = name;
                this._strings = strings;
            }
        },
        methods: {
            AddString: function (key, text) {
                this._strings.add(key, text);
            },
            GetString: function (key) {
                if (this._strings.containsKey(key)) {
                    return this._strings.getItem(key);
                }
                return key;
            },
            GetString$1: function (key, args) {
                if (args === void 0) { args = []; }
                if (this._strings.containsKey(key)) {
                    return System.String.format.apply(System.String, [this._strings.getItem(key)].concat(args));
                }
                return key;
            }
        }
    });

    Bridge.define("MonoInterface.Sprite", {
        fields: {
            Texture: null,
            Name: null,
            W: 0,
            H: 0,
            Ranges: null
        },
        ctors: {
            init: function () {
                this.Ranges = new (System.Collections.Generic.Dictionary$2(System.String,System.ValueTuple$2(System.Int32,System.Int32))).ctor();
            }
        },
        methods: {
            Draw$1: function (ind, x, y, sb, effect, alpha) {
                if (effect === void 0) { effect = 0; }
                if (alpha === void 0) { alpha = 1.0; }
                var color = alpha === 1.0 ? Microsoft.Xna.Framework.Color.White : new Microsoft.Xna.Framework.Color.$ctor9(1.0, 1.0, 1.0, alpha);
                sb.Draw$6(this.Texture, new Microsoft.Xna.Framework.Vector2.$ctor2(x, y), this.RectFromIndex(ind), color.$clone(), 0, Microsoft.Xna.Framework.Vector2.Zero.$clone(), 1, effect, 0.0);
            },
            Draw: function (ind, x, y, w, h, sb, effect, alpha) {
                if (effect === void 0) { effect = 0; }
                if (alpha === void 0) { alpha = 1.0; }
                var color = alpha === 1.0 ? Microsoft.Xna.Framework.Color.White : new Microsoft.Xna.Framework.Color.$ctor9(1.0, 1.0, 1.0, alpha);
                sb.Draw$2(this.Texture, new Microsoft.Xna.Framework.Rectangle.$ctor2(x, y, w, h), this.RectFromIndex(ind), color.$clone(), 0, Microsoft.Xna.Framework.Vector2.Zero.$clone(), effect, 0.0);
            },
            RectFromIndex: function (ind) {
                var columns = (Bridge.Int.div(this.Texture.Width, this.W)) | 0;
                return new Microsoft.Xna.Framework.Rectangle.$ctor2(Bridge.Int.mul((ind % columns), this.W), Bridge.Int.mul((((Bridge.Int.div(ind, columns)) | 0)), this.H), this.W, this.H);
            }
        }
    });

    Bridge.define("MonoInterface.Theme", {
        statics: {
            methods: {
                SolidColorTexture: function (gd, r, g, b, a) {
                    if (a === void 0) { a = 255; }
                    var tex = new Microsoft.Xna.Framework.Graphics.Texture2D.ctor(gd, 1, 1);
                    var data = System.Array.init([
                        r, 
                        g, 
                        b, 
                        a
                    ], System.Int32);
                    tex.SetData$1(System.Int32, data, 0, 1);
                    return tex;
                },
                GetEmptyApp: function (gd) {
                    var $t;
                    return new MonoInterface.Appearance.$ctor1(($t = new MonoInterface.Sprite(), $t.Texture = new Microsoft.Xna.Framework.Graphics.Texture2D.ctor(gd, 1, 1), $t.W = 1, $t.H = 1, $t), 0);
                }
            }
        },
        fields: {
            FrameBackTexture: null,
            ButtonBackTexture: null,
            ButtonFrontTexture: null,
            ButtonPressedTexture: null,
            ButtonDisabledTexture: null,
            ButtonSelectedTexture: null,
            FontColor: null,
            ProgressBackTexture: null,
            ProgressFrontTexture: null,
            SwitcherButtonLeftTexture: null,
            SwitcherButtonRightTexture: null,
            SwitcherMainFontSize: 0,
            SwitcherMainColor: null,
            SwitcherDescriptionFontSize: 0,
            SwitcherDescriptionColor: null,
            NineFrameBoderTexture: null,
            NineSliceButtonBackTexture: null,
            Fonts: null,
            EmptyTexture: null
        },
        ctors: {
            init: function () {
                this.FrameBackTexture = new MonoInterface.Appearance();
                this.ButtonBackTexture = new MonoInterface.Appearance();
                this.ButtonFrontTexture = new MonoInterface.Appearance();
                this.ButtonPressedTexture = new MonoInterface.Appearance();
                this.ButtonDisabledTexture = new MonoInterface.Appearance();
                this.ButtonSelectedTexture = new MonoInterface.Appearance();
                this.FontColor = new Microsoft.Xna.Framework.Color();
                this.ProgressBackTexture = new MonoInterface.Appearance();
                this.ProgressFrontTexture = new MonoInterface.Appearance();
                this.SwitcherButtonLeftTexture = new MonoInterface.Appearance();
                this.SwitcherButtonRightTexture = new MonoInterface.Appearance();
                this.SwitcherMainColor = new Microsoft.Xna.Framework.Color();
                this.SwitcherDescriptionColor = new Microsoft.Xna.Framework.Color();
                this.EmptyTexture = new MonoInterface.Appearance();
            },
            ctor: function () {
                this.$initialize();
                this.Fonts = new (System.Collections.Generic.List$1(System.ValueTuple$2(System.Int32,Microsoft.Xna.Framework.Graphics.SpriteFont))).ctor();
            }
        },
        methods: {
            GetFont: function (size) {
                for (var i = 0; i < this.Fonts.Count; i = (i + 1) | 0) {
                    if (this.Fonts.getItem(i).$clone().Item1 >= size) {
                        return this.Fonts.getItem(i).$clone().Item2;
                    }
                }
                return this.Fonts.getItem(((this.Fonts.Count - 1) | 0)).$clone().Item2;
            }
        }
    });

    Bridge.define("DarkKingdomCore.ImageParticle", {
        inherits: [DarkKingdomCore.Particle],
        fields: {
            spriteRef: null,
            isMirrored: false
        },
        ctors: {
            init: function () {
                this.spriteRef = new MonoInterface.Appearance();
            },
            ctor: function (spriteRef, xx, yy, dxx, dyy, lt, isMir) {
                if (isMir === void 0) { isMir = false; }

                this.$initialize();
                DarkKingdomCore.Particle.ctor.call(this);
                this.x = xx;
                this.y = yy;
                this.dx = dxx;
                this.dy = dyy;
                this.ltime = lt;
                this.spriteRef = spriteRef.$clone();
                this.pType = DarkKingdomCore.ParType.Image;
                this.isMirrored = isMir;
            }
        },
        methods: {
            XNADraw: function (sb) {
                this.spriteRef.Draw$1(sb, this.x, this.y, this.isMirrored ? Microsoft.Xna.Framework.Graphics.SpriteEffects.FlipHorizontally : Microsoft.Xna.Framework.Graphics.SpriteEffects.None);
            }
        }
    });

    Bridge.define("DarkKingdomCore.TextParticle", {
        inherits: [DarkKingdomCore.Particle],
        fields: {
            str: null,
            clr: null,
            shiftX: 0,
            font: null
        },
        ctors: {
            init: function () {
                this.clr = new Microsoft.Xna.Framework.Color();
            },
            ctor: function (fnt, c, xx, yy, dxx, dyy, ayy, lt, s) {
                this.$initialize();
                DarkKingdomCore.Particle.ctor.call(this);
                this.clr = c.$clone();
                this.x = xx;
                this.y = yy;
                this.dx = dxx;
                this.dy = dyy;
                this.ltime = lt;
                this.ay = ayy;
                this.str = s;
                this.a = 768;
                this.font = fnt;
                this.ast = (Bridge.Int.div(768, this.ltime)) | 0;
                this.pType = DarkKingdomCore.ParType.Text;
                this.shiftX = -fnt.MeasureString(this.str).X / 2;
            }
        },
        methods: {
            XNADraw: function (sb) {
                sb.DrawString(this.font, this.str, new Microsoft.Xna.Framework.Vector2.$ctor2(this.x + this.shiftX, this.y), this.clr.$clone());
            }
        }
    });

    Bridge.define("MonoInterface.BlockAnimation", {
        inherits: [MonoInterface.Animation],
        fields: {
            current: 0,
            startValue: 0,
            endValue: 0,
            step: 0,
            target: null,
            property: 0
        },
        ctors: {
            ctor: function (property, start, end, step, onStart, onEnd, target) {
                if (onStart === void 0) { onStart = null; }
                if (onEnd === void 0) { onEnd = null; }
                if (target === void 0) { target = null; }

                this.$initialize();
                MonoInterface.Animation.ctor.call(this, onStart, onEnd);
                this.property = property;
                this.startValue = start;
                this.endValue = end;
                this.step = step;

                this.target = target;

                this.IsRunning = false;
                this.IsCompleted = false;
            }
        },
        methods: {
            Do: function () {
                if (this.IsRunning) {
                    this.current += this.step;
                    if ((this.step > 0 && this.current > this.endValue) || (this.step < 0 && this.current < this.endValue)) {
                        this.current = this.endValue;
                        this.Complete();
                    }
                    switch (this.property) {
                        case MonoInterface.BlockAnimation.properties.X: 
                            this.target.X = Bridge.Int.clip32(this.current);
                            break;
                        case MonoInterface.BlockAnimation.properties.Y: 
                            this.target.Y = Bridge.Int.clip32(this.current);
                            break;
                        case MonoInterface.BlockAnimation.properties.Alpha: 
                            this.target.Alpha = this.current;
                            break;
                    }
                }
            },
            SetTarget: function (target) {
                this.target = target;
            },
            Begin: function () {
                this.current = this.startValue;
                return MonoInterface.Animation.prototype.Begin.call(this);
            }
        }
    });

    Bridge.define("MonoInterface.Container", {
        inherits: [MonoInterface.Block],
        fields: {
            ChildrenScaleX: 0,
            ChildrenScaleY: 0,
            _finalChildrenScaleX: 0,
            _finalChildrenScaleY: 0,
            Children: null
        },
        props: {
            FinalChildrenScaleX: {
                get: function () {
                    return this._finalChildrenScaleX;
                }
            },
            FinalChildrenScaleY: {
                get: function () {
                    return this._finalChildrenScaleY;
                }
            }
        },
        ctors: {
            ctor: function (x, y, w, h, horAlign, verAlign, visible) {
                if (horAlign === void 0) { horAlign = 0.5; }
                if (verAlign === void 0) { verAlign = 0.5; }
                if (visible === void 0) { visible = true; }

                this.$initialize();
                MonoInterface.Block.ctor.call(this);
                this.X = x;
                this.Y = y;
                this.W = w;
                this.H = h;
                this.ChildrenScaleX = 1.0;
                this.ChildrenScaleY = 1.0;
                this.Alpha = 1.0;
                this.Alignment = new Microsoft.Xna.Framework.Vector2.$ctor2(horAlign, verAlign);
                this.Visible = visible;
                this.Children = new (System.Collections.Generic.List$1(MonoInterface.Block)).ctor();
            }
        },
        methods: {
            AddChild: function (T, child) {
                child.Parent = this;
                this.Children.add(child);
                return child;
            },
            Draw: function (sb, parentAlpha) {
                var $t;
                if (this.Visible) {
                    $t = Bridge.getEnumerator(this.Children);
                    try {
                        while ($t.moveNext()) {
                            var child = $t.Current;
                            child.Draw(sb, parentAlpha * this.Alpha);
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                }
            },
            Click: function (x, y, isTouch) { },
            Focus: function () { },
            TapAndHold: function () { },
            CheckForRecalc: function () {
                var $t;
                if (this.IsNeedRecalc) {
                    this.Recalc();
                } else {
                    $t = Bridge.getEnumerator(this.Children);
                    try {
                        while ($t.moveNext()) {
                            var child = $t.Current;
                            child.CheckForRecalc();
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                }
            },
            Recalc: function () {
                var $t;
                MonoInterface.Block.prototype.Recalc.call(this);
                this._finalChildrenScaleX = this.ChildrenScaleX * this.Parent.FinalChildrenScaleX;
                this._finalChildrenScaleY = this.ChildrenScaleY * this.Parent.FinalChildrenScaleY;
                $t = Bridge.getEnumerator(this.Children);
                try {
                    while ($t.moveNext()) {
                        var child = $t.Current;
                        child.Recalc();
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            },
            GetContainerByPoint: function (x, y, finalX, finalY) {
                var $t;
                if (this.Visible === true && this.FinalX <= x && x <= ((this.FinalX + this.FinalW) | 0) && this.FinalY <= y && y <= ((this.FinalY + this.FinalH) | 0)) {
                    finalX.v = (x - this.FinalX) | 0;
                    finalY.v = (y - this.FinalY) | 0;
                    var cont = null;
                    $t = Bridge.getEnumerator(this.Children);
                    try {
                        while ($t.moveNext()) {
                            var child = $t.Current;
                            if (Bridge.is(child, MonoInterface.Container)) {
                                var fX = { };
                                var fY = { };
                                var c = Bridge.cast(child, MonoInterface.Container).GetContainerByPoint(x, y, fX, fY);
                                if (c != null) {
                                    finalX.v = fX.v;
                                    finalY.v = fY.v;
                                    cont = c;
                                }
                            }
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                    return cont || this;
                }
                finalX.v = 0;
                finalY.v = 0;
                return null;
            },
            GetButtonByHotKey: function (key) {
                var $t;
                var result = null;
                $t = Bridge.getEnumerator(this.Children);
                try {
                    while ($t.moveNext()) {
                        var child = $t.Current;
                        if (child.Visible) {
                            if (Bridge.is(child, MonoInterface.Button) && Bridge.cast(child, MonoInterface.Button).HotKey === key) {
                                result = Bridge.cast(child, MonoInterface.Button);
                            }
                            if (Bridge.is(child, MonoInterface.Container)) {
                                result = Bridge.cast(child, MonoInterface.Container).GetButtonByHotKey(key) || result;
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                return result;
            },
            ApplyTheme: function (currentTheme) {
                var $t;
                MonoInterface.Block.prototype.ApplyTheme.call(this, currentTheme);
                $t = Bridge.getEnumerator(this.Children);
                try {
                    while ($t.moveNext()) {
                        var child = $t.Current;
                        child.ApplyTheme(currentTheme);
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }

            },
            ApplyLocalization: function (currentLocalization) {
                var $t;
                MonoInterface.Block.prototype.ApplyLocalization.call(this, currentLocalization);
                $t = Bridge.getEnumerator(this.Children);
                try {
                    while ($t.moveNext()) {
                        var child = $t.Current;
                        child.ApplyLocalization(currentLocalization);
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
            }
        }
    });

    Bridge.define("MonoInterface.Label", {
        inherits: [MonoInterface.Block],
        fields: {
            _text: null,
            _size: 0,
            TextColor: null,
            FinalFont: null
        },
        props: {
            Text: {
                get: function () {
                    return this._text;
                },
                set: function (value) {
                    this._text = value;
                    this.IsNeedRecalc = true;
                }
            },
            Size: {
                get: function () {
                    return this._size;
                },
                set: function (value) {
                    this._size = value;
                    this.IsNeedRecalc = true;
                }
            }
        },
        ctors: {
            ctor: function (text, size, clr, x, y, horAlign, verAlign, visible) {
                if (clr === void 0) { clr = null; }
                if (x === void 0) { x = 0; }
                if (y === void 0) { y = 0; }
                if (horAlign === void 0) { horAlign = 0.5; }
                if (verAlign === void 0) { verAlign = 0.5; }
                if (visible === void 0) { visible = true; }

                this.$initialize();
                MonoInterface.Block.ctor.call(this);
                this.X = x;
                this.Y = y;
                this.W = 0;
                this.H = 0;
                this.Alpha = 1.0;
                this.Alignment = new Microsoft.Xna.Framework.Vector2.$ctor2(horAlign, verAlign);
                this.Size = size;
                this.Text = text;
                this.TextColor = System.Nullable.lift1("$clone", clr);
                this.Visible = visible;

            }
        },
        methods: {
            Recalc: function () {
                var $t, $t1;
                this.FinalFont = this.CurrentTheme.GetFont(Bridge.Int.clip32(this.Size * this.Parent.FinalChildrenScaleY));
                var wh = this.FinalFont.MeasureString(this.CurrentLocalization == null ? this.Text : this.CurrentLocalization.GetString(this.Text));
                this._finalW = ($t = Bridge.Int.clip32(wh.X), this.W = $t, $t);
                this._finalH = ($t1 = Bridge.Int.clip32(wh.Y), this.H = $t1, $t1);
                this._finalX = (this.Parent.FinalX + Bridge.Int.clip32((this.Parent.FinalChildrenScaleX * this.X + (((this.Parent.FinalW - this._finalW) | 0)) * this.Alignment.X))) | 0;
                this._finalY = (this.Parent.FinalY + Bridge.Int.clip32((this.Parent.FinalChildrenScaleY * this.Y + (((this.Parent.FinalH - this._finalH) | 0)) * this.Alignment.Y))) | 0;
                this.IsNeedRecalc = false;
            },
            Draw: function (sb, parentAlpha) {
                var $t, $t1, $t2, $t3;
                if (this.Visible && !this.IsNeedRecalc) {
                    var text = ($t = (($t1 = this.CurrentLocalization) != null ? $t1.GetString(this.Text) : null), $t != null ? $t : this.Text);
                    $t2 = Bridge.getEnumerator(text);
                    try {
                        while ($t2.moveNext()) {
                            var c = $t2.Current;
                            if (!this.FinalFont.Characters.contains(c)) {
                                System.Console.WriteLine(text);
                            }
                        }
                    } finally {
                        if (Bridge.is($t2, System.IDisposable)) {
                            $t2.System$IDisposable$Dispose();
                        }
                    }
                    sb.DrawString(this.FinalFont, text, new Microsoft.Xna.Framework.Vector2.$ctor2(this.FinalX, this.FinalY), new Microsoft.Xna.Framework.Color.$ctor2(($t3 = this.TextColor, $t3 != null ? $t3 : this.CurrentTheme.FontColor), parentAlpha * this.Alpha));
                }
            }
        }
    });

    Bridge.define("MonoInterface.ListAnimation", {
        inherits: [MonoInterface.Animation],
        fields: {
            Children: null,
            _current: 0
        },
        ctors: {
            ctor: function (onStart, onEnd) {
                this.$initialize();
                MonoInterface.Animation.ctor.call(this, onStart, onEnd);
                this.Children = new (System.Collections.Generic.List$1(MonoInterface.Animation)).ctor();
            }
        },
        methods: {
            Do: function () {
                if (this.IsRunning) {
                    this.Children.getItem(this._current).Do();
                    if (this.Children.getItem(this._current).IsCompleted) {
                        if (((this._current + 1) | 0) < this.Children.Count) {
                            this._current = (this._current + 1) | 0;
                            this.Children.getItem(this._current).Begin();
                        } else {
                            this.Complete();
                        }
                    }
                }
            },
            Begin: function () {
                this._current = 0;
                this.Children.getItem(this._current).Begin();
                return MonoInterface.Animation.prototype.Begin.call(this);
            },
            AddChild: function (T, child) {
                this.Children.add(child);
                return child;
            }
        }
    });

    Bridge.define("MonoInterface.MultiAnimation", {
        inherits: [MonoInterface.Animation],
        fields: {
            Children: null
        },
        ctors: {
            ctor: function (children) {
                if (children === void 0) { children = []; }

                this.$initialize();
                MonoInterface.Animation.ctor.call(this);
                this.Children = new (System.Collections.Generic.List$1(MonoInterface.Animation)).ctor();
                this.Children.AddRange(children);
            },
            $ctor1: function (onStart, onEnd, children) {
                if (onStart === void 0) { onStart = null; }
                if (onEnd === void 0) { onEnd = null; }
                if (children === void 0) { children = []; }

                this.$initialize();
                MonoInterface.Animation.ctor.call(this, onStart, onEnd);
                this.Children = new (System.Collections.Generic.List$1(MonoInterface.Animation)).ctor();
                this.Children.AddRange(children);
            }
        },
        methods: {
            Do: function () {
                var $t, $t1;
                if (this.IsRunning) {
                    $t = Bridge.getEnumerator(this.Children);
                    try {
                        while ($t.moveNext()) {
                            var child = $t.Current;
                            child.Do();
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                    var isEnd = true;
                    $t1 = Bridge.getEnumerator(this.Children);
                    try {
                        while ($t1.moveNext()) {
                            var child1 = $t1.Current;
                            if (!child1.IsCompleted) {
                                isEnd = false;
                            }
                        }
                    } finally {
                        if (Bridge.is($t1, System.IDisposable)) {
                            $t1.System$IDisposable$Dispose();
                        }
                    }
                    if (isEnd) {
                        this.Complete();
                    }
                }
            },
            Begin: function () {
                var $t;
                $t = Bridge.getEnumerator(this.Children);
                try {
                    while ($t.moveNext()) {
                        var child = $t.Current;
                        child.Begin();
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                return MonoInterface.Animation.prototype.Begin.call(this);
            },
            AddChild: function (T, child) {
                this.Children.add(child);
                return child;
            }
        }
    });

    Bridge.define("MonoInterface.NumberAnimation", {
        inherits: [MonoInterface.Animation],
        fields: {
            current: 0,
            startValue: 0,
            endValue: 0,
            step: 0,
            target: null,
            property: null,
            propertyInfo: null
        },
        ctors: {
            ctor: function (property, start, end, step, onStart, onEnd, target) {
                if (onStart === void 0) { onStart = null; }
                if (onEnd === void 0) { onEnd = null; }
                if (target === void 0) { target = null; }

                this.$initialize();
                MonoInterface.Animation.ctor.call(this, onStart, onEnd);
                this.property = property;
                this.startValue = start;
                this.endValue = end;
                this.step = step;

                this.target = target;
                this.propertyInfo = target != null ? Bridge.Reflection.getMembers(Bridge.getType(target), 16, 284, property) : null;

                this.IsRunning = false;
                this.IsCompleted = false;
            }
        },
        methods: {
            Do: function () {
                if (this.IsRunning) {
                    this.current += this.step;
                    if ((this.step > 0 && this.current > this.endValue) || (this.step < 0 && this.current < this.endValue)) {
                        this.current = this.endValue;
                        this.Complete();
                    }
                    Bridge.Reflection.midel(this.propertyInfo.s, this.target)(System.Convert.changeType(this.current, this.propertyInfo.rt));
                }
            },
            SetTarget: function (target) {
                this.target = target;
                this.propertyInfo = Bridge.Reflection.getMembers(Bridge.getType(target), 16, 284, this.property);
            },
            Begin: function () {
                this.current = this.startValue;
                return MonoInterface.Animation.prototype.Begin.call(this);
            }
        }
    });

    Bridge.define("MonoInterface.Picture", {
        inherits: [MonoInterface.Block],
        fields: {
            spriteRef: null
        },
        ctors: {
            init: function () {
                this.spriteRef = new MonoInterface.Appearance();
            },
            ctor: function (spriteRef, x, y, w, h, horAlign, verAlign, visible) {
                if (x === void 0) { x = 0; }
                if (y === void 0) { y = 0; }
                if (w === void 0) { w = 0; }
                if (h === void 0) { h = 0; }
                if (horAlign === void 0) { horAlign = 0.5; }
                if (verAlign === void 0) { verAlign = 0.5; }
                if (visible === void 0) { visible = true; }

                this.$initialize();
                MonoInterface.Block.ctor.call(this);
                this.spriteRef = spriteRef.$clone();
                this.X = x;
                this.Y = y;
                this.Alpha = 1.0;
                if (w === 0) {
                    this.W = spriteRef.sprite.W;
                } else {
                    this.W = w;
                }
                if (h === 0) {
                    this.H = spriteRef.sprite.H;
                } else {
                    this.H = h;
                }
                this.Alignment = new Microsoft.Xna.Framework.Vector2.$ctor2(horAlign, verAlign);

                this.Visible = visible;
            }
        },
        methods: {
            Draw: function (sb, parentAlpha) {
                if (this.Visible) {
                    this.spriteRef.Draw(sb, this.FinalX, this.FinalY, this.FinalW, this.FinalH, 0, parentAlpha * this.Alpha);
                }
            },
            ApplyTheme: function (currentTheme) {
                this.CurrentTheme = currentTheme;
            }
        }
    });

    Bridge.define("MonoInterface.Progress", {
        inherits: [MonoInterface.Block],
        fields: {
            CurrentValue: 0,
            MaxValue: 0,
            Step: 0
        },
        ctors: {
            ctor: function (curValue, maxValue, x, y, w, h, step, visible) {
                if (visible === void 0) { visible = true; }

                this.$initialize();
                MonoInterface.Block.ctor.call(this);
                this.X = x;
                this.Y = y;
                this.W = w;
                this.H = h;
                this.MaxValue = maxValue;
                this.CurrentValue = curValue;
                this.Step = step;
                this.Visible = visible;
            }
        },
        methods: {
            Draw: function (sb, parentAlpha) {
                if (this.Visible) {
                    this.CurrentTheme.ProgressBackTexture.Draw(sb, this.FinalX, this.FinalY, this.FinalW, this.FinalH);
                    if (this.MaxValue > 0) {
                        this.CurrentTheme.ProgressFrontTexture.Draw(sb, this.FinalX, this.FinalY, Bridge.Int.clip32(this.FinalW * (this.CurrentValue / this.MaxValue)), this.FinalH);
                    }
                }
            },
            ApplyTheme: function (currentTheme) {
                this.CurrentTheme = currentTheme;
            }
        }
    });

    Bridge.define("MonoInterface.Button", {
        inherits: [MonoInterface.Container],
        fields: {
            IsHighlighted: false,
            IsPressed: false,
            IsDisabled: false,
            IsSelected: false,
            HotKey: 0,
            BackTexture: null,
            FrontTexture: null,
            PressedTexture: null,
            DisabledTexture: null,
            SelectedTexture: null
        },
        events: {
            OnClick: null,
            OnFocus: null
        },
        ctors: {
            $ctor3: function (onClick, x, y, w, h, horAlign, verAlign, visible) {
                if (horAlign === void 0) { horAlign = 0.5; }
                if (verAlign === void 0) { verAlign = 0.5; }
                if (visible === void 0) { visible = true; }

                this.$initialize();
                MonoInterface.Container.ctor.call(this, x, y, w, h, horAlign, verAlign, visible);
                this.OnClick = onClick;
            },
            ctor: function (onClick, hotkey, x, y, w, h, horAlign, verAlign, visible) {
                if (horAlign === void 0) { horAlign = 0.5; }
                if (verAlign === void 0) { verAlign = 0.5; }
                if (visible === void 0) { visible = true; }

                this.$initialize();
                MonoInterface.Container.ctor.call(this, x, y, w, h, horAlign, verAlign, visible);
                this.OnClick = onClick;
                this.HotKey = hotkey;
            },
            $ctor2: function (onClick, onFocus, x, y, w, h, horAlign, verAlign, visible) {
                if (horAlign === void 0) { horAlign = 0.5; }
                if (verAlign === void 0) { verAlign = 0.5; }
                if (visible === void 0) { visible = true; }

                this.$initialize();
                MonoInterface.Container.ctor.call(this, x, y, w, h, horAlign, verAlign, visible);
                this.OnClick = onClick;
                this.OnFocus = onFocus;
            },
            $ctor1: function (onClick, onFocus, hotkey, x, y, w, h, horAlign, verAlign, visible) {
                if (horAlign === void 0) { horAlign = 0.5; }
                if (verAlign === void 0) { verAlign = 0.5; }
                if (visible === void 0) { visible = true; }

                this.$initialize();
                MonoInterface.Container.ctor.call(this, x, y, w, h, horAlign, verAlign, visible);
                this.OnClick = onClick;
                this.OnFocus = onFocus;
                this.HotKey = hotkey;
            }
        },
        methods: {
            Draw: function (sb, parentAlpha) {
                var $t, $t1, $t2, $t3, $t4;
                if (this.Visible) {
                    (($t = this.BackTexture, $t != null ? $t : this.CurrentTheme.ButtonBackTexture)).Draw(sb, this.FinalX, this.FinalY, this.FinalW, this.FinalH, 0, parentAlpha * this.Alpha);

                    if (this.IsSelected) {
                        (($t1 = this.SelectedTexture, $t1 != null ? $t1 : this.CurrentTheme.ButtonSelectedTexture)).Draw(sb, this.FinalX, this.FinalY, this.FinalW, this.FinalH, 0, parentAlpha * this.Alpha);
                    }

                    MonoInterface.Container.prototype.Draw.call(this, sb, parentAlpha);
                    if (this.IsDisabled) {
                        (($t2 = this.DisabledTexture, $t2 != null ? $t2 : this.CurrentTheme.ButtonDisabledTexture)).Draw(sb, this.FinalX, this.FinalY, this.FinalW, this.FinalH, 0, parentAlpha * this.Alpha);
                    }

                    if (this.IsHighlighted) {
                        (($t3 = this.FrontTexture, $t3 != null ? $t3 : this.CurrentTheme.ButtonFrontTexture)).Draw(sb, this.FinalX, this.FinalY, this.FinalW, this.FinalH, 0, parentAlpha * this.Alpha);
                        this.IsHighlighted = false;
                    }
                    if (this.IsPressed) {
                        (($t4 = this.FrontTexture, $t4 != null ? $t4 : this.CurrentTheme.ButtonFrontTexture)).Draw(sb, this.FinalX, this.FinalY, this.FinalW, this.FinalH, 0, parentAlpha * this.Alpha);
                        this.IsPressed = false;
                    }
                }

            },
            Click: function (x, y, isTouch) {
                if (!this.IsDisabled) {
                    !Bridge.staticEquals(this.OnClick, null) ? this.OnClick(this, isTouch) : null;
                }
            },
            Focus: function () {
                !Bridge.staticEquals(this.OnFocus, null) ? this.OnFocus(this, false) : null;
            },
            TapAndHold: function () {
                !Bridge.staticEquals(this.OnFocus, null) ? this.OnFocus(this, true) : null;
            }
        }
    });

    Bridge.define("MonoInterface.Frame", {
        inherits: [MonoInterface.Container],
        fields: {
            TopBorder: false,
            LeftBorder: false,
            RightBorder: false,
            BottomBorder: false,
            BackTexture: null
        },
        ctors: {
            ctor: function (x, y, w, h, horAlign, verAlign, visible) {
                if (horAlign === void 0) { horAlign = 0.5; }
                if (verAlign === void 0) { verAlign = 0.5; }
                if (visible === void 0) { visible = true; }

                this.$initialize();
                MonoInterface.Container.ctor.call(this, x, y, w, h, horAlign, verAlign, visible);
                this.TopBorder = true;
                this.LeftBorder = true;
                this.RightBorder = true;
                this.BottomBorder = true;
            }
        },
        methods: {
            Draw: function (sb, parentAlpha) {
                var $t, $t1, $t2, $t3, $t4, $t5, $t6, $t7, $t8, $t9;
                if (this.Visible) {
                    if (this.CurrentTheme.NineFrameBoderTexture != null) {
                        var topshift = 12, bottomshift = 12, leftshift = 12, rightshift = 12;
                        if (!this.TopBorder) {
                            topshift = 0;
                        }
                        if (!this.BottomBorder) {
                            bottomshift = 0;
                        }
                        if (!this.LeftBorder) {
                            leftshift = 0;
                        }
                        if (!this.RightBorder) {
                            rightshift = 0;
                        }
                        if (this.TopBorder && this.LeftBorder) {
                            ($t = this.CurrentTheme.NineFrameBoderTexture)[0].Draw(sb, ((this.FinalX - 12) | 0), ((this.FinalY - 12) | 0), 24, 24, 0, parentAlpha * this.Alpha);
                        }
                        if (this.TopBorder) {
                            ($t1 = this.CurrentTheme.NineFrameBoderTexture)[1].Draw(sb, ((this.FinalX + leftshift) | 0), ((this.FinalY - 12) | 0), ((((this.FinalW - leftshift) | 0) - rightshift) | 0), 24, 0, parentAlpha * this.Alpha);
                        }
                        if (this.TopBorder && this.RightBorder) {
                            ($t2 = this.CurrentTheme.NineFrameBoderTexture)[2].Draw(sb, ((((this.FinalX + this.FinalW) | 0) - 12) | 0), ((this.FinalY - 12) | 0), 24, 24, 0, parentAlpha * this.Alpha);
                        }
                        if (this.LeftBorder) {
                            ($t3 = this.CurrentTheme.NineFrameBoderTexture)[3].Draw(sb, ((this.FinalX - 12) | 0), ((this.FinalY + topshift) | 0), 24, ((((this.FinalH - bottomshift) | 0) - topshift) | 0), 0, parentAlpha * this.Alpha);
                        }

                        ($t4 = this.CurrentTheme.NineFrameBoderTexture)[4].Draw(sb, ((this.FinalX + leftshift) | 0), ((this.FinalY + topshift) | 0), ((((this.FinalW - leftshift) | 0) - rightshift) | 0), ((((this.FinalH - bottomshift) | 0) - topshift) | 0), 0, parentAlpha * this.Alpha);

                        if (this.RightBorder) {
                            ($t5 = this.CurrentTheme.NineFrameBoderTexture)[5].Draw(sb, ((((this.FinalX + this.FinalW) | 0) - 12) | 0), ((this.FinalY + topshift) | 0), 24, ((((this.FinalH - bottomshift) | 0) - topshift) | 0), 0, parentAlpha * this.Alpha);
                        }
                        if (this.BottomBorder && this.LeftBorder) {
                            ($t6 = this.CurrentTheme.NineFrameBoderTexture)[6].Draw(sb, ((this.FinalX - 12) | 0), ((((this.FinalY + this.FinalH) | 0) - 12) | 0), 24, 24, 0, parentAlpha * this.Alpha);
                        }
                        if (this.BottomBorder) {
                            ($t7 = this.CurrentTheme.NineFrameBoderTexture)[7].Draw(sb, ((this.FinalX + leftshift) | 0), ((((this.FinalY + this.FinalH) | 0) - 12) | 0), ((((this.FinalW - leftshift) | 0) - rightshift) | 0), 24, 0, parentAlpha * this.Alpha);
                        }
                        if (this.BottomBorder && this.RightBorder) {
                            ($t8 = this.CurrentTheme.NineFrameBoderTexture)[8].Draw(sb, ((((this.FinalX + this.FinalW) | 0) - 12) | 0), ((((this.FinalY + this.FinalH) | 0) - 12) | 0), 24, 24, 0, parentAlpha * this.Alpha);
                        }
                    } else {
                        (($t9 = this.BackTexture, $t9 != null ? $t9 : this.CurrentTheme.FrameBackTexture)).Draw(sb, this.FinalX, this.FinalY, this.FinalW, this.FinalH, 0, parentAlpha * this.Alpha);
                    }
                    MonoInterface.Container.prototype.Draw.call(this, sb, parentAlpha);
                }
            }
        }
    });

    Bridge.define("MonoInterface.Grid", {
        inherits: [MonoInterface.Container],
        fields: {
            Orientation: 0
        },
        ctors: {
            ctor: function (orientation, x, y, w, h, horAlign, verAlign, visible) {
                if (horAlign === void 0) { horAlign = 0.5; }
                if (verAlign === void 0) { verAlign = 0.5; }
                if (visible === void 0) { visible = true; }

                this.$initialize();
                MonoInterface.Container.ctor.call(this, x, y, w, h, horAlign, verAlign, visible);
                this.Orientation = orientation;
            }
        },
        methods: {
            AddChild: function (T, child) {
                if (this.Children.Count > 0) {
                    var cX = child.X;
                    var cY = child.Y;
                    if (this.Orientation === MonoInterface.Grid.Orientations.LeftToRight) {
                        cX = (System.Linq.Enumerable.from(this.Children, MonoInterface.Block).last().Right + child.X) | 0;
                        cY = System.Linq.Enumerable.from(this.Children, MonoInterface.Block).last().Y;
                        if (((cX + child.W) | 0) > this.W) {
                            cX = child.X;
                            cY = (System.Linq.Enumerable.from(this.Children, MonoInterface.Block).last().Bottom + child.Y) | 0;
                        }
                    } else if (this.Orientation === MonoInterface.Grid.Orientations.TopToBottom) {
                        cX = child.X;
                        cY = (System.Linq.Enumerable.from(this.Children, MonoInterface.Block).last().Bottom + child.Y) | 0;
                        if (((cY + child.H) | 0) > this.H) {
                            cX = (System.Linq.Enumerable.from(this.Children, MonoInterface.Block).last().Right + child.X) | 0;
                            cY = System.Linq.Enumerable.from(this.Children, MonoInterface.Block).last().Y;
                        }
                    }
                    child.X = cX;
                    child.Y = cY;
                }
                return MonoInterface.Container.prototype.AddChild.call(this, T, child);
            }
        }
    });

    Bridge.define("MonoInterface.LongLabel", {
        inherits: [MonoInterface.Container],
        fields: {
            _text: null,
            TextColor: null,
            FinalFont: null,
            _size: 0
        },
        props: {
            Text: {
                get: function () {
                    return this._text;
                },
                set: function (value) {
                    this._text = value;
                    this.IsNeedRecalc = true;
                }
            },
            Size: {
                get: function () {
                    return this._size;
                },
                set: function (value) {
                    this._size = value;
                    this.IsNeedRecalc = true;
                }
            }
        },
        ctors: {
            ctor: function (text, size, clr, x, y, w, horAlign, verAlign, visible) {
                if (clr === void 0) { clr = null; }
                if (x === void 0) { x = 0; }
                if (y === void 0) { y = 0; }
                if (w === void 0) { w = 0; }
                if (horAlign === void 0) { horAlign = 0.5; }
                if (verAlign === void 0) { verAlign = 0.5; }
                if (visible === void 0) { visible = true; }

                this.$initialize();
                MonoInterface.Container.ctor.call(this, x, y, w, 0, horAlign, verAlign, visible);
                this._size = size;
                this._text = text;
                this.TextColor = System.Nullable.lift1("$clone", clr);

            }
        },
        methods: {
            Recalc: function () {
                this.FinalFont = this.CurrentTheme.GetFont(this._size);
                this.Children.clear();
                var localizedText = this.CurrentLocalization != null ? this.CurrentLocalization.GetString(this._text) : this._text;
                var texts = System.String.split(localizedText, [32].map(function (i) {{ return String.fromCharCode(i); }}));
                var curtext = "";
                var lineH = Bridge.Int.clip32(this.FinalFont.MeasureString(localizedText).Y);
                var totalLines = 0;
                for (var i = 0; i < texts.length; i = (i + 1) | 0) {
                    if (this.FinalFont.MeasureString((curtext || "") + String.fromCharCode(32) + (texts[i] || "")).X > this.W && i > 0) {
                        this.AddChild(MonoInterface.Label, new MonoInterface.Label(curtext, this.Size, System.Nullable.lift1("$clone", this.TextColor), 0, Bridge.Int.mul(totalLines, lineH), this.Alignment.X, 0.0, true));
                        totalLines = (totalLines + 1) | 0;
                        curtext = (texts[i] || "") + String.fromCharCode(32);
                    } else {
                        curtext = (curtext || "") + (((texts[i] || "") + String.fromCharCode(32)) || "");
                    }
                }
                this.AddChild(MonoInterface.Label, new MonoInterface.Label(curtext.trim(), this.Size, System.Nullable.lift1("$clone", this.TextColor), 0, Bridge.Int.mul(totalLines, lineH), this.Alignment.X, 0.0, true));
                totalLines = (totalLines + 1) | 0;
                this.H = (Bridge.Int.mul(totalLines, lineH));
                MonoInterface.Container.prototype.ApplyTheme.call(this, this.CurrentTheme);
                MonoInterface.Container.prototype.Recalc.call(this);
            },
            ApplyTheme: function (currentTheme) {
                this.CurrentTheme = currentTheme;
                this.Size = this._size;
                this.Text = this._text;
            }
        }
    });

    Bridge.define("MonoInterface.Switcher", {
        inherits: [MonoInterface.Container],
        fields: {
            _current: 0,
            ItemsCount: 0,
            Pictures: null,
            Titles: null,
            Descriptions: null,
            pctMain: null,
            lblMain: null,
            lblDesc: null,
            pctMainOld: null,
            lblMainOld: null,
            Animator: null
        },
        props: {
            Current: {
                get: function () {
                    return this._current;
                },
                set: function (value) {
                    var $t, $t1, $t2, $t3, $t4;
                    if (this.pctMainOld != null) {
                        this.pctMainOld.spriteRef = ($t = this.Pictures)[this._current].$clone();
                    }
                    if (this.lblMainOld != null) {
                        this.lblMainOld.Text = ($t1 = this.Titles)[this._current];
                    }
                    this._current = value;
                    if (this._current >= this.ItemsCount) {
                        this._current = 0;
                    }
                    if (this._current < 0) {
                        this._current = (this.ItemsCount - 1) | 0;
                    }
                    if (this.pctMain != null) {
                        this.pctMain.spriteRef = ($t2 = this.Pictures)[this._current].$clone();
                    }
                    if (this.lblMain != null) {
                        this.lblMain.Text = ($t3 = this.Titles)[this._current];
                    }
                    if (this.lblDesc != null) {
                        this.lblDesc.Text = ($t4 = this.Descriptions)[this._current];
                    }
                }
            }
        },
        ctors: {
            ctor: function (pictures, titles, descriptions, current, animator, x, y, w, h, horAlign, verAlign, visible) {
                if (horAlign === void 0) { horAlign = 0.5; }
                if (verAlign === void 0) { verAlign = 0.5; }
                if (visible === void 0) { visible = true; }
                var $t, $t1;

                this.$initialize();
                MonoInterface.Container.ctor.call(this, x, y, w, h, horAlign, verAlign, visible);
                this.Pictures = pictures;
                this.Titles = titles;
                this.Descriptions = descriptions;
                this.Animator = animator;

                var pCnt = ($t = (pictures != null ? pictures.length : null), $t != null ? $t : 0);
                var tCnt = ($t1 = (titles != null ? titles.length : null), $t1 != null ? $t1 : 0);

                var maxCnt = pCnt > tCnt ? pCnt : tCnt;

                this.ItemsCount = maxCnt;
                this.Current = current;

            }
        },
        methods: {
            btnLeftClicked: function (btn, isTouch) {
                this.Current = (this.Current - 1) | 0;
                if (this.Animator != null) {
                    if (this.pctMain != null) {
                        this.Animator.AddChild(MonoInterface.MultiAnimation, new MonoInterface.MultiAnimation.$ctor1(Bridge.fn.bind(this, function () {
                            this.pctMainOld.Show();
                        }), Bridge.fn.bind(this, function () {
                            this.pctMainOld.Hide();
                        }), [new MonoInterface.NumberAnimation("X", 0, -50, -5, void 0, void 0, this.pctMainOld), new MonoInterface.NumberAnimation("Alpha", 1.0, 0, -0.1, void 0, void 0, this.pctMainOld)])).Begin();
                        this.Animator.AddChild(MonoInterface.MultiAnimation, new MonoInterface.MultiAnimation.ctor([new MonoInterface.NumberAnimation("X", 50, 0, -5, void 0, void 0, this.pctMain), new MonoInterface.NumberAnimation("Alpha", 0, 1.0, 0.1, void 0, void 0, this.pctMain)])).Begin();
                    } else if (this.lblMain != null) {
                        this.Animator.AddChild(MonoInterface.MultiAnimation, new MonoInterface.MultiAnimation.$ctor1(Bridge.fn.bind(this, function () {
                            this.lblMainOld.Show();
                        }), Bridge.fn.bind(this, function () {
                            this.lblMainOld.Hide();
                        }), [new MonoInterface.NumberAnimation("X", 0, -50, -5, void 0, void 0, this.lblMainOld), new MonoInterface.NumberAnimation("Alpha", 1.0, 0, -0.1, void 0, void 0, this.lblMainOld)])).Begin();
                        this.Animator.AddChild(MonoInterface.MultiAnimation, new MonoInterface.MultiAnimation.ctor([new MonoInterface.NumberAnimation("X", 50, 0, -5, void 0, void 0, this.lblMain), new MonoInterface.NumberAnimation("Alpha", 0, 1.0, 0.1, void 0, void 0, this.lblMain)])).Begin();
                    }
                }
            },
            btnRightClicked: function (btn, isTouch) {
                this.Current = (this.Current + 1) | 0;
                if (this.Animator != null) {
                    if (this.pctMain != null) {
                        this.Animator.AddChild(MonoInterface.MultiAnimation, new MonoInterface.MultiAnimation.$ctor1(Bridge.fn.bind(this, function () {
                            this.pctMainOld.Show();
                        }), Bridge.fn.bind(this, function () {
                            this.pctMainOld.Hide();
                        }), [new MonoInterface.NumberAnimation("X", 0, 50, 5, void 0, void 0, this.pctMainOld), new MonoInterface.NumberAnimation("Alpha", 1.0, 0, -0.1, void 0, void 0, this.pctMainOld)])).Begin();
                        this.Animator.AddChild(MonoInterface.MultiAnimation, new MonoInterface.MultiAnimation.ctor([new MonoInterface.NumberAnimation("X", -50, 0, 5, void 0, void 0, this.pctMain), new MonoInterface.NumberAnimation("Alpha", 0, 1.0, 0.1, void 0, void 0, this.pctMain)])).Begin();
                    } else if (this.lblMain != null) {
                        this.Animator.AddChild(MonoInterface.MultiAnimation, new MonoInterface.MultiAnimation.$ctor1(Bridge.fn.bind(this, function () {
                            this.lblMainOld.Show();
                        }), Bridge.fn.bind(this, function () {
                            this.lblMainOld.Hide();
                        }), [new MonoInterface.NumberAnimation("X", 0, 50, 5, void 0, void 0, this.lblMainOld), new MonoInterface.NumberAnimation("Alpha", 1.0, 0, -0.1, void 0, void 0, this.lblMainOld)])).Begin();
                        this.Animator.AddChild(MonoInterface.MultiAnimation, new MonoInterface.MultiAnimation.ctor([new MonoInterface.NumberAnimation("X", -50, 0, 5, void 0, void 0, this.lblMain), new MonoInterface.NumberAnimation("Alpha", 0, 1.0, 0.1, void 0, void 0, this.lblMain)])).Begin();
                    }
                }
            },
            ApplyTheme: function (currentTheme) {
                var $t, $t1, $t2, $t3, $t4, $t5, $t6, $t7;
                this.CurrentTheme = currentTheme;
                var btnLeft = this.AddChild(MonoInterface.Button, new MonoInterface.Button.ctor(Bridge.fn.cacheBind(this, this.btnLeftClicked), Microsoft.Xna.Framework.Input.Keys.Left, 0, 0, 45, 30, 0.0, 0.5, true));
                btnLeft.AddChild(MonoInterface.Picture, new MonoInterface.Picture(this.CurrentTheme.SwitcherButtonLeftTexture.$clone(), 0, 0, 45, 45, 0.5, 0.5, true));
                btnLeft.BackTexture = currentTheme.EmptyTexture.$clone();
                var btnRight = this.AddChild(MonoInterface.Button, new MonoInterface.Button.ctor(Bridge.fn.cacheBind(this, this.btnRightClicked), Microsoft.Xna.Framework.Input.Keys.Right, 0, 0, 45, 30, 1.0, 0.5, true));
                btnRight.AddChild(MonoInterface.Picture, new MonoInterface.Picture(this.CurrentTheme.SwitcherButtonRightTexture.$clone(), 0, 0, 45, 45, 0.5, 0.5, true));
                btnRight.BackTexture = currentTheme.EmptyTexture.$clone();
                if (this.Pictures != null) {
                    this.pctMain = this.AddChild(MonoInterface.Picture, new MonoInterface.Picture(($t = this.Pictures)[this.Current].$clone()));
                    this.pctMainOld = this.AddChild(MonoInterface.Picture, new MonoInterface.Picture(($t1 = this.Pictures)[this.Current].$clone(), 0, 0, 0, 0, 0.5, 0.5, false));
                    if (this.Titles != null) {
                        this.lblMain = this.AddChild(MonoInterface.Label, new MonoInterface.Label(($t2 = this.Titles)[this.Current], this.CurrentTheme.SwitcherMainFontSize, this.CurrentTheme.SwitcherMainColor.$clone(), 0, ((((Bridge.Int.div(((-this.H) | 0), 2)) | 0) - 20) | 0), 0.5, 1.0, true));
                        this.lblMainOld = this.AddChild(MonoInterface.Label, new MonoInterface.Label(($t3 = this.Titles)[this.Current], this.CurrentTheme.SwitcherMainFontSize, this.CurrentTheme.SwitcherMainColor.$clone(), 0, ((((Bridge.Int.div(((-this.H) | 0), 2)) | 0) - 20) | 0), 0.5, 1.0, false));
                    }
                    if (this.Descriptions != null) {
                        this.lblDesc = this.AddChild(MonoInterface.LongLabel, new MonoInterface.LongLabel(($t4 = this.Descriptions)[this.Current], this.CurrentTheme.SwitcherDescriptionFontSize, this.CurrentTheme.SwitcherDescriptionColor.$clone(), 0, ((((Bridge.Int.div(this.H, 2)) | 0) + 25) | 0), this.W, 0.5, 0.0, true));
                    }
                } else {
                    this.lblMain = this.AddChild(MonoInterface.Label, new MonoInterface.Label(($t5 = this.Titles)[this.Current], this.CurrentTheme.SwitcherMainFontSize, this.CurrentTheme.SwitcherMainColor.$clone()));
                    this.lblMainOld = this.AddChild(MonoInterface.Label, new MonoInterface.Label(($t6 = this.Titles)[this.Current], this.CurrentTheme.SwitcherMainFontSize, this.CurrentTheme.SwitcherMainColor.$clone(), 0, 0, 0.5, 0.5, false));
                    if (this.Descriptions != null) {
                        this.lblDesc = this.AddChild(MonoInterface.LongLabel, new MonoInterface.LongLabel(($t7 = this.Descriptions)[this.Current], this.CurrentTheme.SwitcherDescriptionFontSize, this.CurrentTheme.SwitcherDescriptionColor.$clone(), 0, ((((Bridge.Int.div(this.H, 2)) | 0) + 20) | 0), this.W, 0.5, 0.0, true));
                    }

                }
                MonoInterface.Container.prototype.ApplyTheme.call(this, currentTheme);
            }
        }
    });

    Bridge.define("MonoInterface.Window", {
        inherits: [MonoInterface.Container],
        ctors: {
            ctor: function (x, y, w, h, horAlign, verAlign, visible) {
                if (horAlign === void 0) { horAlign = 0.5; }
                if (verAlign === void 0) { verAlign = 0.5; }
                if (visible === void 0) { visible = true; }

                this.$initialize();
                MonoInterface.Container.ctor.call(this, x, y, w, h, horAlign, verAlign, visible);
            }
        },
        methods: {
            ClickButton: function (key) {
                var btn = this.GetButtonByHotKey(key);
                if (btn != null) {
                    btn.Click(0, 0, false);
                }
            },
            ClickButton$1: function (x, y, isTouch) {
                var fX = { };
                var fY = { };
                var cont = this.GetContainerByPoint(x, y, fX, fY);
                if (cont != null) {
                    cont.Click(fX.v, fY.v, isTouch);
                }
            },
            HighlightButton: function (x, y, mPressed) {
                var fX = { };
                var fY = { };
                var cont = this.GetContainerByPoint(x, y, fX, fY);
                var btn;
                if (((btn = Bridge.as(cont, MonoInterface.Button))) != null) {
                    btn.Focus();
                    if (!btn.IsDisabled) {
                        btn.IsHighlighted = true;

                        if (mPressed) {
                            btn.IsPressed = true;
                        }
                    }
                }
            },
            TapAndHoldButton: function (x, y) {
                var fX = { }, fY = { };
                var cont = this.GetContainerByPoint(x, y, fX, fY);
                var btn;
                if (((btn = Bridge.as(cont, MonoInterface.Button))) != null) {
                    btn.TapAndHold();
                    if (!btn.IsDisabled) {
                        btn.IsPressed = true;
                    }
                }

            },
            Recalc: function () {
                var $t;
                this._finalX = this.X;
                this._finalY = this.Y;
                this._finalW = this.W;
                this._finalH = this.H;
                this._finalChildrenScaleX = this.ChildrenScaleX;
                this._finalChildrenScaleY = this.ChildrenScaleY;
                $t = Bridge.getEnumerator(this.Children);
                try {
                    while ($t.moveNext()) {
                        var child = $t.Current;
                        child.Recalc();
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                this.IsNeedRecalc = false;
            }
        }
    });
});

//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAiZmlsZSI6ICJEYXJrS2luZ2RvbUpTLmpzIiwKICAic291cmNlUm9vdCI6ICIiLAogICJzb3VyY2VzIjogWyIuLi9EYXJrS2luZ2RvbUNvcmUvR2FtZSBsb2dpYy9BYmlsaXR5LmNzIiwiLi4vRGFya0tpbmdkb21Db3JlL0dhbWUgbG9naWMvQWNoaWV2ZW1lbnQuY3MiLCIuLi9EYXJrS2luZ2RvbUNvcmUvR2FtZSBsb2dpYy9BbW1vLmNzIiwiLi4vRGFya0tpbmdkb21Db3JlL1NoYXJlZFRoaW5ncy5jcyIsIi4uL0RhcmtLaW5nZG9tQ29yZS9HYW1lLmNzIiwiLi4vRGFya0tpbmdkb21Db3JlL0ludGVyZmFjZS5jcyIsIi4uL0RhcmtLaW5nZG9tQ29yZS9GaWxlU3lzdGVtLmNzIiwiLi4vRGFya0tpbmdkb21Db3JlL1VuaXRBYmlsaXRlcy5jcyIsIi4uL0RhcmtLaW5nZG9tQ29yZS9HYW1lIGxvZ2ljL1BsYXllci5jcyIsIi4uL0RhcmtLaW5nZG9tQ29yZS9HYW1lIGxvZ2ljL1Byb2ZpbGUuY3MiLCIuLi9EYXJrS2luZ2RvbUNvcmUvR2FtZSBsb2dpYy9QdXJjaGFzZS5jcyIsIi4uL0RhcmtLaW5nZG9tQ29yZS9HYW1lIGxvZ2ljL1JhY2UuY3MiLCIuLi9EYXJrS2luZ2RvbUNvcmUvR2FtZSBsb2dpYy9Vbml0LmNzIiwiQXBwLmNzIiwiLi4vRGFya0tpbmdkb21Db3JlL01haW5DbGFzcy5jcyIsIi4uL01vbm9JbnRlcmZhY2VDb3JlL0FuaW1hdG9yLmNzIiwiLi4vTW9ub0ludGVyZmFjZUNvcmUvU3RydWN0cy5jcyIsIi4uL01vbm9JbnRlcmZhY2VDb3JlL0ludGVyZmFjZS9CbG9jay5jcyIsIi4uL01vbm9JbnRlcmZhY2VDb3JlL0xvY2FsaXphdGlvbi5jcyIsIi4uL01vbm9JbnRlcmZhY2VDb3JlL1Nwcml0ZS5jcyIsIi4uL01vbm9JbnRlcmZhY2VDb3JlL1RoZW1lLmNzIiwiLi4vRGFya0tpbmdkb21Db3JlL1BhcnRpY2xlcy9JbWFnZVBhcnRpY2xlLmNzIiwiLi4vRGFya0tpbmdkb21Db3JlL1BhcnRpY2xlcy9UZXh0UGFydGljbGUuY3MiLCIuLi9Nb25vSW50ZXJmYWNlQ29yZS9JbnRlcmZhY2UvQ29udGFpbmVyLmNzIiwiLi4vTW9ub0ludGVyZmFjZUNvcmUvSW50ZXJmYWNlL0xhYmVsLmNzIiwiLi4vTW9ub0ludGVyZmFjZUNvcmUvSW50ZXJmYWNlL1BpY3R1cmUuY3MiLCIuLi9Nb25vSW50ZXJmYWNlQ29yZS9JbnRlcmZhY2UvUHJvZ3Jlc3MuY3MiLCIuLi9Nb25vSW50ZXJmYWNlQ29yZS9JbnRlcmZhY2UvQnV0dG9uLmNzIiwiLi4vTW9ub0ludGVyZmFjZUNvcmUvSW50ZXJmYWNlL0ZyYW1lLmNzIiwiLi4vTW9ub0ludGVyZmFjZUNvcmUvSW50ZXJmYWNlL0dyaWQuY3MiLCIuLi9Nb25vSW50ZXJmYWNlQ29yZS9JbnRlcmZhY2UvTG9uZ0xhYmVsLmNzIiwiLi4vTW9ub0ludGVyZmFjZUNvcmUvSW50ZXJmYWNlL1N3aXRjaGVyLmNzIiwiLi4vTW9ub0ludGVyZmFjZUNvcmUvSW50ZXJmYWNlL1dpbmRvdy5jcyJdLAogICJuYW1lcyI6IFsiIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OzRCQStCdUJBLEtBQVlBLElBQVFBLEtBQVlBLElBQVFBLEdBQWNBOztnQkFFakVBLFlBQU9BO2dCQUNQQSxhQUFRQTtnQkFDUkEsV0FBTUE7Z0JBQ05BLGlCQUFZQTtnQkFDWkEsZUFBVUE7Z0JBQ1ZBLGNBQVNBO2dCQUNUQSxJQUFJQTtvQkFDQUE7O29CQUVBQTs7Z0JBQ0pBO2dCQUNBQSxnQkFBV0Esc0JBQXNCQSxzQ0FBc0JBLGtCQUFhQTs7Ozs7Ozs7Ozs7Ozs7OzRCQ3BDckRBLEtBQVlBLElBQTZCQTs7Z0JBRXhEQSxZQUFPQTtnQkFDUEEsYUFBUUE7Z0JBQ1JBLGFBQVFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OzhCQ3lCQUEsSUFBUUEsR0FBWUEsSUFBVUEsSUFBVUEsS0FBV0EsS0FBV0EsS0FBV0EsVUFBc0NBLEtBQVVBLEdB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QkFBdUJBO2dCQUN2QkEsNEJBQXVCQTtnQkFDdkJBLDBCQUFzQkE7Ozs7d0JBQ2xCQTs7Ozs7OztnQkFDSkEiLAogICJzb3VyY2VzQ29udGVudCI6IFsidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29tcG9uZW50TW9kZWw7XHJcbnVzaW5nIE5ld3RvbnNvZnQuSnNvbjtcclxuXHJcbm5hbWVzcGFjZSBEYXJrS2luZ2RvbUNvcmVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIEFiaWxpdHlcclxuICAgIHtcclxuICAgICAgICBbSnNvblByb3BlcnR5KFwibmFtZVwiLCBEZWZhdWx0VmFsdWVIYW5kbGluZyA9IERlZmF1bHRWYWx1ZUhhbmRsaW5nLlBvcHVsYXRlKV1cclxuICAgICAgICBbRGVmYXVsdFZhbHVlKFwiXCIpXVxyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgbmFtZTtcclxuXHJcbiAgICAgICAgW0pzb25Qcm9wZXJ0eShcInZhbHVlXCIsIERlZmF1bHRWYWx1ZUhhbmRsaW5nID0gRGVmYXVsdFZhbHVlSGFuZGxpbmcuUG9wdWxhdGUpXVxyXG4gICAgICAgIFtEZWZhdWx0VmFsdWUoMCldXHJcbiAgICAgICAgcHVibGljIGludCB2YWx1ZTtcclxuXHJcbiAgICAgICAgW0pzb25Qcm9wZXJ0eShcIndoZW5cIiwgRGVmYXVsdFZhbHVlSGFuZGxpbmcgPSBEZWZhdWx0VmFsdWVIYW5kbGluZy5Qb3B1bGF0ZSldXHJcbiAgICAgICAgW0RlZmF1bHRWYWx1ZShcIlwiKV1cclxuICAgICAgICBwdWJsaWMgc3RyaW5nIGNvbmRpdGlvbjtcclxuXHJcbiAgICAgICAgW0pzb25Qcm9wZXJ0eShcIndoZW5WYWx1ZVwiKV1cclxuICAgICAgICBwdWJsaWMgaW50IGNvbmRudW07XHJcblxyXG4gICAgICAgIHB1YmxpYyBib29sIGNvbmRDb21wbGV0ZWQ7XHJcbiAgICAgICAgcHVibGljIEVmZmVjdFR5cGUgdHlwO1xyXG5cclxuICAgICAgICBbSnNvblByb3BlcnR5KFwiaGlkZGVuXCIpXVxyXG4gICAgICAgIHB1YmxpYyBib29sIGhpZGRlbjtcclxuICAgICAgICBwdWJsaWMgYm9vbCB1c2VkO1xyXG4gICAgICAgIHB1YmxpYyBib29sIGxvbmdUaW1lO1xyXG5cclxuICAgICAgICBwdWJsaWMgQWJpbGl0eShzdHJpbmcgbm1lLCBpbnQgbm0sIHN0cmluZyBjb24sIGludCBjbiwgRWZmZWN0VHlwZSB0LCBib29sIGgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBuYW1lID0gbm1lO1xyXG4gICAgICAgICAgICB2YWx1ZSA9IG5tO1xyXG4gICAgICAgICAgICB0eXAgPSB0O1xyXG4gICAgICAgICAgICBjb25kaXRpb24gPSBjb247XHJcbiAgICAgICAgICAgIGNvbmRudW0gPSBjbjtcclxuICAgICAgICAgICAgaGlkZGVuID0gaDtcclxuICAgICAgICAgICAgaWYgKGNvbmRpdGlvbiAhPSBcIlwiKVxyXG4gICAgICAgICAgICAgICAgY29uZENvbXBsZXRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICBjb25kQ29tcGxldGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgdXNlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBsb25nVGltZSA9IEFycmF5LkluZGV4T2Y8c3RyaW5nPihNeUdhbWUubG9uZ1RpbWVDb25kcywgY29uZGl0aW9uKSA+IC0xO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJuYW1lc3BhY2UgRGFya0tpbmdkb21Db3JlXHJcbntcclxuICAgIGNsYXNzIEFjaGlldmVtZW50XHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIHN0cmluZyBuYW1lO1xyXG4gICAgICAgIHB1YmxpYyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2UgdUljb247XHJcbiAgICAgICAgcHVibGljIHN0cmluZyBib290eTtcclxuXHJcbiAgICAgICAgcHVibGljIEFjaGlldmVtZW50KHN0cmluZyBuYW0sIE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZSB1aSwgc3RyaW5nIGJvdHkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBuYW1lID0gbmFtO1xyXG4gICAgICAgICAgICB1SWNvbiA9IHVpO1xyXG4gICAgICAgICAgICBib290eSA9IGJvdHk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW07XHJcblxyXG5uYW1lc3BhY2UgRGFya0tpbmdkb21Db3JlXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBBbW1vXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIGVudW0gQW1tb1R5cGVcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIE5vbmUsXHJcbiAgICAgICAgICAgIEFycm93LFxyXG4gICAgICAgICAgICBCaWdBcnJvdyxcclxuICAgICAgICAgICAgQm9tYixcclxuICAgICAgICAgICAgQmx1ZUJhbGwsXHJcbiAgICAgICAgICAgIFJlZEJhbGwsXHJcbiAgICAgICAgICAgIFZpb2xldEJhbGwsXHJcbiAgICAgICAgICAgIEdyZWVuQmFsbCxcclxuICAgICAgICAgICAgQnVsbGV0LFxyXG4gICAgICAgICAgICBGYXN0QXJyb3csXHJcbiAgICAgICAgICAgIEhhbW1lclxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGZsb2F0IHgsIHk7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IHZ4LCB2eTtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgYXk7XHJcbiAgICAgICAgcHVibGljIEFtbW9UeXBlIHR5cGU7XHJcbiAgICAgICAgcHVibGljIFVuaXQgdGFyZ2V0O1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBkbWc7XHJcbiAgICAgICAgcHVibGljIGJvb2wgaWdub3JlQXJtb3I7XHJcbiAgICAgICAgcHVibGljIGJvb2wgYWdpbDtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgbGlmZXRpbWU7XHJcbiAgICAgICAgcHVibGljIGJvb2wgc3RvY2sgPSBmYWxzZTtcclxuICAgICAgICBwdWJsaWMgaW50IHBscjtcclxuICAgICAgICBwdWJsaWMgVW5pdCBvd25lcjtcclxuICAgICAgICBwdWJsaWMgaW50IGltZztcclxuICAgICAgICBwdWJsaWMgYm9vbCBleHBsb3NpdmU7XHJcblxyXG4gICAgICAgIHB1YmxpYyBBbW1vKGludCBwbCwgQW1tb1R5cGUgdCwgZmxvYXQgeHgsIGZsb2F0IHl5LCBmbG9hdCB2eHgsIGZsb2F0IHZ5eSwgZmxvYXQgYXl5LCBEaWN0aW9uYXJ5PHN0cmluZywgQWJpbGl0eT4gb3duYWJpbHMsIFVuaXQgdHJnLCBmbG9hdCBkLCBib29sIGlhLCBib29sIGFnLCBmbG9hdCBsdGltZSwgYm9vbCBleHAgPSBmYWxzZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHggPSB4eDtcclxuICAgICAgICAgICAgeSA9IHl5O1xyXG4gICAgICAgICAgICB2eCA9IHZ4eDtcclxuICAgICAgICAgICAgdnkgPSB2eXk7XHJcbiAgICAgICAgICAgIGF5ID0gYXl5O1xyXG4gICAgICAgICAgICB0YXJnZXQgPSB0cmc7XHJcbiAgICAgICAgICAgIHR5cGUgPSB0O1xyXG4gICAgICAgICAgICBkbWcgPSBkO1xyXG4gICAgICAgICAgICBpZ25vcmVBcm1vciA9IGlhO1xyXG4gICAgICAgICAgICBhZ2lsID0gYWc7XHJcbiAgICAgICAgICAgIGxpZmV0aW1lID0gbHRpbWU7XHJcbiAgICAgICAgICAgIHBsciA9IHBsO1xyXG4gICAgICAgICAgICBleHBsb3NpdmUgPSBleHA7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIEFtbW8oaW50IHBsLCBBbW1vVHlwZSB0LCBmbG9hdCB4eCwgZmxvYXQgeXksIFVuaXQgb3duLCBVbml0IHRyZywgZmxvYXQgZCwgYm9vbCBpYSwgYm9vbCBhZywgZmxvYXQgbHRpbWUsIGJvb2wgZXhwID0gZmFsc2UpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmbG9hdCB0dDtcclxuICAgICAgICAgICAgZmxvYXQgYSA9IDAuMWY7XHJcbiAgICAgICAgICAgIHBsciA9IHBsO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgQW1tby5BbW1vVHlwZS5BcnJvdzpcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZ4ID0gNDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgQW1tby5BbW1vVHlwZS5CaWdBcnJvdzpcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZ4ID0gMjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgQW1tby5BbW1vVHlwZS5Cb21iOlxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdnggPSAxLjVmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWcgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSBBbW1vLkFtbW9UeXBlLkJsdWVCYWxsOlxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdnggPSAzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhID0gMC4wM2Y7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGltZyA9IDI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlIEFtbW8uQW1tb1R5cGUuUmVkQmFsbDpcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZ4ID0gMztcclxuICAgICAgICAgICAgICAgICAgICAgICAgYSA9IDAuMDNmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWcgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSBBbW1vLkFtbW9UeXBlLlZpb2xldEJhbGw6XHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2eCA9IDM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGEgPSAwLjAzZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW1nID0gMztcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgQW1tb1R5cGUuR3JlZW5CYWxsOlxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdnggPSAzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhID0gMC4wM2Y7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGltZyA9IDU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlIEFtbW8uQW1tb1R5cGUuRmFzdEFycm93OlxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdnggPSA0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSBBbW1vLkFtbW9UeXBlLkJ1bGxldDpcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGEgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2eCA9IDY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGltZyA9IDY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlIEFtbW9UeXBlLkhhbW1lcjpcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZ4ID0gMS41ZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW1nID0gNDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGV4cGxvc2l2ZSA9IGV4cDtcclxuICAgICAgICAgICAgeCA9IHh4O1xyXG4gICAgICAgICAgICB5ID0geXk7XHJcbiAgICAgICAgICAgIHZ4ICo9IE1hdGguU2lnbih0cmcueCAtIHh4KTtcclxuICAgICAgICAgICAgb3duZXIgPSBvd247XHJcbiAgICAgICAgICAgIHRhcmdldCA9IHRyZztcclxuICAgICAgICAgICAgdHlwZSA9IHQ7XHJcbiAgICAgICAgICAgIGRtZyA9IGQ7XHJcbiAgICAgICAgICAgIGlnbm9yZUFybW9yID0gaWE7XHJcbiAgICAgICAgICAgIGFnaWwgPSBhZztcclxuICAgICAgICAgICAgbGlmZXRpbWUgPSBsdGltZTtcclxuICAgICAgICAgICAgaWYgKHRyZy54ICE9IHh4KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0dCA9ICh0cmcueCAtIHh4KSAvIHZ4O1xyXG4gICAgICAgICAgICAgICAgdnkgPSAoTXlHYW1lLmhvciArIHRyZy5wYXJhbWV0ZXJzLnJlY3QuVG9wICsgMTUgLSB5eSkgLyB0dCAtIGEgKiB0dCAvIDI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgdnkgPSAtMTtcclxuICAgICAgICAgICAgYXkgPSBhO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtO1xyXG51c2luZyBNaWNyb3NvZnQuWG5hLkZyYW1ld29yay5HcmFwaGljcztcclxudXNpbmcgTWljcm9zb2Z0LlhuYS5GcmFtZXdvcms7XHJcbnVzaW5nIE5ld3RvbnNvZnQuSnNvbjtcclxudXNpbmcgU3lzdGVtLkNvbXBvbmVudE1vZGVsO1xyXG5cclxubmFtZXNwYWNlIERhcmtLaW5nZG9tQ29yZVxyXG57XHJcbiAgICBwdWJsaWMgZW51bSBQYXJUeXBlXHJcbiAgICB7XHJcbiAgICAgICAgUG9pbnQsXHJcbiAgICAgICAgVGV4dCxcclxuICAgICAgICBJbWFnZVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBlbnVtIEdhbWVTdGF0ZVxyXG4gICAge1xyXG4gICAgICAgIE1haW5NZW51LFxyXG4gICAgICAgIFByZVBsYXksXHJcbiAgICAgICAgSW5HYW1lLFxyXG4gICAgICAgIFdpbixcclxuICAgICAgICBMb3NlXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGVudW0gR2FtZVR5cGVcclxuICAgIHtcclxuICAgICAgICBSYW5kb21HVCxcclxuICAgICAgICBTdGFuZGFydEdULFxyXG4gICAgICAgIE9mZmVuY2VHVCxcclxuICAgICAgICBEZWZlbmNlR1QsXHJcbiAgICAgICAgRmlyc3RIZXJvR1RcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZW51bSBVbml0TW92ZVR5cGVcclxuICAgIHtcclxuICAgICAgICBHcm91bmRNVCxcclxuICAgICAgICBGbHlpbmdNVCxcclxuICAgICAgICBIdWdlTVRcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZW51bSBMYW5kc2NhcGVUeXBlXHJcbiAgICB7XHJcbiAgICAgICAgUGxhaW5MUyxcclxuICAgICAgICBEZXNlcnRMUyxcclxuICAgICAgICBTd2FtcExTLFxyXG4gICAgICAgIERlYXRobGFuZExTLFxyXG4gICAgICAgIE1lY2hhbmljc0xTLFxyXG4gICAgICAgIEZvcmVzdExTLFxyXG4gICAgICAgIEluZmVybm9MU1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBlbnVtIEVmZmVjdFR5cGVcclxuICAgIHtcclxuICAgICAgICBOb3JtYWwsXHJcbiAgICAgICAgQmFkLFxyXG4gICAgICAgIFBvaXNvbixcclxuICAgICAgICBHb29kXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0cnVjdCBUaW1lQ29zdFxyXG4gICAge1xyXG4gICAgICAgIFtKc29uUHJvcGVydHkoXCJtb25leVwiKV1cclxuICAgICAgICBwdWJsaWMgaW50IE1vbmV5O1xyXG5cclxuICAgICAgICBbSnNvblByb3BlcnR5KFwiZGVhdGhcIildXHJcbiAgICAgICAgcHVibGljIGludCBEZWF0aDtcclxuXHJcbiAgICAgICAgW0pzb25Qcm9wZXJ0eShcInRpbWVcIildXHJcbiAgICAgICAgcHVibGljIGludCBUaW1lO1xyXG5cclxuICAgICAgICBbSnNvblByb3BlcnR5KFwidGllclwiLCBEZWZhdWx0VmFsdWVIYW5kbGluZyA9IERlZmF1bHRWYWx1ZUhhbmRsaW5nLlBvcHVsYXRlKV1cclxuICAgICAgICBbRGVmYXVsdFZhbHVlKDEpXVxyXG4gICAgICAgIHB1YmxpYyBpbnQgVGllcjtcclxuXHJcbiAgICAgICAgcHVibGljIFRpbWVDb3N0KGludCBtb25leSwgaW50IGRlYXRoLCBpbnQgdGllciwgaW50IHRpbWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBNb25leSA9IG1vbmV5O1xyXG4gICAgICAgICAgICBEZWF0aCA9IGRlYXRoO1xyXG4gICAgICAgICAgICBUaWVyID0gdGllcjtcclxuICAgICAgICAgICAgVGltZSA9IHRpbWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFRpbWVDb3N0IG9wZXJhdG9yICsoVGltZUNvc3QgcjEsIFRpbWVDb3N0IHIyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBUaW1lQ29zdChyMS5Nb25leSArIHIyLk1vbmV5LCByMS5EZWF0aCArIHIyLkRlYXRoLCByMS5UaWVyLCByMS5UaW1lKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVGltZUNvc3Qgb3BlcmF0b3IgLShUaW1lQ29zdCByMSwgVGltZUNvc3QgcjIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFRpbWVDb3N0KHIxLk1vbmV5IC0gcjIuTW9uZXksIHIxLkRlYXRoIC0gcjIuRGVhdGgsIHIxLlRpZXIsIHIxLlRpbWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgRW5vdWdoRm9yKFRpbWVDb3N0IGNzdClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBNb25leSA+PSBjc3QuTW9uZXkgJiYgRGVhdGggPj0gY3N0LkRlYXRoICYmIFRpZXIgPj0gY3N0LlRpZXI7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdHJ1Y3QgQXR0YWNrXHJcbiAgICB7XHJcbiAgICAgICAgW0pzb25Qcm9wZXJ0eShcIm1pblwiKV1cclxuICAgICAgICBwdWJsaWMgaW50IE1pbkRhbWFnZTtcclxuXHJcbiAgICAgICAgW0pzb25Qcm9wZXJ0eShcIm1heFwiKV1cclxuICAgICAgICBwdWJsaWMgaW50IE1heERhbWFnZTtcclxuXHJcbiAgICAgICAgW0pzb25Qcm9wZXJ0eShcInJhbmdlXCIsIERlZmF1bHRWYWx1ZUhhbmRsaW5nID0gRGVmYXVsdFZhbHVlSGFuZGxpbmcuUG9wdWxhdGUpXVxyXG4gICAgICAgIFtEZWZhdWx0VmFsdWUoMSldXHJcbiAgICAgICAgcHVibGljIGludCBSYW5nZTtcclxuXHJcbiAgICAgICAgW0pzb25Qcm9wZXJ0eShcInNwZWVkXCIsIERlZmF1bHRWYWx1ZUhhbmRsaW5nID0gRGVmYXVsdFZhbHVlSGFuZGxpbmcuUG9wdWxhdGUpXVxyXG4gICAgICAgIFtEZWZhdWx0VmFsdWUoMzApXVxyXG4gICAgICAgIHB1YmxpYyBpbnQgU3BlZWQ7XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgQXR0YWNrKGludCBtbmQsIGludCBteGQsIGludCByYW5nZSwgaW50IHNwZWVkKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgTWluRGFtYWdlID0gbW5kO1xyXG4gICAgICAgICAgICBNYXhEYW1hZ2UgPSBteGQ7XHJcbiAgICAgICAgICAgIFJhbmdlID0gcmFuZ2U7XHJcbiAgICAgICAgICAgIFNwZWVkID0gc3BlZWQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIEF0dGFjayBvcGVyYXRvciArKEF0dGFjayBhdGssIGludCB2YWwpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IEF0dGFjayhhdGsuTWluRGFtYWdlICsgdmFsLCBhdGsuTWF4RGFtYWdlICsgdmFsLCBhdGsuUmFuZ2UsIGF0ay5TcGVlZCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIEF0dGFjayBvcGVyYXRvciAtKEF0dGFjayBhdGssIGludCB2YWwpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IEF0dGFjayhhdGsuTWluRGFtYWdlIC0gdmFsLCBhdGsuTWF4RGFtYWdlIC0gdmFsLCBhdGsuUmFuZ2UsIGF0ay5TcGVlZCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIEF0dGFjayBvcGVyYXRvciAqKEF0dGFjayBhdGssIGludCB2YWwpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IEF0dGFjayhhdGsuTWluRGFtYWdlICogdmFsLCBhdGsuTWF4RGFtYWdlICogdmFsLCBhdGsuUmFuZ2UsIGF0ay5TcGVlZCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIEF0dGFjayBvcGVyYXRvciArKEF0dGFjayBhdGsxLCBBdHRhY2sgYXRrMilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgQXR0YWNrKGF0azEuTWluRGFtYWdlICsgYXRrMi5NaW5EYW1hZ2UsIGF0azEuTWF4RGFtYWdlICsgYXRrMi5NYXhEYW1hZ2UsIGF0azEuUmFuZ2UgKyBhdGsyLlJhbmdlLCBhdGsxLlNwZWVkKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgQXR0YWNrIG9wZXJhdG9yIC0oQXR0YWNrIGF0azEsIEF0dGFjayBhdGsyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBBdHRhY2soYXRrMS5NaW5EYW1hZ2UgLSBhdGsyLk1pbkRhbWFnZSwgYXRrMS5NYXhEYW1hZ2UgLSBhdGsyLk1heERhbWFnZSwgYXRrMS5SYW5nZSAtIGF0azIuUmFuZ2UsIGF0azEuU3BlZWQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RydWN0IE1hdGNoQ29uZGl0aW9uXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIHN0cmluZyBuYW1lO1xyXG4gICAgICAgIHB1YmxpYyBUaW1lQ29zdCByZXMxLCByZXMyO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgaW5jb21lLCBpcHQ7XHJcblxyXG4gICAgICAgIHB1YmxpYyBNYXRjaENvbmRpdGlvbihzdHJpbmcgbm1lLCBUaW1lQ29zdCByMSwgVGltZUNvc3QgcjIsIGludCBpbmMsIGludCBpcClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIG5hbWUgPSBubWU7XHJcbiAgICAgICAgICAgIHJlczEgPSByMTtcclxuICAgICAgICAgICAgcmVzMiA9IHIyO1xyXG4gICAgICAgICAgICBpbmNvbWUgPSBpbmM7XHJcbiAgICAgICAgICAgIGlwdCA9IGlwO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwYXJ0aWFsIGNsYXNzIE15R2FtZVxyXG4gICAge1xyXG5cclxuICAgICAgICAvLyBQdWJsaWMgU2hhcmVkIHJlc01hbiBBcyBOZXcgU3lzdGVtLlJlc291cmNlcy5SZXNvdXJjZU1hbmFnZXIoXCJEYXJrS2luZ2RvbUNvcmUucmVzb3VyY2VzXCIsIFN5c3RlbS5SZWZsZWN0aW9uLkFzc2VtYmx5LilcclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgUmFuZG9tIHJuZCA9IG5ldyBSYW5kb20oKTtcclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBpbnQgZ2FtZVdpZHRoID0gODAwO1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgaW50IGdhbWVIZWlnaHQgPSA0ODA7XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBpbnQgaG9yO1xyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIERpY3Rpb25hcnk8c3RyaW5nLCBVbml0UGFyYW1ldGVycz4gdW5pdFBybXMgPSBuZXcgRGljdGlvbmFyeTxzdHJpbmcsIFVuaXRQYXJhbWV0ZXJzPigpO1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgRGljdGlvbmFyeTxzdHJpbmcsIE1vbm9JbnRlcmZhY2UuU3ByaXRlPiBzcHJpdGVzID0gbmV3IERpY3Rpb25hcnk8c3RyaW5nLCBNb25vSW50ZXJmYWNlLlNwcml0ZT4oKTtcclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBMaXN0PHN0cmluZz4gYWxsQWJpbHMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBMaXN0PHN0cmluZz4gYWxsQ29uZHMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgUGxheWVyW10gcGxycyA9IG5ldyBQbGF5ZXJbMl07XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBMaXN0PFVuaXQ+IHVuaXRzID0gbmV3IExpc3Q8VW5pdD4oKTtcclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBHYW1lU3RhdGUgZ1N0YXRlO1xyXG5cclxuXHJcbiAgICAgICAgLy8g0KfQsNGB0YLQuNGG0YtcclxuICAgICAgICBwdWJsaWMgc3RhdGljIExpc3Q8UGFydGljbGU+IHBhcnMgPSBuZXcgTGlzdDxQYXJ0aWNsZT4oKTtcclxuICAgICAgICBwdWJsaWMgc3RhdGljIExpc3Q8UGFydGljbGU+IHVpcGFycyA9IG5ldyBMaXN0PFBhcnRpY2xlPigpO1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgTGlzdDxJbWFnZVBhcnRpY2xlPiBjbG91ZHBhcnMgPSBuZXcgTGlzdDxJbWFnZVBhcnRpY2xlPigpO1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgTGlzdDxJbWFnZVBhcnRpY2xlPiBiYWNrcGFycyA9IG5ldyBMaXN0PEltYWdlUGFydGljbGU+KCk7XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBMaXN0PEltYWdlUGFydGljbGU+IGJ1c2hwYXJzID0gbmV3IExpc3Q8SW1hZ2VQYXJ0aWNsZT4oKTtcclxuXHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZ1tdIGxvbmdUaW1lQ29uZHMgPSBuZXdbXSB7IFwiVGllclwiLCBcIk1hY2hpbmUgYXJteVwiIH07XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVGV4dHVyZTJEIGZybUZpbGxUZXg7XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVGV4dHVyZTJEIGJ0bkZpbGxUZXg7XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBUZXh0dXJlMkQgYnRuU2VsZWN0VGV4O1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVGV4dHVyZTJEIGJ0bkhsVGV4O1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVGV4dHVyZTJEIGJ0blByZXNzZWRUZXg7XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBUZXh0dXJlMkQgYnRuRGlzYWJsZWRUZXg7XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVGV4dHVyZTJEIHByZ0ZpbGxUZXg7XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBUZXh0dXJlMkQgcHJnQmFyVGV4O1xyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIENvbG9yIGhsYnRuY29sb3IgPSBDb2xvci5XaGl0ZVNtb2tlO1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgQ29sb3IgZGlzYnRuYnJ1c2ggPSBuZXcgQ29sb3IoMTIwLCA3NSwgNzUsIDc1KTtcclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIEZpbGxSZWN0YW5nbGUoU3ByaXRlQmF0Y2ggc2IsIFRleHR1cmUyRCB0ZXgsIGludCB4LCBpbnQgeSwgaW50IHcsIGludCBoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgc2IuRHJhdyh0ZXgsIG5ldyBSZWN0YW5nbGUoeCwgeSwgdywgaCksIENvbG9yLldoaXRlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBGaWxsUmVjdGFuZ2xlKFNwcml0ZUJhdGNoIHNiLCBUZXh0dXJlMkQgdGV4LCBSZWN0YW5nbGUgcmVjdClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHNiLkRyYXcodGV4LCBuZXcgUmVjdGFuZ2xlKHJlY3QuWCwgcmVjdC5ZLCByZWN0LldpZHRoLCByZWN0LkhlaWdodCksIENvbG9yLldoaXRlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgTWljcm9zb2Z0LlhuYS5GcmFtZXdvcms7XHJcbnVzaW5nIE1pY3Jvc29mdC5YbmEuRnJhbWV3b3JrLkdyYXBoaWNzO1xyXG51c2luZyBNaWNyb3NvZnQuWG5hLkZyYW1ld29yay5JbnB1dDtcclxudXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7XHJcblxyXG5uYW1lc3BhY2UgRGFya0tpbmdkb21Db3JlIHtcclxuICAgIC8vLyA8c3VtbWFyeT5cclxuXHJcbiAgICAvLy8gVGhpcyBpcyB0aGUgbWFpbiB0eXBlIGZvciB5b3VyIGdhbWVcclxuXHJcbiAgICAvLy8gPC9zdW1tYXJ5PlxyXG4gICAgcHVibGljIHBhcnRpYWwgY2xhc3MgTXlHYW1lIHtcclxuICAgICAgICBwdWJsaWMgR3JhcGhpY3NEZXZpY2VNYW5hZ2VyIGdyYXBoaWNzIHsgZ2V0OyBzZXQ7IH1cclxuICAgICAgICBwdWJsaWMgU3ByaXRlQmF0Y2ggc3ByaXRlQmF0Y2ggeyBnZXQ7IHNldDsgfVxyXG5cclxuICAgICAgICBwdWJsaWMgTGlzdDxTeXN0ZW0uVmFsdWVUdXBsZTxpbnQgLFNwcml0ZUZvbnQgPj4gRm9udHM7XHJcblxyXG4gICAgICAgIHB1YmxpYyBNb25vSW50ZXJmYWNlLkxvY2FsaXphdGlvbiBsb2NhbGl6ZTtcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBNb3VzZVN0YXRlIG9sZE1vdXNlU3RhdGU7XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgUGxhdGZvcm0geyBnZXQ7IHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBib29sIGlzTG9hZGVkID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHB1YmxpYyBNeUdhbWUoc3RyaW5nIHBsYXRmb3JtKSA6IGJhc2UoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuUGxhdGZvcm0gPSBwbGF0Zm9ybTtcclxuICAgICAgICAgICAgRm9udHMgPSBuZXcgTGlzdDxTeXN0ZW0uVmFsdWVUdXBsZTxpbnQgLFNwcml0ZUZvbnQgPj4oKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBFeHBsb2RlKFVuaXQgdSwgYm9vbCBpZ25vcmVBcm1vcikge1xyXG4gICAgICAgICAgICBpbnQgYm9udXMgPSAxO1xyXG4gICAgICAgICAgICBmb3JlYWNoIChVbml0IHV1IGluIHVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodXUuQWJzQ29udGFpbnMoXCJFeHBsb2RlX2JvbnVzXCIpKVxyXG4gICAgICAgICAgICAgICAgICAgIGJvbnVzICo9IDM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZm9yZWFjaCAoVW5pdCB1dSBpbiB1bml0cykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHUuTmVhcih1dSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXV1LkFic0NvbnRhaW5zKFwiRXhwbG9kZV9wcm90ZWN0XCIpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBIYXJtKHV1LCBybmQuTmV4dCg3MCwgMTAxKSAqIGJvbnVzLCBpZ25vcmVBcm1vciwgRWZmZWN0VHlwZS5Ob3JtYWwpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChpZ25vcmVBcm1vcilcclxuICAgICAgICAgICAgICAgIHBhcnMuQWRkKG5ldyBJbWFnZVBhcnRpY2xlKG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcImV4cGxvZGVcIl0sIDMpLCB1LnggLSAyNSwgaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuQm90dG9tIC0gdXMyIC0gMjUsIDAsIDAsIDIwKSk7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHBhcnMuQWRkKG5ldyBJbWFnZVBhcnRpY2xlKG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcImV4cGxvZGVcIl0sIDApLCB1LnggLSAyNSwgaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuQm90dG9tIC0gdXMyIC0gMjUsIDAsIDAsIDIwKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBIZWFsKFVuaXQgdSwgZmxvYXQgdmFsLCBib29sIHJlcGFpciA9IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIGlmICh1LmhwIDwgdS5wYXJhbWV0ZXJzLm1heGhwICYmICF1LkFic0NvbnRhaW5zKFwiQm9keWxlc3NcIiwgXCJOb25oZWFsaW5nX3dvdW5kc1wiLCBcIkJ1aWxkaW5nXCIpICYmICghdS5BYnNDb250YWlucyhcIk1hY2hpbmVyeVwiKSB8fCByZXBhaXIpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVhbHZhbCA9IE1hdGguTWluKHZhbCwgdS5wYXJhbWV0ZXJzLm1heGhwIC0gdS5ocCk7XHJcbiAgICAgICAgICAgICAgICB1LmhwICs9IHJlYWx2YWw7XHJcbiAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihzdHJpbmcuRm9ybWF0KFwiK3swfVwiLHJlYWx2YWwpLCBnb29kQWJpbENsciwgdS54LCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Ub3AsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIGlmICghcmVwYWlyICYmIHUuQWJzQ29udGFpbnMoXCJMaWZlX3JvbGxiYWNrXCIpKVxyXG4gICAgICAgICAgICAgICAgICAgIHUuQXR0YWNrICs9IHUuYWJpbHNbXCJMaWZlX3JvbGxiYWNrXCJdLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBIYXJtKFVuaXQgdSwgZmxvYXQgdmFsLCBib29sIGlnbm9yZWFybW9yLCBFZmZlY3RUeXBlIGR0KSB7XHJcbiAgICAgICAgICAgIGlmICghdS5BYnNDb250YWlucyhcIkludnVsbmVyYWJsZVwiKSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFpZ25vcmVhcm1vcilcclxuICAgICAgICAgICAgICAgICAgICB2YWwgKj0gdS5wYXJhbWV0ZXJzLl9hcm1vcjtcclxuICAgICAgICAgICAgICAgIGlmICh2YWwgPCAxKVxyXG4gICAgICAgICAgICAgICAgICAgIHZhbCA9IDE7XHJcbiAgICAgICAgICAgICAgICB1LmhwIC09IHZhbDtcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAoZHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIEVmZmVjdFR5cGUuTm9ybWFsOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcIi1cIiArIHZhbC5Ub1N0cmluZygpLCBDb2xvci5SZWQsIHUueCwgaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuVG9wLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlIEVmZmVjdFR5cGUuQmFkOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcIi1cIiArIHZhbC5Ub1N0cmluZygpLCBiYWRBYmlsQ2xyLCB1LngsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LlRvcCwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBFZmZlY3RUeXBlLlBvaXNvbjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCItXCIgKyB2YWwuVG9TdHJpbmcoKSwgcG9pQWJpbENsciwgdS54LCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Ub3AsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodS5BYnNDb250YWlucyhcIkludmlzaWJsZVwiKSlcclxuICAgICAgICAgICAgICAgICAgICBEZWludmlzaWJsZSh1KTtcclxuICAgICAgICAgICAgICAgIGZvcmVhY2ggKEFiaWxpdHkgYSBpbiB1LmFiaWxzLlZhbHVlcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhLmNvbmRpdGlvbiA9PSBcIk9uX2hhcm1cIiAmJiAhYS51c2VkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhLmNvbmRDb21wbGV0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHUuQWJzQ29udGFpbnMoXCJEYW1hZ2VfbWlycm9yXCIpICYmIHBscnNbMSAtIHUub3duZXJdLmhlcm9Vbml0ICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgSGFybShwbHJzWzEgLSB1Lm93bmVyXS5oZXJvVW5pdCwgdmFsLCB0cnVlLCBFZmZlY3RUeXBlLkJhZCk7XHJcbiAgICAgICAgICAgIH0gZWxzZVxyXG4gICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCIwXCIsIGdvb2RBYmlsQ2xyLCB1LngsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LlRvcCwgZmFsc2UpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgRGVpbnZpc2libGUoVW5pdCB1KSB7XHJcbiAgICAgICAgICAgIHUuYWJpbHNbXCJJbnZpc2libGVcIl0udXNlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIHBhcnMuQWRkKG5ldyBJbWFnZVBhcnRpY2xlKG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcImV4cGxvZGVcIl0sIDIpLCB1LnggLSAyNSwgaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuQm90dG9tIC0gdXMyIC0gMjUsIDAsIDAsIDIwKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIHN0cmluZyBsYW5kQm1wO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgY3VyUHJvZmlsZTtcclxuXHJcblxyXG5cclxuXHJcblxyXG4gICAgICAgIHByaXZhdGUgZmxvYXQgc3VuQW5nLCBkQW5nO1xyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBTZXRQbGF5ZXJzKCkge1xyXG4gICAgICAgICAgICBwbHJzWzBdID0gbmV3IFBsYXllcih0aGlzLCAwLCBmYWxzZSwgMzApO1xyXG4gICAgICAgICAgICBwbHJzWzFdID0gbmV3IFBsYXllcih0aGlzLCAxLCB0cnVlLCAzMCk7XHJcblxyXG4gICAgICAgICAgICBwbHJzWzBdLm1vdmVzaWRlID0gMTtcclxuICAgICAgICAgICAgcGxyc1sxXS5tb3Zlc2lkZSA9IC0xO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFVwZGF0ZVF1ZXVlKCkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8PSA2OyBpKyspIHtcclxuICAgICAgICAgICAgICAgIE1vbm9JbnRlcmZhY2UuQnV0dG9uIGJ0biA9IGJ0bnNQcm9kdWN0aW9uW2ldO1xyXG4gICAgICAgICAgICAgICAgaWYgKGkgPCBwbHJzWzBdLnJlYWR5VW5pdHMuQ291bnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBidG4uVmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgKGJ0bi5DaGlsZHJlblswXSBhcyBNb25vSW50ZXJmYWNlLlBpY3R1cmUpLnNwcml0ZVJlZiA9IHVuaXRQcm1zW3BscnNbMF0ucmVhZHlVbml0c1tpXV0uaWNvbkFwcDtcclxuICAgICAgICAgICAgICAgICAgICBidG4uQ2hpbGRyZW5bMV0uVmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJnc1Byb2R1Y3Rpb25baV0uQ3VycmVudFZhbHVlID0gMDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaSAtIHBscnNbMF0ucmVhZHlVbml0cy5Db3VudCA8IHBscnNbMF0ucHJkUS5Db3VudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGJ0bi5WaXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBidG4uQ2hpbGRyZW5bMV0uVmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIChidG4uQ2hpbGRyZW5bMF0gYXMgTW9ub0ludGVyZmFjZS5QaWN0dXJlKS5zcHJpdGVSZWYgPSB1bml0UHJtc1twbHJzWzBdLnByZFFbaSAtIHBscnNbMF0ucmVhZHlVbml0cy5Db3VudF1dLmljb25BcHA7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGkgPT0gcGxyc1swXS5yZWFkeVVuaXRzLkNvdW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByZ3NQcm9kdWN0aW9uW2ldLkN1cnJlbnRWYWx1ZSA9IHBscnNbMF0ucHJkUHJnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcmdzUHJvZHVjdGlvbltpXS5NYXhWYWx1ZSA9IHVuaXRQcm1zW3BscnNbMF0ucHJkUVswXV0uQ29zdC5UaW1lO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcmdzUHJvZHVjdGlvbltpXS5DdXJyZW50VmFsdWUgPSAwO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgYnRuLlZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAocGxyc1swXS5wcmRRLkNvdW50ID09IDAgJiYgcGxyc1swXS5yZWFkeVVuaXRzLkNvdW50ID09IDApXHJcbiAgICAgICAgICAgICAgICBmcm1Qcm9kdWN0aW9uLkhpZGUobWFpbkFuaW1hdG9yKTtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgZnJtUHJvZHVjdGlvbi5TaG93KG1haW5BbmltYXRvcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBVcGRhdGVSZXNvdXJjZXMoKSB7XHJcbiAgICAgICAgICAgIGxibEdvbGRGcm1SZXNvdXJjZXMuVGV4dCA9IGN1ck0uVG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgbGJsRGVhdGhGcm1SZXNvdXJjZXMuVGV4dCA9IGN1ckQuVG9TdHJpbmcoKTtcclxuXHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGxyc1swXS51bml0c0xpc3QuQ291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgKGNVbml0cy5DaGlsZHJlbltpXSBhcyBNb25vSW50ZXJmYWNlLkJ1dHRvbikuSXNEaXNhYmxlZCA9ICFwbHJzWzBdLkNoZWNrRm9yUHJvZHVjZShwbHJzWzBdLnVuaXRzTGlzdFtpXSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHN0cmluZyB0aWVyID0gcGxyc1swXS5yZXMuVGllciA9PSAxID8gXCJUaWVyXzJcIiA6IFwiVGllcl8zXCI7XHJcbiAgICAgICAgICAgIGJ0blRpZXJVcEZybVJlc291cmNlcy5Jc0Rpc2FibGVkID0gIXBscnNbMF0ucmVzLkVub3VnaEZvcih1bml0UHJtc1t0aWVyXS5Db3N0KSB8fCBwbHJzWzBdLnByZFEuQ29udGFpbnModGllcikgfHwgcGxyc1swXS5yZXMuVGllciA9PSAzO1xyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwbHJzWzBdLnNwbGxzTGlzdC5Db3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAoY1NwZWxscy5DaGlsZHJlbltpXSBhcyBNb25vSW50ZXJmYWNlLkJ1dHRvbikuSXNEaXNhYmxlZCA9ICFwbHJzWzBdLnJlcy5Fbm91Z2hGb3Ioc3BlbGxzW3BscnNbMF0uc3BsbHNMaXN0W2ldXS5Db3N0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgT25EZWFkKFVuaXQgdSkge1xyXG4gICAgICAgICAgICBmb3JlYWNoIChBYmlsaXR5IGEgaW4gdS5hYmlscy5WYWx1ZXMpIHtcclxuICAgICAgICAgICAgICAgIGlmIChhLmNvbmRpdGlvbiA9PSBcIk9uX2RlYXRoXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgYS5jb25kQ29tcGxldGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBPblVuaXRzQWJpbHModSk7XHJcbiAgICAgICAgICAgIGlmICghdS5wYXJhbWV0ZXJzLmlzQnVpbGRpbmcpIHtcclxuICAgICAgICAgICAgICAgIGJvb2wgbmVlZEluZm87XHJcbiAgICAgICAgICAgICAgICBmb3JlYWNoIChVbml0IHV1IGluIHVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmVlZEluZm8gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodXUgIT0gdSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodXUuQWJzQ29udGFpbnMoXCJEZWF0aF9yZWFwZXJcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV1LkF0dGFjayArPSB1dS5hYmlsc1tcIkRlYXRoX3JlYXBlclwiXS52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5lZWRJbmZvID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChBYmlsaXR5IGEgaW4gdXUuYWJpbHMuVmFsdWVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYS5jb25kaXRpb24gPT0gXCJEZWF0aFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5jb25kbnVtIC09IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEuY29uZG51bSA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuY29uZGl0aW9uID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5jb25kQ29tcGxldGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmVlZEluZm8gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1dS5BYnNDb250YWlucyhcIlNwYXduX2dob3N0c1wiKSAmJiAhdS5BYnNDb250YWlucyhcIkJvZHlsZXNzXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gYWxsdW5pdHN0ID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVW5pdCBudTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKFVuaXRQYXJhbWV0ZXJzIHVwIGluIHVuaXRQcm1zLlZhbHVlcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdXAuc3BlY2lhbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXAuQWJzQ29udGFpbnMoXCJCb2R5bGVzc1wiKSAmJiB1cC5Db3N0LlRpZXIgPT0gdS5wYXJhbWV0ZXJzLkNvc3QuVGllciAmJiBwbHJzW3V1Lm93bmVyXS5DaGVja0ZvckxpbWl0KHVwLk5hbWUpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxsdW5pdHN0LkFkZCh1cC5OYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWxsdW5pdHN0LkNvdW50ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51ID0gbmV3IFVuaXQodGhpcywgdXUueCArIHV1Lm1vdmVzaWRlLCB1dS5tb3Zlc2lkZSwgdXUub3duZXIsIHVuaXRQcm1zW2FsbHVuaXRzdFtybmQuTmV4dCgwLCBhbGx1bml0c3QuQ291bnQpXV0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaHAgPSBybmQuTmV4dCg3MCwgMTAxKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSGFybSh1dSwgbnUuaHAsIHRydWUsIEVmZmVjdFR5cGUuQmFkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3JuTGlzdC5BZGQobnUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5lZWRJbmZvID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobmVlZEluZm8pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCh0LzQtdGA0YLRjCFcIiwgZ29vZEFiaWxDbHIsIHV1LngsIGhvciArIHV1LnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodXUub3duZXIgIT0gdS5vd25lciAmJiB1dS5BYnNDb250YWlucyhcIkxvb3RlclwiKSAmJiB1Lk5lYXIodXUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBscnNbdXUub3duZXJdLlJlc291cmNlcyArPSBuZXcgVGltZUNvc3QodXUuYWJpbHNbXCJMb290ZXJcIl0udmFsdWUsIDAsIDAsIDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihzdHJpbmcuRm9ybWF0KFwiK3swfVwiLHV1LmFiaWxzW1wiTG9vdGVyXCJdLnZhbHVlKSwgbW9uZXlDbHIsIHV1LngsIGhvciArIHV1LnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodXUub3duZXIgIT0gdS5vd25lciAmJiB1dS5BYnNDb250YWlucyhcIkludmlzaWJsZV9vbl9raWxsXCIpICYmIHUuTmVhcih1dSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXUuQWRkQWJpbGl0eShcIkludmlzaWJsZVwiLCBFZmZlY3RUeXBlLk5vcm1hbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwi0JjRgdGH0LXQtyFcIiwgZ29vZEFiaWxDbHIsIHV1LngsIGhvciArIHV1LnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodS5vd25lciAhPSB1dS5vd25lciAmJiB1dS5BYnNDb250YWlucyhcIk5lY3JvbWFuY3lcIikgJiYgIXUuQWJzQ29udGFpbnMoXCJVbmRlYWRcIiwgXCJNYWNoaW5lcnlcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYm9ybkxpc3QuQWRkKG5ldyBVbml0KHRoaXMsIHUueCwgdXUubW92ZXNpZGUsIHV1Lm93bmVyLCB1bml0UHJtc1tcIlNrZWxldG9uX3NxdWFkXCJdKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwi0J7QttC40LLQu9C10L0hXCIsIGdvb2RBYmlsQ2xyLCB1LngsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1LmRlYXRoRnJvbVBvaXNvbiAmJiB1dS5BYnNDb250YWlucyhcIkZsaXphcmQgc3Bhd25lclwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBib3JuTGlzdC5BZGQobmV3IFVuaXQodGhpcywgdXUueCwgdXUubW92ZXNpZGUsIHV1Lm93bmVyLCB1bml0UHJtc1tcIkZsaXphcmRcIl0pKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCLQn9C+0YDQvtC20LTQtdC9IVwiLCBwb2lBYmlsQ2xyLCB1dS54LCBob3IgKyB1dS5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHV1Lm93bmVyICE9IHUub3duZXIgJiYgdXUuQWJzQ29udGFpbnMoXCJDb3Jwc2VlYXRpbmdcIikgJiYgdS5OZWFyKHV1KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodXUuaHAgPCB1dS5wYXJhbWV0ZXJzLm1heGhwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSGVhbCh1dSwgdXUucGFyYW1ldGVycy5tYXhocCAtIHV1LmhwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHV1LkFic0NvbnRhaW5zKFwiRGV2b3VyXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXUuYWJpbHMuQ29udGFpbnNLZXkoXCJEZW55aW5nXCIpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV1LmFiaWxzW1wiRGVueWluZ1wiXS52YWx1ZSA9IHV1LmFiaWxzW1wiRGVueWluZ1wiXS52YWx1ZSArIDUwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwi0J7QsdC10LQhXCIsIGdvb2RBYmlsQ2xyLCB1dS54LCBob3IgKyB1dS5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHV1LkFic0NvbnRhaW5zKFwiRXhlY3V0aW9uXCIpICYmIHUuTmVhcih1dSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGxyc1t1dS5vd25lcl0udmljdGltY291bnQgKz0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBscnNbdXUub3duZXJdLnZpY3RpbWNvdW50ID49IDEzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gYXZ1bml0cyA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKFVuaXRQYXJhbWV0ZXJzIHVwc3RyIGluIHVuaXRQcm1zLlZhbHVlcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1cHN0ci5TdWJyYWNlID09IFwiTW9uc3RlclwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdnVuaXRzLkFkZCh1cHN0ci5OYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvcm5MaXN0LkFkZChuZXcgVW5pdCh0aGlzLCB1LngsIHV1Lm1vdmVzaWRlLCB1dS5vd25lciwgdW5pdFBybXNbYXZ1bml0c1tybmQuTmV4dChhdnVuaXRzLkNvdW50KV1dKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbHJzW3V1Lm93bmVyXS52aWN0aW1jb3VudCAtPSAxMztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwi0JLRi9C30LLQsNC9IVwiLCBnb29kQWJpbENsciwgdS54LCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKHN0cmluZy5Gb3JtYXQoXCLQldGJ0LUgezB9XCIsMTMgLSBwbHJzW3V1Lm93bmVyXS52aWN0aW1jb3VudCksIGdvb2RBYmlsQ2xyLCB1LngsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh1LkFic0NvbnRhaW5zKFwiVmljdGltXCIpKSB7XHJcbiAgICAgICAgICAgICAgICBwbHJzW3Uub3duZXJdLnZpY3RpbWNvdW50ICs9IDE7XHJcbiAgICAgICAgICAgICAgICBpZiAocGxyc1t1Lm93bmVyXS52aWN0aW1jb3VudCA+PSAxMykge1xyXG4gICAgICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBhdnVuaXRzID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKFVuaXRQYXJhbWV0ZXJzIHVwc3RyIGluIHVuaXRQcm1zLlZhbHVlcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodXBzdHIuU3VicmFjZSA9PSBcIk1vbnN0ZXJcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF2dW5pdHMuQWRkKHVwc3RyLk5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBib3JuTGlzdC5BZGQobmV3IFVuaXQodGhpcywgdS54LCB1Lm1vdmVzaWRlLCB1Lm93bmVyLCB1bml0UHJtc1thdnVuaXRzW3JuZC5OZXh0KGF2dW5pdHMuQ291bnQpXV0pKTtcclxuICAgICAgICAgICAgICAgICAgICBwbHJzW3Uub3duZXJdLnZpY3RpbWNvdW50IC09IDEzO1xyXG4gICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwi0JLRi9C30LLQsNC9IVwiLCBnb29kQWJpbENsciwgdS54LCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoc3RyaW5nLkZvcm1hdChcItCV0YnQtSB7MH1cIiwxMyAtIHBscnNbdS5vd25lcl0udmljdGltY291bnQpLCBnb29kQWJpbENsciwgdS54LCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh1LkFic0NvbnRhaW5zKFwiSW1tb3J0YWxcIikgJiYgcGxyc1t1Lm93bmVyXS5yZXMuRGVhdGggPj0gNSkge1xyXG4gICAgICAgICAgICAgICAgcGxyc1t1Lm93bmVyXS5yZXMuRGVhdGggLT0gNTtcclxuICAgICAgICAgICAgICAgIHUuaHAgPSB1LnBhcmFtZXRlcnMubWF4aHA7XHJcbiAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCY0L3QutCw0YDQvdCw0YbQuNGPXCIsIGdvb2RBYmlsQ2xyLCB1LngsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHUuQWJzQ29udGFpbnMoXCJJbmNhcm5hdGlvblwiKSAmJiBybmQuTmV4dCgxMDApIDwgMjUpIHtcclxuICAgICAgICAgICAgICAgIHUuaHAgPSB1LnBhcmFtZXRlcnMubWF4aHA7XHJcbiAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCY0L3QutCw0YDQvdCw0YbQuNGPXCIsIGdvb2RBYmlsQ2xyLCB1LngsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHUuQWJzQ29udGFpbnMoXCJVbnRlcm1pbmF0ZVwiKSkge1xyXG4gICAgICAgICAgICAgICAgdS5hYmlsc1tcIlVudGVybWluYXRlXCJdLnVzZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdS5ocCA9IDE7XHJcbiAgICAgICAgICAgICAgICB1LkFkZEFiaWxpdHkoXCJJbnZ1bG5lcmFibGVcIiwgNDAwLCBFZmZlY3RUeXBlLkdvb2QpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghdS5BYnNDb250YWlucyhcIkJvZHlsZXNzXCIpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbHRpbWUgPSA3MjAwO1xyXG4gICAgICAgICAgICAgICAgaWYgKHUucGFyYW1ldGVycy5pc0J1aWxkaW5nKVxyXG4gICAgICAgICAgICAgICAgICAgIGx0aW1lID0gLTE7XHJcbiAgICAgICAgICAgICAgICBwYXJzLkFkZChuZXcgSW1hZ2VQYXJ0aWNsZShuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbdS5wYXJhbWV0ZXJzLnNwcml0ZU5hbWVdLCBzcHJpdGVzW3UucGFyYW1ldGVycy5zcHJpdGVOYW1lXS5SYW5nZXNbXCJDb3Jwc2VcIl0uSXRlbTIpLCB1LnggKyB1LnBhcmFtZXRlcnMuaW1neCAtIHVzMiwgaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuQm90dG9tIC0gMzAgKyAyLCAwLCA1LCBsdGltZSwgdS5tb3Zlc2lkZSA9PSAtMSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGludCB2YWw7XHJcbiAgICAgICAgICAgIGlmICh1LnBhcmFtZXRlcnMuQ29zdC5Nb25leSA8IDUwKSB7XHJcbiAgICAgICAgICAgICAgICB2YWwgPSAxO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHUucGFyYW1ldGVycy5Db3N0Lk1vbmV5IDwgMTUwKSB7XHJcbiAgICAgICAgICAgICAgICB2YWwgPSAyO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHUucGFyYW1ldGVycy5Db3N0Lk1vbmV5IDwgMjUwKSB7XHJcbiAgICAgICAgICAgICAgICB2YWwgPSA1O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFsID0gMTA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHUub3duZXIgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgcGxyc1swXS5yZXMuRGVhdGggKz0gdmFsO1xyXG4gICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCIrXCIgKyB2YWwsIGRlYXRoQ2xyLCB1LngsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodS5vd25lciA9PSAwKVxyXG4gICAgICAgICAgICAgICAgcGxyc1sxXS5yZXMuRGVhdGggKz0gdmFsO1xyXG4gICAgICAgICAgICBpZiAodSA9PSBzZWxVKVxyXG4gICAgICAgICAgICAgICAgc2VsVSA9IG51bGw7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHByaXZhdGUgR2FtZVR5cGUgZ1R5cGU7XHJcblxyXG4gICAgICAgIHByaXZhdGUgTGFuZHNjYXBlVHlwZSBnYW1lbGFuZHNjYXBlO1xyXG5cclxuICAgICAgICBwcml2YXRlIGludCBsYW5kc1R5cGVzQ291bnQgPSA3O1xyXG5cclxuICAgICAgICBwcml2YXRlIExpc3Q8QW1tbz4gYW1tb3MgPSBuZXcgTGlzdDxBbW1vPigpO1xyXG5cclxuICAgICAgICBwdWJsaWMgRGljdGlvbmFyeTxzdHJpbmcsIFNwZWxsPiBzcGVsbHMgPSBuZXcgRGljdGlvbmFyeTxzdHJpbmcsIFNwZWxsPigpO1xyXG5cclxuICAgICAgICAvLyDQktC90LXRiNC90LjQuSDQstC40LRcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBMaXN0PFBhcnRpY2xlPiBwZGVhdGhsaXN0ID0gbmV3IExpc3Q8UGFydGljbGU+KCk7XHJcblxyXG4gICAgICAgIHByaXZhdGUgQ29sb3IgbGlmZUNsciA9IG5ldyBDb2xvcigyNTUsIDAsIDAsIDIwMCk7XHJcbiAgICAgICAgcHJpdmF0ZSBDb2xvciBhYmlsQ2xyID0gbmV3IENvbG9yKDAsIDAsIDI1NSwgMjAwKTtcclxuICAgICAgICBwcml2YXRlIENvbG9yIGJhY2tDbHIgPSBuZXcgQ29sb3IoMjU1LCAyNTUsIDI1NSwgMTUwKTtcclxuXHJcblxyXG4gICAgICAgIHByaXZhdGUgQ29sb3IgY29uZENsciA9IG5ldyBDb2xvcigxMDAsIDEwMCwgMTAwKTtcclxuXHJcbiAgICAgICAgLy8g0J/QsNGA0LDQvNC10YLRgNGLINC/0L7Qu9GPXHJcbiAgICAgICAgcHVibGljIGludCB1bml0U2l6ZSA9IDMwO1xyXG5cclxuICAgICAgICBwdWJsaWMgaW50IHVzMiA9IDE1O1xyXG5cclxuICAgICAgICBwcml2YXRlIHN0YXRpYyBDb2xvciBnb29kQWJpbENscjtcclxuICAgICAgICBwcml2YXRlIHN0YXRpYyBDb2xvciBiYWRBYmlsQ2xyID0gQ29sb3IuRGFya1Zpb2xldDtcclxuICAgICAgICBwcml2YXRlIHN0YXRpYyBDb2xvciBwb2lBYmlsQ2xyID0gQ29sb3IuRGFya1Zpb2xldDtcclxuXHJcbiAgICAgICAgLy8g0J3QtdCx0L5cclxuICAgICAgICBwcml2YXRlIGZsb2F0IGNzUywgc25TO1xyXG4gICAgICAgIHByaXZhdGUgZmxvYXQgY3NELCBzbkQ7XHJcbiAgICAgICAgcHJpdmF0ZSBmbG9hdCBza3lSLCBza3lCLCBza3lHO1xyXG4gICAgICAgIHByaXZhdGUgZmxvYXQgc2t5UjIsIHNreUIyLCBza3lHMjtcclxuICAgICAgICBwcml2YXRlIGZsb2F0IGNuc3RSID0gNTA7XHJcbiAgICAgICAgcHJpdmF0ZSBmbG9hdCBjbnN0RyA9IDEzMDtcclxuICAgICAgICBwcml2YXRlIGZsb2F0IGNuc3RCID0gMjAwO1xyXG4gICAgICAgIHByaXZhdGUgZmxvYXQgY25zdFIyID0gMTIwO1xyXG4gICAgICAgIHByaXZhdGUgZmxvYXQgY25zdEcyID0gMTkwO1xyXG4gICAgICAgIHByaXZhdGUgZmxvYXQgY25zdEIyID0gMjMwO1xyXG4gICAgICAgIHByaXZhdGUgVmVjdG9yMltdIHN0YXJzO1xyXG4gICAgICAgIHByaXZhdGUgUmVjdGFuZ2xlIHNreXJlY3Q7XHJcbiAgICAgICAgcHJpdmF0ZSBpbnQgc3RhcnNDbnQ7XHJcblxyXG5cclxuICAgICAgICAvLyDQkdCw0LfQvtCy0LDRjyDQvNC10YXQsNC90LjQutCwXHJcbiAgICAgICAgcHVibGljIGJvb2wgX3BhdXNlO1xyXG5cclxuXHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgTGlzdDxzdHJpbmc+IHN0YXJ0QnVpbGRpbmdzTGlzdCA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBpbnQgY3VyTSwgY3VyRDtcclxuXHJcblxyXG5cclxuICAgICAgICAvLyDQrtC90LjRgtGLXHJcblxyXG4gICAgICAgIHByaXZhdGUgVW5pdCBzZWxVO1xyXG5cclxuXHJcblxyXG4gICAgICAgIC8vINCS0YDQtdC80LXQvdC90YvQtSDQv9C10YDQtdC80LXQvdGL0LVcclxuICAgICAgICBwcml2YXRlIGZsb2F0IGRlbHRheCwgZGVsdGF5O1xyXG4gICAgICAgIHByaXZhdGUgTGlzdDxVbml0PiBkZWF0aGxpc3QgPSBuZXcgTGlzdDxVbml0PigpO1xyXG4gICAgICAgIHByaXZhdGUgaW50IGZseUhlaWdodCA9IDQ4O1xyXG4gICAgICAgIHByaXZhdGUgZmxvYXQgcGllY2UgPSAwLjAzOTI2OTkxRjtcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBMaXN0PE1hdGNoQ29uZGl0aW9uPiBjb25kcyA9IG5ldyBMaXN0PE1hdGNoQ29uZGl0aW9uPigpO1xyXG5cclxuXHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIERpY3Rpb25hcnk8c3RyaW5nLCBzdHJpbmc+IGxvYyA9IG5ldyBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPigpO1xyXG5cclxuICAgICAgICBwcml2YXRlIExpc3Q8c3RyaW5nPiByYWNlczEsIHJhY2VzMjtcclxuICAgICAgICBwcml2YXRlIExpc3Q8c3RyaW5nPiBlZHVuaXRzID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG5cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBSZWN0YW5nbGVbXSBzeW1ib2xzID0gbmV3IFJlY3RhbmdsZVs0XTtcclxuXHJcblxyXG5cclxuICAgICAgICAvLyBEaW0gYXJyUGVuIEFzIE5ldyBQZW4oQ29sb3IuQmxhY2ssIDEpXHJcbiAgICAgICAgLy8gRGltIGJBcnJQZW4gQXMgTmV3IFBlbihDb2xvci5CbGFjaywgMilcclxuXHJcbiAgICAgICAgcHVibGljIGNvbnN0IGludCBlbGFwc2VfUGVyaW9kaWNhbGx5ID0gMTtcclxuXHJcblxyXG4gICAgICAgIHByaXZhdGUgYm9vbCBpc3BsbG1vZCA9IGZhbHNlO1xyXG4gICAgICAgIHByaXZhdGUgc3RyaW5nIHNwZWxsTmFtZSA9IFwiXCI7XHJcblxyXG4gICAgICAgIC8vIERpbSBhdHRhY2tQZW4gQXMgTmV3IFBlbihOZXcgQ29sb3IoMTUwLCAyNTUsIDAsIDApLCAyKVxyXG4gICAgICAgIC8vIERpbSBhYmlsUGVuIEFzIE5ldyBQZW4oTmV3IENvbG9yKDE1MCwgMCwgMCwgMTUwKSwgMilcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBUZXh0dXJlMkQgc3RhclRleDtcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBDb2xvciBzdW5zZXRjbHIgPSBDb2xvci5PcmFuZ2VSZWQ7XHJcblxyXG4gICAgICAgIHByaXZhdGUgaW50IG1hY2hpbmVudW07XHJcblxyXG4gICAgICAgIHByaXZhdGUgTGlzdDxVbml0PiBib3JuTGlzdCA9IG5ldyBMaXN0PFVuaXQ+KCk7XHJcblxyXG4gICAgICAgIHByaXZhdGUgZmxvYXQgb2xkc25TO1xyXG5cclxuICAgICAgICBwcml2YXRlIGZsb2F0IGdsb2JhbEV4cGxvZGUgPSAwO1xyXG5cclxuICAgICAgICBwcml2YXRlIExpc3Q8c3RyaW5nPiB1bmxvY2tlZFVuaXRzID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG4gICAgICAgIHByaXZhdGUgTGlzdDxzdHJpbmc+IHVubG9ja2VkQWNoaXZzID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG5cclxuICAgICAgICBwcml2YXRlIGJvb2wgdXBkYXRlU3BlbGxzID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHByaXZhdGUgQ29sb3IgbW9uZXlDbHIgPSBDb2xvci5DaG9jb2xhdGU7XHJcbiAgICAgICAgcHJpdmF0ZSBDb2xvciBkZWF0aENsciA9IENvbG9yLlJveWFsQmx1ZTtcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBMaXN0PHN0cmluZz4gQWxsVW50c0xpc3QgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcblxyXG4gICAgICAgIHByaXZhdGUgYm9vbCBzdGFydEF1dG9maWdodCA9IGZhbHNlO1xyXG5cclxuICAgICAgICBwcml2YXRlIERpY3Rpb25hcnk8c3RyaW5nLCBBY2hpZXZlbWVudD4gYWNoaXZzID0gbmV3IERpY3Rpb25hcnk8c3RyaW5nLCBBY2hpZXZlbWVudD4oKTtcclxuICAgICAgICBwcml2YXRlIERpY3Rpb25hcnk8c3RyaW5nLCBQdXJjaGFzZT4gcHVyY2hhc2VzID0gbmV3IERpY3Rpb25hcnk8c3RyaW5nLCBQdXJjaGFzZT4oKTtcclxuICAgICAgICBwcml2YXRlIExpc3Q8c3RyaW5nPiBzdGFuZGFydFJhY2VzID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG5cclxuICAgICAgICBwcml2YXRlIExpc3Q8c3RyaW5nPiBwcmVHYW1lVW5pdHMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcbiAgICAgICAgcHJpdmF0ZSBMaXN0PHN0cmluZz4gcHJlR2FtZVNwZWxscyA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuICAgICAgICBwcml2YXRlIExpc3Q8c3RyaW5nPiBwcmVHYW1lQm9udXMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcblxyXG5cclxuICAgICAgICBwcml2YXRlIGludCBwcmVHYW1lU2xvdENudCA9IDEwO1xyXG5cclxuICAgICAgICBwcml2YXRlIExpc3Q8TW9ub0ludGVyZmFjZS5GcmFtZT4gbWVudUNhcm91c2VsO1xyXG4gICAgICAgIHByaXZhdGUgaW50IGN1ckNhcm91c2VsUG9zID0gMDtcclxuXHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBpblNwZWxsTW9kZSB7XHJcbiAgICAgICAgICAgIGdldCB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaXNwbGxtb2Q7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0IHtcclxuICAgICAgICAgICAgICAgIGlzcGxsbW9kID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBMaXN0PHN0cmluZz4gUmFuZG9taXplVW5pdHMoaW50IHVjbnQsIExpc3Q8c3RyaW5nPiB1TGlzdCwgYm9vbCBzcGVjaWFsaGVybykge1xyXG4gICAgICAgICAgICBMaXN0PHN0cmluZz4gdW50cyA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuICAgICAgICAgICAgaWYgKHVjbnQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gYWxsdW5pdHN0MSA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBhbGx1bml0c3QyID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG4gICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IGFsbHVuaXRzdDMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcbiAgICAgICAgICAgICAgICBpbnQgYWxsdW5pdHNjb3VudCA9IDA7XHJcblxyXG4gICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IGFsbHVuaXRzID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG4gICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IGhlcm91bml0cyA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpbnQgdDFjbnQsIHQyY250LCB0M2NudDtcclxuICAgICAgICAgICAgICAgIGludCB1O1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICBmb3JlYWNoIChzdHJpbmcgdXAgaW4gdUxpc3QpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc3BlY2lhbGhlcm8pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVuaXRQcm1zW3VwXS5pc0hlcm9pYylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlcm91bml0cy5BZGQodXApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGx1bml0cy5BZGQodXApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbGx1bml0cy5BZGQodXApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChzcGVjaWFsaGVybyAmJiBoZXJvdW5pdHMuQ291bnQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdW50cy5BZGQoaGVyb3VuaXRzW3JuZC5OZXh0KGhlcm91bml0cy5Db3VudCldKTtcclxuICAgICAgICAgICAgICAgICAgICB1Y250IC09IDE7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAoc3RyaW5nIHVwIGluIGFsbHVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh1bml0UHJtc1t1cF0uQ29zdC5UaWVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsbHVuaXRzdDEuQWRkKHVwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsbHVuaXRzdDIuQWRkKHVwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsbHVuaXRzdDMuQWRkKHVwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYWxsdW5pdHNjb3VudCArPSAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChhbGx1bml0c2NvdW50IDwgdWNudClcclxuICAgICAgICAgICAgICAgICAgICB1Y250ID0gYWxsdW5pdHNjb3VudDtcclxuXHJcbiAgICAgICAgICAgICAgICB0M2NudCA9IDE7XHJcbiAgICAgICAgICAgICAgICB0MmNudCA9ICh1Y250IC0gdDNjbnQpIC8gMjtcclxuICAgICAgICAgICAgICAgIHQxY250ID0gdWNudCAtIHQyY250IC0gdDNjbnQ7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHQxY250ID09IDAgJiYgdDJjbnQgPT0gMCAmJiBhbGx1bml0c3QyLkNvdW50ID4gMClcclxuICAgICAgICAgICAgICAgICAgICB0MmNudCA9IDE7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIHdoaWxlICh0M2NudCA+IDAgJiYgYWxsdW5pdHN0My5Db3VudCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB1ID0gcm5kLk5leHQoYWxsdW5pdHN0My5Db3VudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdW50cy5BZGQoYWxsdW5pdHN0M1t1XSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYWxsdW5pdHN0My5SZW1vdmVBdCh1KTtcclxuICAgICAgICAgICAgICAgICAgICB0M2NudCAtPSAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHQxY250ICs9IHQzY250O1xyXG5cclxuICAgICAgICAgICAgICAgIHdoaWxlICh0MWNudCA+IDAgJiYgYWxsdW5pdHN0MS5Db3VudCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB1ID0gcm5kLk5leHQoYWxsdW5pdHN0MS5Db3VudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdW50cy5BZGQoYWxsdW5pdHN0MVt1XSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYWxsdW5pdHN0MS5SZW1vdmVBdCh1KTtcclxuICAgICAgICAgICAgICAgICAgICB0MWNudCAtPSAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHQyY250ICs9IHQxY250O1xyXG5cclxuICAgICAgICAgICAgICAgIHdoaWxlICh0MmNudCA+IDAgJiYgYWxsdW5pdHN0Mi5Db3VudCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB1ID0gcm5kLk5leHQoYWxsdW5pdHN0Mi5Db3VudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdW50cy5BZGQoYWxsdW5pdHN0Mlt1XSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYWxsdW5pdHN0Mi5SZW1vdmVBdCh1KTtcclxuICAgICAgICAgICAgICAgICAgICB0MmNudCAtPSAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdW50cyA9IFNvcnRVbml0c0xpc3RzKHVudHMpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdW50cztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBMaXN0PHN0cmluZz4gUmFuZG9taXplU3BlbGxzKGludCBzQ250LCBMaXN0PHN0cmluZz4gc0xpc3QpIHtcclxuICAgICAgICAgICAgTGlzdDxzdHJpbmc+IHNwbGxzID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG4gICAgICAgICAgICBpZiAoc0NudCA+IDApIHtcclxuICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBzcGVsbHN0MSA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBzcGVsbHN0MiA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBzcGVsbHN0MyA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgaW50IHQxY250LCB0MmNudCwgdDNjbnQ7XHJcbiAgICAgICAgICAgICAgICBpbnQgdTtcclxuXHJcbiAgICAgICAgICAgICAgICBmb3JlYWNoIChzdHJpbmcgc3AgaW4gc0xpc3QpIHtcclxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHNwZWxsc1tzcF0uQ29zdC5UaWVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwZWxsc3QxLkFkZChzcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGVsbHN0Mi5BZGQoc3ApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BlbGxzdDMuQWRkKHNwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdDNjbnQgPSBzQ250IC8gMztcclxuICAgICAgICAgICAgICAgIHQyY250ID0gc0NudCAvIDM7XHJcbiAgICAgICAgICAgICAgICB0MWNudCA9IHNDbnQgLSB0MmNudCAtIHQzY250O1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICB3aGlsZSAodDFjbnQgPiAwICYmIHNwZWxsc3QxLkNvdW50ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHUgPSBybmQuTmV4dChzcGVsbHN0MS5Db3VudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc3BsbHMuQWRkKHNwZWxsc3QxW3VdKTtcclxuICAgICAgICAgICAgICAgICAgICBzcGVsbHN0MS5SZW1vdmVBdCh1KTtcclxuICAgICAgICAgICAgICAgICAgICB0MWNudCAtPSAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHQyY250ICs9IHQxY250O1xyXG5cclxuICAgICAgICAgICAgICAgIHdoaWxlICh0MmNudCA+IDAgJiYgc3BlbGxzdDIuQ291bnQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdSA9IHJuZC5OZXh0KHNwZWxsc3QyLkNvdW50KTtcclxuICAgICAgICAgICAgICAgICAgICBzcGxscy5BZGQoc3BlbGxzdDJbdV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHNwZWxsc3QyLlJlbW92ZUF0KHUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHQyY250IC09IDE7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdDNjbnQgKz0gdDJjbnQ7XHJcblxyXG4gICAgICAgICAgICAgICAgd2hpbGUgKHQzY250ID4gMCAmJiBzcGVsbHN0My5Db3VudCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB1ID0gcm5kLk5leHQoc3BlbGxzdDMuQ291bnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNwbGxzLkFkZChzcGVsbHN0M1t1XSk7XHJcbiAgICAgICAgICAgICAgICAgICAgc3BlbGxzdDMuUmVtb3ZlQXQodSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdDNjbnQgLT0gMTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBzcGxscyA9IFNvcnRTcGVsbHNMaXN0cyhzcGxscyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBzcGxscztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBMaXN0PHN0cmluZz4gUmFuZG9taXplQnVpbGRpbmdzKGludCBiQ250LCBMaXN0PHN0cmluZz4gYkxpc3QpIHtcclxuICAgICAgICAgICAgTGlzdDxzdHJpbmc+IGJ1aWxkaW5ncyA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChiQ250ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IHRtcEJsZExpc3QgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcbiAgICAgICAgICAgICAgICB0bXBCbGRMaXN0LkFkZFJhbmdlKGJMaXN0KTtcclxuICAgICAgICAgICAgICAgIGludCByO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKGJDbnQgPiAwICYmIHRtcEJsZExpc3QuQ291bnQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgciA9IHJuZC5OZXh0KHRtcEJsZExpc3QuQ291bnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJ1aWxkaW5ncy5BZGQodG1wQmxkTGlzdFtyXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdG1wQmxkTGlzdC5SZW1vdmVBdChyKTtcclxuICAgICAgICAgICAgICAgICAgICBiQ250IC09IDE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBidWlsZGluZ3M7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBidG5TcGVsbF9DbGlja2VkKE1vbm9JbnRlcmZhY2UuQnV0dG9uIGJ0biwgYm9vbCBpc1RvdWNoKSB7XHJcbiAgICAgICAgICAgIHZhciBpbmQgPSBjU3BlbGxzLkNoaWxkcmVuLkluZGV4T2YoYnRuKTtcclxuICAgICAgICAgICAgaWYgKChwbHJzWzBdLnNwZWxsc1JjaHJnW2luZF0gPT0gMCkpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzcGVsbHNbcGxyc1swXS5zcGxsc0xpc3RbaW5kXV0uVGFyZ2V0ID09IFNwZWxsLlRhcmdldFR5cGUuVW5pdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGluU3BlbGxNb2RlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBzcGVsbE5hbWUgPSBwbHJzWzBdLnNwbGxzTGlzdFtpbmRdO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgRG9HbG9iYWxTcGVsbHMocGxyc1swXS5zcGxsc0xpc3RbaW5kXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBidG5TcGVsbF9Gb2N1c2VkKE1vbm9JbnRlcmZhY2UuQnV0dG9uIGJ0biwgYm9vbCBpc1RvdWNoKSB7XHJcbiAgICAgICAgICAgIHZhciBpbmQgPSBjU3BlbGxzLkNoaWxkcmVuLkluZGV4T2YoYnRuKTtcclxuICAgICAgICAgICAgdmFyIHNwbCA9IHNwZWxsc1twbHJzWzBdLnNwbGxzTGlzdFtpbmRdXTtcclxuICAgICAgICAgICAgU2hvd01vcmVJbmZvKHNwbC5Db3N0LCB0cnVlLCBkZWZhdWx0KFBvaW50KSwgbG9jYWxpemUuR2V0U3RyaW5nKHNwbC5OYW1lKSwgbG9jYWxpemUuR2V0U3RyaW5nKHNwbC5TY2hvb2wsIHNwbC5Db3N0LlRpZXIpLCBzcGwuRGVzY3JpcHRpb24pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgU2V0U3BlbGxzKCkge1xyXG4gICAgICAgICAgICBpZiAocGxyc1swXS5zcGxsc0xpc3QuQ291bnQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBjU3BlbGxzLkNoaWxkcmVuLkNsZWFyKCk7XHJcbiAgICAgICAgICAgICAgICBpbnQgZCA9IDA7XHJcbiAgICAgICAgICAgICAgICBpbnQgb2xkdCA9IHNwZWxsc1twbHJzWzBdLnNwbGxzTGlzdFswXV0uQ29zdC5UaWVyO1xyXG4gICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwbHJzWzBdLnNwbGxzTGlzdC5Db3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNwZWxsc1twbHJzWzBdLnNwbGxzTGlzdFtpXV0uQ29zdC5UaWVyICE9IG9sZHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZCArPSA3O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvbGR0ID0gc3BlbGxzW3BscnNbMF0uc3BsbHNMaXN0W2ldXS5Db3N0LlRpZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgYnRuID0gY1NwZWxscy5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkJ1dHRvbj4obmV3IE1vbm9JbnRlcmZhY2UuQnV0dG9uKGJ0blNwZWxsX0NsaWNrZWQsIGJ0blNwZWxsX0ZvY3VzZWQsIG51bUtleXNbaV0sIGkgKiA3MCArIGQsIDAsIDYwLCA2MCwgaG9yQWxpZ246IDAuMGYpKTtcclxuICAgICAgICAgICAgICAgICAgICBidG4uQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5QaWN0dXJlPihuZXcgTW9ub0ludGVyZmFjZS5QaWN0dXJlKG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcInNwZWxsc19pY29uc1wiXSwgc3BlbGxzW3BscnNbMF0uc3BsbHNMaXN0W2ldXS5JbWcpLCB3OiA2MCwgaDogNjApKTtcclxuICAgICAgICAgICAgICAgICAgICBidG4uQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5Qcm9ncmVzcz4obmV3IE1vbm9JbnRlcmZhY2UuUHJvZ3Jlc3MoMCwgMCwgMCwgMCwgNjAsIDYwLCAwKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcGxyc1swXS5zcGVsbHNSY2hyZy5BZGQoMCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjU3BlbGxzLkFwcGx5VGhlbWUoZGVmYXVsdFRoZW1lKTtcclxuICAgICAgICAgICAgICAgIGNTcGVsbHMuVyA9IFN5c3RlbS5MaW5xLkVudW1lcmFibGUuTGFzdDxNb25vSW50ZXJmYWNlLkJsb2NrPihjU3BlbGxzLkNoaWxkcmVuKS5GaW5hbFJpZ2h0O1xyXG4gICAgICAgICAgICAgICAgYnRuU2VsZWN0U3BlbGxzLklzRGlzYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICAgICAgICBidG5TZWxlY3RTcGVsbHMuSXNEaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBDcmVhdGVBY2hpZXZlbWVudHMoKSB7XHJcbiAgICAgICAgICAgIGFjaGl2cy5BZGQoXCJTdGFydHBhdGhcIiwgbmV3IEFjaGlldmVtZW50KFwiU3RhcnRwYXRoXCIsIG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcImJvbnVzX2ljb25zXCJdLCAzKSwgXCI1Y3J5c3RhbHNcIikpO1xyXG4gICAgICAgICAgICBhY2hpdnMuQWRkKFwiQWxpdHRsZWhhcmRlclwiLCBuZXcgQWNoaWV2ZW1lbnQoXCJBbGl0dGxlaGFyZGVyXCIsIG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcIm1lZGl1bV9pY29uc1wiXSwgMTEpLCBcIjEwY3J5c3RhbHNcIikpO1xyXG5cclxuICAgICAgICAgICAgYWNoaXZzLkFkZChcIkdlbnRsZWxlYWRlclwiLCBuZXcgQWNoaWV2ZW1lbnQoXCJHZW50bGVsZWFkZXJcIiwgbmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW1wiYm9udXNfaWNvbnNcIl0sIDgpLCBcIjI1Y3J5c3RhbHNcIikpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIC8vIGFjaGl2cy5BZGQoXCJTYWNyaWZhY2VpbmJhdHRsZVwiLCBOZXcgQWNoaWV2ZW1lbnQoXCJTYWNyaWZhY2VpbmJhdHRsZVwiLCBOZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJ1bml0c19pY29uc1wiXSwgMTEzKSkpXHJcbiAgICAgICAgICAgIGFjaGl2cy5BZGQoXCJUcnVlbWFnZVwiLCBuZXcgQWNoaWV2ZW1lbnQoXCJUcnVlbWFnZVwiLCBuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJib251c19pY29uc1wiXSwgMSksIFwiMjVjcnlzdGFsc1wiKSk7XHJcblxyXG4gICAgICAgICAgICBhY2hpdnMuQWRkKFwiT3BlbmVkaXRvclwiLCBuZXcgQWNoaWV2ZW1lbnQoXCJPcGVuZWRpdG9yXCIsIG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcImJpZ19pY29uc1wiXSwgMiksIFwiMXVuaXRcIikpO1xyXG4gICAgICAgICAgICBhY2hpdnMuQWRkKFwiU2hhbWVjaGVhdGVyc1wiLCBuZXcgQWNoaWV2ZW1lbnQoXCJTaGFtZWNoZWF0ZXJzXCIsIG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcImJvbnVzX2ljb25zXCJdLCA3KSwgXCIxdW5pdFwiKSk7XHJcblxyXG4gICAgICAgICAgICBhY2hpdnMuQWRkKFwiRmlyc3RwdXJjaGFzZVwiLCBuZXcgQWNoaWV2ZW1lbnQoXCJGaXJzdHB1cmNoYXNlXCIsIG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcImJvbnVzX2ljb25zXCJdLCAwKSwgXCIxdW5pdFwiKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBDcmVhdGVQdXJjaGFzZXMoKSB7XHJcbiAgICAgICAgICAgIHB1cmNoYXNlcy5BZGQoXCJCdXN0ZXIxVFwiLCBuZXcgUHVyY2hhc2UoXCJCdXN0ZXIxVFwiLCBuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJwdXJjaGFzZV9pY29uc1wiXSwgMiksIDUpKTtcclxuXHJcblxyXG4gICAgICAgICAgICBwdXJjaGFzZXMuQWRkKFwiQnVzdGVyMlRcIiwgbmV3IFB1cmNoYXNlKFwiQnVzdGVyMlRcIiwgbmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW1wicHVyY2hhc2VfaWNvbnNcIl0sIDMpLCAxMCkpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIHB1cmNoYXNlcy5BZGQoXCJCdXN0ZXIzVFwiLCBuZXcgUHVyY2hhc2UoXCJCdXN0ZXIzVFwiLCBuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJwdXJjaGFzZV9pY29uc1wiXSwgMSksIDI1KSk7XHJcblxyXG5cclxuICAgICAgICAgICAgcHVyY2hhc2VzLkFkZChcIkhlcm9idXN0ZXJcIiwgbmV3IFB1cmNoYXNlKFwiSGVyb2J1c3RlclwiLCBuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJwdXJjaGFzZV9pY29uc1wiXSwgMCksIDI1KSk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBSb3RhdGVDYXJvdXNlbChNb25vSW50ZXJmYWNlLkZyYW1lIGZybSkge1xyXG4gICAgICAgICAgICBpbnQgdHJnUG9zID0gbWVudUNhcm91c2VsLkluZGV4T2YoZnJtKTtcclxuICAgICAgICAgICAgaWYgKHRyZ1BvcyA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodHJnUG9zID4gY3VyQ2Fyb3VzZWxQb3MpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZnJtMiA9IG1lbnVDYXJvdXNlbFtjdXJDYXJvdXNlbFBvc107XHJcbiAgICAgICAgICAgICAgICAgICAgbWFpbkFuaW1hdG9yLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTnVtYmVyQW5pbWF0aW9uPihuZXcgTW9ub0ludGVyZmFjZS5OdW1iZXJBbmltYXRpb24oXCJYXCIsIDAsIC00MDAsIC01MCwgdGFyZ2V0OiBmcm0yLCBvbkVuZDogKCkgPT4gZnJtMi5WaXNpYmxlID0gZmFsc2UpKS5CZWdpbigpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZybS5ZID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBmcm0uVmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgbWFpbkFuaW1hdG9yLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTnVtYmVyQW5pbWF0aW9uPihuZXcgTW9ub0ludGVyZmFjZS5OdW1iZXJBbmltYXRpb24oXCJYXCIsIDQwMCwgMCwgLTUwLCB0YXJnZXQ6IGZybSkpLkJlZ2luKCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRyZ1BvcyA8IGN1ckNhcm91c2VsUG9zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZybTIgPSBtZW51Q2Fyb3VzZWxbY3VyQ2Fyb3VzZWxQb3NdO1xyXG4gICAgICAgICAgICAgICAgICAgIG1haW5BbmltYXRvci5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLk51bWJlckFuaW1hdGlvbj4obmV3IE1vbm9JbnRlcmZhY2UuTnVtYmVyQW5pbWF0aW9uKFwiWFwiLCAwLCA0MDAsIDUwLCB0YXJnZXQ6IGZybTIsIG9uRW5kOiAoKSA9PiBmcm0yLlZpc2libGUgPSBmYWxzZSkpLkJlZ2luKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZnJtLlkgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIGZybS5WaXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBtYWluQW5pbWF0b3IuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5OdW1iZXJBbmltYXRpb24+KG5ldyBNb25vSW50ZXJmYWNlLk51bWJlckFuaW1hdGlvbihcIlhcIiwgLTQwMCwgMCwgNTAsIHRhcmdldDogZnJtKSkuQmVnaW4oKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZnJtLlZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmcm0uWSA8IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1haW5BbmltYXRvci5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLk51bWJlckFuaW1hdGlvbj4obmV3IE1vbm9JbnRlcmZhY2UuTnVtYmVyQW5pbWF0aW9uKFwiWVwiLCBmcm0uWSwgMCwgNTAsIHRhcmdldDogZnJtKSkuQmVnaW4oKTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChmcm0uWSA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1haW5BbmltYXRvci5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLk51bWJlckFuaW1hdGlvbj4obmV3IE1vbm9JbnRlcmZhY2UuTnVtYmVyQW5pbWF0aW9uKFwiWVwiLCBmcm0uWSwgMCwgLTUwLCB0YXJnZXQ6IGZybSkpLkJlZ2luKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjdXJDYXJvdXNlbFBvcyA9IHRyZ1BvcztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgSW5pdGlhbGl6ZSgpIHtcclxuXHJcbiAgICAgICAgICAgIGJhY2tGaWxsVGV4ID0gTW9ub0ludGVyZmFjZS5UaGVtZS5Tb2xpZENvbG9yVGV4dHVyZShncmFwaGljcy5HcmFwaGljc0RldmljZSwgMCwgMCwgMCwgMTUwKTtcclxuXHJcbiAgICAgICAgICAgIGZybUZpbGxUZXggPSBNb25vSW50ZXJmYWNlLlRoZW1lLlNvbGlkQ29sb3JUZXh0dXJlKGdyYXBoaWNzLkdyYXBoaWNzRGV2aWNlLCAxOTAsIDE5MCwgMTkwLCAyMjApO1xyXG5cclxuICAgICAgICAgICAgYnRuRmlsbFRleCA9IE1vbm9JbnRlcmZhY2UuVGhlbWUuU29saWRDb2xvclRleHR1cmUoZ3JhcGhpY3MuR3JhcGhpY3NEZXZpY2UsIDE1MCwgMTUwLCAxNTApO1xyXG4gICAgICAgICAgICBidG5TZWxlY3RUZXggPSBNb25vSW50ZXJmYWNlLlRoZW1lLlNvbGlkQ29sb3JUZXh0dXJlKGdyYXBoaWNzLkdyYXBoaWNzRGV2aWNlLCAyMDAsIDIwMCwgMjAwKTtcclxuICAgICAgICAgICAgYnRuSGxUZXggPSBNb25vSW50ZXJmYWNlLlRoZW1lLlNvbGlkQ29sb3JUZXh0dXJlKGdyYXBoaWNzLkdyYXBoaWNzRGV2aWNlLCAyMjAsIDIyMCwgMjIwLCAxMjApO1xyXG4gICAgICAgICAgICBidG5QcmVzc2VkVGV4ID0gTW9ub0ludGVyZmFjZS5UaGVtZS5Tb2xpZENvbG9yVGV4dHVyZShncmFwaGljcy5HcmFwaGljc0RldmljZSwgMjIwLCAyMjAsIDIyMCwgMTgwKTtcclxuICAgICAgICAgICAgYnRuRGlzYWJsZWRUZXggPSBNb25vSW50ZXJmYWNlLlRoZW1lLlNvbGlkQ29sb3JUZXh0dXJlKGdyYXBoaWNzLkdyYXBoaWNzRGV2aWNlLCAxMDAsIDEwMCwgMTAwLCAyMDApO1xyXG5cclxuICAgICAgICAgICAgcHJnRmlsbFRleCA9IE1vbm9JbnRlcmZhY2UuVGhlbWUuU29saWRDb2xvclRleHR1cmUoZ3JhcGhpY3MuR3JhcGhpY3NEZXZpY2UsIDIyMCwgMjIwLCAyMjApO1xyXG4gICAgICAgICAgICBwcmdCYXJUZXggPSBNb25vSW50ZXJmYWNlLlRoZW1lLlNvbGlkQ29sb3JUZXh0dXJlKGdyYXBoaWNzLkdyYXBoaWNzRGV2aWNlLCAxNDAsIDE0MCwgMTQwKTtcclxuXHJcblxyXG5cclxuICAgICAgICAgICAgc3RhclRleCA9IE1vbm9JbnRlcmZhY2UuVGhlbWUuU29saWRDb2xvclRleHR1cmUoZ3JhcGhpY3MuR3JhcGhpY3NEZXZpY2UsIDI1NSwgMjU1LCAyNTUpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIGhlYWx0aEJhckJhY2tUZXggPSBNb25vSW50ZXJmYWNlLlRoZW1lLlNvbGlkQ29sb3JUZXh0dXJlKGdyYXBoaWNzLkdyYXBoaWNzRGV2aWNlLCAyNTUsIDI1NSwgMjU1LCAxODApO1xyXG4gICAgICAgICAgICBoZWFsdGhCYXJMaWZlVGV4ID0gTW9ub0ludGVyZmFjZS5UaGVtZS5Tb2xpZENvbG9yVGV4dHVyZShncmFwaGljcy5HcmFwaGljc0RldmljZSwgMjU1LCAwLCAwLCAxODApO1xyXG4gICAgICAgICAgICBoZWFsdGhCYXJQb2lzb25UZXggPSBNb25vSW50ZXJmYWNlLlRoZW1lLlNvbGlkQ29sb3JUZXh0dXJlKGdyYXBoaWNzLkdyYXBoaWNzRGV2aWNlLCAwLCAxMjAsIDAsIDE4MCk7XHJcbiAgICAgICAgICAgIGhlYWx0aEJhckFiaWxUZXggPSBNb25vSW50ZXJmYWNlLlRoZW1lLlNvbGlkQ29sb3JUZXh0dXJlKGdyYXBoaWNzLkdyYXBoaWNzRGV2aWNlLCAwLCAwLCAyNTUsIDE4MCk7XHJcblxyXG5cclxuICAgICAgICAgICAgaG9yID0gZ2FtZUhlaWdodCAtIDMwO1xyXG5cclxuICAgICAgICAgICAgc2t5cmVjdCA9IG5ldyBSZWN0YW5nbGUoMCwgMCwgZ2FtZVdpZHRoLCBob3IpO1xyXG4gICAgICAgICAgICBza3l0ZXh0dXJlID0gbmV3IFRleHR1cmUyRChncmFwaGljcy5HcmFwaGljc0RldmljZSwgMSwgaG9yKTtcclxuICAgICAgICAgICAgc3Vuc2V0dGV4dHVyZSA9IG5ldyBUZXh0dXJlMkQoZ3JhcGhpY3MuR3JhcGhpY3NEZXZpY2UsIDEsIGhvcik7XHJcblxyXG4gICAgICAgICAgICBDcmVhdGVBY2hpZXZlbWVudHMoKTtcclxuXHJcbiAgICAgICAgICAgIENyZWF0ZVB1cmNoYXNlcygpO1xyXG5cclxuXHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgIE9yZGVyUmFjZXMoKTtcclxuXHJcbiAgICAgICAgICAgIENyZWF0ZVJhY2VMaXN0KCk7XHJcblxyXG4gICAgICAgICAgICBjb25kcy5BZGQobmV3IE1hdGNoQ29uZGl0aW9uKFwiRWFzeVwiLCBuZXcgVGltZUNvc3QoMTAwMCwgMjAsIDEsIDApLCBuZXcgVGltZUNvc3QoNTAwLCAxMCwgMSwgMCksIDUwLCAyNSkpO1xyXG4gICAgICAgICAgICBjb25kcy5BZGQobmV3IE1hdGNoQ29uZGl0aW9uKFwiTWVkaXVtXCIsIG5ldyBUaW1lQ29zdCg1MDAsIDEwLCAxLCAwKSwgbmV3IFRpbWVDb3N0KDUwMCwgMTAsIDEsIDApLCA1MCwgMjUpKTtcclxuICAgICAgICAgICAgY29uZHMuQWRkKG5ldyBNYXRjaENvbmRpdGlvbihcIkhhcmRcIiwgbmV3IFRpbWVDb3N0KDI1MCwgMCwgMSwgMCksIG5ldyBUaW1lQ29zdCg1MDAsIDEwLCAxLCAwKSwgNTAsIDI1KSk7XHJcblxyXG4gICAgICAgICAgICBmb3JlYWNoIChVbml0UGFyYW1ldGVycyB1cCBpbiB1bml0UHJtcy5WYWx1ZXMpIHtcclxuICAgICAgICAgICAgICAgIGlmICghdXAuc3BlY2lhbClcclxuICAgICAgICAgICAgICAgICAgICAvLyBJZiB1cC5pc0hlcm9pYyBUaGVuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQWxsSGVyb2VzTGlzdC5BZGQodXAubmFtZSlcclxuICAgICAgICAgICAgICAgICAgICAvLyBFbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgQWxsVW50c0xpc3QuQWRkKHVwLk5hbWUpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBEaWN0aW9uYXJ5PHN0cmluZywgaW50PiByYWNlc2Nvc3QgPSBuZXcgRGljdGlvbmFyeTxzdHJpbmcsIGludD4oKTtcclxuICAgICAgICAgICAgaW50IHJhY2VpID0gMDtcclxuICAgICAgICAgICAgZm9yZWFjaCAoS2V5VmFsdWVQYWlyPHN0cmluZywgUmFjZT4gcmNlIGluIFJhY2VNYW5hZ2VyLkluc3RhbmNlLkFsbCkge1xyXG4gICAgICAgICAgICAgICAgcmFjZXNjb3N0LkFkZChyY2UuS2V5LCByYWNlaSAqIDQwMDApO1xyXG4gICAgICAgICAgICAgICAgcmFjZWkgKz0gMTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgQWxsVW50c0xpc3QgPSBTeXN0ZW0uTGlucS5FbnVtZXJhYmxlLk9yZGVyQnk8c3RyaW5nLGludD4oQWxsVW50c0xpc3RcclxuLChGdW5jPHN0cmluZyxpbnQ+KSh1bml0ID0+IHVuaXRQcm1zW3VuaXRdLkNvc3QuTW9uZXkgKyAodW5pdFBybXNbdW5pdF0uc3VwcG9ydCA/IC01MDAgOiAwKSArIHVuaXRQcm1zW3VuaXRdLkNvc3QuVGllciAqIDEwMDAgKyByYWNlc2Nvc3RbdW5pdFBybXNbdW5pdF0uUmFjZV0pKVxyXG4gICAgICAgICAgICAgICAgLlRvTGlzdCgpO1xyXG5cclxuICAgICAgICAgICAgQ3JlYXRlSW50ZXJmYWNlKCk7XHJcblxyXG4gICAgICAgICAgICBtZW51Q2Fyb3VzZWwgPSBnbG9iYWw6OkJyaWRnZS5TY3JpcHQuQ2FsbEZvcihuZXcgTGlzdDxNb25vSW50ZXJmYWNlLkZyYW1lPigpLChfbzEpPT57X28xLkFkZChmcm1CYXR0bGUpO19vMS5BZGQoZnJtUHJvZmlsZSk7cmV0dXJuIF9vMTt9KTtcclxuXHJcbiAgICAgICAgICAgIHN0YXJzQ250ID0gODg7XHJcbiAgICAgICAgICAgIHN0YXJzID0gbmV3IFZlY3RvcjJbc3RhcnNDbnRdO1xyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN0YXJzQ250OyBpKyspXHJcbiAgICAgICAgICAgICAgICBzdGFyc1tpXSA9IG5ldyBWZWN0b3IyKHJuZC5OZXh0KDAsIGdhbWVXaWR0aCksIChmbG9hdCkoMjAgKyBybmQuTmV4dERvdWJsZSgpICogKGhvciAtIDYwKSkpO1xyXG5cclxuICAgICAgICAgICAgc3ltYm9sc1swXSA9IG5ldyBSZWN0YW5nbGUoZ2FtZVdpZHRoIC0gOSwgaG9yIC0gNzUsIDE1LCAyNSk7XHJcbiAgICAgICAgICAgIHN5bWJvbHNbMV0gPSBuZXcgUmVjdGFuZ2xlKGdhbWVXaWR0aCAtIDM0LCBob3IgLSA1NCwgMTUsIDI1KTtcclxuICAgICAgICAgICAgc3ltYm9sc1syXSA9IG5ldyBSZWN0YW5nbGUoLTcsIGhvciAtIDc1LCAxNSwgMjUpO1xyXG4gICAgICAgICAgICBzeW1ib2xzWzNdID0gbmV3IFJlY3RhbmdsZSgyMSwgaG9yIC0gNTQsIDE1LCAyNSk7XHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgIC8vIGZybUJhdHRsZS5TZXRQb3NpdGlvbihmcm1NYWluTWVudS5yZWN0LlJpZ2h0IC8gMiArIChmcm1NZW51RXhpdC5yZWN0LkxlZnQgLSBmcm1CYXR0bGUucmVjdC5XaWR0aCkgLyAyLCAoaCAtIGZybUJhdHRsZS5yZWN0LkhlaWdodCkgLyAyKVxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgIHN1bkFuZyA9IDAgKiAoZmxvYXQpTWF0aC5QSSAvIDE4MDtcclxuICAgICAgICAgICAgZEFuZyA9IDAuMDRmICogKGZsb2F0KU1hdGguUEkgLyAxODA7XHJcblxyXG4gICAgICAgICAgICBnYW1lbGFuZHNjYXBlID0gKExhbmRzY2FwZVR5cGUpcm5kLk5leHQobGFuZHNUeXBlc0NvdW50KTtcclxuXHJcbiAgICAgICAgICAgIGdTdGF0ZSA9IEdhbWVTdGF0ZS5NYWluTWVudTtcclxuICAgICAgICAgICAgUGF1c2UgPSBmYWxzZTtcclxuXHJcblxyXG4gICAgICAgICAgICBDaGFuZ2VMYW5kc2NhcGUoZ2FtZWxhbmRzY2FwZSk7XHJcblxyXG4gICAgICAgICAgICBTZXRQbGF5ZXJzKCk7XHJcblxyXG4gICAgICAgICAgICBSZXNldFdvcmxkKHN1bkFuZywgZEFuZyk7XHJcblxyXG5cclxuICAgICAgICAgICAgZnJtTWFpbk1lbnUuU2hvdygpO1xyXG4gICAgICAgICAgICBmcm1SaWdodE1lbnUuU2hvdygpO1xyXG5cclxuICAgICAgICAgICAgaWYgKFByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbC5Db3VudCA+IDApXHJcbiAgICAgICAgICAgICAgICBTdGFydEJhdHRsZSgpO1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICBTdGFydE5ld1Byb2ZpbGUoKTtcclxuXHJcbiAgICAgICAgICAgIGlzTG9hZGVkID0gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBTdGFydE5ld1Byb2ZpbGUoKSB7XHJcbiAgICAgICAgICAgIFByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbC5BZGQobmV3IFByb2ZpbGUoXCLQndC+0LLQuNGH0LXQulwiLlRyaW0oKSwgMCwgMSwgbmV3IExpc3Q8c3RyaW5nPigpLCBuZXcgRGljdGlvbmFyeTxzdHJpbmcsIGludD4oKSwgbmV3IERpY3Rpb25hcnk8c3RyaW5nLCBpbnQ+KCksIC0xLCAtMSwgbmV3IERpY3Rpb25hcnk8c3RyaW5nLCBzdHJpbmc+KCksIDAsIDMpKTtcclxuICAgICAgICAgICAgLy8gUmFjZU1hbmFnZXIuSW5zdGFuY2UuQWxsLkFkZChcIkN1c3RvbTBcIiwgTmV3IFJhY2UoXCJDdXN0b20wXCIsIFwi0KHQtNC10LvQsNC90L4g0YHQstC+0LjQvNC4INGA0YPQutCw0LzQuFwiLCBcItCh0YLQsNGA0YLQvtCy0YvQuSDQvdCw0LHQvtGAXCIsIFJhY2VNYW5hZ2VyLkluc3RhbmNlLkFsbChzdGFuZGFydFJhY2VzKHJhY2VTd2l0Y2hlck5ld1Byb2ZpbGUuQ3VycmVudCkpLnVuaXRzLCAxMCwgRmFsc2UsIFRydWUsIEZhbHNlLCBGYWxzZSkpXHJcbiAgICAgICAgICAgIE9yZGVyUmFjZXMoKTtcclxuICAgICAgICAgICAgQ3JlYXRlUmFjZUxpc3QoKTtcclxuICAgICAgICAgICAgU3RhcnRCYXR0bGUoKTtcclxuICAgICAgICAgICAgZnJtQmF0dGxlLlNob3cobWFpbkFuaW1hdG9yKTtcclxuXHJcbiAgICAgICAgICAgIFNob3dTb21lQ2hpbGRyZW4oZnJtTWFpbk1lbnUsIGZybVJpZ2h0TWVudSk7XHJcblxyXG5cclxuICAgICAgICAgICAgU3RhcnRCYXR0bGUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFNob3dTb21lQ2hpbGRyZW4ocGFyYW1zIE1vbm9JbnRlcmZhY2UuQmxvY2tbXSBmcm1zKSB7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKHZhciBmcm0gaW4gZnJtcylcclxuICAgICAgICAgICAgICAgIGZybS5TaG93KG1haW5BbmltYXRvcik7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgSGlkZVNvbWVDaGlsZHJlbihwYXJhbXMgTW9ub0ludGVyZmFjZS5CbG9ja1tdIGZybXMpIHtcclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIGZybSBpbiBmcm1zKVxyXG4gICAgICAgICAgICAgICAgZnJtLkhpZGUobWFpbkFuaW1hdG9yKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFN0YXJ0UHJvZmlsZSgpIHtcclxuICAgICAgICAgICAgUm90YXRlQ2Fyb3VzZWwoZnJtUHJvZmlsZSk7XHJcbiAgICAgICAgICAgIFVwZGF0ZVByb2ZpbGVJbmZvTGFiZWxzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBVcGRhdGVQcm9maWxlSW5mb0xhYmVscygpIHtcclxuICAgICAgICAgICAgbGJsc2ZybVByb2ZpbGVbMF0uVGV4dCA9IFwi0J3QuNC6OiBcIiArIFByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS5uYW1lO1xyXG4gICAgICAgICAgICBsYmxzZnJtUHJvZmlsZVsxXS5UZXh0ID0gXCLQodC70L7QttC90L7RgdGC0Yw6IFwiICsgbG9jYWxpemUuR2V0U3RyaW5nKGNvbmRzW1Byb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS5kaWZmaWN1bHRdLm5hbWUpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIGludCBhbGx3aW5zID0gMDtcclxuICAgICAgICAgICAgc3RyaW5nIG1heHJhY2UgPSBcIlwiO1xyXG4gICAgICAgICAgICBpbnQgbWF4cmFjZXBscyA9IDA7XHJcblxyXG4gICAgICAgICAgICBmb3JlYWNoIChzdHJpbmcgciBpbiBQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0ucmFjZXNQbGF5cy5LZXlzKSB7XHJcbiAgICAgICAgICAgICAgICBhbGx3aW5zICs9IFByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS5yYWNlc1dpbnNbcl07XHJcbiAgICAgICAgICAgICAgICBpZiAobWF4cmFjZXBscyA8IFByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS5yYWNlc1BsYXlzW3JdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWF4cmFjZXBscyA9IFByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS5yYWNlc1BsYXlzW3JdO1xyXG4gICAgICAgICAgICAgICAgICAgIG1heHJhY2UgPSByO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBsYmxzZnJtUHJvZmlsZVsyXS5UZXh0ID0gc3RyaW5nLkZvcm1hdChcItCf0L7QsdC10LQ6IHswfVwiLCBhbGx3aW5zKTtcclxuICAgICAgICAgICAgbGJsc2ZybVByb2ZpbGVbM10uVGV4dCA9IHN0cmluZy5Gb3JtYXQoXCLQntGC0LrRgNGL0YLQviB7MH0lINGB0YPRidC10YHRgtCyXCIsIChpbnQpMTAwICogUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLnVuaXRzLkNvdW50IC8gKGRvdWJsZSlBbGxVbnRzTGlzdC5Db3VudCk7XHJcblxyXG4gICAgICAgICAgICBpbnQgYWNOdW0gPSAwO1xyXG5cclxuICAgICAgICAgICAgZm9yZWFjaCAoS2V5VmFsdWVQYWlyPHN0cmluZywgc3RyaW5nPiBhIGluIFByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS5hY2hpdnMpIHtcclxuICAgICAgICAgICAgICAgIGlmIChhLlZhbHVlID09IFwiXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgYWNOdW0gKz0gMTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgbGJsc2ZybVByb2ZpbGVbNF0uVGV4dCA9IHN0cmluZy5Gb3JtYXQoXCLQntGC0LrRgNGL0YLQviB7MH0lINC00L7RgdGC0LjQttC10L3QuNC5XCIsIChpbnQpMTAwICogYWNOdW0gLyAoZG91YmxlKWFjaGl2cy5Db3VudCk7XHJcblxyXG5cclxuICAgICAgICAgICAgbGJsc2ZybVByb2ZpbGVbNl0uVGV4dCA9IFwi0J3QuNC6OiBcIiArIFByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS5uYW1lO1xyXG4gICAgICAgICAgICBsYmxzZnJtUHJvZmlsZVs3XS5UZXh0ID0gXCLQndC40Lo6IFwiICsgUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLm5hbWU7XHJcblxyXG4gICAgICAgICAgICBpZiAoIXN0cmluZy5Jc051bGxPckVtcHR5KG1heHJhY2UpKVxyXG4gICAgICAgICAgICAgICAgbGJsc2ZybVByb2ZpbGVbNV0uVGV4dCA9IHN0cmluZy5Gb3JtYXQoXCLQm9GO0LHQuNC80LDRjyDRhNGA0LDQutGG0LjRjzogezB9XCIsIGxvY2FsaXplLkdldFN0cmluZyhtYXhyYWNlKSk7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIGxibHNmcm1Qcm9maWxlWzVdLlRleHQgPSBcItCb0Y7QsdC40LzQsNGPINGE0YDQsNC60YbQuNGPOiAtXCI7XHJcblxyXG4gICAgICAgICAgICBpZiAoUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLm1pbnZpY3RpbXMgPT0gLTEpXHJcbiAgICAgICAgICAgICAgICBsYmxzZnJtUHJvZmlsZVs2XS5UZXh0ID0gXCLQnNC40L3QuNC80YPQvCDQv9C+0YLQtdGA0Yw6IC1cIjtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgbGJsc2ZybVByb2ZpbGVbNl0uVGV4dCA9IHN0cmluZy5Gb3JtYXQoXCLQnNC40L3QuNC80YPQvCDQv9C+0YLQtdGA0Yw6IHswfVwiLCBQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0ubWludmljdGltcyk7XHJcblxyXG4gICAgICAgICAgICBpZiAoUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLm1heGtpbGxzID09IC0xKVxyXG4gICAgICAgICAgICAgICAgbGJsc2ZybVByb2ZpbGVbN10uVGV4dCA9IFwi0JzQsNC60YHQuNC80YPQvCDRg9Cx0LjQudGB0YLQsjogLVwiO1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICBsYmxzZnJtUHJvZmlsZVs3XS5UZXh0ID0gc3RyaW5nLkZvcm1hdChcItCc0LDQutGB0LjQvNGD0Lwg0YPQsdC40LnRgdGC0LI6IHswfVwiLCBQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0ubWF4a2lsbHMpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFJlc2V0V29ybGQoZmxvYXQgc3VuUG9zLCBmbG9hdCBzdW5WKSB7XHJcbiAgICAgICAgICAgIGNsb3VkcGFycy5DbGVhcigpO1xyXG4gICAgICAgICAgICBzbkQgPSAoZmxvYXQpTWF0aC5TaW4oc3VuVik7XHJcbiAgICAgICAgICAgIGNzRCA9IChmbG9hdClNYXRoLkNvcyhzdW5WKTtcclxuICAgICAgICAgICAgc25TID0gKGZsb2F0KU1hdGguU2luKHN1blBvcyk7XHJcbiAgICAgICAgICAgIGNzUyA9IChmbG9hdClNYXRoLkNvcyhzdW5Qb3MpO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8PSAzOyBpKyspXHJcbiAgICAgICAgICAgICAgICBjbG91ZHBhcnMuQWRkKG5ldyBJbWFnZVBhcnRpY2xlKG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcIndvcmxkXCJdLCBybmQuTmV4dCgyLCA2KSksIC0xMDAgLSBybmQuTmV4dCgxMDApLCBob3IgLSAyMDAgLSBpICogNDAsIDAuMmYgKyAwLjRmICogKGZsb2F0KXJuZC5OZXh0RG91YmxlKCksIDAsIC0xKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBidG5Vbml0X0NsaWNrZWQoTW9ub0ludGVyZmFjZS5CdXR0b24gYnRuLCBib29sIGlzVG91Y2gpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjVW5pdHMuQ2hpbGRyZW4uQ291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGNVbml0cy5DaGlsZHJlbltpXSA9PSBidG4pXHJcbiAgICAgICAgICAgICAgICAgICAgVHJ5QWRkVG9RdWV1ZVVuaXQocGxyc1swXSwgcGxyc1swXS51bml0c0xpc3RbaV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBidG5Vbml0X0ZvY3VzZWQoTW9ub0ludGVyZmFjZS5CdXR0b24gYnRuLCBib29sIGlzVG91Y2gpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjVW5pdHMuQ2hpbGRyZW4uQ291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGNVbml0cy5DaGlsZHJlbltpXSA9PSBidG4pXHJcbiAgICAgICAgICAgICAgICAgICAgU2hvd1VuaXRJbmZvKHVuaXRQcm1zW3BscnNbMF0udW5pdHNMaXN0W2ldXSwgMCwgdHJ1ZSwgbmV3IFBvaW50KChpbnQpKGJ0bi5GaW5hbFJpZ2h0IC8gTWFpbkNvbnRhaW5lci5GaW5hbENoaWxkcmVuU2NhbGVYKSwgKGludCkoYnRuLkZpbmFsQm90dG9tIC8gTWFpbkNvbnRhaW5lci5GaW5hbENoaWxkcmVuU2NhbGVZKSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIEtleXNbXSBudW1LZXlzID0gbmV3W10geyBLZXlzLkQxLCBLZXlzLkQyLCBLZXlzLkQzLCBLZXlzLkQ0LCBLZXlzLkQ1LCBLZXlzLkQ2LCBLZXlzLkQ3IH07XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFNldFVuaXRzKCkge1xyXG4gICAgICAgICAgICBpZiAocGxyc1swXS51bml0c0xpc3QuQ291bnQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBjVW5pdHMuQ2hpbGRyZW4uQ2xlYXIoKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpbnQgZCA9IDA7XHJcbiAgICAgICAgICAgICAgICBpbnQgb2xkdCA9IHVuaXRQcm1zW3BscnNbMF0udW5pdHNMaXN0WzBdXS5Db3N0LlRpZXI7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHBscnNbMF0udW5pdHNMaXN0LkNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodW5pdFBybXNbcGxyc1swXS51bml0c0xpc3RbaV1dLkNvc3QuVGllciAhPSBvbGR0IHx8IHVuaXRQcm1zW3BscnNbMF0udW5pdHNMaXN0W2ldXS5BYnNDb250YWlucyhcIlRhcmdldFwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkICs9IDc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9sZHQgPSB1bml0UHJtc1twbHJzWzBdLnVuaXRzTGlzdFtpXV0uQ29zdC5UaWVyO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjVW5pdHMuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5CdXR0b24+KG5ldyBNb25vSW50ZXJmYWNlLkJ1dHRvbihidG5Vbml0X0NsaWNrZWQsIGJ0blVuaXRfRm9jdXNlZCwgbnVtS2V5c1tpXSwgaSAqIDY1ICsgZCwgMCwgNjAsIDYwLCBob3JBbGlnbjogMC4wZikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLlBpY3R1cmU+KG5ldyBNb25vSW50ZXJmYWNlLlBpY3R1cmUodW5pdFBybXNbcGxyc1swXS51bml0c0xpc3RbaV1dLmljb25BcHAsIHc6IDYwLCBoOiA2MCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNVbml0cy5XID0gU3lzdGVtLkxpbnEuRW51bWVyYWJsZS5MYXN0PE1vbm9JbnRlcmZhY2UuQmxvY2s+KGNVbml0cy5DaGlsZHJlbikuUmlnaHQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjVW5pdHMuQXBwbHlUaGVtZShkZWZhdWx0VGhlbWUpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBTdGFydEFnYWluKCkge1xyXG4gICAgICAgICAgICBwbHJzWzBdLlJlc2V0KGNvbmRzW1Byb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS5kaWZmaWN1bHRdKTtcclxuICAgICAgICAgICAgcGxyc1sxXS5SZXNldChjb25kc1tQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0uZGlmZmljdWx0XSk7XHJcbiAgICAgICAgICAgIHBjdFRpZXJGcm1SZXNvdXJjZXMuc3ByaXRlUmVmID0gdW5pdFBybXNbXCJUaWVyXzJcIl0uaWNvbkFwcDtcclxuICAgICAgICAgICAgYW1tb3MuQ2xlYXIoKTtcclxuICAgICAgICAgICAgdW5pdHMuQ2xlYXIoKTtcclxuICAgICAgICAgICAgcGFycy5DbGVhcigpO1xyXG4gICAgICAgICAgICBkZWF0aGxpc3QuQ2xlYXIoKTtcclxuICAgICAgICAgICAgYm9ybkxpc3QuQ2xlYXIoKTtcclxuICAgICAgICAgICAgZnJtUHJvZHVjdGlvbi5IaWRlKG1haW5BbmltYXRvcik7XHJcblxyXG4gICAgICAgICAgICBVcGRhdGVRdWV1ZSgpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIGludCBiYXNlQ250ID0gMDtcclxuXHJcbiAgICAgICAgICAgIGlmIChnVHlwZSA9PSBHYW1lVHlwZS5TdGFuZGFydEdUIHx8IGdUeXBlID09IEdhbWVUeXBlLkRlZmVuY2VHVCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHBscnNbMF0uaGVybyA9PSBcIkNhc3RsZVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdW5pdHMuQWRkKG5ldyBVbml0KHRoaXMsIHVzMiAtIDEsIDEsIDAsIHVuaXRQcm1zW1wiQ2FzdGxlXCJdKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdW5pdHNbYmFzZUNudF0ucGFyYW1ldGVycy5zcHJpdGVOYW1lID0gcGxyc1swXS5jYXN0bGVGaWxlTmFtZSArIFwiMlwiO1xyXG4gICAgICAgICAgICAgICAgICAgIHVuaXRzW2Jhc2VDbnRdLnBhcmFtZXRlcnMucmVjdCA9IG5ldyBSZWN0YW5nbGUoLTE1LCAtNjAsIDUwLCA2Myk7XHJcbiAgICAgICAgICAgICAgICAgICAgcGxyc1tiYXNlQ250XS5iYXNlWCA9IHVzMjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdW5pdHMuQWRkKG5ldyBVbml0KHRoaXMsIHVuaXRTaXplIC0gMSwgMSwgMCwgdW5pdFBybXNbcGxyc1swXS5oZXJvXSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHBscnNbMF0uYmFzZVggPSAtdXMyO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcGxyc1swXS5oZXJvVW5pdCA9IHVuaXRzW2Jhc2VDbnRdO1xyXG4gICAgICAgICAgICAgICAgYmFzZUNudCArPSAxO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcGxyc1swXS5oZXJvID0gXCJcIjtcclxuICAgICAgICAgICAgICAgIHBscnNbMF0uYmFzZVggPSAtdW5pdFNpemU7XHJcbiAgICAgICAgICAgICAgICBwbHJzWzBdLmhlcm9Vbml0ID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIGlmIChnVHlwZSA9PSBHYW1lVHlwZS5TdGFuZGFydEdUIHx8IGdUeXBlID09IEdhbWVUeXBlLk9mZmVuY2VHVCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHBscnNbMV0uaGVybyA9PSBcIkNhc3RsZVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdW5pdHMuQWRkKG5ldyBVbml0KHRoaXMsIGdhbWVXaWR0aCAtIHVzMiArIDEsIC0xLCAxLCB1bml0UHJtc1tcIkNhc3RsZVwiXSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHVuaXRzW2Jhc2VDbnRdLnBhcmFtZXRlcnMuc3ByaXRlTmFtZSA9IHBscnNbMV0uY2FzdGxlRmlsZU5hbWUgKyAyO1xyXG4gICAgICAgICAgICAgICAgICAgIHVuaXRzW2Jhc2VDbnRdLnBhcmFtZXRlcnMuaW1neCA9IC0yMDtcclxuICAgICAgICAgICAgICAgICAgICB1bml0c1tiYXNlQ250XS5wYXJhbWV0ZXJzLnJlY3QgPSBuZXcgUmVjdGFuZ2xlKC0zNSwgLTU5LCA1MCwgNjMpO1xyXG4gICAgICAgICAgICAgICAgICAgIHBscnNbMV0uYmFzZVggPSBnYW1lV2lkdGggLSB1czI7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHVuaXRzLkFkZChuZXcgVW5pdCh0aGlzLCBnYW1lV2lkdGggLSB1bml0U2l6ZSArIDEsIC0xLCAxLCB1bml0UHJtc1twbHJzWzFdLmhlcm9dKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcGxyc1sxXS5iYXNlWCA9IGdhbWVXaWR0aCArIHVzMjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHBscnNbMV0uaGVyb1VuaXQgPSB1bml0c1tiYXNlQ250XTtcclxuICAgICAgICAgICAgICAgIGJhc2VDbnQgKz0gMTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHBscnNbMV0uaGVybyA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICBwbHJzWzFdLmJhc2VYID0gZ2FtZVdpZHRoICsgdW5pdFNpemU7XHJcbiAgICAgICAgICAgICAgICBwbHJzWzFdLmhlcm9Vbml0ID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY3VyTSA9IHBscnNbMF0ucmVzLk1vbmV5O1xyXG4gICAgICAgICAgICBjdXJEID0gcGxyc1swXS5yZXMuRGVhdGg7XHJcblxyXG4gICAgICAgICAgICBzZWxVID0gbnVsbDtcclxuICAgICAgICAgICAgU2V0VW5pdHMoKTtcclxuICAgICAgICAgICAgU2V0U3BlbGxzKCk7XHJcblxyXG5cclxuICAgICAgICAgICAgaWYgKGdUeXBlID09IEdhbWVUeXBlLkRlZmVuY2VHVClcclxuICAgICAgICAgICAgICAgIFJlc2V0V29ybGQoKGZsb2F0KU1hdGguUEksIGRBbmcgLyAzKTtcclxuICAgICAgICAgICAgZWxzZSBpZiAoZ1R5cGUgPT0gR2FtZVR5cGUuT2ZmZW5jZUdUKVxyXG4gICAgICAgICAgICAgICAgUmVzZXRXb3JsZCgwLCBkQW5nIC8gMyk7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIFJlc2V0V29ybGQoc3VuQW5nLCBkQW5nKTtcclxuICAgICAgICAgICAgaWYgKGdUeXBlID09IEdhbWVUeXBlLkRlZmVuY2VHVCkge1xyXG4gICAgICAgICAgICAgICAgcGxyc1sxXS5yZXMuTW9uZXkgKj0gMjtcclxuICAgICAgICAgICAgICAgIHBscnNbMV0ucmVzLkRlYXRoICo9IDI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGdUeXBlID09IEdhbWVUeXBlLk9mZmVuY2VHVCkge1xyXG4gICAgICAgICAgICAgICAgcGxyc1swXS5yZXMuTW9uZXkgKj0gMjtcclxuICAgICAgICAgICAgICAgIHBscnNbMF0ucmVzLkRlYXRoICo9IDI7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZvcmVhY2ggKFBsYXllciBwIGluIHBscnMpIHtcclxuICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBvdGhlckJ1aWxkaW5ncyA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuICAgICAgICAgICAgICAgIGZvcmVhY2ggKHN0cmluZyBiIGluIHAuYm9udXNMaXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGIgPT0gXCJUb3dlclwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0b3dlciA9IG5ldyBVbml0KHRoaXMsIGdhbWVXaWR0aCAvIDIgLSBwLm1vdmVzaWRlICogZ2FtZVdpZHRoIC8gNiwgcC5tb3Zlc2lkZSwgcC5pZCwgdW5pdFBybXNbXCJUb3dlclwiXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVuaXRzLkFkZCh0b3dlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG90aGVyQnVpbGRpbmdzLkFkZChiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG90aGVyQnVpbGRpbmdzLkNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYnVpbGRpbmcgPSBuZXcgVW5pdCh0aGlzLCBnYW1lV2lkdGggLyAyIC0gcC5tb3Zlc2lkZSAqIGdhbWVXaWR0aCAvIDYgLSBwLm1vdmVzaWRlICogKChnYW1lV2lkdGggLyAzIC0gdXMyKSAvIChvdGhlckJ1aWxkaW5ncy5Db3VudCArIDEpKSAqIChpICsgMSksIHAubW92ZXNpZGUsIHAuaWQsIHVuaXRQcm1zW290aGVyQnVpbGRpbmdzW2ldXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdW5pdHMuQWRkKGJ1aWxkaW5nKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBnU3RhdGUgPSBHYW1lU3RhdGUuSW5HYW1lO1xyXG4gICAgICAgICAgICBQYXVzZSA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHByaXZhdGUgTGlzdDxzdHJpbmc+IHVuaXRzUHJlR2FtZSA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuICAgICAgICBwcml2YXRlIExpc3Q8c3RyaW5nPiBzcGVsbHNQcmVHYW1lID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBTdGFydFByZUdhbWUoKSB7XHJcbiAgICAgICAgICAgIHVuaXRzUHJlR2FtZS5DbGVhcigpO1xyXG4gICAgICAgICAgICBzcGVsbHNQcmVHYW1lLkNsZWFyKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAobW9kZVN3aXRjaGVyRnJtQmF0dGxlLkN1cnJlbnQgPT0gKGludClHYW1lVHlwZS5SYW5kb21HVClcclxuICAgICAgICAgICAgICAgIGdUeXBlID0gKEdhbWVUeXBlKXJuZC5OZXh0KDEsIDYpO1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICBnVHlwZSA9IChHYW1lVHlwZSltb2RlU3dpdGNoZXJGcm1CYXR0bGUuQ3VycmVudDtcclxuXHJcbiAgICAgICAgICAgIGlmIChyYWNlczFbcmFjZXMxU3dpdGNoZXJGcm1CYXR0bGUuQ3VycmVudF0gPT0gXCJSYW5kb21cIilcclxuICAgICAgICAgICAgICAgIHBscnNbMF0ucmFjZSA9IFJhY2VNYW5hZ2VyLkluc3RhbmNlLkFsbFtyYWNlczFbcm5kLk5leHQoMSwgcmFjZXMxLkNvdW50KV1dLm5hbWU7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHBscnNbMF0ucmFjZSA9IHJhY2VzMVtyYWNlczFTd2l0Y2hlckZybUJhdHRsZS5DdXJyZW50XTtcclxuICAgICAgICAgICAgaWYgKHJhY2VzMltyYWNlczJTd2l0Y2hlckZybUJhdHRsZS5DdXJyZW50XSA9PSBcIlJhbmRvbVwiKVxyXG4gICAgICAgICAgICAgICAgcGxyc1sxXS5yYWNlID0gUmFjZU1hbmFnZXIuSW5zdGFuY2UuQWxsW3JhY2VzMltybmQuTmV4dCgxLCByYWNlczIuQ291bnQpXV0ubmFtZTtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgcGxyc1sxXS5yYWNlID0gcmFjZXMyW3JhY2VzMlN3aXRjaGVyRnJtQmF0dGxlLkN1cnJlbnRdO1xyXG5cclxuXHJcbiAgICAgICAgICAgIHBscnNbMF0uc3ltYiA9IFJhY2VNYW5hZ2VyLkluc3RhbmNlLkFsbFtwbHJzWzBdLnJhY2VdLnN5bWI7XHJcbiAgICAgICAgICAgIHBscnNbMV0uc3ltYiA9IFJhY2VNYW5hZ2VyLkluc3RhbmNlLkFsbFtwbHJzWzFdLnJhY2VdLnN5bWI7XHJcblxyXG5cclxuICAgICAgICAgICAgLy8g0JLRi9Cx0LjRgNCw0LXQvCDRgdGD0YnQtdGB0YLQsiDQv9C10YDQstC+0LzRgyDQuNCz0YDQvtC60YNcclxuICAgICAgICAgICAgaWYgKFJhY2VNYW5hZ2VyLkluc3RhbmNlLkFsbFtwbHJzWzBdLnJhY2VdLmN1c3RvbSkge1xyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAoc3RyaW5nIHVuYW0gaW4gbmV3IExpc3Q8c3RyaW5nPigpKVxyXG4gICAgICAgICAgICAgICAgICAgIHVuaXRzUHJlR2FtZS5BZGQodW5hbSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBmb3JlYWNoIChVbml0UGFyYW1ldGVycyB1IGluIHVuaXRQcm1zLlZhbHVlcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1LlJhY2UgPT0gcGxyc1swXS5yYWNlICYmICF1LnNwZWNpYWwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVuaXRzUHJlR2FtZS5BZGQodS5OYW1lKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB1bml0c1ByZUdhbWUgPSBTb3J0VW5pdHNMaXN0cyh1bml0c1ByZUdhbWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHBscnNbMF0udW5pdHNMaXN0ID0gdW5pdHNQcmVHYW1lO1xyXG5cclxuICAgICAgICAgICAgbGJsVnNQcmVHYW1lLlRleHQgPSBzdHJpbmcuRm9ybWF0KFwiezB9IFZTIHsxfVwiLGxvY2FsaXplLkdldFN0cmluZyhwbHJzWzBdLnJhY2UpLGxvY2FsaXplLkdldFN0cmluZyhwbHJzWzFdLnJhY2UpKTtcclxuXHJcbiAgICAgICAgICAgIGZvcmVhY2ggKFNwZWxsIHNwbCBpbiBzcGVsbHMuVmFsdWVzKSB7XHJcbiAgICAgICAgICAgICAgICBzcGVsbHNQcmVHYW1lLkFkZChzcGwuTmFtZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc3BlbGxzUHJlR2FtZSA9IFNvcnRTcGVsbHNMaXN0cyhzcGVsbHNQcmVHYW1lKTtcclxuICAgICAgICAgICAgcGxyc1swXS5zcGxsc0xpc3QgPSBzcGVsbHNQcmVHYW1lO1xyXG5cclxuXHJcbiAgICAgICAgICAgIHBscnNbMF0uYm9udXNMaXN0LkNsZWFyKCk7XHJcbiAgICAgICAgICAgIHBscnNbMV0uYm9udXNMaXN0LkNsZWFyKCk7XHJcblxyXG4gICAgICAgICAgICBMaXN0PHN0cmluZz4gYWxsYm9udXNlcyA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuICAgICAgICAgICAgYWxsYm9udXNlcy5BZGRSYW5nZShzdGFydEJ1aWxkaW5nc0xpc3QpO1xyXG4gICAgICAgICAgICBwbHJzWzBdLmJvbnVzTGlzdC5BZGRSYW5nZShhbGxib251c2VzKTtcclxuICAgICAgICAgICAgcGxyc1sxXS5ib251c0xpc3QuQWRkUmFuZ2UoYWxsYm9udXNlcyk7XHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgIC8vIGZybVByZUdhbWUuQWRkQnV0dG9uKDUsIGRlbHRhLCAxNiwgMTYsICwgXCJSYW5kb21Vbml0c1wiLCBLZXlzLkQxKVxyXG4gICAgICAgICAgICAvLyBmcm1QcmVHYW1lLkFkZEltYWdlKDUsIGRlbHRhLCAxOSwgMTUsIFwic21hbGxfaWNvbnNcIiwgMTYpXHJcbiAgICAgICAgICAgIGNVbml0c1ByZUdhbWUuQ2hpbGRyZW4uQ2xlYXIoKTtcclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIHUgaW4gdW5pdHNQcmVHYW1lKVxyXG4gICAgICAgICAgICAgICAgY1VuaXRzUHJlR2FtZS5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkJ1dHRvbj4obmV3IE1vbm9JbnRlcmZhY2UuQnV0dG9uKGJ0blVuaXRQcmVHYW1lX0NsaWNrZWQsIGJ0blVuaXRQcmVHYW1lX0ZvY3VzZWQsIDUsIDUsIDQ1LCA0NSwgaG9yQWxpZ246IDAuMGYsIHZlckFsaWduOiAwLjBmKSkuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5QaWN0dXJlPihuZXcgTW9ub0ludGVyZmFjZS5QaWN0dXJlKHVuaXRQcm1zW3VdLmljb25BcHAsIHc6IDQ1LCBoOiA0NSkpO1xyXG4gICAgICAgICAgICBjVW5pdHNQcmVHYW1lLkFwcGx5VGhlbWUoZGVmYXVsdFRoZW1lKTtcclxuICAgICAgICAgICAgLy8gZnJtUHJlR2FtZS5BZGRCdXR0b24oNSwgZGVsdGEsIDE2LCAxNiwgLCBcIlJhbmRvbVNwZWxsc1wiLCBLZXlzLkQyKVxyXG4gICAgICAgICAgICAvLyBmcm1QcmVHYW1lLkFkZEltYWdlKDUsIGRlbHRhLCAxOSwgMTUsIFwic21hbGxfaWNvbnNcIiwgMTYpXHJcblxyXG4gICAgICAgICAgICBjU3BlbGxzUHJlR2FtZS5DaGlsZHJlbi5DbGVhcigpO1xyXG4gICAgICAgICAgICBmb3JlYWNoICh2YXIgcyBpbiBzcGVsbHNQcmVHYW1lKVxyXG4gICAgICAgICAgICAgICAgY1NwZWxsc1ByZUdhbWUuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5CdXR0b24+KG5ldyBNb25vSW50ZXJmYWNlLkJ1dHRvbihidG5TcGVsbHNQcmVHYW1lX0NsaWNrZWQsIGJ0blNwZWxsc1ByZUdhbWVfRm9jdXNlZCwgNSwgNSwgNDUsIDQ1LCBob3JBbGlnbjogMC4wZiwgdmVyQWxpZ246IDAuMGYpKS5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLlBpY3R1cmU+KG5ldyBNb25vSW50ZXJmYWNlLlBpY3R1cmUobmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW1wic3BlbGxzX2ljb25zXCJdLCBzcGVsbHNbc10uSW1nKSwgdzogNDUsIGg6IDQ1KSk7XHJcbiAgICAgICAgICAgIGNTcGVsbHNQcmVHYW1lLkFwcGx5VGhlbWUoZGVmYXVsdFRoZW1lKTtcclxuICAgICAgICAgICAgLy8gZnJtUHJlR2FtZS5BZGRCdXR0b24oNSwgZGVsdGEsIDE2LCAxNiwgLCBcIlJhbmRvbUJ1aWxkaW5nc1wiLCBLZXlzLkQzKVxyXG4gICAgICAgICAgICAvLyBmcm1QcmVHYW1lLkFkZEltYWdlKDUsIGRlbHRhLCAxOSwgMTUsIFwic21hbGxfaWNvbnNcIiwgMTYpXHJcblxyXG5cclxuICAgICAgICAgICAgY0J1aWxkaW5nc1ByZUdhbWUuQ2hpbGRyZW4uQ2xlYXIoKTtcclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIGIgaW4gc3RhcnRCdWlsZGluZ3NMaXN0KVxyXG4gICAgICAgICAgICAgICAgY0J1aWxkaW5nc1ByZUdhbWUuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5CdXR0b24+KG5ldyBNb25vSW50ZXJmYWNlLkJ1dHRvbihidG5CdWlsZGluZ1ByZUdhbWVfQ2xpY2tlZCwgYnRuQnVpbGRpbmdQcmVHYW1lX0ZvY3VzZWQsIDUsIDUsIDQ1LCA0NSwgaG9yQWxpZ246IDAuMGYsIHZlckFsaWduOiAwLjBmKSkuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5QaWN0dXJlPihuZXcgTW9ub0ludGVyZmFjZS5QaWN0dXJlKHVuaXRQcm1zW2JdLmljb25BcHAsIHc6IDQ1LCBoOiA0NSkpO1xyXG4gICAgICAgICAgICBjQnVpbGRpbmdzUHJlR2FtZS5BcHBseVRoZW1lKGRlZmF1bHRUaGVtZSk7XHJcblxyXG4gICAgICAgICAgICBjU2VsZWN0ZWRQcmVHYW1lLkNoaWxkcmVuLkNsZWFyKCk7XHJcbiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcHJlR2FtZVNsb3RDbnQ7IGkrKylcclxuICAgICAgICAgICAgICAgIGNTZWxlY3RlZFByZUdhbWUuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5CdXR0b24+KG5ldyBNb25vSW50ZXJmYWNlLkJ1dHRvbihidG5TZWxlY3RlZFByZUdhbWVfQ2xpY2tlZCwgYnRuU2VsZWN0ZWRQcmVHYW1lX0ZvY3VzZWQsIDUsIDUsIDQ1LCA0NSwgaG9yQWxpZ246IDAuMGYpKS5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLlBpY3R1cmU+KG5ldyBNb25vSW50ZXJmYWNlLlBpY3R1cmUoZGVmYXVsdFRoZW1lLkVtcHR5VGV4dHVyZSwgdzogNDUsIGg6IDQ1KSk7XHJcbiAgICAgICAgICAgIGNTZWxlY3RlZFByZUdhbWUuQXBwbHlUaGVtZShkZWZhdWx0VGhlbWUpO1xyXG5cclxuICAgICAgICAgICAgcHJlR2FtZVVuaXRzLkNsZWFyKCk7XHJcbiAgICAgICAgICAgIHByZUdhbWVTcGVsbHMuQ2xlYXIoKTtcclxuICAgICAgICAgICAgcHJlR2FtZUJvbnVzLkNsZWFyKCk7XHJcblxyXG4gICAgICAgICAgICBjVW5pdHNQcmVHYW1lLlZpc2libGUgPSB0cnVlO1xyXG5cclxuXHJcbiAgICAgICAgICAgIGZybVByZUdhbWUuU2hvdyhtYWluQW5pbWF0b3IpO1xyXG5cclxuICAgICAgICAgICAgYnRuVW5pdHNQcmVHYW1lLkNsaWNrKDAsIDAsIGZhbHNlKTtcclxuICAgICAgICAgICAgU2V0UHJlR2FtZUxpc3RzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBUYXNrQ29tcGxldGlvblNvdXJjZTxib29sPiB0YXNrQ29uZmlybTtcclxuXHJcbiAgICAgICAgcHVibGljIFRhc2s8Ym9vbD4gU2hvd0RpYWxvZ0NvbmZpcm1hdGlvbihzdHJpbmcgc3RyKSB7XHJcbiAgICAgICAgICAgIGxibFRleHRGcm1Db25maXJtLlRleHQgPSBzdHI7XHJcbiAgICAgICAgICAgIGZybUNvbmZpcm0uU2hvdyhtYWluQW5pbWF0b3IpO1xyXG5cclxuICAgICAgICAgICAgdGFza0NvbmZpcm0gPSBuZXcgVGFza0NvbXBsZXRpb25Tb3VyY2U8Ym9vbD4oKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRhc2tDb25maXJtLlRhc2s7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgU2V0UGxheWVyQUkoYm9vbCB2YWwpIHtcclxuICAgICAgICAgICAgcGxyc1swXS5BSSA9IHZhbDtcclxuICAgICAgICAgICAgbGJsQUlGcm1CYXR0bGVNZW51LlRleHQgPSB2YWwgPyBcItCf0LXRgNC10LrQu9GO0YfQuNGC0Ywg0L3QsCDQuNCz0YDQvtC60LBcIiA6IFwi0J/QtdGA0LXQutC70Y7Rh9C40YLRjCDQvdCwINCY0JhcIjtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBTZWxlY3RQbGF5aW5nUmFjZShMaXN0PHN0cmluZz4gdUxpc3QpIHtcclxuICAgICAgICAgICAgRGljdGlvbmFyeTxzdHJpbmcsIGludD4gdG1wZGljID0gbmV3IERpY3Rpb25hcnk8c3RyaW5nLCBpbnQ+KCk7XHJcbiAgICAgICAgICAgIHN0cmluZyBtYXhyYWNlID0gXCJcIjtcclxuICAgICAgICAgICAgaW50IG1heGNudCA9IDA7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKHN0cmluZyB1IGluIHVMaXN0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodG1wZGljLkNvbnRhaW5zS2V5KE15R2FtZS51bml0UHJtc1t1XS5SYWNlKSlcclxuICAgICAgICAgICAgICAgICAgICB0bXBkaWNbdW5pdFBybXNbdV0uUmFjZV0gKz0gMTtcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICB0bXBkaWMuQWRkKHVuaXRQcm1zW3VdLlJhY2UsIDEpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRtcGRpY1t1bml0UHJtc1t1XS5SYWNlXSA+IG1heGNudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG1heGNudCA9IHRtcGRpY1t1bml0UHJtc1t1XS5SYWNlXTtcclxuICAgICAgICAgICAgICAgICAgICBtYXhyYWNlID0gdW5pdFBybXNbdV0uUmFjZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbWF4cmFjZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFN0YXJ0UGxheWluZygpIHtcclxuICAgICAgICAgICAgU2hvd1NvbWVDaGlsZHJlbihmcm1Vbml0cywgZnJtUmVzb3VyY2VzKTtcclxuICAgICAgICAgICAgSGlkZVNvbWVDaGlsZHJlbihmcm1NYWluTWVudSwgZnJtUmlnaHRNZW51KTtcclxuXHJcblxyXG4gICAgICAgICAgICBTZXRQbGF5ZXJBSShzdGFydEF1dG9maWdodCk7XHJcblxyXG4gICAgICAgICAgICBwbHJzWzBdLnVuaXRzTGlzdC5DbGVhcigpO1xyXG4gICAgICAgICAgICBwbHJzWzBdLnNwbGxzTGlzdC5DbGVhcigpO1xyXG4gICAgICAgICAgICBwbHJzWzBdLmJvbnVzTGlzdC5DbGVhcigpO1xyXG5cclxuICAgICAgICAgICAgcGxyc1swXS51bml0c0xpc3QuQWRkUmFuZ2UocHJlR2FtZVVuaXRzKTtcclxuICAgICAgICAgICAgcGxyc1swXS5zcGxsc0xpc3QuQWRkUmFuZ2UocHJlR2FtZVNwZWxscyk7XHJcbiAgICAgICAgICAgIHBscnNbMF0uYm9udXNMaXN0LkFkZFJhbmdlKHByZUdhbWVCb251cyk7XHJcblxyXG5cclxuICAgICAgICAgICAgLy8g0JLRi9Cx0LjRgNCw0LXQvCDRgdGD0YnQtdGB0YLQsiDQstGC0L7RgNC+0LzRgyDQuNCz0YDQvtC60YNcclxuICAgICAgICAgICAgaWYgKFJhY2VNYW5hZ2VyLkluc3RhbmNlLkFsbFtwbHJzWzFdLnJhY2VdLmN1c3RvbSlcclxuICAgICAgICAgICAgICAgIHBscnNbMV0udW5pdHNMaXN0ID0gUmFuZG9taXplVW5pdHMoNywgbmV3IExpc3Q8c3RyaW5nPigpLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IGFsbHVudHMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcbiAgICAgICAgICAgICAgICBmb3JlYWNoIChVbml0UGFyYW1ldGVycyB1IGluIHVuaXRQcm1zLlZhbHVlcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1LlJhY2UgPT0gcGxyc1sxXS5yYWNlICYmICF1LnNwZWNpYWwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsbHVudHMuQWRkKHUuTmFtZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcGxyc1sxXS51bml0c0xpc3QgPSBSYW5kb21pemVVbml0cyg3LCBhbGx1bnRzLCB0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcGxyc1sxXS5ib251c0xpc3QgPSBSYW5kb21pemVCdWlsZGluZ3MoMTAgLSBwbHJzWzFdLnVuaXRzTGlzdC5Db3VudCwgcGxyc1sxXS5ib251c0xpc3QpO1xyXG5cclxuXHJcblxyXG4gICAgICAgICAgICBwbHJzWzBdLmhlcm8gPSBcIkNhc3RsZVwiO1xyXG4gICAgICAgICAgICBwbHJzWzFdLmhlcm8gPSBcIkNhc3RsZVwiO1xyXG5cclxuICAgICAgICAgICAgcGxyc1swXS5jYXN0bGVGaWxlTmFtZSA9IEdldENhdGxlRmlsZU5hbWUocGxyc1swXS5yYWNlKTtcclxuICAgICAgICAgICAgcGxyc1sxXS5jYXN0bGVGaWxlTmFtZSA9IEdldENhdGxlRmlsZU5hbWUocGxyc1sxXS5yYWNlKTtcclxuXHJcbiAgICAgICAgICAgIFN0YXJ0QWdhaW4oKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChwbHJzWzBdLmhlcm8gIT0gXCJcIilcclxuICAgICAgICAgICAgICAgIHVuaXRzWzBdLnBhcmFtZXRlcnMuUmFjZSA9IHBscnNbMF0ucmFjZTtcclxuXHJcbiAgICAgICAgICAgIGlmIChwbHJzWzFdLmhlcm8gIT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgaWYgKHBscnNbMF0uaGVybyA9PSBcIlwiKVxyXG4gICAgICAgICAgICAgICAgICAgIHVuaXRzWzBdLnBhcmFtZXRlcnMuUmFjZSA9IHBscnNbMV0ucmFjZTtcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICB1bml0c1sxXS5wYXJhbWV0ZXJzLlJhY2UgPSBwbHJzWzFdLnJhY2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGJ0blNlbGVjdFVuaXRzLkNsaWNrKDAsIDAsIHRydWUpO1xyXG5cclxuICAgICAgICAgICAgU2hvd0luZm9QYXIobG9jYWxpemUuR2V0U3RyaW5nKGdUeXBlLlRvU3RyaW5nKCkgKyBcIkRlc2NcIiksIGdvb2RBYmlsQ2xyLCBnYW1lV2lkdGggLyAyLCBnYW1lSGVpZ2h0IC8gMiwgdHJ1ZSwgdHJ1ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RyaW5nIEdldENhdGxlRmlsZU5hbWUoc3RyaW5nIHJhY2UpIHtcclxuICAgICAgICAgICAgc3dpdGNoIChyYWNlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiSHVtYW5zXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiaHFzX2RhZW1vbmljXCI7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiRGVtb25zXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiaHFzX2h1bWFuXCI7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiRHdhcmZzXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiaHFzX2R2YXJ2ZW5cIjtcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJFbHZlc1wiOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcImhxc19lbHZpc2hcIjtcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJIb3JkZVwiOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcImhxc19vcmNpc2hcIjtcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJTdGVhbXB1bmtcIjpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJocXNfc3RlYW1wdW5rXCI7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiU3dhbXBlcnNcIjpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJocXNfc3dhbXBjbGFuXCI7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiVW5kZWFkc1wiOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcImhxc191bmRlYWRcIjtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgcmV0dXJuIFwiaHFzXCI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBTdGFydEJhdHRsZSgpIHtcclxuICAgICAgICAgICAgZnJtQmF0dGxlLlNob3cobWFpbkFuaW1hdG9yKTtcclxuICAgICAgICAgICAgZnJtUHJlR2FtZS5IaWRlKG1haW5BbmltYXRvcik7XHJcblxyXG4gICAgICAgICAgICByYWNlczFTd2l0Y2hlckZybUJhdHRsZS5DdXJyZW50ID0gMDtcclxuICAgICAgICAgICAgcmFjZXMyU3dpdGNoZXJGcm1CYXR0bGUuQ3VycmVudCA9IDA7XHJcbiAgICAgICAgICAgIG1vZGVTd2l0Y2hlckZybUJhdHRsZS5DdXJyZW50ID0gMTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFNldFByZUdhbWVMaXN0cygpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcmVHYW1lU2xvdENudDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYnRuID0gY1NlbGVjdGVkUHJlR2FtZS5DaGlsZHJlbltpXSBhcyBNb25vSW50ZXJmYWNlLkJ1dHRvbjtcclxuICAgICAgICAgICAgICAgIHZhciBwY3QgPSBidG4uQ2hpbGRyZW5bMF0gYXMgTW9ub0ludGVyZmFjZS5QaWN0dXJlO1xyXG4gICAgICAgICAgICAgICAgaWYgKHByZUdhbWVVbml0cy5Db3VudCA+IGkpXHJcbiAgICAgICAgICAgICAgICAgICAgcGN0LnNwcml0ZVJlZiA9IHVuaXRQcm1zW3ByZUdhbWVVbml0c1tpXV0uaWNvbkFwcDtcclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHByZUdhbWVTcGVsbHMuQ291bnQgPiBpIC0gcHJlR2FtZVVuaXRzLkNvdW50KVxyXG4gICAgICAgICAgICAgICAgICAgIHBjdC5zcHJpdGVSZWYgPSBuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJzcGVsbHNfaWNvbnNcIl0sIHNwZWxsc1twcmVHYW1lU3BlbGxzW2kgLSBwcmVHYW1lVW5pdHMuQ291bnRdXS5JbWcpO1xyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAocHJlR2FtZUJvbnVzLkNvdW50ID4gaSAtIHByZUdhbWVVbml0cy5Db3VudCAtIHByZUdhbWVTcGVsbHMuQ291bnQpXHJcbiAgICAgICAgICAgICAgICAgICAgcGN0LnNwcml0ZVJlZiA9IHVuaXRQcm1zW3ByZUdhbWVCb251c1tpIC0gcHJlR2FtZVVuaXRzLkNvdW50IC0gcHJlR2FtZVNwZWxscy5Db3VudF1dLmljb25BcHA7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgcGN0LnNwcml0ZVJlZiA9IGRlZmF1bHRUaGVtZS5FbXB0eVRleHR1cmU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIGNvbXBsZXRlZEFsbCA9IHByZUdhbWVVbml0cy5Db3VudCArIHByZUdhbWVTcGVsbHMuQ291bnQgKyBwcmVHYW1lQm9udXMuQ291bnQgPT0gMTA7XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHVuaXRzUHJlR2FtZS5Db3VudDsgaSsrKVxyXG4gICAgICAgICAgICAgICAgKGNVbml0c1ByZUdhbWUuQ2hpbGRyZW5baV0gYXMgTW9ub0ludGVyZmFjZS5CdXR0b24pLklzRGlzYWJsZWQgPSBwcmVHYW1lVW5pdHMuQ29udGFpbnModW5pdHNQcmVHYW1lW2ldKSB8fCBjb21wbGV0ZWRBbGwgfHwgcHJlR2FtZVVuaXRzLkNvdW50ID09IDc7XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNwZWxsc1ByZUdhbWUuQ291bnQ7IGkrKylcclxuICAgICAgICAgICAgICAgIChjU3BlbGxzUHJlR2FtZS5DaGlsZHJlbltpXSBhcyBNb25vSW50ZXJmYWNlLkJ1dHRvbikuSXNEaXNhYmxlZCA9IHByZUdhbWVTcGVsbHMuQ29udGFpbnMoc3BlbGxzUHJlR2FtZVtpXSkgfHwgY29tcGxldGVkQWxsIHx8IHByZUdhbWVTcGVsbHMuQ291bnQgPT0gNztcclxuXHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3RhcnRCdWlsZGluZ3NMaXN0LkNvdW50OyBpKyspXHJcbiAgICAgICAgICAgICAgICAoY0J1aWxkaW5nc1ByZUdhbWUuQ2hpbGRyZW5baV0gYXMgTW9ub0ludGVyZmFjZS5CdXR0b24pLklzRGlzYWJsZWQgPSBwcmVHYW1lQm9udXMuQ29udGFpbnMoc3RhcnRCdWlsZGluZ3NMaXN0W2ldKSB8fCBjb21wbGV0ZWRBbGwgfHwgcHJlR2FtZUJvbnVzLkNvdW50ID09IDc7XHJcblxyXG4gICAgICAgICAgICBidG5GaWdodFByZUdhbWUuSXNEaXNhYmxlZCA9IHByZUdhbWVVbml0cy5Db3VudCArIHByZUdhbWVTcGVsbHMuQ291bnQgKyBwcmVHYW1lQm9udXMuQ291bnQgPT0gMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFNldEVkaXRvclVuaXRzKCkge1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIExpc3Q8c3RyaW5nPiBTb3J0VW5pdHNMaXN0cyhMaXN0PHN0cmluZz4gdW5pdHMpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFN5c3RlbS5MaW5xLkVudW1lcmFibGUuT3JkZXJCeTxzdHJpbmcsaW50Pih1bml0c1xyXG4sKEZ1bmM8c3RyaW5nLGludD4pKHVuaXQgPT4gdW5pdFBybXNbdW5pdF0uQ29zdC5UaWVyKSlcclxuICAgICAgICAgICAgICAgIC5UaGVuQnk8aW50PigoRnVuYzxzdHJpbmcsaW50PikodW5pdCA9PiB1bml0UHJtc1t1bml0XS5Db3N0Lk1vbmV5KSlcclxuICAgICAgICAgICAgICAgIC5Ub0xpc3QoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBMaXN0PHN0cmluZz4gU29ydFNwZWxsc0xpc3RzKExpc3Q8c3RyaW5nPiBzcGVsbHMpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFN5c3RlbS5MaW5xLkVudW1lcmFibGUuT3JkZXJCeTxzdHJpbmcsaW50PihzcGVsbHNcclxuLChGdW5jPHN0cmluZyxpbnQ+KShzcGVsbCA9PiB0aGlzLnNwZWxsc1tzcGVsbF0uQ29zdC5UaWVyKSlcclxuICAgICAgICAgICAgICAgIC5UaGVuQnk8aW50PigoRnVuYzxzdHJpbmcsaW50Pikoc3BlbGwgPT4gdGhpcy5zcGVsbHNbc3BlbGxdLkNvc3QuRGVhdGgpKVxyXG4gICAgICAgICAgICAgICAgLlRvTGlzdCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgUGF1c2Uge1xyXG4gICAgICAgICAgICBnZXQge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9wYXVzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXQge1xyXG4gICAgICAgICAgICAgICAgX3BhdXNlID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICBpZiAoZ1N0YXRlID09IEdhbWVTdGF0ZS5JbkdhbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoX3BhdXNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBjdFBhdXNlRnJtUmVzb3VyY2VzLnNwcml0ZVJlZiA9IG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcIm1lZGl1bV9pY29uc1wiXSwgOCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZybUJhdHRsZU1lbnUuU2hvdyhtYWluQW5pbWF0b3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBjdFBhdXNlRnJtUmVzb3VyY2VzLnNwcml0ZVJlZiA9IG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcIm1lZGl1bV9pY29uc1wiXSwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZybUJhdHRsZU1lbnUuSGlkZShtYWluQW5pbWF0b3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgTmV3Ym9ybihpbnQgcGxyLCBVbml0IHUsIGJvb2wgaW5TdGFjaykge1xyXG4gICAgICAgICAgICBmb3JlYWNoIChVbml0IHV1IGluIHVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodXUub3duZXIgPT0gcGxyc1twbHJdLmlkICYmIHV1LkFic0NvbnRhaW5zKFwiV29tYkFiaWxcIikpXHJcbiAgICAgICAgICAgICAgICAgICAgdS54ID0gdXUueCArIDUgKiBwbHJzW3Bscl0ubW92ZXNpZGU7XHJcbiAgICAgICAgICAgICAgICBpZiAodXUub3duZXIgPT0gcGxyc1twbHJdLmlkICYmIHV1LkFic0NvbnRhaW5zKFwiU3RhY2tfaGVscGVyXCIpICYmIGluU3RhY2spXHJcbiAgICAgICAgICAgICAgICAgICAgdS54ID0gdXUueCArIDEwICogcGxyc1twbHJdLm1vdmVzaWRlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh1LkFic0NvbnRhaW5zKFwiUmFuZG9tX3Bvc2l0aW9uXCIpKSB7XHJcbiAgICAgICAgICAgICAgICB1LnggPSBybmQuTmV4dCg1MCwgZ2FtZVdpZHRoIC0gNDkpO1xyXG4gICAgICAgICAgICAgICAgcGFycy5BZGQobmV3IEltYWdlUGFydGljbGUobmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW1wiZXhwbG9kZVwiXSwgMiksIHUueCAtIDI1LCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Cb3R0b20gLSB1czIgLSAyNSwgMCwgMCwgMjApKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodS5BYnNDb250YWlucyhcIkZyZWVcIikpIHtcclxuICAgICAgICAgICAgICAgIHUucGFyYW1ldGVycy5Db3N0Lk1vbmV5ID0gODA7XHJcbiAgICAgICAgICAgICAgICBpZiAodS54IDw9IGdhbWVXaWR0aCAvIChkb3VibGUpMikge1xyXG4gICAgICAgICAgICAgICAgICAgIHUub3duZXIgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIHUubW92ZXNpZGUgPSBwbHJzWzBdLm1vdmVzaWRlO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB1Lm93bmVyID0gMTtcclxuICAgICAgICAgICAgICAgICAgICB1Lm1vdmVzaWRlID0gcGxyc1sxXS5tb3Zlc2lkZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodS5hYmlscy5Db250YWluc0tleShcIlNhY3JpZmljZVwiKSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHV1ID0gRmluZFJhbmRvbVVuZmx5VW5pdCgxIC0gcGxyKTtcclxuICAgICAgICAgICAgICAgIGlmICh1dSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdS54ID0gdXUueDtcclxuICAgICAgICAgICAgICAgICAgICBLaWxsKHV1KTtcclxuICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCf0YDQuNC30LLQsNC9XCIsIGdvb2RBYmlsQ2xyLCB1LngsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHUuYWJpbHMuQ29udGFpbnNLZXkoXCJBc3NhdWx0XCIpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXUgPSBGaW5kRmlyc3RVbmZseVVuaXQocGxyKTtcclxuICAgICAgICAgICAgICAgIGlmICh1dSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdS54ID0gdXUueCAtIHVzMiAqIHBscnNbcGxyXS5tb3Zlc2lkZTtcclxuICAgICAgICAgICAgICAgICAgICBwYXJzLkFkZChuZXcgSW1hZ2VQYXJ0aWNsZShuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJleHBsb2RlXCJdLCAyKSwgdS54IC0gMjUsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LkJvdHRvbSAtIHVzMiAtIDI1LCAwLCAwLCAyMCkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh1LmFiaWxzLkNvbnRhaW5zS2V5KFwiRW5jb3VyYWdlX2ZpcnN0XCIpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXUgPSBGaW5kRmlyc3RVbmZseVVuaXQodS5vd25lcik7XHJcbiAgICAgICAgICAgICAgICBpZiAodXUgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHUuYWJpbHNbXCJFbmNvdXJhZ2VfZmlyc3RcIl0udXNlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgdXUucGFyYW1ldGVycy5Bcm1vciA9IFwiSGVhdnlcIjtcclxuICAgICAgICAgICAgICAgICAgICB1dS5BdHRhY2sgKz0gdS5hYmlsc1tcIkVuY291cmFnZV9maXJzdFwiXS52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCj0YHQuNC70LXQvVwiLCBnb29kQWJpbENsciwgdXUueCwgaG9yICsgdXUucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHUuYWJpbHMuQ29udGFpbnNLZXkoXCJTd2FybVwiKSkge1xyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAoVW5pdCB1dSBpbiB1bml0cykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1dSAhPSB1ICYmIHV1Lm93bmVyID09IHUub3duZXIgJiYgdXUuQWJzQ29udGFpbnMoXCJTd2FybVwiKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXUuQXR0YWNrICs9IHUuYWJpbHNbXCJTd2FybVwiXS52YWx1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmb3JlYWNoIChVbml0IHV1IGluIHVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodXUub3duZXIgIT0gdS5vd25lciAmJiB1dS5BYnNDb250YWlucyhcIlBvaXNvbl9vbl9wcm9kXCIpICYmIHJuZC5OZXh0KDEwMCkgPCB1dS5hYmlsc1tcIlBvaXNvbl9vbl9wcm9kXCJdLnZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdS5BZGRBYmlsaXR5KFwiUG9pc29uXCIsIEVmZmVjdFR5cGUuUG9pc29uKTtcclxuICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCS0YDQsNCzINC+0YLRgNCw0LLQu9C10L1cIiwgZ29vZEFiaWxDbHIsIHV1LngsIGhvciArIHV1LnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFByb2R1Y2VVbml0KGludCBwbHIsIHN0cmluZyBuYW1lLCBpbnQgYXRrYm9udXMgPSAwLCBpbnQgaHBib251cyA9IDAsIHN0cmluZyBhcm1vckNoYW5nZSA9IFwiXCIsIExpc3Q8QWJpbGl0eT4gYWRkYWJpbHMgPSBudWxsLCBib29sIGluU3RhY2sgPSBmYWxzZSkge1xyXG4gICAgICAgICAgICBpZiAoIXVuaXRQcm1zW25hbWVdLnVwZ3JhZGUpIHtcclxuICAgICAgICAgICAgICAgIFVuaXQgdSA9IG5ldyBVbml0KHRoaXMsIHBscnNbcGxyXS5iYXNlWCArIHBscnNbcGxyXS5tb3Zlc2lkZSwgcGxyc1twbHJdLm1vdmVzaWRlLCBwbHJzW3Bscl0uaWQsIHVuaXRQcm1zW25hbWVdKTtcclxuICAgICAgICAgICAgICAgIGlmIChhZGRhYmlscyAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoQWJpbGl0eSBhIGluIGFkZGFiaWxzKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB1LkFkZEFiaWxpdHkoYSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB1LkF0dGFjayArPSBhdGtib251cztcclxuICAgICAgICAgICAgICAgIHUucGFyYW1ldGVycy5tYXhocCArPSBocGJvbnVzO1xyXG4gICAgICAgICAgICAgICAgdS5ocCArPSBocGJvbnVzO1xyXG4gICAgICAgICAgICAgICAgaWYgKGFybW9yQ2hhbmdlICE9IFwiXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgdS5wYXJhbWV0ZXJzLkFybW9yID0gYXJtb3JDaGFuZ2U7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIE5ld2Jvcm4ocGxyLCB1LCBpblN0YWNrKTtcclxuICAgICAgICAgICAgICAgIGJvcm5MaXN0LkFkZCh1KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAobmFtZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJUaWVyXzJcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxyc1twbHJdLnJlcy5UaWVyICs9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGxyID09IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGN0VGllckZybVJlc291cmNlcy5zcHJpdGVSZWYgPSB1bml0UHJtc1tcIlRpZXJfM1wiXS5pY29uQXBwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIlRpZXJfM1wiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbHJzW3Bscl0ucmVzLlRpZXIgKz0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBmb3JlYWNoIChVbml0IHUgaW4gdW5pdHMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodS5vd25lciA9PSBwbHIgJiYgdS5BYnNDb250YWlucyhcIlJlZnJlc2hcIikgJiYgdS5ocCA8IHUucGFyYW1ldGVycy5tYXhocCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1LmhwID0gdS5wYXJhbWV0ZXJzLm1heGhwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCS0L7RgdGB0YLQsNC90L7QstC70LXQvVwiLCBnb29kQWJpbENsciwgdS54LCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgS2lsbChVbml0IHUpIHtcclxuICAgICAgICAgICAgaWYgKCFkZWF0aGxpc3QuQ29udGFpbnModSkpXHJcbiAgICAgICAgICAgICAgICBkZWF0aGxpc3QuQWRkKHUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgQ2hhbmdlTGFuZHNjYXBlKExhbmRzY2FwZVR5cGUgbmV3bCkge1xyXG4gICAgICAgICAgICBiYWNrcGFycy5DbGVhcigpO1xyXG4gICAgICAgICAgICBidXNocGFycy5DbGVhcigpO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKG5ld2wpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgTGFuZHNjYXBlVHlwZS5QbGFpbkxTOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhbmRCbXAgPSBcImdyb3VuZFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnQgbnVtID0gcm5kLk5leHQoNSwgMTEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bTsgaSsrKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFja3BhcnMuQWRkKG5ldyBJbWFnZVBhcnRpY2xlKG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcImJhY2swXCJdLCBybmQuTmV4dCg0KSksIChmbG9hdCkoMTI1ICsgKGdhbWVXaWR0aCAtIDI1MCkgLyAobnVtIC0gMSkgKiBpIC0gNDIgKyA0MCAqIHJuZC5OZXh0RG91YmxlKCkpLCBob3IgLSA3MCwgMCwgMCwgLTEsIHJuZC5OZXh0RG91YmxlKCkgPiAwLjUpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbnVtID0gcm5kLk5leHQoNDAsIDUxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW07IGkrKylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1c2hwYXJzLkFkZChuZXcgSW1hZ2VQYXJ0aWNsZShuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJidXNoMFwiXSwgcm5kLk5leHQoNSkpLCAoZmxvYXQpKGdhbWVXaWR0aCAvIChudW0gLSAxKSAqIGkgLSA0MiArIDQwICogcm5kLk5leHREb3VibGUoKSksIGhvciAtIDE1LCAwLCAwLCAtMSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSBMYW5kc2NhcGVUeXBlLkRlc2VydExTOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhbmRCbXAgPSBcImRlc2VydFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSBMYW5kc2NhcGVUeXBlLlN3YW1wTFM6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGFuZEJtcCA9IFwic3dhbXBcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW50IG51bSA9IHJuZC5OZXh0KDEwLCAxMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtOyBpKyspXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWNrcGFycy5BZGQobmV3IEltYWdlUGFydGljbGUobmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW1wiYmFjazFcIl0sIHJuZC5OZXh0KDMpKSwgKGZsb2F0KSgxMjUgKyAoZ2FtZVdpZHRoIC0gMjUwKSAvIChudW0gLSAxKSAqIGkgLSA0MiArIDQwICogcm5kLk5leHREb3VibGUoKSksIGhvciAtIDcwLCAwLCAwLCAtMSwgcm5kLk5leHREb3VibGUoKSA+IDAuNSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSBMYW5kc2NhcGVUeXBlLkRlYXRobGFuZExTOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhbmRCbXAgPSBcImRlYXRobGFuZFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnQgbnVtID0gcm5kLk5leHQoNSwgMTEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bTsgaSsrKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFja3BhcnMuQWRkKG5ldyBJbWFnZVBhcnRpY2xlKG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcImJhY2syXCJdLCBybmQuTmV4dCg0KSksIChmbG9hdCkoMTI1ICsgKGdhbWVXaWR0aCAtIDI1MCkgLyAobnVtIC0gMSkgKiBpIC0gNTAgKyA0MCAqIHJuZC5OZXh0RG91YmxlKCkpLCBob3IgLSA3MCwgMCwgMCwgLTEsIHJuZC5OZXh0RG91YmxlKCkgPiAwLjUpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgTGFuZHNjYXBlVHlwZS5NZWNoYW5pY3NMUzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYW5kQm1wID0gXCJtZWNoYW5pY3NcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgTGFuZHNjYXBlVHlwZS5Gb3Jlc3RMUzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYW5kQm1wID0gXCJmb3Jlc3RcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW50IG51bSA9IHJuZC5OZXh0KDEwLCAxNik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtOyBpKyspXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWNrcGFycy5BZGQobmV3IEltYWdlUGFydGljbGUobmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW1wiYmFjazBcIl0sIHJuZC5OZXh0KDQpKSwgMTI1ICsgKGdhbWVXaWR0aCAtIDI1MCkgLyAobnVtIC0gMSkgKiBpIC0gMzIgKyAyMCAqIChmbG9hdClybmQuTmV4dERvdWJsZSgpLCBob3IgLSA3MCwgMCwgMCwgLTEsIHJuZC5OZXh0RG91YmxlKCkgPiAwLjUpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgTGFuZHNjYXBlVHlwZS5JbmZlcm5vTFM6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGFuZEJtcCA9IFwiaW5mZXJub2xhbmRcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIFRleHR1cmUyRCBiYWNrRmlsbFRleDtcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBUZXh0dXJlMkQgaGVhbHRoQmFyQmFja1RleDtcclxuICAgICAgICBwcml2YXRlIFRleHR1cmUyRCBoZWFsdGhCYXJMaWZlVGV4O1xyXG4gICAgICAgIHByaXZhdGUgVGV4dHVyZTJEIGhlYWx0aEJhclBvaXNvblRleDtcclxuICAgICAgICBwcml2YXRlIFRleHR1cmUyRCBoZWFsdGhCYXJBYmlsVGV4O1xyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBVcGRhdGVTa3lUZXh0dXJlKFRleHR1cmUyRCB0ZXgsIGludCBoLCBkb3VibGUgY2xyMVIsIGRvdWJsZSBjbHIxRywgZG91YmxlIGNscjFCLCBkb3VibGUgY2xyMUEsIGRvdWJsZSBjbHIyUiwgZG91YmxlIGNscjJHLCBkb3VibGUgY2xyMkIsIGRvdWJsZSBjbHIyQSkge1xyXG4gICAgICAgICAgICB2YXIgZFIgPSAoY2xyMlIgLSBjbHIxUikgLyBoO1xyXG4gICAgICAgICAgICB2YXIgZEcgPSAoY2xyMkcgLSBjbHIxRykgLyBoO1xyXG4gICAgICAgICAgICB2YXIgZEIgPSAoY2xyMkIgLSBjbHIxQikgLyBoO1xyXG4gICAgICAgICAgICB2YXIgZEEgPSAoY2xyMkEgLSBjbHIxQSkgLyBoO1xyXG4jaWYgQlJPV1NFUlxyXG4gICAgICAgICAgICB2YXIgZGF0YSA9IG5ldyBpbnRbaCAqIDRdO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGggKiA0OyBpICs9IDQpIHtcclxuICAgICAgICAgICAgICAgIGRhdGFbaV0gPSAoaW50KWNscjFSO1xyXG4gICAgICAgICAgICAgICAgZGF0YVtpICsgMV0gPSAoaW50KWNscjFHO1xyXG4gICAgICAgICAgICAgICAgZGF0YVtpICsgMl0gPSAoaW50KWNscjFCO1xyXG4gICAgICAgICAgICAgICAgZGF0YVtpICsgM10gPSAoaW50KWNscjFBO1xyXG4gICAgICAgICAgICAgICAgY2xyMVIgKz0gZFI7XHJcbiAgICAgICAgICAgICAgICBjbHIxRyArPSBkRztcclxuICAgICAgICAgICAgICAgIGNscjFCICs9IGRCO1xyXG4gICAgICAgICAgICAgICAgY2xyMUEgKz0gZEE7XHJcbiAgICAgICAgICAgIH1cclxuI2Vsc2VcclxuICAgICAgICAgICAgdmFyIGRhdGEgPSBuZXcgQ29sb3JbaF07XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaDsgaSArPSAxKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBkYXRhW2ldID0gbmV3IENvbG9yKChpbnQpY2xyMVIsIChpbnQpY2xyMUcsIChpbnQpY2xyMUIsIChpbnQpY2xyMUEpO1xyXG4gICAgICAgICAgICAgICAgY2xyMVIgKz0gZFI7XHJcbiAgICAgICAgICAgICAgICBjbHIxRyArPSBkRztcclxuICAgICAgICAgICAgICAgIGNscjFCICs9IGRCO1xyXG4gICAgICAgICAgICAgICAgY2xyMUEgKz0gZEE7XHJcbiAgICAgICAgICAgIH1cclxuI2VuZGlmXHJcbiAgICAgICAgICAgIHRleC5TZXREYXRhPENvbG9yPihkYXRhLCAwLCBoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgVGV4dHVyZTJEIHNreXRleHR1cmU7XHJcbiAgICAgICAgcHJpdmF0ZSBUZXh0dXJlMkQgc3Vuc2V0dGV4dHVyZTtcclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgRHJhdygpIHtcclxuICAgICAgICAgICAgc2t5UiA9IGNuc3RSICogKDAuNWYgKyBzblMgLyAyKTtcclxuICAgICAgICAgICAgc2t5RyA9IGNuc3RHICogKDAuNWYgKyBzblMgLyAyKTtcclxuICAgICAgICAgICAgc2t5QiA9IGNuc3RCICogKDAuNWYgKyBzblMgLyAyKTtcclxuICAgICAgICAgICAgc2t5UjIgPSBjbnN0UjIgKiAoMC42NmYgKyBzblMgLyAzKTtcclxuICAgICAgICAgICAgc2t5RzIgPSBjbnN0RzIgKiAoMC42NmYgKyBzblMgLyAzKTtcclxuICAgICAgICAgICAgc2t5QjIgPSBjbnN0QjIgKiAoMC42NmYgKyBzblMgLyAzKTtcclxuICAgICAgICAgICAgLy8gbGdiID0gTmV3IERyYXdpbmcyRC5MaW5lYXJHcmFkaWVudEJydXNoKHNreXJlY3QsIE5ldyBDb2xvcihza3lSLCBza3lHLCBza3lCKSwgTmV3IENvbG9yKHNreVIyLCBza3lHMiwgc2t5QjIpLCA5MClcclxuICAgICAgICAgICAgLy8gZy5GaWxsUmVjdGFuZ2xlKGxnYiwgc2t5cmVjdClcclxuXHJcbiAgICAgICAgICAgIFVwZGF0ZVNreVRleHR1cmUoc2t5dGV4dHVyZSwgc2t5cmVjdC5IZWlnaHQsIHNreVIsIHNreUcsIHNreUIsIDI1NSwgc2t5UjIsIHNreUcyLCBza3lCMiwgMjU1KTtcclxuICAgICAgICAgICAgRmlsbFJlY3RhbmdsZShzcHJpdGVCYXRjaCwgc2t5dGV4dHVyZSwgc2t5cmVjdCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoc25TID4gLTAuNSAmJiBzblMgPCAwLjUpIHtcclxuICAgICAgICAgICAgICAgIC8vIHN1bnNldGxnYiA9IE5ldyBEcmF3aW5nMkQuTGluZWFyR3JhZGllbnRCcnVzaChza3lyZWN0LCBDb2xvci5FbXB0eSwgQ29sb3IuRnJvbUFyZ2IoKDEgLSBNYXRoLkFicyhzblMpICogMikgKiAxMDAsIHN1bnNldGNsciksIDkwKVxyXG4gICAgICAgICAgICAgICAgVXBkYXRlU2t5VGV4dHVyZShzdW5zZXR0ZXh0dXJlLCBza3lyZWN0LkhlaWdodCwgMCwgMCwgMCwgMCwgc3Vuc2V0Y2xyLlIsIHN1bnNldGNsci5HLCBzdW5zZXRjbHIuQiwgKDEgLSBNYXRoLkFicyhzblMpICogMikgKiAxMDApO1xyXG4gICAgICAgICAgICAgICAgRmlsbFJlY3RhbmdsZShzcHJpdGVCYXRjaCwgc3Vuc2V0dGV4dHVyZSwgc2t5cmVjdCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gc3Vuc2V0bGdiID0gTmV3IERyYXdpbmcyRC5MaW5lYXJHcmFkaWVudEJydXNoKHNreXJlY3QsIENvbG9yLkVtcHR5LCBOZXcgQ29sb3IoKDEgLSBNYXRoLkFicyhzblMpICogMikgKiAxMDAsIHN1bnNldGNsciksIDkwKVxyXG4gICAgICAgICAgICAvLyBnLkZpbGxSZWN0YW5nbGUoc3Vuc2V0bGdiLCBza3lyZWN0KVxyXG5cclxuICAgICAgICAgICAgaWYgKHNuUyA8IDApIHtcclxuICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc3RhcnNDbnQ7IGkrKylcclxuICAgICAgICAgICAgICAgICAgICBGaWxsUmVjdGFuZ2xlKHNwcml0ZUJhdGNoLCBzdGFyVGV4LCAoaW50KXN0YXJzW2ldLlgsIChpbnQpc3RhcnNbaV0uWSwgMSwgMSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG5cclxuICAgICAgICAgICAgZm9yZWFjaCAoUGFydGljbGUgcCBpbiBiYWNrcGFycylcclxuICAgICAgICAgICAgICAgIHAuWE5BRHJhdyhzcHJpdGVCYXRjaCk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZ2FtZVdpZHRoOyBpICs9IDEwMClcclxuICAgICAgICAgICAgICAgIHNwcml0ZXNbbGFuZEJtcF0uRHJhdygwLCBpLCBob3IgLSAyMCwgc3ByaXRlQmF0Y2gpO1xyXG5cclxuICAgICAgICAgICAgZm9yZWFjaCAoUGFydGljbGUgcCBpbiBidXNocGFycylcclxuICAgICAgICAgICAgICAgIHAuWE5BRHJhdyhzcHJpdGVCYXRjaCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoc2VsVSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBzcHJpdGVzW1wiZWZmZWN0c1wiXS5EcmF3KDAsIHNlbFUueCArIGRlbHRheCAtIDE0LCBob3IgLSAyMiwgc3ByaXRlQmF0Y2gpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNlbFUuQXR0YWNrLlJhbmdlID4gMSkge1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmb3JlYWNoIChVbml0IHUgaW4gdW5pdHMpIHtcclxuICAgICAgICAgICAgICAgIGlmICh1Lm93bmVyID09IDAgfHwgIXUuQWJzQ29udGFpbnMoXCJJbnZpc2libGVcIikpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdSBJc05vdCBzZWxVIEFuZCB1LnggKyB1LnBhcmFtcy5yZWN0LlJpZ2h0ID4gbS5YIEFuZCBtLlggPiB1LnggKyB1LnBhcmFtcy5yZWN0LkxlZnQgQW5kIGhvciArIHUucGFyYW1zLnJlY3QuQm90dG9tID4gbS5ZIEFuZCBtLlkgPiBob3IgKyB1LnBhcmFtcy5yZWN0LlRvcCBUaGVuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gRHJhd1Nwcml0ZShzcHJpdGVCYXRjaCwgXCJlZmZlY3RzXCIsIDAsIHUueCArIGRlbHRheCAtIDE0LCBob3IgLSAyMilcclxuICAgICAgICAgICAgICAgICAgICAvLyBFbmQgSWZcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZGVsdGF5ID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBkZWx0YXggPSAwO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXUucGFyYW1ldGVycy5pc0J1aWxkaW5nICYmIHUuYXRrUmVjaGFyZ2UgPiB1LnBhcmFtZXRlcnMuQXR0YWNrLlNwZWVkIC0gMzAgJiYgdS5hdGtSZWNoYXJnZSA8IHUucGFyYW1ldGVycy5BdHRhY2suU3BlZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbHRheCA9IHUubW92ZXNpZGUgKiAodS5hdGtSZWNoYXJnZSAtIHUucGFyYW1ldGVycy5BdHRhY2suU3BlZWQgKyAzMCkgLyAxMDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF1LmlzSW5Db21iYXQgJiYgdS5wYXJhbWV0ZXJzLm1vdmVUeXBlID09IFVuaXRNb3ZlVHlwZS5GbHlpbmdNVCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodS5BYnNDb250YWlucyhcIkJvZHlsZXNzXCIpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsdGF5ID0gM2YgKiAoZmxvYXQpTWF0aC5TaW4odS53aW5nc1dhdmUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWx0YXkgPSAyZiAqIChmbG9hdClNYXRoLlNpbih1LndpbmdzV2F2ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHNwcml0ZXNbXCJlZmZlY3RzXCJdLkRyYXcoMSwgdS54ICsgZGVsdGF4IC0gMTUsIGhvciAtIDIyLCBzcHJpdGVCYXRjaCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1Lm1vdmVzaWRlID09IDEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHUuRHJhd0N1cnJlbnQoKGludCkodS54ICsgdS5wYXJhbWV0ZXJzLnJlY3QuTGVmdCArIGRlbHRheCArIHUucGFyYW1ldGVycy5pbWd4KSwgKGludCkoaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuVG9wICsgZGVsdGF5ICsgdS5wYXJhbWV0ZXJzLmltZ3kgKyAxKSwgc3ByaXRlQmF0Y2gpO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgdS5EcmF3Q3VycmVudCgoaW50KSh1LnggKyB1LnBhcmFtZXRlcnMucmVjdC5SaWdodCArIGRlbHRheCAtIE15R2FtZS5zcHJpdGVzW3UucGFyYW1ldGVycy5zcHJpdGVOYW1lXS5XIC0gdS5wYXJhbWV0ZXJzLmltZ3gpLCAoaW50KShob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Ub3AgKyBkZWx0YXkgKyB1LnBhcmFtZXRlcnMuaW1neSArIDEpLCBzcHJpdGVCYXRjaCwgU3ByaXRlRWZmZWN0cy5GbGlwSG9yaXpvbnRhbGx5KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHUuQWJzQ29udGFpbnMoXCJJbnZpc2libGVcIikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNwcml0ZXNbXCJlZmZlY3RzXCJdLkRyYXcoMiwgdS54IC0gMTYsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LlkgLSAzMiwgc3ByaXRlQmF0Y2gpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgZm9yZWFjaCAoQW1tbyBhIGluIGFtbW9zKSB7XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGEudHlwZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgQW1tby5BbW1vVHlwZS5BcnJvdzpcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIEFtbW8uQW1tb1R5cGUuRmFzdEFycm93OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbG9hdCBkeCwgZHk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbG9hdCBuID0gKGZsb2F0KU1hdGguU3FydChhLnZ4ICogYS52eCArIGEudnkgKiBhLnZ5KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR4ID0gYS52eCAvIG4gKiA2O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZHkgPSBhLnZ5IC8gbiAqIDY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlIEFtbW8uQW1tb1R5cGUuQmlnQXJyb3c6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZsb2F0IGR4LCBkeTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZsb2F0IG4gPSAoZmxvYXQpTWF0aC5TcXJ0KGEudnggKiBhLnZ4ICsgYS52eSAqIGEudnkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZHggPSBhLnZ4IC8gbiAqIDEyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZHkgPSBhLnZ5IC8gbiAqIDEyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEudnggPj0gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcHJpdGVzW1wiYW1tb3NcIl0uRHJhdyhhLmltZywgYS54IC0gNSwgYS55IC0gNSwgc3ByaXRlQmF0Y2gpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwcml0ZXNbXCJhbW1vc1wiXS5EcmF3KGEuaW1nLCBhLnggLSA1LCBhLnkgLSA1LCBzcHJpdGVCYXRjaCwgU3ByaXRlRWZmZWN0cy5GbGlwSG9yaXpvbnRhbGx5KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICBmb3JlYWNoIChQYXJ0aWNsZSBwIGluIHBhcnMpXHJcbiAgICAgICAgICAgICAgICBwLlhOQURyYXcoc3ByaXRlQmF0Y2gpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGdTdGF0ZSA9PSBHYW1lU3RhdGUuSW5HYW1lIHx8IGdTdGF0ZSA9PSBHYW1lU3RhdGUuV2luIHx8IGdTdGF0ZSA9PSBHYW1lU3RhdGUuTG9zZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHBscnNbMF0uaGVybyA9PSBcIkNhc3RsZVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNhc3RsZWJtcCA9IHBscnNbMF0uY2FzdGxlRmlsZU5hbWUgKyBcIjFcIjtcclxuICAgICAgICAgICAgICAgICAgICBzcHJpdGVzW2Nhc3RsZWJtcF0uRHJhdygwLCAwLCBob3IgLSAyICogdW5pdFNpemUgKyAxLCBzcHJpdGVCYXRjaCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAocGxyc1sxXS5oZXJvID09IFwiQ2FzdGxlXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY2FzdGxlYm1wID0gcGxyc1sxXS5jYXN0bGVGaWxlTmFtZSArIFwiMVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIHNwcml0ZXNbY2FzdGxlYm1wXS5EcmF3KDEsIGdhbWVXaWR0aCAtIHVuaXRTaXplICsgMSwgaG9yIC0gMiAqIHVuaXRTaXplICsgMiwgc3ByaXRlQmF0Y2gpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoc25TIDwgMC4yKSB7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChzblMgPiAwKVxyXG4gICAgICAgICAgICAgICAgc3ByaXRlc1tcIndvcmxkXCJdLkRyYXcoMCwgZ2FtZVdpZHRoIC8gMiAtIChnYW1lV2lkdGggLyAyICsgODApICogY3NTIC0gNjAsIGdhbWVIZWlnaHQgLSAoZ2FtZUhlaWdodCAtIDE0MCkgKiBzblMgLSA2MCwgc3ByaXRlQmF0Y2gpO1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICBzcHJpdGVzW1wid29ybGRcIl0uRHJhdygxLCBnYW1lV2lkdGggLyAyICsgKGdhbWVXaWR0aCAvIDIgKyA4MCkgKiBjc1MgLSA2MCwgZ2FtZUhlaWdodCArIChnYW1lSGVpZ2h0IC0gMTQwKSAqIHNuUyAtIDYwLCBzcHJpdGVCYXRjaCk7XHJcblxyXG5cclxuICAgICAgICAgICAgZm9yZWFjaCAoUGFydGljbGUgcCBpbiBjbG91ZHBhcnMpXHJcbiAgICAgICAgICAgICAgICBwLlhOQURyYXcoc3ByaXRlQmF0Y2gpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIGZvcmVhY2ggKFVuaXQgdSBpbiB1bml0cykge1xyXG4gICAgICAgICAgICAgICAgaWYgKCghdS5BYnNDb250YWlucyhcIkludmlzaWJsZVwiKSB8fCB1Lm93bmVyID09IDApICYmICh1LmhwIDwgdS5wYXJhbWV0ZXJzLm1heGhwIHx8IHUgPT0gc2VsVSB8fCB1LnNob3duQWJpbCAhPSBcIlwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghdS5wYXJhbWV0ZXJzLmhwQm90b20pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUuc2hvd25BYmlsID09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZpbGxSZWN0YW5nbGUoc3ByaXRlQmF0Y2gsIGhlYWx0aEJhckJhY2tUZXgsIDIgKyAoaW50KXUueCArIHUucGFyYW1ldGVycy5yZWN0LlgsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LlkgLSA2LCB1LnBhcmFtZXRlcnMucmVjdC5XaWR0aCAtIDQsIDQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUuQWJzQ29udGFpbnMoXCJQb2lzb25cIikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRmlsbFJlY3RhbmdsZShzcHJpdGVCYXRjaCwgaGVhbHRoQmFyUG9pc29uVGV4LCAzICsgKGludCl1LnggKyB1LnBhcmFtZXRlcnMucmVjdC5YLCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5ZIC0gNSwgKGludCkodS5ocCAqICh1LnBhcmFtZXRlcnMucmVjdC5XaWR0aCAtIDYpIC8gdS5wYXJhbWV0ZXJzLm1heGhwKSwgMik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRmlsbFJlY3RhbmdsZShzcHJpdGVCYXRjaCwgaGVhbHRoQmFyTGlmZVRleCwgMyArIChpbnQpdS54ICsgdS5wYXJhbWV0ZXJzLnJlY3QuWCwgaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuWSAtIDUsIChpbnQpKHUuaHAgKiAodS5wYXJhbWV0ZXJzLnJlY3QuV2lkdGggLSA2KSAvIChkb3VibGUpdS5wYXJhbWV0ZXJzLm1heGhwKSwgMik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodS5hYmlscy5Db250YWluc0tleSh1LnNob3duQWJpbCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZpbGxSZWN0YW5nbGUoc3ByaXRlQmF0Y2gsIGhlYWx0aEJhckJhY2tUZXgsIDIgKyAoaW50KXUueCArIHUucGFyYW1ldGVycy5yZWN0LlgsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LlkgLSA5LCB1LnBhcmFtZXRlcnMucmVjdC5XaWR0aCAtIDQsIDcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUuQWJzQ29udGFpbnMoXCJQb2lzb25cIikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRmlsbFJlY3RhbmdsZShzcHJpdGVCYXRjaCwgaGVhbHRoQmFyUG9pc29uVGV4LCAzICsgKGludCl1LnggKyB1LnBhcmFtZXRlcnMucmVjdC5YLCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5ZIC0gNSwgKGludCkodS5ocCAqICh1LnBhcmFtZXRlcnMucmVjdC5XaWR0aCAtIDYpIC8gdS5wYXJhbWV0ZXJzLm1heGhwKSwgMik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRmlsbFJlY3RhbmdsZShzcHJpdGVCYXRjaCwgaGVhbHRoQmFyTGlmZVRleCwgMyArIChpbnQpdS54ICsgdS5wYXJhbWV0ZXJzLnJlY3QuWCwgaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuWSAtIDUsIChpbnQpdS5ocCAqICh1LnBhcmFtZXRlcnMucmVjdC5XaWR0aCAtIDYpIC8gdS5wYXJhbWV0ZXJzLm1heGhwLCAyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZpbGxSZWN0YW5nbGUoc3ByaXRlQmF0Y2gsIGhlYWx0aEJhckFiaWxUZXgsIDMgKyAoaW50KXUueCArIHUucGFyYW1ldGVycy5yZWN0LlgsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LlkgLSA4LCB1LmFiaWxzW3Uuc2hvd25BYmlsXS52YWx1ZSAqICh1LnBhcmFtZXRlcnMucmVjdC5XaWR0aCAtIDYpIC8gdS5zaG93bkFiaWxNYXhWYWwsIDIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUuc2hvd25BYmlsID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBGaWxsUmVjdGFuZ2xlKHNwcml0ZUJhdGNoLCBoZWFsdGhCYXJCYWNrVGV4LCAyICsgKGludCl1LnggKyB1LnBhcmFtZXRlcnMucmVjdC5YLCBob3IgKyA2LCB1LnBhcmFtZXRlcnMucmVjdC5XaWR0aCAtIDQsIDUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBGaWxsUmVjdGFuZ2xlKHNwcml0ZUJhdGNoLCBoZWFsdGhCYXJMaWZlVGV4LCAzICsgKGludCl1LnggKyB1LnBhcmFtZXRlcnMucmVjdC5YLCBob3IgKyA3LCAoaW50KSh1LmhwICogKHUucGFyYW1ldGVycy5yZWN0LldpZHRoIC0gNikgLyAoZG91YmxlKXUucGFyYW1ldGVycy5tYXhocCksIDMpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICBmb3JlYWNoIChQYXJ0aWNsZSBwIGluIHVpcGFycylcclxuICAgICAgICAgICAgICAgIHAuWE5BRHJhdyhzcHJpdGVCYXRjaCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoZ2xvYmFsRXhwbG9kZSA+IDApXHJcbiAgICAgICAgICAgICAgICBnbG9iYWxFeHBsb2RlIC09IDI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBSZXNpemUoaW50IHd3LCBpbnQgaGgsIGJvb2wgZnVsbHNjcmVlbiwgZmxvYXQgdWlTY2FsZSA9IDEuMGYpIHtcclxuICAgICAgICAgICAgX3NjcmVlbldpZHRoID0gd3c7XHJcbiAgICAgICAgICAgIHNjYWxlWCA9IGdhbWVXaWR0aCAvIChkb3VibGUpX3NjcmVlbldpZHRoO1xyXG4gICAgICAgICAgICBfc2NyZWVuSGVpZ2h0ID0gaGg7XHJcbiAgICAgICAgICAgIHNjYWxlWSA9IGdhbWVIZWlnaHQgLyAoZG91YmxlKV9zY3JlZW5IZWlnaHQ7XHJcbiAgICAgICAgICAgIGlmICgoTWFpbkNvbnRhaW5lciAhPSBudWxsKSkge1xyXG4gICAgICAgICAgICAgICAgTWFpbkNvbnRhaW5lci5XID0gX3NjcmVlbldpZHRoO1xyXG4gICAgICAgICAgICAgICAgTWFpbkNvbnRhaW5lci5IID0gX3NjcmVlbkhlaWdodDtcclxuICAgICAgICAgICAgICAgIE1haW5Db250YWluZXIuQ2hpbGRyZW5TY2FsZVggPSB1aVNjYWxlO1xyXG4gICAgICAgICAgICAgICAgTWFpbkNvbnRhaW5lci5DaGlsZHJlblNjYWxlWSA9IHVpU2NhbGU7XHJcbiAgICAgICAgICAgICAgICBNYWluQ29udGFpbmVyLklzTmVlZFJlY2FsYyA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGdyYXBoaWNzLlByZWZlcnJlZEJhY2tCdWZmZXJXaWR0aCA9IF9zY3JlZW5XaWR0aDtcclxuICAgICAgICAgICAgZ3JhcGhpY3MuUHJlZmVycmVkQmFja0J1ZmZlckhlaWdodCA9IF9zY3JlZW5IZWlnaHQ7XHJcbiAgICAgICAgICAgIGdyYXBoaWNzLklzRnVsbFNjcmVlbiA9IGZ1bGxzY3JlZW47XHJcbiAgICAgICAgICAgIGdyYXBoaWNzLkFwcGx5Q2hhbmdlcygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGludCBfc2NyZWVuV2lkdGggPSA4MDA7XHJcbiAgICAgICAgcHVibGljIGludCBfc2NyZWVuSGVpZ2h0ID0gNDgwO1xyXG5cclxuICAgICAgICBwcml2YXRlIGRvdWJsZSBzY2FsZVggPSAxLjA7XHJcbiAgICAgICAgcHJpdmF0ZSBkb3VibGUgc2NhbGVZID0gMS4wO1xyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBTaG93SW5mb1BhcihzdHJpbmcgdHh0LCBDb2xvciBjbHIsIGZsb2F0IHgsIGZsb2F0IHksIGJvb2wgaGFybSwgYm9vbCBiaWcgPSBmYWxzZSkge1xyXG4gICAgICAgICAgICBpZiAoIWhhcm0pXHJcbiAgICAgICAgICAgICAgICBwYXJzLkFkZChuZXcgVGV4dFBhcnRpY2xlKGRlZmF1bHRUaGVtZS5HZXRGb250KDEyKSwgY2xyLCB4LCB5LCBybmQuTmV4dCgtMTAsIDExKSAvIDEwLCAtMiwgMC4xZiwgNTAsIHR4dCkpO1xyXG4gICAgICAgICAgICBlbHNlIGlmIChiaWcpXHJcbiAgICAgICAgICAgICAgICBwYXJzLkFkZChuZXcgVGV4dFBhcnRpY2xlKGRlZmF1bHRUaGVtZS5HZXRGb250KDEyKSwgY2xyLCB4LCB5LCAwLCAtMC4zNWYsIC0wLjA1ZiwgNzUsIHR4dCkpO1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICBwYXJzLkFkZChuZXcgVGV4dFBhcnRpY2xlKGRlZmF1bHRUaGVtZS5HZXRGb250KDEyKSwgY2xyLCB4LCB5LCAwLCAtMC4zNWYsIC0wLjA1ZiwgNzUsIHR4dCkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgT25TdWNjZXNzZnVsQXR0YWNrKGZsb2F0IGRtZywgVW5pdCB1LCBVbml0IHRyZywgYm9vbCBpZ25vcmVBcm1vcikge1xyXG4gICAgICAgICAgICBIYXJtKHRyZywgZG1nLCBpZ25vcmVBcm1vciwgRWZmZWN0VHlwZS5Ob3JtYWwpO1xyXG4gICAgICAgICAgICBpZiAoIWlnbm9yZUFybW9yKVxyXG4gICAgICAgICAgICAgICAgZG1nICo9IHRyZy5wYXJhbWV0ZXJzLl9hcm1vcjtcclxuICAgICAgICAgICAgZm9yZWFjaCAoQWJpbGl0eSBhIGluIHUuYWJpbHMuVmFsdWVzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYS5jb25kQ29tcGxldGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChhLm5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIlNlbGZkYW1hZ2VcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhhcm0odSwgZG1nLCB0cnVlLCBFZmZlY3RUeXBlLkJhZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiRGVueWluZ1wiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0cmcuQWJzQ29udGFpbnMoXCJCb2R5bGVzc1wiLCBcIk1hY2hpbmVyeVwiKSAmJiAhdHJnLnBhcmFtZXRlcnMuaXNCdWlsZGluZyAmJiB0cmcuaHAgPD0gYS52YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBLaWxsKHRyZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwi0JTQvtCx0LjQstCw0L3QuNC1XCIsIGdvb2RBYmlsQ2xyLCB1LngsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJWYW1waXJpc21cIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdHJnLkFic0NvbnRhaW5zKFwiQnVpbGRpbmdcIiwgXCJVbmRlYWRcIiwgXCJNYWNoaW5lcnlcIikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhlYWwodSwgZG1nIC8gMik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQ3Jhc2hlclwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0cmcucGFyYW1ldGVycy5pc0J1aWxkaW5nICYmIGRtZyA+PSBhLnZhbHVlICYmIHRyZy5wYXJhbWV0ZXJzLkFybW9yICE9IFwiTm9uZVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZy5wYXJhbWV0ZXJzLkFybW9yID0gXCJOb25lXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwi0JHRgNC+0L3RjyDRgNCw0LfRgNGD0YjQtdC90LBcIiwgYmFkQWJpbENsciwgdHJnLngsIGhvciArIHRyZy5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkVuam95IHBhaW5cIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdHJnLnBhcmFtZXRlcnMuaXNCdWlsZGluZyAmJiB0cmcuQWJzQ29udGFpbnMoXCJQb2lzb25cIikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhlYWwodSwgZG1nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJFdmlsX2V5ZVwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0cmcucGFyYW1ldGVycy5pc0J1aWxkaW5nICYmIHRyZy5wYXJhbWV0ZXJzLkFybW9yID09IFwiTm9uZVwiICYmICF0cmcuQWJzQ29udGFpbnMoXCJDbHVtc2luZXNzXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZy5BZGRBYmlsaXR5KFwiQ2x1bXNpbmVzc1wiLCBFZmZlY3RUeXBlLkJhZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwi0J7RgdC70LDQsdC70LXQvVwiLCBiYWRBYmlsQ2xyLCB0cmcueCwgaG9yICsgdHJnLnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQ3Vyc2VyXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRyZy5wYXJhbWV0ZXJzLmlzQnVpbGRpbmcgJiYgIXRyZy5BYnNDb250YWlucyhcIkNsdW1zaW5lc3NcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJnLkFkZEFiaWxpdHkoXCJDbHVtc2luZXNzXCIsIEVmZmVjdFR5cGUuQmFkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCLQntGB0LvQsNCx0LvQtdC9XCIsIGJhZEFiaWxDbHIsIHRyZy54LCBob3IgKyB0cmcucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJTcGlrZXNfYm9tYlwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRyZy5wYXJhbWV0ZXJzLkFybW9yID09IFwiTm9uZVwiICYmICF0cmcuQWJzQ29udGFpbnMoXCJCdWlsZGluZ1wiLCBcIlVuZGVhZFwiLCBcIkJvZHlsZXNzXCIsIFwiTWFjaGluZXJ5XCIpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmcucGFyYW1ldGVycy5tYXhocCAtPSAoaW50KWRtZztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJEZXN0cm95X2xpZ2h0X2FybW9yXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRyZy5wYXJhbWV0ZXJzLmlzQnVpbGRpbmcgJiYgdHJnLnBhcmFtZXRlcnMuQXJtb3IgPT0gXCJMaWdodFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZy5wYXJhbWV0ZXJzLkFybW9yID0gXCJOb25lXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwi0JHRgNC+0L3RjyDRgNCw0LfRgNGD0YjQtdC90LBcIiwgYmFkQWJpbENsciwgdHJnLngsIGhvciArIHRyZy5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkRlc3Ryb3lfaGVhdnlfYXJtb3JcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdHJnLnBhcmFtZXRlcnMuaXNCdWlsZGluZyAmJiB0cmcucGFyYW1ldGVycy5Bcm1vciA9PSBcIkhlYXZ5XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJnLnBhcmFtZXRlcnMuQXJtb3IgPSBcIk5vbmVcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCLQkdGA0L7QvdGPINGA0LDQt9GA0YPRiNC10L3QsFwiLCBiYWRBYmlsQ2xyLCB0cmcueCwgaG9yICsgdHJnLnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiRGVzdHJveV9ldGhlcmVhbF9hcm1vclwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0cmcucGFyYW1ldGVycy5pc0J1aWxkaW5nICYmIHRyZy5wYXJhbWV0ZXJzLkFybW9yID09IFwiRXRoZXJlYWxcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmcucGFyYW1ldGVycy5Bcm1vciA9IFwiTm9uZVwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCR0YDQvtC90Y8g0YDQsNC30YDRg9GI0LXQvdCwXCIsIGJhZEFiaWxDbHIsIHRyZy54LCBob3IgKyB0cmcucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJMZXZpdGF0aW9uXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHJnLnBhcmFtZXRlcnMubW92ZVR5cGUgPT0gVW5pdE1vdmVUeXBlLkdyb3VuZE1UICYmICF0cmcucGFyYW1ldGVycy5pc0J1aWxkaW5nICYmICF1LmlzSW5SYW5nZUNvbWJhdClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJnLnRha2VkT2ZmID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJQdXJpZmljYXRpb25cIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZy5wdXJpZmllZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiUHVyaWZpY2F0aW9uX29uX2ZpcnN0X2F0dGFja1wiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0cmcucGFyYW1ldGVycy5pc0J1aWxkaW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZy5wdXJpZmllZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUuYWJpbHNbXCJQdXJpZmljYXRpb25fb25fZmlyc3RfYXR0YWNrXCJdLnVzZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQ2F0Y2hBYmlsXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRyZy5wYXJhbWV0ZXJzLmlzQnVpbGRpbmcgJiYgIXUuaXNJblJhbmdlQ29tYmF0ICYmIHRyZy5wYXJhbWV0ZXJzLm1vdmVUeXBlID09IFVuaXRNb3ZlVHlwZS5GbHlpbmdNVCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1LmxhbmRpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmcubGFuZGluZyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEudXNlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJJbnN0YW50X2tpbGxcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdHJnLnBhcmFtZXRlcnMuaXNCdWlsZGluZyAmJiBybmQuTmV4dCgxMDApIDwgYS52YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBLaWxsKHRyZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUuaHAgLT0gdHJnLmhwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCj0LHQuNGCIVwiLCBnb29kQWJpbENsciwgdS54LCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQ3JpcHBsaW5nX2luanVyeVwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0cmcuQWJzQ29udGFpbnMoXCJCdWlsZGluZ1wiLCBcIlVuZGVhZFwiLCBcIkJvZHlsZXNzXCIsIFwiTWFjaGluZXJ5XCIpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmcucGFyYW1ldGVycy5tYXhocCAtPSAoaW50KWRtZztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJQbGFndWVyXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRyZy5wYXJhbWV0ZXJzLmlzQnVpbGRpbmcgJiYgIXRyZy5BYnNDb250YWlucyhcIlBsYWd1ZVwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmcuQWRkQWJpbGl0eShcIlBsYWd1ZVwiLCBFZmZlY3RUeXBlLkJhZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwi0JfQsNGH0YPQvNC70LXQvSFcIiwgYmFkQWJpbENsciwgdHJnLngsIGhvciArIHRyZy5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkFjdGl2YXRlIHBsYWd1ZVwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRyZy5BYnNDb250YWlucyhcIlBsYWd1ZVwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChVbml0IHV1IGluIHVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXV1LkFic0NvbnRhaW5zKFwiVW5kZWFkXCIsIFwiTWFjaGluZXJ5XCIpICYmICF1dS5wYXJhbWV0ZXJzLmlzQnVpbGRpbmcgJiYgTWF0aC5BYnModS54IC0gdXUueCkgPD0gMiAqIHVuaXRTaXplKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhhcm0odXUsIHJuZC5OZXh0KDEwLCAyMSksIHRydWUsIEVmZmVjdFR5cGUuQmFkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiSGVhdnlfYXJyb3dzXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRyZy5wYXJhbWV0ZXJzLmlzQnVpbGRpbmcgJiYgdHJnLnBhcmFtZXRlcnMubW92ZVR5cGUgPT0gVW5pdE1vdmVUeXBlLkZseWluZ01UICYmIHJuZC5OZXh0KDEwMCkgPCBhLnZhbHVlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmcubGFuZGluZyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiU2xvd2VyXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRyZy5wYXJhbWV0ZXJzLmlzQnVpbGRpbmcgJiYgdHJnLnBhcmFtZXRlcnMuU3BlZWQgIT0gXCJTbG93XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJnLnBhcmFtZXRlcnMuU3BlZWQgPSBcIlNsb3dcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCLQl9Cw0LzQtdC00LvQtdC9IVwiLCBiYWRBYmlsQ2xyLCB0cmcueCwgaG9yICsgdHJnLnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiUG9pc29uZXJcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChybmQuTmV4dCgxMDApIDwgYS52YWx1ZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9pc29uKHRyZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh1LmlzSW5SYW5nZUNvbWJhdCkge1xyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAoVW5pdCB1dSBpbiB1bml0cykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1dS5vd25lciA9PSB1Lm93bmVyICYmIHRyZy5OZWFyKHV1KSAmJiB1dS5BYnNDb250YWlucyhcIlN1cHBvcnRfYXJjaGVyc1wiKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgSGFybSh0cmcsIHJuZC5OZXh0KDEwLCAxNSksIHRydWUsIEVmZmVjdFR5cGUuQmFkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcblxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgUG9pc29uKFVuaXQgdHJnKSB7XHJcbiAgICAgICAgICAgIGlmICghdHJnLkFic0NvbnRhaW5zKFwiUG9pc29uXCIpICYmICF0cmcucGFyYW1ldGVycy5pc0J1aWxkaW5nKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXRyZy5BYnNDb250YWlucyhcIlBvaXNvbnByb29mXCIsIFwiQm9keWxlc3NcIiwgXCJNYWNoaW5lcnlcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICB0cmcuQWRkQWJpbGl0eShcIlBvaXNvblwiLCBFZmZlY3RUeXBlLlBvaXNvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCLQntGC0YDQsNCy0LvQtdC9IVwiLCBwb2lBYmlsQ2xyLCB0cmcueCwgaG9yICsgdHJnLnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBPblByZUF0dGFjayhVbml0IHUsIFVuaXQgdHJnLCByZWYgZmxvYXQgZG1nKSB7XHJcbiAgICAgICAgICAgIGJvb2wgYWdpbCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBmb3JlYWNoIChBYmlsaXR5IGEgaW4gdS5hYmlscy5WYWx1ZXMpIHtcclxuICAgICAgICAgICAgICAgIGlmIChhLmNvbmRDb21wbGV0ZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGEubmFtZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiV2UgYXJlIHBpcmF0ZXNcIjoge1xyXG5kb1xyXG57XHJcbiAgICBnbG9iYWw6OkJyaWRnZS5TY3JpcHQuVG9UZW1wKFwiY2FzZV9wYXR0ZXJuMFwiLCBybmQuTmV4dERvdWJsZSgpKTtcclxuICAgIGlmIChnbG9iYWw6OkJyaWRnZS5TY3JpcHQuRnJvbVRlbXA8ZG91YmxlPihcImNhc2VfcGF0dGVybjBcIikgaXMgb2JqZWN0KVxyXG4gICAge1xyXG4gICAgICAgIHZhciBfZGlzY2FyZDEgPSAob2JqZWN0KWdsb2JhbDo6QnJpZGdlLlNjcmlwdC5Gcm9tVGVtcDxkb3VibGU+KFwiY2FzZV9wYXR0ZXJuMFwiKTtcclxuICAgICAgICBpZiAocm5kLk5leHREb3VibGUoKSA8IDAuMzMpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCZ0LDRgNGA0YAhXCIsIGdvb2RBYmlsQ2xyLCB1LngsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpZiAoZ2xvYmFsOjpCcmlkZ2UuU2NyaXB0LkZyb21UZW1wPGRvdWJsZT4oXCJjYXNlX3BhdHRlcm4wXCIpIGlzIG9iamVjdClcclxuICAgIHtcclxuICAgICAgICB2YXIgX2Rpc2NhcmQyID0gKG9iamVjdClnbG9iYWw6OkJyaWRnZS5TY3JpcHQuRnJvbVRlbXA8ZG91YmxlPihcImNhc2VfcGF0dGVybjBcIik7XHJcbiAgICAgICAgaWYgKHJuZC5OZXh0RG91YmxlKCkgPCAwLjY2KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCLQodGD0YXQvtC/0YPRgtC90LDRjyDQutGA0YDRgNGL0YHQsCFcIiwgZ29vZEFiaWxDbHIsIHUueCwgaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFNob3dJbmZvUGFyKFwi0KLRi9GB0Y/Rh9CwINGH0LXRgNGC0LXQuSFcIiwgZ29vZEFiaWxDbHIsIHUueCwgaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbndoaWxlIChmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQXR0YWNrX2JvbnVzXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbWcgKz0gYS52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJTaHJhcG5lbFwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUuaXNJblJhbmdlQ29tYmF0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbWcgLT0gMjAgKiAoZmxvYXQpTWF0aC5BYnModS54IC0gdHJnLngpIC8gdW5pdFNpemU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiU25pcGVyaW5nXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodS5pc0luUmFuZ2VDb21iYXQgJiYgTWF0aC5BYnModS54IC0gdHJnLngpID49IHUuQXR0YWNrLlJhbmdlICogdW5pdFNpemUgLSB1czIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRtZyArPSBhLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkxhbmRzaG9vdGVyXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHJnLnBhcmFtZXRlcnMubW92ZVR5cGUgPT0gVW5pdE1vdmVUeXBlLkZseWluZ01UKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbWcgLz0gMjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJIYXRlX2ZseWVyc1wiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRyZy5wYXJhbWV0ZXJzLm1vdmVUeXBlID09IFVuaXRNb3ZlVHlwZS5GbHlpbmdNVClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG1nICo9IDI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiSGF0ZV9naWFudHNcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0cmcucGFyYW1ldGVycy5tb3ZlVHlwZSA9PSBVbml0TW92ZVR5cGUuSHVnZU1UKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbWcgKj0gMjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJIYXRlX3BvaXNvbmVkXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHJnLkFic0NvbnRhaW5zKFwiUG9pc29uXCIpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbWcgKj0gMjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJIYXRlIG1hZ2VzXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHJnLkFic0NvbnRhaW5zKFwiTWFnZVwiKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG1nICo9IDI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiU3Bpa2VzX2JvbWJcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0cmcucGFyYW1ldGVycy5Bcm1vciA9PSBcIk5vbmVcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG1nICo9IDI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQnJhdmVcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChybmQuTmV4dCgxMDApIDw9IGEudmFsdWUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbWcgPSAzICogZG1nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCa0YDQuNGCIVwiLCBnb29kQWJpbENsciwgdS54LCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJLYW1pa2F6ZVwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF1LkFic0NvbnRhaW5zKFwiRXhwbG9zaXZlXCIpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFeHBsb2RlKHUsIHUuQWJzQ29udGFpbnMoXCJNYWdlXCIpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBLaWxsKHUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkJ1cnN0XCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXUuaXNJblJhbmdlQ29tYmF0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUucGFyYW1ldGVycy5TcGVlZCA9IFwiTm9ybWFsXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUuYWJpbHNbXCJCdXJzdFwiXS51c2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCLQkdC40YLQstCwIVwiLCBiYWRBYmlsQ2xyLCB1LngsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJJbnN0YWJpbGl0eVwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRyZy5wYXJhbWV0ZXJzLm1vdmVUeXBlID09IFVuaXRNb3ZlVHlwZS5IdWdlTVQgfHwgdHJnLkFic0NvbnRhaW5zKFwiRHVyYWJpbGl0eVwiKSAmJiAhdS5pc0luUmFuZ2VDb21iYXQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXhwbG9kZSh1LCB1LkFic0NvbnRhaW5zKFwiTWFnZVwiKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEtpbGwodSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJTcGF3bl9kZW1vbnNcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1LmlzSW5SYW5nZUNvbWJhdCAmJiBwbHJzW3Uub3duZXJdLnByZFEuQ291bnQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1MiA9IG5ldyBVbml0KHRoaXMsIHRyZy54IC0gdXMyICogdS5tb3Zlc2lkZSwgdS5tb3Zlc2lkZSwgdS5vd25lciwgdW5pdFBybXNbcGxyc1t1Lm93bmVyXS5wcmRRWzBdXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvcm5MaXN0LkFkZCh1Mik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwi0J/RgNC40LfQstCw0L0hXCIsIGdvb2RBYmlsQ2xyLCB1Mi54LCBob3IgKyB1Mi5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFycy5BZGQobmV3IEltYWdlUGFydGljbGUobmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW1wiZXhwbG9kZVwiXSwgMiksIHUyLnggLSAyNSwgaG9yICsgdTIucGFyYW1ldGVycy5yZWN0LkJvdHRvbSAtIHVzMiAtIDI1LCAwLCAwLCAyMCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZW1vdmVGcm9tUXVldWUodS5vd25lciwgMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJNZWxlZV9wZW5hbHR5XCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXUuaXNJblJhbmdlQ29tYmF0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbWcgLz0gMjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJSYW5nZV9wZW5hbHR5XCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodS5pc0luUmFuZ2VDb21iYXQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRtZyAvPSAyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkZpcnN0X3Nob290XCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodS5pc0luUmFuZ2VDb21iYXQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG1nICs9IGEudmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUuYWJpbHNbXCJGaXJzdF9zaG9vdFwiXS51c2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCLQo9GB0LjQu9C10L3QvdGL0Lkg0LLRi9GB0YLRgNC10LshXCIsIGdvb2RBYmlsQ2xyLCB1LngsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJTb3VsbGlua1wiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG1nICs9IHJuZC5OZXh0KDEwLCAyMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSGFybSh1LCBybmQuTmV4dCg1LCAxMSksIHRydWUsIEVmZmVjdFR5cGUuQmFkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJJbnZpc2libGVcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlaW52aXNpYmxlKHUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkNsdW1zaW5lc3NcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChybmQuTmV4dCgxMDApIDwgMjApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFnaWwgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmb3JlYWNoIChBYmlsaXR5IHRhIGluIHRyZy5hYmlscy5WYWx1ZXMpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0YS5jb25kQ29tcGxldGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0YS5uYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJBZ2lsaXR5XCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocm5kLk5leHQoMTAwKSA8IHRhLnZhbHVlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZ2lsID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJFdmFzaW9uXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodS5pc0luUmFuZ2VDb21iYXQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFnaWwgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodS5BYnNDb250YWlucyhcIkFjY3VyYWN5XCIpKVxyXG4gICAgICAgICAgICAgICAgYWdpbCA9IGZhbHNlO1xyXG4gICAgICAgICAgICByZXR1cm4gYWdpbDtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBPbkFnaWwoVW5pdCB1LCBVbml0IHRyZykge1xyXG4gICAgICAgICAgICBmb3JlYWNoIChVbml0IHV1IGluIHVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoISh1dS5vd25lciA9PSB1Lm93bmVyKSAmJiB1dS5BYnNDb250YWlucyhcIlB1bmlzaG1lbnRfb25fbWlzc1wiKSlcclxuICAgICAgICAgICAgICAgICAgICBIYXJtKHUsIHJuZC5OZXh0KDIwLCA0MCksIHRydWUsIEVmZmVjdFR5cGUuQmFkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodHJnLkFic0NvbnRhaW5zKFwiQWdpbGl0eV9yb2xsYmFja1wiKSlcclxuICAgICAgICAgICAgICAgIHRyZy5BdHRhY2sgKz0gdHJnLmFiaWxzW1wiQWdpbGl0eV9yb2xsYmFja1wiXS52YWx1ZTtcclxuICAgICAgICAgICAgaWYgKHRyZy5BYnNDb250YWlucyhcIktpbGxfb25fYWdpbFwiKSkge1xyXG4gICAgICAgICAgICAgICAgS2lsbCh1KTtcclxuICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwi0JDQsNCw0LDQsNCwXCIsIGJhZEFiaWxDbHIsIHUueCwgaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuVG9wLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRyZy5BYnNDb250YWlucyhcIkhhcm1fb25fYWdpbFwiKSlcclxuICAgICAgICAgICAgICAgIEhhcm0odSwgcm5kLk5leHQoMjAsIDQxKSwgdHJ1ZSwgRWZmZWN0VHlwZS5CYWQpO1xyXG4gICAgICAgICAgICBpZiAodHJnLkFic0NvbnRhaW5zKFwiVHJpY2tcIikpXHJcbiAgICAgICAgICAgICAgICBIZWFsKHRyZywgdHJnLnBhcmFtZXRlcnMubWF4aHApO1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcIjBcIiwgZ29vZEFiaWxDbHIsIHRyZy54LCBob3IgKyB0cmcucGFyYW1ldGVycy5yZWN0LlRvcCwgZmFsc2UpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgQ2hlY2tCYXNpY0NvbmRpdGlvbnMoVW5pdCB1KSB7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKEFiaWxpdHkgYSBpbiB1LmFiaWxzLlZhbHVlcykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGEudXNlZClcclxuICAgICAgICAgICAgICAgICAgICBhLmNvbmRDb21wbGV0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGEuY29uZGl0aW9uICE9IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGEuY29uZGl0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJUaWVyXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGxyc1t1Lm93bmVyXS5yZXMuVGllciA+PSBhLmNvbmRudW0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuY29uZENvbXBsZXRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmNvbmRDb21wbGV0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJQb2lzb25lZFwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUuQWJzQ29udGFpbnMoXCJQb2lzb25cIikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuY29uZENvbXBsZXRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmNvbmRDb21wbGV0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJMb3dfaGVhbHRoXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodS5ocCA8PSAwLjUgKiB1LnBhcmFtZXRlcnMubWF4aHApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuY29uZENvbXBsZXRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmNvbmRDb21wbGV0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJPbl9lbmVteV9zaWRlXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKHUubW92ZXNpZGUgPT0gMSAmJiB1LnggPj0gZ2FtZVdpZHRoIC8gKGRvdWJsZSkyKSB8fCAodS5tb3Zlc2lkZSA9PSAtMSAmJiB1LnggPD0gZ2FtZVdpZHRoIC8gKGRvdWJsZSkyKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5jb25kQ29tcGxldGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuY29uZENvbXBsZXRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkF0X25pZ2h0XCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc25TIDwgMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5jb25kQ29tcGxldGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuY29uZENvbXBsZXRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkJ5X2RheVwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNuUyA+PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmNvbmRDb21wbGV0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5jb25kQ29tcGxldGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiTWFjaGluZV9hcm15XCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobWFjaGluZW51bSA+PSBhLmNvbmRudW0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuY29uZENvbXBsZXRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmNvbmRDb21wbGV0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJPbl9lbnRlclwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5jb25kQ29tcGxldGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgICAgICAgICBhLmNvbmRDb21wbGV0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgVW5pdCBGaW5kRmlyc3RVbmZseVVuaXQoaW50IHBscikge1xyXG4gICAgICAgICAgICBmbG9hdCB4cmVzID0gMDtcclxuICAgICAgICAgICAgVW5pdCB1cmVzID0gbnVsbDtcclxuICAgICAgICAgICAgZm9yZWFjaCAoVW5pdCB1IGluIHVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodS5vd25lciA9PSBwbHIgJiYgISh1LnBhcmFtZXRlcnMubW92ZVR5cGUgPT0gVW5pdE1vdmVUeXBlLkZseWluZ01UKSAmJiAhdS5wYXJhbWV0ZXJzLmlzQnVpbGRpbmcpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodXJlcyA9PSBudWxsIHx8ICh1LnggLSB4cmVzKSAqIHUubW92ZXNpZGUgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHhyZXMgPSB1Lng7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVyZXMgPSB1O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdXJlcztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBVbml0IEZpbmRSYW5kb21VbmZseVVuaXQoaW50IHBscikge1xyXG4gICAgICAgICAgICBMaXN0PFVuaXQ+IGF2dW5pdHMgPSBuZXcgTGlzdDxVbml0PigpO1xyXG4gICAgICAgICAgICBmb3JlYWNoIChVbml0IHUgaW4gdW5pdHMpIHtcclxuICAgICAgICAgICAgICAgIGlmICh1Lm93bmVyID09IHBsciAmJiAhKHUucGFyYW1ldGVycy5tb3ZlVHlwZSA9PSBVbml0TW92ZVR5cGUuRmx5aW5nTVQpICYmICF1LnBhcmFtZXRlcnMuaXNCdWlsZGluZylcclxuICAgICAgICAgICAgICAgICAgICBhdnVuaXRzLkFkZCh1KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoYXZ1bml0cy5Db3VudCA+IDApXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYXZ1bml0c1tybmQuTmV4dChhdnVuaXRzLkNvdW50KV07XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIFVuaXQgRmluZFJhbmRvbUZseVVuaXQoaW50IHBsciwgaW50IGhwTGltKSB7XHJcbiAgICAgICAgICAgIExpc3Q8VW5pdD4gYXZ1bml0cyA9IG5ldyBMaXN0PFVuaXQ+KCk7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKFVuaXQgdSBpbiB1bml0cykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHUub3duZXIgPT0gcGxyICYmIHUucGFyYW1ldGVycy5tb3ZlVHlwZSA9PSBVbml0TW92ZVR5cGUuRmx5aW5nTVQgJiYgdS5ocCA8PSBocExpbSAmJiAhdS5wYXJhbWV0ZXJzLmlzQnVpbGRpbmcpXHJcbiAgICAgICAgICAgICAgICAgICAgYXZ1bml0cy5BZGQodSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGF2dW5pdHMuQ291bnQgPiAwKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGF2dW5pdHNbcm5kLk5leHQoYXZ1bml0cy5Db3VudCldO1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIERvVW5pdHMoKSB7XHJcbiAgICAgICAgICAgIExpc3Q8VW5pdD4gdGFyZ2V0cyA9IG5ldyBMaXN0PFVuaXQ+KCk7XHJcbiAgICAgICAgICAgIExpc3Q8VW5pdD4gbmV3dGFyZ2V0cyA9IG5ldyBMaXN0PFVuaXQ+KCk7XHJcbiAgICAgICAgICAgIGZsb2F0IGRtZztcclxuICAgICAgICAgICAgYm9vbCBzdHA7XHJcbiAgICAgICAgICAgIGludCBuZWFyZXN0T25lO1xyXG4gICAgICAgICAgICBmb3JlYWNoIChVbml0IHUgaW4gdW5pdHMpIHtcclxuICAgICAgICAgICAgICAgIGlmICh1LkFic0NvbnRhaW5zKFwiUG93ZXJfb2ZfdW5pdHlcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICB1LnBhcmFtZXRlcnMuQXR0YWNrLk1pbkRhbWFnZSA9IDEwICogcGxyc1t1Lm93bmVyXS51bml0Q291bnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdS5wYXJhbWV0ZXJzLkF0dGFjay5NYXhEYW1hZ2UgPSAyMCAqIHBscnNbdS5vd25lcl0udW5pdENvdW50O1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHN0cCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdGFyZ2V0cy5DbGVhcigpO1xyXG4gICAgICAgICAgICAgICAgbmVhcmVzdE9uZSA9IC0xO1xyXG4gICAgICAgICAgICAgICAgdS5hdGtNb2QuUmFuZ2UgPSAwO1xyXG4gICAgICAgICAgICAgICAgdS5wYXJhbWV0ZXJzLmlzSWdub3JlVW5pdHMgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIENoZWNrQmFzaWNDb25kaXRpb25zKHUpO1xyXG4gICAgICAgICAgICAgICAgT25Vbml0c0FiaWxzKHUpO1xyXG4gICAgICAgICAgICAgICAgdS5pc0luQ29tYmF0ID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAoVW5pdCB1MiBpbiB1bml0cykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1ICE9IHUyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1LnBhcmFtZXRlcnMuX3NwZWVkID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF1LnBhcmFtZXRlcnMuaXNJZ25vcmVVbml0cykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1LnBhcmFtZXRlcnMuTmVhcih1Mi5wYXJhbWV0ZXJzKSAmJiB1Lm1vdmVzaWRlICogKHUyLnggLSB1LngpID4gMCAmJiAodS5tb3Zlc2lkZSAqICh1Mi54IC0gdS54KSA8IHVuaXRTaXplKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXUyLnBhcmFtZXRlcnMuaXNJZ25vcmVVbml0cyAmJiAodS5vd25lciAhPSB1Mi5vd25lciB8fCAodS5BYnNDb250YWlucyhcIkJvZHlsZXNzXCIpID09IHUyLkFic0NvbnRhaW5zKFwiQm9keWxlc3NcIikgJiYgIXUuQWJzQ29udGFpbnMoXCJJZ25vcmVfZnJpZW5kc1wiKSAmJiAhdS5BYnNDb250YWlucyhcIkJ1cnN0XCIpICYmICF1Mi5BYnNDb250YWlucyhcIldlYXBvbnJ5XCIpICYmICF1Mi5wYXJhbWV0ZXJzLmlzQnVpbGRpbmcpKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1Lm93bmVyID09IHUyLm93bmVyICYmICF1LkFic0NvbnRhaW5zKFwiTWFnZVwiKSAmJiB1Mi5BYnNDb250YWlucyhcIldlYXBvbnJ5XCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBLaWxsKHUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdTIuaHAgKz0gdS5ocDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUyLnBhcmFtZXRlcnMubWF4aHAgKz0gKGludCl1LmhwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdTIucGFyYW1ldGVycy5BdHRhY2suTWluRGFtYWdlICs9IHUucGFyYW1ldGVycy5BdHRhY2suTWluRGFtYWdlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdTIucGFyYW1ldGVycy5BdHRhY2suTWF4RGFtYWdlICs9IHUucGFyYW1ldGVycy5BdHRhY2suTWF4RGFtYWdlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxyc1t1Lm93bmVyXS51bml0Q291bnQgLT0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1Lm1vdmVzaWRlICogKHUyLnggLSB1LngpID49IDAgJiYgdS5tb3Zlc2lkZSAqICh1Mi54IC0gdS54KSA8IHUucGFyYW1ldGVycy5fc3BlZWQgKyB1Mi5wYXJhbWV0ZXJzLl9zcGVlZCAmJiB1LnBhcmFtZXRlcnMuTmVhcih1Mi5wYXJhbWV0ZXJzKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1Lm93bmVyICE9IHUyLm93bmVyICYmIHUuQWJzQ29udGFpbnMoXCJEYW1hZ2Vfb25fbW92ZVwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodS5BYnNDb250YWlucyhcIk1hZ2VcIikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIYXJtKHUyLCBybmQuTmV4dCg1MCwgNzEpLCB0cnVlLCBFZmZlY3RUeXBlLkJhZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhhcm0odTIsIHJuZC5OZXh0KDUwLCA3MSksIGZhbHNlLCBFZmZlY3RUeXBlLk5vcm1hbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1Lm93bmVyID09IHUyLm93bmVyICYmIHUyLkFic0NvbnRhaW5zKFwiTW9uZXlfdHJlYXN1cmVcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdTIuYWJpbHNbXCJNb25leV90cmVhc3VyZVwiXS51c2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVhdGhsaXN0LkFkZCh1Mik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBscnNbdS5vd25lcl0ucmVzLk1vbmV5ICs9IHUyLmFiaWxzW1wiTW9uZXlfdHJlYXN1cmVcIl0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKHN0cmluZy5Gb3JtYXQoXCIrezB9XCIsdTIuYWJpbHNbXCJNb25leV90cmVhc3VyZVwiXS52YWx1ZSksIG1vbmV5Q2xyLCB1Mi54LCBob3IgKyB1Mi5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RwID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1LnBhcmFtZXRlcnMuQXR0YWNrLk1heERhbWFnZSA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1Lm93bmVyICE9IHUyLm93bmVyICYmICh1LnBhcmFtZXRlcnMuTmVhcih1Mi5wYXJhbWV0ZXJzKSB8fCB1LkF0dGFjay5SYW5nZSA+IDEpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh1Lm1vdmVzaWRlICogKHUyLnggLSB1LngpID4gMCAmJiB1Lm1vdmVzaWRlICogKHUyLnggLSB1LngpIDwgdS5BdHRhY2suUmFuZ2UgKiB1bml0U2l6ZSkgJiYgIXUyLkFic0NvbnRhaW5zKFwiSW52aXNpYmxlXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZWFyZXN0T25lID09IC0xKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmVhcmVzdE9uZSA9IHRhcmdldHMuQ291bnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHUubW92ZXNpZGUgKiAodGFyZ2V0c1tuZWFyZXN0T25lXS54IC0gdTIueCkgPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmVhcmVzdE9uZSA9IHRhcmdldHMuQ291bnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldHMuQWRkKHUyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdS5pc0luQ29tYmF0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB1LmlzSW5SYW5nZUNvbWJhdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgbmV3dGFyZ2V0cy5DbGVhcigpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRhcmdldHMuQ291bnQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF1LkFic0NvbnRhaW5zKFwiRHJhZ29uX2JyZWF0aFwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChVbml0IHRyZyBpbiB0YXJnZXRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodS5OZWFyKHRyZykpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3dGFyZ2V0cy5BZGQodHJnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV3dGFyZ2V0cy5Db3VudCA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodS5BYnNDb250YWlucyhcIkF0dGFjayBzZWxlY3RlZFwiKSAmJiAhcGxyc1t1Lm93bmVyXS5BSSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXRzLkNvbnRhaW5zKHNlbFUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld3RhcmdldHMuQWRkKHNlbFUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1LmlzSW5SYW5nZUNvbWJhdCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXd0YXJnZXRzLkFkZCh0YXJnZXRzW25lYXJlc3RPbmVdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1LmlzSW5SYW5nZUNvbWJhdCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChVbml0IHRyZyBpbiB0YXJnZXRzKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3dGFyZ2V0cy5BZGQodHJnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdS5pc0luUmFuZ2VDb21iYXQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChuZXd0YXJnZXRzLkNvdW50ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1LkFic0NvbnRhaW5zKFwiSG92ZXJcIikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0cCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHUuYXRrUmVjaGFyZ2UgPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodS5wYXJhbWV0ZXJzLmFuaW1hdGVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdS5TdGFydEFuaW1hdGlvbihcIkF0dGFja1wiLCBtYWluQW5pbWF0b3IpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChVbml0IHRyZyBpbiBuZXd0YXJnZXRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChBYmlsaXR5IGFhIGluIHUuYWJpbHMuVmFsdWVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFhLmNvbmRpdGlvbiA9PSBcIk9uX2F0dGFja1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYS5jb25kQ29tcGxldGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRtZyA9IHJuZC5OZXh0KChpbnQpdS5BdHRhY2suTWluRGFtYWdlLCAoaW50KXUuQXR0YWNrLk1heERhbWFnZSArIDEpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPblByZUF0dGFjayh1LCB0cmcsIHJlZiBkbWcpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUuaXNJblJhbmdlQ29tYmF0ICYmICEodS5wYXJhbWV0ZXJzLmFtbW9UeXBlID09IEFtbW8uQW1tb1R5cGUuTm9uZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUuQWJzQ29udGFpbnMoXCJSb2NrZXRfc2hvb3RcIikgJiYgcm5kLk5leHQoMTAwKSA8IHUuYWJpbHNbXCJSb2NrZXRfc2hvb3RcIl0udmFsdWUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW1vcy5BZGQobmV3IEFtbW8odS5vd25lciwgQW1tby5BbW1vVHlwZS5SZWRCYWxsLCB1LngsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LlRvcCArIHVzMiwgdSwgdHJnLCAwLCBmYWxzZSwgdHJ1ZSwgNzIwMCwgdHJ1ZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW1vcy5BZGQobmV3IEFtbW8odS5vd25lciwgdS5wYXJhbWV0ZXJzLmFtbW9UeXBlLCB1LngsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LlRvcCArIHVzMiwgdSwgdHJnLCAwLCBmYWxzZSwgdHJ1ZSwgNzIwMCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPbkFnaWwodSwgdHJnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoVW5pdCB1dSBpbiB1bml0cykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXUub3duZXIgPT0gdS5vd25lciAmJiB1dS5BYnNDb250YWlucyhcIlJhZ2VxdWl0XCIpICYmIHJuZC5OZXh0KDUpID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhhcm0odXUsIGRtZywgdHJ1ZSwgRWZmZWN0VHlwZS5CYWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG1nID0gMyAqIGRtZztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwi0JrRgNC40YIhXCIsIGdvb2RBYmlsQ2xyLCB1LngsIGhvciArIHUucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvb2wgaWEgPSAodS5BYnNDb250YWlucyhcIkFyYmFsZXN0ZXJcIikgJiYgdHJnLnBhcmFtZXRlcnMuQXJtb3IgPT0gXCJMaWdodFwiKSB8fCAodS5BYnNDb250YWlucyhcIlNob290ZXJcIikgJiYgKHRyZy5wYXJhbWV0ZXJzLkFybW9yID09IFwiTGlnaHRcIiB8fCB0cmcucGFyYW1ldGVycy5Bcm1vciA9PSBcIkhlYXZ5XCIpKSB8fCB1LkFic0NvbnRhaW5zKFwiTWFnZVwiKTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1LmlzSW5SYW5nZUNvbWJhdCAmJiAhKHUucGFyYW1ldGVycy5hbW1vVHlwZSA9PSBBbW1vLkFtbW9UeXBlLk5vbmUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1LkFic0NvbnRhaW5zKFwiUm9ja2V0X3Nob290XCIpICYmIHJuZC5OZXh0KDEwMCkgPCB1LmFiaWxzW1wiUm9ja2V0X3Nob290XCJdLnZhbHVlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1tb3MuQWRkKG5ldyBBbW1vKHUub3duZXIsIEFtbW8uQW1tb1R5cGUuUmVkQmFsbCwgdS54LCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Ub3AgKyB1czIsIHUsIHRyZywgZG1nLCBpYSwgZmFsc2UsIDcyMDAsIHRydWUpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1tb3MuQWRkKG5ldyBBbW1vKHUub3duZXIsIHUucGFyYW1ldGVycy5hbW1vVHlwZSwgdS54LCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Ub3AgKyB1czIsIHUsIHRyZywgZG1nLCBpYSwgZmFsc2UsIDcyMDApKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT25TdWNjZXNzZnVsQXR0YWNrKGRtZywgdSwgdHJnLCBpYSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgdS5hdGtSZWNoYXJnZSA9IHUucGFyYW1ldGVycy5BdHRhY2suU3BlZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHUucG9pUmVjaGFyZ2UgPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgIHUucG9pUmVjaGFyZ2UgLT0gMTtcclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1LkFic0NvbnRhaW5zKFwiUmVnZW5lcmF0aW9uXCIpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBIZWFsKHUsIHJuZC5OZXh0KDIwLCA0MSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1LkFic0NvbnRhaW5zKFwiSGVhbGluZ19hdXJhXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKFVuaXQgdXUgaW4gdW5pdHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1ICE9IHV1ICYmIHV1Lm93bmVyID09IHUub3duZXIgJiYgTWF0aC5BYnModS54IC0gdXUueCkgPD0gMiAqIHVuaXRTaXplICYmICF1dS5BYnNDb250YWlucyhcIlVuZGVhZFwiKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIZWFsKHV1LCBybmQuTmV4dCgxMCwgMjEpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodS5BYnNDb250YWlucyhcIkhlYWxfZmlyc3RcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRtcHUgPSBGaW5kRmlyc3RVbmZseVVuaXQodS5vd25lcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0bXB1ICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIZWFsKHRtcHUsIHJuZC5OZXh0KDUsIDExKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1LkFic0NvbnRhaW5zKFwiTWFzc19oZWFsaW5nXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKFVuaXQgdXUgaW4gdW5pdHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1ICE9IHV1ICYmIHV1Lm93bmVyID09IHUub3duZXIgJiYgIXV1LkFic0NvbnRhaW5zKFwiVW5kZWFkXCIpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhlYWwodXUsIHJuZC5OZXh0KDEwLCAyMSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1LkFic0NvbnRhaW5zKFwiTWFzc19yZXBhaXJcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoVW5pdCB1dSBpbiB1bml0cykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUgIT0gdXUgJiYgdXUub3duZXIgPT0gdS5vd25lciAmJiB1dS5BYnNDb250YWlucyhcIk1hY2hpbmVyeVwiKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIZWFsKHV1LCBybmQuTmV4dCgyMCwgNDEpLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodS5BYnNDb250YWlucyhcIlBsYWd1ZVwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChVbml0IHV1IGluIHVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXV1LnBhcmFtZXRlcnMuaXNCdWlsZGluZyAmJiBNYXRoLkFicyh1LnggLSB1dS54KSA8PSAyICogdW5pdFNpemUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXUuQWJzQ29udGFpbnMoXCJVbmRlYWRcIikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhlYWwodXUsIHJuZC5OZXh0KDEwLCAyMSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKCF1dS5BYnNDb250YWlucyhcIk1hY2hpbmVyeVwiKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSGFybSh1dSwgcm5kLk5leHQoMTAsIDIxKSwgdHJ1ZSwgRWZmZWN0VHlwZS5CYWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1LkFic0NvbnRhaW5zKFwiRXh0aW5jdGlvblwiKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgSGFybSh1LCBybmQuTmV4dCgyMCwgNDEpLCB0cnVlLCBFZmZlY3RUeXBlLk5vcm1hbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHUuQWJzQ29udGFpbnMoXCJQb2lzb25cIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUuQWJzQ29udGFpbnMoXCJQb2lzb24gcmVzaXN0YW5jZVwiKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhhcm0odSwgcm5kLk5leHQoMjAsIDQxKSArIHBscnNbMSAtIHUub3duZXJdLnBvaXNvbkJvbnVzLCB0cnVlLCBFZmZlY3RUeXBlLlBvaXNvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhhcm0odSwgcm5kLk5leHQoNDAsIDgxKSArIHBscnNbMSAtIHUub3duZXJdLnBvaXNvbkJvbnVzLCB0cnVlLCBFZmZlY3RUeXBlLlBvaXNvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1LmhwIDw9IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1LmRlYXRoRnJvbVBvaXNvbiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKFVuaXQgdTIgaW4gdW5pdHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1MiAhPSB1ICYmIE1hdGguQWJzKHUyLnggLSB1LngpIDw9IDIgKiB1bml0U2l6ZSAmJiB1Mi5BYnNDb250YWlucyhcIlBhaW5fYWJzb3JiZXJcIikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSGVhbCh1Miwgcm5kLk5leHQoMjAsIDQxKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodTIuQWJzQ29udGFpbnMoXCJFcGlkZW15XCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJuZC5OZXh0KDEwMCkgPCB1Mi5hYmlsc1tcIkVwaWRlbXlcIl0udmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoVW5pdCB1MyBpbiB1bml0cykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE1hdGguQWJzKHUueCAtIHUzLngpIDw9IDIgKiB1bml0U2l6ZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb2lzb24odTMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHUucG9pUmVjaGFyZ2UgPSAxMjA7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHUuaHAgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHUucHVyaWZpZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF1LkFic0NvbnRhaW5zKFwiQnVpbGRpbmdcIiwgXCJCb2R5bGVzc1wiLCBcIkV0ZXJuYWxcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvb2wgc2hvd2luZm8gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKEFiaWxpdHkgYWEgaW4gdS5hYmlscy5WYWx1ZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWFhLnVzZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWEudXNlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dpbmZvID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2hvd2luZm8pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCLQl9Cw0LHQstC10L3QuNC1XCIsIGJhZEFiaWxDbHIsIHUueCwgaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB1LnB1cmlmaWVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1LmxhbmRpbmcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF1LkFic0NvbnRhaW5zKFwiRHVyYWJpbGl0eVwiKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUucGFyYW1ldGVycy5tb3ZlVHlwZSA9IFVuaXRNb3ZlVHlwZS5Hcm91bmRNVDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdS5sYW5kaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1LnRha2VkT2ZmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdS5BYnNDb250YWlucyhcIkR1cmFiaWxpdHlcIikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1LnBhcmFtZXRlcnMubW92ZVR5cGUgPSBVbml0TW92ZVR5cGUuRmx5aW5nTVQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHUudGFrZWRPZmYgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgICAgICAgICBLaWxsKHUpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh1Lm93bmVyID09IDAgJiYgdS54ID4gZ2FtZVdpZHRoICsgdXMyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgS2lsbCh1KTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZ1R5cGUgPT0gR2FtZVR5cGUuRmlyc3RIZXJvR1QpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdTdGF0ZSA9IEdhbWVTdGF0ZS5XaW47XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHUub3duZXIgPT0gMSAmJiB1LnggPCAtdXMyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgS2lsbCh1KTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZ1R5cGUgPT0gR2FtZVR5cGUuRmlyc3RIZXJvR1QpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdTdGF0ZSA9IEdhbWVTdGF0ZS5Mb3NlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICghc3RwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHUuQWJzQ29udGFpbnMoXCJTcGVlZF9ib251c1wiKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgdS54ICs9IHUucGFyYW1ldGVycy5fc3BlZWQgKiB1Lm1vdmVzaWRlICogMjtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHUueCArPSB1LnBhcmFtZXRlcnMuX3NwZWVkICogdS5tb3Zlc2lkZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoKC11LnBhcmFtZXRlcnMucmVjdC5Ub3AgPiB1LnBhcmFtZXRlcnMucmVjdC5IZWlnaHQgJiYgISh1LnBhcmFtZXRlcnMubW92ZVR5cGUgPT0gVW5pdE1vdmVUeXBlLkZseWluZ01UKSkgfHwgKC11LnBhcmFtZXRlcnMucmVjdC5Ub3AgPiBmbHlIZWlnaHQgKyB1LnBhcmFtZXRlcnMucmVjdC5IZWlnaHQgJiYgdS5wYXJhbWV0ZXJzLm1vdmVUeXBlID09IFVuaXRNb3ZlVHlwZS5GbHlpbmdNVCkpXHJcbiAgICAgICAgICAgICAgICAgICAgdS5wYXJhbWV0ZXJzLnJlY3QuWSArPSAzO1xyXG4gICAgICAgICAgICAgICAgaWYgKC11LnBhcmFtZXRlcnMucmVjdC5Ub3AgPCBmbHlIZWlnaHQgKyB1LnBhcmFtZXRlcnMucmVjdC5IZWlnaHQgJiYgdS5wYXJhbWV0ZXJzLm1vdmVUeXBlID09IFVuaXRNb3ZlVHlwZS5GbHlpbmdNVClcclxuICAgICAgICAgICAgICAgICAgICB1LnBhcmFtZXRlcnMucmVjdC5ZIC09IDM7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHUud2luZ3NXYXZlIDwgMiAqIE1hdGguUEkpXHJcbiAgICAgICAgICAgICAgICAgICAgdS53aW5nc1dhdmUgKz0gcGllY2U7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgdS53aW5nc1dhdmUgPSAwO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh1LmF0a1JlY2hhcmdlID4gMClcclxuICAgICAgICAgICAgICAgICAgICB1LmF0a1JlY2hhcmdlIC09IDE7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCEoZ1N0YXRlID09IEdhbWVTdGF0ZS5JbkdhbWUpKVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChnU3RhdGUgPT0gR2FtZVN0YXRlLkluR2FtZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGJvcm5MaXN0LkNvdW50ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKFVuaXQgdSBpbiBib3JuTGlzdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwbHJzW3Uub3duZXJdLnVDb3VudCArPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1bml0cy5BZGQodSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJvcm5MaXN0LkNsZWFyKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoZGVhdGhsaXN0LkNvdW50ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGludCB1X2ludCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHVfaW50IDwgZGVhdGhsaXN0LkNvdW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhYmlsID0gZGVhdGhsaXN0W3VfaW50XTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsLnBhcmFtZXRlcnMuTmFtZSA9PSBwbHJzWzBdLmhlcm8gfHwgYWJpbC5wYXJhbWV0ZXJzLk5hbWUgPT0gcGxyc1sxXS5oZXJvKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJpbC5ocCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRlYXRobGlzdFt1X2ludF0gPT0gc2VsVSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsVSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWwub3duZXIgPT0gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ1N0YXRlID0gR2FtZVN0YXRlLkxvc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWwub3duZXIgPT0gMSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ1N0YXRlID0gR2FtZVN0YXRlLldpbjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoT25EZWFkKGRlYXRobGlzdFt1X2ludF0pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxyc1thYmlsLm93bmVyXS51Q291bnQgLT0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbHJzW2FiaWwub3duZXJdLnN0YXREZWF0aHMgKz0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bml0cy5SZW1vdmUoZGVhdGhsaXN0W3VfaW50XSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoQW1tbyBhIGluIGFtbW9zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhLnRhcmdldCA9PSBkZWF0aGxpc3RbdV9pbnRdKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS50YXJnZXQgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB1X2ludCArPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBkZWF0aGxpc3QuQ2xlYXIoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgVHJ5QWRkVG9RdWV1ZVVuaXQoUGxheWVyIHBsciwgc3RyaW5nIG5hbWUpIHtcclxuICAgICAgICAgICAgaWYgKHBsci5DaGVja0ZvclByb2R1Y2UobmFtZSkpIHtcclxuICAgICAgICAgICAgICAgIHBsci5yZXMgLT0gdW5pdFBybXNbbmFtZV0uQ29zdDtcclxuICAgICAgICAgICAgICAgIHBsci5wcmRRLkFkZChuYW1lKTtcclxuICAgICAgICAgICAgICAgIGlmICh1bml0UHJtc1tuYW1lXS5zdXBwb3J0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGxyLmFpc3VwcG9ydHN0cmVhayArPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIHBsci5haWRlZmVuY2VzdHJlYWsgPSAwO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBwbHIuYWlkZWZlbmNlc3RyZWFrICs9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgcGxyLmFpc3VwcG9ydHN0cmVhayA9IDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAocGxyLmlkID09IDApXHJcbiAgICAgICAgICAgICAgICAgICAgVXBkYXRlUXVldWUoKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFJlbW92ZUZyb21RdWV1ZShpbnQgcGxyLCBpbnQgcG9zKSB7XHJcbiAgICAgICAgICAgIHBscnNbcGxyXS5wcmRRLlJlbW92ZUF0KHBvcyk7XHJcbiAgICAgICAgICAgIGlmIChwb3MgPT0gMClcclxuICAgICAgICAgICAgICAgIHBscnNbcGxyXS5wcmRQcmcgPSAwO1xyXG4gICAgICAgICAgICBpZiAocGxyID09IDApXHJcbiAgICAgICAgICAgICAgICBVcGRhdGVRdWV1ZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgQ2hlY2tTdGFjayhzdHJpbmcgdW5hbWUsIGludCBwbHIpIHtcclxuICAgICAgICAgICAgYm9vbCBhZGRpdGlvbiA9IGZhbHNlO1xyXG4gICAgICAgICAgICBpZiAodW5pdFBybXNbdW5hbWVdLm1vdmVUeXBlID09IFVuaXRNb3ZlVHlwZS5GbHlpbmdNVCkge1xyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAoVW5pdCB1IGluIHVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHUub3duZXIgPT0gcGxyICYmIHUuQWJzQ29udGFpbnMoXCJEcmFnb25fYm9zc1wiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhZGRpdGlvbiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdW5pdFBybXNbdW5hbWVdLkFic0NvbnRhaW5zKFwiU3RhY2tcIikgfHwgYWRkaXRpb247XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIEtleXNbXSBsaXN0ZW5pbmdLZXlzID0gbmV3W10geyBLZXlzLkVudGVyLCBLZXlzLkVzY2FwZSwgS2V5cy5MZWZ0LCBLZXlzLlJpZ2h0LCBLZXlzLkQxLCBLZXlzLkQyLCBLZXlzLkQzLCBLZXlzLkQ0LCBLZXlzLkQ1LCBLZXlzLkQ2LCBLZXlzLkQ3IH07XHJcblxyXG4gICAgICAgIHB1YmxpYyBLZXlzIENoZWNrS2V5cygpIHtcclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIGtleSBpbiBsaXN0ZW5pbmdLZXlzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoS2V5Ym9hcmQuR2V0U3RhdGUoKS5Jc0tleVVwKGtleSkgJiYgb2xkS2V5Ym9hcmRTdGF0ZS5Jc0tleURvd24oa2V5KSlcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ga2V5O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChHYW1lUGFkLkdldFN0YXRlKFBsYXllckluZGV4Lk9uZSkuQnV0dG9ucy5CYWNrID09IEJ1dHRvblN0YXRlLlByZXNzZWQpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gS2V5cy5Fc2NhcGU7XHJcbiAgICAgICAgICAgIHJldHVybiBLZXlzLk5vbmU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIEtleWJvYXJkU3RhdGUgb2xkS2V5Ym9hcmRTdGF0ZTtcclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgVXBkYXRlKCkge1xyXG4gICAgICAgICAgICBtYWluQW5pbWF0b3IuRG8oKTtcclxuICAgICAgICAgICAgZnJtSGVscC5WaXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGlmIChmcm1Qcm9kdWN0aW9uLlZpc2libGUpIHtcclxuICAgICAgICAgICAgICAgIGZvcmVhY2ggKHZhciBidG4gaW4gYnRuc1Byb2R1Y3Rpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgYnRuLkNoaWxkcmVuWzJdLlZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdmFyIG0gPSBNb3VzZS5HZXRTdGF0ZSgpO1xyXG4gICAgICAgICAgICBpZiAobS5MZWZ0QnV0dG9uID09IEJ1dHRvblN0YXRlLlJlbGVhc2VkICYmIG9sZE1vdXNlU3RhdGUuTGVmdEJ1dHRvbiA9PSBCdXR0b25TdGF0ZS5QcmVzc2VkKVxyXG4gICAgICAgICAgICAgICAgTW91c2VDbGlja2VkKG5ldyBWZWN0b3IyKG0uUG9zaXRpb24uWCwgbS5Qb3NpdGlvbi5ZKSk7XHJcbiAgICAgICAgICAgIG9sZE1vdXNlU3RhdGUgPSBtO1xyXG5cclxuICAgICAgICAgICAgaWYgKE1pY3Jvc29mdC5YbmEuRnJhbWV3b3JrLklucHV0LlRvdWNoLlRvdWNoUGFuZWwuSXNHZXN0dXJlQXZhaWxhYmxlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZ3MgPSBNaWNyb3NvZnQuWG5hLkZyYW1ld29yay5JbnB1dC5Ub3VjaC5Ub3VjaFBhbmVsLlJlYWRHZXN0dXJlKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZ3MuR2VzdHVyZVR5cGUgPT0gTWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuSW5wdXQuVG91Y2guR2VzdHVyZVR5cGUuVGFwKVxyXG4gICAgICAgICAgICAgICAgICAgIE1vdXNlQ2xpY2tlZChuZXcgVmVjdG9yMihncy5Qb3NpdGlvbi5YLCBncy5Qb3NpdGlvbi5ZKSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICBNYWluQ29udGFpbmVyLkhpZ2hsaWdodEJ1dHRvbihtLlgsIG0uWSwgbS5MZWZ0QnV0dG9uID09IEJ1dHRvblN0YXRlLlByZXNzZWQpO1xyXG5cclxuICAgICAgICAgICAgdmFyIHRvdWNoZXMgPSBuZXcgTGlzdDxNaWNyb3NvZnQuWG5hLkZyYW1ld29yay5JbnB1dC5Ub3VjaC5Ub3VjaExvY2F0aW9uPihNaWNyb3NvZnQuWG5hLkZyYW1ld29yay5JbnB1dC5Ub3VjaC5Ub3VjaFBhbmVsLkdldFN0YXRlKCkpO1xyXG5cclxuICAgICAgICAgICAgLy8gSWYgdG91Y2hlcyBJc05vdCBOb3RoaW5nIFRoZW5cclxuICAgICAgICAgICAgaWYgKHRvdWNoZXMuQ291bnQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBmb3JlYWNoICh2YXIgdHQgaW4gdG91Y2hlcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgodHQuU3RhdGUgPT0gTWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuSW5wdXQuVG91Y2guVG91Y2hMb2NhdGlvblN0YXRlLlByZXNzZWQgfHwgdHQuU3RhdGUgPT0gTWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuSW5wdXQuVG91Y2guVG91Y2hMb2NhdGlvblN0YXRlLk1vdmVkKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBNYWluQ29udGFpbmVyLlRhcEFuZEhvbGRCdXR0b24oKGludCl0dC5Qb3NpdGlvbi5YLCAoaW50KXR0LlBvc2l0aW9uLlkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gRW5kIElmXHJcblxyXG4gICAgICAgICAgICBpZiAoZ1N0YXRlID09IEdhbWVTdGF0ZS5JbkdhbWUpIHtcclxuICAgICAgICAgICAgICAgIGZvcmVhY2ggKFVuaXQgdSBpbiB1bml0cykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1LnggKyB1LnBhcmFtZXRlcnMucmVjdC5SaWdodCA+IG0uWCAmJiBtLlggPiB1LnggKyB1LnBhcmFtZXRlcnMucmVjdC5MZWZ0ICYmIGhvciArIHUucGFyYW1ldGVycy5yZWN0LkJvdHRvbSA+IG0uWSAmJiBtLlkgPiBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Ub3ApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUub3duZXIgPT0gMCB8fCAhdS5BYnNDb250YWlucyhcIkludmlzaWJsZVwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgU2hvd1VuaXRJbmZvKHUucGFyYW1ldGVycywgdS5vd25lciwgZmFsc2UsIG51bGwsIHUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoc2VsVSAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIFNob3dVbml0SW5mbyhzZWxVLnBhcmFtZXRlcnMsIHNlbFUub3duZXIsIGZhbHNlLCBudWxsLCBzZWxVKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIHZhciBrZXkgPSBDaGVja0tleXMoKTtcclxuICAgICAgICAgICAgaWYgKGtleSAhPSBLZXlzLk5vbmUpXHJcbiAgICAgICAgICAgICAgICBNYWluQ29udGFpbmVyLkNsaWNrQnV0dG9uKGtleSk7XHJcblxyXG4gICAgICAgICAgICBvbGRLZXlib2FyZFN0YXRlID0gS2V5Ym9hcmQuR2V0U3RhdGUoKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChnU3RhdGUgPT0gR2FtZVN0YXRlLkluR2FtZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGN1ck0gPCBwbHJzWzBdLnJlcy5Nb25leSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwbHJzWzBdLnJlcy5Nb25leSAtIGN1ck0gPD0gNTApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1ck0gKz0gNTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1ck0gKz0gMjA7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGN1ck0gPiBwbHJzWzBdLnJlcy5Nb25leSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjdXJNIC0gcGxyc1swXS5yZXMuTW9uZXkgPD0gNTApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1ck0gLT0gNTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1ck0gLT0gMjA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoY3VyRCA8IHBscnNbMF0ucmVzLkRlYXRoKVxyXG4gICAgICAgICAgICAgICAgICAgIGN1ckQgKz0gMTtcclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGN1ckQgPiBwbHJzWzBdLnJlcy5EZWF0aClcclxuICAgICAgICAgICAgICAgICAgICBjdXJEIC09IDE7XHJcblxyXG4gICAgICAgICAgICAgICAgVXBkYXRlUmVzb3VyY2VzKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIE1haW5Db250YWluZXIuUmVjYWxjKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoUGF1c2UpXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICAgICAgICBpbnQgaTtcclxuICAgICAgICAgICAgZmxvYXQgdDtcclxuXHJcbiAgICAgICAgICAgIGlmIChzblMgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBnb29kQWJpbENsciA9IENvbG9yLkRhcmtCbHVlO1xyXG4gICAgICAgICAgICAgICAgcG9pQWJpbENsciA9IENvbG9yLkRhcmtHcmVlbjtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGdvb2RBYmlsQ2xyID0gQ29sb3IuTGlnaHRCbHVlO1xyXG4gICAgICAgICAgICAgICAgcG9pQWJpbENsciA9IENvbG9yLkxpZ2h0R3JlZW47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGdTdGF0ZSA9PSBHYW1lU3RhdGUuSW5HYW1lKSB7XHJcbiAgICAgICAgICAgICAgICBmb3JlYWNoIChQbGF5ZXIgcCBpbiBwbHJzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcC5wcmRTcGQgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIHAubWFnaWNJbmNCb251cyA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgcC5tb25leUluY0JvbnVzID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBwLnBvaXNvbkJvbnVzID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBwLmJhbm5lZC5DbGVhcigpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAoUGxheWVyIHAgaW4gcGxycykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwLnJ1c2hCb251cyA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHAucHJkU3BkICo9IDI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBtYWNoaW5lbnVtID0gMDtcclxuICAgICAgICAgICAgICAgIGZvcmVhY2ggKFVuaXQgdSBpbiB1bml0cykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1LkFic0NvbnRhaW5zKFwiTWFjaGluZXJ5XCIpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYWNoaW5lbnVtICs9IDE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBEb1VuaXRzKCk7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcGxyc1swXS5zcGxsc0xpc3QuQ291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwbHJzWzBdLnNwZWxsc1JjaHJnW2ldID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwbHJzWzBdLnNwZWxsc1JjaHJnW2ldIC09IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwbHJzWzBdLnNwZWxsc1JjaHJnW2ldID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKChNb25vSW50ZXJmYWNlLlByb2dyZXNzKSgoTW9ub0ludGVyZmFjZS5CdXR0b24pY1NwZWxscy5DaGlsZHJlbltpXSkuQ2hpbGRyZW5bMV0pLk1heFZhbHVlID0gc3BlbGxzW3BscnNbMF0uc3BsbHNMaXN0W2ldXS5Db3N0LlRpbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoKE1vbm9JbnRlcmZhY2UuUHJvZ3Jlc3MpKChNb25vSW50ZXJmYWNlLkJ1dHRvbiljU3BlbGxzLkNoaWxkcmVuW2ldKS5DaGlsZHJlblsxXSkuQ3VycmVudFZhbHVlID0gcGxyc1swXS5zcGVsbHNSY2hyZ1tpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGZvcmVhY2ggKFBsYXllciBwbHIgaW4gcGxycykge1xyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFiaWwgPSBwbHI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsLnJlc0RlbGF5ID4gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFiaWwucmVzRGVsYXkgLT0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgdmFsID0gYWJpbC5zdGFydEluY28gKyBhYmlsLmlwdCAqIChhYmlsLnJlcy5UaWVyIC0gMSkgKyBhYmlsLm1vbmV5SW5jQm9udXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYmlsLlJlc291cmNlcyArPSBuZXcgVGltZUNvc3QodmFsLCBhYmlsLm1hZ2ljSW5jQm9udXMsIDAsIDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWwuaWQgPT0gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcIitcIiArIHZhbCwgbW9uZXlDbHIsIHVuaXRTaXplLCBob3IgLSA2MCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYmlsLnJlc0RlbGF5ID0gNDUwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsLnByZFEuQ291bnQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYmlsLnByZFByZyArPSBhYmlsLnByZFNwZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwbHIuaWQgPT0gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVcGRhdGVRdWV1ZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsLnByZFByZyA+PSB1bml0UHJtc1thYmlsLnByZFFbMF1dLkNvc3QuVGltZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsLnJ1c2hCb251cyA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFiaWwucnVzaEJvbnVzIC09IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQWRkVG9SZWFkeVVuaXRzKHBsciwgYWJpbC5wcmRRWzBdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZW1vdmVGcm9tUXVldWUoYWJpbC5pZCwgMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWwuQUkgJiYgYWJpbC5yZWFkeVVuaXRzLkNvdW50ID49IDMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIHUgaW4gYWJpbC5yZWFkeVVuaXRzKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUHJvZHVjZVVuaXQoYWJpbC5pZCwgdSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFiaWwucmVhZHlVbml0cy5DbGVhcigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbC5BSSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWwuY3VyQUlWYWwgPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFiaWwuY3VyQUlWYWwgLT0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFiaWwuQUlUaWNrKHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFiaWwuY3VyQUlWYWwgPSBhYmlsLm1heEFJVmFsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaSA9IDA7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoaSA8IGFtbW9zLkNvdW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWJpbDEgPSBhbW1vc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWJpbDEueCArPSBhYmlsMS52eDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWJpbDEueSArPSBhYmlsMS52eTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWJpbDEubGlmZXRpbWUgLT0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWwxLnRhcmdldCAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ID0gKGFiaWwxLnRhcmdldC54IC0gYWJpbDEueCkgLyBhYmlsMS52eDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ICE9IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJpbDEudnkgPSAoaG9yICsgYWJpbDEudGFyZ2V0LnBhcmFtZXRlcnMucmVjdC5Ub3AgKyAxNSAtIGFiaWwxLnkpIC8gdCAtIGFiaWwxLmF5ICogdCAvIDI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJpbDEudnkgPSAtMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYmlsMS52eSArPSBhYmlsMS5heTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoVW5pdCB1IGluIHVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbDEucGxyICE9IHUub3duZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKHUueCArIHUucGFyYW1ldGVycy5yZWN0LlJpZ2h0ID49IGFiaWwxLnggJiYgYWJpbDEueCA+PSB1LnggKyB1LnBhcmFtZXRlcnMucmVjdC5MZWZ0ICYmIGhvciArIHUucGFyYW1ldGVycy5yZWN0LkJvdHRvbSA+PSBhYmlsMS55ICYmIGFiaWwxLnkgPj0gaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuVG9wKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbDEuYWdpbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT25BZ2lsKGFiaWwxLm93bmVyLCB1KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsMS5leHBsb3NpdmUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXhwbG9kZSh1LCBhYmlsMS5vd25lci5BYnNDb250YWlucyhcIk1hZ2VcIikpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFiaWwxLm93bmVyICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9uU3VjY2Vzc2Z1bEF0dGFjayhhYmlsMS5kbWcsIGFiaWwxLm93bmVyLCB1LCBhYmlsMS5pZ25vcmVBcm1vcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbDEuZXhwbG9zaXZlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEV4cGxvZGUodSwgYWJpbDEub3duZXIuQWJzQ29udGFpbnMoXCJNYWdlXCIpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsMS5leHBsb3NpdmUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXhwbG9kZSh1LCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIYXJtKHUsIGFiaWwxLmRtZywgYWJpbDEuaWdub3JlQXJtb3IsIEVmZmVjdFR5cGUuTm9ybWFsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbDEudHlwZSA9PSBBbW1vLkFtbW9UeXBlLkJvbWIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzLkFkZChuZXcgSW1hZ2VQYXJ0aWNsZShuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJleHBsb2RlXCJdLCAxKSwgYWJpbDEueCAtIDEyLCBhYmlsMS55IC0gMTIsIDAsIDAsIDIwKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtbW9zLlJlbW92ZUF0KGkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpIC09IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbDEueSA+PSBob3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsMS50eXBlID09IEFtbW8uQW1tb1R5cGUuQm9tYilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzLkFkZChuZXcgSW1hZ2VQYXJ0aWNsZShuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJleHBsb2RlXCJdLCAxKSwgYWJpbDEueCAtIDEyLCBhYmlsMS55IC0gMTIsIDAsIDAsIDIwKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbW1vcy5SZW1vdmVBdChpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgLT0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbDEubGlmZXRpbWUgPD0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1tb3MuUmVtb3ZlQXQoaSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpIC09IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaSArPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCBwYXJzLkNvdW50KSB7XHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFiaWwyID0gcGFyc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICBhYmlsMi5sdGltZSAtPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIGFiaWwyLnggKz0gYWJpbDIuZHg7XHJcbiAgICAgICAgICAgICAgICAgICAgYWJpbDIueSArPSBhYmlsMi5keTtcclxuICAgICAgICAgICAgICAgICAgICBhYmlsMi5keSArPSBhYmlsMi5heTtcclxuICAgICAgICAgICAgICAgICAgICBhYmlsMi5hIC09IGFiaWwyLmFzdDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbDIuZHkgPiAwICYmIGFiaWwyLnkgPj0gaG9yIC0gdW5pdFNpemUgKyAyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFiaWwyLnkgPSBob3IgLSB1bml0U2l6ZSArIDM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFiaWwyLmR5ID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFiaWwyLmx0aW1lID09IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnMuUmVtb3ZlQXQoaSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpICs9IDE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZvcmVhY2ggKFBhcnRpY2xlIHAgaW4gY2xvdWRwYXJzKSB7XHJcbiAgICAgICAgICAgICAgICBwLnggKz0gcC5keDtcclxuICAgICAgICAgICAgICAgIGlmIChwLnggPj0gZ2FtZVdpZHRoICsgNzUpXHJcbiAgICAgICAgICAgICAgICAgICAgcC54ID0gLTEwMDtcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIGlmICh1cGRhdGVTcGVsbHMpXHJcbiAgICAgICAgICAgICAgICBTZXRTcGVsbHMoKTtcclxuICAgICAgICAgICAgaWYgKGdTdGF0ZSA9PSBHYW1lU3RhdGUuSW5HYW1lICYmIHNuUyA+IDAgJiYgZ1R5cGUgPT0gR2FtZVR5cGUuRGVmZW5jZUdUKVxyXG4gICAgICAgICAgICAgICAgZ1N0YXRlID0gR2FtZVN0YXRlLldpbjtcclxuICAgICAgICAgICAgaWYgKGdTdGF0ZSA9PSBHYW1lU3RhdGUuSW5HYW1lICYmIHNuUyA8IDAgJiYgZ1R5cGUgPT0gR2FtZVR5cGUuT2ZmZW5jZUdUKVxyXG4gICAgICAgICAgICAgICAgZ1N0YXRlID0gR2FtZVN0YXRlLkxvc2U7XHJcbiAgICAgICAgICAgIG9sZHNuUyA9IHNuUztcclxuICAgICAgICAgICAgc25TID0gc25TICogY3NEICsgY3NTICogc25EO1xyXG4gICAgICAgICAgICBjc1MgPSBjc1MgKiBjc0QgLSBvbGRzblMgKiBzbkQ7XHJcbiAgICAgICAgICAgIGlmIChnU3RhdGUgPT0gR2FtZVN0YXRlLkxvc2UgfHwgZ1N0YXRlID09IEdhbWVTdGF0ZS5XaW4pXHJcbiAgICAgICAgICAgICAgICBFbmRPZkJhdHRsZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgRW5kT2ZCYXR0bGUoKSB7XHJcbiAgICAgICAgICAgIF9wYXVzZSA9IHRydWU7XHJcbiAgICAgICAgICAgIGZybURpYWxvZy5TaG93KG1haW5BbmltYXRvcik7XHJcbiAgICAgICAgICAgIGlmIChQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0ucmFjZXNQbGF5cy5Db250YWluc0tleShwbHJzWzBdLnJhY2UpKSB7XHJcbiAgICAgICAgICAgICAgICBQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0ucmFjZXNQbGF5c1twbHJzWzBdLnJhY2VdICs9IDE7XHJcbiAgICAgICAgICAgICAgICBpZiAoZ1N0YXRlID09IEdhbWVTdGF0ZS5XaW4pXHJcbiAgICAgICAgICAgICAgICAgICAgUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLnJhY2VzV2luc1twbHJzWzBdLnJhY2VdICs9IDE7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0ucmFjZXNQbGF5cy5BZGQocGxyc1swXS5yYWNlLCAxKTtcclxuICAgICAgICAgICAgICAgIGlmIChnU3RhdGUgPT0gR2FtZVN0YXRlLldpbilcclxuICAgICAgICAgICAgICAgICAgICBQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0ucmFjZXNXaW5zLkFkZChwbHJzWzBdLnJhY2UsIDEpO1xyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoZ1N0YXRlID09IEdhbWVTdGF0ZS5Mb3NlKVxyXG4gICAgICAgICAgICAgICAgICAgIFByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS5yYWNlc1dpbnMuQWRkKHBscnNbMF0ucmFjZSwgMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc3dpdGNoIChnU3RhdGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgR2FtZVN0YXRlLldpbjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYmxUaXRsZWZybURpYWxvZy5UZXh0ID0gXCLQktGLINC/0L7QsdC10LTQuNC70LghXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlIEdhbWVTdGF0ZS5Mb3NlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxibFRpdGxlZnJtRGlhbG9nLlRleHQgPSBcItCS0Ysg0L/RgNC+0LjQs9GA0LDQu9C4IVwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbGJsTGluZTFGcm1EaWFsb2cuVGV4dCA9IHN0cmluZy5Gb3JtYXQoXCLQktCw0YjQuCDQv9C+0YLQtdGA0Lg6IHswfVwiLHBscnNbMF0uc3RhdERlYXRocyk7XHJcbiAgICAgICAgICAgIGxibExpbmUyRnJtRGlhbG9nLlRleHQgPSBzdHJpbmcuRm9ybWF0KFwi0J/QvtGC0LXRgNC4INC/0YDQvtGC0LjQstC90LjQutCwOiB7MH1cIixwbHJzWzFdLnN0YXREZWF0aHMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgU2hvd1VuaXRJbmZvKFVuaXRQYXJhbWV0ZXJzIHVwLCBpbnQgb3duLCBib29sIGNzdEhpZ2hsaWdodCwgUG9pbnQ/IHBudCA9IG51bGwsIFVuaXQgdW50ID0gbnVsbCkge1xyXG4gICAgICAgICAgICBsYmxVbml0TmFtZUhlbHBVbml0LlRleHQgPSBsb2NhbGl6ZS5HZXRTdHJpbmcodXAuTmFtZSk7XHJcbiAgICAgICAgICAgIGlmICh1cC5TdWJyYWNlID09IFwiXCIpXHJcbiAgICAgICAgICAgICAgICBsYmxSYWNlSGVscFVuaXQuVGV4dCA9IGxvY2FsaXplLkdldFN0cmluZyh1cC5SYWNlKTtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgbGJsUmFjZUhlbHBVbml0LlRleHQgPSBzdHJpbmcuRm9ybWF0KFwiezB9IC0gezF9XCIsbG9jYWxpemUuR2V0U3RyaW5nKHVwLlJhY2UpLGxvY2FsaXplLkdldFN0cmluZyh1cC5TdWJyYWNlKSk7XHJcblxyXG4gICAgICAgICAgICBsYmxDb3N0TW9uZXlIZWxwVW5pdC5UZXh0ID0gdXAuQ29zdC5Nb25leS5Ub1N0cmluZygpO1xyXG4gICAgICAgICAgICBpZiAocGxyc1swXS5yZXMuTW9uZXkgPCB1cC5Db3N0Lk1vbmV5ICYmIGNzdEhpZ2hsaWdodClcclxuICAgICAgICAgICAgICAgIGxibENvc3RNb25leUhlbHBVbml0LlRleHRDb2xvciA9IENvbG9yLlJlZDtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgbGJsQ29zdE1vbmV5SGVscFVuaXQuVGV4dENvbG9yID0gbW9uZXlDbHI7XHJcblxyXG5cclxuICAgICAgICAgICAgaWYgKHVwLkNvc3QuRGVhdGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBsYmxDb3N0RGVhdGhIZWxwVW5pdC5UZXh0ID0gdXAuQ29zdC5EZWF0aC5Ub1N0cmluZygpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHBscnNbMF0ucmVzLkRlYXRoIDwgdXAuQ29zdC5EZWF0aCAmJiBjc3RIaWdobGlnaHQpXHJcbiAgICAgICAgICAgICAgICAgICAgbGJsQ29zdERlYXRoSGVscFVuaXQuVGV4dENvbG9yID0gQ29sb3IuUmVkO1xyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIGxibENvc3REZWF0aEhlbHBVbml0LlRleHRDb2xvciA9IGRlYXRoQ2xyO1xyXG4gICAgICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgICAgIGxibENvc3REZWF0aEhlbHBVbml0LlRleHQgPSBcIi1cIjtcclxuXHJcbiAgICAgICAgICAgIGNCYXR0bGVQYXJhbWV0ZXJzLlZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgICAgICBDb2xvciBhdGtjbHIgPSBDb2xvci5CbGFjaztcclxuICAgICAgICAgICAgQXR0YWNrIGZpbmFsQXRrID0gdXAuQXR0YWNrO1xyXG4gICAgICAgICAgICBsb25nIGZpbmFsUm5nID0gdXAuQXR0YWNrLlJhbmdlO1xyXG4gICAgICAgICAgICBzdHJpbmcgYXRrU3BkID0gbG9jYWxpemUuR2V0U3RyaW5nKHN0cmluZy5Gb3JtYXQoXCJBdHRhY2tTcGVlZHswfVwiLHVwLkF0dGFjay5TcGVlZCkpO1xyXG4gICAgICAgICAgICBpZiAodW50ICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGZpbmFsQXRrICs9IHVudC5hdGtNb2Q7XHJcbiAgICAgICAgICAgICAgICBmaW5hbFJuZyArPSB1bnQuYXRrTW9kLlJhbmdlO1xyXG4gICAgICAgICAgICAgICAgaWYgKHVwLkF0dGFjay5NYXhEYW1hZ2UgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbmFsQXRrLk1pbkRhbWFnZSA+IHVuaXRQcm1zW3VwLk5hbWVdLkF0dGFjay5NaW5EYW1hZ2UgfHwgZmluYWxBdGsuTWF4RGFtYWdlID4gdW5pdFBybXNbdXAuTmFtZV0uQXR0YWNrLk1heERhbWFnZSB8fCBmaW5hbFJuZyA+IHVuaXRQcm1zW3VwLk5hbWVdLkF0dGFjay5SYW5nZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXRrY2xyID0gQ29sb3IuRGFya0JsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoZmluYWxBdGsuTWluRGFtYWdlIDwgdW5pdFBybXNbdXAuTmFtZV0uQXR0YWNrLk1pbkRhbWFnZSB8fCBmaW5hbEF0ay5NYXhEYW1hZ2UgPCB1bml0UHJtc1t1cC5OYW1lXS5BdHRhY2suTWF4RGFtYWdlIHx8IGZpbmFsUm5nIDwgdW5pdFBybXNbdXAuTmFtZV0uQXR0YWNrLlJhbmdlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhdGtjbHIgPSBDb2xvci5EYXJrVmlvbGV0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxibEF0dGFja0Jhc2ljUGFyYW1zLlRleHRDb2xvciA9IGF0a2NscjtcclxuICAgICAgICAgICAgaWYgKHVwLkF0dGFjay5SYW5nZSA+IDEpIHtcclxuICAgICAgICAgICAgICAgIHBjdEF0dGFja0Jhc2ljUGFyYW1zLnNwcml0ZVJlZiA9IG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcInNtYWxsX2ljb25zXCJdLCAwKTtcclxuICAgICAgICAgICAgICAgIGlmICh1cC5BdHRhY2suTWF4RGFtYWdlID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1cC5BdHRhY2suUmFuZ2UgPiAxMDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxibEF0dGFja0Jhc2ljUGFyYW1zLlRleHQgPSBzdHJpbmcuRm9ybWF0KFwiezB9LXsxfSwg0LTQsNC70YzQvdC+0YHRgtGMIOKIniwgezJ9XCIsZmluYWxBdGsuTWluRGFtYWdlLGZpbmFsQXRrLk1heERhbWFnZSxhdGtTcGQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGJsQXR0YWNrQmFzaWNQYXJhbXMuVGV4dCA9IHN0cmluZy5Gb3JtYXQoXCJ7MH0tezF9LCDQtNCw0LvRjNC90L7RgdGC0YwgezJ9LCB7M31cIixmaW5hbEF0ay5NaW5EYW1hZ2UsZmluYWxBdGsuTWF4RGFtYWdlLGZpbmFsUm5nLGF0a1NwZCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgICAgICAgICBsYmxBdHRhY2tCYXNpY1BhcmFtcy5UZXh0ID0gXCLQndC10YJcIjtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHBjdEF0dGFja0Jhc2ljUGFyYW1zLnNwcml0ZVJlZiA9IG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcInNtYWxsX2ljb25zXCJdLCAxKTtcclxuICAgICAgICAgICAgICAgIGlmICh1cC5BdHRhY2suTWF4RGFtYWdlID4gMClcclxuICAgICAgICAgICAgICAgICAgICBsYmxBdHRhY2tCYXNpY1BhcmFtcy5UZXh0ID0gc3RyaW5nLkZvcm1hdChcInswfS17MX0sIHsyfVwiLGZpbmFsQXRrLk1pbkRhbWFnZSxmaW5hbEF0ay5NYXhEYW1hZ2UsYXRrU3BkKTtcclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHVwLkF0dGFjay5NYXhEYW1hZ2UgPT0gMClcclxuICAgICAgICAgICAgICAgICAgICBsYmxBdHRhY2tCYXNpY1BhcmFtcy5UZXh0ID0gXCLQndC10YJcIjtcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICBsYmxBdHRhY2tCYXNpY1BhcmFtcy5UZXh0ID0gXCLQndC1INGD0LrQsNC30LDQvdCwXCI7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICBpZiAodW50ICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGxibHNCYXNpY1BhcmFtc1swXS5UZXh0ID0gc3RyaW5nLkZvcm1hdChcInswfS97MX1cIix1bnQuaHAgLHVwLm1heGhwKTtcclxuICAgICAgICAgICAgICAgIGlmICh1cC5tYXhocCA+IHVuaXRQcm1zW3VwLk5hbWVdLm1heGhwKVxyXG4gICAgICAgICAgICAgICAgICAgIGxibHNCYXNpY1BhcmFtc1swXS5UZXh0Q29sb3IgPSBDb2xvci5EYXJrQmx1ZTtcclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHVwLm1heGhwIDwgdW5pdFBybXNbdXAuTmFtZV0ubWF4aHApXHJcbiAgICAgICAgICAgICAgICAgICAgbGJsc0Jhc2ljUGFyYW1zWzBdLlRleHRDb2xvciA9IENvbG9yLkRhcmtWaW9sZXQ7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgbGJsc0Jhc2ljUGFyYW1zWzBdLlRleHRDb2xvciA9IENvbG9yLkJsYWNrO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHVwLm1heGhwID4gMCkge1xyXG4gICAgICAgICAgICAgICAgbGJsc0Jhc2ljUGFyYW1zWzBdLlRleHQgPSB1cC5tYXhocC5Ub1N0cmluZygpO1xyXG4gICAgICAgICAgICAgICAgbGJsc0Jhc2ljUGFyYW1zWzBdLlRleHRDb2xvciA9IENvbG9yLkJsYWNrO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbGJsc0Jhc2ljUGFyYW1zWzBdLlRleHQgPSBcItCd0LUg0YPQutCw0LfQsNC90L5cIjtcclxuICAgICAgICAgICAgICAgIGxibHNCYXNpY1BhcmFtc1swXS5UZXh0Q29sb3IgPSBDb2xvci5CbGFjaztcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIGxibHNCYXNpY1BhcmFtc1sxXS5UZXh0ID0gbG9jYWxpemUuR2V0U3RyaW5nKHVwLmFybU5pY2spO1xyXG4gICAgICAgICAgICBpZiAodXAuX2FybW9yIDwgdW5pdFBybXNbdXAuTmFtZV0uX2FybW9yKVxyXG4gICAgICAgICAgICAgICAgbGJsc0Jhc2ljUGFyYW1zWzFdLlRleHRDb2xvciA9IENvbG9yLkRhcmtCbHVlO1xyXG4gICAgICAgICAgICBlbHNlIGlmICh1cC5fYXJtb3IgPiB1bml0UHJtc1t1cC5OYW1lXS5fYXJtb3IpXHJcbiAgICAgICAgICAgICAgICBsYmxzQmFzaWNQYXJhbXNbMV0uVGV4dENvbG9yID0gQ29sb3IuRGFya0JsdWU7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIGxibHNCYXNpY1BhcmFtc1sxXS5UZXh0Q29sb3IgPSBDb2xvci5CbGFjaztcclxuXHJcbiAgICAgICAgICAgIGxibHNCYXNpY1BhcmFtc1syXS5UZXh0ID0gc3RyaW5nLkZvcm1hdChcInswfSwgezF9XCIsbG9jYWxpemUuR2V0U3RyaW5nKHN0cmluZy5Gb3JtYXQoXCJ7MH1TXCIsdXAuc3BkTmljaykpLGxvY2FsaXplLkdldFN0cmluZyh1cC5tb3ZlVHlwZS5Ub1N0cmluZygpKSk7XHJcblxyXG4gICAgICAgICAgICBpZiAodXAuX3NwZWVkID4gdW5pdFBybXNbdXAuTmFtZV0uX3NwZWVkKVxyXG4gICAgICAgICAgICAgICAgbGJsc0Jhc2ljUGFyYW1zWzJdLlRleHRDb2xvciA9IENvbG9yLkRhcmtCbHVlO1xyXG4gICAgICAgICAgICBlbHNlIGlmICh1cC5fc3BlZWQgPCB1bml0UHJtc1t1cC5OYW1lXS5fc3BlZWQpXHJcbiAgICAgICAgICAgICAgICBsYmxzQmFzaWNQYXJhbXNbMl0uVGV4dENvbG9yID0gQ29sb3IuRGFya1Zpb2xldDtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgbGJsc0Jhc2ljUGFyYW1zWzJdLlRleHRDb2xvciA9IENvbG9yLkJsYWNrO1xyXG5cclxuICAgICAgICAgICAgdmFyIGkgPSAwO1xyXG4gICAgICAgICAgICB2YXIgbGFzdEggPSBjQmF0dGxlUGFyYW1ldGVycy5Cb3R0b207XHJcbiAgICAgICAgICAgIHZhciBhYmlscyA9IHVudCAhPSBudWxsID8gdW50LmFiaWxzLlZhbHVlcyA6IHVwLmFiaWxzLlZhbHVlcztcclxuXHJcbiAgICAgICAgICAgIGZvcmVhY2ggKEFiaWxpdHkgYSBpbiBhYmlscykge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFhLmhpZGRlbikge1xyXG4gICAgICAgICAgICAgICAgICAgIENvbG9yIGNscjtcclxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGEudHlwKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFZmZlY3RUeXBlLk5vcm1hbDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsciA9IENvbG9yLkJsYWNrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRWZmZWN0VHlwZS5Hb29kOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xyID0gQ29sb3IuRGFya0JsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFZmZlY3RUeXBlLkJhZDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsciA9IENvbG9yLkRhcmtWaW9sZXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFZmZlY3RUeXBlLlBvaXNvbjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsciA9IENvbG9yLkRhcmtHcmVlbjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xyID0gQ29sb3IuQmxhY2s7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGEuY29uZGl0aW9uID09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGJsc0FiaWxzW2ldLlRleHQgPSBzdHJpbmcuRm9ybWF0KFwi4oCiIHswfVwiLHN0cmluZy5Gb3JtYXQobG9jYWxpemUuR2V0U3RyaW5nKGEubmFtZSksIGEudmFsdWUsIGEudmFsdWUpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGJsc0FiaWxzW2ldLlRleHRDb2xvciA9IGNscjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGJsc0FiaWxzW2ldLlZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhLmxvbmdUaW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWEudXNlZCAmJiAhYS5jb25kQ29tcGxldGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVudCAhPSBudWxsIHx8ICEoYS5jb25kaXRpb24gPT0gXCJUaWVyXCIgJiYgcGxyc1tvd25dLnJlcy5UaWVyID49IGEuY29uZG51bSkgJiYgIShhLmNvbmRpdGlvbiA9PSBcIk1hY2hpbmVfYXJteVwiICYmIG1hY2hpbmVudW0gPj0gYS5jb25kbnVtKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xyID0gY29uZENscjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdW5pdF9wYXJhbWV0ZXJzID0gR2V0VW5pdFBhcmFtZXRlcnNGcm9tSUQoYS52YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1bml0X25hbWUgPSB1bml0X3BhcmFtZXRlcnMuSGFzVmFsdWUgPyBsb2NhbGl6ZS5HZXRTdHJpbmcodW5pdF9wYXJhbWV0ZXJzLlZhbHVlLk5hbWUpIDogXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGJsc0FiaWxzW2ldLlRleHQgPSBzdHJpbmcuRm9ybWF0KFwi4oCiIHswfSB7MX1cIixzdHJpbmcuRm9ybWF0KGxvY2FsaXplLkdldFN0cmluZyhhLmNvbmRpdGlvbiksIGEuY29uZG51bSwgR2V0RW5kaW5nKGEuY29uZG51bSkpLHN0cmluZy5Gb3JtYXQobG9jYWxpemUuR2V0U3RyaW5nKGEubmFtZSksIGEudmFsdWUsIHVuaXRfbmFtZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYmxzQWJpbHNbaV0uVGV4dENvbG9yID0gY2xyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYmxzQWJpbHNbaV0uVmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGxibHNBYmlsc1tpXS5ZID0gbGFzdEggKyA1O1xyXG4gICAgICAgICAgICAgICAgICAgIGxhc3RIID0gbGJsc0FiaWxzW2ldLkJvdHRvbTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYS5jb25kQ29tcGxldGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhLm5hbWUgPT0gXCJNYWdlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwY3RBdHRhY2tCYXNpY1BhcmFtcy5zcHJpdGVSZWYgPSBuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJzbWFsbF9pY29uc1wiXSwgMik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGEubmFtZSA9PSBcIlNob290ZXJcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBjdEF0dGFja0Jhc2ljUGFyYW1zLnNwcml0ZVJlZiA9IG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcInNtYWxsX2ljb25zXCJdLCAxNyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGEubmFtZSA9PSBcIkFyYmFsZXN0ZXJcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBjdEF0dGFja0Jhc2ljUGFyYW1zLnNwcml0ZVJlZiA9IG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcInNtYWxsX2ljb25zXCJdLCAxOCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGkgKz0gMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IGk7IGogPD0gNTsgaisrKVxyXG4gICAgICAgICAgICAgICAgbGJsc0FiaWxzW2pdLlZpc2libGUgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIGZybUhlbHAuSCA9IGxhc3RIICsgNTtcclxuXHJcbiAgICAgICAgICAgIGlmICghcG50Lkhhc1ZhbHVlKSBwbnQgPSBuZXcgUG9pbnQoZ2FtZVdpZHRoIC0gZnJtSGVscC5XIC0gMzAsIDkwKTtcclxuXHJcbiAgICAgICAgICAgIGZybUhlbHAuWCA9IHBudC5WYWx1ZS5YICsgMTA7XHJcbiAgICAgICAgICAgIGZybUhlbHAuWSA9IHBudC5WYWx1ZS5ZICsgMTA7XHJcbiAgICAgICAgICAgIGlmIChmcm1IZWxwLlJpZ2h0ID4gZ2FtZVdpZHRoIC0gMjApXHJcbiAgICAgICAgICAgICAgICBmcm1IZWxwLlJpZ2h0ID0gZ2FtZVdpZHRoIC0gMjA7XHJcbiAgICAgICAgICAgIGlmIChmcm1IZWxwLkJvdHRvbSA+IGdhbWVIZWlnaHQgLSAyMClcclxuICAgICAgICAgICAgICAgIGZybUhlbHAuQm90dG9tID0gZ2FtZUhlaWdodCAtIDIwO1xyXG5cclxuICAgICAgICAgICAgZnJtSGVscC5WaXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgR2V0RW5kaW5nKGludCBuKSB7XHJcbiAgICAgICAgICAgIGlmIChuID4gNClcclxuICAgICAgICAgICAgICAgIHJldHVybiBcIlwiO1xyXG4gICAgICAgICAgICBlbHNlIGlmIChuID09IDEpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gXCLQvlwiO1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gXCLQsFwiO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgU2hvd0luZm8oUG9pbnQgcG50LCBwYXJhbXMgc3RyaW5nW10gbGluZXMpIHtcclxuICAgICAgICAgICAgU2hvd01vcmVJbmZvKG5ldyBUaW1lQ29zdCgwLCAwLCAwLCAwKSwgZmFsc2UsIHBudCwgbGluZXMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgU2hvd01vcmVJbmZvKFRpbWVDb3N0IGNvc3QsIGJvb2wgY3N0SGlnaGxpZ2h0LCBQb2ludD8gcG50LCBwYXJhbXMgc3RyaW5nW10gbGluZXMpIHtcclxuICAgICAgICAgICAgbGJsVW5pdE5hbWVIZWxwVW5pdC5UZXh0ID0gbGluZXNbMF07XHJcbiAgICAgICAgICAgIGxibFJhY2VIZWxwVW5pdC5UZXh0ID0gbGluZXNbMV07XHJcblxyXG4gICAgICAgICAgICBsYmxDb3N0TW9uZXlIZWxwVW5pdC5UZXh0ID0gY29zdC5Nb25leS5Ub1N0cmluZygpO1xyXG4gICAgICAgICAgICBpZiAocGxyc1swXS5yZXMuTW9uZXkgPCBjb3N0Lk1vbmV5ICYmIGNzdEhpZ2hsaWdodClcclxuICAgICAgICAgICAgICAgIGxibENvc3RNb25leUhlbHBVbml0LlRleHRDb2xvciA9IENvbG9yLlJlZDtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgbGJsQ29zdE1vbmV5SGVscFVuaXQuVGV4dENvbG9yID0gbW9uZXlDbHI7XHJcblxyXG5cclxuICAgICAgICAgICAgaWYgKGNvc3QuRGVhdGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBsYmxDb3N0RGVhdGhIZWxwVW5pdC5UZXh0ID0gY29zdC5EZWF0aC5Ub1N0cmluZygpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHBscnNbMF0ucmVzLkRlYXRoIDwgY29zdC5EZWF0aCAmJiBjc3RIaWdobGlnaHQpXHJcbiAgICAgICAgICAgICAgICAgICAgbGJsQ29zdERlYXRoSGVscFVuaXQuVGV4dENvbG9yID0gQ29sb3IuUmVkO1xyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIGxibENvc3REZWF0aEhlbHBVbml0LlRleHRDb2xvciA9IGRlYXRoQ2xyO1xyXG4gICAgICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgICAgIGxibENvc3REZWF0aEhlbHBVbml0LlRleHQgPSBcIi1cIjtcclxuXHJcbiAgICAgICAgICAgIGNCYXR0bGVQYXJhbWV0ZXJzLlZpc2libGUgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIHZhciBpID0gMDtcclxuICAgICAgICAgICAgdmFyIGxhc3RIID0gbGJsQ29zdE1vbmV5SGVscFVuaXQuQm90dG9tO1xyXG4gICAgICAgICAgICBmb3IgKGkgPSAyOyBpIDwgbGluZXMuTGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGxibHNBYmlsc1tpIC0gMl0uVGV4dCA9IGxpbmVzW2ldO1xyXG4gICAgICAgICAgICAgICAgbGJsc0FiaWxzW2kgLSAyXS5UZXh0Q29sb3IgPSBDb2xvci5CbGFjaztcclxuICAgICAgICAgICAgICAgIGxibHNBYmlsc1tpIC0gMl0uVmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBsYmxzQWJpbHNbaSAtIDJdLlkgPSBsYXN0SCArIDU7XHJcbiAgICAgICAgICAgICAgICBsYXN0SCA9IGxibHNBYmlsc1tpIC0gMl0uQm90dG9tO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBqID0gaSAtIDI7IGogPD0gNTsgaisrKVxyXG4gICAgICAgICAgICAgICAgbGJsc0FiaWxzW2pdLlZpc2libGUgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIGZybUhlbHAuSCA9IGxhc3RIICsgNTtcclxuICAgICAgICAgICAgaWYgKCFwbnQuSGFzVmFsdWUpIHBudCA9IG5ldyBQb2ludChnYW1lV2lkdGggLSBmcm1IZWxwLlcgLSA0MCwgODApO1xyXG5cclxuICAgICAgICAgICAgZnJtSGVscC5YID0gcG50LlZhbHVlLlggKyAyMDtcclxuICAgICAgICAgICAgZnJtSGVscC5ZID0gcG50LlZhbHVlLlkgKyAyMDtcclxuICAgICAgICAgICAgaWYgKGZybUhlbHAuUmlnaHQgPiBnYW1lV2lkdGggLSAyMClcclxuICAgICAgICAgICAgICAgIGZybUhlbHAuUmlnaHQgPSBnYW1lV2lkdGggLSAyMDtcclxuICAgICAgICAgICAgaWYgKGZybUhlbHAuQm90dG9tID4gZ2FtZUhlaWdodCAtIDIwKVxyXG4gICAgICAgICAgICAgICAgZnJtSGVscC5Cb3R0b20gPSBnYW1lSGVpZ2h0IC0gMjA7XHJcblxyXG4gICAgICAgICAgICBmcm1IZWxwLlZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIENyZWF0ZVJhY2VMaXN0KCkge1xyXG4gICAgICAgICAgICByYWNlczEgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcbiAgICAgICAgICAgIHJhY2VzMiA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuICAgICAgICAgICAgc3RhbmRhcnRSYWNlcyA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuICAgICAgICAgICAgZm9yZWFjaCAoUmFjZSByIGluIFJhY2VNYW5hZ2VyLkluc3RhbmNlLkFsbC5WYWx1ZXMpIHtcclxuICAgICAgICAgICAgICAgIGlmICghci5zcGVjaWFsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmFjZXMxLkFkZChyLm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghci5ub0FJKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByYWNlczIuQWRkKHIubmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFyLmN1c3RvbSAmJiAhKHIubmFtZSA9PSBcIlJhbmRvbVwiKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhbmRhcnRSYWNlcy5BZGQoci5uYW1lKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgQWRkQ3VzdG9tUmFjZShzdHJpbmcgbmFtZSkge1xyXG4gICAgICAgICAgICBzdHJpbmcgbmljaywgZGVzYztcclxuICAgICAgICAgICAgaW50IHN5bWI7XHJcbiAgICAgICAgICAgIGJvb2wgbm9BSTtcclxuICAgICAgICAgICAgbmljayA9IGxvY2FsaXplLkdldFN0cmluZyhuYW1lKTtcclxuICAgICAgICAgICAgc3ltYiA9IDEwICsgaW50LlBhcnNlKG5hbWVbbmFtZS5MZW5ndGggLSAxXS5Ub1N0cmluZygpKTtcclxuICAgICAgICAgICAgZGVzYyA9IFwi0KHQtNC10LvQsNC90L4g0YHQstC+0LjQvNC4INGA0YPQutCw0LzQuFwiO1xyXG4gICAgICAgICAgICBub0FJID0gZmFsc2U7XHJcbiAgICAgICAgICAgIFJhY2VNYW5hZ2VyLkluc3RhbmNlLkFsbC5BZGQobmFtZSwgbmV3IFJhY2UobmFtZSwgZGVzYywgbmljaywgc3ltYiwgbm9BSSwgdHJ1ZSwgZmFsc2UsIGZhbHNlKSk7XHJcbiAgICAgICAgICAgIE9yZGVyUmFjZXMoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIE9yZGVyUmFjZXMoKSB7XHJcbiAgICAgICAgICAgIHZhciBuZXdyYWNlcyA9IGdsb2JhbDo6QnJpZGdlLlNjcmlwdC5DYWxsRm9yKG5ldyBEaWN0aW9uYXJ5PHN0cmluZywgUmFjZT4oKSwoX28xKT0+e19vMS5BZGQoXCJSYW5kb21cIixuZXcgUmFjZShcIlJhbmRvbVwiLCBcItCh0LvRg9GH0LDQudC90YvQuSDQstGL0LHQvtGAINGE0YDQsNC60YbQuNC4XCIsIGxvY2FsaXplLkdldFN0cmluZyhcIlJhbmRvbVwiKSwgNCwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2UpKTtyZXR1cm4gX28xO30pO1xyXG5cclxuICAgICAgICAgICAgaWYgKFByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbC5Db3VudCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLm1heEN1c3RvbVJhY2VzOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoUmFjZU1hbmFnZXIuSW5zdGFuY2UuQWxsLkNvbnRhaW5zS2V5KHN0cmluZy5Gb3JtYXQoXCJDdXN0b217MH1cIixpKSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld3JhY2VzLkFkZChzdHJpbmcuRm9ybWF0KFwiQ3VzdG9tezB9XCIsaSksIFJhY2VNYW5hZ2VyLkluc3RhbmNlLkFsbFtzdHJpbmcuRm9ybWF0KFwiQ3VzdG9tezB9XCIsaSldKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIGZvcmVhY2ggKFJhY2UgciBpbiBSYWNlTWFuYWdlci5JbnN0YW5jZS5BbGwuVmFsdWVzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXIuY3VzdG9tICYmICEoci5uYW1lID09IFwiUmFuZG9tXCIpKVxyXG4gICAgICAgICAgICAgICAgICAgIG5ld3JhY2VzLkFkZChyLm5hbWUsIHIpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBSYWNlTWFuYWdlci5JbnN0YW5jZS5BbGwgPSBuZXdyYWNlcztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFNhdmVDdXJyZW50RWRSYWNlKCkge1xyXG4gICAgICAgICAgICAvL2lmICghUmFjZU1hbmFnZXIuSW5zdGFuY2UuQWxsLkNvbnRhaW5zS2V5KGN1cnJlbnRFZFJhY2UpKVxyXG4gICAgICAgICAgICAvLyAgICBBZGRDdXN0b21SYWNlKGN1cnJlbnRFZFJhY2UpO1xyXG4gICAgICAgICAgICAvL3tcclxuICAgICAgICAgICAgLy92YXIgYWJpbCA9IFJhY2VNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJyZW50RWRSYWNlXTtcclxuICAgICAgICAgICAgLy9pZiAoIXN0cmluZy5Jc051bGxPckVtcHR5KGN1cnJlbnRFZFJhY2VOaWNrKSlcclxuICAgICAgICAgICAgLy8gICAgYWJpbC5uaWNrID0gY3VycmVudEVkUmFjZU5pY2s7XHJcbiAgICAgICAgICAgIC8vYWJpbC51bml0cy5DbGVhcigpO1xyXG4gICAgICAgICAgICAvL2ZvcmVhY2ggKHN0cmluZyB1IGluIGVkdW5pdHMpXHJcbiAgICAgICAgICAgIC8vICAgIGFiaWwudW5pdHMuQWRkKHUpO1xyXG4gICAgICAgICAgICAvL1VubG9ja0FjaGl2aWVtZW50KFwiT3BlbmVkaXRvclwiKTtcclxuICAgICAgICAgICAgLy99XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBDbGVhclZhcnNBbmRDYWxjRWFybmVkKCkge1xyXG4gICAgICAgICAgICBzZWxVID0gbnVsbDtcclxuICAgICAgICAgICAgcGFycy5DbGVhcigpO1xyXG4gICAgICAgICAgICBhbW1vcy5DbGVhcigpO1xyXG4gICAgICAgICAgICB1bml0cy5DbGVhcigpO1xyXG4gICAgICAgICAgICBkZWF0aGxpc3QuQ2xlYXIoKTtcclxuICAgICAgICAgICAgYm9ybkxpc3QuQ2xlYXIoKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChnU3RhdGUgPT0gR2FtZVN0YXRlLkluR2FtZSB8fCBnU3RhdGUgPT0gR2FtZVN0YXRlLldpbiB8fCBnU3RhdGUgPT0gR2FtZVN0YXRlLkxvc2UpXHJcbiAgICAgICAgICAgICAgICBSZXNldFdvcmxkKHN1bkFuZywgZEFuZyk7XHJcbiAgICAgICAgICAgIGlmIChSYWNlTWFuYWdlci5JbnN0YW5jZS5BbGxbcGxyc1swXS5yYWNlXS5kaXNhYmxlUmV3YXJkcykge1xyXG4gICAgICAgICAgICAgICAgdW5sb2NrZWRBY2hpdnMuQ2xlYXIoKTtcclxuICAgICAgICAgICAgICAgIHVubG9ja2VkVW5pdHMuQ2xlYXIoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChnU3RhdGUgPT0gR2FtZVN0YXRlLldpbikge1xyXG4gICAgICAgICAgICAgICAgICAgIFVubG9ja0FjaGl2aWVtZW50KFwiU3RhcnRwYXRoXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwbHJzWzBdLnN0YXREZWF0aHMgPT0gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgVW5sb2NrQWNoaXZpZW1lbnQoXCJHZW50bGVsZWFkZXJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmRzW1Byb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS5kaWZmaWN1bHRdLm5hbWUgPT0gXCJIYXJkXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0uYWNoaXZzLkNvbnRhaW5zS2V5KFwiQWxpdHRsZWhhcmRlclwiKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS5hY2hpdnMuQWRkKFwiQWxpdHRsZWhhcmRlclwiLCBcIjJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKCFzdHJpbmcuSXNOdWxsT3JFbXB0eShQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0uYWNoaXZzW1wiQWxpdHRsZWhhcmRlclwiXSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS5hY2hpdnNbXCJBbGl0dGxlaGFyZGVyXCJdID0gKGludC5QYXJzZShQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0uYWNoaXZzW1wiQWxpdHRsZWhhcmRlclwiXSkgLSAxKS5Ub1N0cmluZygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS5hY2hpdnNbXCJBbGl0dGxlaGFyZGVyXCJdID09IFwiMFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVubG9ja2VkQWNoaXZzLkFkZChcIkFsaXR0bGVoYXJkZXJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBscnNbMF0udW5pdHNMaXN0LkNvdW50ID09IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFVubG9ja0FjaGl2aWVtZW50KFwiVHJ1ZW1hZ2VcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLm1pbnZpY3RpbXMgPT0gLTEgfHwgUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLm1pbnZpY3RpbXMgPiBwbHJzWzBdLnN0YXREZWF0aHMpXHJcbiAgICAgICAgICAgICAgICAgICAgUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLm1pbnZpY3RpbXMgPSBwbHJzWzBdLnN0YXREZWF0aHM7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKFByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS5tYXhraWxscyA9PSAtMSB8fCBQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0ubWF4a2lsbHMgPCBwbHJzWzFdLnN0YXREZWF0aHMpXHJcbiAgICAgICAgICAgICAgICAgICAgUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLm1heGtpbGxzID0gcGxyc1sxXS5zdGF0RGVhdGhzO1xyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgLy8gRW5kIElmXHJcbiAgICAgICAgICAgIGdTdGF0ZSA9IEdhbWVTdGF0ZS5NYWluTWVudTtcclxuICAgICAgICAgICAgUGF1c2UgPSBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgVW5sb2NrQWNoaXZpZW1lbnQoc3RyaW5nIGFjaGl2KSB7XHJcbiAgICAgICAgICAgIGlmICghUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLmFjaGl2cy5Db250YWluc0tleShhY2hpdikgJiYgIXVubG9ja2VkQWNoaXZzLkNvbnRhaW5zKGFjaGl2KSlcclxuICAgICAgICAgICAgICAgIHVubG9ja2VkQWNoaXZzLkFkZChhY2hpdik7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBib29sIENoZWNrUHVyY2hhc2VDb3N0KHN0cmluZyBwcmNoKSB7XHJcbiAgICAgICAgICAgIGlmIChQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0uY3J5c3RhbHMgPj0gcHVyY2hhc2VzW3ByY2hdLmNyeXN0YWxzKSB7XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHB1cmNoYXNlc1twcmNoXS5uYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkJ1c3RlcjFUXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBhdnVuaXRzID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRpZXIgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoc3RyaW5nIHUgaW4gQWxsVW50c0xpc3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodW5pdFBybXNbdV0uQ29zdC5UaWVyID09IHRpZXIgJiYgIXVuaXRQcm1zW3VdLmlzSGVyb2ljICYmICFQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0udW5pdHMuQ29udGFpbnModSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF2dW5pdHMuQWRkKHUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF2dW5pdHMuQ291bnQgPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkJ1c3RlcjJUXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBhdnVuaXRzID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRpZXIgPSAyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoc3RyaW5nIHUgaW4gQWxsVW50c0xpc3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodW5pdFBybXNbdV0uQ29zdC5UaWVyID09IHRpZXIgJiYgIXVuaXRQcm1zW3VdLmlzSGVyb2ljICYmICFQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0udW5pdHMuQ29udGFpbnModSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF2dW5pdHMuQWRkKHUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF2dW5pdHMuQ291bnQgPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkJ1c3RlcjNUXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBhdnVuaXRzID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRpZXIgPSAzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoc3RyaW5nIHUgaW4gQWxsVW50c0xpc3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodW5pdFBybXNbdV0uQ29zdC5UaWVyID09IHRpZXIgJiYgIXVuaXRQcm1zW3VdLmlzSGVyb2ljICYmICFQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0udW5pdHMuQ29udGFpbnModSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF2dW5pdHMuQWRkKHUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF2dW5pdHMuQ291bnQgPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkhlcm9idXN0ZXJcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IGF2dW5pdHMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChzdHJpbmcgdSBpbiBBbGxVbnRzTGlzdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1bml0UHJtc1t1XS5pc0hlcm9pYyAmJiAhUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLnVuaXRzLkNvbnRhaW5zKHUpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdnVuaXRzLkFkZCh1KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdnVuaXRzLkNvdW50ID4gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJBZGRpdGlvblNsb3RcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS5tYXhDdXN0b21SYWNlcyA8IDMpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEJ1eShzdHJpbmcgcHJjaCkge1xyXG4gICAgICAgICAgICBpZiAoUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLmNyeXN0YWxzID49IHB1cmNoYXNlc1twcmNoXS5jcnlzdGFscykge1xyXG4gICAgICAgICAgICAgICAgYm9vbCBjYW5jZWwgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAocHVyY2hhc2VzW3ByY2hdLm5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQnVzdGVyMVRcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IGF2dW5pdHMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYnVzdHNpemUgPSA0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRpZXIgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoc3RyaW5nIHUgaW4gQWxsVW50c0xpc3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodW5pdFBybXNbdV0uQ29zdC5UaWVyID09IHRpZXIgJiYgIXVuaXRQcm1zW3VdLmlzSGVyb2ljICYmICFQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0udW5pdHMuQ29udGFpbnModSkgJiYgIXVubG9ja2VkVW5pdHMuQ29udGFpbnModSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF2dW5pdHMuQWRkKHUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF2dW5pdHMuQ291bnQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGF2dW5pdHMuQ291bnQgPiAwICYmIGJ1c3RzaXplID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdSA9IGF2dW5pdHNbcm5kLk5leHQoYXZ1bml0cy5Db3VudCldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bmxvY2tlZFVuaXRzLkFkZCh1KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXZ1bml0cy5SZW1vdmUodSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1c3RzaXplIC09IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuY2VsID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJCdXN0ZXIyVFwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gYXZ1bml0cyA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBidXN0c2l6ZSA9IDI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGllciA9IDI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChzdHJpbmcgdSBpbiBBbGxVbnRzTGlzdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1bml0UHJtc1t1XS5Db3N0LlRpZXIgPT0gdGllciAmJiAhdW5pdFBybXNbdV0uaXNIZXJvaWMgJiYgIVByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS51bml0cy5Db250YWlucyh1KSAmJiAhdW5sb2NrZWRVbml0cy5Db250YWlucyh1KSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXZ1bml0cy5BZGQodSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXZ1bml0cy5Db3VudCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoYXZ1bml0cy5Db3VudCA+IDAgJiYgYnVzdHNpemUgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1ID0gYXZ1bml0c1tybmQuTmV4dChhdnVuaXRzLkNvdW50KV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVubG9ja2VkVW5pdHMuQWRkKHUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdnVuaXRzLlJlbW92ZSh1KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnVzdHNpemUgLT0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWwgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkJ1c3RlcjNUXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBhdnVuaXRzID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRpZXIgPSAzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoc3RyaW5nIHUgaW4gQWxsVW50c0xpc3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodW5pdFBybXNbdV0uQ29zdC5UaWVyID09IHRpZXIgJiYgIXVuaXRQcm1zW3VdLmlzSGVyb2ljICYmICFQcm9maWxlTWFuYWdlci5JbnN0YW5jZS5BbGxbY3VyUHJvZmlsZV0udW5pdHMuQ29udGFpbnModSkgJiYgIXVubG9ja2VkVW5pdHMuQ29udGFpbnModSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF2dW5pdHMuQWRkKHUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF2dW5pdHMuQ291bnQgPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVubG9ja2VkVW5pdHMuQWRkKGF2dW5pdHNbcm5kLk5leHQoYXZ1bml0cy5Db3VudCldKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWwgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkhlcm9idXN0ZXJcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IGF2dW5pdHMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChzdHJpbmcgdSBpbiBBbGxVbnRzTGlzdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1bml0UHJtc1t1XS5pc0hlcm9pYyAmJiAhUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLnVuaXRzLkNvbnRhaW5zKHUpICYmICF1bmxvY2tlZFVuaXRzLkNvbnRhaW5zKHUpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdnVuaXRzLkFkZCh1KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdnVuaXRzLkNvdW50ID4gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bmxvY2tlZFVuaXRzLkFkZChhdnVuaXRzW3JuZC5OZXh0KGF2dW5pdHMuQ291bnQpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuY2VsID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJBZGRpdGlvblNsb3RcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS5tYXhDdXN0b21SYWNlcyA8IDMpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUHJvZmlsZU1hbmFnZXIuSW5zdGFuY2UuQWxsW2N1clByb2ZpbGVdLm1heEN1c3RvbVJhY2VzICs9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuY2VsID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoIWNhbmNlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIFByb2ZpbGVNYW5hZ2VyLkluc3RhbmNlLkFsbFtjdXJQcm9maWxlXS5jcnlzdGFscyAtPSBwdXJjaGFzZXNbcHJjaF0uY3J5c3RhbHM7XHJcbiAgICAgICAgICAgICAgICAgICAgVW5sb2NrQWNoaXZpZW1lbnQoXCJGaXJzdHB1cmNoYXNlXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBidG5Vbml0UHJlR2FtZV9DbGlja2VkKE1vbm9JbnRlcmZhY2UuQnV0dG9uIGJ0biwgYm9vbCBpc1RvdWNoKSB7XHJcbiAgICAgICAgICAgIHZhciB1bmFtZSA9IHVuaXRzUHJlR2FtZVtjVW5pdHNQcmVHYW1lLkNoaWxkcmVuLkluZGV4T2YoYnRuKV07XHJcbiAgICAgICAgICAgIGlmICghcHJlR2FtZVVuaXRzLkNvbnRhaW5zKHVuYW1lKSAmJiBwcmVHYW1lVW5pdHMuQ291bnQgKyBwcmVHYW1lU3BlbGxzLkNvdW50ICsgcHJlR2FtZUJvbnVzLkNvdW50IDwgcHJlR2FtZVNsb3RDbnQpIHtcclxuICAgICAgICAgICAgICAgIHByZUdhbWVVbml0cy5BZGQodW5hbWUpO1xyXG4gICAgICAgICAgICAgICAgcHJlR2FtZVVuaXRzID0gU29ydFVuaXRzTGlzdHMocHJlR2FtZVVuaXRzKTtcclxuICAgICAgICAgICAgICAgIFNldFByZUdhbWVMaXN0cygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBidG5TcGVsbHNQcmVHYW1lX0NsaWNrZWQoTW9ub0ludGVyZmFjZS5CdXR0b24gYnRuLCBib29sIGlzVG91Y2gpIHtcclxuICAgICAgICAgICAgdmFyIHNuYW1lID0gc3BlbGxzUHJlR2FtZVtjU3BlbGxzUHJlR2FtZS5DaGlsZHJlbi5JbmRleE9mKGJ0bildO1xyXG4gICAgICAgICAgICBpZiAoIXByZUdhbWVTcGVsbHMuQ29udGFpbnMoc25hbWUpICYmIHByZUdhbWVVbml0cy5Db3VudCArIHByZUdhbWVTcGVsbHMuQ291bnQgKyBwcmVHYW1lQm9udXMuQ291bnQgPCBwcmVHYW1lU2xvdENudCkge1xyXG4gICAgICAgICAgICAgICAgcHJlR2FtZVNwZWxscy5BZGQoc25hbWUpO1xyXG4gICAgICAgICAgICAgICAgcHJlR2FtZVNwZWxscyA9IFNvcnRTcGVsbHNMaXN0cyhwcmVHYW1lU3BlbGxzKTtcclxuICAgICAgICAgICAgICAgIFNldFByZUdhbWVMaXN0cygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBidG5CdWlsZGluZ1ByZUdhbWVfQ2xpY2tlZChNb25vSW50ZXJmYWNlLkJ1dHRvbiBidG4sIGJvb2wgaXNUb3VjaCkge1xyXG4gICAgICAgICAgICB2YXIgYm5hbWUgPSBzdGFydEJ1aWxkaW5nc0xpc3RbY0J1aWxkaW5nc1ByZUdhbWUuQ2hpbGRyZW4uSW5kZXhPZihidG4pXTtcclxuICAgICAgICAgICAgaWYgKCFwcmVHYW1lQm9udXMuQ29udGFpbnMoYm5hbWUpICYmIHByZUdhbWVVbml0cy5Db3VudCArIHByZUdhbWVTcGVsbHMuQ291bnQgKyBwcmVHYW1lQm9udXMuQ291bnQgPCBwcmVHYW1lU2xvdENudCkge1xyXG4gICAgICAgICAgICAgICAgcHJlR2FtZUJvbnVzLkFkZChibmFtZSk7XHJcbiAgICAgICAgICAgICAgICBTZXRQcmVHYW1lTGlzdHMoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgYnRuU2VsZWN0ZWRQcmVHYW1lX0NsaWNrZWQoTW9ub0ludGVyZmFjZS5CdXR0b24gYnRuLCBib29sIGlzVG91Y2gpIHtcclxuICAgICAgICAgICAgdmFyIGluZCA9IGNTZWxlY3RlZFByZUdhbWUuQ2hpbGRyZW4uSW5kZXhPZihidG4pO1xyXG4gICAgICAgICAgICBpZiAoKGluZCA8IHByZUdhbWVVbml0cy5Db3VudCkpIHtcclxuICAgICAgICAgICAgICAgIHZhciB1bmFtZSA9IHByZUdhbWVVbml0c1tpbmRdO1xyXG4gICAgICAgICAgICAgICAgcHJlR2FtZVVuaXRzLlJlbW92ZSh1bmFtZSk7XHJcbiAgICAgICAgICAgICAgICBTZXRQcmVHYW1lTGlzdHMoKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICgoaW5kIC0gcHJlR2FtZVVuaXRzLkNvdW50IDwgcHJlR2FtZVNwZWxscy5Db3VudCkpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzbmFtZSA9IHByZUdhbWVTcGVsbHNbaW5kIC0gcHJlR2FtZVVuaXRzLkNvdW50XTtcclxuICAgICAgICAgICAgICAgIHByZUdhbWVTcGVsbHMuUmVtb3ZlKHNuYW1lKTtcclxuICAgICAgICAgICAgICAgIFNldFByZUdhbWVMaXN0cygpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKChpbmQgLSBwcmVHYW1lVW5pdHMuQ291bnQgLSBwcmVHYW1lU3BlbGxzLkNvdW50IDwgcHJlR2FtZUJvbnVzLkNvdW50KSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGJuYW1lID0gcHJlR2FtZUJvbnVzW2luZCAtIHByZUdhbWVVbml0cy5Db3VudCAtIHByZUdhbWVTcGVsbHMuQ291bnRdO1xyXG4gICAgICAgICAgICAgICAgcHJlR2FtZUJvbnVzLlJlbW92ZShibmFtZSk7XHJcbiAgICAgICAgICAgICAgICBTZXRQcmVHYW1lTGlzdHMoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgYnRuVW5pdFByZUdhbWVfRm9jdXNlZChNb25vSW50ZXJmYWNlLkJ1dHRvbiBidG4sIGJvb2wgaXNUb3VjaCkge1xyXG4gICAgICAgICAgICBpZiAoKGNVbml0c1ByZUdhbWUuQ2hpbGRyZW4uQ291bnQgPT0gdW5pdHNQcmVHYW1lLkNvdW50KSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHVuYW1lID0gdW5pdHNQcmVHYW1lW2NVbml0c1ByZUdhbWUuQ2hpbGRyZW4uSW5kZXhPZihidG4pXTtcclxuICAgICAgICAgICAgICAgIFNob3dVbml0SW5mbyh1bml0UHJtc1t1bmFtZV0sIDAsIGZhbHNlLCBuZXcgUG9pbnQoKGludCkoYnRuLkZpbmFsUmlnaHQgLyBNYWluQ29udGFpbmVyLkZpbmFsQ2hpbGRyZW5TY2FsZVgpLCAoaW50KShidG4uRmluYWxCb3R0b20gLyBNYWluQ29udGFpbmVyLkZpbmFsQ2hpbGRyZW5TY2FsZVkpKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIGJ0blNwZWxsc1ByZUdhbWVfRm9jdXNlZChNb25vSW50ZXJmYWNlLkJ1dHRvbiBidG4sIGJvb2wgaXNUb3VjaCkge1xyXG4gICAgICAgICAgICBpZiAoKGNTcGVsbHNQcmVHYW1lLkNoaWxkcmVuLkNvdW50ID09IHNwZWxsc1ByZUdhbWUuQ291bnQpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc25hbWUgPSBzcGVsbHNQcmVHYW1lW2NTcGVsbHNQcmVHYW1lLkNoaWxkcmVuLkluZGV4T2YoYnRuKV07XHJcbiAgICAgICAgICAgICAgICBTaG93TW9yZUluZm8oc3BlbGxzW3NuYW1lXS5Db3N0LCBmYWxzZSwgbmV3IFBvaW50KChpbnQpKGJ0bi5GaW5hbFJpZ2h0IC8gTWFpbkNvbnRhaW5lci5GaW5hbENoaWxkcmVuU2NhbGVYKSwgKGludCkoYnRuLkZpbmFsQm90dG9tIC8gTWFpbkNvbnRhaW5lci5GaW5hbENoaWxkcmVuU2NhbGVZKSksIGxvY2FsaXplLkdldFN0cmluZyhzcGVsbHNbc25hbWVdLk5hbWUpLCBsb2NhbGl6ZS5HZXRTdHJpbmcoc3BlbGxzW3NuYW1lXS5TY2hvb2wsIHNwZWxsc1tzbmFtZV0uQ29zdC5UaWVyKSwgc3BlbGxzW3NuYW1lXS5EZXNjcmlwdGlvbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIGJ0bkJ1aWxkaW5nUHJlR2FtZV9Gb2N1c2VkKE1vbm9JbnRlcmZhY2UuQnV0dG9uIGJ0biwgYm9vbCBpc1RvdWNoKSB7XHJcbiAgICAgICAgICAgIHZhciBibmFtZSA9IHN0YXJ0QnVpbGRpbmdzTGlzdFtjQnVpbGRpbmdzUHJlR2FtZS5DaGlsZHJlbi5JbmRleE9mKGJ0bildO1xyXG4gICAgICAgICAgICBTaG93VW5pdEluZm8odW5pdFBybXNbYm5hbWVdLCAwLCBmYWxzZSwgbmV3IFBvaW50KChpbnQpKGJ0bi5GaW5hbFJpZ2h0IC8gTWFpbkNvbnRhaW5lci5GaW5hbENoaWxkcmVuU2NhbGVYKSwgKGludCkoYnRuLkZpbmFsQm90dG9tIC8gTWFpbkNvbnRhaW5lci5GaW5hbENoaWxkcmVuU2NhbGVZKSkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgYnRuU2VsZWN0ZWRQcmVHYW1lX0ZvY3VzZWQoTW9ub0ludGVyZmFjZS5CdXR0b24gYnRuLCBib29sIGlzVG91Y2gpIHtcclxuICAgICAgICAgICAgdmFyIGluZCA9IGNTZWxlY3RlZFByZUdhbWUuQ2hpbGRyZW4uSW5kZXhPZihidG4pO1xyXG4gICAgICAgICAgICBpZiAoKGluZCA8IHByZUdhbWVVbml0cy5Db3VudCkpIHtcclxuICAgICAgICAgICAgICAgIHZhciB1bmFtZSA9IHByZUdhbWVVbml0c1tpbmRdO1xyXG4gICAgICAgICAgICAgICAgU2hvd1VuaXRJbmZvKHVuaXRQcm1zW3VuYW1lXSwgMCwgZmFsc2UsIG5ldyBQb2ludCgoaW50KShidG4uRmluYWxSaWdodCAvIE1haW5Db250YWluZXIuRmluYWxDaGlsZHJlblNjYWxlWCksIChpbnQpKGJ0bi5GaW5hbEJvdHRvbSAvIE1haW5Db250YWluZXIuRmluYWxDaGlsZHJlblNjYWxlWSkpKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICgoaW5kIC0gcHJlR2FtZVVuaXRzLkNvdW50IDwgcHJlR2FtZVNwZWxscy5Db3VudCkpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzbmFtZSA9IHByZUdhbWVTcGVsbHNbaW5kIC0gcHJlR2FtZVVuaXRzLkNvdW50XTtcclxuICAgICAgICAgICAgICAgIFNob3dNb3JlSW5mbyhzcGVsbHNbc25hbWVdLkNvc3QsIHRydWUsIG5ldyBQb2ludCgoaW50KShidG4uRmluYWxSaWdodCAvIE1haW5Db250YWluZXIuRmluYWxDaGlsZHJlblNjYWxlWCksIChpbnQpKGJ0bi5GaW5hbEJvdHRvbSAvIE1haW5Db250YWluZXIuRmluYWxDaGlsZHJlblNjYWxlWSkpLCBsb2NhbGl6ZS5HZXRTdHJpbmcoc3BlbGxzW3NuYW1lXS5OYW1lKSwgbG9jYWxpemUuR2V0U3RyaW5nKHNwZWxsc1tzbmFtZV0uU2Nob29sLCBzcGVsbHNbc25hbWVdLkNvc3QuVGllci5Ub1N0cmluZygpKSwgc3BlbGxzW3NuYW1lXS5EZXNjcmlwdGlvbik7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoKGluZCAtIHByZUdhbWVVbml0cy5Db3VudCAtIHByZUdhbWVTcGVsbHMuQ291bnQgPCBwcmVHYW1lQm9udXMuQ291bnQpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYm5hbWUgPSBwcmVHYW1lQm9udXNbaW5kIC0gcHJlR2FtZVVuaXRzLkNvdW50IC0gcHJlR2FtZVNwZWxscy5Db3VudF07XHJcbiAgICAgICAgICAgICAgICBTaG93VW5pdEluZm8odW5pdFBybXNbYm5hbWVdLCAwLCBmYWxzZSwgbmV3IFBvaW50KChpbnQpKGJ0bi5GaW5hbFJpZ2h0IC8gTWFpbkNvbnRhaW5lci5GaW5hbENoaWxkcmVuU2NhbGVYKSwgKGludCkoYnRuLkZpbmFsQm90dG9tIC8gTWFpbkNvbnRhaW5lci5GaW5hbENoaWxkcmVuU2NhbGVZKSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBEb1VuaXRzU3BlbGxzKHN0cmluZyBuYW1lLCBMaXN0PFVuaXQ+IHRyZ3MpIHtcclxuICAgICAgICAgICAgYm9vbCBjYW5jZWwgPSB0cnVlO1xyXG4gICAgICAgICAgICBmb3JlYWNoIChVbml0IHRyZyBpbiB0cmdzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodHJnLnBhcmFtZXRlcnMuaXNCdWlsZGluZykge1xyXG4gICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwi0J3QtSDRgdGD0YnQtdGB0YLQstC+XCIsIGJhZEFiaWxDbHIsIHRyZy54LCBob3IgKyB0cmcucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodHJnLkFic0NvbnRhaW5zKFwiU3BlbGxwcm9vZlwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwi0JfQsNGJ0LjRgtCwINC+0YIg0LzQsNCz0LjQuFwiLCBiYWRBYmlsQ2xyLCB0cmcueCwgaG9yICsgdHJnLnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKG5hbWUgPT0gXCJNYWdpY19hcm1vclwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRyZy5BYnNDb250YWlucyhcIkludnVsbmVyYWJsZVwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCj0LbQtSDQt9Cw0YnQuNGJ0LXQvVwiLCBiYWRBYmlsQ2xyLCB0cmcueCwgaG9yICsgdHJnLnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAobmFtZSA9PSBcIkRhcmtfYXJyb3dcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0cmcuQWJzQ29udGFpbnMoXCJNYWNoaW5lcnlcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCLQndC10LvRjNC30Y8g0LTQvtCx0LjRgtGMINC80LXRhdCw0L3QuNC30LxcIiwgYmFkQWJpbENsciwgdHJnLngsIGhvciArIHRyZy5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0cmcuQWJzQ29udGFpbnMoXCJCb2R5bGVzc1wiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCd0LXQu9GM0LfRjyDQtNC+0LHQuNGC0Ywg0LHQtdGB0YLQtdC70LXRgdC90L7Qs9C+XCIsIGJhZEFiaWxDbHIsIHRyZy54LCBob3IgKyB0cmcucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodHJnLmhwID4gMjAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwi0KHQu9C40YjQutC+0Lwg0LzQvdC+0LPQviDQt9C00L7RgNC+0LLRjNGPXCIsIGJhZEFiaWxDbHIsIHRyZy54LCBob3IgKyB0cmcucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChuYW1lID09IFwiT2JsaXZpb25cIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0cmcuQWJzQ29udGFpbnMoXCJQdXJpZmllZFwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCj0LbQtSDQu9C40YjQtdC9XCIsIGJhZEFiaWxDbHIsIHRyZy54LCBob3IgKyB0cmcucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodHJnLkFic0NvbnRhaW5zKFwiRXRlcm5hbFwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCX0LDRidC40YnQtdC9INC+0YIg0LvQuNGI0LXQvdC40Y8g0YHQv9C+0YHQvtCx0L3QvtGB0YLQtdC5XCIsIGJhZEFiaWxDbHIsIHRyZy54LCBob3IgKyB0cmcucGFyYW1ldGVycy5yZWN0LlRvcCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjYW5jZWwgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKG5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiSGVhbFwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIZWFsKHRyZywgdHJnLnBhcmFtZXRlcnMubWF4aHApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkhhc3RlXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZy5wYXJhbWV0ZXJzLlNwZWVkID0gXCJWZXJ5X2Zhc3RcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZy5BZGRBYmlsaXR5KFwiQWdpbGl0eVwiLCAyMCwgRWZmZWN0VHlwZS5Hb29kKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJXZWFrbmVzc1wiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmcucGFyYW1ldGVycy5TcGVlZCA9IFwiU2xvd1wiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJnLkFkZEFiaWxpdHkoXCJDbHVtc2luZXNzXCIsIEVmZmVjdFR5cGUuQmFkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJSZXNjdWVcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJnLnggPSBwbHJzW3RyZy5vd25lcl0uYmFzZVggKyB0cmcubW92ZXNpZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiR2hvc3RfbW9kZVwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmcuQWRkQWJpbGl0eShcIlVuZGVhZFwiLCBFZmZlY3RUeXBlLkdvb2QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJnLkFkZEFiaWxpdHkoXCJCb2R5bGVzc1wiLCBFZmZlY3RUeXBlLkdvb2QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJnLlJlbW92ZUFiaWwoXCJQb2lzb25cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiVGhlX0NvdmVuYW50XCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuaXRzWzEgLSB0cmcub3duZXJdLmhwIC09IHRyZy5ocDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwiLVwiICsgdHJnLmhwLlRvU3RyaW5nKCksIGJhZEFiaWxDbHIsIHVuaXRzWzEgLSB0cmcub3duZXJdLngsIGhvciArIHVuaXRzWzEgLSB0cmcub3duZXJdLnBhcmFtZXRlcnMucmVjdC5Ub3AsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEtpbGwodHJnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJNYWdpY19hcnJvd1wiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIYXJtKHRyZywgcm5kLk5leHQoMTAwLCAxNTEpLCB0cnVlLCBFZmZlY3RUeXBlLkJhZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiUG9seW1vcnBoXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBhbGx1bml0c3QgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgdTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKFVuaXRQYXJhbWV0ZXJzIHVwIGluIHVuaXRQcm1zLlZhbHVlcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdXAuc3BlY2lhbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXAuQ29zdC5UaWVyID09IHRyZy5wYXJhbWV0ZXJzLkNvc3QuVGllciAmJiBwbHJzW3RyZy5vd25lcl0uQ2hlY2tGb3JMaW1pdCh1cC5OYW1lKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsbHVuaXRzdC5BZGQodXAuTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFsbHVuaXRzdC5Db3VudCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1ID0gcm5kLk5leHQoMCwgYWxsdW5pdHN0LkNvdW50KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmcuU2V0UGFyYW1zKHVuaXRQcm1zW2FsbHVuaXRzdFt1XV0sIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZy5wdXJpZmllZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZy50YWtlZE9mZiA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZy5sYW5kaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCLQndC10YIg0L/QvtC00YXQvtC00Y/RidC40YUg0YHRg9GJ0LXRgdGC0LJcIiwgYmFkQWJpbENsciwgdHJnLngsIGhvciArIHRyZy5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiRGFya19hcnJvd1wiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBLaWxsKHRyZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gYWxsdW5pdHN0ID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IHU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChVbml0UGFyYW1ldGVycyB1cCBpbiB1bml0UHJtcy5WYWx1ZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXVwLnNwZWNpYWwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVwLkNvc3QuVGllciA9PSB0cmcucGFyYW1ldGVycy5Db3N0LlRpZXIgJiYgdXAuQWJzQ29udGFpbnMoXCJVbmRlYWRcIikgJiYgcGxyc1swXS5DaGVja0ZvckxpbWl0KHVwLk5hbWUpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxsdW5pdHN0LkFkZCh1cC5OYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWxsdW5pdHN0LkNvdW50ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUgPSBybmQuTmV4dCgwLCBhbGx1bml0c3QuQ291bnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvcm5MaXN0LkFkZChuZXcgVW5pdCh0aGlzLCB0cmcueCwgMSwgMCwgdW5pdFBybXNbYWxsdW5pdHN0W3VdXSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCLQndC10YIg0L/QvtC00YXQvtC00Y/RidC40YUg0YHRg9GJ0LXRgdGC0LJcIiwgYmFkQWJpbENsciwgdHJnLngsIGhvciArIHRyZy5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJUcmFuc211dGF0aW9uXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBhbGx1bml0c3QgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgdTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKFVuaXRQYXJhbWV0ZXJzIHVwIGluIHVuaXRQcm1zLlZhbHVlcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdXAuc3BlY2lhbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXAuQ29zdC5UaWVyID09IHRyZy5wYXJhbWV0ZXJzLkNvc3QuVGllciArIDEgJiYgdXAuUmFjZSA9PSB0cmcucGFyYW1ldGVycy5SYWNlICYmIHBscnNbMF0uQ2hlY2tGb3JMaW1pdCh1cC5OYW1lKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsbHVuaXRzdC5BZGQodXAuTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFsbHVuaXRzdC5Db3VudCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1ID0gcm5kLk5leHQoMCwgYWxsdW5pdHN0LkNvdW50KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmcuU2V0UGFyYW1zKHVuaXRQcm1zW2FsbHVuaXRzdFt1XV0sIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHJnLmhwID4gdHJnLnBhcmFtZXRlcnMubWF4aHApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZy5ocCA9IHRyZy5wYXJhbWV0ZXJzLm1heGhwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZy5wdXJpZmllZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZy50YWtlZE9mZiA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZy5sYW5kaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoXCLQndC10YIg0L/QvtC00YXQvtC00Y/RidC40YUg0YHRg9GJ0LXRgdGC0LJcIiwgYmFkQWJpbENsciwgdHJnLngsIGhvciArIHRyZy5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiR29vZ2xlaGFtbWVyXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZy5BZGRBYmlsaXR5KFwiTWFnZVwiLCBFZmZlY3RUeXBlLkdvb2QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRyZy5wYXJhbWV0ZXJzLkF0dGFjay5SYW5nZSA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJnLnBhcmFtZXRlcnMuQXR0YWNrLlJhbmdlID0gMztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmcucGFyYW1ldGVycy5hbW1vVHlwZSA9IEFtbW8uQW1tb1R5cGUuSGFtbWVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0cmcucGFyYW1ldGVycy5BdHRhY2suU3BlZWQgPCA2MClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJnLnBhcmFtZXRlcnMuQXR0YWNrLlNwZWVkID0gNjA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIk1hZ2ljX2FybW9yXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZy5BZGRBYmlsaXR5KFwiSW52dWxuZXJhYmxlXCIsIDQwMCwgRWZmZWN0VHlwZS5Hb29kKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJPYmxpdmlvblwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmcucHVyaWZpZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCFjYW5jZWwpIHtcclxuICAgICAgICAgICAgICAgIFNwZWxsQ29tcGxldGUobmFtZSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBEb0dsb2JhbFNwZWxscyhzdHJpbmcgbmFtZSkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKG5hbWUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJFYXJ0aHF1YWtlXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoVW5pdCB1IGluIHVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodS5wYXJhbWV0ZXJzLmlzQnVpbGRpbmcgJiYgIXUuQWJzQ29udGFpbnMoXCJTcGVsbHByb29mXCIpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhhcm0odSwgcm5kLk5leHQoMjUwLCA1MDEpLCB0cnVlLCBFZmZlY3RUeXBlLkJhZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiTWFuYV9ibGFzdFwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKFVuaXQgdSBpbiB1bml0cykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUuQWJzQ29udGFpbnMoXCJNYWdlXCIpICYmICF1LkFic0NvbnRhaW5zKFwiU3BlbGxwcm9vZlwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEV4cGxvZGUodSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUucGFyYW1ldGVycy5Bcm1vciAhPSBcIk5vbmVcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdS5wYXJhbWV0ZXJzLkFybW9yID0gXCJOb25lXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiU3Rvcm1cIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChVbml0IHUgaW4gdW5pdHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1Lm93bmVyICE9IDAgJiYgIXUucGFyYW1ldGVycy5pc0J1aWxkaW5nICYmIHUucGFyYW1ldGVycy5tb3ZlVHlwZSA9PSBVbml0TW92ZVR5cGUuRmx5aW5nTVQgJiYgIXUuQWJzQ29udGFpbnMoXCJTcGVsbHByb29mXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSGFybSh1LCBybmQuTmV4dCg3MCwgMTAxKSwgZmFsc2UsIEVmZmVjdFR5cGUuQmFkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1LmxhbmRpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSBcIk1hc3NfcG9seW1vcnBoXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IGFsbHVuaXRzdCA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW50IHU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKFVuaXQgdXUgaW4gdW5pdHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdXUucGFyYW1ldGVycy5pc0J1aWxkaW5nICYmICF1dS5BYnNDb250YWlucyhcIlNwZWxscHJvb2ZcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGx1bml0c3QuQ2xlYXIoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChVbml0UGFyYW1ldGVycyB1cCBpbiB1bml0UHJtcy5WYWx1ZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF1cC5zcGVjaWFsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXAuQ29zdC5UaWVyID09IHV1LnBhcmFtZXRlcnMuQ29zdC5UaWVyICYmIHBscnNbdXUub3duZXJdLkNoZWNrRm9yTGltaXQodXAuTmFtZSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxsdW5pdHN0LkFkZCh1cC5OYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWxsdW5pdHN0LkNvdW50ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1ID0gcm5kLk5leHQoMCwgYWxsdW5pdHN0LkNvdW50KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXUuU2V0UGFyYW1zKHVuaXRQcm1zW2FsbHVuaXRzdFt1XV0sIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dS5wdXJpZmllZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dS50YWtlZE9mZiA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dS5sYW5kaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSBcIkphY2twb3RcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gYWxsc3BlbGxzID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChzdHJpbmcgc3BsIGluIHNwZWxscy5LZXlzKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxsc3BlbGxzLkFkZChzcGwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwbHJzWzBdLnNwbGxzTGlzdCA9IFJhbmRvbWl6ZVNwZWxscyhwbHJzWzBdLnNwbGxzTGlzdC5Db3VudCwgYWxsc3BlbGxzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlU3BlbGxzID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgXCJBcnJvd3JhaW5cIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChVbml0IHV1IGluIHVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXUub3duZXIgPT0gMSAmJiAhKHV1LnBhcmFtZXRlcnMuTmFtZSA9PSBwbHJzWzFdLmhlcm8pKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtbW9zLkFkZChuZXcgQW1tbygwLCBBbW1vLkFtbW9UeXBlLkFycm93LCAtdXMyLCBob3IsIG51bGwsIHV1LCBwbHJzWzBdLnVDb3VudCAqIHJuZC5OZXh0KDUsIDExKSwgZmFsc2UsIGZhbHNlLCA3MjAwKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiUG9pc29uX3dhdmVcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChVbml0IHV1IGluIHVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXV1LkFic0NvbnRhaW5zKFwiU3BlbGxwcm9vZlwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1dS5BYnNDb250YWlucyhcIlBvaXNvblwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dS5SZW1vdmVBYmlsKFwiUG9pc29uXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXUub3duZXIgPT0gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhlYWwodXUsIHJuZC5OZXh0KDcwLCAxMDEpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodXUub3duZXIgPT0gMSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhhcm0odXUsIHJuZC5OZXh0KDcwLCAxMDEpLCB0cnVlLCBFZmZlY3RUeXBlLlBvaXNvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgU3BlbGxDb21wbGV0ZShuYW1lKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBTcGVsbENvbXBsZXRlKHN0cmluZyBuYW1lKSB7XHJcbiAgICAgICAgICAgIHBscnNbMF0uUmVzb3VyY2VzID0gcGxyc1swXS5SZXNvdXJjZXMgLSBzcGVsbHNbbmFtZV0uQ29zdDtcclxuICAgICAgICAgICAgcGxyc1swXS5zcGVsbHNSY2hyZ1twbHJzWzBdLnNwbGxzTGlzdC5JbmRleE9mKG5hbWUpXSA9IHNwZWxsc1tuYW1lXS5Db3N0LlRpbWU7XHJcbiAgICAgICAgICAgIFNob3dJbmZvUGFyKGxvY2FsaXplLkdldFN0cmluZyhuYW1lKSwgZ29vZEFiaWxDbHIsIGdhbWVXaWR0aCAvIDIsIGdhbWVIZWlnaHQgLyAyLCB0cnVlLCB0cnVlKTtcclxuICAgICAgICAgICAgZm9yZWFjaCAoVW5pdCB1dSBpbiB1bml0cykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHV1LkFic0NvbnRhaW5zKFwiQW50aW1hZ2VcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICB1dS5BdHRhY2sgKz0gdXUuYWJpbHNbXCJBbnRpbWFnZVwiXS52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCc0LDQs9C40Y8hXCIsIGdvb2RBYmlsQ2xyLCB1dS54LCBob3IgKyB1dS5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh1dS5BYnNDb250YWlucyhcIk1hZ2ljX3Bvd2VyXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdXUucGFyYW1ldGVycy5BdHRhY2suUmFuZ2UgKz0gMTtcclxuICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCc0LDQs9C40Y8hXCIsIGdvb2RBYmlsQ2xyLCB1dS54LCBob3IgKyB1dS5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSB2b2lkIE1vdXNlQ2xpY2tlZChWZWN0b3IyIHBvcywgYm9vbCBpc1RvdWNoID0gZmFsc2UpIHtcclxuICAgICAgICAgICAgaWYgKHNlbFUgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHNlbFUgPSBudWxsO1xyXG4gICAgICAgICAgICBNYWluQ29udGFpbmVyLkNsaWNrQnV0dG9uKChpbnQpcG9zLlgsIChpbnQpcG9zLlksIGlzVG91Y2gpO1xyXG4gICAgICAgICAgICBpZiAoZ1N0YXRlID09IEdhbWVTdGF0ZS5JbkdhbWUpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXNwb3MgPSBuZXcgVmVjdG9yMihwb3MuWCAqIChmbG9hdClzY2FsZVgsIHBvcy5ZICogKGZsb2F0KXNjYWxlWSk7XHJcblxyXG4gICAgICAgICAgICAgICAgTGlzdDxVbml0PiB0cmdzID0gbmV3IExpc3Q8VW5pdD4oKTtcclxuICAgICAgICAgICAgICAgIGZvcmVhY2ggKFVuaXQgdSBpbiB1bml0cykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1LnggKyB1LnBhcmFtZXRlcnMucmVjdC5SaWdodCA+IHJlc3Bvcy5YICYmIHJlc3Bvcy5YID4gdS54ICsgdS5wYXJhbWV0ZXJzLnJlY3QuTGVmdCAmJiBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Cb3R0b20gPiByZXNwb3MuWSAmJiByZXNwb3MuWSA+IGhvciArIHUucGFyYW1ldGVycy5yZWN0LlRvcCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodS5vd25lciA9PSAxIHx8ICF1LkFic0NvbnRhaW5zKFwiSW52aXNpYmxlXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxVID0gdTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZ3MuQWRkKHUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGluU3BlbGxNb2RlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKERvVW5pdHNTcGVsbHMoc3BlbGxOYW1lLCB0cmdzKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5TcGVsbE1vZGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSB2b2lkIEFkZFRvUmVhZHlVbml0cyhQbGF5ZXIgcGxyLCBzdHJpbmcgdW5pdE5hbWUpIHtcclxuICAgICAgICAgICAgdmFyIHVuaXRSZXMgPSB1bml0TmFtZTtcclxuICAgICAgICAgICAgaWYgKHVuaXRQcm1zW3VuaXROYW1lXS5BYnNDb250YWlucyhcIkNyb3dkXCIpKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodW5pdFBybXNbdW5pdE5hbWVdLkFic0NvbnRhaW5zKFwiQ3Jvd2QyXCIpICYmIHBsci5yZXMuVGllciA9PSAyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJuZC5OZXh0RG91YmxlKCkgPCAwLjUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVuaXRSZXMgPSBcIlNrZWxldG9uX2FyY2hlclwiO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJuZC5OZXh0RG91YmxlKCkgPCAwLjgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVuaXRSZXMgPSBcIlNrZWxldG9uX3dhcnJpb3JcIjtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVuaXRSZXMgPSBcIlNrZWxldG9uX2tuaWdodFwiO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChybmQuTmV4dERvdWJsZSgpIDwgMC41KVxyXG4gICAgICAgICAgICAgICAgICAgIHVuaXRSZXMgPSBcIlNrZWxldG9uX2FyY2hlclwiO1xyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHVuaXRSZXMgPSBcIlNrZWxldG9uX3dhcnJpb3JcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBwbHIucmVhZHlVbml0cy5BZGQodW5pdFJlcyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgZXZlbnQgT25FeGl0RXZlbnRIYW5kbGVyIE9uRXhpdDtcclxuXHJcbiAgICAgICAgcHVibGljIGRlbGVnYXRlIHZvaWQgT25FeGl0RXZlbnRIYW5kbGVyKCk7XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbTtcclxudXNpbmcgTWljcm9zb2Z0LlhuYS5GcmFtZXdvcms7XHJcbnVzaW5nIE1pY3Jvc29mdC5YbmEuRnJhbWV3b3JrLkdyYXBoaWNzO1xyXG51c2luZyBNaWNyb3NvZnQuWG5hLkZyYW1ld29yay5JbnB1dDtcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcblxyXG5uYW1lc3BhY2UgRGFya0tpbmdkb21Db3JlIHtcclxuICAgIHB1YmxpYyBwYXJ0aWFsIGNsYXNzIE15R2FtZSB7XHJcbiAgICAgICAgcHVibGljIE1vbm9JbnRlcmZhY2UuV2luZG93IE1haW5Db250YWluZXI7XHJcblxyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5BbmltYXRvciBtYWluQW5pbWF0b3I7XHJcblxyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5UaGVtZSBkZWZhdWx0VGhlbWU7XHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLlRoZW1lIGJhY2tUaGVtZTtcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkZyYW1lIGZybUNvbmZpcm07XHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkxhYmVsIGxibFRleHRGcm1Db25maXJtO1xyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5CdXR0b24gYnRuT2theUZybURpYWxvZ0NvbmZpcm07XHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkJ1dHRvbiBidG5Ob3BlRnJtRGlhbG9nQ29uZmlybTtcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkZyYW1lIGZybVNldHRpbmdzIHsgZ2V0OyBzZXQ7IH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLlN3aXRjaGVyIHJlc1N3aXRjaGVyRnJtU2V0dGluZ3MgeyBnZXQ7IHNldDsgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBEcmF3SW50ZXJmYWNlKFNwcml0ZUJhdGNoIHNiKSB7XHJcbiAgICAgICAgICAgIE1haW5Db250YWluZXIuRHJhdyhzYiwgMS4wZik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuRnJhbWUgZnJtTWFpbk1lbnU7XHJcbnB1YmxpYyB2b2lkIGJhdHRsZUZybU1haW5NZW51KE1vbm9JbnRlcmZhY2UuQnV0dG9uIGJ0biwgYm9vbCBpc1RvdWNoKVxyXG57XHJcbiAgICBTdGFydEJhdHRsZSgpO1xyXG59cHVibGljIHZvaWQgcHJvZmlsZUZybU1haW5NZW51KE1vbm9JbnRlcmZhY2UuQnV0dG9uIGJ0biwgYm9vbCBpc1RvdWNoKVxyXG57XHJcbiAgICBTdGFydFByb2ZpbGUoKTtcclxufVxyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5GcmFtZSBmcm1CYXR0bGVNZW51O1xyXG5cclxuICAgICAgICBwdWJsaWMgYXN5bmMgdm9pZCBzdXJyZW5kZXJGcm1CYXR0bGVNZW51X0NsaWNrZWQoTW9ub0ludGVyZmFjZS5CdXR0b24gYnRuLCBib29sIGlzVG91Y2gpIHtcclxuICAgICAgICAgICAgZnJtQmF0dGxlTWVudS5IaWRlKG1haW5BbmltYXRvcik7XHJcblxyXG4gICAgICAgICAgICBpZiAoYXdhaXQgU2hvd0RpYWxvZ0NvbmZpcm1hdGlvbihcItGH0YLQviDRhdC+0YLQuNGC0LUg0YHQtNCw0YLRjNGB0Y8/XCIpKSB7XHJcbiAgICAgICAgICAgICAgICBnU3RhdGUgPSBHYW1lU3RhdGUuTG9zZTtcclxuICAgICAgICAgICAgICAgIEVuZE9mQmF0dGxlKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZVxyXG4gICAgICAgICAgICAgICAgZnJtQmF0dGxlTWVudS5TaG93KG1haW5BbmltYXRvcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgYXN5bmMgdm9pZCByZXN0YXJ0RnJtQmF0dGxlTWVudV9DbGlja2VkKE1vbm9JbnRlcmZhY2UuQnV0dG9uIGJ0biwgYm9vbCBpc1RvdWNoKSB7XHJcbiAgICAgICAgICAgIGZybUJhdHRsZU1lbnUuSGlkZShtYWluQW5pbWF0b3IpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGF3YWl0IFNob3dEaWFsb2dDb25maXJtYXRpb24oXCLRh9GC0L4g0YXQvtGC0LjRgtC1INC90LDRh9Cw0YLRjCDQt9Cw0L3QvtCy0L4/XCIpKVxyXG4gICAgICAgICAgICAgICAgU3RhcnRBZ2FpbigpO1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICBmcm1CYXR0bGVNZW51LlNob3cobWFpbkFuaW1hdG9yKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEFJRnJtQmF0dGxlTWVudV9DbGlja2VkKE1vbm9JbnRlcmZhY2UuQnV0dG9uIGJ0biwgYm9vbCBpc190b3VjaCkge1xyXG4gICAgICAgICAgICBTZXRQbGF5ZXJBSSghcGxyc1swXS5BSSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBiYWNrRnJtQmF0dGxlTWVudV9DbGlja2VkKE1vbm9JbnRlcmZhY2UuQnV0dG9uIGJ0biwgYm9vbCBpc1RvdWNoKSB7XHJcbiAgICAgICAgICAgIFBhdXNlID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuTGFiZWwgbGJsQUlGcm1CYXR0bGVNZW51O1xyXG5cclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuRnJhbWUgZnJtUmlnaHRNZW51O1xyXG5cclxuICAgICAgICBwdWJsaWMgYXN5bmMgdm9pZCBleGl0RnJtTWVudUV4aXRfQ2xpY2tlZChNb25vSW50ZXJmYWNlLkJ1dHRvbiBidG4sIGJvb2wgaXNUb3VjaCkge1xyXG4gICAgICAgICAgICBpZiAoYXdhaXQgU2hvd0RpYWxvZ0NvbmZpcm1hdGlvbihcItGH0YLQviDRhdC+0YLQuNGC0LUg0LLRi9C50YLQuCDQuNC3INC40LPRgNGLP1wiKSlcclxuICAgICAgICAgICAgICAgIE9uRXhpdCE9bnVsbD9nbG9iYWw6OkJyaWRnZS5TY3JpcHQuRnJvbUxhbWJkYSgoKT0+T25FeGl0Lkludm9rZSgpKTpudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSB2b2lkIHNldHRpbmdzRnJtTWVudUV4aXRfQ2xpY2tlZChNb25vSW50ZXJmYWNlLkJ1dHRvbiBidG4sIGJvb2wgaXNUb3VjaCkge1xyXG4gICAgICAgICAgICBmcm1TZXR0aW5ncy5TaG93KG1haW5BbmltYXRvcik7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkZyYW1lIGZybURpYWxvZztcclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgb2theUZybURpYWxvZ19DbGlja2VkKE1vbm9JbnRlcmZhY2UuQnV0dG9uIGJ0biwgYm9vbCBpc1RvdWNoKSB7XHJcbiAgICAgICAgICAgIENsZWFyVmFyc0FuZENhbGNFYXJuZWQoKTtcclxuICAgICAgICAgICAgSGlkZVNvbWVDaGlsZHJlbihmcm1SZXNvdXJjZXMsIGZybVVuaXRzLCBmcm1Qcm9kdWN0aW9uKTtcclxuICAgICAgICAgICAgU2hvd1NvbWVDaGlsZHJlbihmcm1NYWluTWVudSwgZnJtUmlnaHRNZW51KTtcclxuICAgICAgICAgICAgZnJtRGlhbG9nLkhpZGUobWFpbkFuaW1hdG9yKTtcclxuICAgICAgICAgICAgU3RhcnRCYXR0bGUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5MYWJlbCBsYmxUaXRsZWZybURpYWxvZztcclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuTGFiZWwgbGJsTGluZTFGcm1EaWFsb2c7XHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkxhYmVsIGxibExpbmUyRnJtRGlhbG9nO1xyXG5cclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuRnJhbWUgZnJtUmVzb3VyY2VzO1xyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBwYXVzZUZybVJlc291cmNlc19DbGlja2VkKE1vbm9JbnRlcmZhY2UuQnV0dG9uIGJ0biwgYm9vbCBpc1RvdWNoKSB7XHJcbiAgICAgICAgICAgIGlmIChnU3RhdGUgPT0gR2FtZVN0YXRlLkluR2FtZSlcclxuICAgICAgICAgICAgICAgIFBhdXNlID0gIVBhdXNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgdGllclVwRnJtUmVzb3VyY2VzX0NsaWNrZWQoTW9ub0ludGVyZmFjZS5CdXR0b24gYnRuLCBib29sIGlzVG91Y2gpIHtcclxuICAgICAgICAgICAgc3RyaW5nIHRpZXI7XHJcbiAgICAgICAgICAgIGlmICgocGxyc1swXS5yZXMuVGllciA9PSAxKSlcclxuICAgICAgICAgICAgICAgIHRpZXIgPSBcIlRpZXJfMlwiO1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB0aWVyID0gXCJUaWVyXzNcIjtcclxuICAgICAgICAgICAgVHJ5QWRkVG9RdWV1ZVVuaXQocGxyc1swXSwgdGllcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCB0aWVyVXBGcm1SZXNvdXJjZXNfRm9jdXNlZChNb25vSW50ZXJmYWNlLkJ1dHRvbiBidG4sIGJvb2wgaXNUb3VjaCkge1xyXG4gICAgICAgICAgICBzdHJpbmcgdGllcjtcclxuICAgICAgICAgICAgaWYgKChwbHJzWzBdLnJlcy5UaWVyID09IDEpKVxyXG4gICAgICAgICAgICAgICAgdGllciA9IFwiVGllcl8yXCI7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHRpZXIgPSBcIlRpZXJfM1wiO1xyXG4gICAgICAgICAgICBTaG93TW9yZUluZm8odW5pdFBybXNbdGllcl0uQ29zdCwgdHJ1ZSwgZGVmYXVsdChQb2ludCksIGxvY2FsaXplLkdldFN0cmluZyh1bml0UHJtc1t0aWVyXS5OYW1lKSwgXCJcIiwgdW5pdFBybXNbdGllcl0uRGVzY3JpcHRpb24pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLlBpY3R1cmUgcGN0VGllckZybVJlc291cmNlcztcclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuUGljdHVyZSBwY3RQYXVzZUZybVJlc291cmNlcztcclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuTGFiZWwgbGJsR29sZEZybVJlc291cmNlcztcclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuTGFiZWwgbGJsRGVhdGhGcm1SZXNvdXJjZXM7XHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkJ1dHRvbiBidG5UaWVyVXBGcm1SZXNvdXJjZXM7XHJcblxyXG5cclxuICAgICAgICBwcml2YXRlIExpc3Q8TW9ub0ludGVyZmFjZS5MYWJlbD4gbGJsc0ZybUN1c3RvbVJhY2VzTGlzdDtcclxuICAgICAgICBwcml2YXRlIExpc3Q8TW9ub0ludGVyZmFjZS5CdXR0b24+IGJ0bnNGcm1DdXN0b21SYWNlc0xpc3Q7XHJcblxyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5GcmFtZSBmcm1Qcm9maWxlO1xyXG5cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBMaXN0PE1vbm9JbnRlcmZhY2UuTGFiZWw+IGxibHNmcm1Qcm9maWxlO1xyXG5cclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuRnJhbWUgZnJtQmFjaztcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkZyYW1lIGZybUJhdHRsZTtcclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgYnRuU3RhcnRCYXR0bGUoTW9ub0ludGVyZmFjZS5CdXR0b24gYnRuLCBib29sIGlzVG91Y2gpIHtcclxuICAgICAgICAgICAgU3RhcnRQcmVHYW1lKCk7XHJcbiAgICAgICAgICAgIGZybUJhdHRsZS5IaWRlKG1haW5BbmltYXRvcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuU3dpdGNoZXIgcmFjZXMxU3dpdGNoZXJGcm1CYXR0bGU7XHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLlN3aXRjaGVyIHJhY2VzMlN3aXRjaGVyRnJtQmF0dGxlO1xyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5Td2l0Y2hlciBtb2RlU3dpdGNoZXJGcm1CYXR0bGU7XHJcblxyXG5cclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuRnJhbWUgZnJtVW5pdHM7XHJcblxyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5GcmFtZSBmcm1Qcm9kdWN0aW9uO1xyXG5cclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuUHJvZ3Jlc3NbXSBwcmdzUHJvZHVjdGlvbiA9IG5ldyBNb25vSW50ZXJmYWNlLlByb2dyZXNzWzddO1xyXG5cclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuRnJhbWUgZnJtUHJlR2FtZTtcclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIGJ0blByb2R1Y3Rpb25fQ2xpY2tlZChNb25vSW50ZXJmYWNlLkJ1dHRvbiBidG4sIGJvb2wgaXNUb3VjaCkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJ0bnNQcm9kdWN0aW9uLkxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYnRuID09IGJ0bnNQcm9kdWN0aW9uW2ldKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGkgPCBwbHJzWzBdLnJlYWR5VW5pdHMuQ291bnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgUHJvZHVjZVVuaXQoMCwgcGxyc1swXS5yZWFkeVVuaXRzW2ldKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGxyc1swXS5yZWFkeVVuaXRzLlJlbW92ZUF0KGkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBVcGRhdGVRdWV1ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGkgLSBwbHJzWzBdLnJlYWR5VW5pdHMuQ291bnQgPCBwbHJzWzBdLnByZFEuQ291bnQgJiYgaXNUb3VjaCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwbHJzWzBdLlJlc291cmNlcyArPSB1bml0UHJtc1twbHJzWzBdLnByZFFbaSAtIHBscnNbMF0ucmVhZHlVbml0cy5Db3VudF1dLkNvc3Q7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFJlbW92ZUZyb21RdWV1ZSgwLCBpIC0gcGxyc1swXS5yZWFkeVVuaXRzLkNvdW50KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBidG5Qcm9kdWN0aW9uUmVtb3ZlX0NsaWNrZWQoTW9ub0ludGVyZmFjZS5CdXR0b24gYnRuLCBib29sIGlzVG91Y2gpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBidG5zUHJvZHVjdGlvbi5MZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGJ0bi5QYXJlbnQgPT0gYnRuc1Byb2R1Y3Rpb25baV0pIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaSAtIHBscnNbMF0ucmVhZHlVbml0cy5Db3VudCA8IHBscnNbMF0ucHJkUS5Db3VudCAmJiAhaXNUb3VjaCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwbHJzWzBdLlJlc291cmNlcyArPSB1bml0UHJtc1twbHJzWzBdLnByZFFbaSAtIHBscnNbMF0ucmVhZHlVbml0cy5Db3VudF1dLkNvc3Q7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFJlbW92ZUZyb21RdWV1ZSgwLCBpIC0gcGxyc1swXS5yZWFkeVVuaXRzLkNvdW50KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBidG5Qcm9kdWN0aW9uX0ZvY3VzZWQoTW9ub0ludGVyZmFjZS5CdXR0b24gYnRuLCBib29sIGlzVG91Y2gpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBidG5zUHJvZHVjdGlvbi5MZW5ndGg7IGkrKykge1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChidG4gPT0gYnRuc1Byb2R1Y3Rpb25baV0pIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaSA8IHBscnNbMF0ucmVhZHlVbml0cy5Db3VudClcclxuICAgICAgICAgICAgICAgICAgICAgICAgU2hvd1VuaXRJbmZvKHVuaXRQcm1zW3BscnNbMF0ucmVhZHlVbml0c1tpXV0sIDAsIGZhbHNlLCBuZXcgUG9pbnQoYnRuLkZpbmFsUmlnaHQsIGJ0bi5GaW5hbEJvdHRvbSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGkgLSBwbHJzWzBdLnJlYWR5VW5pdHMuQ291bnQgPCBwbHJzWzBdLnByZFEuQ291bnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnRuLkNoaWxkcmVuWzJdLlZpc2libGUgPSAhaXNUb3VjaDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgU2hvd1VuaXRJbmZvKHVuaXRQcm1zW3BscnNbMF0ucHJkUVtpIC0gcGxyc1swXS5yZWFkeVVuaXRzLkNvdW50XV0sIDAsIGZhbHNlLCBuZXcgUG9pbnQoYnRuLkZpbmFsUmlnaHQsIGJ0bi5GaW5hbEJvdHRvbSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkJ1dHRvbltdIGJ0bnNQcm9kdWN0aW9uID0gbmV3IE1vbm9JbnRlcmZhY2UuQnV0dG9uWzddO1xyXG5cclxuICAgICAgICBwdWJsaWMgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlIFRleHR1cmVUb0FwcChUZXh0dXJlMkQgdGV4KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIGNvbG9ycyA9IG5ldyBDb2xvclsxXTtcclxuICAgICAgICAgICAgdGV4LkdldERhdGE8Q29sb3I+KGNvbG9ycyk7XHJcbiAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKGNvbG9yc1swXSk7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKG5ldyBNb25vSW50ZXJmYWNlLlNwcml0ZSgpIHsgVGV4dHVyZSA9IHRleCwgVyA9IDEsIEggPSAxIH0sIDApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgQ3JlYXRlSW50ZXJmYWNlVGV4dXJlcygpIHtcclxuICAgICAgICAgICAgZGVmYXVsdFRoZW1lLkVtcHR5VGV4dHVyZSA9IE1vbm9JbnRlcmZhY2UuVGhlbWUuR2V0RW1wdHlBcHAoZ3JhcGhpY3MuR3JhcGhpY3NEZXZpY2UpO1xyXG5cclxuICAgICAgICAgICAgLy9kZWZhdWx0VGhlbWUuRnJhbWVCYWNrVGV4dHVyZSA9IFRleHR1cmVUb0FwcChNb25vSW50ZXJmYWNlLlRoZW1lLlNvbGlkQ29sb3JUZXh0dXJlKGdyYXBoaWNzLkdyYXBoaWNzRGV2aWNlLCAxNzMsIDEyMiwgNzEsIDIyMCkpO1xyXG4gICAgICAgICAgICBkZWZhdWx0VGhlbWUuRnJhbWVCYWNrVGV4dHVyZSA9IG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcImVtcHR5XCJdLCAwKTtcclxuXHJcbiAgICAgICAgICAgIC8vZGVmYXVsdFRoZW1lLkJ1dHRvbkJhY2tUZXh0dXJlID0gVGV4dHVyZVRvQXBwKE1vbm9JbnRlcmZhY2UuVGhlbWUuU29saWRDb2xvclRleHR1cmUoZ3JhcGhpY3MuR3JhcGhpY3NEZXZpY2UsIDEyMywgNzIsIDIxKSk7XHJcbiAgICAgICAgICAgIGRlZmF1bHRUaGVtZS5CdXR0b25CYWNrVGV4dHVyZSA9IG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcImVtcHR5XCJdLCAxKTtcclxuICAgICAgICAgICAgLy9kZWZhdWx0VGhlbWUuQnV0dG9uU2VsZWN0ZWRUZXh0dXJlID0gVGV4dHVyZVRvQXBwKE1vbm9JbnRlcmZhY2UuVGhlbWUuU29saWRDb2xvclRleHR1cmUoZ3JhcGhpY3MuR3JhcGhpY3NEZXZpY2UsIDIwMCwgMjAwLCAyMDApKTtcclxuICAgICAgICAgICAgZGVmYXVsdFRoZW1lLkJ1dHRvblNlbGVjdGVkVGV4dHVyZSA9IG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcImVtcHR5XCJdLCAyKTtcclxuICAgICAgICAgICAgLy9kZWZhdWx0VGhlbWUuQnV0dG9uRnJvbnRUZXh0dXJlID0gVGV4dHVyZVRvQXBwKE1vbm9JbnRlcmZhY2UuVGhlbWUuU29saWRDb2xvclRleHR1cmUoZ3JhcGhpY3MuR3JhcGhpY3NEZXZpY2UsIDI1NSwgMjU1LCA1MSwgMTIwKSk7XHJcbiAgICAgICAgICAgIGRlZmF1bHRUaGVtZS5CdXR0b25Gcm9udFRleHR1cmUgPSBuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJlbXB0eVwiXSwgMyk7XHJcbiAgICAgICAgICAgIC8vZGVmYXVsdFRoZW1lLkJ1dHRvblByZXNzZWRUZXh0dXJlID0gVGV4dHVyZVRvQXBwKE1vbm9JbnRlcmZhY2UuVGhlbWUuU29saWRDb2xvclRleHR1cmUoZ3JhcGhpY3MuR3JhcGhpY3NEZXZpY2UsIDIyMCwgMjIwLCAyMjAsIDE4MCkpO1xyXG4gICAgICAgICAgICBkZWZhdWx0VGhlbWUuQnV0dG9uUHJlc3NlZFRleHR1cmUgPSBuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJlbXB0eVwiXSwgNCk7XHJcbiAgICAgICAgICAgIC8vZGVmYXVsdFRoZW1lLkJ1dHRvbkRpc2FibGVkVGV4dHVyZSA9IFRleHR1cmVUb0FwcChNb25vSW50ZXJmYWNlLlRoZW1lLlNvbGlkQ29sb3JUZXh0dXJlKGdyYXBoaWNzLkdyYXBoaWNzRGV2aWNlLCAxMDAsIDEwMCwgMTAwLCAyMDApKTtcclxuICAgICAgICAgICAgZGVmYXVsdFRoZW1lLkJ1dHRvbkRpc2FibGVkVGV4dHVyZSA9IG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcImVtcHR5XCJdLCA1KTtcclxuXHJcbiAgICAgICAgICAgIGRlZmF1bHRUaGVtZS5Qcm9ncmVzc0JhY2tUZXh0dXJlID0gZGVmYXVsdFRoZW1lLkVtcHR5VGV4dHVyZTtcclxuICAgICAgICAgICAgLy9kZWZhdWx0VGhlbWUuUHJvZ3Jlc3NGcm9udFRleHR1cmUgPSBUZXh0dXJlVG9BcHAoTW9ub0ludGVyZmFjZS5UaGVtZS5Tb2xpZENvbG9yVGV4dHVyZShncmFwaGljcy5HcmFwaGljc0RldmljZSwgMTQwLCAxNDAsIDE0MCwgMjAwKSk7XHJcbiAgICAgICAgICAgIGRlZmF1bHRUaGVtZS5Qcm9ncmVzc0Zyb250VGV4dHVyZSA9IG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcImVtcHR5XCJdLCA2KTtcclxuXHJcbiAgICAgICAgICAgIGRlZmF1bHRUaGVtZS5Td2l0Y2hlckJ1dHRvbkxlZnRUZXh0dXJlID0gbmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW1wibWVkaXVtX2ljb25zXCJdLCAyKTtcclxuICAgICAgICAgICAgZGVmYXVsdFRoZW1lLlN3aXRjaGVyQnV0dG9uUmlnaHRUZXh0dXJlID0gbmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW1wibWVkaXVtX2ljb25zXCJdLCAzKTtcclxuICAgICAgICAgICAgZGVmYXVsdFRoZW1lLlN3aXRjaGVyRGVzY3JpcHRpb25Gb250U2l6ZSA9IDE0O1xyXG4gICAgICAgICAgICBkZWZhdWx0VGhlbWUuU3dpdGNoZXJEZXNjcmlwdGlvbkNvbG9yID0gQ29sb3IuQmxhY2s7XHJcbiAgICAgICAgICAgIGRlZmF1bHRUaGVtZS5Td2l0Y2hlck1haW5Gb250U2l6ZSA9IDIwO1xyXG4gICAgICAgICAgICBkZWZhdWx0VGhlbWUuU3dpdGNoZXJNYWluQ29sb3IgPSBDb2xvci5CbGFjaztcclxuXHJcbiAgICAgICAgICAgIE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZVtdIG5mdHMgPSBuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlWzEwXTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPD0gODsgaSsrKVxyXG4gICAgICAgICAgICAgICAgbmZ0c1tpXSA9IG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcIm5pbmVmcmFtZVwiXSwgaSk7XHJcblxyXG4gICAgICAgICAgICBkZWZhdWx0VGhlbWUuTmluZUZyYW1lQm9kZXJUZXh0dXJlID0gbmZ0cztcclxuXHJcbiAgICAgICAgICAgIGRlZmF1bHRUaGVtZS5Gb250cyA9IEZvbnRzO1xyXG5cclxuICAgICAgICAgICAgLy9iYWNrVGhlbWUuRnJhbWVCYWNrVGV4dHVyZSA9IFRleHR1cmVUb0FwcChNb25vSW50ZXJmYWNlLlRoZW1lLlNvbGlkQ29sb3JUZXh0dXJlKGdyYXBoaWNzLkdyYXBoaWNzRGV2aWNlLCAwLCAwLCAwLCAxNTApKTtcclxuICAgICAgICAgICAgYmFja1RoZW1lLkZyYW1lQmFja1RleHR1cmUgPSBuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJlbXB0eVwiXSwgNyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuQ29udGFpbmVyIGNVbml0cztcclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuQ29udGFpbmVyIGNTcGVsbHM7XHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkNvbnRhaW5lciBjQnVpbGRpbmdzO1xyXG5cclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuQnV0dG9uIGJ0blNlbGVjdFVuaXRzO1xyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5CdXR0b24gYnRuU2VsZWN0U3BlbGxzO1xyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5CdXR0b24gYnRuU2VsZWN0QnVpbGRpbmdzO1xyXG5cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgQ3JlYXRlSW50ZXJmYWNlKCkge1xyXG4gICAgICAgICAgICBkZWZhdWx0VGhlbWUgPSBuZXcgTW9ub0ludGVyZmFjZS5UaGVtZSgpO1xyXG4gICAgICAgICAgICBiYWNrVGhlbWUgPSBuZXcgTW9ub0ludGVyZmFjZS5UaGVtZSgpO1xyXG5cclxuICAgICAgICAgICAgQ3JlYXRlSW50ZXJmYWNlVGV4dXJlcygpO1xyXG5cclxuICAgICAgICAgICAgTWFpbkNvbnRhaW5lciA9IG5ldyBNb25vSW50ZXJmYWNlLldpbmRvdygwLCAwLCBnYW1lV2lkdGgsIGdhbWVIZWlnaHQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEN1cnJlbnRUaGVtZSA9IGRlZmF1bHRUaGVtZVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgICAgIG1haW5BbmltYXRvciA9IG5ldyBNb25vSW50ZXJmYWNlLkFuaW1hdG9yKCk7XHJcblxyXG4gICAgICAgICAgICBmcm1Vbml0cyA9IE1haW5Db250YWluZXIuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5GcmFtZT4obmV3IE1vbm9JbnRlcmZhY2UuRnJhbWUoMCwgMCwgMzAwLCAxMTAsIGhvckFsaWduOiAwLjBmLCB2ZXJBbGlnbjogMC4wZiwgdmlzaWJsZTogZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgIExlZnRCb3JkZXIgPSBmYWxzZSxcclxuICAgICAgICAgICAgICAgIFRvcEJvcmRlciA9IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgU2hvd0FuaW1hdGlvbiA9IG5ldyBNb25vSW50ZXJmYWNlLk51bWJlckFuaW1hdGlvbihcIllcIiwgLTgyLCAwLCAyMClcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBjVW5pdHMgPSBmcm1Vbml0cy5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkNvbnRhaW5lcj4obmV3IE1vbm9JbnRlcmZhY2UuQ29udGFpbmVyKDUsIDUsIDI5MCwgNjAsIHZlckFsaWduOiAwLjBmLCBob3JBbGlnbjogMC4wZikpO1xyXG4gICAgICAgICAgICBjU3BlbGxzID0gZnJtVW5pdHMuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5Db250YWluZXI+KG5ldyBNb25vSW50ZXJmYWNlLkNvbnRhaW5lcig1LCA1LCAyOTAsIDYwLCB2ZXJBbGlnbjogMC4wZiwgaG9yQWxpZ246IDAuMGYpKTtcclxuICAgICAgICAgICAgY0J1aWxkaW5ncyA9IGZybVVuaXRzLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuQ29udGFpbmVyPihuZXcgTW9ub0ludGVyZmFjZS5Db250YWluZXIoNSwgNSwgMjkwLCA2MCwgdmVyQWxpZ246IDAuMGYsIGhvckFsaWduOiAwLjBmKSk7XHJcblxyXG5cclxuICAgICAgICAgICAgYnRuU2VsZWN0VW5pdHMgPSBmcm1Vbml0cy5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkJ1dHRvbj4obmV3IE1vbm9JbnRlcmZhY2UuQnV0dG9uKChidG4sIGlzX3RvdWNoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjVW5pdHMuVmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBjU3BlbGxzLlZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGNCdWlsZGluZ3MuVmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgYnRuU2VsZWN0VW5pdHMuSXNTZWxlY3RlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBidG5TZWxlY3RTcGVsbHMuSXNTZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgYnRuU2VsZWN0QnVpbGRpbmdzLklzU2VsZWN0ZWQgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICBmcm1Vbml0cy5XID0gTWF0aC5NYXgoU3lzdGVtLkxpbnEuRW51bWVyYWJsZS5MYXN0PE1vbm9JbnRlcmZhY2UuQmxvY2s+KGNVbml0cy5DaGlsZHJlbikuUmlnaHQsIGJ0blNlbGVjdEJ1aWxkaW5ncy5SaWdodCkgKyA1O1xyXG4gICAgICAgICAgICB9LCA1LCAtNSwgMTAwLCAzMCwgaG9yQWxpZ246IDAuMGYsIHZlckFsaWduOiAxLjBmKSk7XHJcbiAgICAgICAgICAgIGJ0blNlbGVjdFVuaXRzLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTGFiZWw+KG5ldyBNb25vSW50ZXJmYWNlLkxhYmVsKFwi0KHRg9GJ0LXRgdGC0LLQsFwiLCAxNiwgQ29sb3IuQmxhY2spKTtcclxuXHJcbiAgICAgICAgICAgIGJ0blNlbGVjdFNwZWxscyA9IGZybVVuaXRzLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuQnV0dG9uPihuZXcgTW9ub0ludGVyZmFjZS5CdXR0b24oKGJ0biwgaXNfdG91Y2gpID0+IHtcclxuICAgICAgICAgICAgICAgIGNVbml0cy5WaXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBjU3BlbGxzLlZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgY0J1aWxkaW5ncy5WaXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBidG5TZWxlY3RVbml0cy5Jc1NlbGVjdGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBidG5TZWxlY3RTcGVsbHMuSXNTZWxlY3RlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBidG5TZWxlY3RCdWlsZGluZ3MuSXNTZWxlY3RlZCA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgIGZybVVuaXRzLlcgPSBNYXRoLk1heChTeXN0ZW0uTGlucS5FbnVtZXJhYmxlLkxhc3Q8TW9ub0ludGVyZmFjZS5CbG9jaz4oY1NwZWxscy5DaGlsZHJlbikuUmlnaHQsIGJ0blNlbGVjdEJ1aWxkaW5ncy5SaWdodCkgKyA1O1xyXG4gICAgICAgICAgICB9LCAxMTAsIC01LCAxMDAsIDMwLCBob3JBbGlnbjogMC4wZiwgdmVyQWxpZ246IDEuMGYpKTtcclxuXHJcbiAgICAgICAgICAgIGJ0blNlbGVjdFNwZWxscy5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkxhYmVsPihuZXcgTW9ub0ludGVyZmFjZS5MYWJlbChcItCX0LDQutC70LjQvdCw0L3QuNGPXCIsIDE2LCBDb2xvci5CbGFjaykpO1xyXG5cclxuICAgICAgICAgICAgYnRuU2VsZWN0QnVpbGRpbmdzID0gZnJtVW5pdHMuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5CdXR0b24+KG5ldyBNb25vSW50ZXJmYWNlLkJ1dHRvbigoYnRuLCBpc190b3VjaCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY1VuaXRzLlZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGNTcGVsbHMuVmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgY0J1aWxkaW5ncy5WaXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGJ0blNlbGVjdFVuaXRzLklzU2VsZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGJ0blNlbGVjdFNwZWxscy5Jc1NlbGVjdGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBidG5TZWxlY3RCdWlsZGluZ3MuSXNTZWxlY3RlZCA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgZnJtVW5pdHMuVyA9IE1hdGguTWF4KFN5c3RlbS5MaW5xLkVudW1lcmFibGUuTGFzdDxNb25vSW50ZXJmYWNlLkJsb2NrPihjQnVpbGRpbmdzLkNoaWxkcmVuKS5SaWdodCwgYnRuU2VsZWN0QnVpbGRpbmdzLlJpZ2h0KSArIDU7XHJcbiAgICAgICAgICAgIH0sIDIxNSwgLTUsIDEwMCwgMzAsIGhvckFsaWduOiAwLjBmLCB2ZXJBbGlnbjogMS4wZikpO1xyXG4gICAgICAgICAgICBidG5TZWxlY3RCdWlsZGluZ3MuSXNEaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIGJ0blNlbGVjdEJ1aWxkaW5ncy5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkxhYmVsPihuZXcgTW9ub0ludGVyZmFjZS5MYWJlbChcItCf0L7RgdGC0YDQvtC50LrQuFwiLCAxNiwgQ29sb3IuQmxhY2spKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGZybVVuaXRzLkhpZGVBbmltYXRpb24gPSBOZXcgTW9ub0ludGVyZmFjZS5OdW1iZXJBbmltYXRpb24oZnJtVW5pdHMsIFwiWVwiLCAwLCAtODIsIDUwLCBOb3RoaW5nLCBOb3RoaW5nKVxyXG5cclxuXHJcbiAgICAgICAgICAgIGZybVByb2R1Y3Rpb24gPSBNYWluQ29udGFpbmVyLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuRnJhbWU+KG5ldyBNb25vSW50ZXJmYWNlLkZyYW1lKDAsIDEzMCwgMzU1LCA1NSwgaG9yQWxpZ246IDAuMGYsIHZlckFsaWduOiAwLjBmLCB2aXNpYmxlOiBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgTGVmdEJvcmRlciA9IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgU2hvd0FuaW1hdGlvbiA9IG5ldyBNb25vSW50ZXJmYWNlLk51bWJlckFuaW1hdGlvbihcIlhcIiwgLTM1NSwgMCwgNTApLFxyXG4gICAgICAgICAgICAgICAgSGlkZUFuaW1hdGlvbiA9IG5ldyBNb25vSW50ZXJmYWNlLk51bWJlckFuaW1hdGlvbihcIlhcIiwgMCwgLTM1NSwgLTUwKVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDw9IDY7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgYnRuc1Byb2R1Y3Rpb25baV0gPSBmcm1Qcm9kdWN0aW9uLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuQnV0dG9uPihuZXcgTW9ub0ludGVyZmFjZS5CdXR0b24oYnRuUHJvZHVjdGlvbl9DbGlja2VkLCBidG5Qcm9kdWN0aW9uX0ZvY3VzZWQsIDUgKyBpICogNTAsIDUsIDQ1LCA0NSwgaG9yQWxpZ246IDAuMGYsIHZlckFsaWduOiAwLjBmKSk7XHJcbiAgICAgICAgICAgICAgICBidG5zUHJvZHVjdGlvbltpXS5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLlBpY3R1cmU+KG5ldyBNb25vSW50ZXJmYWNlLlBpY3R1cmUoZGVmYXVsdFRoZW1lLkVtcHR5VGV4dHVyZSwgdzogNDUsIGg6IDQ1KSk7XHJcbiAgICAgICAgICAgICAgICBidG5zUHJvZHVjdGlvbltpXS5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLlBpY3R1cmU+KG5ldyBNb25vSW50ZXJmYWNlLlBpY3R1cmUobmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW1wic21hbGxfaWNvbnNcIl0sIDE5KSwgdzogMjAsIGg6IDE2LCB2ZXJBbGlnbjogMS4wZiwgaG9yQWxpZ246IDEuMGYpKTtcclxuXHJcbiAgICAgICAgICAgICAgICBidG5zUHJvZHVjdGlvbltpXVxyXG4gICAgICAgICAgICAgICAgICAgIC5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkJ1dHRvbj4obmV3IE1vbm9JbnRlcmZhY2UuQnV0dG9uKGJ0blByb2R1Y3Rpb25SZW1vdmVfQ2xpY2tlZCwgMCwgMCwgdzogMTYsIGg6IDE2LCB2ZXJBbGlnbjogMC4wZiwgaG9yQWxpZ246IDEuMGYpKVxyXG4gICAgICAgICAgICAgICAgICAgIC5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLlBpY3R1cmU+KG5ldyBNb25vSW50ZXJmYWNlLlBpY3R1cmUobmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW1wic21hbGxfaWNvbnNcIl0sIDIwKSwgdzogMjAsIGg6IDE2LCB2ZXJBbGlnbjogMC4wZiwgaG9yQWxpZ246IDEuMGYpKTtcclxuXHJcbiAgICAgICAgICAgICAgICBwcmdzUHJvZHVjdGlvbltpXSA9IGJ0bnNQcm9kdWN0aW9uW2ldLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuUHJvZ3Jlc3M+KG5ldyBNb25vSW50ZXJmYWNlLlByb2dyZXNzKDAsIDAsIDAsIDAsIDQ1LCA0NSwgMCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vICcg0KTRgNC10LnQvCDQs9C70LDQstC90L7Qs9C+INC80LXQvdGOXHJcblxyXG4gICAgICAgICAgICBmcm1NYWluTWVudSA9IE1haW5Db250YWluZXIuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5GcmFtZT4obmV3IE1vbm9JbnRlcmZhY2UuRnJhbWUoMCwgMCwgNzQsIDc0LCBob3JBbGlnbjogMC4wRiwgdmVyQWxpZ246IDAuMEYsIHZpc2libGU6IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgTGVmdEJvcmRlciA9IGZhbHNlLFxyXG4gICAgICAgICAgICAgIFRvcEJvcmRlciA9IGZhbHNlXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBmcm1NYWluTWVudVxyXG4gICAgICAgICAgICAgICAgLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuQnV0dG9uPihuZXcgTW9ub0ludGVyZmFjZS5CdXR0b24oYmF0dGxlRnJtTWFpbk1lbnUsIDUsIDAsIDY0LCA2NCwgaG9yQWxpZ246IDAuMEYpKVxyXG4gICAgICAgICAgICAgICAgLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuUGljdHVyZT4obmV3IE1vbm9JbnRlcmZhY2UuUGljdHVyZShuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJiaWdfaWNvbnNcIl0sIDEpKSk7XHJcblxyXG4gICAgICAgICAgICAvLyAnINCk0YDQtdC50Lwg0YDQtdGB0YPRgNGB0L7QsiBcclxuICAgICAgICAgICAgZnJtUmVzb3VyY2VzID0gTWFpbkNvbnRhaW5lci5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkZyYW1lPihuZXcgTW9ub0ludGVyZmFjZS5GcmFtZSgwLCAwLCAyNTAsIDcwLCBob3JBbGlnbjogMS4wZiwgdmVyQWxpZ246IDAuMGYsIHZpc2libGU6IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICBSaWdodEJvcmRlciA9IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgVG9wQm9yZGVyID0gZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBTaG93QW5pbWF0aW9uID0gbmV3IE1vbm9JbnRlcmZhY2UuTnVtYmVyQW5pbWF0aW9uKFwiWVwiLCAtODIsIDAsIDIwKVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgYnRuVGllclVwRnJtUmVzb3VyY2VzID0gZnJtUmVzb3VyY2VzLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuQnV0dG9uPihuZXcgTW9ub0ludGVyZmFjZS5CdXR0b24odGllclVwRnJtUmVzb3VyY2VzX0NsaWNrZWQsIHRpZXJVcEZybVJlc291cmNlc19Gb2N1c2VkLCBLZXlzLkVudGVyLCA1LCAwLCA2MCwgNjAsIGhvckFsaWduOiAwLjBmKSk7XHJcbiAgICAgICAgICAgIHBjdFRpZXJGcm1SZXNvdXJjZXMgPSBidG5UaWVyVXBGcm1SZXNvdXJjZXMuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5QaWN0dXJlPihuZXcgTW9ub0ludGVyZmFjZS5QaWN0dXJlKHVuaXRQcm1zW1wiVGllcl8yXCJdLmljb25BcHAsIHc6IDYwLCBoOiA2MCkpO1xyXG5cclxuICAgICAgICAgICAgZnJtUmVzb3VyY2VzLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuUGljdHVyZT4obmV3IE1vbm9JbnRlcmZhY2UuUGljdHVyZShuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJzbWFsbF9pY29uc1wiXSwgMTIpLCAtNzIsIC0xNywgNDAsIDMyLCBob3JBbGlnbjogMS4wZikpO1xyXG4gICAgICAgICAgICBmcm1SZXNvdXJjZXMuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5QaWN0dXJlPihuZXcgTW9ub0ludGVyZmFjZS5QaWN0dXJlKG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcInNtYWxsX2ljb25zXCJdLCAxMyksIC03MiwgMTUsIDQwLCAzMiwgaG9yQWxpZ246IDEuMGYpKTtcclxuXHJcbiAgICAgICAgICAgIGxibEdvbGRGcm1SZXNvdXJjZXMgPSBmcm1SZXNvdXJjZXMuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5MYWJlbD4obmV3IE1vbm9JbnRlcmZhY2UuTGFiZWwoXCJcIiwgMjAsIG1vbmV5Q2xyLCAtMTE1LCAtMTAsIGhvckFsaWduOiAxLjBmKSk7XHJcbiAgICAgICAgICAgIGxibERlYXRoRnJtUmVzb3VyY2VzID0gZnJtUmVzb3VyY2VzLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTGFiZWw+KG5ldyBNb25vSW50ZXJmYWNlLkxhYmVsKFwiXCIsIDIwLCBkZWF0aENsciwgLTExNSwgMjAsIGhvckFsaWduOiAxLjBmKSk7XHJcblxyXG5cclxuICAgICAgICAgICAgcGN0UGF1c2VGcm1SZXNvdXJjZXMgPSBmcm1SZXNvdXJjZXNcclxuICAgICAgICAgICAgICAgIC5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkJ1dHRvbj4obmV3IE1vbm9JbnRlcmZhY2UuQnV0dG9uKHBhdXNlRnJtUmVzb3VyY2VzX0NsaWNrZWQsIEtleXMuRXNjYXBlLCAtNSwgMCwgNjAsIDYwLCBob3JBbGlnbjogMS4wZikpXHJcbiAgICAgICAgICAgICAgICAuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5QaWN0dXJlPihuZXcgTW9ub0ludGVyZmFjZS5QaWN0dXJlKG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcIm1lZGl1bV9pY29uc1wiXSwgMSksIHc6IDYwLCBoOiA2MCkpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIGZybVJpZ2h0TWVudSA9IE1haW5Db250YWluZXIuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5GcmFtZT4obmV3IE1vbm9JbnRlcmZhY2UuRnJhbWUoMCwgMCwgNzQsIDc0LCAxLjBmLCAwLjBmLCB2aXNpYmxlOiBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgUmlnaHRCb3JkZXIgPSBmYWxzZSxcclxuICAgICAgICAgICAgICAgIFRvcEJvcmRlciA9IGZhbHNlXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBmcm1SaWdodE1lbnVcclxuICAgICAgICAgICAgICAgIC5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkJ1dHRvbj4obmV3IE1vbm9JbnRlcmZhY2UuQnV0dG9uKGV4aXRGcm1NZW51RXhpdF9DbGlja2VkLCBLZXlzLkVzY2FwZSwgNSwgMCwgNjQsIDY0LCBob3JBbGlnbjogMC4wZikpXHJcbiAgICAgICAgICAgICAgICAuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5QaWN0dXJlPihuZXcgTW9ub0ludGVyZmFjZS5QaWN0dXJlKG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcIm1lZGl1bV9pY29uc1wiXSwgMCksIHc6IDY0LCBoOiA2NCkpO1xyXG5cclxuICAgICAgICAgICAgLy8gJyDQpNGA0LXQudC8INGB0YLQsNGA0YLQsCDQsdC40YLQstGLXHJcbiAgICAgICAgICAgIGZybUJhdHRsZSA9IE1haW5Db250YWluZXIuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5GcmFtZT4obmV3IE1vbm9JbnRlcmZhY2UuRnJhbWUoMCwgMCwgNDUwLCAzMzAsIHZpc2libGU6IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICBTaG93QW5pbWF0aW9uID0gbmV3IE1vbm9JbnRlcmZhY2UuTnVtYmVyQW5pbWF0aW9uKFwiWVwiLCAtMzAwLCAwLCA1MCksXHJcbiAgICAgICAgICAgICAgICBIaWRlQW5pbWF0aW9uID0gbmV3IE1vbm9JbnRlcmZhY2UuTnVtYmVyQW5pbWF0aW9uKFwiWVwiLCAwLCAzMDAsIDUwKVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgZnJtQmF0dGxlLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTGFiZWw+KG5ldyBNb25vSW50ZXJmYWNlLkxhYmVsKFwi0JHQuNGC0LLQsFwiLCAzMCwgQ29sb3IuQmxhY2ssIHk6IDcsIHZlckFsaWduOiAwLjBGKSk7XHJcbiAgICAgICAgICAgIGZybUJhdHRsZS5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkxhYmVsPihuZXcgTW9ub0ludGVyZmFjZS5MYWJlbChcIlZTXCIsIDIwLCBDb2xvci5CbGFjaywgeTogNTUsIHZlckFsaWduOiAwLjBGKSk7XHJcblxyXG5cclxuICAgICAgICAgICAgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlW10gcHMxID0gbmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZVtyYWNlczEuQ291bnQgLSAxICsgMV07XHJcbiAgICAgICAgICAgIHN0cmluZ1tdIHRzMSA9IG5ldyBzdHJpbmdbcmFjZXMxLkNvdW50IC0gMSArIDFdO1xyXG4gICAgICAgICAgICBzdHJpbmdbXSBkczEgPSBuZXcgc3RyaW5nW3JhY2VzMS5Db3VudCAtIDEgKyAxXTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByYWNlczEuQ291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgcHMxW2ldID0gbmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW1wicmFjZV9pY29uc1wiXSwgUmFjZU1hbmFnZXIuSW5zdGFuY2UuQWxsW3JhY2VzMVtpXV0uc3ltYik7XHJcbiAgICAgICAgICAgICAgICB0czFbaV0gPSBSYWNlTWFuYWdlci5JbnN0YW5jZS5BbGxbcmFjZXMxW2ldXS5uYW1lO1xyXG4gICAgICAgICAgICAgICAgZHMxW2ldID0gUmFjZU1hbmFnZXIuSW5zdGFuY2UuQWxsW3JhY2VzMVtpXV0uZGVzYztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlW10gcHMyID0gbmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZVtyYWNlczIuQ291bnQgLSAxICsgMV07XHJcbiAgICAgICAgICAgIHN0cmluZ1tdIHRzMiA9IG5ldyBzdHJpbmdbcmFjZXMyLkNvdW50IC0gMSArIDFdO1xyXG4gICAgICAgICAgICBzdHJpbmdbXSBkczIgPSBuZXcgc3RyaW5nW3JhY2VzMi5Db3VudCAtIDEgKyAxXTtcclxuXHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmFjZXMyLkNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHBzMltpXSA9IG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcInJhY2VfaWNvbnNcIl0sIFJhY2VNYW5hZ2VyLkluc3RhbmNlLkFsbFtyYWNlczJbaV1dLnN5bWIpO1xyXG4gICAgICAgICAgICAgICAgdHMyW2ldID0gUmFjZU1hbmFnZXIuSW5zdGFuY2UuQWxsW3JhY2VzMltpXV0ubmFtZTtcclxuICAgICAgICAgICAgICAgIGRzMltpXSA9IFJhY2VNYW5hZ2VyLkluc3RhbmNlLkFsbFtyYWNlczJbaV1dLmRlc2M7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJhY2VzMVN3aXRjaGVyRnJtQmF0dGxlID0gZnJtQmF0dGxlLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuU3dpdGNoZXI+KG5ldyBNb25vSW50ZXJmYWNlLlN3aXRjaGVyKHBzMSwgdHMxLCBkczEsIDAsIG1haW5BbmltYXRvciwgLTEwMCwgNjAsIDE1MCwgMTAwLCB2ZXJBbGlnbjogMC4wRikpO1xyXG4gICAgICAgICAgICByYWNlczJTd2l0Y2hlckZybUJhdHRsZSA9IGZybUJhdHRsZS5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLlN3aXRjaGVyPihuZXcgTW9ub0ludGVyZmFjZS5Td2l0Y2hlcihwczIsIHRzMiwgZHMyLCAwLCBtYWluQW5pbWF0b3IsIDEwMCwgNjAsIDE1MCwgMTAwLCB2ZXJBbGlnbjogMC4wRikpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGdhbWVUeXBlcyA9IG5ldyBzdHJpbmdbXSB7IFwiUmFuZG9tR1RcIiwgXCJTdGFuZGFydEdUXCIsIFwiT2ZmZW5jZUdUXCIsIFwiRGVmZW5jZUdUXCIsIFwiRmlyc3RIZXJvR1RcIiB9O1xyXG4gICAgICAgICAgICB2YXIgZ3RzID0gbmV3IHN0cmluZ1tnYW1lVHlwZXMuTGVuZ3RoXTtcclxuICAgICAgICAgICAgdmFyIGdkdHMgPSBuZXcgc3RyaW5nW2dhbWVUeXBlcy5MZW5ndGhdO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGdhbWVUeXBlcy5MZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgZ3RzW2ldID0gZ2FtZVR5cGVzW2ldO1xyXG4gICAgICAgICAgICAgICAgZ2R0c1tpXSA9IGdhbWVUeXBlc1tpXSArIFwiRGVzY1wiO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBtb2RlU3dpdGNoZXJGcm1CYXR0bGUgPSBmcm1CYXR0bGUuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5Td2l0Y2hlcj4obmV3IE1vbm9JbnRlcmZhY2UuU3dpdGNoZXIobnVsbCwgZ3RzLCBnZHRzLCAwLCBtYWluQW5pbWF0b3IsIDAsIDE3MCwgMzUwLCAxMDAsIHZlckFsaWduOiAwLjBGKSk7XHJcbiAgICAgICAgICAgIGZybUJhdHRsZVxyXG4gICAgICAgICAgICAgICAgLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuQnV0dG9uPihuZXcgTW9ub0ludGVyZmFjZS5CdXR0b24oYnRuU3RhcnRCYXR0bGUsIEtleXMuRW50ZXIsIDAsIC0xMCwgMTUwLCA0NSwgdmVyQWxpZ246IDEuMEYpKVxyXG4gICAgICAgICAgICAgICAgLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTGFiZWw+KG5ldyBNb25vSW50ZXJmYWNlLkxhYmVsKFwi0JLQv9C10YDQtdC0XCIsIDIwLCBDb2xvci5CbGFjaykpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIC8vICfQpNGA0LXQudC8INC30LDRgtC10LzQvdC10L3QuNGPIFxyXG4gICAgICAgICAgICBmcm1CYWNrID0gTWFpbkNvbnRhaW5lci5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkZyYW1lPihuZXcgTW9ub0ludGVyZmFjZS5GcmFtZSgwLCAwLCAtMSwgLTEsIHZpc2libGU6IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICBTaG93QW5pbWF0aW9uID0gbmV3IE1vbm9JbnRlcmZhY2UuTnVtYmVyQW5pbWF0aW9uKFwiQWxwaGFcIiwgMCwgMSwgMC4wNWYpLFxyXG4gICAgICAgICAgICAgICAgSGlkZUFuaW1hdGlvbiA9IG5ldyBNb25vSW50ZXJmYWNlLk51bWJlckFuaW1hdGlvbihcIkFscGhhXCIsIDEsIDAsIC0wLjA1ZilcclxuICAgICAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICAgICAgLy8gJyDQpNGA0LXQudC8INC90LDRgdGC0YDQvtC10LpcclxuICAgICAgICAgICAgZnJtU2V0dGluZ3MgPSBNYWluQ29udGFpbmVyLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuRnJhbWU+KG5ldyBNb25vSW50ZXJmYWNlLkZyYW1lKDAsIDAsIDM1MCwgMjAwLCB2aXNpYmxlOiBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgU2hvd0FuaW1hdGlvbiA9IG5ldyBNb25vSW50ZXJmYWNlLk51bWJlckFuaW1hdGlvbihcIllcIiwgLTMwMCwgMCwgNTAsICgpID0+IGZybUJhY2suU2hvdyhtYWluQW5pbWF0b3IpKSxcclxuICAgICAgICAgICAgICAgIEhpZGVBbmltYXRpb24gPSBuZXcgTW9ub0ludGVyZmFjZS5OdW1iZXJBbmltYXRpb24oXCJZXCIsIDAsIDMwMCwgNTAsICgpID0+IGZybUJhY2suSGlkZShtYWluQW5pbWF0b3IpKVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgZnJtU2V0dGluZ3MuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5MYWJlbD4obmV3IE1vbm9JbnRlcmZhY2UuTGFiZWwoXCLQndCw0YHRgtGA0L7QudC60LhcIiwgMzAsIENvbG9yLkJsYWNrLCB5OiA3LCB2ZXJBbGlnbjogMC4wRikpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIENyZWF0ZVNjcmVlbkZvcm1hdHMoKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBzTW9kZXMgPSBuZXcgc3RyaW5nW3NjcmVlbkZvcm1hdHMuQ291bnRdO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNjcmVlbkZvcm1hdHMuQ291bnQ7IGkrKylcclxuICAgICAgICAgICAgICAgIHNNb2Rlc1tpXSA9IHN0cmluZy5Gb3JtYXQoXCJ7MH0geCB7MX0gOiB7Mn1cIiwgc2NyZWVuRm9ybWF0c1tpXS5YLCBzY3JlZW5Gb3JtYXRzW2ldLlksIHNjcmVlbkZvcm1hdHNbaV0uWik7XHJcblxyXG4gICAgICAgICAgICByZXNTd2l0Y2hlckZybVNldHRpbmdzID0gZnJtU2V0dGluZ3MuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5Td2l0Y2hlcj4obmV3IE1vbm9JbnRlcmZhY2UuU3dpdGNoZXIobnVsbCwgc01vZGVzLCBudWxsLCAwLCBtYWluQW5pbWF0b3IsIDAsIDQwLCAzMDAsIDEwMCwgdmVyQWxpZ246IDAuMGYpKTtcclxuXHJcbiAgICAgICAgICAgIGZybVNldHRpbmdzXHJcbiAgICAgICAgICAgICAgICAuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5CdXR0b24+KG5ldyBNb25vSW50ZXJmYWNlLkJ1dHRvbihiYWNrRnJtU2V0dGluZ3MsIEtleXMuRXNjYXBlLCAxMCwgLTEwLCAxNTAsIDQ1LCBob3JBbGlnbjogMC4wZiwgdmVyQWxpZ246IDEuMGYpKVxyXG4gICAgICAgICAgICAgICAgLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTGFiZWw+KG5ldyBNb25vSW50ZXJmYWNlLkxhYmVsKFwi0J3QsNC30LDQtFwiLCAyMCwgQ29sb3IuQmxhY2spKTtcclxuICAgICAgICAgICAgZnJtU2V0dGluZ3NcclxuICAgICAgICAgICAgICAgIC5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkJ1dHRvbj4obmV3IE1vbm9JbnRlcmZhY2UuQnV0dG9uKGFwcGx5RnJtU2V0dGluZ3MsIEtleXMuRW50ZXIsIC0xMCwgLTEwLCAxNTAsIDQ1LCBob3JBbGlnbjogMS4wZiwgdmVyQWxpZ246IDEuMGYpKVxyXG4gICAgICAgICAgICAgICAgLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTGFiZWw+KG5ldyBNb25vSW50ZXJmYWNlLkxhYmVsKFwi0J/RgNC40LzQtdC90LjRgtGMXCIsIDIwLCBDb2xvci5CbGFjaykpO1xyXG5cclxuICAgICAgICAgICAgLy8gJyDQpNGA0LXQudC8INC/0L7Qs9C+0YLQvtCy0LrQuCDQuiDQsdC+0Y5cclxuICAgICAgICAgICAgZnJtUHJlR2FtZSA9IE1haW5Db250YWluZXIuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5GcmFtZT4obmV3IE1vbm9JbnRlcmZhY2UuRnJhbWUoMCwgMCwgNTAwLCA0MDAsIHZpc2libGU6IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICBTaG93QW5pbWF0aW9uID0gbmV3IE1vbm9JbnRlcmZhY2UuTnVtYmVyQW5pbWF0aW9uKFwiWVwiLCAtMzAwLCAwLCA1MCwgKCkgPT4gZnJtQmFjay5TaG93KG1haW5BbmltYXRvcikpLFxyXG4gICAgICAgICAgICAgICAgSGlkZUFuaW1hdGlvbiA9IG5ldyBNb25vSW50ZXJmYWNlLk51bWJlckFuaW1hdGlvbihcIllcIiwgMCwgMzAwLCA1MCwgKCkgPT4gZnJtQmFjay5IaWRlKG1haW5BbmltYXRvcikpXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgbGJsVnNQcmVHYW1lID0gZnJtUHJlR2FtZS5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkxhYmVsPihuZXcgTW9ub0ludGVyZmFjZS5MYWJlbChcIlwiLCAyMCwgQ29sb3IuQmxhY2ssIHk6IDcsIHZlckFsaWduOiAwLjBGKSk7XHJcblxyXG4gICAgICAgICAgICBidG5Vbml0c1ByZUdhbWUgPSBmcm1QcmVHYW1lLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuQnV0dG9uPihuZXcgTW9ub0ludGVyZmFjZS5CdXR0b24oKGJ0biwgaXNUb3VjaCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY1VuaXRzUHJlR2FtZS5WaXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGNTcGVsbHNQcmVHYW1lLlZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGNCdWlsZGluZ3NQcmVHYW1lLlZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGJ0blVuaXRzUHJlR2FtZS5Jc1NlbGVjdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGJ0blNwZWxsc1ByZUdhbWUuSXNTZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgYnRuQnVpbGRpbmdzUHJlR2FtZS5Jc1NlbGVjdGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0sIC0xNjAsIDYwLCAxNTAsIDQ1LCB2ZXJBbGlnbjogMC4wRikpO1xyXG4gICAgICAgICAgICBidG5Vbml0c1ByZUdhbWUuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5MYWJlbD4obmV3IE1vbm9JbnRlcmZhY2UuTGFiZWwoXCLQodGD0YnQtdGB0YLQstCwXCIsIDIwLCBDb2xvci5CbGFjaykpO1xyXG5cclxuICAgICAgICAgICAgYnRuU3BlbGxzUHJlR2FtZSA9IGZybVByZUdhbWUuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5CdXR0b24+KG5ldyBNb25vSW50ZXJmYWNlLkJ1dHRvbigoYnRuLCBpc1RvdWNoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjVW5pdHNQcmVHYW1lLlZpc2libGUgPSBmYWxzZTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgY1NwZWxsc1ByZUdhbWUuVmlzaWJsZSA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgY0J1aWxkaW5nc1ByZUdhbWUuVmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgYnRuVW5pdHNQcmVHYW1lLklzU2VsZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGJ0blNwZWxsc1ByZUdhbWUuSXNTZWxlY3RlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBidG5CdWlsZGluZ3NQcmVHYW1lLklzU2VsZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSwgMCwgNjAsIDE1MCwgNDUsIHZlckFsaWduOiAwLjBGKSk7XHJcbiAgICAgICAgICAgIGJ0blNwZWxsc1ByZUdhbWUuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5MYWJlbD4obmV3IE1vbm9JbnRlcmZhY2UuTGFiZWwoXCLQl9Cw0LrQu9C40L3QsNC90LjRj1wiLCAyMCwgQ29sb3IuQmxhY2spKTtcclxuXHJcbiAgICAgICAgICAgIGJ0bkJ1aWxkaW5nc1ByZUdhbWUgPSBmcm1QcmVHYW1lLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuQnV0dG9uPihuZXcgTW9ub0ludGVyZmFjZS5CdXR0b24oKGJ0biwgaXNUb3VjaCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY1VuaXRzUHJlR2FtZS5WaXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBjU3BlbGxzUHJlR2FtZS5WaXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBjQnVpbGRpbmdzUHJlR2FtZS5WaXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGJ0blVuaXRzUHJlR2FtZS5Jc1NlbGVjdGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBidG5TcGVsbHNQcmVHYW1lLklzU2VsZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGJ0bkJ1aWxkaW5nc1ByZUdhbWUuSXNTZWxlY3RlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIH0sIDE2MCwgNjAsIDE1MCwgNDUsIHZlckFsaWduOiAwLjBGKSk7XHJcbiAgICAgICAgICAgIGJ0bkJ1aWxkaW5nc1ByZUdhbWUuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5MYWJlbD4obmV3IE1vbm9JbnRlcmZhY2UuTGFiZWwoXCLQn9C+0YHRgtGA0L7QudC60LhcIiwgMjAsIENvbG9yLkJsYWNrKSk7XHJcblxyXG5cclxuICAgICAgICAgICAgY1VuaXRzUHJlR2FtZSA9IGZybVByZUdhbWUuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5HcmlkPihuZXcgTW9ub0ludGVyZmFjZS5HcmlkKE1vbm9JbnRlcmZhY2UuR3JpZC5PcmllbnRhdGlvbnMuTGVmdFRvUmlnaHQsIC0yLCAxMjAsIDUwMCwgMTAwLCB2ZXJBbGlnbjogMC4wZiwgdmlzaWJsZTogZmFsc2UpKTtcclxuICAgICAgICAgICAgY1NwZWxsc1ByZUdhbWUgPSBmcm1QcmVHYW1lLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuR3JpZD4obmV3IE1vbm9JbnRlcmZhY2UuR3JpZChNb25vSW50ZXJmYWNlLkdyaWQuT3JpZW50YXRpb25zLkxlZnRUb1JpZ2h0LCAtMiwgMTIwLCA1MDAsIDEwMCwgdmVyQWxpZ246IDAuMGYsIHZpc2libGU6IGZhbHNlKSk7XHJcbiAgICAgICAgICAgIGNCdWlsZGluZ3NQcmVHYW1lID0gZnJtUHJlR2FtZS5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkdyaWQ+KG5ldyBNb25vSW50ZXJmYWNlLkdyaWQoTW9ub0ludGVyZmFjZS5HcmlkLk9yaWVudGF0aW9ucy5MZWZ0VG9SaWdodCwgLTIsIDEyMCwgNTAwLCAxMDAsIHZlckFsaWduOiAwLjBmLCB2aXNpYmxlOiBmYWxzZSkpO1xyXG5cclxuICAgICAgICAgICAgY1NlbGVjdGVkUHJlR2FtZSA9IGZybVByZUdhbWUuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5HcmlkPihuZXcgTW9ub0ludGVyZmFjZS5HcmlkKE1vbm9JbnRlcmZhY2UuR3JpZC5PcmllbnRhdGlvbnMuTGVmdFRvUmlnaHQsIC0yLCAtNTAsIDUwMCwgMTAwLCB2ZXJBbGlnbjogMS4wZikpO1xyXG5cclxuICAgICAgICAgICAgZnJtUHJlR2FtZVxyXG4gICAgICAgICAgICAgICAgLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuQnV0dG9uPihuZXcgTW9ub0ludGVyZmFjZS5CdXR0b24oYmFja1ByZUdhbWVfQ2xpY2tlZCwgS2V5cy5Fc2NhcGUsIDE1LCAtMTAsIDE1MCwgNDUsIDAuMEYsIDEuMEYpKVxyXG4gICAgICAgICAgICAgICAgLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTGFiZWw+KG5ldyBNb25vSW50ZXJmYWNlLkxhYmVsKFwi0J3QsNC30LDQtFwiLCAyMCwgQ29sb3IuQmxhY2spKTtcclxuICAgICAgICAgICAgZnJtUHJlR2FtZVxyXG4gICAgICAgICAgICAgICAgLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuQnV0dG9uPihuZXcgTW9ub0ludGVyZmFjZS5CdXR0b24oY2xlYXJQcmVHYW1lX0NsaWNrZWQsIDAsIC0xMCwgMTUwLCA0NSwgdmVyQWxpZ246IDEuMEYpKVxyXG4gICAgICAgICAgICAgICAgLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTGFiZWw+KG5ldyBNb25vSW50ZXJmYWNlLkxhYmVsKFwi0J7Rh9C40YHRgtC40YLRjFwiLCAyMCwgQ29sb3IuQmxhY2spKTtcclxuICAgICAgICAgICAgYnRuRmlnaHRQcmVHYW1lID0gZnJtUHJlR2FtZS5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkJ1dHRvbj4obmV3IE1vbm9JbnRlcmZhY2UuQnV0dG9uKGZpZ2h0UHJlR2FtZV9DbGlja2VkLCBLZXlzLkVudGVyLCAtMTUsIC0xMCwgMTUwLCA0NSwgMS4wRiwgMS4wRikpO1xyXG4gICAgICAgICAgICBidG5GaWdodFByZUdhbWUuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5MYWJlbD4obmV3IE1vbm9JbnRlcmZhY2UuTGFiZWwoXCLQkiDQsdC+0LkhXCIsIDIwLCBDb2xvci5CbGFjaykpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIC8vINCk0YDQtdC50Lwg0L/QvtC00YHQutCw0LfQutC4XHJcbiAgICAgICAgICAgIGZybUhlbHAgPSBNYWluQ29udGFpbmVyLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuRnJhbWU+KG5ldyBNb25vSW50ZXJmYWNlLkZyYW1lKDAsIDAsIDI1MCwgMCwgMC4wZiwgMC4wZikpO1xyXG5cclxuICAgICAgICAgICAgLy8g0JfQsNCz0L7Qu9C+0LLQvtC6LCDQt9C90LDRh9C+0Log0Lgg0L/QvtC00LfQsNCz0L7Qu9C+0LLQvtC6XHJcbiAgICAgICAgICAgIGxibFVuaXROYW1lSGVscFVuaXQgPSBmcm1IZWxwLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTGFiZWw+KG5ldyBNb25vSW50ZXJmYWNlLkxhYmVsKFwi0KLQuNCz0YBcIiwgMTQsIENvbG9yLkJsYWNrLCAwLCAwLCBob3JBbGlnbjogMC4wZiwgdmVyQWxpZ246IDAuMGYpKTtcclxuICAgICAgICAgICAgbGJsUmFjZUhlbHBVbml0ID0gZnJtSGVscC5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkxhYmVsPihuZXcgTW9ub0ludGVyZmFjZS5MYWJlbChcItCi0LjQs9GAXCIsIDEyLCBDb2xvci5CbGFjaywgMCwgMjMsIGhvckFsaWduOiAwLjBmLCB2ZXJBbGlnbjogMC4wZikpO1xyXG5cclxuICAgICAgICAgICAgLy8g0KHRgtC+0LjQvNC+0YHRgtGMXHJcbiAgICAgICAgICAgIGxibENvc3RNb25leUhlbHBVbml0ID0gZnJtSGVscC5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkxhYmVsPihuZXcgTW9ub0ludGVyZmFjZS5MYWJlbChcItCi0LjQs9GAXCIsIDEyLCBDb2xvci5CbGFjaywgMjAsIDQzLCBob3JBbGlnbjogMC4wZiwgdmVyQWxpZ246IDAuMGYpKTtcclxuICAgICAgICAgICAgbGJsQ29zdERlYXRoSGVscFVuaXQgPSBmcm1IZWxwLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTGFiZWw+KG5ldyBNb25vSW50ZXJmYWNlLkxhYmVsKFwi0KLQuNCz0YBcIiwgMTIsIENvbG9yLkJsYWNrLCA3MCwgNDMsIGhvckFsaWduOiAwLjBmLCB2ZXJBbGlnbjogMC4wZikpO1xyXG4gICAgICAgICAgICBmcm1IZWxwLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuUGljdHVyZT4obmV3IE1vbm9JbnRlcmZhY2UuUGljdHVyZShuZXcgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlKHNwcml0ZXNbXCJzbWFsbF9pY29uc1wiXSwgMTIpLCAwLCA0MiwgaG9yQWxpZ246IDAuMGYsIHZlckFsaWduOiAwLjBmKSk7XHJcbiAgICAgICAgICAgIGZybUhlbHAuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5QaWN0dXJlPihuZXcgTW9ub0ludGVyZmFjZS5QaWN0dXJlKG5ldyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Uoc3ByaXRlc1tcInNtYWxsX2ljb25zXCJdLCAxMyksIDUwLCA0MiwgaG9yQWxpZ246IDAuMGYsIHZlckFsaWduOiAwLjBmKSk7XHJcblxyXG4gICAgICAgICAgICBjQmF0dGxlUGFyYW1ldGVycyA9IGZybUhlbHAuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5Db250YWluZXI+KG5ldyBNb25vSW50ZXJmYWNlLkNvbnRhaW5lcigwLCA2NSwgMjUwLCA2MCwgaG9yQWxpZ246IDAuMGYsIHZlckFsaWduOiAwLjBmKSk7XHJcbiAgICAgICAgICAgIGxibEF0dGFja0Jhc2ljUGFyYW1zID0gY0JhdHRsZVBhcmFtZXRlcnMuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5MYWJlbD4obmV3IE1vbm9JbnRlcmZhY2UuTGFiZWwoXCLQotC40LPRgFwiLCAxMiwgQ29sb3IuQmxhY2ssIDIwLCAwLCBob3JBbGlnbjogMC4wZiwgdmVyQWxpZ246IDAuMGYpKTtcclxuICAgICAgICAgICAgcGN0QXR0YWNrQmFzaWNQYXJhbXMgPSBjQmF0dGxlUGFyYW1ldGVycy5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLlBpY3R1cmU+KG5ldyBNb25vSW50ZXJmYWNlLlBpY3R1cmUobmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW1wic21hbGxfaWNvbnNcIl0sIDEpLCAwLCAwLCBob3JBbGlnbjogMC4wZiwgdmVyQWxpZ246IDAuMGYpKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPD0gMjsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBsYmxzQmFzaWNQYXJhbXNbaV0gPSBjQmF0dGxlUGFyYW1ldGVycy5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkxhYmVsPihuZXcgTW9ub0ludGVyZmFjZS5MYWJlbChcItCi0LjQs9GAXCIsIDEyLCBDb2xvci5CbGFjaywgMjAgKyAxMDAgKiAoaSAlIDIpLCAyMiArIChpIC8gMikgKiAyMiwgaG9yQWxpZ246IDAuMGYsIHZlckFsaWduOiAwLjBmKSk7XHJcbiAgICAgICAgICAgICAgICBjQmF0dGxlUGFyYW1ldGVycy5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLlBpY3R1cmU+KG5ldyBNb25vSW50ZXJmYWNlLlBpY3R1cmUobmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW1wic21hbGxfaWNvbnNcIl0sIGkgKyAzKSwgMTAwICogKGkgJSAyKSwgMjIgKyAoaSAvIDIpICogMjIsIGhvckFsaWduOiAwLjBmLCB2ZXJBbGlnbjogMC4wZikpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8PSA1OyBpKyspXHJcbiAgICAgICAgICAgICAgICBsYmxzQWJpbHNbaV0gPSBmcm1IZWxwLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTG9uZ0xhYmVsPihuZXcgTW9ub0ludGVyZmFjZS5Mb25nTGFiZWwoXCLQotC40LPRgFwiLCAxMCwgQ29sb3IuQmxhY2ssIDAsIDE0MCwgMjUwLCBob3JBbGlnbjogMC4wZiwgdmVyQWxpZ246IDAuMGYpKTtcclxuXHJcblxyXG4gICAgICAgICAgICAvLyAnINCk0YDQtdC50Lwg0LHQvtC10LLQvtCz0L4g0LzQtdC90Y5cclxuICAgICAgICAgICAgZnJtQmF0dGxlTWVudSA9IE1haW5Db250YWluZXIuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5GcmFtZT4obmV3IE1vbm9JbnRlcmZhY2UuRnJhbWUoMCwgMCwgMjcwLCAzMTAsIHZpc2libGU6IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICBTaG93QW5pbWF0aW9uID0gbmV3IE1vbm9JbnRlcmZhY2UuTnVtYmVyQW5pbWF0aW9uKFwiWVwiLCAtMzAwLCAwLCA1MCwgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmcm1CYWNrLlZpc2libGUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1haW5BbmltYXRvci5BbmltYXRpb25zLlJlbW92ZShmcm1CYWNrLkhpZGVBbmltYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgZnJtQmFjay5TaG93KG1haW5BbmltYXRvcik7XHJcbiAgICAgICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgICAgIEhpZGVBbmltYXRpb24gPSBuZXcgTW9ub0ludGVyZmFjZS5OdW1iZXJBbmltYXRpb24oXCJZXCIsIDAsIDMwMCwgNTAsICgpID0+IGZybUJhY2suSGlkZShtYWluQW5pbWF0b3IpKVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgZnJtQmF0dGxlTWVudS5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkxhYmVsPihuZXcgTW9ub0ludGVyZmFjZS5MYWJlbChcItCf0LDRg9C30LBcIiwgMzAsIENvbG9yLkJsYWNrLCB5OiA3LCB2ZXJBbGlnbjogMC4wRikpO1xyXG5cclxuICAgICAgICAgICAgZnJtQmF0dGxlTWVudVxyXG4gICAgICAgICAgICAgICAgLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuQnV0dG9uPihuZXcgTW9ub0ludGVyZmFjZS5CdXR0b24oc3VycmVuZGVyRnJtQmF0dGxlTWVudV9DbGlja2VkLCAwLCA2MCwgMjUwLCA0NSwgdmVyQWxpZ246IDAuMEYpKVxyXG4gICAgICAgICAgICAgICAgLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTGFiZWw+KG5ldyBNb25vSW50ZXJmYWNlLkxhYmVsKFwi0KHQtNCw0YLRjNGB0Y9cIiwgMjAsIENvbG9yLkJsYWNrKSk7XHJcbiAgICAgICAgICAgIGZybUJhdHRsZU1lbnVcclxuICAgICAgICAgICAgICAgIC5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkJ1dHRvbj4obmV3IE1vbm9JbnRlcmZhY2UuQnV0dG9uKHJlc3RhcnRGcm1CYXR0bGVNZW51X0NsaWNrZWQsIDAsIDEyMCwgMjUwLCA0NSwgdmVyQWxpZ246IDAuMEYpKVxyXG4gICAgICAgICAgICAgICAgLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTGFiZWw+KG5ldyBNb25vSW50ZXJmYWNlLkxhYmVsKFwi0J/QtdGA0LXQt9Cw0L/Rg9GB0YLQuNGC0YxcIiwgMjAsIENvbG9yLkJsYWNrKSk7XHJcbiAgICAgICAgICAgIGxibEFJRnJtQmF0dGxlTWVudSA9IGZybUJhdHRsZU1lbnVcclxuICAgICAgICAgICAgICAgIC5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkJ1dHRvbj4obmV3IE1vbm9JbnRlcmZhY2UuQnV0dG9uKEFJRnJtQmF0dGxlTWVudV9DbGlja2VkLCAwLCAxODAsIDI1MCwgNDUsIHZlckFsaWduOiAwLjBGKSlcclxuICAgICAgICAgICAgICAgIC5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkxhYmVsPihuZXcgTW9ub0ludGVyZmFjZS5MYWJlbChcItCf0LXRgNC10LrQu9GO0YfQuNGC0Ywg0L3QsCDQmNCYXCIsIDIwLCBDb2xvci5CbGFjaykpO1xyXG4gICAgICAgICAgICBmcm1CYXR0bGVNZW51XHJcbiAgICAgICAgICAgICAgICAuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5CdXR0b24+KG5ldyBNb25vSW50ZXJmYWNlLkJ1dHRvbihiYWNrRnJtQmF0dGxlTWVudV9DbGlja2VkLCBLZXlzLkVzY2FwZSwgMCwgMjUwLCAyMjUsIDQ1LCB2ZXJBbGlnbjogMC4wRikpXHJcbiAgICAgICAgICAgICAgICAuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5MYWJlbD4obmV3IE1vbm9JbnRlcmZhY2UuTGFiZWwoXCLQndCw0LfQsNC0INCyINC40LPRgNGDXCIsIDIwLCBDb2xvci5CbGFjaykpO1xyXG5cclxuICAgICAgICAgICAgLy8gJyDQpNGA0LXQudC8INC00LjQsNC70L7Qs9CwINC30LDQstC10YDRiNC10L3QuNGPINCx0L7Rj1xyXG4gICAgICAgICAgICBmcm1EaWFsb2cgPSBNYWluQ29udGFpbmVyLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuRnJhbWU+KG5ldyBNb25vSW50ZXJmYWNlLkZyYW1lKDAsIDAsIDM3NSwgMTgwLCB2aXNpYmxlOiBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgU2hvd0FuaW1hdGlvbiA9IG5ldyBNb25vSW50ZXJmYWNlLk51bWJlckFuaW1hdGlvbihcIllcIiwgLTMwMCwgMCwgNTAsICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZnJtQmFjay5WaXNpYmxlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYWluQW5pbWF0b3IuQW5pbWF0aW9ucy5SZW1vdmUoZnJtQmFjay5IaWRlQW5pbWF0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZybUJhY2suU2hvdyhtYWluQW5pbWF0b3IpO1xyXG4gICAgICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgICAgICBIaWRlQW5pbWF0aW9uID0gbmV3IE1vbm9JbnRlcmZhY2UuTnVtYmVyQW5pbWF0aW9uKFwiWVwiLCAwLCAzMDAsIDUwLCAoKSA9PiBmcm1CYWNrLkhpZGUobWFpbkFuaW1hdG9yKSlcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGxibFRpdGxlZnJtRGlhbG9nID0gZnJtRGlhbG9nLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTGFiZWw+KG5ldyBNb25vSW50ZXJmYWNlLkxhYmVsKFwiXCIsIDMwLCBDb2xvci5CbGFjaywgeTogNywgdmVyQWxpZ246IDAuMGYpKTtcclxuXHJcbiAgICAgICAgICAgIGxibExpbmUxRnJtRGlhbG9nID0gZnJtRGlhbG9nLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTGFiZWw+KG5ldyBNb25vSW50ZXJmYWNlLkxhYmVsKFwiXCIsIDIwLCBDb2xvci5CbGFjaywgeTogNTAsIHZlckFsaWduOiAwLjBmKSk7XHJcbiAgICAgICAgICAgIGxibExpbmUyRnJtRGlhbG9nID0gZnJtRGlhbG9nLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTGFiZWw+KG5ldyBNb25vSW50ZXJmYWNlLkxhYmVsKFwiXCIsIDIwLCBDb2xvci5CbGFjaywgeTogNzAsIHZlckFsaWduOiAwLjBmKSk7XHJcblxyXG4gICAgICAgICAgICBmcm1EaWFsb2dcclxuICAgICAgICAgICAgICAgIC5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkJ1dHRvbj4obmV3IE1vbm9JbnRlcmZhY2UuQnV0dG9uKG9rYXlGcm1EaWFsb2dfQ2xpY2tlZCwgMCwgLTE1LCAxNTAsIDQ1LCB2ZXJBbGlnbjogMS4wZikpXHJcbiAgICAgICAgICAgICAgICAuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5MYWJlbD4obmV3IE1vbm9JbnRlcmZhY2UuTGFiZWwoXCLQkiDQvNC10L3RjlwiLCAyMCwgQ29sb3IuQmxhY2spKTtcclxuXHJcbiAgICAgICAgICAgIC8vICcg0KTRgNC10LnQvCDQv9C+0LTRgtCy0LXRgNC20LTQtdC90LjRj1xyXG4gICAgICAgICAgICBmcm1Db25maXJtID0gTWFpbkNvbnRhaW5lci5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkZyYW1lPihuZXcgTW9ub0ludGVyZmFjZS5GcmFtZSgwLCAwLCAzNzUsIDE1MCwgdmlzaWJsZTogZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgIFNob3dBbmltYXRpb24gPSBuZXcgTW9ub0ludGVyZmFjZS5OdW1iZXJBbmltYXRpb24oXCJZXCIsIC0zMDAsIDAsIDUwLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZybUJhY2suVmlzaWJsZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWFpbkFuaW1hdG9yLkFuaW1hdGlvbnMuUmVtb3ZlKGZybUJhY2suSGlkZUFuaW1hdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmcm1CYWNrLlNob3cobWFpbkFuaW1hdG9yKTtcclxuICAgICAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICAgICAgSGlkZUFuaW1hdGlvbiA9IG5ldyBNb25vSW50ZXJmYWNlLk51bWJlckFuaW1hdGlvbihcIllcIiwgMCwgMzAwLCA1MCwgKCkgPT4gZnJtQmFjay5IaWRlKG1haW5BbmltYXRvcikpXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBmcm1Db25maXJtLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTGFiZWw+KG5ldyBNb25vSW50ZXJmYWNlLkxhYmVsKFwi0JLRiyDRg9Cy0LXRgNC10L3Ri1wiLCAzMCwgQ29sb3IuQmxhY2ssIHk6IDcsIHZlckFsaWduOiAwLjBGKSk7XHJcblxyXG5cclxuICAgICAgICAgICAgbGJsVGV4dEZybUNvbmZpcm0gPSBmcm1Db25maXJtLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTGFiZWw+KG5ldyBNb25vSW50ZXJmYWNlLkxhYmVsKFwiXCIsIDIwLCBDb2xvci5CbGFjaywgeTogNTAsIHZlckFsaWduOiAwLjBGKSk7XHJcblxyXG4gICAgICAgICAgICBmcm1Db25maXJtXHJcbiAgICAgICAgICAgICAgICAuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5CdXR0b24+KG5ldyBNb25vSW50ZXJmYWNlLkJ1dHRvbigoYnRuLCBpc1RvdWNoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZnJtQ29uZmlybS5IaWRlKG1haW5BbmltYXRvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFza0NvbmZpcm0hPW51bGw/Z2xvYmFsOjpCcmlkZ2UuU2NyaXB0LkZyb21MYW1iZGEoKCk9PnRhc2tDb25maXJtLlNldFJlc3VsdCh0cnVlKSk6bnVsbDtcclxuICAgICAgICAgICAgICAgIH0sIEtleXMuRW50ZXIsIDE1LCAtMTAsIDE1MCwgNDUsIDAuMEYsIDEuMEYpKVxyXG4gICAgICAgICAgICAgICAgLkFkZENoaWxkPE1vbm9JbnRlcmZhY2UuTGFiZWw+KG5ldyBNb25vSW50ZXJmYWNlLkxhYmVsKFwi0JTQsFwiLCAyMCwgQ29sb3IuQmxhY2spKTtcclxuXHJcbiAgICAgICAgICAgIGZybUNvbmZpcm1cclxuICAgICAgICAgICAgICAgIC5BZGRDaGlsZDxNb25vSW50ZXJmYWNlLkJ1dHRvbj4obmV3IE1vbm9JbnRlcmZhY2UuQnV0dG9uKChidG4sIGlzVG91Y2gpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBmcm1Db25maXJtLkhpZGUobWFpbkFuaW1hdG9yKTtcclxuICAgICAgICAgICAgICAgICAgICB0YXNrQ29uZmlybSE9bnVsbD9nbG9iYWw6OkJyaWRnZS5TY3JpcHQuRnJvbUxhbWJkYSgoKT0+dGFza0NvbmZpcm0uU2V0UmVzdWx0KGZhbHNlKSk6bnVsbDtcclxuICAgICAgICAgICAgICAgIH0sIEtleXMuRXNjYXBlLCAtMTUsIC0xMCwgMTUwLCA0NSwgMS4wRiwgMS4wRikpXHJcbiAgICAgICAgICAgICAgICAuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5MYWJlbD4obmV3IE1vbm9JbnRlcmZhY2UuTGFiZWwoXCLQndC10YJcIiwgMjAsIENvbG9yLkJsYWNrKSk7XHJcblxyXG4gICAgICAgICAgICBNYWluQ29udGFpbmVyLkFwcGx5VGhlbWUoZGVmYXVsdFRoZW1lKTtcclxuICAgICAgICAgICAgTWFpbkNvbnRhaW5lci5BcHBseUxvY2FsaXphdGlvbihsb2NhbGl6ZSk7XHJcbiAgICAgICAgICAgIGZybUJhY2suQXBwbHlUaGVtZShiYWNrVGhlbWUpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5Db250YWluZXIgY0JhdHRsZVBhcmFtZXRlcnM7XHJcblxyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5MYWJlbCBsYmxVbml0TmFtZUhlbHBVbml0O1xyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5MYWJlbCBsYmxSYWNlSGVscFVuaXQ7XHJcblxyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5MYWJlbCBsYmxDb3N0TW9uZXlIZWxwVW5pdDtcclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuTGFiZWwgbGJsQ29zdERlYXRoSGVscFVuaXQ7XHJcblxyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5MYWJlbCBsYmxBdHRhY2tCYXNpY1BhcmFtcztcclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuUGljdHVyZSBwY3RBdHRhY2tCYXNpY1BhcmFtcztcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkxhYmVsW10gbGJsc0Jhc2ljUGFyYW1zID0gbmV3IE1vbm9JbnRlcmZhY2UuTGFiZWxbM107XHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkxvbmdMYWJlbFtdIGxibHNBYmlscyA9IG5ldyBNb25vSW50ZXJmYWNlLkxvbmdMYWJlbFs2XTtcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkZyYW1lIGZybUhlbHA7XHJcblxyXG5cclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuTGFiZWwgbGJsVnNQcmVHYW1lO1xyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5HcmlkIGNVbml0c1ByZUdhbWU7XHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkdyaWQgY1NwZWxsc1ByZUdhbWU7XHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkdyaWQgY0J1aWxkaW5nc1ByZUdhbWU7XHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkdyaWQgY1NlbGVjdGVkUHJlR2FtZTtcclxuICAgICAgICBwcml2YXRlIE1vbm9JbnRlcmZhY2UuQnV0dG9uIGJ0bkZpZ2h0UHJlR2FtZTtcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkJ1dHRvbiBidG5Vbml0c1ByZUdhbWU7XHJcbiAgICAgICAgcHJpdmF0ZSBNb25vSW50ZXJmYWNlLkJ1dHRvbiBidG5TcGVsbHNQcmVHYW1lO1xyXG4gICAgICAgIHByaXZhdGUgTW9ub0ludGVyZmFjZS5CdXR0b24gYnRuQnVpbGRpbmdzUHJlR2FtZTtcclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgYmFja1ByZUdhbWVfQ2xpY2tlZChNb25vSW50ZXJmYWNlLkJ1dHRvbiBidG4sIGJvb2wgaXNUb3VjaCkge1xyXG4gICAgICAgICAgICBnU3RhdGUgPSBHYW1lU3RhdGUuTWFpbk1lbnU7XHJcbiAgICAgICAgICAgIFN0YXJ0QmF0dGxlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBjbGVhclByZUdhbWVfQ2xpY2tlZChNb25vSW50ZXJmYWNlLkJ1dHRvbiBidG4sIGJvb2wgaXNUb3VjaCkge1xyXG4gICAgICAgICAgICBwcmVHYW1lVW5pdHMuQ2xlYXIoKTtcclxuICAgICAgICAgICAgcHJlR2FtZVNwZWxscy5DbGVhcigpO1xyXG4gICAgICAgICAgICBwcmVHYW1lQm9udXMuQ2xlYXIoKTtcclxuICAgICAgICAgICAgU2V0UHJlR2FtZUxpc3RzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBmaWdodFByZUdhbWVfQ2xpY2tlZChNb25vSW50ZXJmYWNlLkJ1dHRvbiBidG4sIGJvb2wgaXNUb3VjaCkge1xyXG4gICAgICAgICAgICBmcm1QcmVHYW1lLkhpZGUobWFpbkFuaW1hdG9yKTtcclxuICAgICAgICAgICAgU3RhcnRQbGF5aW5nKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIHZvaWQgYmFja0ZybVNldHRpbmdzKE1vbm9JbnRlcmZhY2UuQnV0dG9uIGJ0biwgYm9vbCBpc1RvdWNoKSB7XHJcbiAgICAgICAgICAgIGZybVNldHRpbmdzLkhpZGUobWFpbkFuaW1hdG9yKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgdm9pZCBhcHBseUZybVNldHRpbmdzKE1vbm9JbnRlcmZhY2UuQnV0dG9uIGJ0biwgYm9vbCBpc1RvdWNoKSB7XHJcbiAgICAgICAgICAgIGZybVNldHRpbmdzLkhpZGUobWFpbkFuaW1hdG9yKTtcclxuICAgICAgICAgICAgdmFyIHVpU2NhbGUgPSBzY3JlZW5Gb3JtYXRzW3Jlc1N3aXRjaGVyRnJtU2V0dGluZ3MuQ3VycmVudF0uWCAvIChkb3VibGUpODAwO1xyXG4gICAgICAgICAgICBpZiAodWlTY2FsZSA8PSAxLjI1KVxyXG4gICAgICAgICAgICAgICAgdWlTY2FsZSA9IDEuMDtcclxuICAgICAgICAgICAgZWxzZSBpZiAodWlTY2FsZSA+IDEuMjUgJiYgdWlTY2FsZSA8PSAxLjc1KVxyXG4gICAgICAgICAgICAgICAgdWlTY2FsZSA9IDEuNTtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgdWlTY2FsZSA9IDIuMDtcclxuICAgICAgICAgICAgUmVzaXplKChpbnQpc2NyZWVuRm9ybWF0c1tyZXNTd2l0Y2hlckZybVNldHRpbmdzLkN1cnJlbnRdLlgsIChpbnQpc2NyZWVuRm9ybWF0c1tyZXNTd2l0Y2hlckZybVNldHRpbmdzLkN1cnJlbnRdLlksIHJlc1N3aXRjaGVyRnJtU2V0dGluZ3MuQ3VycmVudCA9PSAyLCAoZmxvYXQpdWlTY2FsZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIExpc3Q8VmVjdG9yMz4gc2NyZWVuRm9ybWF0cztcclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIENyZWF0ZVNjcmVlbkZvcm1hdHMoKSB7XHJcbiAgICAgICAgICAgIC8vID0ge05ldyBWZWN0b3IyKDgwMCwgNDgwKSwgTmV3IFZlY3RvcjIoMTM2NiwgNzY4KSwgTmV3IFZlY3RvcjIoMTkyMCwgMTA4MCl9XHJcbiAgICAgICAgICAgIHNjcmVlbkZvcm1hdHMgPSBuZXcgTGlzdDxWZWN0b3IzPigpO1xyXG4gICAgICAgICAgICAvLyBGb3IgRWFjaCBmb3JtYXQgSW4gR3JhcGhpY3NBZGFwdGVyLkRlZmF1bHRBZGFwdGVyLlN1cHBvcnRlZERpc3BsYXlNb2Rlc1xyXG4gICAgICAgICAgICAvLyBzY3JlZW5Gb3JtYXRzLkFkZChOZXcgVmVjdG9yMyhmb3JtYXQuV2lkdGgsIGZvcm1hdC5IZWlnaHQsIGZvcm1hdC5SZWZyZXNoUmF0ZSkpXHJcbiAgICAgICAgICAgIC8vIE5leHRcclxuICAgICAgICAgICAgc2NyZWVuRm9ybWF0cy5BZGRSYW5nZShuZXdbXSB7IG5ldyBWZWN0b3IzKDgwMCwgNDgwLCA2MCksIG5ldyBWZWN0b3IzKDEzNjYsIDc2OCwgNjApLCBuZXcgVmVjdG9yMygxOTIwLCAxMDgwLCA2MCkgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIE1pY3Jvc29mdC5YbmEuRnJhbWV3b3JrO1xyXG51c2luZyBNaWNyb3NvZnQuWG5hLkZyYW1ld29yay5Db250ZW50O1xyXG51c2luZyBNaWNyb3NvZnQuWG5hLkZyYW1ld29yay5HcmFwaGljcztcclxudXNpbmcgTmV3dG9uc29mdC5Kc29uO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLklPO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgQ29uc29sZSA9IFN5c3RlbS5Db25zb2xlO1xyXG5cclxubmFtZXNwYWNlIERhcmtLaW5nZG9tQ29yZVxyXG57XHJcbiAgICBwdWJsaWMgcGFydGlhbCBjbGFzcyBNeUdhbWUge1xyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgQXBwRm9sZGVyLCBEYXRhRm9sZGVyO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHB1YmxpYyB2b2lkIExvYWREYXRhKENvbnRlbnRNYW5hZ2VyIGNvbnRlbnQgKSB7XHJcbiAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKFwiU3RhcnQgTG9jYWxpemVcIik7XHJcbiAgICAgICAgICAgIFJlYWRMb2NhbGl6ZSgpO1xyXG4gICAgICAgICAgICBDb25zb2xlLldyaXRlTGluZShcIlN0YXJ0IExvYWRpbmdcIik7XHJcblxyXG4gICAgICAgICAgICBSZWFkRm9udHMoY29udGVudCk7XHJcbiAgICAgICAgICAgIFJlYWRTcHJpdGVzKGNvbnRlbnQpO1xyXG4gICAgICAgICAgICBSZWFkVW5pdHNQYXJhbXMoKTtcclxuICAgICAgICAgICAgUmVhZFNwZWxscygpO1xyXG4gICAgICAgICAgICBSZWFkUmFjZXMoKTtcclxuXHJcbiAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKFwiU3RhcnQgSW5pdGlhbGl6aW5nXCIpO1xyXG5cclxuICAgICAgICAgICAgSW5pdGlhbGl6ZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIFQgTG9hZEpTT048VD4oc3RyaW5nIGZuYW1lKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdXNpbmcgKHZhciBmaWxlX3JlYWRlciA9IG5ldyBTdHJlYW1SZWFkZXIoc3RyaW5nLkZvcm1hdChcInswfS97MX1cIixEYXRhRm9sZGVyLGZuYW1lKSwgRW5jb2RpbmcuVVRGOCkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciBqc29uID0gZmlsZV9yZWFkZXIuUmVhZFRvRW5kKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gSnNvbkNvbnZlcnQuRGVzZXJpYWxpemVPYmplY3Q8VD4oanNvbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFJlYWRGb250cyhDb250ZW50TWFuYWdlciBjb250ZW50KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIGZvbnRzID0gTG9hZEpTT048c3RyaW5nW10+KFwiZm9udHMuanNvblwiKTtcclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIGZpbGVuYW1lIGluIGZvbnRzKVxyXG4gICAgICAgICAgICAgICAgLy8jaWYgQlJPV1NFUlxyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgRm9udHMuQWRkKChzaXplOiBpbnQuUGFyc2UoZmlsZW5hbWUuU3Vic3RyaW5nKDMpKSwgZm9udDogY29udGVudC5Mb2FkQXN5bmM8U3ByaXRlRm9udD4oJFwiRm9udHMve2ZpbGVuYW1lfVwiKSkpO1xyXG4gICAgICAgICAgICAgICAgLy8jZWxzZVxyXG4gICAgICAgICAgICAgICAgRm9udHMuQWRkKG5ldyBTeXN0ZW0uVmFsdWVUdXBsZTxpbnQsIFNwcml0ZUZvbnQ+KGludC5QYXJzZShmaWxlbmFtZS5TdWJzdHJpbmcoMykpLCBjb250ZW50LkxvYWQ8U3ByaXRlRm9udD4oc3RyaW5nLkZvcm1hdChcIkZvbnRzL3swfVwiLCBmaWxlbmFtZSkpKSk7XHJcbiAgICAgICAgICAgIC8vI2VuZGlmXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBSZWFkUmFjZXMoKSB7XHJcbiAgICAgICAgICAgIHZhciByYWNlc19kZWYgPSBMb2FkSlNPTjxSYWNlW10+KFwicmFjZXMuanNvblwiKTtcclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIHJhY2UgaW4gcmFjZXNfZGVmKVxyXG4gICAgICAgICAgICAgICAgUmFjZU1hbmFnZXIuSW5zdGFuY2UuQWxsLkFkZChyYWNlLm5hbWUsIHJhY2UpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgUmVhZFNwZWxscygpIHtcclxuICAgICAgICAgICAgdmFyIHNwZWxsc19kZWYgPSBMb2FkSlNPTjxTcGVsbFtdPihcInNwZWxscy5qc29uXCIpO1xyXG4gICAgICAgICAgICBmb3JlYWNoICh2YXIgc3BlbGwgaW4gc3BlbGxzX2RlZilcclxuICAgICAgICAgICAgICAgIHNwZWxscy5BZGQoc3BlbGwuTmFtZSwgc3BlbGwpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgUmVhZFVuaXRzUGFyYW1zKCkge1xyXG4gICAgICAgICAgICB2YXIgdW5pdHNfZGVmID0gTG9hZEpTT048VW5pdFBhcmFtZXRlcnNbXT4oXCJ1bml0cy5qc29uXCIpO1xyXG4gICAgICAgICAgICBmb3JlYWNoICh2YXIgdW5pdCBpbiB1bml0c19kZWYpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciBuZXdfdW5pdCA9IHVuaXQ7XHJcbiAgICAgICAgICAgICAgICBuZXdfdW5pdC5zcHJpdGVOYW1lID0gdW5pdC5OYW1lLlRvTG93ZXIoKTtcclxuICAgICAgICAgICAgICAgIG5ld191bml0LmFuaW1hdGVkID0gc3ByaXRlc1t1bml0Lk5hbWUuVG9Mb3dlcigpXS5SYW5nZXMuQ29udGFpbnNLZXkoXCJBdHRhY2tcIik7XHJcbiAgICAgICAgICAgICAgICBuZXdfdW5pdC5pY29uQXBwID0gbmV3IE1vbm9JbnRlcmZhY2UuQXBwZWFyYW5jZShzcHJpdGVzW1widW5pdF9pY29uc1wiXSwgbmV3X3VuaXQuaWNvbkluZCk7XHJcbiAgICAgICAgICAgICAgICBuZXdfdW5pdC5hYmlscyA9IG5ldyBEaWN0aW9uYXJ5PHN0cmluZywgQWJpbGl0eT4oKTtcclxuICAgICAgICAgICAgICAgIGlmIChuZXdfdW5pdC5yYXdBYmlscyAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKHZhciBhYmlsIGluIG5ld191bml0LnJhd0FiaWxzKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3X3VuaXQuYWJpbHMuQWRkKGFiaWwubmFtZSwgYWJpbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHVuaXQuc2l6ZS53ID4gMClcclxuICAgICAgICAgICAgICAgICAgICBuZXdfdW5pdC5yZWN0ID0gbmV3IFJlY3RhbmdsZSgtdW5pdC5zaXplLncgLyAyLCAtdW5pdC5zaXplLmgsIHVuaXQuc2l6ZS53LCB1bml0LnNpemUuaCk7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgbmV3X3VuaXQucmVjdCA9IG5ldyBSZWN0YW5nbGUoLXVzMiwgLXVuaXRTaXplLCB1bml0U2l6ZSwgdW5pdFNpemUpO1xyXG4gICAgICAgICAgICAgICAgbmV3X3VuaXQuaXNCdWlsZGluZyA9IG5ld191bml0LmFiaWxzLkNvbnRhaW5zS2V5KFwiQnVpbGRpbmdcIik7XHJcbiAgICAgICAgICAgICAgICBpZiAobmV3X3VuaXQuYWJpbHMuQ29udGFpbnNLZXkoXCJVbmlxdWVcIikgfHwgbmV3X3VuaXQuYWJpbHMuQ29udGFpbnNLZXkoXCJIZXJvaWNcIikpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3X3VuaXQubWF4TGltaXQgPSAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAobmV3X3VuaXQuYWJpbHMuQ29udGFpbnNLZXkoXCJFbGl0ZVwiKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBuZXdfdW5pdC5tYXhMaW1pdCA9IDM7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBuZXdfdW5pdC5pc0hlcm9pYyA9IG5ld191bml0LmFiaWxzLkNvbnRhaW5zS2V5KFwiSGVyb2ljXCIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKG5ld191bml0LmFiaWxzLkNvbnRhaW5zS2V5KFwiSHVnZVwiKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBuZXdfdW5pdC5tb3ZlVHlwZSA9IFVuaXRNb3ZlVHlwZS5IdWdlTVQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChuZXdfdW5pdC5hYmlscy5Db250YWluc0tleShcIkZseWluZ1wiKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBuZXdfdW5pdC5tb3ZlVHlwZSA9IFVuaXRNb3ZlVHlwZS5GbHlpbmdNVDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBuZXdfdW5pdC5tb3ZlVHlwZSA9IFVuaXRNb3ZlVHlwZS5Hcm91bmRNVDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHN0cmluZ1tdIHJlbUFiaWxzID0gbmV3W10geyBcIkhlcm9pY1wiLCBcIlVuaXF1ZVwiLCBcIkVsaXRlXCIsIFwiRmx5aW5nXCIsIFwiSHVnZVwiLCBcIlwiIH07XHJcbiAgICAgICAgICAgICAgICBmb3JlYWNoICh2YXIgYWIgaW4gcmVtQWJpbHMpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5ld191bml0LmFiaWxzLkNvbnRhaW5zS2V5KGFiKSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld191bml0LmFiaWxzLlJlbW92ZShhYik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHVuaXQuaXNTdGFydEJ1aWxkaW5nKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0QnVpbGRpbmdzTGlzdC5BZGQodW5pdC5OYW1lKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHVuaXRQcm1zLkFkZCh1bml0Lk5hbWUsIG5ld191bml0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgUmVhZFNwcml0ZXMoQ29udGVudE1hbmFnZXIgY29udGVudCkge1xyXG4gICAgICAgICAgICB2YXIgc3ByaXRlc19kZWYgPSBMb2FkSlNPTjxNb25vSW50ZXJmYWNlLlNwcml0ZVtdPihcInNwcml0ZXMuanNvblwiKTtcclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIHNwcml0ZSBpbiBzcHJpdGVzX2RlZikge1xyXG4gICAgICAgICAgICAgICAgc3ByaXRlLlRleHR1cmUgPSBjb250ZW50LkxvYWQ8VGV4dHVyZTJEPihzdHJpbmcuRm9ybWF0KFwiU3ByaXRlcy97MH1cIixzcHJpdGUuTmFtZSkpO1xyXG4gICAgICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoc3RyaW5nLkZvcm1hdChcIlNwcml0ZSAnezB9JyBsb2FkZWRcIixzcHJpdGUuTmFtZSkpO1xyXG4gICAgICAgICAgICAgICAgc3ByaXRlcy5BZGQoc3ByaXRlLk5hbWUsIHNwcml0ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFJlYWRMb2NhbGl6ZSgpIHtcclxuICAgICAgICAgICAgdmFyIGxvYWRlZCA9IExvYWRKU09OPERpY3Rpb25hcnk8c3RyaW5nLCBzdHJpbmc+PihcImxvY2FsaXplLXJ1Lmpzb25cIik7XHJcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBuZXcgRGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4oKTtcclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIGt2cCBpbiBsb2FkZWQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBpc19mYWxsYmFjayA9IGt2cC5WYWx1ZS5Db250YWlucyhcIlxcdUZGRkRcIik7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQuQWRkKGt2cC5LZXksIGt2cC5WYWx1ZS5SZXBsYWNlKCdcXHVGRkZEJywgJz8nKSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNfZmFsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgICAgICBTeXN0ZW0uQ29uc29sZS5Xcml0ZUxpbmUoa3ZwLlZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsb2NhbGl6ZSA9IG5ldyBNb25vSW50ZXJmYWNlLkxvY2FsaXphdGlvbihcItCg0YPRgdGB0LrQuNC5XCIsIHJlc3VsdCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxufSIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcblxyXG5uYW1lc3BhY2UgRGFya0tpbmdkb21Db3JlIHtcclxuICAgIHBhcnRpYWwgY2xhc3MgTXlHYW1lIHtcclxuICAgICAgICBwdWJsaWMgVW5pdFBhcmFtZXRlcnM/IEdldFVuaXRQYXJhbWV0ZXJzRnJvbUlEKGludCBpZClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKHZhciB1cCBpbiB1bml0UHJtcy5WYWx1ZXMpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmICh1cC5pZCA9PSBpZClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBPblVuaXRzQWJpbHMoVW5pdCB1KSB7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKHZhciBhYmlsIGluIHUuYWJpbHMuVmFsdWVzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYWJpbC5jb25kQ29tcGxldGVkICYmICFhYmlsLnVzZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbC5uYW1lID09IFwiUnVzaFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBscnNbdS5vd25lcl0ucnVzaEJvbnVzICs9IGFiaWwudmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFiaWwudXNlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhYmlsLm5hbWUgPT0gXCJLaWxsX2ZseWVyXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHV1ID0gRmluZFJhbmRvbUZseVVuaXQoMSAtIHUub3duZXIsIDUwMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1dSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBLaWxsKHV1KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwi0KPQvdC40YfRgtC+0LbQtdC9XCIsIGJhZEFiaWxDbHIsIHV1LngsIGhvciArIHV1LnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFiaWwudXNlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhYmlsLm5hbWUgPT0gXCJNYWdpY19ib251c1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBscnNbdS5vd25lcl0ubWFnaWNJbmNCb251cyArPSBhYmlsLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWJpbC5uYW1lID09IFwiUG9pc29uX2JvbnVzXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGxyc1t1Lm93bmVyXS5wb2lzb25Cb251cyArPSBhYmlsLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWJpbC5uYW1lID09IFwiU3RlYWxpbmdcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwbHJzWzEgLSB1Lm93bmVyXS5tb25leUluY0JvbnVzIC09IDEwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwbHJzW3Uub3duZXJdLm1vbmV5SW5jQm9udXMgKz0gMTA7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhYmlsLm5hbWUgPT0gXCJDaGFvc1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdS5BYnNDb250YWlucyhcIkNoYW9zIGhlbHBlclwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTGlzdDxzdHJpbmc+IGF2dW5pdHMgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICh2YXIgdXUgaW4gcGxyc1sxIC0gdS5vd25lcl0udW5pdHNMaXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFwbHJzWzEgLSB1Lm93bmVyXS5iYW5uZWQuQ29udGFpbnModXUpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdnVuaXRzLkFkZCh1dSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXZ1bml0cy5Db3VudCA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdS5BZGRBYmlsaXR5KG5ldyBBYmlsaXR5KFwiQ2hhb3MgaGVscGVyXCIsIHVuaXRQcm1zW2F2dW5pdHNbcm5kLk5leHQoYXZ1bml0cy5Db3VudCldXS5pZCwgXCJcIiwgMCwgRWZmZWN0VHlwZS5Ob3JtYWwsIGZhbHNlKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFiaWwubmFtZSA9PSBcIkNoYW9zIGhlbHBlclwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1bml0X3BhcmFtZXRlcnMgPSBHZXRVbml0UGFyYW1ldGVyc0Zyb21JRChhYmlsLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVuaXRfcGFyYW1ldGVycy5IYXNWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxyc1sxIC0gdS5vd25lcl0uYmFubmVkLkFkZCh1bml0X3BhcmFtZXRlcnMuVmFsdWUuTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFiaWwubmFtZSA9PSBcIlB1YmxpY2FuXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGxyc1t1Lm93bmVyXS5tb25leUluY0JvbnVzICs9IDUgKiBwbHJzW3Uub3duZXJdLnVuaXRDb3VudDtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFiaWwubmFtZSA9PSBcIkJsb2NrIHByb2RcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwbHJzWzBdLnByZFNwZCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBscnNbMV0ucHJkU3BkID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFiaWwubmFtZSA9PSBcIklnbm9yZV91bml0c1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHUucGFyYW1ldGVycy5pc0lnbm9yZVVuaXRzID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFiaWwubmFtZSA9PSBcIlRha2VvZmZcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodS5wYXJhbWV0ZXJzLm1vdmVUeXBlID09IFVuaXRNb3ZlVHlwZS5Hcm91bmRNVClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUudGFrZWRPZmYgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1LmFiaWxzW1wiVGFrZW9mZlwiXS51c2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFiaWwubmFtZSA9PSBcIkxhbmRpbmdcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodS5wYXJhbWV0ZXJzLm1vdmVUeXBlID09IFVuaXRNb3ZlVHlwZS5GbHlpbmdNVClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUubGFuZGluZyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHUuYWJpbHNbXCJMYW5kaW5nXCJdLnVzZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWJpbC5uYW1lID09IFwiRWxpdGVfYXJjaGVyXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIHV1IGluIHVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodSAhPSB1dSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1dS5vd25lciA9PSB1Lm93bmVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1dS5wYXJhbWV0ZXJzLkF0dGFjay5SYW5nZSA+IDEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dS5hdGtNb2QuUmFuZ2UgKz0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFiaWwubmFtZSA9PSBcIktpbGwgYWxsXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIHV1IGluIHVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXV1LnBhcmFtZXRlcnMuaXNCdWlsZGluZylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBLaWxsKHV1KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBnbG9iYWxFeHBsb2RlID0gMjU1O1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWJpbC5uYW1lID09IFwiQmlnX2Jvb21cIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICh2YXIgdXUgaW4gdW5pdHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhhcm0odXUsIHJuZC5OZXh0KDEwMDAsIDIwMDApLCBmYWxzZSwgRWZmZWN0VHlwZS5Ob3JtYWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9pc29uKHV1KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBnbG9iYWxFeHBsb2RlID0gMjU1O1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWJpbC5uYW1lID09IFwiUmFuZ2VfYm9udXNcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1LmF0a01vZC5SYW5nZSArPSBhYmlsLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWJpbC5uYW1lID09IFwiUHJvZF9ib29zdFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBscnNbdS5vd25lcl0ucHJkU3BkICo9ICgxICsgKGZsb2F0KWFiaWwudmFsdWUgLyAxMDApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWJpbC5uYW1lID09IFwiVGltZV9jb250cm9sXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIHAgaW4gcGxycylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAucHJkU3BkIC89IDI7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhYmlsLm5hbWUgPT0gXCJDZW50YXVyX3Byb2RfYm9vc3RcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICh2YXIgdXUgaW4gdW5pdHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1dS5vd25lciA9PSB1Lm93bmVyICYmICgodXUub3duZXIgPT0gMCAmJiB1dS54ID49IGdhbWVXaWR0aCAvIDIpIHx8ICh1dS5vd25lciA9PSAxICYmIHV1LnggPD0gZ2FtZVdpZHRoIC8gMikpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxyc1t1Lm93bmVyXS5wcmRTcGQgKj0gKDEgKyAoZmxvYXQpYWJpbC52YWx1ZSAvIDEwMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFiaWwubmFtZSA9PSBcIlNsb3dfcHJvZHVjdGlvblwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBscnNbMSAtIHUub3duZXJdLnByZFNwZCAvPSAxLjVmO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWJpbC5uYW1lID09IFwiUmVjaGFyZ2VcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICh2YXIgYWEgaW4gdS5hYmlscy5WYWx1ZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYS51c2VkID09IHRydWUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWEudXNlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKFwi0J/QtdGA0LXQt9Cw0YDRj9C00LrQsCFcIiwgZ29vZEFiaWxDbHIsIHUueCwgaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdS5hYmlsc1tcIlJlY2hhcmdlXCJdLnVzZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWJpbC5uYW1lID09IFwiTHljYW50aHJvcHlcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmV3X3VuaXRfcGFyYW1ldGVycyA9IEdldFVuaXRQYXJhbWV0ZXJzRnJvbUlEKGFiaWwudmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV3X3VuaXRfcGFyYW1ldGVycy5IYXNWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IG9sZG1heGhwID0gdS5wYXJhbWV0ZXJzLm1heGhwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nIG9sZG5hbWUgPSB1LnBhcmFtZXRlcnMuTmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUuU2V0UGFyYW1zKG5ld191bml0X3BhcmFtZXRlcnMuVmFsdWUsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUuaHAgKj0gdS5wYXJhbWV0ZXJzLm1heGhwIC8gb2xkbWF4aHA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCb0LjQutCw0L3RgtGA0L7Qv9C40Y9cIiwgZ29vZEFiaWxDbHIsIHUueCwgaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNob3dJbmZvUGFyKHN0cmluZy5Gb3JtYXQoXCJXcm9uZyB1bml0IGlkIC0gezB9XCIsYWJpbC52YWx1ZSksIGJhZEFiaWxDbHIsIHUueCwgaG9yICsgdS5wYXJhbWV0ZXJzLnJlY3QuVG9wLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWJpbC5uYW1lID09IFwiSW52dWxuZXJhYmxlXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUuc2hvd25BYmlsID09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUuc2hvd25BYmlsID0gXCJJbnZ1bG5lcmFibGVcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUuc2hvd25BYmlsTWF4VmFsID0gYWJpbC52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhYmlsLnZhbHVlIC09IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYmlsLnZhbHVlID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUuYWJpbHNbXCJJbnZ1bG5lcmFibGVcIl0udXNlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1LnNob3duQWJpbCA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFiaWwubmFtZSA9PSBcIlBvaXNvbl9hcm91bmRcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICh2YXIgdXUgaW4gdW5pdHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1dSAhPSB1ICYmIHUuTmVhcih1dSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9pc29uKHV1KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWJpbC5uYW1lID09IFwiR2VuZXJhdGVcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmV3X3VuaXRfcGFyYW1ldGVycyA9IEdldFVuaXRQYXJhbWV0ZXJzRnJvbUlEKGFiaWwudmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV3X3VuaXRfcGFyYW1ldGVycy5IYXNWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9ybkxpc3QuQWRkKG5ldyBVbml0KHRoaXMsIHUueCwgdS5tb3Zlc2lkZSwgdS5vd25lciwgbmV3X3VuaXRfcGFyYW1ldGVycy5WYWx1ZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhYmlsLm5hbWUgPT0gXCJHZW5lcmF0ZSBlbmVteVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1bml0X3BhcmFtZXRlcnMgPSBHZXRVbml0UGFyYW1ldGVyc0Zyb21JRChhYmlsLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVuaXRfcGFyYW1ldGVycy5IYXNWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9ybkxpc3QuQWRkKG5ldyBVbml0KHRoaXMsIHUueCwgcGxyc1sxIC0gdS5vd25lcl0ubW92ZXNpZGUsIDEgLSB1Lm93bmVyLCB1bml0X3BhcmFtZXRlcnMuVmFsdWUpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWJpbC5uYW1lID09IFwiU3VtbW9uX2lob3JcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBib3JuTGlzdC5BZGQobmV3IFVuaXQodGhpcywgdS54LCB1Lm1vdmVzaWRlLCB1Lm93bmVyLCB1bml0UHJtc1tcIklob3JcIl0pKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYm9ybkxpc3QuQWRkKG5ldyBVbml0KHRoaXMsIHUueCAtIHUubW92ZXNpZGUgKiB1czIsIHUubW92ZXNpZGUsIHUub3duZXIsIHVuaXRQcm1zW1wiSWhvclwiXSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBTaG93SW5mb1BhcihcItCg0LDRgdC/0LDQtFwiLCBnb29kQWJpbENsciwgdS54LCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWJpbC5uYW1lID09IFwiU3VtbW9uX2NlbnRhdXJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gYXZ1bml0cyA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIHV1IGluIHVuaXRQcm1zLlZhbHVlcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHV1LlN1YnJhY2UgPT0gXCJDZW50YXVyXCIgJiYgISh1dS5OYW1lID09IHUucGFyYW1ldGVycy5OYW1lKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdnVuaXRzLkFkZCh1dS5OYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBib3JuTGlzdC5BZGQobmV3IFVuaXQodGhpcywgdS54ICsgMiAqIHUubW92ZXNpZGUsIHUubW92ZXNpZGUsIHUub3duZXIsIHVuaXRQcm1zW2F2dW5pdHNbcm5kLk5leHQoYXZ1bml0cy5Db3VudCldXSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhYmlsLnVzZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWJpbC5uYW1lID09IFwiRWNvbm9teVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBscnNbdS5vd25lcl0ucmVzLk1vbmV5ICs9IHUucGFyYW1ldGVycy5Db3N0Lk1vbmV5IC8gMjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgU2hvd0luZm9QYXIoc3RyaW5nLkZvcm1hdChcIit7MH1cIix1LnBhcmFtZXRlcnMuQ29zdC5Nb25leSAvIDIpLCBtb25leUNsciwgdS54LCBob3IgKyB1LnBhcmFtZXRlcnMucmVjdC5Ub3AsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWJpbC5uYW1lID09IFwiTGV2aXRhdGlvbl9hcm91bmRcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICh2YXIgdXUgaW4gdW5pdHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1dS5vd25lciAhPSB1Lm93bmVyICYmIHUuTmVhcih1dSkgJiYgdXUucGFyYW1ldGVycy5tb3ZlVHlwZSA9PSBVbml0TW92ZVR5cGUuR3JvdW5kTVQgJiYgIXV1LnBhcmFtZXRlcnMuaXNCdWlsZGluZylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dS50YWtlZE9mZiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFiaWwubmFtZSA9PSBcIkhlYWxfZGVtb25zXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIHV1IGluIHVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodSAhPSB1dSAmJiB1Lm93bmVyID09IHV1Lm93bmVyICYmIHV1LnBhcmFtZXRlcnMuUmFjZSA9PSBcIkRlbW9uc1wiICYmICF1dS5wYXJhbWV0ZXJzLmlzQnVpbGRpbmcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIZWFsKHV1LCBybmQuTmV4dCg0MCwgNTEpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dS5BdHRhY2sgKz0gMztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWJpbC5uYW1lID09IFwiRXhwbG9zaXZlXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgRXhwbG9kZSh1LCB1LkFic0NvbnRhaW5zKFwiTWFnZVwiKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhYmlsLm5hbWUgPT0gXCJJbnZpc2libGVcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICh2YXIgdXUgaW4gdW5pdHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1dS5vd25lciAhPSB1Lm93bmVyICYmIHUuTmVhcih1dSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVpbnZpc2libGUodSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFiaWwubmFtZSA9PSBcIkNsZWFyX21pbmRcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXUgPSBGaW5kUmFuZG9tVW5mbHlVbml0KDEgLSB1Lm93bmVyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHV1ICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV1LnB1cmlmaWVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUuYWJpbHNbXCJDbGVhcl9taW5kXCJdLnVzZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG5cclxubmFtZXNwYWNlIERhcmtLaW5nZG9tQ29yZSB7XHJcbiAgICBwdWJsaWMgY2xhc3MgUGxheWVyIHtcclxuICAgICAgICBwdWJsaWMgaW50IGlkO1xyXG5cclxuICAgICAgICBwdWJsaWMgaW50IG1vdmVzaWRlO1xyXG5cclxuICAgICAgICBwdWJsaWMgaW50IGJhc2VYO1xyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgaGVybztcclxuICAgICAgICBwdWJsaWMgVW5pdCBoZXJvVW5pdDtcclxuXHJcbiAgICAgICAgcHVibGljIFRpbWVDb3N0IHJlcztcclxuICAgICAgICBwdWJsaWMgc3RyaW5nIHJhY2UgPSBcIlwiO1xyXG4gICAgICAgIHB1YmxpYyBib29sIEFJO1xyXG5cclxuICAgICAgICBwdWJsaWMgaW50IGN1ckFJVmFsO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgbWF4QUlWYWw7XHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgdUNvdW50O1xyXG4gICAgICAgIHB1YmxpYyBpbnQgc3RhcnRJbmNvO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgbWFnaWNJbmNCb251cztcclxuICAgICAgICBwdWJsaWMgaW50IG1vbmV5SW5jQm9udXM7XHJcbiAgICAgICAgcHVibGljIGludCBpcHQ7XHJcbiAgICAgICAgcHVibGljIGludCByZXNEZWxheSA9IDQ1MDtcclxuXHJcbiAgICAgICAgcHVibGljIGludCBzeW1iO1xyXG5cclxuICAgICAgICBwdWJsaWMgTGlzdDxzdHJpbmc+IHVuaXRzTGlzdCA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuICAgICAgICBwdWJsaWMgTGlzdDxzdHJpbmc+IHNwbGxzTGlzdCA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuICAgICAgICBwdWJsaWMgTGlzdDxzdHJpbmc+IGJvbnVzTGlzdCA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBMaXN0PHN0cmluZz4gcmVhZHlVbml0cyA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuICAgICAgICBwdWJsaWMgTGlzdDxzdHJpbmc+IHByZFEgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IHByZFByZywgcHJkU3BkO1xyXG5cclxuXHJcbiAgICAgICAgcHVibGljIGludCBzdGF0RGVhdGhzID0gMDtcclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgY2FzdGxlRmlsZU5hbWUgPSBcImhxc1wiO1xyXG5cclxuXHJcbiAgICAgICAgcHVibGljIGludCBwb2lzb25Cb251cztcclxuXHJcbiAgICAgICAgcHVibGljIGludCB2aWN0aW1jb3VudDtcclxuXHJcbiAgICAgICAgcHVibGljIExpc3Q8c3RyaW5nPiBiYW5uZWQgPSBuZXcgTGlzdDxzdHJpbmc+KCk7XHJcblxyXG4gICAgICAgIHB1YmxpYyBMaXN0PGZsb2F0PiBzcGVsbHNSY2hyZztcclxuXHJcbiAgICAgICAgcHVibGljIGludCBydXNoQm9udXM7XHJcblxyXG4gICAgICAgIHB1YmxpYyBNeUdhbWUgZ2FtZTtcclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgUmVzZXQoTWF0Y2hDb25kaXRpb24gY29uZCkge1xyXG4gICAgICAgICAgICBpZiAoaWQgPT0gMClcclxuICAgICAgICAgICAgICAgIFJlc291cmNlcyA9IGNvbmQucmVzMTtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgUmVzb3VyY2VzID0gY29uZC5yZXMyO1xyXG4gICAgICAgICAgICByZXMuVGllciA9IGNvbmQucmVzMS5UaWVyO1xyXG4gICAgICAgICAgICBzdGFydEluY28gPSBjb25kLmluY29tZTtcclxuICAgICAgICAgICAgaXB0ID0gY29uZC5pcHQ7XHJcbiAgICAgICAgICAgIHVuaXRDb3VudCA9IDA7XHJcbiAgICAgICAgICAgIHByZFEuQ2xlYXIoKTtcclxuICAgICAgICAgICAgcmVhZHlVbml0cy5DbGVhcigpO1xyXG4gICAgICAgICAgICBwcmRQcmcgPSAwO1xyXG4gICAgICAgICAgICBzdGF0RGVhdGhzID0gMDtcclxuICAgICAgICAgICAgcmVzRGVsYXkgPSA0NTA7XHJcbiAgICAgICAgICAgIHZpY3RpbWNvdW50ID0gMDtcclxuICAgICAgICAgICAgYmFubmVkLkNsZWFyKCk7XHJcbiAgICAgICAgICAgIHNwZWxsc1JjaHJnID0gbmV3IExpc3Q8ZmxvYXQ+KCk7XHJcbiAgICAgICAgICAgIHJ1c2hCb251cyA9IDA7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIFBsYXllcihNeUdhbWUgZ2FtZSwgaW50IGksIGJvb2wgYSwgaW50IGFpdGljaykge1xyXG4gICAgICAgICAgICB0aGlzLmdhbWUgPSBnYW1lO1xyXG4gICAgICAgICAgICBpZCA9IGk7XHJcbiAgICAgICAgICAgIEFJID0gYTtcclxuICAgICAgICAgICAgcmVzLlRpZXIgPSAxO1xyXG4gICAgICAgICAgICBjdXJBSVZhbCA9IGFpdGljaztcclxuICAgICAgICAgICAgbWF4QUlWYWwgPSBhaXRpY2s7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIGludCB1bml0Q291bnQge1xyXG4gICAgICAgICAgICBnZXQge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHVDb3VudDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXQge1xyXG4gICAgICAgICAgICAgICAgdUNvdW50ID0gdmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgVGltZUNvc3QgUmVzb3VyY2VzIHtcclxuICAgICAgICAgICAgZ2V0IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0IHtcclxuICAgICAgICAgICAgICAgIHJlcyA9IHZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBoYXNVbml0KHN0cmluZyBuYW1lKSB7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKFVuaXQgdSBpbiBNeUdhbWUudW5pdHMpIHtcclxuICAgICAgICAgICAgICAgIGlmICh1Lm93bmVyID09IGlkICYmIHUucGFyYW1ldGVycy5OYW1lID09IG5hbWUpXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgQ2hlY2tGb3JQcm9kdWNlKHN0cmluZyBuYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBwcmRRLkNvdW50ICsgcmVhZHlVbml0cy5Db3VudCA8IDcgJiYgcmVzLkVub3VnaEZvcihNeUdhbWUudW5pdFBybXNbbmFtZV0uQ29zdCkgJiYgQ2hlY2tGb3JMaW1pdChuYW1lKSAmJiAhYmFubmVkLkNvbnRhaW5zKG5hbWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgQ2hlY2tGb3JMaW1pdChzdHJpbmcgbmFtZSkge1xyXG4gICAgICAgICAgICBpZiAoTXlHYW1lLnVuaXRQcm1zW25hbWVdLmlzSGVyb2ljKSB7XHJcbiAgICAgICAgICAgICAgICBpbnQgdG1wID0gMDtcclxuICAgICAgICAgICAgICAgIGZvcmVhY2ggKFVuaXQgdSBpbiBNeUdhbWUudW5pdHMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodS5vd25lciA9PSBpZCAmJiB1LnBhcmFtZXRlcnMuaXNIZXJvaWMpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRtcCArPSAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAoc3RyaW5nIHUgaW4gcHJkUSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChNeUdhbWUudW5pdFBybXNbdV0uaXNIZXJvaWMpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRtcCArPSAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIHUgaW4gcmVhZHlVbml0cykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1ID09IG5hbWUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRtcCArPSAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRtcCA9PSAwO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKE15R2FtZS51bml0UHJtc1tuYW1lXS5tYXhMaW1pdCA9PSAwKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaW50IHRtcCA9IDA7XHJcbiAgICAgICAgICAgICAgICBmb3JlYWNoIChVbml0IHUgaW4gTXlHYW1lLnVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHUub3duZXIgPT0gaWQgJiYgdS5wYXJhbWV0ZXJzLk5hbWUgPT0gbmFtZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG1wICs9IDE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBmb3JlYWNoIChzdHJpbmcgdSBpbiBwcmRRKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHUgPT0gbmFtZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG1wICs9IDE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBmb3JlYWNoICh2YXIgdSBpbiByZWFkeVVuaXRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHUgPT0gbmFtZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG1wICs9IDE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdG1wIDwgTXlHYW1lLnVuaXRQcm1zW25hbWVdLm1heExpbWl0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIGludCBhaWRlZmVuY2VzdHJlYWs7XHJcbiAgICAgICAgcHVibGljIGludCBhaXN1cHBvcnRzdHJlYWs7XHJcblxyXG4gICAgICAgIHByaXZhdGUgYm9vbCBwcm9kc3VwcG9ydDtcclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgQUlUaWNrKE15R2FtZSBtYykge1xyXG4gICAgICAgICAgICBpZiAocmVzLkRlYXRoID49IDE1ICYmIHJlcy5UaWVyID09IDEpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXMuTW9uZXkgPj0gMTUwKVxyXG4gICAgICAgICAgICAgICAgICAgIG1jLlRyeUFkZFRvUXVldWVVbml0KHRoaXMsIFwiVGllcl8yXCIpOyAvLyDQkNC/0LPRgNC10LnQtFxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzLkRlYXRoID49IDE1ICYmIHJlcy5UaWVyID09IDIpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXMuTW9uZXkgPj0gMTUwKVxyXG4gICAgICAgICAgICAgICAgICAgIG1jLlRyeUFkZFRvUXVldWVVbml0KHRoaXMsIFwiVGllcl8zXCIpOyAgLy8g0JDQv9Cz0YDQtdC50LRcclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHVuaXRDb3VudCA8IDEzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocHJkUS5Db3VudCA8IDIpIHtcclxuICAgICAgICAgICAgICAgICAgICBMaXN0PHN0cmluZz4gYXZ1bml0cyA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuICAgICAgICAgICAgICAgICAgICBwcm9kc3VwcG9ydCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1bml0Q291bnQgPiAwIHx8IGFpZGVmZW5jZXN0cmVhayA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFpc3VwcG9ydHN0cmVhayA+IDAgJiYgYWlzdXBwb3J0c3RyZWFrIDwgMiB8fCBhaWRlZmVuY2VzdHJlYWsgPj0gMSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2RzdXBwb3J0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoc3RyaW5nIHUgaW4gdW5pdHNMaXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChNeUdhbWUudW5pdFBybXNbdV0uc3VwcG9ydCA9PSBwcm9kc3VwcG9ydCAmJiBDaGVja0ZvclByb2R1Y2UodSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdnVuaXRzLkFkZCh1KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGF2dW5pdHMuQ291bnQgPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYy5UcnlBZGRUb1F1ZXVlVW5pdCh0aGlzLCBhdnVuaXRzW015R2FtZS5ybmQuTmV4dCgwLCBhdnVuaXRzLkNvdW50KV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHVuaXRzTGlzdC5Db3VudCA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1jLlRyeUFkZFRvUXVldWVVbml0KHRoaXMsIHVuaXRzTGlzdFtNeUdhbWUucm5kLk5leHQoMCwgdW5pdHNMaXN0LkNvdW50KV0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG5cclxubmFtZXNwYWNlIERhcmtLaW5nZG9tQ29yZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgUHJvZmlsZVxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgbmFtZTtcclxuICAgICAgICBwdWJsaWMgaW50IGF2SWQ7XHJcbiAgICAgICAgcHVibGljIExpc3Q8c3RyaW5nPiB1bml0cyA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuICAgICAgICBwdWJsaWMgaW50IGRpZmZpY3VsdCA9IDE7XHJcbiAgICAgICAgcHVibGljIERpY3Rpb25hcnk8c3RyaW5nLCBpbnQ+IHJhY2VzUGxheXMgPSBuZXcgRGljdGlvbmFyeTxzdHJpbmcsIGludD4oKSwgcmFjZXNXaW5zID0gbmV3IERpY3Rpb25hcnk8c3RyaW5nLCBpbnQ+KCk7XHJcbiAgICAgICAgcHVibGljIGludCBtaW52aWN0aW1zLCBtYXhraWxscztcclxuICAgICAgICBwdWJsaWMgRGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4gYWNoaXZzID0gbmV3IERpY3Rpb25hcnk8c3RyaW5nLCBzdHJpbmc+KCk7XHJcbiAgICAgICAgcHVibGljIGludCBjcnlzdGFscztcclxuICAgICAgICBwdWJsaWMgaW50IG1heEN1c3RvbVJhY2VzO1xyXG5cclxuICAgICAgICBwdWJsaWMgUHJvZmlsZShzdHJpbmcgbmFtLCBpbnQgYXYsIGludCBkLCBMaXN0PHN0cmluZz4gdW50cywgRGljdGlvbmFyeTxzdHJpbmcsIGludD4gclBscywgRGljdGlvbmFyeTxzdHJpbmcsIGludD4gclducywgaW50IG12LCBpbnQgbWssIERpY3Rpb25hcnk8c3RyaW5nLCBzdHJpbmc+IGFjaHZzLCBpbnQgY3JzdCwgaW50IG1heEN1c3RvbVJhY3MpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBuYW1lID0gbmFtO1xyXG4gICAgICAgICAgICBhdklkID0gYXY7XHJcbiAgICAgICAgICAgIHVuaXRzID0gdW50cztcclxuICAgICAgICAgICAgZGlmZmljdWx0ID0gZDtcclxuICAgICAgICAgICAgcmFjZXNQbGF5cyA9IHJQbHM7XHJcbiAgICAgICAgICAgIHJhY2VzV2lucyA9IHJXbnM7XHJcbiAgICAgICAgICAgIG1pbnZpY3RpbXMgPSBtdjtcclxuICAgICAgICAgICAgbWF4a2lsbHMgPSBtaztcclxuICAgICAgICAgICAgYWNoaXZzID0gYWNodnM7XHJcbiAgICAgICAgICAgIGNyeXN0YWxzID0gY3JzdDtcclxuICAgICAgICAgICAgbWF4Q3VzdG9tUmFjZXMgPSBtYXhDdXN0b21SYWNzO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2xhc3MgUHJvZmlsZU1hbmFnZXJcclxuICAgIHtcclxuICAgICAgICBwcml2YXRlIHN0YXRpYyBQcm9maWxlTWFuYWdlciBfaW5zdGFuY2U7XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgUHJvZmlsZU1hbmFnZXIgSW5zdGFuY2VcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoX2luc3RhbmNlID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgX2luc3RhbmNlID0gbmV3IFByb2ZpbGVNYW5hZ2VyKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX2luc3RhbmNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgTGlzdDxQcm9maWxlPiBBbGwgPSBuZXcgTGlzdDxQcm9maWxlPigpO1xyXG4gICAgfVxyXG59XHJcbiIsIm5hbWVzcGFjZSBEYXJrS2luZ2RvbUNvcmVcclxue1xyXG4gICAgY2xhc3MgUHVyY2hhc2VcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgc3RyaW5nIG5hbWU7XHJcbiAgICAgICAgcHVibGljIGludCBjcnlzdGFscztcclxuICAgICAgICBwdWJsaWMgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlIHVJY29uO1xyXG5cclxuICAgICAgICBwdWJsaWMgUHVyY2hhc2Uoc3RyaW5nIG5hbSwgTW9ub0ludGVyZmFjZS5BcHBlYXJhbmNlIHVpLCBpbnQgY3JzdClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIG5hbWUgPSBuYW07XHJcbiAgICAgICAgICAgIHVJY29uID0gdWk7XHJcbiAgICAgICAgICAgIGNyeXN0YWxzID0gY3JzdDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIE5ld3RvbnNvZnQuSnNvbjtcclxuXHJcbm5hbWVzcGFjZSBEYXJrS2luZ2RvbUNvcmVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIFJhY2VcclxuICAgIHtcclxuXHJcbiAgICAgICAgW0pzb25Qcm9wZXJ0eShcIm5hbWVcIildXHJcbiAgICAgICAgcHVibGljIHN0cmluZyBuYW1lO1xyXG5cclxuICAgICAgICBbSnNvblByb3BlcnR5KFwiRGVzY1wiKV1cclxuICAgICAgICBwdWJsaWMgc3RyaW5nIGRlc2M7XHJcblxyXG4gICAgICAgIFtKc29uUHJvcGVydHkoXCJzeW1iXCIpXVxyXG4gICAgICAgIHB1YmxpYyBpbnQgc3ltYjtcclxuXHJcbiAgICAgICAgW0pzb25Qcm9wZXJ0eShcIm5vQUlcIildXHJcbiAgICAgICAgcHVibGljIGJvb2wgbm9BSTtcclxuXHJcbiAgICAgICAgW0pzb25Qcm9wZXJ0eShcInNwZWNpYWxcIildXHJcbiAgICAgICAgcHVibGljIGJvb2wgc3BlY2lhbDtcclxuXHJcbiAgICAgICAgW0pzb25Qcm9wZXJ0eShcImRpc2FibGVSZXdhcmRzXCIpXVxyXG4gICAgICAgIHB1YmxpYyBib29sIGRpc2FibGVSZXdhcmRzO1xyXG5cclxuICAgICAgICBwdWJsaWMgc3RyaW5nIG5pY2sgPSBcIlwiO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHB1YmxpYyBib29sIGN1c3RvbTtcclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgRW5hYmxlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHNwZWNpYWwgPSBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBSYWNlKHN0cmluZyBubWUsIHN0cmluZyBkc2MsIHN0cmluZyBuaWMsIGludCBzeW0sIGJvb2wgbmFpLCBib29sIGNzdCwgYm9vbCBzcGxjLCBib29sIGRyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbmFtZSA9IG5tZTtcclxuICAgICAgICAgICAgZGVzYyA9IGRzYztcclxuICAgICAgICAgICAgc3ltYiA9IHN5bTtcclxuICAgICAgICAgICAgbm9BSSA9IG5haTtcclxuICAgICAgICAgICAgY3VzdG9tID0gY3N0O1xyXG4gICAgICAgICAgICBzcGVjaWFsID0gc3BsYztcclxuICAgICAgICAgICAgbmljayA9IG5pYztcclxuICAgICAgICAgICAgZGlzYWJsZVJld2FyZHMgPSBkcjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGNsYXNzIFJhY2VNYW5hZ2VyXHJcbiAgICB7XHJcbiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgUmFjZU1hbmFnZXIgX2luc3RhbmNlO1xyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFJhY2VNYW5hZ2VyIEluc3RhbmNlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKF9pbnN0YW5jZSA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIF9pbnN0YW5jZSA9IG5ldyBSYWNlTWFuYWdlcigpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9pbnN0YW5jZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIERpY3Rpb25hcnk8c3RyaW5nLCBSYWNlPiBBbGwgPSBuZXcgRGljdGlvbmFyeTxzdHJpbmcsIFJhY2U+KCk7XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbTtcclxudXNpbmcgTWljcm9zb2Z0LlhuYS5GcmFtZXdvcms7XHJcbnVzaW5nIE1pY3Jvc29mdC5YbmEuRnJhbWV3b3JrLkdyYXBoaWNzO1xyXG51c2luZyBOZXd0b25zb2Z0Lkpzb247XHJcbnVzaW5nIFN5c3RlbS5Db21wb25lbnRNb2RlbDtcclxuXHJcbm5hbWVzcGFjZSBEYXJrS2luZ2RvbUNvcmUge1xyXG4gICAgcHVibGljIGNsYXNzIFVuaXQge1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCB4O1xyXG5cclxuICAgICAgICBwdWJsaWMgaW50IG93bmVyO1xyXG5cclxuICAgICAgICBwdWJsaWMgaW50IG1vdmVzaWRlO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBocDtcclxuXHJcbiAgICAgICAgcHVibGljIFVuaXRQYXJhbWV0ZXJzIHBhcmFtZXRlcnM7XHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgYXRrUmVjaGFyZ2UgPSAwO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgcG9pUmVjaGFyZ2UgPSA2MDtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgd2luZ3NXYXZlID0gMDtcclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgaXNJbkNvbWJhdCA9IGZhbHNlO1xyXG4gICAgICAgIHB1YmxpYyBib29sIGlzSW5SYW5nZUNvbWJhdCA9IGZhbHNlO1xyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBwdXJpZmllZDtcclxuICAgICAgICBwdWJsaWMgYm9vbCBsYW5kaW5nO1xyXG4gICAgICAgIHB1YmxpYyBib29sIHRha2VkT2ZmO1xyXG5cclxuICAgICAgICBwdWJsaWMgRGljdGlvbmFyeTxzdHJpbmcsIEFiaWxpdHk+IGFiaWxzO1xyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBkZWF0aEZyb21Qb2lzb247XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgc2hvd25BYmlsID0gXCJcIjtcclxuICAgICAgICBwdWJsaWMgaW50IHNob3duQWJpbE1heFZhbCA9IDA7XHJcblxyXG4gICAgICAgIHB1YmxpYyBBdHRhY2sgYXRrTW9kO1xyXG5cclxuICAgICAgICBwdWJsaWMgTXlHYW1lIGdhbWU7XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgQXR0YWNrIEF0dGFjayB7XHJcbiAgICAgICAgICAgIGdldCB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcGFyYW1ldGVycy5BdHRhY2sgKyBhdGtNb2Q7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0IHtcclxuICAgICAgICAgICAgICAgIGF0a01vZCA9IHZhbHVlIC0gcGFyYW1ldGVycy5BdHRhY2s7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBOZWFyKFVuaXQgdTIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIE1hdGguQWJzKHggLSB1Mi54KSA8PSAzMCAmJiBwYXJhbWV0ZXJzLk5lYXIodTIucGFyYW1ldGVycyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBEcmF3Q3VycmVudChpbnQgeCwgaW50IHksIFNwcml0ZUJhdGNoIHNiLCBTcHJpdGVFZmZlY3RzIGVmZmVjdCA9IFNwcml0ZUVmZmVjdHMuTm9uZSkge1xyXG4gICAgICAgICAgICBpZiAoTXlHYW1lLnNwcml0ZXNbcGFyYW1ldGVycy5zcHJpdGVOYW1lXS5SYW5nZXMuQ29udGFpbnNLZXkoQ3VycmVudEFuaW1hdGlvbikpIHtcclxuICAgICAgICAgICAgICAgIGludCBjdXJJbmQ7XHJcbiAgICAgICAgICAgICAgICBjdXJJbmQgPSBNeUdhbWUuc3ByaXRlc1twYXJhbWV0ZXJzLnNwcml0ZU5hbWVdLlJhbmdlc1tDdXJyZW50QW5pbWF0aW9uXS5JdGVtMSsgKGludClNYXRoLkZsb29yKEN1cnJlbnRGcmFtZSk7XHJcbiAgICAgICAgICAgICAgICBNeUdhbWUuc3ByaXRlc1twYXJhbWV0ZXJzLnNwcml0ZU5hbWVdLkRyYXcoY3VySW5kLCB4LCB5LCBzYiwgZWZmZWN0KTtcclxuICAgICAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICAgICAgICBNeUdhbWUuc3ByaXRlc1twYXJhbWV0ZXJzLnNwcml0ZU5hbWVdLkRyYXcoMCwgeCwgeSwgc2IsIGVmZmVjdCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBTdGFydEFuaW1hdGlvbihzdHJpbmcgbmFtZSwgTW9ub0ludGVyZmFjZS5BbmltYXRvciBhbmltYXRvcikge1xyXG4gICAgICAgICAgICBpZiAoTXlHYW1lLnNwcml0ZXNbcGFyYW1ldGVycy5zcHJpdGVOYW1lXS5SYW5nZXMuQ29udGFpbnNLZXkobmFtZSkpIHtcclxuICAgICAgICAgICAgICAgIEN1cnJlbnRBbmltYXRpb24gPSBuYW1lO1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0b3IuQWRkQ2hpbGQ8TW9ub0ludGVyZmFjZS5OdW1iZXJBbmltYXRpb24+KG5ldyBNb25vSW50ZXJmYWNlLk51bWJlckFuaW1hdGlvbihcIkN1cnJlbnRGcmFtZVwiLCAwLCAwLjlmLCAwLjFmLCB0YXJnZXQ6IHRoaXMsIG9uRW5kOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgQ3VycmVudEFuaW1hdGlvbiA9IFwiSWRsZVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIEN1cnJlbnRGcmFtZSA9IDA7XHJcbiAgICAgICAgICAgICAgICB9KSkuQmVnaW4oKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0cmluZyBDdXJyZW50QW5pbWF0aW9uIHsgZ2V0OyBzZXQ7IH1cclxuICAgICAgICBwdWJsaWMgZmxvYXQgQ3VycmVudEZyYW1lIHsgZ2V0OyBzZXQ7IH1cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEFkZEFiaWxpdHkoc3RyaW5nIG5tZSwgaW50IG51bSwgc3RyaW5nIGNvbmQsIGludCBjZG51bSwgRWZmZWN0VHlwZSB0LCBib29sIGhpZGRlbiA9IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIGlmICghYWJpbHMuQ29udGFpbnNLZXkobm1lKSlcclxuICAgICAgICAgICAgICAgIGFiaWxzLkFkZChubWUsIG5ldyBBYmlsaXR5KG5tZSwgbnVtLCBjb25kLCBjZG51bSwgdCwgaGlkZGVuKSk7XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKGFiaWxzW25tZV0udXNlZClcclxuICAgICAgICAgICAgICAgIGFiaWxzW25tZV0gPSBuZXcgQWJpbGl0eShubWUsIG51bSwgY29uZCwgY2RudW0sIHQsIGhpZGRlbik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBBZGRBYmlsaXR5KEFiaWxpdHkgYSkge1xyXG4gICAgICAgICAgICBBZGRBYmlsaXR5KGEubmFtZSwgYS52YWx1ZSwgYS5jb25kaXRpb24sIGEuY29uZG51bSwgYS50eXAsIGEuaGlkZGVuKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEFkZEFiaWxpdHkoc3RyaW5nIG5tZSwgRWZmZWN0VHlwZSB0LCBib29sIGhpZGRlbiA9IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIEFkZEFiaWxpdHkobm1lLCAwLCBcIlwiLCAwLCB0LCBoaWRkZW4pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgQWRkQWJpbGl0eShzdHJpbmcgbm1lLCBpbnQgbnVtLCBFZmZlY3RUeXBlIHQsIGJvb2wgaGlkZGVuID0gZmFsc2UpIHtcclxuICAgICAgICAgICAgQWRkQWJpbGl0eShubWUsIG51bSwgXCJcIiwgMCwgdCwgaGlkZGVuKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBSZW1vdmVBYmlsKHN0cmluZyBubWUpIHtcclxuICAgICAgICAgICAgaWYgKGFiaWxzLkNvbnRhaW5zS2V5KG5tZSkpXHJcbiAgICAgICAgICAgICAgICBhYmlscy5SZW1vdmUobm1lKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBBYnNDb250YWlucyhzdHJpbmcgYWJpbF9uYW1lKSB7XHJcbiAgICAgICAgICAgIGlmIChhYmlscy5Db250YWluc0tleShhYmlsX25hbWUpKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFiaWxzW2FiaWxfbmFtZV0uY29uZENvbXBsZXRlZCAmJiAhYWJpbHNbYWJpbF9uYW1lXS51c2VkO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBBYnNDb250YWlucyhwYXJhbXMgc3RyaW5nW10gYWJzKSB7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKHN0cmluZyBhYiBpbiBhYnMpIHtcclxuICAgICAgICAgICAgICAgIGlmIChhYmlscy5Db250YWluc0tleShhYikpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYWJpbHNbYWJdLmNvbmRDb21wbGV0ZWQgJiYgIWFiaWxzW2FiXS51c2VkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIGludCBNaW5EYW1hZ2Uge1xyXG4gICAgICAgICAgICBnZXQge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhcmFtZXRlcnMuQXR0YWNrLk1pbkRhbWFnZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGludCBNYXhEYW1hZ2Uge1xyXG4gICAgICAgICAgICBnZXQge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhcmFtZXRlcnMuQXR0YWNrLk1heERhbWFnZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBVbml0KE15R2FtZSBnYW1lLCBmbG9hdCB4eCwgaW50IG1zaWQsIGludCBvd24sIFVuaXRQYXJhbWV0ZXJzIHBybXMpIHtcclxuICAgICAgICAgICAgdGhpcy5nYW1lID0gZ2FtZTtcclxuICAgICAgICAgICAgeCA9IHh4O1xyXG4gICAgICAgICAgICBtb3Zlc2lkZSA9IG1zaWQ7XHJcbiAgICAgICAgICAgIG93bmVyID0gb3duO1xyXG4gICAgICAgICAgICBTZXRQYXJhbXMocHJtcywgdHJ1ZSk7XHJcbiAgICAgICAgICAgIEN1cnJlbnRBbmltYXRpb24gPSBcIklkbGVcIjtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBTZXRQYXJhbXMoVW5pdFBhcmFtZXRlcnMgbmV3cHJtLCBib29sIHNldEhwKSB7XHJcbiAgICAgICAgICAgIHBhcmFtZXRlcnMgPSBuZXdwcm07XHJcbiAgICAgICAgICAgIGF0a01vZCA9IG5ldyBBdHRhY2soMCwgMCwgMCwgMCk7XHJcbiAgICAgICAgICAgIGFiaWxzID0gbmV3IERpY3Rpb25hcnk8c3RyaW5nLCBBYmlsaXR5PigpO1xyXG4gICAgICAgICAgICBmb3JlYWNoIChBYmlsaXR5IGEgaW4gcGFyYW1ldGVycy5hYmlscy5WYWx1ZXMpXHJcbiAgICAgICAgICAgICAgICBBZGRBYmlsaXR5KGEpO1xyXG4gICAgICAgICAgICBpZiAoQWJzQ29udGFpbnMoXCJSYW5kb20gbW9kZWxcIikpIHtcclxuICAgICAgICAgICAgICAgIFJlbW92ZUFiaWwoXCJSYW5kb20gbW9kZWxcIik7XHJcbmRvXHJcbntcclxuICAgIGdsb2JhbDo6QnJpZGdlLlNjcmlwdC5Ub1RlbXAoXCJjYXNlX3BhdHRlcm4wXCIsIE15R2FtZS5ybmQuTmV4dERvdWJsZSgpKTtcclxuICAgIGlmIChnbG9iYWw6OkJyaWRnZS5TY3JpcHQuRnJvbVRlbXA8ZG91YmxlPihcImNhc2VfcGF0dGVybjBcIikgaXMgb2JqZWN0KVxyXG4gICAge1xyXG4gICAgICAgIHZhciBfZGlzY2FyZDEgPSAob2JqZWN0KWdsb2JhbDo6QnJpZGdlLlNjcmlwdC5Gcm9tVGVtcDxkb3VibGU+KFwiY2FzZV9wYXR0ZXJuMFwiKTtcclxuICAgICAgICBpZiAoTXlHYW1lLnJuZC5OZXh0RG91YmxlKCkgPCAwLjMzKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcGFyYW1ldGVycy5zcHJpdGVOYW1lID0gXCJtaWxpdGlhMVwiO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGdsb2JhbDo6QnJpZGdlLlNjcmlwdC5Gcm9tVGVtcDxkb3VibGU+KFwiY2FzZV9wYXR0ZXJuMFwiKSBpcyBvYmplY3QpXHJcbiAgICB7XHJcbiAgICAgICAgdmFyIF9kaXNjYXJkMiA9IChvYmplY3QpZ2xvYmFsOjpCcmlkZ2UuU2NyaXB0LkZyb21UZW1wPGRvdWJsZT4oXCJjYXNlX3BhdHRlcm4wXCIpO1xyXG4gICAgICAgIGlmIChNeUdhbWUucm5kLk5leHREb3VibGUoKSA8IDAuNjYpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBwYXJhbWV0ZXJzLnNwcml0ZU5hbWUgPSBcIm1pbGl0aWEyXCI7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG53aGlsZSAoZmFsc2UpOyAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKEFic0NvbnRhaW5zKFwiVW5pdmVyc2FsXCIpKSB7XHJcbiAgICAgICAgICAgICAgICBSZW1vdmVBYmlsKFwiVW5pdmVyc2FsXCIpO1xyXG4gICAgICAgICAgICAgICAgdmFyIG1heHJhY2UgPSBNeUdhbWUuU2VsZWN0UGxheWluZ1JhY2UoTXlHYW1lLnBscnNbb3duZXJdLnVuaXRzTGlzdCk7XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKG1heHJhY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiSHVtYW5zXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFkZEFiaWxpdHkoXCJMaWZlX3JvbGxiYWNrXCIsIDIsIEVmZmVjdFR5cGUuR29vZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiVW5kZWFkc1wiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBZGRBYmlsaXR5KFwiVW5kZWFkXCIsIEVmZmVjdFR5cGUuR29vZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBZGRBYmlsaXR5KFwiUGxhZ3VlXCIsIEVmZmVjdFR5cGUuR29vZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbWV0ZXJzLlNwZWVkID0gXCJTbG93XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiRGVtb25zXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFkZEFiaWxpdHkoXCJNYWdlXCIsIEVmZmVjdFR5cGUuR29vZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBZGRBYmlsaXR5KFwiRXhwbG9zaXZlXCIsIDAsIFwiT25fZGVhdGhcIiwgMCwgRWZmZWN0VHlwZS5Hb29kKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtZXRlcnMuQXJtb3IgPSBcIk5vbmVcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtZXRlcnMuU3BlZWQgPSBcIkZhc3RcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJIb3JkZVwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBdHRhY2sgKz0gMTA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBZGRBYmlsaXR5KFwiQ3Jhc2hlclwiLCAyNCwgRWZmZWN0VHlwZS5Hb29kKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJTd2FtcGVyc1wiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBZGRBYmlsaXR5KFwiUG9pc29uZXJcIiwgMjAsIEVmZmVjdFR5cGUuR29vZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBZGRBYmlsaXR5KFwiUG9pc29ucHJvb2ZcIiwgRWZmZWN0VHlwZS5Hb29kKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJFbHZlc1wiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBZGRBYmlsaXR5KFwiQWdpbGl0eVwiLCAyMCwgRWZmZWN0VHlwZS5Hb29kKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFkZEFiaWxpdHkoXCJMeWNhbnRocm9weVwiLCA1NCwgXCJBdCBuaWdodFwiLCAwLCBFZmZlY3RUeXBlLkdvb2QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkR3YXJmc1wiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbWV0ZXJzLkFybW9yID0gXCJIZWF2eVwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQWRkQWJpbGl0eShcIlNwZWxscHJvb2ZcIiwgRWZmZWN0VHlwZS5Hb29kKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtZXRlcnMuU3BlZWQgPSBcIlNsb3dcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJTdGVhbXB1bmtcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQXR0YWNrICs9IDEwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1ldGVycy5tYXhocCArPSAxMDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBZGRBYmlsaXR5KFwiTWFjaGluZXJ5XCIsIEVmZmVjdFR5cGUuR29vZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiTmV1dHJhbHNcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQXR0YWNrICs9IDEwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQWRkQWJpbGl0eShcIkludmlzaWJsZVwiLCBFZmZlY3RUeXBlLkdvb2QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChwYXJhbWV0ZXJzLk5hbWUgPT0gXCJOZXV0cmFsX3dhcnJpb3JcIiAmJiBtYXhyYWNlICE9IFwiTmV1dHJhbHNcIilcclxuICAgICAgICAgICAgICAgICAgICBwYXJhbWV0ZXJzLnJlY3QuSGVpZ2h0ID0gMzE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKEFic0NvbnRhaW5zKFwiQ2hhbmNlX3RvX2ZseVwiKSAmJiBNeUdhbWUucm5kLk5leHREb3VibGUoKSA+IDAuNSlcclxuICAgICAgICAgICAgICAgIHBhcmFtZXRlcnMubW92ZVR5cGUgPSBVbml0TW92ZVR5cGUuRmx5aW5nTVQ7XHJcbiAgICAgICAgICAgIGlmIChzZXRIcClcclxuICAgICAgICAgICAgICAgIGhwID0gcGFyYW1ldGVycy5tYXhocDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHB1YmxpYyBzdHJ1Y3QgV2lkdGhIZWlnaHRcclxuICAgIHtcclxuICAgICAgICBbSnNvblByb3BlcnR5KFwid1wiKV1cclxuICAgICAgICBwdWJsaWMgaW50IHc7XHJcblxyXG4gICAgICAgIFtKc29uUHJvcGVydHkoXCJoXCIpXVxyXG4gICAgICAgIHB1YmxpYyBpbnQgaDtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RydWN0IFVuaXRQYXJhbWV0ZXJzIHtcclxuICAgICAgICBbSnNvblByb3BlcnR5KFwiaWRcIildXHJcbiAgICAgICAgcHVibGljIGludCBpZDtcclxuXHJcbiAgICAgICAgW0pzb25Qcm9wZXJ0eShcIm5hbWVcIiwgRGVmYXVsdFZhbHVlSGFuZGxpbmcgPSBEZWZhdWx0VmFsdWVIYW5kbGluZy5Qb3B1bGF0ZSldXHJcbiAgICAgICAgW0RlZmF1bHRWYWx1ZShcIlwiKV1cclxuICAgICAgICBwdWJsaWMgc3RyaW5nIE5hbWU7XHJcblxyXG4gICAgICAgIFtKc29uUHJvcGVydHkoXCJEYW1hZ2VcIildXHJcbiAgICAgICAgcHVibGljIEF0dGFjayBBdHRhY2s7XHJcblxyXG4gICAgICAgIFtKc29uUHJvcGVydHkoXCJIZWFsdGhcIildXHJcbiAgICAgICAgcHVibGljIGludCBtYXhocDtcclxuXHJcbiAgICAgICAgW0pzb25Qcm9wZXJ0eShcIkNvc3RcIildXHJcbiAgICAgICAgcHVibGljIFRpbWVDb3N0IENvc3Q7XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgZmxvYXQgX2FybW9yLCBfc3BlZWQ7XHJcbiAgICAgICAgcHVibGljIHN0cmluZyBhcm1OaWNrLCBzcGROaWNrO1xyXG5cclxuICAgICAgICBbSnNvblByb3BlcnR5KFwicmFjZVwiLCBEZWZhdWx0VmFsdWVIYW5kbGluZyA9IERlZmF1bHRWYWx1ZUhhbmRsaW5nLlBvcHVsYXRlKV1cclxuICAgICAgICBbRGVmYXVsdFZhbHVlKFwiXCIpXVxyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgUmFjZTtcclxuICAgICAgICBbSnNvblByb3BlcnR5KFwic3VicmFjZVwiLCBEZWZhdWx0VmFsdWVIYW5kbGluZyA9IERlZmF1bHRWYWx1ZUhhbmRsaW5nLlBvcHVsYXRlKV1cclxuICAgICAgICBbRGVmYXVsdFZhbHVlKFwiXCIpXVxyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgU3VicmFjZTtcclxuXHJcbiAgICAgICAgW0pzb25Qcm9wZXJ0eShcIkRlc2NcIiwgRGVmYXVsdFZhbHVlSGFuZGxpbmcgPSBEZWZhdWx0VmFsdWVIYW5kbGluZy5Qb3B1bGF0ZSldXHJcbiAgICAgICAgW0RlZmF1bHRWYWx1ZShcIlwiKV1cclxuICAgICAgICBwdWJsaWMgc3RyaW5nIERlc2NyaXB0aW9uO1xyXG4gICAgICAgIHB1YmxpYyBib29sIGFuaW1hdGVkO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgaW1neCwgaW1neTtcclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgaXNCdWlsZGluZztcclxuICAgICAgICBwdWJsaWMgYm9vbCBpc0lnbm9yZVVuaXRzO1xyXG4gICAgICAgIHB1YmxpYyBib29sIGlzSGVyb2ljO1xyXG4gICAgICAgIHB1YmxpYyBVbml0TW92ZVR5cGUgbW92ZVR5cGU7XHJcbiAgICAgICAgcHVibGljIGludCBtYXhMaW1pdDtcclxuXHJcbiAgICAgICAgW0pzb25Qcm9wZXJ0eShcImhwQm90dG9tXCIpXVxyXG4gICAgICAgIHB1YmxpYyBib29sIGhwQm90b207XHJcblxyXG4gICAgICAgIFtKc29uUHJvcGVydHkoXCJSZWN0XCIpXVxyXG4gICAgICAgIHB1YmxpYyBXaWR0aEhlaWdodCBzaXplO1xyXG5cclxuICAgICAgICBwdWJsaWMgUmVjdGFuZ2xlIHJlY3Q7XHJcblxyXG4gICAgICAgIFxyXG4gICAgICAgIHB1YmxpYyBEaWN0aW9uYXJ5PHN0cmluZywgQWJpbGl0eT4gYWJpbHM7XHJcblxyXG4gICAgICAgIFtKc29uUHJvcGVydHkoXCJBYmlsaXRlc1wiKV1cclxuICAgICAgICBwdWJsaWMgTGlzdDxBYmlsaXR5PiByYXdBYmlscztcclxuXHJcbiAgICAgICAgcHVibGljIHN0cmluZyBzcHJpdGVOYW1lO1xyXG4gICAgICAgIHB1YmxpYyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2UgaWNvbkFwcDtcclxuICAgICAgICBbSnNvblByb3BlcnR5KFwiaWNvblwiKV1cclxuICAgICAgICBwdWJsaWMgaW50IGljb25JbmQ7XHJcblxyXG4gICAgICAgIFtKc29uUHJvcGVydHkoXCJhbW1vXCIpXVxyXG4gICAgICAgIHB1YmxpYyBBbW1vLkFtbW9UeXBlIGFtbW9UeXBlO1xyXG5cclxuICAgICAgICBbSnNvblByb3BlcnR5KFwic3VwcG9ydFwiKV1cclxuICAgICAgICBwdWJsaWMgYm9vbCBzdXBwb3J0O1xyXG4gICAgICAgIFtKc29uUHJvcGVydHkoXCJ1cGdyYWRlXCIpXVxyXG4gICAgICAgIHB1YmxpYyBib29sIHVwZ3JhZGU7XHJcbiAgICAgICAgW0pzb25Qcm9wZXJ0eShcInNwZWNpYWxcIildXHJcbiAgICAgICAgcHVibGljIGJvb2wgc3BlY2lhbDtcclxuXHJcbiAgICAgICAgW0pzb25Qcm9wZXJ0eShcImlzU3RhcnRCdWlsZGluZ1wiKV1cclxuICAgICAgICBwdWJsaWMgYm9vbCBpc1N0YXJ0QnVpbGRpbmc7XHJcblxyXG4gICAgICAgIHB1YmxpYyBib29sIEFic0NvbnRhaW5zKHN0cmluZyBubWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGFiaWxzLkNvbnRhaW5zS2V5KG5tZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBOZWFyKFVuaXRQYXJhbWV0ZXJzIHVwMikge1xyXG4gICAgICAgICAgICByZXR1cm4gbW92ZVR5cGUgPT0gdXAyLm1vdmVUeXBlIHx8IG1vdmVUeXBlID09IFVuaXRNb3ZlVHlwZS5IdWdlTVQgfHwgdXAyLm1vdmVUeXBlID09IFVuaXRNb3ZlVHlwZS5IdWdlTVQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBbSnNvblByb3BlcnR5KFwiU3BlZWRcIiwgRGVmYXVsdFZhbHVlSGFuZGxpbmcgPSBEZWZhdWx0VmFsdWVIYW5kbGluZy5Qb3B1bGF0ZSldXHJcbiAgICAgICAgW0RlZmF1bHRWYWx1ZShcIk5vcm1hbFwiKV1cclxuICAgICAgICBwdWJsaWMgc3RyaW5nIFNwZWVkIHtcclxuICAgICAgICAgICAgZ2V0IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzcGROaWNrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldCB7XHJcbiAgICAgICAgICAgICAgICBzcGROaWNrID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIk5vbmVcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgX3NwZWVkID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIlNsb3dcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgX3NwZWVkID0gMC4xNWY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJOb3JtYWxcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgX3NwZWVkID0gMC4yZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkZhc3RcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgX3NwZWVkID0gMC4zZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIlZlcnlfZmFzdFwiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBfc3BlZWQgPSAwLjZmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgW0pzb25Qcm9wZXJ0eShcIkFybW9yXCIsIERlZmF1bHRWYWx1ZUhhbmRsaW5nID0gRGVmYXVsdFZhbHVlSGFuZGxpbmcuUG9wdWxhdGUpXVxyXG4gICAgICAgIFtEZWZhdWx0VmFsdWUoXCJOb25lXCIpXVxyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgQXJtb3Ige1xyXG4gICAgICAgICAgICBnZXQge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFybU5pY2s7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0IHtcclxuICAgICAgICAgICAgICAgIGFybU5pY2sgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAodmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiTm9uZVwiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBfYXJtb3IgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiTGlnaHRcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgX2FybW9yID0gMC43NWY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJIZWF2eVwiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBfYXJtb3IgPSAwLjVmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiRXRoZXJlYWxcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgX2FybW9yID0gMC4yNWY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIE1pY3Jvc29mdC5YbmEuRnJhbWV3b3JrO1xyXG5cclxubmFtZXNwYWNlIERhcmtLaW5nZG9tRGVza3RvcFxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgQXBwXHJcbiAgICB7XHJcblx0XHRwcml2YXRlIHN0YXRpYyBHYW1lIGdhbWU7XHJcblx0XHRcclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgTWFpbigpXHJcblx0XHR7XHJcbiAgICAgICAgICAgIHZhciBjYW52YXMgPSBuZXcgUmV0eXBlZC5kb20uSFRNTENhbnZhc0VsZW1lbnRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgd2lkdGggPSA4MDAsXHJcbiAgICAgICAgICAgICAgICBoZWlnaHQgPSA0ODAsXHJcbiAgICAgICAgICAgICAgICBpZCA9IFwibW9ub2dhbWVjYW52YXNcIlxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBSZXR5cGVkLmRvbS5kb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkPFJldHlwZWQuZG9tLkhUTUxDYW52YXNFbGVtZW50PihjYW52YXMpO1xyXG5cclxuICAgICAgICAgICAgZ2FtZSA9IG5ldyBNYWluQ2xhc3MoKTtcclxuXHRcdFx0Z2FtZS5SdW4oKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwiXHJcblxyXG4jcmVnaW9uIFwiVXNpbmcgU3RhdGVtZW50c1wiXHJcbnVzaW5nIE1pY3Jvc29mdC5YbmEuRnJhbWV3b3JrO1xyXG51c2luZyBNaWNyb3NvZnQuWG5hLkZyYW1ld29yay5HcmFwaGljcztcclxudXNpbmcgTWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuSW5wdXQuVG91Y2g7XHJcbiNlbmRyZWdpb25cclxuXHJcblxyXG5uYW1lc3BhY2UgRGFya0tpbmdkb21EZXNrdG9wIHtcclxuICAgIC8vLyA8c3VtbWFyeT5cclxuICAgIC8vLyBUaGlzIGlzIHRoZSBtYWluIHR5cGUgZm9yIHlvdXIgZ2FtZVxyXG4gICAgLy8vIDwvc3VtbWFyeT5cclxuICAgIHB1YmxpYyBwYXJ0aWFsIGNsYXNzIE1haW5DbGFzcyA6IEdhbWUge1xyXG5cclxuICAgICAgICBwdWJsaWMgRGFya0tpbmdkb21Db3JlLk15R2FtZSBnYW1lQ2xhc3M7XHJcbiAgICAgICAgcHJpdmF0ZSBHcmFwaGljc0RldmljZU1hbmFnZXIgZ3JhcGhpY3M7XHJcbiAgICAgICAgcHJpdmF0ZSBTcHJpdGVCYXRjaCBzcHJpdGVCYXRjaDtcclxuXHJcbiAgICAgICAgLy9wcml2YXRlIFJlbmRlclRhcmdldDJEIGJhY2tCdWZmZXI7XHJcblxyXG4gICAgICAgIHB1YmxpYyBNYWluQ2xhc3MoKVxyXG4gICAgICAgICAgICA6IGJhc2UoKSB7XHJcbiAgICAgICAgICAgIGdyYXBoaWNzID0gbmV3IEdyYXBoaWNzRGV2aWNlTWFuYWdlcih0aGlzKVxyXG4gICAgICAgICAgICB7XHJcbiNpZiBCUk9XU0VSXHJcbiAgICAgICAgICAgICAgICBIYXJkd2FyZU1vZGVTd2l0Y2ggPSBmYWxzZVxyXG4jZW5kaWZcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgc3RyaW5nIHBsYXRmb3JtID0gXCJXaW5kb3dzXCI7XHJcblxyXG4gICAgICAgICAgICBnYW1lQ2xhc3MgPSBuZXcgRGFya0tpbmdkb21Db3JlLk15R2FtZShwbGF0Zm9ybSkge1xyXG4gICAgICAgICAgICAgICAgZ3JhcGhpY3MgPSBncmFwaGljcyxcclxuICAgICAgICAgICAgICAgIEFwcEZvbGRlciA9IFwiXCIsXHJcbiAgICAgICAgICAgICAgICBEYXRhRm9sZGVyID0gXCJDb250ZW50XCJcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIENvbnRlbnQuUm9vdERpcmVjdG9yeSA9IFwiQ29udGVudFwiO1xyXG5cclxuICAgICAgICAgICAgZ2FtZUNsYXNzLk9uRXhpdCArPSBPbkV4aXQ7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgUmVzaXplKGludCB3LCBpbnQgaCkge1xyXG5cclxuICAgICAgICAgICAgLy92YXIgc2NhbGVGYWN0b3IgPSAxLjBmO1xyXG5cclxuICAgICAgICAgICAgLy9pbnQgZmluYWxXID0gKGludCkodyAqIHNjYWxlRmFjdG9yKTtcclxuICAgICAgICAgICAgLy9pbnQgZmluYWxIID0gKGludCkoaCAqIHNjYWxlRmFjdG9yKTtcclxuICAgICAgICAgICAgLy92YXIgdWlTY2FsZSA9IDEuMGY7XHJcbiAgICAgICAgICAgIC8vaWYgKGZpbmFsVyA+IDEwMDApXHJcbiAgICAgICAgICAgIC8vICAgIHVpU2NhbGUgPSAxLjI1ZjtcclxuICAgICAgICAgICAgLy9pZiAoZmluYWxXID4gMTUwMClcclxuICAgICAgICAgICAgLy8gICAgdWlTY2FsZSA9IDEuNWY7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLy8gPHN1bW1hcnk+XHJcbiAgICAgICAgLy8vIEFsbG93cyB0aGUgZ2FtZSB0byBwZXJmb3JtIGFueSBpbml0aWFsaXphdGlvbiBpdCBuZWVkcyB0byBiZWZvcmUgc3RhcnRpbmcgdG8gcnVuLlxyXG4gICAgICAgIC8vLyBUaGlzIGlzIHdoZXJlIGl0IGNhbiBxdWVyeSBmb3IgYW55IHJlcXVpcmVkIHNlcnZpY2VzIGFuZCBsb2FkIGFueSBub24tZ3JhcGhpY1xyXG4gICAgICAgIC8vLyByZWxhdGVkIGNvbnRlbnQuICBDYWxsaW5nIGJhc2UuSW5pdGlhbGl6ZSB3aWxsIGVudW1lcmF0ZSB0aHJvdWdoIGFueSBjb21wb25lbnRzXHJcbiAgICAgICAgLy8vIGFuZCBpbml0aWFsaXplIHRoZW0gYXMgd2VsbC5cclxuICAgICAgICAvLy8gPC9zdW1tYXJ5PlxyXG4gICAgICAgIHByb3RlY3RlZCBvdmVycmlkZSB2b2lkIEluaXRpYWxpemUoKSB7XHJcbiAgICAgICAgICAgIC8vIFRPRE86IEFkZCB5b3VyIGluaXRpYWxpemF0aW9uIGxvZ2ljIGhlcmVcclxuICAgICAgICAgICAgSXNNb3VzZVZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgICAgICBUb3VjaFBhbmVsLkVuYWJsZWRHZXN0dXJlcyA9IEdlc3R1cmVUeXBlLlRhcCB8IEdlc3R1cmVUeXBlLkhvbGQ7XHJcbiAgICAgICAgICAgIGJhc2UuSW5pdGlhbGl6ZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0cmluZyBBcHBGb2xkZXI7XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgRGF0YUZvbGRlcjtcclxuICAgICAgICAvLy8gPHN1bW1hcnk+XHJcbiAgICAgICAgLy8vIExvYWRDb250ZW50IHdpbGwgYmUgY2FsbGVkIG9uY2UgcGVyIGdhbWUgYW5kIGlzIHRoZSBwbGFjZSB0byBsb2FkXHJcbiAgICAgICAgLy8vIGFsbCBvZiB5b3VyIGNvbnRlbnQuXHJcbiAgICAgICAgLy8vIDwvc3VtbWFyeT5cclxuICAgICAgICBwcm90ZWN0ZWQgb3ZlcnJpZGUgdm9pZCBMb2FkQ29udGVudCgpIHtcclxuICAgICAgICAgICAgLy8gQ3JlYXRlIGEgbmV3IFNwcml0ZUJhdGNoLCB3aGljaCBjYW4gYmUgdXNlZCB0byBkcmF3IHRleHR1cmVzLlxyXG4gICAgICAgICAgICAvL2JhY2tCdWZmZXIgPSBuZXcgUmVuZGVyVGFyZ2V0MkQoZ3JhcGhpY3MuR3JhcGhpY3NEZXZpY2UsIDgwMCwgNDgwKTtcclxuICAgICAgICAgICAgc3ByaXRlQmF0Y2ggPSBuZXcgU3ByaXRlQmF0Y2goR3JhcGhpY3NEZXZpY2UpO1xyXG4gICAgICAgICAgICBnYW1lQ2xhc3Muc3ByaXRlQmF0Y2ggPSBzcHJpdGVCYXRjaDtcclxuXHJcbiAgICAgICAgICAgIC8vXHRSZWFkUHJvZmlsZXMoKTtcclxuICAgICAgICAgICAgLy9SZWFkU3ByaXRlcyhDb250ZW50KTtcclxuXHJcbiAgICAgICAgICAgIC8vaW50IHRlc3RfdyA9IDUwLCB0ZXN0X2ggPSA1MDtcclxuICAgICAgICAgICAgLy90ZXN0X3RleHQgPSBuZXcgVGV4dHVyZTJEKEdyYXBoaWNzRGV2aWNlLCB0ZXN0X3csIHRlc3RfaCk7XHJcbiAgICAgICAgICAgIC8vdmFyIGZpbGxfYXJyID0gbmV3IGludFt0ZXN0X3cgKiB0ZXN0X2ggKiA0XTtcclxuICAgICAgICAgICAgLy9mb3IgKHZhciBpID0gMDsgaSA8IHRlc3RfdyAqIHRlc3RfaCAqIDQ7IGkgKz0gNClcclxuICAgICAgICAgICAgLy97XHJcbiAgICAgICAgICAgIC8vICAgIGZpbGxfYXJyW2ldID0gMjU1O1xyXG4gICAgICAgICAgICAvLyAgICBmaWxsX2FycltpICsgMV0gPSAwO1xyXG4gICAgICAgICAgICAvLyAgICBmaWxsX2FycltpICsgMl0gPSAyNTU7XHJcbiAgICAgICAgICAgIC8vICAgIGZpbGxfYXJyW2kgKyAzXSA9IDEyODtcclxuICAgICAgICAgICAgLy99XHJcbiAgICAgICAgICAgIC8vdGVzdF90ZXh0LlNldERhdGEoZmlsbF9hcnIpO1xyXG4gICAgICAgICAgICBnYW1lQ2xhc3MuTG9hZERhdGEoQ29udGVudCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLy8gPHN1bW1hcnk+XHJcbiAgICAgICAgLy8vIFVubG9hZENvbnRlbnQgd2lsbCBiZSBjYWxsZWQgb25jZSBwZXIgZ2FtZSBhbmQgaXMgdGhlIHBsYWNlIHRvIHVubG9hZFxyXG4gICAgICAgIC8vLyBhbGwgY29udGVudC5cclxuICAgICAgICAvLy8gPC9zdW1tYXJ5PlxyXG4gICAgICAgIHByb3RlY3RlZCBvdmVycmlkZSB2b2lkIFVubG9hZENvbnRlbnQoKSB7XHJcbiAgICAgICAgICAgIC8vIFRPRE86IFVubG9hZCBhbnkgbm9uIENvbnRlbnRNYW5hZ2VyIGNvbnRlbnQgaGVyZVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8vIDxzdW1tYXJ5PlxyXG4gICAgICAgIC8vLyBBbGxvd3MgdGhlIGdhbWUgdG8gcnVuIGxvZ2ljIHN1Y2ggYXMgdXBkYXRpbmcgdGhlIHdvcmxkLFxyXG4gICAgICAgIC8vLyBjaGVja2luZyBmb3IgY29sbGlzaW9ucywgZ2F0aGVyaW5nIGlucHV0LCBhbmQgcGxheWluZyBhdWRpby5cclxuICAgICAgICAvLy8gPC9zdW1tYXJ5PlxyXG4gICAgICAgIC8vLyA8cGFyYW0gbmFtZT1cImdhbWVUaW1lXCI+UHJvdmlkZXMgYSBzbmFwc2hvdCBvZiB0aW1pbmcgdmFsdWVzLjwvcGFyYW0+XHJcbiAgICAgICAgLy8vIFxyXG5cclxuXHJcbiAgICAgICAgcHJvdGVjdGVkIG92ZXJyaWRlIHZvaWQgVXBkYXRlKEdhbWVUaW1lIGdhbWVUaW1lKSB7XHJcbiAgICAgICAgICAgIGlmIChnYW1lQ2xhc3MuaXNMb2FkZWQpXHJcbiAgICAgICAgICAgICAgICBnYW1lQ2xhc3MuVXBkYXRlKCk7XHJcbiAgICAgICAgICAgIGJhc2UuVXBkYXRlKGdhbWVUaW1lKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vLyA8c3VtbWFyeT5cclxuICAgICAgICAvLy8gVGhpcyBpcyBjYWxsZWQgd2hlbiB0aGUgZ2FtZSBzaG91bGQgZHJhdyBpdHNlbGYuXHJcbiAgICAgICAgLy8vIDwvc3VtbWFyeT5cclxuICAgICAgICAvLy8gPHBhcmFtIG5hbWU9XCJnYW1lVGltZVwiPlByb3ZpZGVzIGEgc25hcHNob3Qgb2YgdGltaW5nIHZhbHVlcy48L3BhcmFtPlxyXG4gICAgICAgIHByb3RlY3RlZCBvdmVycmlkZSB2b2lkIERyYXcoR2FtZVRpbWUgZ2FtZVRpbWUpIHtcclxuICAgICAgICAgICAgLy8gVE9ETzogQWRkIHlvdXIgZHJhd2luZyBjb2RlIGhlcmVcclxuICAgICAgICAgICAgaWYgKGdhbWVDbGFzcy5pc0xvYWRlZCkge1xyXG4gICAgICAgICAgICAgICAgLy9ncmFwaGljcy5HcmFwaGljc0RldmljZS5TZXRSZW5kZXJUYXJnZXQoYmFja0J1ZmZlcik7XHJcbiAgICAgICAgICAgICAgICBzcHJpdGVCYXRjaC5CZWdpbihTcHJpdGVTb3J0TW9kZS5EZWZlcnJlZCwgQmxlbmRTdGF0ZS5Ob25QcmVtdWx0aXBsaWVkLCBTYW1wbGVyU3RhdGUuUG9pbnRDbGFtcCwgRGVwdGhTdGVuY2lsU3RhdGUuRGVmYXVsdCwgUmFzdGVyaXplclN0YXRlLkN1bGxOb25lKTtcclxuXHJcbiAgICAgICAgICAgICAgICBnYW1lQ2xhc3MuRHJhdygpO1xyXG4gICAgICAgICAgICAgICAgLy9zcHJpdGVCYXRjaC5FbmQoKTtcclxuICAgICAgICAgICAgICAgIC8vZ3JhcGhpY3MuR3JhcGhpY3NEZXZpY2UuU2V0UmVuZGVyVGFyZ2V0KG51bGwpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vc3ByaXRlQmF0Y2guQmVnaW4oU3ByaXRlU29ydE1vZGUuRGVmZXJyZWQsIEJsZW5kU3RhdGUuTm9uUHJlbXVsdGlwbGllZCwgU2FtcGxlclN0YXRlLlBvaW50Q2xhbXAsIERlcHRoU3RlbmNpbFN0YXRlLkRlZmF1bHQsIFJhc3Rlcml6ZXJTdGF0ZS5DdWxsTm9uZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy9zcHJpdGVCYXRjaC5EcmF3KGJhY2tCdWZmZXIsIG5ldyBSZWN0YW5nbGUoMCwgMCwgZ2FtZUNsYXNzLl9zY3JlZW5XaWR0aCwgZ2FtZUNsYXNzLl9zY3JlZW5IZWlnaHQpLCBDb2xvci5XaGl0ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgZ2FtZUNsYXNzLkRyYXdJbnRlcmZhY2Uoc3ByaXRlQmF0Y2gpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vc3ByaXRlQmF0Y2guRHJhdyh0ZXN0X3RleHQsIG5ldyBWZWN0b3IyKDEwMCwgMTAwKSwgQ29sb3IuV2hpdGUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHNwcml0ZUJhdGNoLkVuZCgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBiYXNlLkRyYXcoZ2FtZVRpbWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgT25FeGl0KCkge1xyXG4gICAgICAgICAgICBFeGl0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICB9XHJcbn0iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uUmVmbGVjdGlvbjtcclxudXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrcztcclxuXHJcbm5hbWVzcGFjZSBNb25vSW50ZXJmYWNlXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBBbmltYXRvciB7XHJcbiAgICAgICAgcHVibGljIExpc3Q8QW5pbWF0aW9uPiBBbmltYXRpb25zIHsgZ2V0OyBzZXQ7IH1cclxuICAgICAgICBwcml2YXRlIExpc3Q8QW5pbWF0aW9uPiBjb21wbGV0ZWQgPSBuZXcgTGlzdDxBbmltYXRpb24+KCk7XHJcblxyXG4gICAgICAgIHB1YmxpYyBUIEFkZENoaWxkPFQ+KFQgY2hpbGQpIHdoZXJlIFQgOiBBbmltYXRpb24ge1xyXG4gICAgICAgICAgICBBbmltYXRpb25zLkFkZChjaGlsZCk7XHJcbiAgICAgICAgICAgIHJldHVybiBjaGlsZDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIERvKCkge1xyXG4gICAgICAgICAgICBmb3JlYWNoICh2YXIgYW5pbSBpbiBBbmltYXRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICBhbmltLkRvKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoYW5pbS5Jc0NvbXBsZXRlZClcclxuICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQuQWRkKGFuaW0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChjb21wbGV0ZWQuQ291bnQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBmb3JlYWNoICh2YXIgYW5pbSBpbiBjb21wbGV0ZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBhbmltLkVuZCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIEFuaW1hdGlvbnMuUmVtb3ZlKGFuaW0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY29tcGxldGVkLkNsZWFyKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBBbmltYXRvcigpIHtcclxuICAgICAgICAgICAgQW5pbWF0aW9ucyA9IG5ldyBMaXN0PEFuaW1hdGlvbj4oKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGFic3RyYWN0IGNsYXNzIEFuaW1hdGlvbiB7XHJcbiAgICAgICAgcHVibGljIGJvb2wgSXNSdW5uaW5nIHsgZ2V0OyBzZXQ7IH1cclxuICAgICAgICBwdWJsaWMgYm9vbCBJc0NvbXBsZXRlZCB7IGdldDsgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIGV2ZW50IEFjdGlvbiBPblN0YXJ0O1xyXG4gICAgICAgIHB1YmxpYyBldmVudCBBY3Rpb24gT25FbmQ7XHJcblxyXG4gICAgICAgIHByaXZhdGUgVGFza0NvbXBsZXRpb25Tb3VyY2U8b2JqZWN0PiBhbmltYXRpb25UYXNrO1xyXG5cclxuICAgICAgICBwdWJsaWMgYWJzdHJhY3Qgdm9pZCBEbygpO1xyXG5cclxuICAgICAgICBwdWJsaWMgdmlydHVhbCBUYXNrPG9iamVjdD4gQmVnaW4oKSB7XHJcbiAgICAgICAgICAgIElzUnVubmluZyA9IHRydWU7XHJcbiAgICAgICAgICAgIElzQ29tcGxldGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIE9uU3RhcnQhPW51bGw/Z2xvYmFsOjpCcmlkZ2UuU2NyaXB0LkZyb21MYW1iZGEoKCk9Pk9uU3RhcnQuSW52b2tlKCkpOm51bGw7XHJcbiAgICAgICAgICAgIGFuaW1hdGlvblRhc2sgPSBuZXcgVGFza0NvbXBsZXRpb25Tb3VyY2U8b2JqZWN0PigpO1xyXG4gICAgICAgICAgICByZXR1cm4gYW5pbWF0aW9uVGFzay5UYXNrO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgQ29tcGxldGUoKSB7XHJcbiAgICAgICAgICAgIElzUnVubmluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICBJc0NvbXBsZXRlZCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBFbmQoKSB7XHJcbiAgICAgICAgICAgIE9uRW5kIT1udWxsP2dsb2JhbDo6QnJpZGdlLlNjcmlwdC5Gcm9tTGFtYmRhKCgpPT5PbkVuZC5JbnZva2UoKSk6bnVsbDtcclxuICAgICAgICAgICAgYW5pbWF0aW9uVGFzay5TZXRSZXN1bHQobnVsbCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgQW5pbWF0aW9uKEFjdGlvbiBvblN0YXJ0ID0gbnVsbCwgQWN0aW9uIG9uRW5kID0gbnVsbCkge1xyXG4gICAgICAgICAgICBPblN0YXJ0ID0gb25TdGFydDtcclxuICAgICAgICAgICAgT25FbmQgPSBvbkVuZDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGNsYXNzIE51bWJlckFuaW1hdGlvbiA6IEFuaW1hdGlvbiB7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IGN1cnJlbnQ7XHJcblxyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBzdGFydFZhbHVlO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBlbmRWYWx1ZTtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgc3RlcDtcclxuXHJcbiAgICAgICAgcHVibGljIG9iamVjdCB0YXJnZXQ7XHJcbiAgICAgICAgcHVibGljIHN0cmluZyBwcm9wZXJ0eTtcclxuICAgICAgICBwcml2YXRlIFByb3BlcnR5SW5mbyBwcm9wZXJ0eUluZm87XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBEbygpIHtcclxuICAgICAgICAgICAgaWYgKElzUnVubmluZykge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudCArPSBzdGVwO1xyXG4gICAgICAgICAgICAgICAgaWYgKChzdGVwID4gMCAmJiBjdXJyZW50ID4gZW5kVmFsdWUpIHx8IChzdGVwIDwgMCAmJiBjdXJyZW50IDwgZW5kVmFsdWUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudCA9IGVuZFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIENvbXBsZXRlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiNpZiBCUk9XU0VSXHJcbiAgICAgICAgICAgICAgICBwcm9wZXJ0eUluZm8uU2V0VmFsdWUodGFyZ2V0LCBjdXJyZW50KTtcclxuI2Vsc2VcclxuICAgICAgICAgICAgICAgIHByb3BlcnR5SW5mby5TZXRWYWx1ZSh0YXJnZXQsIENvbnZlcnQuQ2hhbmdlVHlwZShjdXJyZW50LCBwcm9wZXJ0eUluZm8uUHJvcGVydHlUeXBlKSk7XHJcbiNlbmRpZlxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgTnVtYmVyQW5pbWF0aW9uKHN0cmluZyBwcm9wZXJ0eSwgZmxvYXQgc3RhcnQsIGZsb2F0IGVuZCwgZmxvYXQgc3RlcCwgQWN0aW9uIG9uU3RhcnQgPSBudWxsLCBBY3Rpb24gb25FbmQgPSBudWxsLCBvYmplY3QgdGFyZ2V0ID0gbnVsbCkgOiBiYXNlKG9uU3RhcnQsIG9uRW5kKSB7XHJcbiAgICAgICAgICAgIHRoaXMucHJvcGVydHkgPSBwcm9wZXJ0eTtcclxuICAgICAgICAgICAgc3RhcnRWYWx1ZSA9IHN0YXJ0O1xyXG4gICAgICAgICAgICBlbmRWYWx1ZSA9IGVuZDtcclxuICAgICAgICAgICAgdGhpcy5zdGVwID0gc3RlcDtcclxuXHJcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0ID0gdGFyZ2V0O1xyXG4gICAgICAgICAgICBwcm9wZXJ0eUluZm8gPSB0YXJnZXQhPW51bGw/dGFyZ2V0LkdldFR5cGUoKS5HZXRQcm9wZXJ0eShwcm9wZXJ0eSk6KFByb3BlcnR5SW5mbyludWxsO1xyXG5cclxuICAgICAgICAgICAgSXNSdW5uaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIElzQ29tcGxldGVkID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBTZXRUYXJnZXQob2JqZWN0IHRhcmdldCkge1xyXG4gICAgICAgICAgICB0aGlzLnRhcmdldCA9IHRhcmdldDtcclxuICAgICAgICAgICAgdGhpcy5wcm9wZXJ0eUluZm8gPSB0YXJnZXQuR2V0VHlwZSgpLkdldFByb3BlcnR5KHRoaXMucHJvcGVydHkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIFRhc2s8b2JqZWN0PiBCZWdpbigpIHtcclxuICAgICAgICAgICAgY3VycmVudCA9IHN0YXJ0VmFsdWU7XHJcbiAgICAgICAgICAgIHJldHVybiBiYXNlLkJlZ2luKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBjbGFzcyBCbG9ja0FuaW1hdGlvbiA6IEFuaW1hdGlvbiB7XHJcbiAgICAgICAgcHVibGljIGVudW0gcHJvcGVydGllcyB7XHJcbiAgICAgICAgICAgIFgsIFksIEFscGhhXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgZmxvYXQgY3VycmVudDtcclxuXHJcbiAgICAgICAgcHVibGljIGZsb2F0IHN0YXJ0VmFsdWU7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IGVuZFZhbHVlO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBzdGVwO1xyXG5cclxuICAgICAgICBwdWJsaWMgQmxvY2sgdGFyZ2V0O1xyXG4gICAgICAgIHB1YmxpYyBwcm9wZXJ0aWVzIHByb3BlcnR5O1xyXG5cclxuXHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgRG8oKSB7XHJcbiAgICAgICAgICAgIGlmIChJc1J1bm5pbmcpIHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnQgKz0gc3RlcDtcclxuICAgICAgICAgICAgICAgIGlmICgoc3RlcCA+IDAgJiYgY3VycmVudCA+IGVuZFZhbHVlKSB8fCAoc3RlcCA8IDAgJiYgY3VycmVudCA8IGVuZFZhbHVlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnQgPSBlbmRWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBDb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChwcm9wZXJ0eSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgcHJvcGVydGllcy5YOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQuWCA9IChpbnQpY3VycmVudDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBwcm9wZXJ0aWVzLlk6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldC5ZID0gKGludCljdXJyZW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIHByb3BlcnRpZXMuQWxwaGE6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldC5BbHBoYSA9IGN1cnJlbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgQmxvY2tBbmltYXRpb24ocHJvcGVydGllcyBwcm9wZXJ0eSwgZmxvYXQgc3RhcnQsIGZsb2F0IGVuZCwgZmxvYXQgc3RlcCwgQWN0aW9uIG9uU3RhcnQgPSBudWxsLCBBY3Rpb24gb25FbmQgPSBudWxsLCBCbG9jayB0YXJnZXQgPSBudWxsKSA6IGJhc2Uob25TdGFydCwgb25FbmQpIHtcclxuICAgICAgICAgICAgdGhpcy5wcm9wZXJ0eSA9IHByb3BlcnR5O1xyXG4gICAgICAgICAgICBzdGFydFZhbHVlID0gc3RhcnQ7XHJcbiAgICAgICAgICAgIGVuZFZhbHVlID0gZW5kO1xyXG4gICAgICAgICAgICB0aGlzLnN0ZXAgPSBzdGVwO1xyXG5cclxuICAgICAgICAgICAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7XHJcblxyXG4gICAgICAgICAgICBJc1J1bm5pbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgSXNDb21wbGV0ZWQgPSBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFNldFRhcmdldChCbG9jayB0YXJnZXQpIHtcclxuICAgICAgICAgICAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgVGFzazxvYmplY3Q+IEJlZ2luKCkge1xyXG4gICAgICAgICAgICBjdXJyZW50ID0gc3RhcnRWYWx1ZTtcclxuICAgICAgICAgICAgcmV0dXJuIGJhc2UuQmVnaW4oKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHB1YmxpYyBjbGFzcyBMaXN0QW5pbWF0aW9uIDogQW5pbWF0aW9uIHtcclxuICAgICAgICBwdWJsaWMgTGlzdDxBbmltYXRpb24+IENoaWxkcmVuO1xyXG5cclxuICAgICAgICBpbnQgX2N1cnJlbnQ7XHJcblxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIERvKCkge1xyXG4gICAgICAgICAgICBpZiAoSXNSdW5uaW5nKSB7XHJcbiAgICAgICAgICAgICAgICBDaGlsZHJlbltfY3VycmVudF0uRG8oKTtcclxuICAgICAgICAgICAgICAgIGlmIChDaGlsZHJlbltfY3VycmVudF0uSXNDb21wbGV0ZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKF9jdXJyZW50ICsgMSA8IENoaWxkcmVuLkNvdW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9jdXJyZW50Kys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIENoaWxkcmVuW19jdXJyZW50XS5CZWdpbigpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBDb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgVGFzazxvYmplY3Q+IEJlZ2luKCkge1xyXG4gICAgICAgICAgICBfY3VycmVudCA9IDA7XHJcbiAgICAgICAgICAgIENoaWxkcmVuW19jdXJyZW50XS5CZWdpbigpO1xyXG4gICAgICAgICAgICByZXR1cm4gYmFzZS5CZWdpbigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIExpc3RBbmltYXRpb24oQWN0aW9uIG9uU3RhcnQsIEFjdGlvbiBvbkVuZClcclxuICAgICAgICAgICAgOiBiYXNlKG9uU3RhcnQsIG9uRW5kKSB7XHJcbiAgICAgICAgICAgIENoaWxkcmVuID0gbmV3IExpc3Q8QW5pbWF0aW9uPigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIFQgQWRkQ2hpbGQ8VD4oVCBjaGlsZCkgd2hlcmUgVCA6IEFuaW1hdGlvbiB7XHJcbiAgICAgICAgICAgIENoaWxkcmVuLkFkZChjaGlsZCk7XHJcbiAgICAgICAgICAgIHJldHVybiBjaGlsZDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGNsYXNzIE11bHRpQW5pbWF0aW9uIDogQW5pbWF0aW9uIHtcclxuICAgICAgICBwdWJsaWMgTGlzdDxBbmltYXRpb24+IENoaWxkcmVuO1xyXG5cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBEbygpIHtcclxuICAgICAgICAgICAgaWYgKElzUnVubmluZykge1xyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIGNoaWxkIGluIENoaWxkcmVuKVxyXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkLkRvKCk7XHJcbiAgICAgICAgICAgICAgICBib29sIGlzRW5kID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGZvcmVhY2ggKHZhciBjaGlsZCBpbiBDaGlsZHJlbilcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWNoaWxkLklzQ29tcGxldGVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0VuZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgaWYgKGlzRW5kKVxyXG4gICAgICAgICAgICAgICAgICAgIENvbXBsZXRlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSBUYXNrPG9iamVjdD4gQmVnaW4oKSB7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKHZhciBjaGlsZCBpbiBDaGlsZHJlbilcclxuICAgICAgICAgICAgICAgIGNoaWxkLkJlZ2luKCk7XHJcbiAgICAgICAgICAgIHJldHVybiBiYXNlLkJlZ2luKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgTXVsdGlBbmltYXRpb24ocGFyYW1zIEFuaW1hdGlvbltdIGNoaWxkcmVuKVxyXG4gICAgICAgICAgICA6IGJhc2UoKSB7XHJcbiAgICAgICAgICAgIENoaWxkcmVuID0gbmV3IExpc3Q8QW5pbWF0aW9uPigpO1xyXG4gICAgICAgICAgICBDaGlsZHJlbi5BZGRSYW5nZShjaGlsZHJlbik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgTXVsdGlBbmltYXRpb24oQWN0aW9uIG9uU3RhcnQgPSBudWxsLCBBY3Rpb24gb25FbmQgPSBudWxsLCBwYXJhbXMgQW5pbWF0aW9uW10gY2hpbGRyZW4pXHJcbiAgICAgICAgICAgIDogYmFzZShvblN0YXJ0LCBvbkVuZCkge1xyXG4gICAgICAgICAgICBDaGlsZHJlbiA9IG5ldyBMaXN0PEFuaW1hdGlvbj4oKTtcclxuICAgICAgICAgICAgQ2hpbGRyZW4uQWRkUmFuZ2UoY2hpbGRyZW4pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIFQgQWRkQ2hpbGQ8VD4oVCBjaGlsZCkgd2hlcmUgVCA6IEFuaW1hdGlvbiB7XHJcbiAgICAgICAgICAgIENoaWxkcmVuLkFkZChjaGlsZCk7XHJcbiAgICAgICAgICAgIHJldHVybiBjaGlsZDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgTWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuR3JhcGhpY3M7XHJcblxyXG5uYW1lc3BhY2UgTW9ub0ludGVyZmFjZVxyXG57XHJcbiAgICBwdWJsaWMgc3RydWN0IEFwcGVhcmFuY2VcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgU3ByaXRlIHNwcml0ZTtcclxuICAgICAgICBwdWJsaWMgaW50IGltZztcclxuXHJcbiAgICAgICAgcHVibGljIEFwcGVhcmFuY2UoU3ByaXRlIHNwcml0ZSwgaW50IGltZylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuc3ByaXRlID0gc3ByaXRlO1xyXG4gICAgICAgICAgICB0aGlzLmltZyA9IGltZztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIERyYXcoU3ByaXRlQmF0Y2ggc2IsIGZsb2F0IHgsIGZsb2F0IHksIFNwcml0ZUVmZmVjdHMgZWZmZWN0ID0gU3ByaXRlRWZmZWN0cy5Ob25lLCBmbG9hdCBhbHBoYSA9IDEuMGYpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBzcHJpdGUuRHJhdyhpbWcsIHgsIHksIHNiLCBlZmZlY3QsIGFscGhhKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIERyYXcoU3ByaXRlQmF0Y2ggc2IsIGludCB4LCBpbnQgeSwgaW50IHcsIGludCBoLCBTcHJpdGVFZmZlY3RzIGVmZmVjdCA9IFNwcml0ZUVmZmVjdHMuTm9uZSwgZmxvYXQgYWxwaGEgPSAxLjBmKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgc3ByaXRlLkRyYXcoaW1nLCB4LCB5LCB3LCBoLCBzYiwgZWZmZWN0LCBhbHBoYSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59IiwidXNpbmcgTWljcm9zb2Z0LlhuYS5GcmFtZXdvcms7XHJcbnVzaW5nIE1pY3Jvc29mdC5YbmEuRnJhbWV3b3JrLkdyYXBoaWNzO1xyXG5cclxubmFtZXNwYWNlIE1vbm9JbnRlcmZhY2Vcclxue1xyXG4gICAgcHVibGljIGFic3RyYWN0IGNsYXNzIEJsb2NrXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIENvbnRhaW5lciBQYXJlbnQgeyBnZXQ7IHNldDsgfVxyXG5cclxuICAgICAgICBwdWJsaWMgaW50IFggeyBnZXQ7IHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBpbnQgWSB7IGdldDsgc2V0OyB9XHJcblxyXG4gICAgICAgIHByb3RlY3RlZCBpbnQgX3c7XHJcbiAgICAgICAgcHJvdGVjdGVkIGludCBfaDtcclxuXHJcbiAgICAgICAgcHVibGljIGludCBXIHtcclxuICAgICAgICAgICAgZ2V0IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAoX3cgPT0gLTEgJiYgUGFyZW50ICE9IG51bGwpID8gUGFyZW50LlcgOiBfdztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXQge1xyXG4gICAgICAgICAgICAgICAgX3cgPSB2YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGludCBIIHtcclxuICAgICAgICAgICAgZ2V0IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAoX2ggPT0gLTEgJiYgUGFyZW50ICE9IG51bGwpID8gUGFyZW50LkggOiBfaDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXQge1xyXG4gICAgICAgICAgICAgICAgX2ggPSB2YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGludCBSaWdodCB7XHJcbiAgICAgICAgICAgIGdldCB7IHJldHVybiBYICsgVzsgfVxyXG4gICAgICAgICAgICBzZXQge1xyXG4gICAgICAgICAgICAgICAgWCA9IHZhbHVlIC0gVztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGludCBCb3R0b20ge1xyXG4gICAgICAgICAgICBnZXQgeyByZXR1cm4gWSArIEg7IH1cclxuICAgICAgICAgICAgc2V0IHtcclxuICAgICAgICAgICAgICAgIFkgPSB2YWx1ZSAtIEg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBWZWN0b3IyIEFsaWdubWVudCB7IGdldDsgc2V0OyB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBBbHBoYSB7IGdldDsgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIGJvb2wgVmlzaWJsZSB7IGdldDsgc2V0OyB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBUaGVtZSBDdXJyZW50VGhlbWUgeyBnZXQ7IHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBMb2NhbGl6YXRpb24gQ3VycmVudExvY2FsaXphdGlvbiB7IGdldDsgc2V0OyB9XHJcblxyXG4gICAgICAgIHByb3RlY3RlZCBpbnQgX2ZpbmFsWCwgX2ZpbmFsWSwgX2ZpbmFsVywgX2ZpbmFsSDtcclxuXHJcbiAgICAgICAgcHVibGljIGludCBGaW5hbFgge1xyXG4gICAgICAgICAgICBnZXQge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9maW5hbFg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgRmluYWxZIHtcclxuICAgICAgICAgICAgZ2V0IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBfZmluYWxZO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIGludCBGaW5hbFcge1xyXG4gICAgICAgICAgICBnZXQge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9maW5hbFc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgaW50IEZpbmFsSCB7XHJcbiAgICAgICAgICAgIGdldCB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX2ZpbmFsSDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGludCBGaW5hbFJpZ2h0IHtcclxuICAgICAgICAgICAgZ2V0IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBfZmluYWxYICsgX2ZpbmFsVztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGludCBGaW5hbEJvdHRvbSB7XHJcbiAgICAgICAgICAgIGdldCB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX2ZpbmFsWSArIF9maW5hbEg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBib29sIElzTmVlZFJlY2FsYyB7IGdldDsgc2V0OyB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2aXJ0dWFsIHZvaWQgQ2hlY2tGb3JSZWNhbGMoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKElzTmVlZFJlY2FsYylcclxuICAgICAgICAgICAgICAgIFJlY2FsYygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZpcnR1YWwgdm9pZCBSZWNhbGMoKVxyXG4gICAgICAgIHtcclxuXHJcbiAgICAgICAgICAgIF9maW5hbFcgPSBfdyA9PSAtMSA/IFBhcmVudC5GaW5hbFcgOiAoaW50KShXICogUGFyZW50LkZpbmFsQ2hpbGRyZW5TY2FsZVgpO1xyXG4gICAgICAgICAgICBfZmluYWxIID0gX2ggPT0gLTEgPyBQYXJlbnQuRmluYWxIIDogKGludCkoSCAqIFBhcmVudC5GaW5hbENoaWxkcmVuU2NhbGVZKTtcclxuICAgICAgICAgICAgX2ZpbmFsWCA9IFBhcmVudC5GaW5hbFggKyAoaW50KShQYXJlbnQuRmluYWxDaGlsZHJlblNjYWxlWCAqIFggKyAoUGFyZW50LkZpbmFsVyAtIF9maW5hbFcpICogQWxpZ25tZW50LlgpO1xyXG4gICAgICAgICAgICBfZmluYWxZID0gUGFyZW50LkZpbmFsWSArIChpbnQpKFBhcmVudC5GaW5hbENoaWxkcmVuU2NhbGVZICogWSArIChQYXJlbnQuRmluYWxIIC0gX2ZpbmFsSCkgKiBBbGlnbm1lbnQuWSk7XHJcbiAgICAgICAgICAgIElzTmVlZFJlY2FsYyA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGFic3RyYWN0IHZvaWQgRHJhdyhTcHJpdGVCYXRjaCBzYiwgZmxvYXQgcGFyZW50QWxwaGEgPSAxLjBmKTtcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBBbmltYXRpb24gX3Nob3dBbmltYXRpb247XHJcbiAgICAgICAgcHJpdmF0ZSBBbmltYXRpb24gX2hpZGVBbmltYXRpb247XHJcblxyXG4gICAgICAgIHB1YmxpYyBBbmltYXRpb24gU2hvd0FuaW1hdGlvbiB7XHJcbiAgICAgICAgICAgIGdldCB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX3Nob3dBbmltYXRpb247XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0IHtcclxuICAgICAgICAgICAgICAgIF9zaG93QW5pbWF0aW9uID0gdmFsdWU7XHJcbk51bWJlckFuaW1hdGlvbiBuYTsgICAgICAgICAgICAgICAgaWYgKChuYSA9IF9zaG93QW5pbWF0aW9uIGFzIE51bWJlckFuaW1hdGlvbikgIT0gbnVsbCYmIG5hLnRhcmdldCA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIG5hLlNldFRhcmdldCh0aGlzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIEFuaW1hdGlvbiBIaWRlQW5pbWF0aW9uIHtcclxuICAgICAgICAgICAgZ2V0IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBfaGlkZUFuaW1hdGlvbjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXQge1xyXG4gICAgICAgICAgICAgICAgX2hpZGVBbmltYXRpb24gPSB2YWx1ZTtcclxuTnVtYmVyQW5pbWF0aW9uIG5hOyAgICAgICAgICAgICAgICBpZiAoKG5hID0gX2hpZGVBbmltYXRpb24gYXMgTnVtYmVyQW5pbWF0aW9uKSAhPSBudWxsJiYgbmEudGFyZ2V0ID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgbmEuU2V0VGFyZ2V0KHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgSGlkZUFuaW1hdGlvbi5PbkVuZCArPSAoKSA9PiB0aGlzLlZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgU2hvdyhBbmltYXRvciBhbmltYXRvciA9IG51bGwpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5WaXNpYmxlID09IGZhbHNlKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLlZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgaWYgKGFuaW1hdG9yICE9IG51bGwgJiYgU2hvd0FuaW1hdGlvbiAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIGFuaW1hdG9yLkFkZENoaWxkPEFuaW1hdGlvbj4oU2hvd0FuaW1hdGlvbikuQmVnaW4oKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEhpZGUoQW5pbWF0b3IgYW5pbWF0b3IgPSBudWxsKVxyXG4gICAgICAgIHtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLlZpc2libGUgPT0gdHJ1ZSlcclxuICAgICAgICAgICAgICAgIGlmIChhbmltYXRvciAhPSBudWxsICYmIEhpZGVBbmltYXRpb24gIT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICBhbmltYXRvci5BZGRDaGlsZDxBbmltYXRpb24+KEhpZGVBbmltYXRpb24pLkJlZ2luKCk7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5WaXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdmlydHVhbCB2b2lkIEFwcGx5VGhlbWUoVGhlbWUgY3VycmVudFRoZW1lKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgQ3VycmVudFRoZW1lID0gY3VycmVudFRoZW1lO1xyXG4gICAgICAgICAgICBJc05lZWRSZWNhbGMgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZpcnR1YWwgdm9pZCBBcHBseUxvY2FsaXphdGlvbihMb2NhbGl6YXRpb24gY3VycmVudExvY2FsaXphdGlvbilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEN1cnJlbnRMb2NhbGl6YXRpb24gPSBjdXJyZW50TG9jYWxpemF0aW9uO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxuXHJcbm5hbWVzcGFjZSBNb25vSW50ZXJmYWNlXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBMb2NhbGl6YXRpb25cclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgc3RyaW5nIE5hbWUgeyBnZXQ7IHNldDsgfVxyXG5cclxuICAgICAgICByZWFkb25seSBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPiBfc3RyaW5ncyA9IG5ldyBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPigpO1xyXG5cclxuXHJcbiAgICAgICAgcHVibGljIExvY2FsaXphdGlvbihzdHJpbmcgbmFtZSwgRGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4gc3RyaW5ncylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIE5hbWUgPSBuYW1lO1xyXG4gICAgICAgICAgICBfc3RyaW5ncyA9IHN0cmluZ3M7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBBZGRTdHJpbmcoc3RyaW5nIGtleSwgc3RyaW5nIHRleHQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBfc3RyaW5ncy5BZGQoa2V5LCB0ZXh0KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgR2V0U3RyaW5nKHN0cmluZyBrZXkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoX3N0cmluZ3MuQ29udGFpbnNLZXkoa2V5KSlcclxuICAgICAgICAgICAgICAgIHJldHVybiBfc3RyaW5nc1trZXldO1xyXG4gICAgICAgICAgICByZXR1cm4ga2V5O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0cmluZyBHZXRTdHJpbmcoc3RyaW5nIGtleSwgcGFyYW1zIG9iamVjdFtdIGFyZ3MpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoX3N0cmluZ3MuQ29udGFpbnNLZXkoa2V5KSlcclxuICAgICAgICAgICAgICAgIHJldHVybiBzdHJpbmcuRm9ybWF0KF9zdHJpbmdzW2tleV0sIGFyZ3MpO1xyXG4gICAgICAgICAgICByZXR1cm4ga2V5O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgTWljcm9zb2Z0LlhuYS5GcmFtZXdvcms7XHJcbnVzaW5nIE1pY3Jvc29mdC5YbmEuRnJhbWV3b3JrLkdyYXBoaWNzO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgTmV3dG9uc29mdC5Kc29uO1xyXG5cclxubmFtZXNwYWNlIE1vbm9JbnRlcmZhY2Uge1xyXG5cclxuICAgIHB1YmxpYyBjbGFzcyBTcHJpdGUge1xyXG4gICAgICAgIHB1YmxpYyBUZXh0dXJlMkQgVGV4dHVyZSB7IGdldDsgc2V0OyB9XHJcblxyXG4gICAgICAgIFtKc29uUHJvcGVydHkoXCJuYW1lXCIpXVxyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgTmFtZSB7IGdldDsgc2V0OyB9XHJcblxyXG4gICAgICAgIFtKc29uUHJvcGVydHkoXCJXaWR0aFwiKV1cclxuICAgICAgICBwdWJsaWMgaW50IFcgeyBnZXQ7IHNldDsgfVxyXG4gICAgICAgIFtKc29uUHJvcGVydHkoXCJIZWlnaHRcIildXHJcbiAgICAgICAgcHVibGljIGludCBIIHsgZ2V0OyBzZXQ7IH1cclxuXHJcbiAgICAgICAgW0pzb25Qcm9wZXJ0eShcIkFuaW1hdGlvbnNcIildXHJcbiAgICAgICAgcHVibGljIERpY3Rpb25hcnk8c3RyaW5nLCBTeXN0ZW0uVmFsdWVUdXBsZTxpbnQgLGludCA+PiBSYW5nZXMgeyBnZXQ7IHNldDsgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBEcmF3KGludCBpbmQsIGZsb2F0IHgsIGZsb2F0IHksIFNwcml0ZUJhdGNoIHNiLCBTcHJpdGVFZmZlY3RzIGVmZmVjdCA9IFNwcml0ZUVmZmVjdHMuTm9uZSwgZmxvYXQgYWxwaGEgPSAxLjBmKSB7XHJcbiAgICAgICAgICAgIHZhciBjb2xvciA9IGFscGhhID09IDEuMGYgPyBDb2xvci5XaGl0ZSA6IG5ldyBDb2xvcigxLjBmLCAxLjBmLCAxLjBmLCBhbHBoYSk7XHJcbiAgICAgICAgICAgIHNiLkRyYXcoVGV4dHVyZSwgbmV3IFZlY3RvcjIoeCwgeSksIFJlY3RGcm9tSW5kZXgoaW5kKSwgY29sb3IsIDAsIFZlY3RvcjIuWmVybywgMSwgZWZmZWN0LCAwZik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBEcmF3KGludCBpbmQsIGludCB4LCBpbnQgeSwgaW50IHcsIGludCBoLCBTcHJpdGVCYXRjaCBzYiwgU3ByaXRlRWZmZWN0cyBlZmZlY3QgPSBTcHJpdGVFZmZlY3RzLk5vbmUsIGZsb2F0IGFscGhhID0gMS4wZikge1xyXG4gICAgICAgICAgICB2YXIgY29sb3IgPSBhbHBoYSA9PSAxLjBmID8gQ29sb3IuV2hpdGUgOiBuZXcgQ29sb3IoMS4wZiwgMS4wZiwgMS4wZiwgYWxwaGEpO1xyXG4gICAgICAgICAgICBzYi5EcmF3KFRleHR1cmUsIG5ldyBSZWN0YW5nbGUoeCwgeSwgdywgaCksIFJlY3RGcm9tSW5kZXgoaW5kKSwgY29sb3IsIDAsIFZlY3RvcjIuWmVybywgZWZmZWN0LCAwZik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgUmVjdGFuZ2xlIFJlY3RGcm9tSW5kZXgoaW50IGluZCkge1xyXG4gICAgICAgICAgICBpbnQgY29sdW1ucyA9IFRleHR1cmUuV2lkdGggLyBXO1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFJlY3RhbmdsZSgoaW5kICUgY29sdW1ucykgKiBXLCAoaW5kIC8gY29sdW1ucykgKiBILCBXLCBIKTtcclxuICAgICAgICB9XHJcblxuICAgIFxucHJpdmF0ZSBEaWN0aW9uYXJ5PHN0cmluZywgU3lzdGVtLlZhbHVlVHVwbGU8aW50ICxpbnQgPj4gX19Qcm9wZXJ0eV9fSW5pdGlhbGl6ZXJfX1Jhbmdlcz1uZXcgRGljdGlvbmFyeTxzdHJpbmcsIFN5c3RlbS5WYWx1ZVR1cGxlPGludCAsaW50ID4+KCk7fVxyXG59XHJcbiIsInVzaW5nIE1pY3Jvc29mdC5YbmEuRnJhbWV3b3JrO1xyXG51c2luZyBNaWNyb3NvZnQuWG5hLkZyYW1ld29yay5HcmFwaGljcztcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcblxyXG5uYW1lc3BhY2UgTW9ub0ludGVyZmFjZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgVGhlbWVcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgQXBwZWFyYW5jZSBGcmFtZUJhY2tUZXh0dXJlIHsgZ2V0OyBzZXQ7IH1cclxuXHJcbiAgICAgICAgcHVibGljIEFwcGVhcmFuY2UgQnV0dG9uQmFja1RleHR1cmUgeyBnZXQ7IHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBBcHBlYXJhbmNlIEJ1dHRvbkZyb250VGV4dHVyZSB7IGdldDsgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIEFwcGVhcmFuY2UgQnV0dG9uUHJlc3NlZFRleHR1cmUgeyBnZXQ7IHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBBcHBlYXJhbmNlIEJ1dHRvbkRpc2FibGVkVGV4dHVyZSB7IGdldDsgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIEFwcGVhcmFuY2UgQnV0dG9uU2VsZWN0ZWRUZXh0dXJlIHsgZ2V0OyBzZXQ7IH1cclxuXHJcbiAgICAgICAgcHVibGljIENvbG9yIEZvbnRDb2xvciB7IGdldDsgc2V0OyB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBBcHBlYXJhbmNlIFByb2dyZXNzQmFja1RleHR1cmUgeyBnZXQ7IHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBBcHBlYXJhbmNlIFByb2dyZXNzRnJvbnRUZXh0dXJlIHsgZ2V0OyBzZXQ7IH1cclxuXHJcbiAgICAgICAgcHVibGljIEFwcGVhcmFuY2UgU3dpdGNoZXJCdXR0b25MZWZ0VGV4dHVyZSB7IGdldDsgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIEFwcGVhcmFuY2UgU3dpdGNoZXJCdXR0b25SaWdodFRleHR1cmUgeyBnZXQ7IHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBpbnQgU3dpdGNoZXJNYWluRm9udFNpemUgeyBnZXQ7IHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBDb2xvciBTd2l0Y2hlck1haW5Db2xvciB7IGdldDsgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIGludCBTd2l0Y2hlckRlc2NyaXB0aW9uRm9udFNpemUgeyBnZXQ7IHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBDb2xvciBTd2l0Y2hlckRlc2NyaXB0aW9uQ29sb3IgeyBnZXQ7IHNldDsgfVxyXG5cclxuICAgICAgICBwdWJsaWMgQXBwZWFyYW5jZVtdIE5pbmVGcmFtZUJvZGVyVGV4dHVyZSB7IGdldDsgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIEFwcGVhcmFuY2VbXSBOaW5lU2xpY2VCdXR0b25CYWNrVGV4dHVyZSB7IGdldDsgc2V0OyB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBMaXN0PFN5c3RlbS5WYWx1ZVR1cGxlPGludCAsU3ByaXRlRm9udCA+PiBGb250cyB7IGdldDsgc2V0OyB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBBcHBlYXJhbmNlIEVtcHR5VGV4dHVyZSB7IGdldDsgc2V0OyB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBTcHJpdGVGb250IEdldEZvbnQoaW50IHNpemUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IEZvbnRzLkNvdW50OyBpKyspXHJcbiAgICAgICAgICAgICAgICBpZiAoRm9udHNbaV0uSXRlbTE+PSBzaXplKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBGb250c1tpXS5JdGVtMjtcclxuICAgICAgICAgICAgcmV0dXJuIEZvbnRzW0ZvbnRzLkNvdW50IC0gMV0uSXRlbTI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgVGhlbWUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgRm9udHMgPSBuZXcgTGlzdDxTeXN0ZW0uVmFsdWVUdXBsZTxpbnQgLFNwcml0ZUZvbnQgPj4oKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVGV4dHVyZTJEIFNvbGlkQ29sb3JUZXh0dXJlKEdyYXBoaWNzRGV2aWNlIGdkLCBpbnQgciwgaW50IGcsIGludCBiLCBpbnQgYSA9IDI1NSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciB0ZXggPSBuZXcgVGV4dHVyZTJEKGdkLCAxLCAxKTtcclxuICAgICAgICAgICAgaW50W10gZGF0YSA9IHsgciwgZywgYiwgYSB9O1xyXG4gICAgICAgICAgICB0ZXguU2V0RGF0YTxpbnQ+KGRhdGEsIDAsIDEpO1xyXG4gICAgICAgICAgICByZXR1cm4gdGV4O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBBcHBlYXJhbmNlIEdldEVtcHR5QXBwKEdyYXBoaWNzRGV2aWNlIGdkKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBBcHBlYXJhbmNlKG5ldyBTcHJpdGUoKSB7IFRleHR1cmUgPSBuZXcgVGV4dHVyZTJEKGdkLCAxLCAxKSwgVyA9IDEsIEggPSAxIH0sIDApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBNaWNyb3NvZnQuWG5hLkZyYW1ld29yay5HcmFwaGljcztcclxuXHJcbm5hbWVzcGFjZSBEYXJrS2luZ2RvbUNvcmVcclxue1xyXG4gICAgcHVibGljIGNsYXNzIEltYWdlUGFydGljbGUgOiBQYXJ0aWNsZVxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Ugc3ByaXRlUmVmO1xyXG4gICAgICAgIHB1YmxpYyBib29sIGlzTWlycm9yZWQ7XHJcblxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIFhOQURyYXcoU3ByaXRlQmF0Y2ggc2IpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBzcHJpdGVSZWYuRHJhdyhzYiwgeCwgeSwgaXNNaXJyb3JlZCA/IFNwcml0ZUVmZmVjdHMuRmxpcEhvcml6b250YWxseSA6IFNwcml0ZUVmZmVjdHMuTm9uZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgSW1hZ2VQYXJ0aWNsZShNb25vSW50ZXJmYWNlLkFwcGVhcmFuY2Ugc3ByaXRlUmVmLCBmbG9hdCB4eCwgZmxvYXQgeXksIGZsb2F0IGR4eCwgZmxvYXQgZHl5LCBpbnQgbHQsIGJvb2wgaXNNaXIgPSBmYWxzZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHggPSB4eDtcclxuICAgICAgICAgICAgeSA9IHl5O1xyXG4gICAgICAgICAgICBkeCA9IGR4eDtcclxuICAgICAgICAgICAgZHkgPSBkeXk7XHJcbiAgICAgICAgICAgIGx0aW1lID0gbHQ7XHJcbiAgICAgICAgICAgIHRoaXMuc3ByaXRlUmVmID0gc3ByaXRlUmVmO1xyXG4gICAgICAgICAgICBwVHlwZSA9IFBhclR5cGUuSW1hZ2U7XHJcbiAgICAgICAgICAgIGlzTWlycm9yZWQgPSBpc01pcjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgTWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuR3JhcGhpY3M7XHJcbnVzaW5nIE1pY3Jvc29mdC5YbmEuRnJhbWV3b3JrO1xyXG5cclxubmFtZXNwYWNlIERhcmtLaW5nZG9tQ29yZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgVGV4dFBhcnRpY2xlIDogUGFydGljbGVcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgc3RyaW5nIHN0cjtcclxuICAgICAgICBwdWJsaWMgQ29sb3IgY2xyO1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBzaGlmdFg7XHJcbiAgICAgICAgcHVibGljIFNwcml0ZUZvbnQgZm9udDtcclxuXHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgWE5BRHJhdyhTcHJpdGVCYXRjaCBzYilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHNiLkRyYXdTdHJpbmcoZm9udCwgc3RyLCBuZXcgVmVjdG9yMih4ICsgc2hpZnRYLCB5KSwgY2xyKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBUZXh0UGFydGljbGUoU3ByaXRlRm9udCBmbnQsIENvbG9yIGMsIGZsb2F0IHh4LCBmbG9hdCB5eSwgZmxvYXQgZHh4LCBmbG9hdCBkeXksIGZsb2F0IGF5eSwgaW50IGx0LCBzdHJpbmcgcylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGNsciA9IGM7XHJcbiAgICAgICAgICAgIHggPSB4eDtcclxuICAgICAgICAgICAgeSA9IHl5O1xyXG4gICAgICAgICAgICBkeCA9IGR4eDtcclxuICAgICAgICAgICAgZHkgPSBkeXk7XHJcbiAgICAgICAgICAgIGx0aW1lID0gbHQ7XHJcbiAgICAgICAgICAgIGF5ID0gYXl5O1xyXG4gICAgICAgICAgICBzdHIgPSBzO1xyXG4gICAgICAgICAgICBhID0gNzY4O1xyXG4gICAgICAgICAgICBmb250ID0gZm50O1xyXG4gICAgICAgICAgICBhc3QgPSA3NjggLyBsdGltZTtcclxuICAgICAgICAgICAgcFR5cGUgPSBQYXJUeXBlLlRleHQ7XHJcbiAgICAgICAgICAgIHNoaWZ0WCA9IC1mbnQuTWVhc3VyZVN0cmluZyhzdHIpLlggLyAyO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBNaWNyb3NvZnQuWG5hLkZyYW1ld29yaztcclxudXNpbmcgTWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuR3JhcGhpY3M7XHJcbnVzaW5nIE1pY3Jvc29mdC5YbmEuRnJhbWV3b3JrLklucHV0O1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxuXHJcbm5hbWVzcGFjZSBNb25vSW50ZXJmYWNlXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBDb250YWluZXIgOiBCbG9ja1xyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBDaGlsZHJlblNjYWxlWCB7IGdldDsgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIGZsb2F0IENoaWxkcmVuU2NhbGVZIHsgZ2V0OyBzZXQ7IH1cclxuXHJcbiAgICAgICAgcHJvdGVjdGVkIGZsb2F0IF9maW5hbENoaWxkcmVuU2NhbGVYO1xyXG4gICAgICAgIHByb3RlY3RlZCBmbG9hdCBfZmluYWxDaGlsZHJlblNjYWxlWTtcclxuXHJcbiAgICAgICAgcHVibGljIGZsb2F0IEZpbmFsQ2hpbGRyZW5TY2FsZVggeyBnZXQgeyByZXR1cm4gX2ZpbmFsQ2hpbGRyZW5TY2FsZVg7IH0gfVxyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBGaW5hbENoaWxkcmVuU2NhbGVZIHsgZ2V0IHsgcmV0dXJuIF9maW5hbENoaWxkcmVuU2NhbGVZOyB9IH1cclxuXHJcbiAgICAgICAgcHVibGljIExpc3Q8QmxvY2s+IENoaWxkcmVuIHsgZ2V0OyBwcml2YXRlIHNldDsgfVxyXG5cclxuICAgICAgICBwdWJsaWMgIHZpcnR1YWwgVCBBZGRDaGlsZDxUPihUIGNoaWxkKSB3aGVyZSBUIDogQmxvY2tcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGNoaWxkLlBhcmVudCA9IHRoaXM7XHJcbiAgICAgICAgICAgIENoaWxkcmVuLkFkZChjaGlsZCk7XHJcbiAgICAgICAgICAgIHJldHVybiBjaGlsZDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIERyYXcoU3ByaXRlQmF0Y2ggc2IsIGZsb2F0IHBhcmVudEFscGhhKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKFZpc2libGUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGZvcmVhY2ggKHZhciBjaGlsZCBpbiBDaGlsZHJlbilcclxuICAgICAgICAgICAgICAgICAgICBjaGlsZC5EcmF3KHNiLCBwYXJlbnRBbHBoYSAqIEFscGhhKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIENvbnRhaW5lcihpbnQgeCwgaW50IHksIGludCB3LCBpbnQgaCwgZmxvYXQgaG9yQWxpZ24gPSAwLjVmLCBmbG9hdCB2ZXJBbGlnbiA9IDAuNWYsIGJvb2wgdmlzaWJsZSA9IHRydWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBYID0geDtcclxuICAgICAgICAgICAgWSA9IHk7XHJcbiAgICAgICAgICAgIFcgPSB3O1xyXG4gICAgICAgICAgICBIID0gaDtcclxuICAgICAgICAgICAgQ2hpbGRyZW5TY2FsZVggPSAxLjBmO1xyXG4gICAgICAgICAgICBDaGlsZHJlblNjYWxlWSA9IDEuMGY7XHJcbiAgICAgICAgICAgIEFscGhhID0gMS4wZjtcclxuICAgICAgICAgICAgQWxpZ25tZW50ID0gbmV3IFZlY3RvcjIoaG9yQWxpZ24sIHZlckFsaWduKTtcclxuICAgICAgICAgICAgVmlzaWJsZSA9IHZpc2libGU7XHJcbiAgICAgICAgICAgIENoaWxkcmVuID0gbmV3IExpc3Q8QmxvY2s+KCk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIHZpcnR1YWwgdm9pZCBDbGljayhpbnQgeCwgaW50IHksIGJvb2wgaXNUb3VjaClcclxuICAgICAgICB7IH1cclxuXHJcbiAgICAgICAgcHVibGljIHZpcnR1YWwgdm9pZCBGb2N1cygpXHJcbiAgICAgICAgeyB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2aXJ0dWFsIHZvaWQgVGFwQW5kSG9sZCgpXHJcbiAgICAgICAgeyB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIENoZWNrRm9yUmVjYWxjKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChJc05lZWRSZWNhbGMpXHJcbiAgICAgICAgICAgICAgICBSZWNhbGMoKTtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIGNoaWxkIGluIENoaWxkcmVuKVxyXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkLkNoZWNrRm9yUmVjYWxjKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBSZWNhbGMoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYmFzZS5SZWNhbGMoKTtcclxuICAgICAgICAgICAgX2ZpbmFsQ2hpbGRyZW5TY2FsZVggPSBDaGlsZHJlblNjYWxlWCAqIFBhcmVudC5GaW5hbENoaWxkcmVuU2NhbGVYO1xyXG4gICAgICAgICAgICBfZmluYWxDaGlsZHJlblNjYWxlWSA9IENoaWxkcmVuU2NhbGVZICogUGFyZW50LkZpbmFsQ2hpbGRyZW5TY2FsZVk7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKHZhciBjaGlsZCBpbiBDaGlsZHJlbilcclxuICAgICAgICAgICAgICAgIGNoaWxkLlJlY2FsYygpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgQ29udGFpbmVyIEdldENvbnRhaW5lckJ5UG9pbnQoaW50IHgsIGludCB5LCBvdXQgaW50IGZpbmFsWCwgb3V0IGludCBmaW5hbFkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoVmlzaWJsZSA9PSB0cnVlICYmXHJcbiAgICAgICAgICAgICAgICAgRmluYWxYIDw9IHggJiYgeCA8PSBGaW5hbFggKyBGaW5hbFcgJiZcclxuICAgICAgICAgICAgICAgICBGaW5hbFkgPD0geSAmJiB5IDw9IEZpbmFsWSArIEZpbmFsSClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZmluYWxYID0geCAtIEZpbmFsWDtcclxuICAgICAgICAgICAgICAgIGZpbmFsWSA9IHkgLSBGaW5hbFk7XHJcbiAgICAgICAgICAgICAgICBDb250YWluZXIgY29udCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBmb3JlYWNoICh2YXIgY2hpbGQgaW4gQ2hpbGRyZW4pXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkIGlzIENvbnRhaW5lcilcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbmludCBmWDtcbmludCBmWTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gKChDb250YWluZXIpY2hpbGQpLkdldENvbnRhaW5lckJ5UG9pbnQoeCwgeSwgb3V0IGZYLCBvdXQgZlkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYyAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbFggPSBmWDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsWSA9IGZZO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udCA9IGM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29udCA/PyB0aGlzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZpbmFsWCA9IDA7XHJcbiAgICAgICAgICAgIGZpbmFsWSA9IDA7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIEJ1dHRvbiBHZXRCdXR0b25CeUhvdEtleShLZXlzIGtleSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEJ1dHRvbiByZXN1bHQgPSBudWxsO1xyXG4gICAgICAgICAgICBmb3JlYWNoICh2YXIgY2hpbGQgaW4gQ2hpbGRyZW4pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChjaGlsZC5WaXNpYmxlKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjaGlsZCBpcyBCdXR0b24gJiYgKChCdXR0b24pY2hpbGQpLkhvdEtleSA9PSBrZXkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IChCdXR0b24pY2hpbGQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkIGlzIENvbnRhaW5lcilcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gKChDb250YWluZXIpY2hpbGQpLkdldEJ1dHRvbkJ5SG90S2V5KGtleSkgPz8gcmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgQXBwbHlUaGVtZShUaGVtZSBjdXJyZW50VGhlbWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBiYXNlLkFwcGx5VGhlbWUoY3VycmVudFRoZW1lKTtcclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIGNoaWxkIGluIENoaWxkcmVuKVxyXG4gICAgICAgICAgICAgICAgY2hpbGQuQXBwbHlUaGVtZShjdXJyZW50VGhlbWUpO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIEFwcGx5TG9jYWxpemF0aW9uKExvY2FsaXphdGlvbiBjdXJyZW50TG9jYWxpemF0aW9uKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYmFzZS5BcHBseUxvY2FsaXphdGlvbihjdXJyZW50TG9jYWxpemF0aW9uKTtcclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIGNoaWxkIGluIENoaWxkcmVuKVxyXG4gICAgICAgICAgICAgICAgY2hpbGQuQXBwbHlMb2NhbGl6YXRpb24oY3VycmVudExvY2FsaXphdGlvbik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBNaWNyb3NvZnQuWG5hLkZyYW1ld29yaztcclxudXNpbmcgTWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuR3JhcGhpY3M7XHJcblxyXG5uYW1lc3BhY2UgTW9ub0ludGVyZmFjZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgTGFiZWwgOiBCbG9ja1xyXG4gICAge1xyXG4gICAgICAgIHByaXZhdGUgc3RyaW5nIF90ZXh0O1xyXG4gICAgICAgIHByaXZhdGUgaW50IF9zaXplO1xyXG5cclxuICAgICAgICBwdWJsaWMgc3RyaW5nIFRleHRcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7IHJldHVybiBfdGV4dDsgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgX3RleHQgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgIElzTmVlZFJlY2FsYyA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGludCBTaXplXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXQgeyByZXR1cm4gX3NpemU7IH1cclxuICAgICAgICAgICAgc2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIF9zaXplID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICBJc05lZWRSZWNhbGMgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgQ29sb3I/IFRleHRDb2xvciB7IGdldDsgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIFNwcml0ZUZvbnQgRmluYWxGb250IHsgZ2V0OyBwcml2YXRlIHNldDsgfVxyXG5cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBSZWNhbGMoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgRmluYWxGb250ID0gQ3VycmVudFRoZW1lLkdldEZvbnQoKGludCkoU2l6ZSAqIFBhcmVudC5GaW5hbENoaWxkcmVuU2NhbGVZKSk7XHJcbiAgICAgICAgICAgIHZhciB3aCA9IEZpbmFsRm9udC5NZWFzdXJlU3RyaW5nKEN1cnJlbnRMb2NhbGl6YXRpb24gPT0gbnVsbCA/IFRleHQgOiBDdXJyZW50TG9jYWxpemF0aW9uLkdldFN0cmluZyhUZXh0KSk7XHJcbiAgICAgICAgICAgIF9maW5hbFcgPSBXID0gKGludCl3aC5YO1xyXG4gICAgICAgICAgICBfZmluYWxIID0gSCA9IChpbnQpd2guWTtcclxuICAgICAgICAgICAgX2ZpbmFsWCA9IFBhcmVudC5GaW5hbFggKyAoaW50KShQYXJlbnQuRmluYWxDaGlsZHJlblNjYWxlWCAqIFggKyAoUGFyZW50LkZpbmFsVyAtIF9maW5hbFcpICogQWxpZ25tZW50LlgpO1xyXG4gICAgICAgICAgICBfZmluYWxZID0gUGFyZW50LkZpbmFsWSArIChpbnQpKFBhcmVudC5GaW5hbENoaWxkcmVuU2NhbGVZICogWSArIChQYXJlbnQuRmluYWxIIC0gX2ZpbmFsSCkgKiBBbGlnbm1lbnQuWSk7XHJcbiAgICAgICAgICAgIElzTmVlZFJlY2FsYyA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgRHJhdyhTcHJpdGVCYXRjaCBzYiwgZmxvYXQgcGFyZW50QWxwaGEpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoVmlzaWJsZSAmJiAhSXNOZWVkUmVjYWxjKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdGV4dCA9IChnbG9iYWw6OkJyaWRnZS5TY3JpcHQuVG9UZW1wKFwia2V5MVwiLEN1cnJlbnRMb2NhbGl6YXRpb24pIT1udWxsP2dsb2JhbDo6QnJpZGdlLlNjcmlwdC5Gcm9tVGVtcDxMb2NhbGl6YXRpb24+KFwia2V5MVwiKS5HZXRTdHJpbmcoVGV4dCk6KHN0cmluZyludWxsKSA/PyBUZXh0O1xyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAoY2hhciBjIGluIHRleHQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFGaW5hbEZvbnQuQ2hhcmFjdGVycy5Db250YWlucyhjKSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFN5c3RlbS5Db25zb2xlLldyaXRlTGluZSh0ZXh0KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBzYi5EcmF3U3RyaW5nKEZpbmFsRm9udCwgdGV4dCwgbmV3IFZlY3RvcjIoRmluYWxYLCBGaW5hbFkpLCBuZXcgQ29sb3IoVGV4dENvbG9yID8/IEN1cnJlbnRUaGVtZS5Gb250Q29sb3IsIHBhcmVudEFscGhhICogQWxwaGEpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIExhYmVsKHN0cmluZyB0ZXh0LCBpbnQgc2l6ZSwgQ29sb3I/IGNsciA9IG51bGwsIGludCB4ID0gMCwgaW50IHkgPSAwLCBmbG9hdCBob3JBbGlnbiA9IDAuNUYsIGZsb2F0IHZlckFsaWduID0gMC41RiwgYm9vbCB2aXNpYmxlID0gdHJ1ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFggPSB4O1xyXG4gICAgICAgICAgICBZID0geTtcclxuICAgICAgICAgICAgVyA9IDA7XHJcbiAgICAgICAgICAgIEggPSAwO1xyXG4gICAgICAgICAgICBBbHBoYSA9IDEuMGY7XHJcbiAgICAgICAgICAgIEFsaWdubWVudCA9IG5ldyBWZWN0b3IyKGhvckFsaWduLCB2ZXJBbGlnbik7XHJcbiAgICAgICAgICAgIFNpemUgPSBzaXplO1xyXG4gICAgICAgICAgICBUZXh0ID0gdGV4dDtcclxuICAgICAgICAgICAgVGV4dENvbG9yID0gY2xyO1xyXG4gICAgICAgICAgICBWaXNpYmxlID0gdmlzaWJsZTtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIE1pY3Jvc29mdC5YbmEuRnJhbWV3b3JrO1xyXG51c2luZyBNaWNyb3NvZnQuWG5hLkZyYW1ld29yay5HcmFwaGljcztcclxuXHJcblxyXG5uYW1lc3BhY2UgTW9ub0ludGVyZmFjZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgUGljdHVyZSA6IEJsb2NrXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIEFwcGVhcmFuY2Ugc3ByaXRlUmVmIHsgZ2V0OyBzZXQ7IH1cclxuXHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgRHJhdyhTcHJpdGVCYXRjaCBzYiwgZmxvYXQgcGFyZW50QWxwaGEpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoVmlzaWJsZSlcclxuICAgICAgICAgICAgICAgIHNwcml0ZVJlZi5EcmF3KHNiLCBGaW5hbFgsIEZpbmFsWSwgRmluYWxXLCBGaW5hbEgsIGFscGhhOiBwYXJlbnRBbHBoYSAqIEFscGhhKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBQaWN0dXJlKEFwcGVhcmFuY2Ugc3ByaXRlUmVmLCBpbnQgeCA9IDAsIGludCB5ID0gMCwgaW50IHcgPSAwLCBpbnQgaCA9IDAsIGZsb2F0IGhvckFsaWduID0gMC41ZiwgZmxvYXQgdmVyQWxpZ24gPSAwLjVmLCBib29sIHZpc2libGUgPSB0cnVlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5zcHJpdGVSZWYgPSBzcHJpdGVSZWY7XHJcbiAgICAgICAgICAgIFggPSB4O1xyXG4gICAgICAgICAgICBZID0geTtcclxuICAgICAgICAgICAgQWxwaGEgPSAxLjBmO1xyXG4gICAgICAgICAgICBpZiAodyA9PSAwKVxyXG4gICAgICAgICAgICAgICAgVyA9IHNwcml0ZVJlZi5zcHJpdGUuVztcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgVyA9IHc7XHJcbiAgICAgICAgICAgIGlmIChoID09IDApIFxyXG4gICAgICAgICAgICAgICAgSCA9IHNwcml0ZVJlZi5zcHJpdGUuSDsgXHJcbiAgICAgICAgICAgIGVsc2UgXHJcbiAgICAgICAgICAgICAgICBIID0gaDtcclxuICAgICAgICAgICAgQWxpZ25tZW50ID0gbmV3IFZlY3RvcjIoaG9yQWxpZ24sIHZlckFsaWduKTtcclxuICAgICAgICAgICBcclxuICAgICAgICAgICAgVmlzaWJsZSA9IHZpc2libGU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBBcHBseVRoZW1lKFRoZW1lIGN1cnJlbnRUaGVtZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEN1cnJlbnRUaGVtZSA9IGN1cnJlbnRUaGVtZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgTWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuR3JhcGhpY3M7XHJcblxyXG5uYW1lc3BhY2UgTW9ub0ludGVyZmFjZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgUHJvZ3Jlc3MgOiBCbG9ja1xyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBkb3VibGUgQ3VycmVudFZhbHVlIHsgZ2V0OyBzZXQ7IH1cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBkb3VibGUgTWF4VmFsdWUgeyBnZXQ7IHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBkb3VibGUgU3RlcCB7IGdldDsgc2V0OyB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIERyYXcoU3ByaXRlQmF0Y2ggc2IsIGZsb2F0IHBhcmVudEFscGhhKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKFZpc2libGUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEN1cnJlbnRUaGVtZS5Qcm9ncmVzc0JhY2tUZXh0dXJlLkRyYXcoc2IsIEZpbmFsWCwgRmluYWxZLCBGaW5hbFcsIEZpbmFsSCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoTWF4VmFsdWUgPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgIEN1cnJlbnRUaGVtZS5Qcm9ncmVzc0Zyb250VGV4dHVyZS5EcmF3KHNiLCBGaW5hbFgsIEZpbmFsWSwgKGludCkoRmluYWxXICogKEN1cnJlbnRWYWx1ZSAvIE1heFZhbHVlKSksIEZpbmFsSCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBQcm9ncmVzcyhkb3VibGUgY3VyVmFsdWUsIGRvdWJsZSBtYXhWYWx1ZSwgaW50IHgsIGludCB5LCBpbnQgdywgaW50IGgsIGRvdWJsZSBzdGVwLCBib29sIHZpc2libGUgPSB0cnVlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgWCA9IHg7XHJcbiAgICAgICAgICAgIFkgPSB5O1xyXG4gICAgICAgICAgICBXID0gdztcclxuICAgICAgICAgICAgSCA9IGg7XHJcbiAgICAgICAgICAgIE1heFZhbHVlID0gbWF4VmFsdWU7XHJcbiAgICAgICAgICAgIEN1cnJlbnRWYWx1ZSA9IGN1clZhbHVlO1xyXG4gICAgICAgICAgICBTdGVwID0gc3RlcDtcclxuICAgICAgICAgICAgVmlzaWJsZSA9IHZpc2libGU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBBcHBseVRoZW1lKFRoZW1lIGN1cnJlbnRUaGVtZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEN1cnJlbnRUaGVtZSA9IGN1cnJlbnRUaGVtZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxufVxyXG4iLCJ1c2luZyBNaWNyb3NvZnQuWG5hLkZyYW1ld29yay5HcmFwaGljcztcclxudXNpbmcgTWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuSW5wdXQ7XHJcbnVzaW5nIFN5c3RlbTtcclxuXHJcbm5hbWVzcGFjZSBNb25vSW50ZXJmYWNlXHJcbntcclxuXHJcbiAgICBwdWJsaWMgY2xhc3MgQnV0dG9uIDogQ29udGFpbmVyXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIGJvb2wgSXNIaWdobGlnaHRlZCB7IGdldDsgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIGJvb2wgSXNQcmVzc2VkIHsgZ2V0OyBzZXQ7IH1cclxuICAgICAgICBwdWJsaWMgYm9vbCBJc0Rpc2FibGVkIHsgZ2V0OyBzZXQ7IH1cclxuICAgICAgICBwdWJsaWMgYm9vbCBJc1NlbGVjdGVkIHsgZ2V0OyBzZXQ7IH1cclxuXHJcbiAgICAgICAgcHVibGljIGV2ZW50IEFjdGlvbjxCdXR0b24sIGJvb2w+IE9uQ2xpY2s7XHJcbiAgICAgICAgcHVibGljIGV2ZW50IEFjdGlvbjxCdXR0b24sIGJvb2w+IE9uRm9jdXM7XHJcblxyXG4gICAgICAgIHB1YmxpYyBLZXlzIEhvdEtleSB7IGdldDsgc2V0OyB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIERyYXcoU3ByaXRlQmF0Y2ggc2IsIGZsb2F0IHBhcmVudEFscGhhKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKFZpc2libGUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIChCYWNrVGV4dHVyZSA/PyBDdXJyZW50VGhlbWUuQnV0dG9uQmFja1RleHR1cmUpLkRyYXcoc2IsIEZpbmFsWCwgRmluYWxZLCBGaW5hbFcsIEZpbmFsSCwgYWxwaGE6IHBhcmVudEFscGhhICogQWxwaGEpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChJc1NlbGVjdGVkKVxyXG4gICAgICAgICAgICAgICAgICAgIChTZWxlY3RlZFRleHR1cmUgPz8gQ3VycmVudFRoZW1lLkJ1dHRvblNlbGVjdGVkVGV4dHVyZSkuRHJhdyhzYiwgRmluYWxYLCBGaW5hbFksIEZpbmFsVywgRmluYWxILCBhbHBoYTogcGFyZW50QWxwaGEgKiBBbHBoYSk7XHJcblxyXG4gICAgICAgICAgICAgICAgYmFzZS5EcmF3KHNiLCBwYXJlbnRBbHBoYSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoSXNEaXNhYmxlZClcclxuICAgICAgICAgICAgICAgICAgICAoRGlzYWJsZWRUZXh0dXJlID8/IEN1cnJlbnRUaGVtZS5CdXR0b25EaXNhYmxlZFRleHR1cmUpLkRyYXcoc2IsIEZpbmFsWCwgRmluYWxZLCBGaW5hbFcsIEZpbmFsSCwgYWxwaGE6IHBhcmVudEFscGhhICogQWxwaGEpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChJc0hpZ2hsaWdodGVkKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIChGcm9udFRleHR1cmUgPz8gQ3VycmVudFRoZW1lLkJ1dHRvbkZyb250VGV4dHVyZSkuRHJhdyhzYiwgRmluYWxYLCBGaW5hbFksIEZpbmFsVywgRmluYWxILCBhbHBoYTogcGFyZW50QWxwaGEgKiBBbHBoYSk7XHJcbiAgICAgICAgICAgICAgICAgICAgSXNIaWdobGlnaHRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKElzUHJlc3NlZClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAoRnJvbnRUZXh0dXJlID8/IEN1cnJlbnRUaGVtZS5CdXR0b25Gcm9udFRleHR1cmUpLkRyYXcoc2IsIEZpbmFsWCwgRmluYWxZLCBGaW5hbFcsIEZpbmFsSCwgYWxwaGE6IHBhcmVudEFscGhhICogQWxwaGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIElzUHJlc3NlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIEJ1dHRvbihBY3Rpb248QnV0dG9uLCBib29sPiBvbkNsaWNrLCBpbnQgeCwgaW50IHksIGludCB3LCBpbnQgaCwgZmxvYXQgaG9yQWxpZ24gPSAwLjVmLCBmbG9hdCB2ZXJBbGlnbiA9IDAuNWYsIGJvb2wgdmlzaWJsZSA9IHRydWUpXHJcbiAgICAgICAgICAgIDogYmFzZSh4LCB5LCB3LCBoLCBob3JBbGlnbiwgdmVyQWxpZ24sIHZpc2libGUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBPbkNsaWNrID0gb25DbGljaztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBCdXR0b24oQWN0aW9uPEJ1dHRvbiwgYm9vbD4gb25DbGljaywgS2V5cyBob3RrZXksIGludCB4LCBpbnQgeSwgaW50IHcsIGludCBoLCBmbG9hdCBob3JBbGlnbiA9IDAuNWYsIGZsb2F0IHZlckFsaWduID0gMC41ZiwgYm9vbCB2aXNpYmxlID0gdHJ1ZSlcclxuICAgICAgICAgICAgOiBiYXNlKHgsIHksIHcsIGgsIGhvckFsaWduLCB2ZXJBbGlnbiwgdmlzaWJsZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIE9uQ2xpY2sgPSBvbkNsaWNrO1xyXG4gICAgICAgICAgICBIb3RLZXkgPSBob3RrZXk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgQnV0dG9uKEFjdGlvbjxCdXR0b24sIGJvb2w+IG9uQ2xpY2ssIEFjdGlvbjxCdXR0b24sIGJvb2w+IG9uRm9jdXMsIGludCB4LCBpbnQgeSwgaW50IHcsIGludCBoLCBmbG9hdCBob3JBbGlnbiA9IDAuNWYsIGZsb2F0IHZlckFsaWduID0gMC41ZiwgYm9vbCB2aXNpYmxlID0gdHJ1ZSlcclxuICAgICAgICAgICAgOiBiYXNlKHgsIHksIHcsIGgsIGhvckFsaWduLCB2ZXJBbGlnbiwgdmlzaWJsZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIE9uQ2xpY2sgPSBvbkNsaWNrO1xyXG4gICAgICAgICAgICBPbkZvY3VzID0gb25Gb2N1cztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBCdXR0b24oQWN0aW9uPEJ1dHRvbiwgYm9vbD4gb25DbGljaywgQWN0aW9uPEJ1dHRvbiwgYm9vbD4gb25Gb2N1cywgS2V5cyBob3RrZXksIGludCB4LCBpbnQgeSwgaW50IHcsIGludCBoLCBmbG9hdCBob3JBbGlnbiA9IDAuNWYsIGZsb2F0IHZlckFsaWduID0gMC41ZiwgYm9vbCB2aXNpYmxlID0gdHJ1ZSlcclxuICAgICAgICAgICAgOiBiYXNlKHgsIHksIHcsIGgsIGhvckFsaWduLCB2ZXJBbGlnbiwgdmlzaWJsZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIE9uQ2xpY2sgPSBvbkNsaWNrO1xyXG4gICAgICAgICAgICBPbkZvY3VzID0gb25Gb2N1cztcclxuICAgICAgICAgICAgSG90S2V5ID0gaG90a2V5O1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIENsaWNrKGludCB4LCBpbnQgeSwgYm9vbCBpc1RvdWNoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKCFJc0Rpc2FibGVkKVxyXG4gICAgICAgICAgICAgICAgT25DbGljayE9bnVsbD9nbG9iYWw6OkJyaWRnZS5TY3JpcHQuRnJvbUxhbWJkYSgoKT0+T25DbGljay5JbnZva2UodGhpcywgaXNUb3VjaCkpOm51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBGb2N1cygpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBPbkZvY3VzIT1udWxsP2dsb2JhbDo6QnJpZGdlLlNjcmlwdC5Gcm9tTGFtYmRhKCgpPT5PbkZvY3VzLkludm9rZSh0aGlzLCBmYWxzZSkpOm51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBUYXBBbmRIb2xkKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIE9uRm9jdXMhPW51bGw/Z2xvYmFsOjpCcmlkZ2UuU2NyaXB0LkZyb21MYW1iZGEoKCk9Pk9uRm9jdXMuSW52b2tlKHRoaXMsIHRydWUpKTpudWxsO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBBcHBlYXJhbmNlPyBCYWNrVGV4dHVyZSB7IGdldDsgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIEFwcGVhcmFuY2U/IEZyb250VGV4dHVyZSB7IGdldDsgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIEFwcGVhcmFuY2U/IFByZXNzZWRUZXh0dXJlIHsgZ2V0OyBzZXQ7IH1cclxuICAgICAgICBwdWJsaWMgQXBwZWFyYW5jZT8gRGlzYWJsZWRUZXh0dXJlIHsgZ2V0OyBzZXQ7IH1cclxuICAgICAgICBwdWJsaWMgQXBwZWFyYW5jZT8gU2VsZWN0ZWRUZXh0dXJlIHsgZ2V0OyBzZXQ7IH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBNaWNyb3NvZnQuWG5hLkZyYW1ld29yay5HcmFwaGljcztcclxuXHJcbm5hbWVzcGFjZSBNb25vSW50ZXJmYWNlXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBGcmFtZSA6IENvbnRhaW5lclxyXG4gICAge1xyXG5cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBEcmF3KFNwcml0ZUJhdGNoIHNiLCBmbG9hdCBwYXJlbnRBbHBoYSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChWaXNpYmxlKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoQ3VycmVudFRoZW1lLk5pbmVGcmFtZUJvZGVyVGV4dHVyZSAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGludCB0b3BzaGlmdCA9IDEyLCBib3R0b21zaGlmdCA9IDEyLCBsZWZ0c2hpZnQgPSAxMiwgcmlnaHRzaGlmdCA9IDEyO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghVG9wQm9yZGVyKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3BzaGlmdCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFCb3R0b21Cb3JkZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJvdHRvbXNoaWZ0ID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIUxlZnRCb3JkZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnRzaGlmdCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFSaWdodEJvcmRlcilcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmlnaHRzaGlmdCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKFRvcEJvcmRlciAmJiBMZWZ0Qm9yZGVyKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBDdXJyZW50VGhlbWUuTmluZUZyYW1lQm9kZXJUZXh0dXJlWzBdLkRyYXcoc2IsIEZpbmFsWCAtIDEyLCBGaW5hbFkgLSAxMiwgMjQsIDI0LCBhbHBoYTogcGFyZW50QWxwaGEgKiBBbHBoYSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKFRvcEJvcmRlcilcclxuICAgICAgICAgICAgICAgICAgICAgICAgQ3VycmVudFRoZW1lLk5pbmVGcmFtZUJvZGVyVGV4dHVyZVsxXS5EcmF3KHNiLCBGaW5hbFggKyBsZWZ0c2hpZnQsIEZpbmFsWSAtIDEyLCBGaW5hbFcgLSBsZWZ0c2hpZnQgLSByaWdodHNoaWZ0LCAyNCwgYWxwaGE6IHBhcmVudEFscGhhICogQWxwaGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChUb3BCb3JkZXIgJiYgUmlnaHRCb3JkZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEN1cnJlbnRUaGVtZS5OaW5lRnJhbWVCb2RlclRleHR1cmVbMl0uRHJhdyhzYiwgRmluYWxYICsgRmluYWxXIC0gMTIsIEZpbmFsWSAtIDEyLCAyNCwgMjQsIGFscGhhOiBwYXJlbnRBbHBoYSAqIEFscGhhKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoTGVmdEJvcmRlcilcclxuICAgICAgICAgICAgICAgICAgICAgICAgQ3VycmVudFRoZW1lLk5pbmVGcmFtZUJvZGVyVGV4dHVyZVszXS5EcmF3KHNiLCBGaW5hbFggLSAxMiwgRmluYWxZICsgdG9wc2hpZnQsIDI0LCBGaW5hbEggLSBib3R0b21zaGlmdCAtIHRvcHNoaWZ0LCBhbHBoYTogcGFyZW50QWxwaGEgKiBBbHBoYSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIEN1cnJlbnRUaGVtZS5OaW5lRnJhbWVCb2RlclRleHR1cmVbNF0uRHJhdyhzYiwgRmluYWxYICsgbGVmdHNoaWZ0LCBGaW5hbFkgKyB0b3BzaGlmdCwgRmluYWxXIC0gbGVmdHNoaWZ0IC0gcmlnaHRzaGlmdCwgRmluYWxIIC0gYm90dG9tc2hpZnQgLSB0b3BzaGlmdCwgYWxwaGE6IHBhcmVudEFscGhhICogQWxwaGEpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoUmlnaHRCb3JkZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEN1cnJlbnRUaGVtZS5OaW5lRnJhbWVCb2RlclRleHR1cmVbNV0uRHJhdyhzYiwgRmluYWxYICsgRmluYWxXIC0gMTIsIEZpbmFsWSArIHRvcHNoaWZ0LCAyNCwgRmluYWxIIC0gYm90dG9tc2hpZnQgLSB0b3BzaGlmdCwgYWxwaGE6IHBhcmVudEFscGhhICogQWxwaGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChCb3R0b21Cb3JkZXIgJiYgTGVmdEJvcmRlcilcclxuICAgICAgICAgICAgICAgICAgICAgICAgQ3VycmVudFRoZW1lLk5pbmVGcmFtZUJvZGVyVGV4dHVyZVs2XS5EcmF3KHNiLCBGaW5hbFggLSAxMiwgRmluYWxZICsgRmluYWxIIC0gMTIsIDI0LCAyNCwgYWxwaGE6IHBhcmVudEFscGhhICogQWxwaGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChCb3R0b21Cb3JkZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEN1cnJlbnRUaGVtZS5OaW5lRnJhbWVCb2RlclRleHR1cmVbN10uRHJhdyhzYiwgRmluYWxYICsgbGVmdHNoaWZ0LCBGaW5hbFkgKyBGaW5hbEggLSAxMiwgRmluYWxXIC0gbGVmdHNoaWZ0IC0gcmlnaHRzaGlmdCwgMjQsIGFscGhhOiBwYXJlbnRBbHBoYSAqIEFscGhhKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoQm90dG9tQm9yZGVyICYmIFJpZ2h0Qm9yZGVyKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBDdXJyZW50VGhlbWUuTmluZUZyYW1lQm9kZXJUZXh0dXJlWzhdLkRyYXcoc2IsIEZpbmFsWCArIEZpbmFsVyAtIDEyLCBGaW5hbFkgKyBGaW5hbEggLSAxMiwgMjQsIDI0LCBhbHBoYTogcGFyZW50QWxwaGEgKiBBbHBoYSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgKEJhY2tUZXh0dXJlID8/IEN1cnJlbnRUaGVtZS5GcmFtZUJhY2tUZXh0dXJlKS5EcmF3KHNiLCBGaW5hbFgsIEZpbmFsWSwgRmluYWxXLCBGaW5hbEgsIGFscGhhOiBwYXJlbnRBbHBoYSAqIEFscGhhKTsgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgYmFzZS5EcmF3KHNiLCBwYXJlbnRBbHBoYSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBib29sIFRvcEJvcmRlciB7IGdldDsgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIGJvb2wgTGVmdEJvcmRlciB7IGdldDsgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIGJvb2wgUmlnaHRCb3JkZXIgeyBnZXQ7IHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBib29sIEJvdHRvbUJvcmRlciB7IGdldDsgc2V0OyB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBGcmFtZShpbnQgeCwgaW50IHksIGludCB3LCBpbnQgaCwgZmxvYXQgaG9yQWxpZ24gPSAwLjVmLCBmbG9hdCB2ZXJBbGlnbiA9IDAuNWYsIGJvb2wgdmlzaWJsZSA9IHRydWUpXHJcbiAgICAgICAgICAgIDogYmFzZSh4LCB5LCB3LCBoLCBob3JBbGlnbiwgdmVyQWxpZ24sIHZpc2libGUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBUb3BCb3JkZXIgPSB0cnVlO1xyXG4gICAgICAgICAgICBMZWZ0Qm9yZGVyID0gdHJ1ZTtcclxuICAgICAgICAgICAgUmlnaHRCb3JkZXIgPSB0cnVlO1xyXG4gICAgICAgICAgICBCb3R0b21Cb3JkZXIgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIEFwcGVhcmFuY2U/IEJhY2tUZXh0dXJlIHsgZ2V0OyBzZXQ7IH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW0uTGlucTtcclxuXHJcbm5hbWVzcGFjZSBNb25vSW50ZXJmYWNlXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBHcmlkIDogQ29udGFpbmVyXHJcbiAgICB7XHJcblxyXG4gICAgICAgIHB1YmxpYyBlbnVtIE9yaWVudGF0aW9uc1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgTGVmdFRvUmlnaHQsXHJcbiAgICAgICAgICAgIFRvcFRvQm90dG9tXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgT3JpZW50YXRpb25zIE9yaWVudGF0aW9uIHsgZ2V0OyBzZXQ7IH1cclxuXHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIFQgQWRkQ2hpbGQ8VD4oVCBjaGlsZClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChDaGlsZHJlbi5Db3VudCA+IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGludCBjWCA9IGNoaWxkLlg7XHJcbiAgICAgICAgICAgICAgICBpbnQgY1kgPSBjaGlsZC5ZO1xyXG4gICAgICAgICAgICAgICAgaWYgKE9yaWVudGF0aW9uID09IE9yaWVudGF0aW9ucy5MZWZ0VG9SaWdodClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBjWCA9IFN5c3RlbS5MaW5xLkVudW1lcmFibGUuTGFzdDxCbG9jaz4oQ2hpbGRyZW4pLlJpZ2h0ICsgY2hpbGQuWDtcclxuICAgICAgICAgICAgICAgICAgICBjWSA9IFN5c3RlbS5MaW5xLkVudW1lcmFibGUuTGFzdDxCbG9jaz4oQ2hpbGRyZW4pLlk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNYICsgY2hpbGQuVyA+IFcpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjWCA9IGNoaWxkLlg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNZID0gU3lzdGVtLkxpbnEuRW51bWVyYWJsZS5MYXN0PEJsb2NrPihDaGlsZHJlbikuQm90dG9tICsgY2hpbGQuWTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChPcmllbnRhdGlvbiA9PSBPcmllbnRhdGlvbnMuVG9wVG9Cb3R0b20pXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgY1ggPSBjaGlsZC5YO1xyXG4gICAgICAgICAgICAgICAgICAgIGNZID0gU3lzdGVtLkxpbnEuRW51bWVyYWJsZS5MYXN0PEJsb2NrPihDaGlsZHJlbikuQm90dG9tICsgY2hpbGQuWTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY1kgKyBjaGlsZC5IID4gSClcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNYID0gU3lzdGVtLkxpbnEuRW51bWVyYWJsZS5MYXN0PEJsb2NrPihDaGlsZHJlbikuUmlnaHQgKyBjaGlsZC5YO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjWSA9IFN5c3RlbS5MaW5xLkVudW1lcmFibGUuTGFzdDxCbG9jaz4oQ2hpbGRyZW4pLlk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY2hpbGQuWCA9IGNYO1xyXG4gICAgICAgICAgICAgICAgY2hpbGQuWSA9IGNZO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBiYXNlLkFkZENoaWxkPFQ+KGNoaWxkKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgXHJcbiAgICAgICAgcHVibGljIEdyaWQoT3JpZW50YXRpb25zIG9yaWVudGF0aW9uLCBpbnQgeCwgaW50IHksIGludCB3LCBpbnQgaCwgZmxvYXQgaG9yQWxpZ24gPSAwLjVmLCBmbG9hdCB2ZXJBbGlnbiA9IDAuNWYsIGJvb2wgdmlzaWJsZSA9IHRydWUpXHJcbiAgICAgICAgICAgIDogYmFzZSh4LCB5LCB3LCBoLCBob3JBbGlnbiwgdmVyQWxpZ24sIHZpc2libGUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBPcmllbnRhdGlvbiA9IG9yaWVudGF0aW9uO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBNaWNyb3NvZnQuWG5hLkZyYW1ld29yaztcclxudXNpbmcgTWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuR3JhcGhpY3M7XHJcblxyXG5uYW1lc3BhY2UgTW9ub0ludGVyZmFjZVxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgTG9uZ0xhYmVsIDogQ29udGFpbmVyXHJcbiAgICB7XHJcbiAgICAgICAgcHJpdmF0ZSBzdHJpbmcgX3RleHQ7XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgVGV4dFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIF90ZXh0OyB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBfdGV4dCA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgSXNOZWVkUmVjYWxjID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgUmVjYWxjKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEZpbmFsRm9udCA9IEN1cnJlbnRUaGVtZS5HZXRGb250KF9zaXplKTtcclxuICAgICAgICAgICAgQ2hpbGRyZW4uQ2xlYXIoKTtcclxuICAgICAgICAgICAgc3RyaW5nIGxvY2FsaXplZFRleHQgPSBDdXJyZW50TG9jYWxpemF0aW9uICE9IG51bGwgPyBDdXJyZW50TG9jYWxpemF0aW9uLkdldFN0cmluZyhfdGV4dCkgOiBfdGV4dDtcclxuICAgICAgICAgICAgc3RyaW5nW10gdGV4dHMgPSBsb2NhbGl6ZWRUZXh0LlNwbGl0KCcgJyk7XHJcbiAgICAgICAgICAgIHN0cmluZyBjdXJ0ZXh0ID0gXCJcIjtcclxuICAgICAgICAgICAgaW50IGxpbmVIID0gKGludClGaW5hbEZvbnQuTWVhc3VyZVN0cmluZyhsb2NhbGl6ZWRUZXh0KS5ZO1xyXG4gICAgICAgICAgICBpbnQgdG90YWxMaW5lcyA9IDA7XHJcbiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdGV4dHMuTGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChGaW5hbEZvbnQuTWVhc3VyZVN0cmluZyhjdXJ0ZXh0ICsgJyAnICsgdGV4dHNbaV0pLlggPiBXICYmIGkgPiAwKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuQWRkQ2hpbGQ8TGFiZWw+KG5ldyBMYWJlbChjdXJ0ZXh0LCBTaXplLCBUZXh0Q29sb3IsIHk6IHRvdGFsTGluZXMgKiBsaW5lSCwgaG9yQWxpZ246IEFsaWdubWVudC5YLCB2ZXJBbGlnbjogMC4wZikpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsTGluZXMgKz0gMTtcclxuICAgICAgICAgICAgICAgICAgICBjdXJ0ZXh0ID0gdGV4dHNbaV0gKyAnICc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgY3VydGV4dCArPSB0ZXh0c1tpXSArICcgJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLkFkZENoaWxkPExhYmVsPihuZXcgTGFiZWwoY3VydGV4dC5UcmltKCksIFNpemUsIFRleHRDb2xvciwgeTogdG90YWxMaW5lcyAqIGxpbmVILCBob3JBbGlnbjogQWxpZ25tZW50LlgsIHZlckFsaWduOiAwLjBmKSk7XHJcbiAgICAgICAgICAgIHRvdGFsTGluZXMgKz0gMTtcclxuICAgICAgICAgICAgSCA9ICh0b3RhbExpbmVzICogbGluZUgpO1xyXG4gICAgICAgICAgICBiYXNlLkFwcGx5VGhlbWUoQ3VycmVudFRoZW1lKTtcclxuICAgICAgICAgICAgYmFzZS5SZWNhbGMoKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgQ29sb3I/IFRleHRDb2xvciB7IGdldDsgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIFNwcml0ZUZvbnQgRmluYWxGb250IHsgZ2V0OyBwcml2YXRlIHNldDsgfVxyXG4gICAgICAgIHByaXZhdGUgaW50IF9zaXplO1xyXG5cclxuICAgICAgICBwdWJsaWMgaW50IFNpemVcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7IHJldHVybiBfc2l6ZTsgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgX3NpemUgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgIElzTmVlZFJlY2FsYyA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBMb25nTGFiZWwoc3RyaW5nIHRleHQsIGludCBzaXplLCBDb2xvcj8gY2xyID0gbnVsbCwgaW50IHggPSAwLCBpbnQgeSA9IDAsIGludCB3ID0gMCwgZmxvYXQgaG9yQWxpZ24gPSAwLjVGLCBmbG9hdCB2ZXJBbGlnbiA9IDAuNUYsIGJvb2wgdmlzaWJsZSA9IHRydWUpXHJcbiAgICAgICAgICAgIDogYmFzZSh4LCB5LCB3LCAwLCBob3JBbGlnbiwgdmVyQWxpZ24sIHZpc2libGUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBfc2l6ZSA9IHNpemU7XHJcbiAgICAgICAgICAgIF90ZXh0ID0gdGV4dDtcclxuICAgICAgICAgICAgVGV4dENvbG9yID0gY2xyO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIEFwcGx5VGhlbWUoVGhlbWUgY3VycmVudFRoZW1lKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgQ3VycmVudFRoZW1lID0gY3VycmVudFRoZW1lO1xyXG4gICAgICAgICAgICBTaXplID0gX3NpemU7XHJcbiAgICAgICAgICAgIFRleHQgPSBfdGV4dDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwibmFtZXNwYWNlIE1vbm9JbnRlcmZhY2Vcclxue1xyXG4gICAgcHVibGljIGNsYXNzIFN3aXRjaGVyIDogQ29udGFpbmVyIHtcclxuXHJcblxyXG4gICAgICAgIHByaXZhdGUgaW50IF9jdXJyZW50O1xyXG4gICAgICAgIHB1YmxpYyBpbnQgQ3VycmVudCB7XHJcbiAgICAgICAgICAgIGdldCB7IHJldHVybiBfY3VycmVudDsgfVxyXG4gICAgICAgICAgICBzZXQge1xyXG4gICAgICAgICAgICAgICAgaWYgKHBjdE1haW5PbGQgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICBwY3RNYWluT2xkLnNwcml0ZVJlZiA9IFBpY3R1cmVzW19jdXJyZW50XTtcclxuICAgICAgICAgICAgICAgIGlmIChsYmxNYWluT2xkICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgbGJsTWFpbk9sZC5UZXh0ID0gVGl0bGVzW19jdXJyZW50XTtcclxuICAgICAgICAgICAgICAgIF9jdXJyZW50ID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICBpZiAoX2N1cnJlbnQgPj0gSXRlbXNDb3VudClcclxuICAgICAgICAgICAgICAgICAgICBfY3VycmVudCA9IDA7XHJcbiAgICAgICAgICAgICAgICBpZiAoX2N1cnJlbnQgPCAwKVxyXG4gICAgICAgICAgICAgICAgICAgIF9jdXJyZW50ID0gSXRlbXNDb3VudCAtIDE7XHJcbiAgICAgICAgICAgICAgICBpZiAocGN0TWFpbiAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIHBjdE1haW4uc3ByaXRlUmVmID0gUGljdHVyZXNbX2N1cnJlbnRdO1xyXG4gICAgICAgICAgICAgICAgaWYgKGxibE1haW4gIT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICBsYmxNYWluLlRleHQgPSBUaXRsZXNbX2N1cnJlbnRdO1xyXG4gICAgICAgICAgICAgICAgaWYgKGxibERlc2MgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICBsYmxEZXNjLlRleHQgPSBEZXNjcmlwdGlvbnNbX2N1cnJlbnRdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgaW50IEl0ZW1zQ291bnQgeyBnZXQ7IHNldDsgfVxyXG5cclxuICAgICAgICBwdWJsaWMgQXBwZWFyYW5jZVtdIFBpY3R1cmVzIHsgZ2V0OyBzZXQ7IH1cclxuICAgICAgICBwdWJsaWMgc3RyaW5nW10gVGl0bGVzIHsgZ2V0OyBzZXQ7IH1cclxuICAgICAgICBwdWJsaWMgc3RyaW5nW10gRGVzY3JpcHRpb25zIHsgZ2V0OyBzZXQ7IH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBQaWN0dXJlIHBjdE1haW47XHJcbiAgICAgICAgcHJpdmF0ZSBMYWJlbCBsYmxNYWluO1xyXG4gICAgICAgIHByaXZhdGUgTG9uZ0xhYmVsIGxibERlc2M7XHJcblxyXG4gICAgICAgIHByaXZhdGUgUGljdHVyZSBwY3RNYWluT2xkO1xyXG4gICAgICAgIHByaXZhdGUgTGFiZWwgbGJsTWFpbk9sZDtcclxuXHJcbiAgICAgICAgcHVibGljIEFuaW1hdG9yIEFuaW1hdG9yIHsgZ2V0OyBzZXQ7IH1cclxuXHJcbiAgICAgICAgcHVibGljIFN3aXRjaGVyKEFwcGVhcmFuY2VbXSBwaWN0dXJlcywgc3RyaW5nW10gdGl0bGVzLCBzdHJpbmdbXSBkZXNjcmlwdGlvbnMsIGludCBjdXJyZW50LCBBbmltYXRvciBhbmltYXRvciwgaW50IHgsIGludCB5LCBpbnQgdywgaW50IGgsIGZsb2F0IGhvckFsaWduID0gMC41ZiwgZmxvYXQgdmVyQWxpZ24gPSAwLjVmLCBib29sIHZpc2libGUgPSB0cnVlKVxyXG4gICAgICAgICAgICA6IGJhc2UoeCwgeSwgdywgaCwgaG9yQWxpZ24sIHZlckFsaWduLCB2aXNpYmxlKSB7XHJcbiAgICAgICAgICAgIFBpY3R1cmVzID0gcGljdHVyZXM7XHJcbiAgICAgICAgICAgIFRpdGxlcyA9IHRpdGxlcztcclxuICAgICAgICAgICAgRGVzY3JpcHRpb25zID0gZGVzY3JpcHRpb25zO1xyXG4gICAgICAgICAgICBBbmltYXRvciA9IGFuaW1hdG9yO1xyXG5cclxuICAgICAgICAgICAgaW50IHBDbnQgPSAocGljdHVyZXMhPW51bGw/cGljdHVyZXMuTGVuZ3RoOihpbnQ/KW51bGwpID8/IDA7XHJcbiAgICAgICAgICAgIGludCB0Q250ID0gKHRpdGxlcyE9bnVsbD90aXRsZXMuTGVuZ3RoOihpbnQ/KW51bGwpID8/IDA7XHJcblxyXG4gICAgICAgICAgICBpbnQgbWF4Q250ID0gcENudCA+IHRDbnQgPyBwQ250IDogdENudDtcclxuXHJcbiAgICAgICAgICAgIEl0ZW1zQ291bnQgPSBtYXhDbnQ7XHJcbiAgICAgICAgICAgIEN1cnJlbnQgPSBjdXJyZW50O1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgdm9pZCBidG5MZWZ0Q2xpY2tlZChCdXR0b24gYnRuLCBib29sIGlzVG91Y2gpIHtcclxuICAgICAgICAgICAgQ3VycmVudCAtPSAxO1xyXG4gICAgICAgICAgICBpZiAoQW5pbWF0b3IgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHBjdE1haW4gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIEFuaW1hdG9yLkFkZENoaWxkPE11bHRpQW5pbWF0aW9uPihuZXcgTXVsdGlBbmltYXRpb24oKCkgPT4gcGN0TWFpbk9sZC5TaG93KCksICgpID0+IHBjdE1haW5PbGQuSGlkZSgpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgTnVtYmVyQW5pbWF0aW9uKFwiWFwiLCAwLCAtNTAsIC01LCB0YXJnZXQ6IHBjdE1haW5PbGQpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgTnVtYmVyQW5pbWF0aW9uKFwiQWxwaGFcIiwgMS4wZiwgMCwgLTAuMWYsIHRhcmdldDogcGN0TWFpbk9sZCkpKS5CZWdpbigpO1xyXG4gICAgICAgICAgICAgICAgICAgIEFuaW1hdG9yLkFkZENoaWxkPE11bHRpQW5pbWF0aW9uPihuZXcgTXVsdGlBbmltYXRpb24oXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBOdW1iZXJBbmltYXRpb24oXCJYXCIsIDUwLCAwLCAtNSwgdGFyZ2V0OiBwY3RNYWluKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE51bWJlckFuaW1hdGlvbihcIkFscGhhXCIsIDAsIDEuMGYsIDAuMWYsIHRhcmdldDogcGN0TWFpbikpKS5CZWdpbigpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChsYmxNYWluICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBBbmltYXRvci5BZGRDaGlsZDxNdWx0aUFuaW1hdGlvbj4obmV3IE11bHRpQW5pbWF0aW9uKCgpID0+IGxibE1haW5PbGQuU2hvdygpLCAoKSA9PiBsYmxNYWluT2xkLkhpZGUoKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE51bWJlckFuaW1hdGlvbihcIlhcIiwgMCwgLTUwLCAtNSwgdGFyZ2V0OiBsYmxNYWluT2xkKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE51bWJlckFuaW1hdGlvbihcIkFscGhhXCIsIDEuMGYsIDAsIC0wLjFmLCB0YXJnZXQ6IGxibE1haW5PbGQpKSkuQmVnaW4oKTtcclxuICAgICAgICAgICAgICAgICAgICBBbmltYXRvci5BZGRDaGlsZDxNdWx0aUFuaW1hdGlvbj4obmV3IE11bHRpQW5pbWF0aW9uKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgTnVtYmVyQW5pbWF0aW9uKFwiWFwiLCA1MCwgMCwgLTUsIHRhcmdldDogbGJsTWFpbiksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBOdW1iZXJBbmltYXRpb24oXCJBbHBoYVwiLCAwLCAxLjBmLCAwLjFmLCB0YXJnZXQ6IGxibE1haW4pKSkuQmVnaW4oKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSB2b2lkIGJ0blJpZ2h0Q2xpY2tlZChCdXR0b24gYnRuLCBib29sIGlzVG91Y2gpIHtcclxuICAgICAgICAgICAgQ3VycmVudCArPSAxO1xyXG4gICAgICAgICAgICBpZiAoQW5pbWF0b3IgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHBjdE1haW4gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIEFuaW1hdG9yLkFkZENoaWxkPE11bHRpQW5pbWF0aW9uPihuZXcgTXVsdGlBbmltYXRpb24oKCkgPT4gcGN0TWFpbk9sZC5TaG93KCksICgpID0+IHBjdE1haW5PbGQuSGlkZSgpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgTnVtYmVyQW5pbWF0aW9uKFwiWFwiLCAwLCA1MCwgNSwgdGFyZ2V0OiBwY3RNYWluT2xkKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE51bWJlckFuaW1hdGlvbihcIkFscGhhXCIsIDEuMGYsIDAsIC0wLjFmLCB0YXJnZXQ6IHBjdE1haW5PbGQpKSkuQmVnaW4oKTtcclxuICAgICAgICAgICAgICAgICAgICBBbmltYXRvci5BZGRDaGlsZDxNdWx0aUFuaW1hdGlvbj4obmV3IE11bHRpQW5pbWF0aW9uKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgTnVtYmVyQW5pbWF0aW9uKFwiWFwiLCAtNTAsIDAsIDUsIHRhcmdldDogcGN0TWFpbiksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBOdW1iZXJBbmltYXRpb24oXCJBbHBoYVwiLCAwLCAxLjBmLCAwLjFmLCB0YXJnZXQ6IHBjdE1haW4pKSkuQmVnaW4oKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobGJsTWFpbiAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgQW5pbWF0b3IuQWRkQ2hpbGQ8TXVsdGlBbmltYXRpb24+KG5ldyBNdWx0aUFuaW1hdGlvbigoKSA9PiBsYmxNYWluT2xkLlNob3coKSwgKCkgPT4gbGJsTWFpbk9sZC5IaWRlKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBOdW1iZXJBbmltYXRpb24oXCJYXCIsIDAsIDUwLCA1LCB0YXJnZXQ6IGxibE1haW5PbGQpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgTnVtYmVyQW5pbWF0aW9uKFwiQWxwaGFcIiwgMS4wZiwgMCwgLTAuMWYsIHRhcmdldDogbGJsTWFpbk9sZCkpKS5CZWdpbigpO1xyXG4gICAgICAgICAgICAgICAgICAgIEFuaW1hdG9yLkFkZENoaWxkPE11bHRpQW5pbWF0aW9uPihuZXcgTXVsdGlBbmltYXRpb24oXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBOdW1iZXJBbmltYXRpb24oXCJYXCIsIC01MCwgMCwgNSwgdGFyZ2V0OiBsYmxNYWluKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE51bWJlckFuaW1hdGlvbihcIkFscGhhXCIsIDAsIDEuMGYsIDAuMWYsIHRhcmdldDogbGJsTWFpbikpKS5CZWdpbigpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBBcHBseVRoZW1lKFRoZW1lIGN1cnJlbnRUaGVtZSkge1xyXG4gICAgICAgICAgICBDdXJyZW50VGhlbWUgPSBjdXJyZW50VGhlbWU7XHJcbiAgICAgICAgICAgIHZhciBidG5MZWZ0ID0gdGhpcy5BZGRDaGlsZDxCdXR0b24+KG5ldyBCdXR0b24oYnRuTGVmdENsaWNrZWQsIE1pY3Jvc29mdC5YbmEuRnJhbWV3b3JrLklucHV0LktleXMuTGVmdCwgMCwgMCwgNDUsIDMwLCBob3JBbGlnbjogMC4wZikpO1xyXG4gICAgICAgICAgICBidG5MZWZ0LkFkZENoaWxkPFBpY3R1cmU+KG5ldyBQaWN0dXJlKEN1cnJlbnRUaGVtZS5Td2l0Y2hlckJ1dHRvbkxlZnRUZXh0dXJlLCB3OiA0NSwgaDogNDUpKTtcclxuICAgICAgICAgICAgYnRuTGVmdC5CYWNrVGV4dHVyZSA9IGN1cnJlbnRUaGVtZS5FbXB0eVRleHR1cmU7XHJcbiAgICAgICAgICAgIHZhciBidG5SaWdodCA9IHRoaXMuQWRkQ2hpbGQ8QnV0dG9uPihuZXcgQnV0dG9uKGJ0blJpZ2h0Q2xpY2tlZCwgTWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuSW5wdXQuS2V5cy5SaWdodCwgMCwgMCwgNDUsIDMwLCBob3JBbGlnbjogMS4wZikpO1xyXG4gICAgICAgICAgICBidG5SaWdodC5BZGRDaGlsZDxQaWN0dXJlPihuZXcgUGljdHVyZShDdXJyZW50VGhlbWUuU3dpdGNoZXJCdXR0b25SaWdodFRleHR1cmUsIHc6IDQ1LCBoOiA0NSkpO1xyXG4gICAgICAgICAgICBidG5SaWdodC5CYWNrVGV4dHVyZSA9IGN1cnJlbnRUaGVtZS5FbXB0eVRleHR1cmU7XHJcbiAgICAgICAgICAgIGlmIChQaWN0dXJlcyAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBwY3RNYWluID0gdGhpcy5BZGRDaGlsZDxQaWN0dXJlPihuZXcgUGljdHVyZShQaWN0dXJlc1tDdXJyZW50XSkpO1xyXG4gICAgICAgICAgICAgICAgcGN0TWFpbk9sZCA9IHRoaXMuQWRkQ2hpbGQ8UGljdHVyZT4obmV3IFBpY3R1cmUoUGljdHVyZXNbQ3VycmVudF0sIHZpc2libGU6IGZhbHNlKSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoVGl0bGVzICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBsYmxNYWluID0gdGhpcy5BZGRDaGlsZDxMYWJlbD4obmV3IExhYmVsKFRpdGxlc1tDdXJyZW50XSwgQ3VycmVudFRoZW1lLlN3aXRjaGVyTWFpbkZvbnRTaXplLCBDdXJyZW50VGhlbWUuU3dpdGNoZXJNYWluQ29sb3IsIHk6IC1IIC8gMiAtIDIwLCB2ZXJBbGlnbjogMS4wZikpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxibE1haW5PbGQgPSB0aGlzLkFkZENoaWxkPExhYmVsPihuZXcgTGFiZWwoVGl0bGVzW0N1cnJlbnRdLCBDdXJyZW50VGhlbWUuU3dpdGNoZXJNYWluRm9udFNpemUsIEN1cnJlbnRUaGVtZS5Td2l0Y2hlck1haW5Db2xvciwgeTogLUggLyAyIC0gMjAsIHZlckFsaWduOiAxLjBmLCB2aXNpYmxlOiBmYWxzZSkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKERlc2NyaXB0aW9ucyAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIGxibERlc2MgPSB0aGlzLkFkZENoaWxkPExvbmdMYWJlbD4obmV3IExvbmdMYWJlbChEZXNjcmlwdGlvbnNbQ3VycmVudF0sIEN1cnJlbnRUaGVtZS5Td2l0Y2hlckRlc2NyaXB0aW9uRm9udFNpemUsIEN1cnJlbnRUaGVtZS5Td2l0Y2hlckRlc2NyaXB0aW9uQ29sb3IsIHk6IEggLyAyICsgMjUsIHc6IFcsIHZlckFsaWduOiAwLjBmKSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBsYmxNYWluID0gdGhpcy5BZGRDaGlsZDxMYWJlbD4obmV3IExhYmVsKFRpdGxlc1tDdXJyZW50XSwgQ3VycmVudFRoZW1lLlN3aXRjaGVyTWFpbkZvbnRTaXplLCBDdXJyZW50VGhlbWUuU3dpdGNoZXJNYWluQ29sb3IpKTtcclxuICAgICAgICAgICAgICAgIGxibE1haW5PbGQgPSB0aGlzLkFkZENoaWxkPExhYmVsPihuZXcgTGFiZWwoVGl0bGVzW0N1cnJlbnRdLCBDdXJyZW50VGhlbWUuU3dpdGNoZXJNYWluRm9udFNpemUsIEN1cnJlbnRUaGVtZS5Td2l0Y2hlck1haW5Db2xvciwgdmlzaWJsZTogZmFsc2UpKTtcclxuICAgICAgICAgICAgICAgIGlmIChEZXNjcmlwdGlvbnMgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICBsYmxEZXNjID0gdGhpcy5BZGRDaGlsZDxMb25nTGFiZWw+KG5ldyBMb25nTGFiZWwoRGVzY3JpcHRpb25zW0N1cnJlbnRdLCBDdXJyZW50VGhlbWUuU3dpdGNoZXJEZXNjcmlwdGlvbkZvbnRTaXplLCBDdXJyZW50VGhlbWUuU3dpdGNoZXJEZXNjcmlwdGlvbkNvbG9yLCB5OiBIIC8gMiArIDIwLCB3OiBXLCB2ZXJBbGlnbjogMC4wZikpO1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBiYXNlLkFwcGx5VGhlbWUoY3VycmVudFRoZW1lKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIE1pY3Jvc29mdC5YbmEuRnJhbWV3b3JrLklucHV0O1xyXG5cclxubmFtZXNwYWNlIE1vbm9JbnRlcmZhY2Vcclxue1xyXG4gICAgcHVibGljIGNsYXNzIFdpbmRvdyA6IENvbnRhaW5lclxyXG4gICAge1xyXG5cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgQ2xpY2tCdXR0b24oS2V5cyBrZXkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgYnRuID0gR2V0QnV0dG9uQnlIb3RLZXkoa2V5KTtcclxuICAgICAgICAgICAgaWYgKGJ0biAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgYnRuLkNsaWNrKDAsIDAsIGZhbHNlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIENsaWNrQnV0dG9uKGludCB4LCBpbnQgeSwgYm9vbCBpc1RvdWNoKVxyXG4gICAgICAgIHtcclxuaW50IGZYO1xuaW50IGZZO1xuICAgICAgICAgICAgdmFyIGNvbnQgPSBHZXRDb250YWluZXJCeVBvaW50KHgsIHksIG91dCBmWCwgb3V0IGZZKTtcclxuICAgICAgICAgICAgaWYgKGNvbnQgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgIGNvbnQuQ2xpY2soZlgsIGZZLCBpc1RvdWNoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEhpZ2hsaWdodEJ1dHRvbihpbnQgeCwgaW50IHksIGJvb2wgbVByZXNzZWQpXHJcbiAgICAgICAge1xyXG5pbnQgZlg7XG5pbnQgZlk7XG4gICAgICAgICAgICB2YXIgY29udCA9IEdldENvbnRhaW5lckJ5UG9pbnQoeCwgeSwgb3V0IGZYLCBvdXQgZlkpO1xyXG5CdXR0b24gYnRuOyAgICAgICAgICAgIGlmICgoYnRuID0gY29udCBhcyBCdXR0b24pICE9IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGJ0bi5Gb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFidG4uSXNEaXNhYmxlZClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBidG4uSXNIaWdobGlnaHRlZCA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChtUHJlc3NlZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnRuLklzUHJlc3NlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFRhcEFuZEhvbGRCdXR0b24oaW50IHgsIGludCB5KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaW50IGZYLCBmWTtcclxuICAgICAgICAgICAgdmFyIGNvbnQgPSBHZXRDb250YWluZXJCeVBvaW50KHgsIHksIG91dCBmWCwgb3V0IGZZKTtcclxuQnV0dG9uIGJ0bjsgICAgICAgICAgICBpZiAoKGJ0biA9IGNvbnQgYXMgQnV0dG9uKSAhPSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBidG4uVGFwQW5kSG9sZCgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFidG4uSXNEaXNhYmxlZClcclxuICAgICAgICAgICAgICAgICAgICBidG4uSXNQcmVzc2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBXaW5kb3coaW50IHgsIGludCB5LCBpbnQgdywgaW50IGgsIGZsb2F0IGhvckFsaWduID0gMC41ZiwgZmxvYXQgdmVyQWxpZ24gPSAwLjVmLCBib29sIHZpc2libGUgPSB0cnVlKVxyXG4gICAgICAgICAgICA6IGJhc2UoeCwgeSwgdywgaCwgaG9yQWxpZ24sIHZlckFsaWduLCB2aXNpYmxlKVxyXG4gICAgICAgIHtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIFJlY2FsYygpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBfZmluYWxYID0gWDtcclxuICAgICAgICAgICAgX2ZpbmFsWSA9IFk7XHJcbiAgICAgICAgICAgIF9maW5hbFcgPSBXO1xyXG4gICAgICAgICAgICBfZmluYWxIID0gSDtcclxuICAgICAgICAgICAgX2ZpbmFsQ2hpbGRyZW5TY2FsZVggPSBDaGlsZHJlblNjYWxlWDtcclxuICAgICAgICAgICAgX2ZpbmFsQ2hpbGRyZW5TY2FsZVkgPSBDaGlsZHJlblNjYWxlWTtcclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIGNoaWxkIGluIENoaWxkcmVuKVxyXG4gICAgICAgICAgICAgICAgY2hpbGQuUmVjYWxjKCk7XHJcbiAgICAgICAgICAgIElzTmVlZFJlY2FsYyA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcbn1cclxuIl0KfQo=
